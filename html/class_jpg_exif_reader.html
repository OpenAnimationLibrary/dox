<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: JpgExifReader Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_jpg_exif_reader-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">JpgExifReader Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae82d3c10cab641a79bf965ac0cc19af7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_jpg_exif_reader.html#ae82d3c10cab641a79bf965ac0cc19af7">process_EXIF</a> (unsigned char *ExifSection, unsigned int length)</td></tr>
<tr class="separator:ae82d3c10cab641a79bf965ac0cc19af7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9286403fe889c565d4f082c7ebe935f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_jpg_exif_reader.html#ac9286403fe889c565d4f082c7ebe935f">ProcessExifDir</a> (unsigned char *DirStart, unsigned char *OffsetBase, unsigned ExifLength, int NestingLevel)</td></tr>
<tr class="separator:ac9286403fe889c565d4f082c7ebe935f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f214ededf23b8674b07e37141045e91"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_jpg_exif_reader.html#a4f214ededf23b8674b07e37141045e91">containsResolution</a> ()</td></tr>
<tr class="separator:a4f214ededf23b8674b07e37141045e91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24115464980759d7f094fa4afb8a7db5"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_jpg_exif_reader.html#a24115464980759d7f094fa4afb8a7db5">getXResolution</a> ()</td></tr>
<tr class="separator:a24115464980759d7f094fa4afb8a7db5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46749c2e3343777965b0f042e66f009c"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_jpg_exif_reader.html#a46749c2e3343777965b0f042e66f009c">getYResolution</a> ()</td></tr>
<tr class="separator:a46749c2e3343777965b0f042e66f009c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3786f875bf824caae0da2ee3b5944212"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_jpg_exif_reader.html#a3786f875bf824caae0da2ee3b5944212">getResolutionUnit</a> ()</td></tr>
<tr class="separator:a3786f875bf824caae0da2ee3b5944212"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"></div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a4f214ededf23b8674b07e37141045e91" name="a4f214ededf23b8674b07e37141045e91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f214ededf23b8674b07e37141045e91">&#9670;&nbsp;</a></span>containsResolution()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool JpgExifReader::containsResolution </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  133</span>{ <span class="keywordflow">return</span> <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.xResolution != 0.0; }</div>
<div class="ttc" id="aclass_image_info_html"><div class="ttname"><a href="class_image_info.html">ImageInfo</a></div><div class="ttdef"><b>Definition:</b> timagecache.cpp:132</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3786f875bf824caae0da2ee3b5944212" name="a3786f875bf824caae0da2ee3b5944212"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3786f875bf824caae0da2ee3b5944212">&#9670;&nbsp;</a></span>getResolutionUnit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int JpgExifReader::getResolutionUnit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  136</span>{ <span class="keywordflow">return</span> <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ResolutionUnit; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a24115464980759d7f094fa4afb8a7db5" name="a24115464980759d7f094fa4afb8a7db5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24115464980759d7f094fa4afb8a7db5">&#9670;&nbsp;</a></span>getXResolution()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float JpgExifReader::getXResolution </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  134</span>{ <span class="keywordflow">return</span> <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.xResolution; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a46749c2e3343777965b0f042e66f009c" name="a46749c2e3343777965b0f042e66f009c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46749c2e3343777965b0f042e66f009c">&#9670;&nbsp;</a></span>getYResolution()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float JpgExifReader::getYResolution </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  135</span>{ <span class="keywordflow">return</span> <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.yResolution; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae82d3c10cab641a79bf965ac0cc19af7" name="ae82d3c10cab641a79bf965ac0cc19af7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae82d3c10cab641a79bf965ac0cc19af7">&#9670;&nbsp;</a></span>process_EXIF()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JpgExifReader::process_EXIF </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>ExifSection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  410</span>                                                      {</div>
<div class="line"><span class="lineno">  411</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> FirstOffset;</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span><span class="preprocessor">#ifdef ReadAllTags</span></div>
<div class="line"><span class="lineno">  414</span>  FocalplaneXRes       = 0;</div>
<div class="line"><span class="lineno">  415</span>  FocalplaneUnits      = 0;</div>
<div class="line"><span class="lineno">  416</span>  ExifImageWidth       = 0;</div>
<div class="line"><span class="lineno">  417</span>  NumOrientations      = 0;</div>
<div class="line"><span class="lineno">  418</span>  DirWithThumbnailPtrs = NULL;</div>
<div class="line"><span class="lineno">  419</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>  <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;Exif header %u bytes long\n&quot;</span>, length);</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>  {  <span class="comment">// Check the EXIF header component</span></div>
<div class="line"><span class="lineno">  424</span>    <span class="keyword">static</span> uchar ExifHeader[] = <span class="stringliteral">&quot;Exif\0\0&quot;</span>;</div>
<div class="line"><span class="lineno">  425</span>    <span class="keywordflow">if</span> (memcmp(ExifSection + 2, ExifHeader, 6)) {</div>
<div class="line"><span class="lineno">  426</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;Incorrect Exif header&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  427</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  428</span>    }</div>
<div class="line"><span class="lineno">  429</span>  }</div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>  <span class="keywordflow">if</span> (memcmp(ExifSection + 8, <span class="stringliteral">&quot;II&quot;</span>, 2) == 0) {</div>
<div class="line"><span class="lineno">  432</span>    <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;Exif section in Intel order\n&quot;</span>);</div>
<div class="line"><span class="lineno">  433</span>    MotorolaOrder = 0;</div>
<div class="line"><span class="lineno">  434</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  435</span>    <span class="keywordflow">if</span> (memcmp(ExifSection + 8, <span class="stringliteral">&quot;MM&quot;</span>, 2) == 0) {</div>
<div class="line"><span class="lineno">  436</span>      <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;Exif section in Motorola order\n&quot;</span>);</div>
<div class="line"><span class="lineno">  437</span>      MotorolaOrder = 1;</div>
<div class="line"><span class="lineno">  438</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  439</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;Invalid Exif alignment marker.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  440</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  441</span>    }</div>
<div class="line"><span class="lineno">  442</span>  }</div>
<div class="line"><span class="lineno">  443</span> </div>
<div class="line"><span class="lineno">  444</span>  <span class="comment">// Check the next value for correctness.</span></div>
<div class="line"><span class="lineno">  445</span>  <span class="keywordflow">if</span> (Get16u(ExifSection + 10) != 0x2a) {</div>
<div class="line"><span class="lineno">  446</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;Invalid Exif start (1)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  447</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  448</span>  }</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>  FirstOffset = Get32u(ExifSection + 12);</div>
<div class="line"><span class="lineno">  451</span>  <span class="keywordflow">if</span> (FirstOffset &lt; 8 || FirstOffset &gt; 16) {</div>
<div class="line"><span class="lineno">  452</span>    <span class="keywordflow">if</span> (FirstOffset &lt; 16 || FirstOffset &gt; length - 16) {</div>
<div class="line"><span class="lineno">  453</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;invalid offset for first Exif IFD value&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  454</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  455</span>    }</div>
<div class="line"><span class="lineno">  456</span>    <span class="comment">// Usually set to 8, but other values valid too.</span></div>
<div class="line"><span class="lineno">  457</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;Suspicious offset of first Exif IFD value&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  458</span>  }</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>  <span class="comment">// First directory starts 16 bytes in.  All offset are relative to 8 bytes in.</span></div>
<div class="line"><span class="lineno">  461</span>  ProcessExifDir(ExifSection + 8 + FirstOffset, ExifSection + 8, length - 8, 0);</div>
<div class="line"><span class="lineno">  462</span> </div>
<div class="line"><span class="lineno">  463</span><span class="preprocessor">#ifdef ReadAllTags</span></div>
<div class="line"><span class="lineno">  464</span>  <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ThumbnailAtEnd =</div>
<div class="line"><span class="lineno">  465</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ThumbnailOffset &gt;= <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.LargestExifOffset ? TRUE : FALSE;</div>
<div class="line"><span class="lineno">  466</span> </div>
<div class="line"><span class="lineno">  467</span>  <span class="keywordflow">if</span> (DumpExifMap) {</div>
<div class="line"><span class="lineno">  468</span>    <span class="keywordtype">unsigned</span> a, b;</div>
<div class="line"><span class="lineno">  469</span>    printf(<span class="stringliteral">&quot;Map: %05d- End of exif\n&quot;</span>, length - 8);</div>
<div class="line"><span class="lineno">  470</span>    <span class="keywordflow">for</span> (a = 0; a &lt; length - 8; a += 10) {</div>
<div class="line"><span class="lineno">  471</span>      printf(<span class="stringliteral">&quot;Map: %05d &quot;</span>, a);</div>
<div class="line"><span class="lineno">  472</span>      <span class="keywordflow">for</span> (b = 0; b &lt; 10; b++) printf(<span class="stringliteral">&quot; %02x&quot;</span>, *(ExifSection + 8 + a + b));</div>
<div class="line"><span class="lineno">  473</span>      printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  474</span>    }</div>
<div class="line"><span class="lineno">  475</span>  }</div>
<div class="line"><span class="lineno">  476</span> </div>
<div class="line"><span class="lineno">  477</span>  <span class="comment">// Compute the CCD width, in millimeters.</span></div>
<div class="line"><span class="lineno">  478</span>  <span class="keywordflow">if</span> (FocalplaneXRes != 0 &amp;&amp; ExifImageWidth != 0) {</div>
<div class="line"><span class="lineno">  479</span>    <span class="comment">// Note: With some cameras, its not possible to compute this correctly</span></div>
<div class="line"><span class="lineno">  480</span>    <span class="comment">// because</span></div>
<div class="line"><span class="lineno">  481</span>    <span class="comment">// they don&#39;t adjust the indicated focal plane resolution units when using</span></div>
<div class="line"><span class="lineno">  482</span>    <span class="comment">// less</span></div>
<div class="line"><span class="lineno">  483</span>    <span class="comment">// than maximum resolution, so the CCDWidth value comes out too small.</span></div>
<div class="line"><span class="lineno">  484</span>    <span class="comment">// Nothing</span></div>
<div class="line"><span class="lineno">  485</span>    <span class="comment">// that Jhad can do about it - its a camera problem.</span></div>
<div class="line"><span class="lineno">  486</span>    <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.CCDWidth =</div>
<div class="line"><span class="lineno">  487</span>        (float)(ExifImageWidth * FocalplaneUnits / FocalplaneXRes);</div>
<div class="line"><span class="lineno">  488</span> </div>
<div class="line"><span class="lineno">  489</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.FocalLength &amp;&amp; <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.FocalLength35mmEquiv == 0) {</div>
<div class="line"><span class="lineno">  490</span>      <span class="comment">// Compute 35 mm equivalent focal length based on sensor geometry if we</span></div>
<div class="line"><span class="lineno">  491</span>      <span class="comment">// haven&#39;t</span></div>
<div class="line"><span class="lineno">  492</span>      <span class="comment">// already got it explicitly from a tag.</span></div>
<div class="line"><span class="lineno">  493</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.FocalLength35mmEquiv =</div>
<div class="line"><span class="lineno">  494</span>          (int)(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.FocalLength / <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.CCDWidth * 36 + 0.5);</div>
<div class="line"><span class="lineno">  495</span>    }</div>
<div class="line"><span class="lineno">  496</span>  }</div>
<div class="line"><span class="lineno">  497</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  498</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac9286403fe889c565d4f082c7ebe935f" name="ac9286403fe889c565d4f082c7ebe935f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9286403fe889c565d4f082c7ebe935f">&#9670;&nbsp;</a></span>ProcessExifDir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JpgExifReader::ProcessExifDir </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>DirStart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>OffsetBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>ExifLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>NestingLevel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  505</span>                                                                          {</div>
<div class="line"><span class="lineno">  506</span>  <span class="keywordtype">int</span> de;</div>
<div class="line"><span class="lineno">  507</span>  <span class="keywordtype">int</span> a;</div>
<div class="line"><span class="lineno">  508</span>  <span class="keywordtype">int</span> NumDirEntries;</div>
<div class="line"><span class="lineno">  509</span>  <span class="keywordtype">unsigned</span> ThumbnailOffset = 0;</div>
<div class="line"><span class="lineno">  510</span>  <span class="keywordtype">unsigned</span> ThumbnailSize   = 0;</div>
<div class="line"><span class="lineno">  511</span>  <span class="keywordtype">char</span> IndentString[25];</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>  <span class="keywordflow">if</span> (NestingLevel &gt; 4) {</div>
<div class="line"><span class="lineno">  514</span>    std::cout &lt;&lt; <span class="stringliteral">&quot;Maximum Exif directory nesting exceeded (corrupt Exif header)&quot;</span></div>
<div class="line"><span class="lineno">  515</span>              &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  516</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  517</span>  }</div>
<div class="line"><span class="lineno">  518</span> </div>
<div class="line"><span class="lineno">  519</span>  memset(IndentString, <span class="charliteral">&#39; &#39;</span>, 25);</div>
<div class="line"><span class="lineno">  520</span>  IndentString[NestingLevel * 4] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span>  NumDirEntries = Get16u(DirStart);</div>
<div class="line"><span class="lineno">  523</span><span class="preprocessor">#define DIR_ENTRY_ADDR(Start, Entry) (Start + 2 + 12 * (Entry))</span></div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>  {</div>
<div class="line"><span class="lineno">  526</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *DirEnd;</div>
<div class="line"><span class="lineno">  527</span>    DirEnd = DIR_ENTRY_ADDR(DirStart, NumDirEntries);</div>
<div class="line"><span class="lineno">  528</span>    <span class="keywordflow">if</span> (DirEnd + 4 &gt; (OffsetBase + ExifLength)) {</div>
<div class="line"><span class="lineno">  529</span>      <span class="keywordflow">if</span> (DirEnd + 2 == OffsetBase + ExifLength ||</div>
<div class="line"><span class="lineno">  530</span>          DirEnd == OffsetBase + ExifLength) {</div>
<div class="line"><span class="lineno">  531</span>        <span class="comment">// Version 1.3 of jhead would truncate a bit too much.</span></div>
<div class="line"><span class="lineno">  532</span>        <span class="comment">// This also caught later on as well.</span></div>
<div class="line"><span class="lineno">  533</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  534</span>        std::cout &lt;&lt; <span class="stringliteral">&quot;Illegally sized Exif subdirectory (&quot;</span> &lt;&lt; NumDirEntries</div>
<div class="line"><span class="lineno">  535</span>                  &lt;&lt; <span class="stringliteral">&quot;entries)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  536</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  537</span>      }</div>
<div class="line"><span class="lineno">  538</span>    }</div>
<div class="line"><span class="lineno">  539</span>    <span class="keywordflow">if</span> (DumpExifMap) {</div>
<div class="line"><span class="lineno">  540</span>      printf(<span class="stringliteral">&quot;Map: %05u-%05u: Directory\n&quot;</span>, (<span class="keywordtype">int</span>)(DirStart - OffsetBase),</div>
<div class="line"><span class="lineno">  541</span>             (<span class="keywordtype">int</span>)(DirEnd + 4 - OffsetBase));</div>
<div class="line"><span class="lineno">  542</span>    }</div>
<div class="line"><span class="lineno">  543</span>  }</div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>  <span class="keywordflow">if</span> (ShowTags) {</div>
<div class="line"><span class="lineno">  546</span>    printf(<span class="stringliteral">&quot;(dir has %d entries)\n&quot;</span>, NumDirEntries);</div>
<div class="line"><span class="lineno">  547</span>  }</div>
<div class="line"><span class="lineno">  548</span> </div>
<div class="line"><span class="lineno">  549</span>  <span class="keywordflow">for</span> (de = 0; de &lt; NumDirEntries; de++) {</div>
<div class="line"><span class="lineno">  550</span>    <span class="keywordtype">int</span> Tag, Format, Components;</div>
<div class="line"><span class="lineno">  551</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ValuePtr;</div>
<div class="line"><span class="lineno">  552</span>    <span class="keywordtype">int</span> ByteCount;</div>
<div class="line"><span class="lineno">  553</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *DirEntry;</div>
<div class="line"><span class="lineno">  554</span>    DirEntry = DIR_ENTRY_ADDR(DirStart, de);</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>    Tag        = Get16u(DirEntry);</div>
<div class="line"><span class="lineno">  557</span>    Format     = Get16u(DirEntry + 2);</div>
<div class="line"><span class="lineno">  558</span>    Components = Get32u(DirEntry + 4);</div>
<div class="line"><span class="lineno">  559</span> </div>
<div class="line"><span class="lineno">  560</span>    <span class="keywordflow">if</span> ((Format - 1) &gt;= NUM_FORMATS) {</div>
<div class="line"><span class="lineno">  561</span>      <span class="comment">// (-1) catches illegal zero case as unsigned underflows to positive</span></div>
<div class="line"><span class="lineno">  562</span>      <span class="comment">// large.</span></div>
<div class="line"><span class="lineno">  563</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal number format &quot;</span> &lt;&lt; Format &lt;&lt; <span class="stringliteral">&quot; for tag &quot;</span> &lt;&lt; Tag</div>
<div class="line"><span class="lineno">  564</span>                &lt;&lt; <span class="stringliteral">&quot; in Exif&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  565</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  566</span>    }</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>    <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span>)Components &gt; 0x10000) {</div>
<div class="line"><span class="lineno">  569</span>      std::cout &lt;&lt; <span class="stringliteral">&quot;Too many components &quot;</span> &lt;&lt; Components &lt;&lt; <span class="stringliteral">&quot; for tag &quot;</span> &lt;&lt; Tag</div>
<div class="line"><span class="lineno">  570</span>                &lt;&lt; <span class="stringliteral">&quot; in Exif&quot;</span>;</div>
<div class="line"><span class="lineno">  571</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  572</span>    }</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>    ByteCount = Components * BytesPerFormat[Format];</div>
<div class="line"><span class="lineno">  575</span> </div>
<div class="line"><span class="lineno">  576</span>    <span class="keywordflow">if</span> (ByteCount &gt; 4) {</div>
<div class="line"><span class="lineno">  577</span>      <span class="keywordtype">unsigned</span> OffsetVal;</div>
<div class="line"><span class="lineno">  578</span>      OffsetVal = Get32u(DirEntry + 8);</div>
<div class="line"><span class="lineno">  579</span>      <span class="comment">// If its bigger than 4 bytes, the dir entry contains an offset.</span></div>
<div class="line"><span class="lineno">  580</span>      <span class="keywordflow">if</span> (OffsetVal + ByteCount &gt; ExifLength) {</div>
<div class="line"><span class="lineno">  581</span>        <span class="comment">// Bogus pointer offset and / or bytecount value</span></div>
<div class="line"><span class="lineno">  582</span>        std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal value pointer for tag &quot;</span> &lt;&lt; Tag &lt;&lt; <span class="stringliteral">&quot; in Exif&quot;</span>;</div>
<div class="line"><span class="lineno">  583</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  584</span>      }</div>
<div class="line"><span class="lineno">  585</span>      ValuePtr = OffsetBase + OffsetVal;</div>
<div class="line"><span class="lineno">  586</span> </div>
<div class="line"><span class="lineno">  587</span><span class="preprocessor">#ifdef ReadAllTags</span></div>
<div class="line"><span class="lineno">  588</span>      <span class="keywordflow">if</span> (OffsetVal &gt; <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.LargestExifOffset) {</div>
<div class="line"><span class="lineno">  589</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.LargestExifOffset = OffsetVal;</div>
<div class="line"><span class="lineno">  590</span>      }</div>
<div class="line"><span class="lineno">  591</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>      <span class="keywordflow">if</span> (DumpExifMap) {</div>
<div class="line"><span class="lineno">  594</span>        printf(<span class="stringliteral">&quot;Map: %05u-%05u:   Data for tag %04x\n&quot;</span>, OffsetVal,</div>
<div class="line"><span class="lineno">  595</span>               OffsetVal + ByteCount, Tag);</div>
<div class="line"><span class="lineno">  596</span>      }</div>
<div class="line"><span class="lineno">  597</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  598</span>      <span class="comment">// 4 bytes or less and value is in the dir entry itself</span></div>
<div class="line"><span class="lineno">  599</span>      ValuePtr = DirEntry + 8;</div>
<div class="line"><span class="lineno">  600</span>    }</div>
<div class="line"><span class="lineno">  601</span> </div>
<div class="line"><span class="lineno">  602</span><span class="preprocessor">#ifdef ReadAllTags</span></div>
<div class="line"><span class="lineno">  603</span>    <span class="keywordflow">if</span> (Tag == TAG_MAKER_NOTE) {</div>
<div class="line"><span class="lineno">  604</span>      <span class="keywordflow">if</span> (ShowTags) {</div>
<div class="line"><span class="lineno">  605</span>        printf(<span class="stringliteral">&quot;%s    Maker note: &quot;</span>, IndentString);</div>
<div class="line"><span class="lineno">  606</span>      }</div>
<div class="line"><span class="lineno">  607</span>      <span class="comment">// ProcessMakerNote(ValuePtr, ByteCount, OffsetBase, ExifLength);</span></div>
<div class="line"><span class="lineno">  608</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  609</span>    }</div>
<div class="line"><span class="lineno">  610</span> </div>
<div class="line"><span class="lineno">  611</span>    <span class="keywordflow">if</span> (ShowTags) {</div>
<div class="line"><span class="lineno">  612</span>      <span class="comment">// Show tag name</span></div>
<div class="line"><span class="lineno">  613</span>      <span class="keywordflow">for</span> (a = 0;; a++) {</div>
<div class="line"><span class="lineno">  614</span>        <span class="keywordflow">if</span> (a &gt;= TAG_TABLE_SIZE) {</div>
<div class="line"><span class="lineno">  615</span>          printf(<span class="stringliteral">&quot;%s    Unknown Tag %04x Value = &quot;</span>, IndentString, Tag);</div>
<div class="line"><span class="lineno">  616</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  617</span>        }</div>
<div class="line"><span class="lineno">  618</span>        <span class="keywordflow">if</span> (TagTable[a].Tag == Tag) {</div>
<div class="line"><span class="lineno">  619</span>          printf(<span class="stringliteral">&quot;%s    %s = &quot;</span>, IndentString, TagTable[a].Desc);</div>
<div class="line"><span class="lineno">  620</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  621</span>        }</div>
<div class="line"><span class="lineno">  622</span>      }</div>
<div class="line"><span class="lineno">  623</span> </div>
<div class="line"><span class="lineno">  624</span>      <span class="comment">// Show tag value.</span></div>
<div class="line"><span class="lineno">  625</span>      <span class="keywordflow">switch</span> (Format) {</div>
<div class="line"><span class="lineno">  626</span>      <span class="keywordflow">case</span> FMT_BYTE:</div>
<div class="line"><span class="lineno">  627</span>        <span class="keywordflow">if</span> (ByteCount &gt; 1) {</div>
<div class="line"><span class="lineno">  628</span>          printf(<span class="stringliteral">&quot;%.*ls\n&quot;</span>, ByteCount / 2, (<span class="keywordtype">wchar_t</span> *)ValuePtr);</div>
<div class="line"><span class="lineno">  629</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  630</span>          PrintFormatNumber(ValuePtr, Format, ByteCount);</div>
<div class="line"><span class="lineno">  631</span>          printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  632</span>        }</div>
<div class="line"><span class="lineno">  633</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  634</span> </div>
<div class="line"><span class="lineno">  635</span>      <span class="keywordflow">case</span> FMT_UNDEFINED:</div>
<div class="line"><span class="lineno">  636</span>        <span class="comment">// Undefined is typically an ascii string.</span></div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>      <span class="keywordflow">case</span> FMT_STRING:</div>
<div class="line"><span class="lineno">  639</span>        <span class="comment">// String arrays printed without function call (different from int</span></div>
<div class="line"><span class="lineno">  640</span>        <span class="comment">// arrays)</span></div>
<div class="line"><span class="lineno">  641</span>        {</div>
<div class="line"><span class="lineno">  642</span>          <span class="keywordtype">int</span> NoPrint = 0;</div>
<div class="line"><span class="lineno">  643</span>          printf(<span class="stringliteral">&quot;\&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  644</span>          <span class="keywordflow">for</span> (a = 0; a &lt; ByteCount; a++) {</div>
<div class="line"><span class="lineno">  645</span>            <span class="keywordflow">if</span> (ValuePtr[a] &gt;= 32) {</div>
<div class="line"><span class="lineno">  646</span>              putchar(ValuePtr[a]);</div>
<div class="line"><span class="lineno">  647</span>              NoPrint = 0;</div>
<div class="line"><span class="lineno">  648</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  649</span>              <span class="comment">// Avoiding indicating too many unprintable characters of</span></div>
<div class="line"><span class="lineno">  650</span>              <span class="comment">// proprietary</span></div>
<div class="line"><span class="lineno">  651</span>              <span class="comment">// bits of binary information this program may not know how to</span></div>
<div class="line"><span class="lineno">  652</span>              <span class="comment">// parse.</span></div>
<div class="line"><span class="lineno">  653</span>              <span class="keywordflow">if</span> (!NoPrint &amp;&amp; a != ByteCount - 1) {</div>
<div class="line"><span class="lineno">  654</span>                putchar(<span class="charliteral">&#39;?&#39;</span>);</div>
<div class="line"><span class="lineno">  655</span>                NoPrint = 1;</div>
<div class="line"><span class="lineno">  656</span>              }</div>
<div class="line"><span class="lineno">  657</span>            }</div>
<div class="line"><span class="lineno">  658</span>          }</div>
<div class="line"><span class="lineno">  659</span>          printf(<span class="stringliteral">&quot;\&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  660</span>        }</div>
<div class="line"><span class="lineno">  661</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>      <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  664</span>        <span class="comment">// Handle arrays of numbers later (will there ever be?)</span></div>
<div class="line"><span class="lineno">  665</span>        PrintFormatNumber(ValuePtr, Format, ByteCount);</div>
<div class="line"><span class="lineno">  666</span>        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  667</span>      }</div>
<div class="line"><span class="lineno">  668</span>    }</div>
<div class="line"><span class="lineno">  669</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  670</span>    <span class="comment">// Extract useful components of tag</span></div>
<div class="line"><span class="lineno">  671</span>    <span class="keywordflow">switch</span> (Tag) {</div>
<div class="line"><span class="lineno">  672</span><span class="preprocessor">#ifdef ReadAllTags</span></div>
<div class="line"><span class="lineno">  673</span>    <span class="keywordflow">case</span> TAG_MAKE:</div>
<div class="line"><span class="lineno">  674</span>      strncpy(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.CameraMake, (<span class="keywordtype">char</span> *)ValuePtr,</div>
<div class="line"><span class="lineno">  675</span>              ByteCount &lt; 31 ? ByteCount : 31);</div>
<div class="line"><span class="lineno">  676</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  677</span> </div>
<div class="line"><span class="lineno">  678</span>    <span class="keywordflow">case</span> TAG_MODEL:</div>
<div class="line"><span class="lineno">  679</span>      strncpy(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.CameraModel, (<span class="keywordtype">char</span> *)ValuePtr,</div>
<div class="line"><span class="lineno">  680</span>              ByteCount &lt; 39 ? ByteCount : 39);</div>
<div class="line"><span class="lineno">  681</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  682</span> </div>
<div class="line"><span class="lineno">  683</span>    <span class="keywordflow">case</span> TAG_DATETIME_ORIGINAL:</div>
<div class="line"><span class="lineno">  684</span>      <span class="comment">// If we get a DATETIME_ORIGINAL, we use that one.</span></div>
<div class="line"><span class="lineno">  685</span>      strncpy(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.DateTime, (<span class="keywordtype">char</span> *)ValuePtr, 19);</div>
<div class="line"><span class="lineno">  686</span>      <span class="comment">// Fallthru...</span></div>
<div class="line"><span class="lineno">  687</span> </div>
<div class="line"><span class="lineno">  688</span>    <span class="keywordflow">case</span> TAG_DATETIME_DIGITIZED:</div>
<div class="line"><span class="lineno">  689</span>    <span class="keywordflow">case</span> TAG_DATETIME:</div>
<div class="line"><span class="lineno">  690</span>      <span class="keywordflow">if</span> (!isdigit(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span><span class="keyword">&gt;</span>(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.DateTime[0]))) {</div>
<div class="line"><span class="lineno">  691</span>        <span class="comment">// If we don&#39;t already have a DATETIME_ORIGINAL, use whatever</span></div>
<div class="line"><span class="lineno">  692</span>        <span class="comment">// time fields we may have.</span></div>
<div class="line"><span class="lineno">  693</span>        strncpy(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.DateTime, (<span class="keywordtype">char</span> *)ValuePtr, 19);</div>
<div class="line"><span class="lineno">  694</span>      }</div>
<div class="line"><span class="lineno">  695</span> </div>
<div class="line"><span class="lineno">  696</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.numDateTimeTags &gt;= MAX_DATE_COPIES) {</div>
<div class="line"><span class="lineno">  697</span>        std::cout &lt;&lt; <span class="stringliteral">&quot;More than &quot;</span> &lt;&lt; MAX_DATE_COPIES</div>
<div class="line"><span class="lineno">  698</span>                  &lt;&lt; <span class="stringliteral">&quot; date fields in Exif.  This is nuts&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  699</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  700</span>      }</div>
<div class="line"><span class="lineno">  701</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.DateTimeOffsets[<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.numDateTimeTags++] =</div>
<div class="line"><span class="lineno">  702</span>          (<span class="keywordtype">char</span> *)ValuePtr - (<span class="keywordtype">char</span> *)OffsetBase;</div>
<div class="line"><span class="lineno">  703</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  704</span> </div>
<div class="line"><span class="lineno">  705</span>    <span class="keywordflow">case</span> TAG_WINXP_COMMENT:</div>
<div class="line"><span class="lineno">  706</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Comments[0]) {  <span class="comment">// We already have a jpeg comment.</span></div>
<div class="line"><span class="lineno">  707</span>        <span class="comment">// Already have a comment (probably windows comment), skip this one.</span></div>
<div class="line"><span class="lineno">  708</span>        <span class="keywordflow">if</span> (ShowTags)</div>
<div class="line"><span class="lineno">  709</span>          printf(<span class="stringliteral">&quot;Windows XP comment and other comment in header\n&quot;</span>);</div>
<div class="line"><span class="lineno">  710</span>        <span class="keywordflow">break</span>;  <span class="comment">// Already have a windows comment, skip this one.</span></div>
<div class="line"><span class="lineno">  711</span>      }</div>
<div class="line"><span class="lineno">  712</span> </div>
<div class="line"><span class="lineno">  713</span>      <span class="keywordflow">if</span> (ByteCount &gt; 1) {</div>
<div class="line"><span class="lineno">  714</span>        <span class="keywordflow">if</span> (ByteCount &gt; MAX_COMMENT_SIZE) ByteCount = MAX_COMMENT_SIZE;</div>
<div class="line"><span class="lineno">  715</span>        memcpy(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Comments, ValuePtr, ByteCount);</div>
<div class="line"><span class="lineno">  716</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.CommentWidthchars = ByteCount / 2;</div>
<div class="line"><span class="lineno">  717</span>      }</div>
<div class="line"><span class="lineno">  718</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  719</span> </div>
<div class="line"><span class="lineno">  720</span>    <span class="keywordflow">case</span> TAG_USERCOMMENT:</div>
<div class="line"><span class="lineno">  721</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Comments[0]) {  <span class="comment">// We already have a jpeg comment.</span></div>
<div class="line"><span class="lineno">  722</span>        <span class="comment">// Already have a comment (probably windows comment), skip this one.</span></div>
<div class="line"><span class="lineno">  723</span>        <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;Multiple comments in exif header\n&quot;</span>);</div>
<div class="line"><span class="lineno">  724</span>        <span class="keywordflow">break</span>;  <span class="comment">// Already have a windows comment, skip this one.</span></div>
<div class="line"><span class="lineno">  725</span>      }</div>
<div class="line"><span class="lineno">  726</span> </div>
<div class="line"><span class="lineno">  727</span>      <span class="comment">// Comment is often padded with trailing spaces.  Remove these first.</span></div>
<div class="line"><span class="lineno">  728</span>      <span class="keywordflow">for</span> (a = ByteCount;;) {</div>
<div class="line"><span class="lineno">  729</span>        a--;</div>
<div class="line"><span class="lineno">  730</span>        <span class="keywordflow">if</span> ((ValuePtr)[a] == <span class="charliteral">&#39; &#39;</span>) {</div>
<div class="line"><span class="lineno">  731</span>          (ValuePtr)[a] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  732</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  733</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  734</span>        }</div>
<div class="line"><span class="lineno">  735</span>        <span class="keywordflow">if</span> (a == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  736</span>      }</div>
<div class="line"><span class="lineno">  737</span> </div>
<div class="line"><span class="lineno">  738</span>      <span class="comment">// Copy the comment</span></div>
<div class="line"><span class="lineno">  739</span>      {</div>
<div class="line"><span class="lineno">  740</span>        <span class="keywordtype">int</span> msiz = ExifLength - (ValuePtr - OffsetBase);</div>
<div class="line"><span class="lineno">  741</span>        <span class="keywordflow">if</span> (msiz &gt; ByteCount) msiz = ByteCount;</div>
<div class="line"><span class="lineno">  742</span>        <span class="keywordflow">if</span> (msiz &gt; MAX_COMMENT_SIZE - 1) msiz = MAX_COMMENT_SIZE - 1;</div>
<div class="line"><span class="lineno">  743</span>        <span class="keywordflow">if</span> (msiz &gt; 5 &amp;&amp; memcmp(ValuePtr, <span class="stringliteral">&quot;ASCII&quot;</span>, 5) == 0) {</div>
<div class="line"><span class="lineno">  744</span>          <span class="keywordflow">for</span> (a = 5; a &lt; 10 &amp;&amp; a &lt; msiz; a++) {</div>
<div class="line"><span class="lineno">  745</span>            <span class="keywordtype">int</span> c = (ValuePtr)[a];</div>
<div class="line"><span class="lineno">  746</span>            <span class="keywordflow">if</span> (c != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; c != <span class="charliteral">&#39; &#39;</span>) {</div>
<div class="line"><span class="lineno">  747</span>              strncpy(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Comments, (<span class="keywordtype">char</span> *)ValuePtr + a, msiz - a);</div>
<div class="line"><span class="lineno">  748</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  749</span>            }</div>
<div class="line"><span class="lineno">  750</span>          }</div>
<div class="line"><span class="lineno">  751</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  752</span>          strncpy(<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Comments, (<span class="keywordtype">char</span> *)ValuePtr, msiz);</div>
<div class="line"><span class="lineno">  753</span>        }</div>
<div class="line"><span class="lineno">  754</span>      }</div>
<div class="line"><span class="lineno">  755</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  756</span> </div>
<div class="line"><span class="lineno">  757</span>    <span class="keywordflow">case</span> TAG_FNUMBER:</div>
<div class="line"><span class="lineno">  758</span>      <span class="comment">// Simplest way of expressing aperture, so I trust it the most.</span></div>
<div class="line"><span class="lineno">  759</span>      <span class="comment">// (overwrite previously computd value if there is one)</span></div>
<div class="line"><span class="lineno">  760</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ApertureFNumber = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  761</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  762</span> </div>
<div class="line"><span class="lineno">  763</span>    <span class="keywordflow">case</span> TAG_APERTURE:</div>
<div class="line"><span class="lineno">  764</span>    <span class="keywordflow">case</span> TAG_MAXAPERTURE:</div>
<div class="line"><span class="lineno">  765</span>      <span class="comment">// More relevant info always comes earlier, so only use this field if we</span></div>
<div class="line"><span class="lineno">  766</span>      <span class="comment">// don&#39;t</span></div>
<div class="line"><span class="lineno">  767</span>      <span class="comment">// have appropriate aperture information yet.</span></div>
<div class="line"><span class="lineno">  768</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ApertureFNumber == 0) {</div>
<div class="line"><span class="lineno">  769</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ApertureFNumber =</div>
<div class="line"><span class="lineno">  770</span>            (float)exp(ConvertAnyFormat(ValuePtr, Format) * log(2) * 0.5);</div>
<div class="line"><span class="lineno">  771</span>      }</div>
<div class="line"><span class="lineno">  772</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  773</span> </div>
<div class="line"><span class="lineno">  774</span>    <span class="keywordflow">case</span> TAG_FOCALLENGTH:</div>
<div class="line"><span class="lineno">  775</span>      <span class="comment">// Nice digital cameras actually save the focal length as a function</span></div>
<div class="line"><span class="lineno">  776</span>      <span class="comment">// of how farthey are zoomed in.</span></div>
<div class="line"><span class="lineno">  777</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.FocalLength = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  778</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  779</span> </div>
<div class="line"><span class="lineno">  780</span>    <span class="keywordflow">case</span> TAG_SUBJECT_DISTANCE:</div>
<div class="line"><span class="lineno">  781</span>      <span class="comment">// Inidcates the distacne the autofocus camera is focused to.</span></div>
<div class="line"><span class="lineno">  782</span>      <span class="comment">// Tends to be less accurate as distance increases.</span></div>
<div class="line"><span class="lineno">  783</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Distance = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  784</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  785</span> </div>
<div class="line"><span class="lineno">  786</span>    <span class="keywordflow">case</span> TAG_EXPOSURETIME:</div>
<div class="line"><span class="lineno">  787</span>      <span class="comment">// Simplest way of expressing exposure time, so I trust it most.</span></div>
<div class="line"><span class="lineno">  788</span>      <span class="comment">// (overwrite previously computd value if there is one)</span></div>
<div class="line"><span class="lineno">  789</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ExposureTime = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  790</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  791</span> </div>
<div class="line"><span class="lineno">  792</span>    <span class="keywordflow">case</span> TAG_SHUTTERSPEED:</div>
<div class="line"><span class="lineno">  793</span>      <span class="comment">// More complicated way of expressing exposure time, so only use</span></div>
<div class="line"><span class="lineno">  794</span>      <span class="comment">// this value if we don&#39;t already have it from somewhere else.</span></div>
<div class="line"><span class="lineno">  795</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ExposureTime == 0) {</div>
<div class="line"><span class="lineno">  796</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ExposureTime =</div>
<div class="line"><span class="lineno">  797</span>            (float)(1 / exp(ConvertAnyFormat(ValuePtr, Format) * log(2)));</div>
<div class="line"><span class="lineno">  798</span>      }</div>
<div class="line"><span class="lineno">  799</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  800</span> </div>
<div class="line"><span class="lineno">  801</span>    <span class="keywordflow">case</span> TAG_FLASH:</div>
<div class="line"><span class="lineno">  802</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.FlashUsed = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  803</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  804</span> </div>
<div class="line"><span class="lineno">  805</span>    <span class="keywordflow">case</span> TAG_ORIENTATION:</div>
<div class="line"><span class="lineno">  806</span>      <span class="keywordflow">if</span> (NumOrientations &gt;= 2) {</div>
<div class="line"><span class="lineno">  807</span>        <span class="comment">// Can have another orientation tag for the thumbnail, but if there&#39;s</span></div>
<div class="line"><span class="lineno">  808</span>        <span class="comment">// a third one, things are strange.</span></div>
<div class="line"><span class="lineno">  809</span>        std::cout &lt;&lt; <span class="stringliteral">&quot;More than two orientation in Exif&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  810</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  811</span>      }</div>
<div class="line"><span class="lineno">  812</span>      OrientationPtr[NumOrientations]       = ValuePtr;</div>
<div class="line"><span class="lineno">  813</span>      OrientationNumFormat[NumOrientations] = Format;</div>
<div class="line"><span class="lineno">  814</span>      <span class="keywordflow">if</span> (NumOrientations == 0) {</div>
<div class="line"><span class="lineno">  815</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Orientation = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  816</span>      }</div>
<div class="line"><span class="lineno">  817</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Orientation &lt; 0 || <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Orientation &gt; 8) {</div>
<div class="line"><span class="lineno">  818</span>        std::cout &lt;&lt; <span class="stringliteral">&quot;Undefined rotation value &quot;</span> &lt;&lt; <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Orientation</div>
<div class="line"><span class="lineno">  819</span>                  &lt;&lt; <span class="stringliteral">&quot; in Exif&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  820</span>      }</div>
<div class="line"><span class="lineno">  821</span>      NumOrientations += 1;</div>
<div class="line"><span class="lineno">  822</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>    <span class="keywordflow">case</span> TAG_PIXEL_Y_DIMENSION:</div>
<div class="line"><span class="lineno">  825</span>    <span class="keywordflow">case</span> TAG_PIXEL_X_DIMENSION:</div>
<div class="line"><span class="lineno">  826</span>      <span class="comment">// Use largest of height and width to deal with images that have been</span></div>
<div class="line"><span class="lineno">  827</span>      <span class="comment">// rotated to portrait format.</span></div>
<div class="line"><span class="lineno">  828</span>      a = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  829</span>      <span class="keywordflow">if</span> (ExifImageWidth &lt; a) ExifImageWidth = a;</div>
<div class="line"><span class="lineno">  830</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  831</span> </div>
<div class="line"><span class="lineno">  832</span>    <span class="keywordflow">case</span> TAG_FOCAL_PLANE_XRES:</div>
<div class="line"><span class="lineno">  833</span>      FocalplaneXRes = ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  834</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  835</span> </div>
<div class="line"><span class="lineno">  836</span>    <span class="keywordflow">case</span> TAG_FOCAL_PLANE_UNITS:</div>
<div class="line"><span class="lineno">  837</span>      <span class="keywordflow">switch</span> ((<span class="keywordtype">int</span>)ConvertAnyFormat(ValuePtr, Format)) {</div>
<div class="line"><span class="lineno">  838</span>      <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno">  839</span>        FocalplaneUnits = 25.4;</div>
<div class="line"><span class="lineno">  840</span>        <span class="keywordflow">break</span>;  <span class="comment">// inch</span></div>
<div class="line"><span class="lineno">  841</span>      <span class="keywordflow">case</span> 2:</div>
<div class="line"><span class="lineno">  842</span>        <span class="comment">// According to the information I was using, 2 means meters.</span></div>
<div class="line"><span class="lineno">  843</span>        <span class="comment">// But looking at the Cannon powershot&#39;s files, inches is the only</span></div>
<div class="line"><span class="lineno">  844</span>        <span class="comment">// sensible value.</span></div>
<div class="line"><span class="lineno">  845</span>        FocalplaneUnits = 25.4;</div>
<div class="line"><span class="lineno">  846</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  847</span> </div>
<div class="line"><span class="lineno">  848</span>      <span class="keywordflow">case</span> 3:</div>
<div class="line"><span class="lineno">  849</span>        FocalplaneUnits = 10;</div>
<div class="line"><span class="lineno">  850</span>        <span class="keywordflow">break</span>;  <span class="comment">// centimeter</span></div>
<div class="line"><span class="lineno">  851</span>      <span class="keywordflow">case</span> 4:</div>
<div class="line"><span class="lineno">  852</span>        FocalplaneUnits = 1;</div>
<div class="line"><span class="lineno">  853</span>        <span class="keywordflow">break</span>;  <span class="comment">// millimeter</span></div>
<div class="line"><span class="lineno">  854</span>      <span class="keywordflow">case</span> 5:</div>
<div class="line"><span class="lineno">  855</span>        FocalplaneUnits = .001;</div>
<div class="line"><span class="lineno">  856</span>        <span class="keywordflow">break</span>;  <span class="comment">// micrometer</span></div>
<div class="line"><span class="lineno">  857</span>      }</div>
<div class="line"><span class="lineno">  858</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  859</span> </div>
<div class="line"><span class="lineno">  860</span>    <span class="keywordflow">case</span> TAG_EXPOSURE_BIAS:</div>
<div class="line"><span class="lineno">  861</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ExposureBias = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  862</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  863</span> </div>
<div class="line"><span class="lineno">  864</span>    <span class="keywordflow">case</span> TAG_WHITEBALANCE:</div>
<div class="line"><span class="lineno">  865</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.Whitebalance = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  866</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  867</span> </div>
<div class="line"><span class="lineno">  868</span>    <span class="keywordflow">case</span> TAG_LIGHT_SOURCE:</div>
<div class="line"><span class="lineno">  869</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.LightSource = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  870</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  871</span> </div>
<div class="line"><span class="lineno">  872</span>    <span class="keywordflow">case</span> TAG_METERING_MODE:</div>
<div class="line"><span class="lineno">  873</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.MeteringMode = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  874</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  875</span> </div>
<div class="line"><span class="lineno">  876</span>    <span class="keywordflow">case</span> TAG_EXPOSURE_PROGRAM:</div>
<div class="line"><span class="lineno">  877</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ExposureProgram = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  878</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  879</span> </div>
<div class="line"><span class="lineno">  880</span>    <span class="keywordflow">case</span> TAG_EXPOSURE_INDEX:</div>
<div class="line"><span class="lineno">  881</span>      <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ISOequivalent == 0) {</div>
<div class="line"><span class="lineno">  882</span>        <span class="comment">// Exposure index and ISO equivalent are often used interchangeably,</span></div>
<div class="line"><span class="lineno">  883</span>        <span class="comment">// so we will do the same in jhead.</span></div>
<div class="line"><span class="lineno">  884</span>        <span class="comment">// http://photography.about.com/library/glossary/bldef_ei.htm</span></div>
<div class="line"><span class="lineno">  885</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ISOequivalent = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  886</span>      }</div>
<div class="line"><span class="lineno">  887</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  888</span> </div>
<div class="line"><span class="lineno">  889</span>    <span class="keywordflow">case</span> TAG_EXPOSURE_MODE:</div>
<div class="line"><span class="lineno">  890</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ExposureMode = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  891</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>    <span class="keywordflow">case</span> TAG_ISO_EQUIVALENT:</div>
<div class="line"><span class="lineno">  894</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ISOequivalent = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  895</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  896</span> </div>
<div class="line"><span class="lineno">  897</span>    <span class="keywordflow">case</span> TAG_DIGITALZOOMRATIO:</div>
<div class="line"><span class="lineno">  898</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.DigitalZoomRatio = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  899</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  900</span> </div>
<div class="line"><span class="lineno">  901</span>    <span class="keywordflow">case</span> TAG_THUMBNAIL_OFFSET:</div>
<div class="line"><span class="lineno">  902</span>      ThumbnailOffset      = (unsigned)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  903</span>      DirWithThumbnailPtrs = DirStart;</div>
<div class="line"><span class="lineno">  904</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  905</span> </div>
<div class="line"><span class="lineno">  906</span>    <span class="keywordflow">case</span> TAG_THUMBNAIL_LENGTH:</div>
<div class="line"><span class="lineno">  907</span>      ThumbnailSize = (unsigned)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  908</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ThumbnailSizeOffset = ValuePtr - OffsetBase;</div>
<div class="line"><span class="lineno">  909</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  910</span> </div>
<div class="line"><span class="lineno">  911</span>    <span class="keywordflow">case</span> TAG_EXIF_OFFSET:</div>
<div class="line"><span class="lineno">  912</span>      <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;%s    Exif Dir:&quot;</span>, IndentString);</div>
<div class="line"><span class="lineno">  913</span> </div>
<div class="line"><span class="lineno">  914</span>    <span class="keywordflow">case</span> TAG_INTEROP_OFFSET:</div>
<div class="line"><span class="lineno">  915</span>      <span class="keywordflow">if</span> (Tag == TAG_INTEROP_OFFSET &amp;&amp; ShowTags)</div>
<div class="line"><span class="lineno">  916</span>        printf(<span class="stringliteral">&quot;%s    Interop Dir:&quot;</span>, IndentString);</div>
<div class="line"><span class="lineno">  917</span>      {</div>
<div class="line"><span class="lineno">  918</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *SubdirStart;</div>
<div class="line"><span class="lineno">  919</span>        SubdirStart = OffsetBase + Get32u(ValuePtr);</div>
<div class="line"><span class="lineno">  920</span>        <span class="keywordflow">if</span> (SubdirStart &lt; OffsetBase || SubdirStart &gt; OffsetBase + ExifLength) {</div>
<div class="line"><span class="lineno">  921</span>          std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal Exif or interop ofset directory link&quot;</span></div>
<div class="line"><span class="lineno">  922</span>                    &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  923</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  924</span>          ProcessExifDir(SubdirStart, OffsetBase, ExifLength, NestingLevel + 1);</div>
<div class="line"><span class="lineno">  925</span>        }</div>
<div class="line"><span class="lineno">  926</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  927</span>      }</div>
<div class="line"><span class="lineno">  928</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>    <span class="keywordflow">case</span> TAG_GPSINFO:</div>
<div class="line"><span class="lineno">  931</span>      <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;%s    GPS info dir:&quot;</span>, IndentString);</div>
<div class="line"><span class="lineno">  932</span>      {</div>
<div class="line"><span class="lineno">  933</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *SubdirStart;</div>
<div class="line"><span class="lineno">  934</span>        SubdirStart = OffsetBase + Get32u(ValuePtr);</div>
<div class="line"><span class="lineno">  935</span>        <span class="keywordflow">if</span> (SubdirStart &lt; OffsetBase || SubdirStart &gt; OffsetBase + ExifLength) {</div>
<div class="line"><span class="lineno">  936</span>          std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal GPS directory link in Exif&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  937</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  938</span>          <span class="comment">// ProcessGpsInfo(SubdirStart, OffsetBase, ExifLength);</span></div>
<div class="line"><span class="lineno">  939</span>        }</div>
<div class="line"><span class="lineno">  940</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  941</span>      }</div>
<div class="line"><span class="lineno">  942</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  943</span> </div>
<div class="line"><span class="lineno">  944</span>    <span class="keywordflow">case</span> TAG_FOCALLENGTH_35MM:</div>
<div class="line"><span class="lineno">  945</span>      <span class="comment">// The focal length equivalent 35 mm is a 2.2 tag (defined as of April</span></div>
<div class="line"><span class="lineno">  946</span>      <span class="comment">// 2002)</span></div>
<div class="line"><span class="lineno">  947</span>      <span class="comment">// if its present, use it to compute equivalent focal length instead of</span></div>
<div class="line"><span class="lineno">  948</span>      <span class="comment">// computing it from sensor geometry and actual focal length.</span></div>
<div class="line"><span class="lineno">  949</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.FocalLength35mmEquiv =</div>
<div class="line"><span class="lineno">  950</span>          (unsigned)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  951</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  952</span> </div>
<div class="line"><span class="lineno">  953</span>    <span class="keywordflow">case</span> TAG_DISTANCE_RANGE:</div>
<div class="line"><span class="lineno">  954</span>      <span class="comment">// Three possible standard values:</span></div>
<div class="line"><span class="lineno">  955</span>      <span class="comment">//   1 = macro, 2 = close, 3 = distant</span></div>
<div class="line"><span class="lineno">  956</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.DistanceRange = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  957</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  958</span> </div>
<div class="line"><span class="lineno">  959</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  960</span> </div>
<div class="line"><span class="lineno">  961</span>    <span class="keywordflow">case</span> TAG_X_RESOLUTION:</div>
<div class="line"><span class="lineno">  962</span>      <span class="keywordflow">if</span> (NestingLevel ==</div>
<div class="line"><span class="lineno">  963</span>          0) {  <span class="comment">// Only use the values from the top level directory</span></div>
<div class="line"><span class="lineno">  964</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.xResolution = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  965</span>        <span class="comment">// if yResolution has not been set, use the value of xResolution</span></div>
<div class="line"><span class="lineno">  966</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.yResolution == 0.0)</div>
<div class="line"><span class="lineno">  967</span>          <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.yResolution = <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.xResolution;</div>
<div class="line"><span class="lineno">  968</span>      }</div>
<div class="line"><span class="lineno">  969</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  970</span> </div>
<div class="line"><span class="lineno">  971</span>    <span class="keywordflow">case</span> TAG_Y_RESOLUTION:</div>
<div class="line"><span class="lineno">  972</span>      <span class="keywordflow">if</span> (NestingLevel ==</div>
<div class="line"><span class="lineno">  973</span>          0) {  <span class="comment">// Only use the values from the top level directory</span></div>
<div class="line"><span class="lineno">  974</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.yResolution = (float)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  975</span>        <span class="comment">// if xResolution has not been set, use the value of yResolution</span></div>
<div class="line"><span class="lineno">  976</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="class_image_info.html">ImageInfo</a>.xResolution == 0.0)</div>
<div class="line"><span class="lineno">  977</span>          <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.xResolution = <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.yResolution;</div>
<div class="line"><span class="lineno">  978</span>      }</div>
<div class="line"><span class="lineno">  979</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  980</span> </div>
<div class="line"><span class="lineno">  981</span>    <span class="keywordflow">case</span> TAG_RESOLUTION_UNIT:</div>
<div class="line"><span class="lineno">  982</span>      <span class="keywordflow">if</span> (NestingLevel ==</div>
<div class="line"><span class="lineno">  983</span>          0) {  <span class="comment">// Only use the values from the top level directory</span></div>
<div class="line"><span class="lineno">  984</span>        <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ResolutionUnit = (int)ConvertAnyFormat(ValuePtr, Format);</div>
<div class="line"><span class="lineno">  985</span>      }</div>
<div class="line"><span class="lineno">  986</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  987</span>    }</div>
<div class="line"><span class="lineno">  988</span>  }</div>
<div class="line"><span class="lineno">  989</span> </div>
<div class="line"><span class="lineno">  990</span><span class="preprocessor">#ifdef ReadAllTags</span></div>
<div class="line"><span class="lineno">  991</span>  {</div>
<div class="line"><span class="lineno">  992</span>    <span class="comment">// In addition to linking to subdirectories via exif tags,</span></div>
<div class="line"><span class="lineno">  993</span>    <span class="comment">// there&#39;s also a potential link to another directory at the end of each</span></div>
<div class="line"><span class="lineno">  994</span>    <span class="comment">// directory.  this has got to be the result of a committee!</span></div>
<div class="line"><span class="lineno">  995</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *SubdirStart;</div>
<div class="line"><span class="lineno">  996</span>    <span class="keywordtype">unsigned</span> Offset;</div>
<div class="line"><span class="lineno">  997</span> </div>
<div class="line"><span class="lineno">  998</span>    <span class="keywordflow">if</span> (DIR_ENTRY_ADDR(DirStart, NumDirEntries) + 4 &lt;=</div>
<div class="line"><span class="lineno">  999</span>        OffsetBase + ExifLength) {</div>
<div class="line"><span class="lineno"> 1000</span>      Offset = Get32u(DirStart + 2 + 12 * NumDirEntries);</div>
<div class="line"><span class="lineno"> 1001</span>      <span class="keywordflow">if</span> (Offset) {</div>
<div class="line"><span class="lineno"> 1002</span>        SubdirStart = OffsetBase + Offset;</div>
<div class="line"><span class="lineno"> 1003</span>        <span class="keywordflow">if</span> (SubdirStart &gt; OffsetBase + ExifLength || SubdirStart &lt; OffsetBase) {</div>
<div class="line"><span class="lineno"> 1004</span>          <span class="keywordflow">if</span> (SubdirStart &gt; OffsetBase &amp;&amp;</div>
<div class="line"><span class="lineno"> 1005</span>              SubdirStart &lt; OffsetBase + ExifLength + 20) {</div>
<div class="line"><span class="lineno"> 1006</span>            <span class="comment">// Jhead 1.3 or earlier would crop the whole directory!</span></div>
<div class="line"><span class="lineno"> 1007</span>            <span class="comment">// As Jhead produces this form of format incorrectness,</span></div>
<div class="line"><span class="lineno"> 1008</span>            <span class="comment">// I&#39;ll just let it pass silently</span></div>
<div class="line"><span class="lineno"> 1009</span>            <span class="keywordflow">if</span> (ShowTags)</div>
<div class="line"><span class="lineno"> 1010</span>              printf(<span class="stringliteral">&quot;Thumbnail removed with Jhead 1.3 or earlier\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1011</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1012</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal subdirectory link in Exif header&quot;</span></div>
<div class="line"><span class="lineno"> 1013</span>                      &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno"> 1014</span>          }</div>
<div class="line"><span class="lineno"> 1015</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1016</span>          <span class="keywordflow">if</span> (SubdirStart &lt;= OffsetBase + ExifLength) {</div>
<div class="line"><span class="lineno"> 1017</span>            <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;%s    Continued directory &quot;</span>, IndentString);</div>
<div class="line"><span class="lineno"> 1018</span>            ProcessExifDir(SubdirStart, OffsetBase, ExifLength,</div>
<div class="line"><span class="lineno"> 1019</span>                           NestingLevel + 1);</div>
<div class="line"><span class="lineno"> 1020</span>          }</div>
<div class="line"><span class="lineno"> 1021</span>        }</div>
<div class="line"><span class="lineno"> 1022</span>        <span class="keywordflow">if</span> (Offset &gt; <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.LargestExifOffset) {</div>
<div class="line"><span class="lineno"> 1023</span>          <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.LargestExifOffset = Offset;</div>
<div class="line"><span class="lineno"> 1024</span>        }</div>
<div class="line"><span class="lineno"> 1025</span>      }</div>
<div class="line"><span class="lineno"> 1026</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1027</span>      <span class="comment">// The exif header ends before the last next directory pointer.</span></div>
<div class="line"><span class="lineno"> 1028</span>    }</div>
<div class="line"><span class="lineno"> 1029</span>  }</div>
<div class="line"><span class="lineno"> 1030</span> </div>
<div class="line"><span class="lineno"> 1031</span>  <span class="keywordflow">if</span> (ThumbnailOffset) {</div>
<div class="line"><span class="lineno"> 1032</span>    <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ThumbnailAtEnd = FALSE;</div>
<div class="line"><span class="lineno"> 1033</span> </div>
<div class="line"><span class="lineno"> 1034</span>    <span class="keywordflow">if</span> (DumpExifMap) {</div>
<div class="line"><span class="lineno"> 1035</span>      printf(<span class="stringliteral">&quot;Map: %05d-%05d: Thumbnail\n&quot;</span>, ThumbnailOffset,</div>
<div class="line"><span class="lineno"> 1036</span>             ThumbnailOffset + ThumbnailSize);</div>
<div class="line"><span class="lineno"> 1037</span>    }</div>
<div class="line"><span class="lineno"> 1038</span> </div>
<div class="line"><span class="lineno"> 1039</span>    <span class="keywordflow">if</span> (ThumbnailOffset &lt;= ExifLength) {</div>
<div class="line"><span class="lineno"> 1040</span>      <span class="keywordflow">if</span> (ThumbnailSize &gt; ExifLength - ThumbnailOffset) {</div>
<div class="line"><span class="lineno"> 1041</span>        <span class="comment">// If thumbnail extends past exif header, only save the part that</span></div>
<div class="line"><span class="lineno"> 1042</span>        <span class="comment">// actually exists.  Canon&#39;s EOS viewer utility will do this - the</span></div>
<div class="line"><span class="lineno"> 1043</span>        <span class="comment">// thumbnail extracts ok with this hack.</span></div>
<div class="line"><span class="lineno"> 1044</span>        ThumbnailSize = ExifLength - ThumbnailOffset;</div>
<div class="line"><span class="lineno"> 1045</span>        <span class="keywordflow">if</span> (ShowTags) printf(<span class="stringliteral">&quot;Thumbnail incorrectly placed in header\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1046</span>      }</div>
<div class="line"><span class="lineno"> 1047</span>      <span class="comment">// The thumbnail pointer appears to be valid.  Store it.</span></div>
<div class="line"><span class="lineno"> 1048</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ThumbnailOffset = ThumbnailOffset;</div>
<div class="line"><span class="lineno"> 1049</span>      <a class="code hl_class" href="class_image_info.html">ImageInfo</a>.ThumbnailSize   = ThumbnailSize;</div>
<div class="line"><span class="lineno"> 1050</span> </div>
<div class="line"><span class="lineno"> 1051</span>      <span class="keywordflow">if</span> (ShowTags) {</div>
<div class="line"><span class="lineno"> 1052</span>        printf(<span class="stringliteral">&quot;Thumbnail size: %u bytes\n&quot;</span>, ThumbnailSize);</div>
<div class="line"><span class="lineno"> 1053</span>      }</div>
<div class="line"><span class="lineno"> 1054</span>    }</div>
<div class="line"><span class="lineno"> 1055</span>  }</div>
<div class="line"><span class="lineno"> 1056</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1057</span>}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>E:/opentoonz/toonz/sources/include/<a class="el" href="">tiio_jpg_exif.h</a></li>
<li>E:/opentoonz/toonz/sources/common/tiio/<a class="el" href="">tiio_jpg_exif.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
