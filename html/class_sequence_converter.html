<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: SequenceConverter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="class_sequence_converter-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">SequenceConverter Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter_1_1_length.html">Length</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abb2012ec8f1a334a835d5420b9c3b87d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#abb2012ec8f1a334a835d5420b9c3b87d">SequenceConverter</a> (const <a class="el" href="class_sequence.html">Sequence</a> *s, double penalty)</td></tr>
<tr class="separator:abb2012ec8f1a334a835d5420b9c3b87d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3533ede153098135301d98a89a286a39"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_sequence_converter_1_1_length.html">Length</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a3533ede153098135301d98a89a286a39">lengthOf</a> (unsigned int a, unsigned int b)</td></tr>
<tr class="separator:a3533ede153098135301d98a89a286a39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a297b9565fd375f3dc53e459f5dd35c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a0a297b9565fd375f3dc53e459f5dd35c">addMiddlePoints</a> ()</td></tr>
<tr class="separator:a0a297b9565fd375f3dc53e459f5dd35c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7947b4886d20cff6f6a385da4cab45e4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_stroke.html">TStroke</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a7947b4886d20cff6f6a385da4cab45e4">operator()</a> (std::vector&lt; unsigned int &gt; *indices)</td></tr>
<tr class="separator:a7947b4886d20cff6f6a385da4cab45e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4baf8d1e55a29dcb3c84022a8f0362cd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a4baf8d1e55a29dcb3c84022a8f0362cd">parametrize</a> (unsigned int a, unsigned int b)</td></tr>
<tr class="separator:a4baf8d1e55a29dcb3c84022a8f0362cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2830ce75dabec0c5943fc7f5b08a747f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a2830ce75dabec0c5943fc7f5b08a747f">lengthOfTriplet</a> (unsigned int i, <a class="el" href="class_sequence_converter_1_1_length.html">Length</a> &amp;len)</td></tr>
<tr class="separator:a2830ce75dabec0c5943fc7f5b08a747f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab24dca004dd508f6eeb3f1a73b549c66"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#ab24dca004dd508f6eeb3f1a73b549c66">calculateCPs</a> (unsigned int i, unsigned int j, <a class="el" href="class_sequence_converter_1_1_length.html">Length</a> &amp;len)</td></tr>
<tr class="separator:ab24dca004dd508f6eeb3f1a73b549c66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae122a7edc0cdd42bb0fe14470ff5062f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#ae122a7edc0cdd42bb0fe14470ff5062f">penalty</a> (unsigned int a, unsigned int b, <a class="el" href="class_sequence_converter_1_1_length.html">Length</a> &amp;len)</td></tr>
<tr class="separator:ae122a7edc0cdd42bb0fe14470ff5062f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a324f82f3da1894ef62bd04d9efa493a0"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a324f82f3da1894ef62bd04d9efa493a0">middle</a></td></tr>
<tr class="separator:a324f82f3da1894ef62bd04d9efa493a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b072706c715e96fe5fff9c2ebdee403"><td class="memItemLeft" align="right" valign="top">std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a1b072706c715e96fe5fff9c2ebdee403">pars</a></td></tr>
<tr class="separator:a1b072706c715e96fe5fff9c2ebdee403"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09a85bc0f7525ba977f92541040de72a"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_t3_d_point_t.html">T3DPointD</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a09a85bc0f7525ba977f92541040de72a">middleAddedSequence</a></td></tr>
<tr class="separator:a09a85bc0f7525ba977f92541040de72a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3734330bd4232584eea23f5c054d4824"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sequence_converter.html#a3734330bd4232584eea23f5c054d4824">inputIndices</a></td></tr>
<tr class="separator:a3734330bd4232584eea23f5c054d4824"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"></div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="abb2012ec8f1a334a835d5420b9c3b87d" name="abb2012ec8f1a334a835d5420b9c3b87d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb2012ec8f1a334a835d5420b9c3b87d">&#9670;&nbsp;</a></span>SequenceConverter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SequenceConverter::SequenceConverter </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_sequence.html">Sequence</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>penalty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  234</span>      : m_s(s), m_graph(m_s-&gt;m_graphHolder), m_penalty(penalty) {}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0a297b9565fd375f3dc53e459f5dd35c" name="a0a297b9565fd375f3dc53e459f5dd35c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a297b9565fd375f3dc53e459f5dd35c">&#9670;&nbsp;</a></span>addMiddlePoints()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SequenceConverter::addMiddlePoints </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  261</span>                                               {</div>
<div class="line"><span class="lineno">  262</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j, n;</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>  n = inputIndices-&gt;size();</div>
<div class="line"><span class="lineno">  265</span>  middleAddedSequence.clear();</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>  <span class="keywordflow">if</span> (n == 2) {</div>
<div class="line"><span class="lineno">  268</span>    middleAddedSequence.resize(3);</div>
<div class="line"><span class="lineno">  269</span>    middleAddedSequence[0] = *m_graph-&gt;getNode((*inputIndices)[0]);</div>
<div class="line"><span class="lineno">  270</span>    middleAddedSequence[1] = (*m_graph-&gt;getNode((*inputIndices)[0]) +</div>
<div class="line"><span class="lineno">  271</span>                              *m_graph-&gt;getNode((*inputIndices)[1])) *</div>
<div class="line"><span class="lineno">  272</span>                             0.5;</div>
<div class="line"><span class="lineno">  273</span>    middleAddedSequence[2] = *m_graph-&gt;getNode((*inputIndices)[1]);</div>
<div class="line"><span class="lineno">  274</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  275</span>    middleAddedSequence.resize(2 * n - 3);</div>
<div class="line"><span class="lineno">  276</span>    middleAddedSequence[0] = *m_graph-&gt;getNode((*inputIndices)[0]);</div>
<div class="line"><span class="lineno">  277</span>    <span class="keywordflow">for</span> (i = j = 1; i &lt; n - 2; ++i, j += 2) {</div>
<div class="line"><span class="lineno">  278</span>      middleAddedSequence[j]     = *m_graph-&gt;getNode((*inputIndices)[i]);</div>
<div class="line"><span class="lineno">  279</span>      middleAddedSequence[j + 1] = (*m_graph-&gt;getNode((*inputIndices)[i]) +</div>
<div class="line"><span class="lineno">  280</span>                                    *m_graph-&gt;getNode((*inputIndices)[i + 1])) *</div>
<div class="line"><span class="lineno">  281</span>                                   0.5;</div>
<div class="line"><span class="lineno">  282</span>    }</div>
<div class="line"><span class="lineno">  283</span>    middleAddedSequence[j]     = *m_graph-&gt;getNode((*inputIndices)[n - 2]);</div>
<div class="line"><span class="lineno">  284</span>    middleAddedSequence[j + 1] = *m_graph-&gt;getNode((*inputIndices)[n - 1]);</div>
<div class="line"><span class="lineno">  285</span>  }</div>
<div class="line"><span class="lineno">  286</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab24dca004dd508f6eeb3f1a73b549c66" name="ab24dca004dd508f6eeb3f1a73b549c66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab24dca004dd508f6eeb3f1a73b549c66">&#9670;&nbsp;</a></span>calculateCPs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SequenceConverter::calculateCPs </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_sequence_converter_1_1_length.html">Length</a> &amp;&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  453</span>                                                  {</div>
<div class="line"><span class="lineno">  454</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curr, old;</div>
<div class="line"><span class="lineno">  455</span> </div>
<div class="line"><span class="lineno">  456</span>  <a class="code hl_class" href="class_t_affine.html">TAffine</a> M;</div>
<div class="line"><span class="lineno">  457</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> l;</div>
<div class="line"><span class="lineno">  458</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> a, e, x, y, A, B;</div>
<div class="line"><span class="lineno">  459</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> IH, IK, IM, IN_;  <span class="comment">//&quot;IN&quot; seems to be reserved word</span></div>
<div class="line"><span class="lineno">  460</span>  <span class="keywordtype">double</span> HxL, KyL, MxO, NyO;</div>
<div class="line"><span class="lineno">  461</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k;</div>
<div class="line"><span class="lineno">  462</span> </div>
<div class="line"><span class="lineno">  463</span>  a = middleAddedSequence[i];</div>
<div class="line"><span class="lineno">  464</span>  e = middleAddedSequence[j];</div>
<div class="line"><span class="lineno">  465</span>  x = middleAddedSequence[i + 1] - a;</div>
<div class="line"><span class="lineno">  466</span>  y = middleAddedSequence[j - 1] - e;</div>
<div class="line"><span class="lineno">  467</span> </div>
<div class="line"><span class="lineno">  468</span>  <span class="comment">// Build TAffine M</span></div>
<div class="line"><span class="lineno">  469</span>  <span class="keywordtype">double</span> par = ellProd(x, y) / 5;</div>
<div class="line"><span class="lineno">  470</span>  M          = <a class="code hl_class" href="class_t_affine.html">TAffine</a>(ellProd(x, x) / 3, par, 0, par, ellProd(y, y) / 3, 0);</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>  <span class="comment">// Costruisco il termine noto b:</span></div>
<div class="line"><span class="lineno">  473</span>  <span class="comment">// Calculate polygonal integrals</span></div>
<div class="line"><span class="lineno">  474</span> </div>
<div class="line"><span class="lineno">  475</span>  <span class="comment">// Integral from 0.0 to 1.0</span></div>
<div class="line"><span class="lineno">  476</span>  <span class="keywordflow">for</span> (k = 0, old = i, curr = i + 1; k &lt; middle; ++k, old = curr, curr += 2) {</div>
<div class="line"><span class="lineno">  477</span>    B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  478</span>        (1 / (pars[k + 1] - pars[k]));</div>
<div class="line"><span class="lineno">  479</span>    A = middleAddedSequence[old] - pars[k] * B;</div>
<div class="line"><span class="lineno">  480</span>    IH += int_H(A, B, pars[k], pars[k + 1]);</div>
<div class="line"><span class="lineno">  481</span>    IK += int_K(A, B, pars[k], pars[k + 1]);</div>
<div class="line"><span class="lineno">  482</span>  }</div>
<div class="line"><span class="lineno">  483</span> </div>
<div class="line"><span class="lineno">  484</span>  <span class="keywordflow">if</span> (curr == j + 1) curr = j;</div>
<div class="line"><span class="lineno">  485</span>  B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  486</span>      (1 / (pars[k + 1] - pars[k]));</div>
<div class="line"><span class="lineno">  487</span>  A = middleAddedSequence[old] - pars[k] * B;</div>
<div class="line"><span class="lineno">  488</span>  IH += int_H(A, B, pars[k], 1.0);</div>
<div class="line"><span class="lineno">  489</span>  IK += int_K(A, B, pars[k], 1.0);</div>
<div class="line"><span class="lineno">  490</span> </div>
<div class="line"><span class="lineno">  491</span>  <span class="comment">// Integral from 1.0 to 2.0</span></div>
<div class="line"><span class="lineno">  492</span>  <span class="keywordflow">for</span> (k = pars.size() - 1, old = j, curr = j - 1; k &gt; middle + 1;</div>
<div class="line"><span class="lineno">  493</span>       --k, old = curr, curr -= 2) {</div>
<div class="line"><span class="lineno">  494</span>    B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  495</span>        (1 / (pars[k] - pars[k - 1]));</div>
<div class="line"><span class="lineno">  496</span>    A = middleAddedSequence[curr] - (2 - pars[k - 1]) * B;</div>
<div class="line"><span class="lineno">  497</span>    IM += int_K(A, B, 2 - pars[k], 2 - pars[k - 1]);</div>
<div class="line"><span class="lineno">  498</span>    IN_ += int_H(A, B, 2 - pars[k], 2 - pars[k - 1]);</div>
<div class="line"><span class="lineno">  499</span>  }</div>
<div class="line"><span class="lineno">  500</span> </div>
<div class="line"><span class="lineno">  501</span>  <span class="keywordflow">if</span> (old == i + 1) curr = i;</div>
<div class="line"><span class="lineno">  502</span>  B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  503</span>      (1 / (pars[k] - pars[k - 1]));</div>
<div class="line"><span class="lineno">  504</span>  A = middleAddedSequence[curr] - (2 - pars[k - 1]) * B;</div>
<div class="line"><span class="lineno">  505</span>  IM += int_K(A, B, 2 - pars[k], 1.0);</div>
<div class="line"><span class="lineno">  506</span>  IN_ += int_H(A, B, 2 - pars[k], 1.0);</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>  <span class="comment">// Polygonal-free integrals</span></div>
<div class="line"><span class="lineno">  509</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> f = (a + e) * 0.5;</div>
<div class="line"><span class="lineno">  510</span>  HxL         = (ellProd(a, x) * 0.3) + (ellProd(f, x) / 5.0);</div>
<div class="line"><span class="lineno">  511</span>  NyO         = (ellProd(e, y) * 0.3) + (ellProd(f, y) / 5.0);</div>
<div class="line"><span class="lineno">  512</span>  KyL         = (ellProd(a, y) / 15.0) + (ellProd(f, y) / 10.0);</div>
<div class="line"><span class="lineno">  513</span>  MxO         = ((e * x) / 15.0) + (ellProd(f, x) / 10.0);</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>  <span class="comment">// Infine, ho il termine noto</span></div>
<div class="line"><span class="lineno">  516</span>  l = <a class="code hl_class" href="class_t_point_t.html">TPointD</a>(ellProd(IH, x) - HxL + ellProd(IM, x) - MxO,</div>
<div class="line"><span class="lineno">  517</span>              ellProd(IK, y) - KyL + ellProd(IN_, y) - NyO);</div>
<div class="line"><span class="lineno">  518</span>  M.a13 = -l.x;</div>
<div class="line"><span class="lineno">  519</span>  M.a23 = -l.y;</div>
<div class="line"><span class="lineno">  520</span> </div>
<div class="line"><span class="lineno">  521</span>  <span class="comment">// Check validity conditions:</span></div>
<div class="line"><span class="lineno">  522</span>  <span class="comment">//  a) System is not singular</span></div>
<div class="line"><span class="lineno">  523</span>  <span class="keywordflow">if</span> (fabs(M.det()) &lt; 0.01) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>  M = M.<a class="code hl_function" href="class_t_affine.html#a570529b96b1ec5abc711aaa9aac09ff9">inv</a>();</div>
<div class="line"><span class="lineno">  526</span> </div>
<div class="line"><span class="lineno">  527</span>  <span class="comment">//  b) Shift (solution) is positive</span></div>
<div class="line"><span class="lineno">  528</span>  <span class="keywordflow">if</span> (M.a13 &lt; 0 || M.a23 &lt; 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  529</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> b = a + M.a13 * x;</div>
<div class="line"><span class="lineno">  530</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> d = e + M.a23 * y;</div>
<div class="line"><span class="lineno">  531</span> </div>
<div class="line"><span class="lineno">  532</span>  <span class="comment">//  c) The height of every CP must be &gt;=0</span></div>
<div class="line"><span class="lineno">  533</span>  <span class="keywordflow">if</span> (b.z &lt; 0 || d.z &lt; 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  534</span>  len.set_CPs(a, b, (b + d) * 0.5, d, e);</div>
<div class="line"><span class="lineno">  535</span> </div>
<div class="line"><span class="lineno">  536</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  537</span>}</div>
<div class="ttc" id="aclass_t3_d_point_t_html"><div class="ttname"><a href="class_t3_d_point_t.html">T3DPointT&lt; double &gt;</a></div></div>
<div class="ttc" id="aclass_t_affine_html"><div class="ttname"><a href="class_t_affine.html">TAffine</a></div><div class="ttdoc">This is the base class for the affine transformations.</div><div class="ttdef"><b>Definition:</b> tgeometry.h:864</div></div>
<div class="ttc" id="aclass_t_affine_html_a570529b96b1ec5abc711aaa9aac09ff9"><div class="ttname"><a href="class_t_affine.html#a570529b96b1ec5abc711aaa9aac09ff9">TAffine::inv</a></div><div class="ttdeci">TAffine inv() const</div><div class="ttdef"><b>Definition:</b> tgeometry.cpp:55</div></div>
<div class="ttc" id="aclass_t_point_t_html"><div class="ttname"><a href="class_t_point_t.html">TPointT&lt; double &gt;</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3533ede153098135301d98a89a286a39" name="a3533ede153098135301d98a89a286a39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3533ede153098135301d98a89a286a39">&#9670;&nbsp;</a></span>lengthOf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_sequence_converter_1_1_length.html">SequenceConverter::Length</a> SequenceConverter::lengthOf </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  353</span>                                                                      {</div>
<div class="line"><span class="lineno">  354</span>  Length l;</div>
<div class="line"><span class="lineno">  355</span> </div>
<div class="line"><span class="lineno">  356</span>  <span class="comment">// If we have a triplet, apply a specific procedure</span></div>
<div class="line"><span class="lineno">  357</span>  <span class="keywordflow">if</span> (b == a + 2) {</div>
<div class="line"><span class="lineno">  358</span>    lengthOfTriplet(a, l);</div>
<div class="line"><span class="lineno">  359</span>    <span class="keywordflow">return</span> l;</div>
<div class="line"><span class="lineno">  360</span>  }</div>
<div class="line"><span class="lineno">  361</span>  <span class="comment">// otherwise</span></div>
<div class="line"><span class="lineno">  362</span>  <span class="keywordflow">if</span> (!parametrize(a, b) || !calculateCPs(a, b, l) || !penalty(a, b, l))</div>
<div class="line"><span class="lineno">  363</span>    l.infty();</div>
<div class="line"><span class="lineno">  364</span>  <span class="keywordflow">return</span> l;</div>
<div class="line"><span class="lineno">  365</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2830ce75dabec0c5943fc7f5b08a747f" name="a2830ce75dabec0c5943fc7f5b08a747f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2830ce75dabec0c5943fc7f5b08a747f">&#9670;&nbsp;</a></span>lengthOfTriplet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SequenceConverter::lengthOfTriplet </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_sequence_converter_1_1_length.html">Length</a> &amp;&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  369</span>                                                                   {</div>
<div class="line"><span class="lineno">  370</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> A = middleAddedSequence[i];</div>
<div class="line"><span class="lineno">  371</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> B = middleAddedSequence[i + 1];</div>
<div class="line"><span class="lineno">  372</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> C = middleAddedSequence[i + 2];</div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>  <span class="comment">// We assume that this conversion is faithful, avoiding length penalty</span></div>
<div class="line"><span class="lineno">  375</span>  len.l    = 0;</div>
<div class="line"><span class="lineno">  376</span>  <span class="keywordtype">double</span> d = tdistance(B, C - A, A);</div>
<div class="line"><span class="lineno">  377</span>  <span class="keywordflow">if</span> (d &lt;= 2) {</div>
<div class="line"><span class="lineno">  378</span>    len.n = 1;</div>
<div class="line"><span class="lineno">  379</span>    len.set_CPs(A, B, C);</div>
<div class="line"><span class="lineno">  380</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d &lt;= 6) {</div>
<div class="line"><span class="lineno">  381</span>    len.n       = 2;</div>
<div class="line"><span class="lineno">  382</span>    d           = (d - 1) / d;</div>
<div class="line"><span class="lineno">  383</span>    <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> U = A + d * (B - A), V = C + d * (B - C);</div>
<div class="line"><span class="lineno">  384</span>    len.set_CPs(A, U, (U + V) * 0.5, V, C);</div>
<div class="line"><span class="lineno">  385</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  386</span>    len.n = 2;</div>
<div class="line"><span class="lineno">  387</span>    len.set_CPs(A, (A + B) * 0.5, B, (B + C) * 0.5, C);</div>
<div class="line"><span class="lineno">  388</span>  }</div>
<div class="line"><span class="lineno">  389</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7947b4886d20cff6f6a385da4cab45e4" name="a7947b4886d20cff6f6a385da4cab45e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7947b4886d20cff6f6a385da4cab45e4">&#9670;&nbsp;</a></span>operator()()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_stroke.html">TStroke</a> * SequenceConverter::operator() </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; *&#160;</td>
          <td class="paramname"><em>indices</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  290</span>                                                                       {</div>
<div class="line"><span class="lineno">  291</span>  <span class="comment">// Prepare Sequence</span></div>
<div class="line"><span class="lineno">  292</span>  inputIndices = indices;</div>
<div class="line"><span class="lineno">  293</span>  addMiddlePoints();</div>
<div class="line"><span class="lineno">  294</span> </div>
<div class="line"><span class="lineno">  295</span>  <span class="comment">// Initialize local variables</span></div>
<div class="line"><span class="lineno">  296</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n =</div>
<div class="line"><span class="lineno">  297</span>      (middleAddedSequence.size() + 1) / 2;  <span class="comment">// Number of middle points</span></div>
<div class="line"><span class="lineno">  298</span>  <span class="comment">// unsigned int i, j;</span></div>
<div class="line"><span class="lineno">  299</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  300</span>  <span class="keywordtype">int</span> j;</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>  Length L_att, L_min, l_min, l_ji;</div>
<div class="line"><span class="lineno">  303</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p_i, a, b;</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>  std::vector&lt;Length&gt; M(n);</div>
<div class="line"><span class="lineno">  306</span>  std::vector&lt;Length&gt; K(n);</div>
<div class="line"><span class="lineno">  307</span>  std::vector&lt;unsigned int&gt; P(n);</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>  <span class="comment">// Bellman algorithm</span></div>
<div class="line"><span class="lineno">  310</span>  <span class="keywordflow">for</span> (i = 2, a = 1; i &lt; middleAddedSequence.size(); i += 2, ++a) {</div>
<div class="line"><span class="lineno">  311</span>    L_min.infty();</div>
<div class="line"><span class="lineno">  312</span>    l_min.infty();</div>
<div class="line"><span class="lineno">  313</span>    p_i = 0;</div>
<div class="line"><span class="lineno">  314</span>    <span class="comment">// for(j=0, b=0; j&lt;i; j+=2, ++b)</span></div>
<div class="line"><span class="lineno">  315</span>    <span class="keywordflow">for</span> (j = i - 2, b = j / 2; j &gt;= 0; j -= 2, --b) {</div>
<div class="line"><span class="lineno">  316</span>      <span class="keywordflow">if</span> ((L_att = M[b] + (l_ji = lengthOf(j, i))) &lt; L_min) {</div>
<div class="line"><span class="lineno">  317</span>        L_min = L_att;</div>
<div class="line"><span class="lineno">  318</span>        p_i   = b;</div>
<div class="line"><span class="lineno">  319</span>        l_min = l_ji;</div>
<div class="line"><span class="lineno">  320</span>      }</div>
<div class="line"><span class="lineno">  321</span>      <span class="comment">// NOTE: The following else may be taken out to perform a deeper</span></div>
<div class="line"><span class="lineno">  322</span>      <span class="comment">// search for optimal result. However, it prevents quadratic complexities</span></div>
<div class="line"><span class="lineno">  323</span>      <span class="comment">// on large-scale images.</span></div>
<div class="line"><span class="lineno">  324</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l_ji.n == infinity)</div>
<div class="line"><span class="lineno">  325</span>        <span class="keywordflow">break</span>;  <span class="comment">// Stops searching for current i</span></div>
<div class="line"><span class="lineno">  326</span>    }</div>
<div class="line"><span class="lineno">  327</span>    M[a] = L_min;</div>
<div class="line"><span class="lineno">  328</span>    K[a] = l_min;</div>
<div class="line"><span class="lineno">  329</span>    P[a] = p_i;</div>
<div class="line"><span class="lineno">  330</span>  }</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>  <span class="comment">// Read off the output</span></div>
<div class="line"><span class="lineno">  333</span>  std::vector&lt;TThickPoint&gt; controlPoints(2 * M[n - 1].n + 1);</div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>  <span class="keywordflow">for</span> (b = n - 1, a = 2 * M[n - 1].n; b &gt; 0; b = P[b]) {</div>
<div class="line"><span class="lineno">  336</span>    <span class="keywordflow">for</span> (i             = K[b].CPs.size() - 1; i &gt; 0; --i, --a)</div>
<div class="line"><span class="lineno">  337</span>      controlPoints[a] = K[b].CPs[i];</div>
<div class="line"><span class="lineno">  338</span>  }</div>
<div class="line"><span class="lineno">  339</span>  controlPoints[0] = middleAddedSequence[0];</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>  <a class="code hl_struct" href="class_t_stroke.html">TStroke</a> *res = <span class="keyword">new</span> <a class="code hl_struct" href="class_t_stroke.html">TStroke</a>(controlPoints);</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>  <span class="keywordflow">return</span> res;</div>
<div class="line"><span class="lineno">  344</span>}</div>
<div class="ttc" id="aclass_t_stroke_html"><div class="ttname"><a href="class_t_stroke.html">TStroke</a></div><div class="ttdef"><b>Definition:</b> tstroke.h:47</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4baf8d1e55a29dcb3c84022a8f0362cd" name="a4baf8d1e55a29dcb3c84022a8f0362cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4baf8d1e55a29dcb3c84022a8f0362cd">&#9670;&nbsp;</a></span>parametrize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SequenceConverter::parametrize </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  393</span>                                                                  {</div>
<div class="line"><span class="lineno">  394</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curr, old;</div>
<div class="line"><span class="lineno">  395</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  396</span>  <span class="keywordtype">double</span> w, t;</div>
<div class="line"><span class="lineno">  397</span>  <span class="keywordtype">double</span> den;</div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>  pars.clear();</div>
<div class="line"><span class="lineno">  400</span>  pars.push_back(0);</div>
<div class="line"><span class="lineno">  401</span> </div>
<div class="line"><span class="lineno">  402</span>  <span class="keywordflow">for</span> (old = a, curr = a + 1, den = 0; curr &lt; b; old = curr, curr += 2) {</div>
<div class="line"><span class="lineno">  403</span>    w = norm(middleAddedSequence[curr] - middleAddedSequence[old]);</div>
<div class="line"><span class="lineno">  404</span>    den += w;</div>
<div class="line"><span class="lineno">  405</span>    pars.push_back(w);</div>
<div class="line"><span class="lineno">  406</span>  }</div>
<div class="line"><span class="lineno">  407</span>  w = norm(middleAddedSequence[b] - middleAddedSequence[old]);</div>
<div class="line"><span class="lineno">  408</span>  den += w;</div>
<div class="line"><span class="lineno">  409</span>  pars.push_back(w);</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>  <span class="keywordflow">if</span> (den &lt; 0.1) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>  <span class="keywordflow">for</span> (i = 1, t = 0; i &lt; pars.size(); ++i) {</div>
<div class="line"><span class="lineno">  414</span>    t += 2 * pars[i] / den;</div>
<div class="line"><span class="lineno">  415</span>    pars[i] = t;</div>
<div class="line"><span class="lineno">  416</span>  }</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>  <span class="comment">// Seek the interval which holds 1 - the middle interval</span></div>
<div class="line"><span class="lineno">  419</span>  <span class="keywordflow">for</span> (middle = 0; middle &lt; pars.size() &amp;&amp; pars[middle + 1] &lt;= 1; ++middle)</div>
<div class="line"><span class="lineno">  420</span>    ;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  423</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae122a7edc0cdd42bb0fe14470ff5062f" name="ae122a7edc0cdd42bb0fe14470ff5062f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae122a7edc0cdd42bb0fe14470ff5062f">&#9670;&nbsp;</a></span>penalty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SequenceConverter::penalty </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_sequence_converter_1_1_length.html">Length</a> &amp;&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  581</span>                                                                           {</div>
<div class="line"><span class="lineno">  582</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curr, old;</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>  <span class="keyword">const</span> std::vector&lt;T3DPointD&gt; &amp;CPs = len.CPs;</div>
<div class="line"><span class="lineno">  585</span>  <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a> A, B, P0, P1, P2;</div>
<div class="line"><span class="lineno">  586</span>  <span class="keywordtype">double</span> p, p_max;</div>
<div class="line"><span class="lineno">  587</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k;</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>  len.n = 2;  <span class="comment">// A couple of arcs</span></div>
<div class="line"><span class="lineno">  590</span> </div>
<div class="line"><span class="lineno">  591</span>  <span class="comment">// Prepare max penalty p_max</span></div>
<div class="line"><span class="lineno">  592</span>  p_max = 0;</div>
<div class="line"><span class="lineno">  593</span>  <span class="keywordflow">for</span> (curr = a + 1, old = a, k = 0; curr &lt; b; ++k, old = curr, curr += 2) {</div>
<div class="line"><span class="lineno">  594</span>    p_max += (middleAddedSequence[curr].z + middleAddedSequence[old].z) *</div>
<div class="line"><span class="lineno">  595</span>             (pars[k + 1] - pars[k]) / 2;</div>
<div class="line"><span class="lineno">  596</span>  }</div>
<div class="line"><span class="lineno">  597</span>  p_max += (middleAddedSequence[b].z + middleAddedSequence[old].z) *</div>
<div class="line"><span class="lineno">  598</span>           (pars[k + 1] - pars[k]) / 2;</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>  <span class="comment">// Confronting 4th power of error with mean polygonal thickness</span></div>
<div class="line"><span class="lineno">  601</span>  <span class="comment">// - can be changed</span></div>
<div class="line"><span class="lineno">  602</span>  p_max = std::min(sqrt(p_max) * m_penalty, Quad_eps_max);</div>
<div class="line"><span class="lineno">  603</span> </div>
<div class="line"><span class="lineno">  604</span>  <span class="comment">// CP only integral</span></div>
<div class="line"><span class="lineno">  605</span>  p = (ellProd(CPs[0], CPs[0]) + 2 * ellProd(CPs[2], CPs[2]) +</div>
<div class="line"><span class="lineno">  606</span>       ellProd(CPs[4], CPs[4]) + ellProd(CPs[0], CPs[1]) +</div>
<div class="line"><span class="lineno">  607</span>       ellProd(CPs[1], CPs[2]) + ellProd(CPs[2], CPs[3]) +</div>
<div class="line"><span class="lineno">  608</span>       ellProd(CPs[3], CPs[4])) /</div>
<div class="line"><span class="lineno">  609</span>          5.0 +</div>
<div class="line"><span class="lineno">  610</span>      (2 * (ellProd(CPs[1], CPs[1]) + ellProd(CPs[3], CPs[3])) +</div>
<div class="line"><span class="lineno">  611</span>       ellProd(CPs[0], CPs[2]) + ellProd(CPs[2], CPs[4])) /</div>
<div class="line"><span class="lineno">  612</span>          15.0;</div>
<div class="line"><span class="lineno">  613</span> </div>
<div class="line"><span class="lineno">  614</span>  <span class="comment">// Penalty from 0.0 to 1.0</span></div>
<div class="line"><span class="lineno">  615</span>  P0 = P1 = P2 = <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a>();</div>
<div class="line"><span class="lineno">  616</span>  <span class="keywordflow">for</span> (k = 0, old = a, curr = a + 1; k &lt; middle; ++k, old = curr, curr += 2) {</div>
<div class="line"><span class="lineno">  617</span>    B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  618</span>        (1 / (pars[k + 1] - pars[k]));</div>
<div class="line"><span class="lineno">  619</span>    A = middleAddedSequence[old] - pars[k] * B;</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>    <span class="comment">// Mixed integral</span></div>
<div class="line"><span class="lineno">  622</span>    P0 += int_B0a(A, B, pars[k], pars[k + 1]);</div>
<div class="line"><span class="lineno">  623</span>    P1 += int_B1a(A, B, pars[k], pars[k + 1]);</div>
<div class="line"><span class="lineno">  624</span>    P2 += int_B2a(A, B, pars[k], pars[k + 1]);</div>
<div class="line"><span class="lineno">  625</span> </div>
<div class="line"><span class="lineno">  626</span>    <span class="comment">// Sequence integral</span></div>
<div class="line"><span class="lineno">  627</span>    p += int_a2(A, B, pars[k], pars[k + 1]);</div>
<div class="line"><span class="lineno">  628</span>  }</div>
<div class="line"><span class="lineno">  629</span>  <span class="keywordflow">if</span> (curr == b + 1) curr = b;</div>
<div class="line"><span class="lineno">  630</span>  B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  631</span>      (1 / (pars[k + 1] - pars[k]));</div>
<div class="line"><span class="lineno">  632</span>  A = middleAddedSequence[old] - pars[k] * B;</div>
<div class="line"><span class="lineno">  633</span> </div>
<div class="line"><span class="lineno">  634</span>  <span class="comment">// Mixed integral</span></div>
<div class="line"><span class="lineno">  635</span>  P0 += int_B0a(A, B, pars[k], 1.0);</div>
<div class="line"><span class="lineno">  636</span>  P1 += int_B1a(A, B, pars[k], 1.0);</div>
<div class="line"><span class="lineno">  637</span>  P2 += int_B2a(A, B, pars[k], 1.0);</div>
<div class="line"><span class="lineno">  638</span> </div>
<div class="line"><span class="lineno">  639</span>  <span class="comment">// Sequence integral</span></div>
<div class="line"><span class="lineno">  640</span>  p += int_a2(A, B, pars[k], 1.0);</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>  p -= 2 * (ellProd(P0, CPs[0]) + ellProd(P1, CPs[1]) + ellProd(P2, CPs[2]));</div>
<div class="line"><span class="lineno">  643</span> </div>
<div class="line"><span class="lineno">  644</span>  <span class="comment">// Penalty from 1.0 to 2.0</span></div>
<div class="line"><span class="lineno">  645</span>  P0 = P1 = P2 = <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a>();</div>
<div class="line"><span class="lineno">  646</span>  <span class="keywordflow">for</span> (k = pars.size() - 1, old = b, curr = b - 1; k &gt; middle + 1;</div>
<div class="line"><span class="lineno">  647</span>       --k, old = curr, curr -= 2) {</div>
<div class="line"><span class="lineno">  648</span>    B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  649</span>        (1 / (pars[k] - pars[k - 1]));</div>
<div class="line"><span class="lineno">  650</span>    A = middleAddedSequence[curr] - (2 - pars[k - 1]) * B;</div>
<div class="line"><span class="lineno">  651</span> </div>
<div class="line"><span class="lineno">  652</span>    <span class="comment">// Mixed integral</span></div>
<div class="line"><span class="lineno">  653</span>    P0 += int_B0a(A, B, 2 - pars[k], 2 - pars[k - 1]);</div>
<div class="line"><span class="lineno">  654</span>    P1 += int_B1a(A, B, 2 - pars[k], 2 - pars[k - 1]);</div>
<div class="line"><span class="lineno">  655</span>    P2 += int_B2a(A, B, 2 - pars[k], 2 - pars[k - 1]);</div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>    <span class="comment">// Sequence integral</span></div>
<div class="line"><span class="lineno">  658</span>    p += int_a2(A, B, 2 - pars[k], 2 - pars[k - 1]);</div>
<div class="line"><span class="lineno">  659</span>  }</div>
<div class="line"><span class="lineno">  660</span>  <span class="keywordflow">if</span> (old == a + 1) curr = a;</div>
<div class="line"><span class="lineno">  661</span>  B = (middleAddedSequence[curr] - middleAddedSequence[old]) *</div>
<div class="line"><span class="lineno">  662</span>      (1 / (pars[k] - pars[k - 1]));</div>
<div class="line"><span class="lineno">  663</span>  A = middleAddedSequence[curr] - (2 - pars[k - 1]) * B;</div>
<div class="line"><span class="lineno">  664</span> </div>
<div class="line"><span class="lineno">  665</span>  <span class="comment">// Mixed integral</span></div>
<div class="line"><span class="lineno">  666</span>  P0 += int_B0a(A, B, 2 - pars[k], 1.0);</div>
<div class="line"><span class="lineno">  667</span>  P1 += int_B1a(A, B, 2 - pars[k], 1.0);</div>
<div class="line"><span class="lineno">  668</span>  P2 += int_B2a(A, B, 2 - pars[k], 1.0);</div>
<div class="line"><span class="lineno">  669</span> </div>
<div class="line"><span class="lineno">  670</span>  <span class="comment">// Sequence integral</span></div>
<div class="line"><span class="lineno">  671</span>  p += int_a2(A, B, 2 - pars[k], 1.0);</div>
<div class="line"><span class="lineno">  672</span> </div>
<div class="line"><span class="lineno">  673</span>  p -= 2 * (ellProd(P0, CPs[4]) + ellProd(P1, CPs[3]) + ellProd(P2, CPs[2]));</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>  <span class="comment">// OCCHIO! Ho visto ancora qualche p&lt;0! Da rivedere - non dovrebbe...</span></div>
<div class="line"><span class="lineno">  676</span>  <span class="keywordflow">if</span> (p &gt; p_max || p &lt; 0)</div>
<div class="line"><span class="lineno">  677</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  678</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  679</span>    len.l = p;</div>
<div class="line"><span class="lineno">  680</span> </div>
<div class="line"><span class="lineno">  681</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  682</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a3734330bd4232584eea23f5c054d4824" name="a3734330bd4232584eea23f5c054d4824"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3734330bd4232584eea23f5c054d4824">&#9670;&nbsp;</a></span>inputIndices</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt;* SequenceConverter::inputIndices</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a324f82f3da1894ef62bd04d9efa493a0" name="a324f82f3da1894ef62bd04d9efa493a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a324f82f3da1894ef62bd04d9efa493a0">&#9670;&nbsp;</a></span>middle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int SequenceConverter::middle</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a09a85bc0f7525ba977f92541040de72a" name="a09a85bc0f7525ba977f92541040de72a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09a85bc0f7525ba977f92541040de72a">&#9670;&nbsp;</a></span>middleAddedSequence</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="class_t3_d_point_t.html">T3DPointD</a>&gt; SequenceConverter::middleAddedSequence</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1b072706c715e96fe5fff9c2ebdee403" name="a1b072706c715e96fe5fff9c2ebdee403"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b072706c715e96fe5fff9c2ebdee403">&#9670;&nbsp;</a></span>pars</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;double&gt; SequenceConverter::pars</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>E:/opentoonz/toonz/sources/toonzlib/<a class="el" href="">tcenterlinetostrokes.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
