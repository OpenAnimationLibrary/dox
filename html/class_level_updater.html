<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: LevelUpdater Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_level_updater-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">LevelUpdater Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="">levelupdater.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3e6600955c86b053265de95e87962487"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a3e6600955c86b053265de95e87962487">LevelUpdater</a> (<a class="el" href="class_t_xsh_simple_level.html">TXshSimpleLevel</a> *sl)</td></tr>
<tr class="separator:a3e6600955c86b053265de95e87962487"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7afc45ef620e00acf73018ebdea49a88"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a7afc45ef620e00acf73018ebdea49a88">LevelUpdater</a> (const <a class="el" href="class_t_file_path.html">TFilePath</a> &amp;path, <a class="el" href="class_t_property_group.html">TPropertyGroup</a> *lwProperties=0)</td></tr>
<tr class="separator:a7afc45ef620e00acf73018ebdea49a88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac693a2fd15e4e1c90c58dc43f2d98f34"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_level_writer_p.html">TLevelWriterP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#ac693a2fd15e4e1c90c58dc43f2d98f34">getLevelWriter</a> ()</td></tr>
<tr class="separator:ac693a2fd15e4e1c90c58dc43f2d98f34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6de4b9714e2a634b56662942b5491e89"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_level_reader_p.html">TLevelReaderP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a6de4b9714e2a634b56662942b5491e89">getLevelReader</a> ()</td></tr>
<tr class="separator:a6de4b9714e2a634b56662942b5491e89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4e37712c438721567ec67c7c6531336"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_level_p.html">TLevelP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#aa4e37712c438721567ec67c7c6531336">getInputLevel</a> ()</td></tr>
<tr class="separator:aa4e37712c438721567ec67c7c6531336"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3764faba4483754996136841c54c0871"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="class_t_image_info.html">TImageInfo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a3764faba4483754996136841c54c0871">getImageInfo</a> ()</td></tr>
<tr class="memdesc:a3764faba4483754996136841c54c0871"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the image properties of the updated level, if one already exists.  <a href="class_level_updater.html#a3764faba4483754996136841c54c0871">More...</a><br /></td></tr>
<tr class="separator:a3764faba4483754996136841c54c0871"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af42de29721580f485bc92e15d399af36"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#af42de29721580f485bc92e15d399af36">open</a> (const <a class="el" href="class_t_file_path.html">TFilePath</a> &amp;src, <a class="el" href="class_t_property_group.html">TPropertyGroup</a> *lwProperties)</td></tr>
<tr class="separator:af42de29721580f485bc92e15d399af36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a655c62c9e4d039c2a0fdb0206645fbd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a655c62c9e4d039c2a0fdb0206645fbd8">open</a> (<a class="el" href="class_t_xsh_simple_level.html">TXshSimpleLevel</a> *sl)</td></tr>
<tr class="separator:a655c62c9e4d039c2a0fdb0206645fbd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f7c67d1d6bec9272081144a4869897a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a4f7c67d1d6bec9272081144a4869897a">opened</a> () const</td></tr>
<tr class="separator:a4f7c67d1d6bec9272081144a4869897a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abef1c4aa3413af02ccc0f5dcee5d2895"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#abef1c4aa3413af02ccc0f5dcee5d2895">update</a> (const <a class="el" href="class_t_frame_id.html">TFrameId</a> &amp;fid, const <a class="el" href="class_t_smart_pointer_t.html">TImageP</a> &amp;img)</td></tr>
<tr class="separator:abef1c4aa3413af02ccc0f5dcee5d2895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f8172c2669826013b052331b24bba1d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a4f8172c2669826013b052331b24bba1d">close</a> ()</td></tr>
<tr class="separator:a4f8172c2669826013b052331b24bba1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f6d3f1058cbdd40eb77ebbcecbe1b43"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_level_updater.html#a5f6d3f1058cbdd40eb77ebbcecbe1b43">flush</a> ()</td></tr>
<tr class="separator:a5f6d3f1058cbdd40eb77ebbcecbe1b43"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p ><a class="el" href="class_level_updater.html">LevelUpdater</a> is the preferential interface for dealing with <em>conservative</em> levels I/O in Toonz.</p>
<pre class="fragment">The Toonz Image library already provides the basic TLevelWriter interface
</pre><p> that can be used to save image levels on hard disk. This is usually sufficient to satisfy most needs, with a simple enough usage:</p>
<div class="fragment"><div class="line">    <a class="code hl_class" href="class_t_level_writer_p.html">TLevelWriterP</a> lw(</div>
<div class="line">      levelPath,                                          <span class="comment">// Attach to the</span></div>
<div class="line">required level path (creates level <span class="keywordflow">if</span> none).</div>
<div class="line">      Tiio::makeWriterProperties(levelPath.getType()));   <span class="comment">// NOTE: Level</span></div>
<div class="line">Properties are not read from an existing level.</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="class_t_property_group.html">TPropertyGroup</a>* props(lw-&gt;getProperties());</div>
<div class="line">    assert(props);                                        <span class="comment">// Currently</span></div>
<div class="line">guaranteed ONLY <span class="keywordflow">if</span> specified at lw<span class="stringliteral">&#39;s construction.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    props-&gt;getProperty(&quot;Bits Per Pixel&quot;)-&gt;setValue(L&quot;64(RGBM)&quot;);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    lw-&gt;getFrameWriter(fid1)-&gt;save(img1);                 // Save image img1 at</span></div>
<div class="line"><span class="stringliteral">frame fid1</span></div>
<div class="line"><span class="stringliteral">    lw-&gt;getFrameWriter(fid2)-&gt;save(img2);                 // ...</span></div>
<div class="ttc" id="aclass_t_level_writer_p_html"><div class="ttname"><a href="class_t_level_writer_p.html">TLevelWriterP</a></div><div class="ttdef"><b>Definition:</b> tlevel_io.h:214</div></div>
<div class="ttc" id="aclass_t_property_group_html"><div class="ttname"><a href="class_t_property_group.html">TPropertyGroup</a></div><div class="ttdef"><b>Definition:</b> tproperty.h:430</div></div>
</div><!-- fragment --><p >Some output types, however, may not support image insertions in the middle of an already existing level, but just <em> at the end &lt;\I&gt; (as is the case for movie formats like <em>avi</em>). In these cases, a newly created temporary file must be used to have both old and new images <em>appended</em> at the right time. Once the appending procedure ends, the temporary gets renamed to the original file. Additional files related to the level must be renamed too, such as the level's palette and content history. <br  />
 Plus, as noted in the example, the format properties of any existing level at specified path must be manually retrieved. <br  />
<br  />
 The <a class="el" href="class_level_updater.html">LevelUpdater</a> is a wrapper class to both <a class="el" href="class_t_level_reader.html">TLevelReader</a> and <a class="el" href="class_t_level_writer.html">TLevelWriter</a> employable to deal with these subtelties with a simple, equivalent syntax to the one above:</em></p>
<p ><em> </p><div class="fragment"><div class="line">    <a class="code hl_class" href="class_level_updater.html">LevelUpdater</a> lu(levelPath);                             <span class="comment">// Attach to the</span></div>
<div class="line">required level path (creates level <span class="keywordflow">if</span> none).</div>
<div class="line">                                                            <span class="comment">// Reads any</span></div>
<div class="line">existing level format properties.</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="class_t_property_group.html">TPropertyGroup</a>* props(lu.getLevelWriter()-&gt;getProperties());      <span class="comment">//</span></div>
<div class="line">Properties (eventually <span class="keywordflow">default</span> ones) are ensured</div>
<div class="line">    assert(props);                                                    <span class="comment">// to</span></div>
<div class="line">exist.</div>
<div class="line"> </div>
<div class="line">    props-&gt;getProperty(<span class="stringliteral">&quot;Bits Per Pixel&quot;</span>)-&gt;setValue(L<span class="stringliteral">&quot;64(RGBM)&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    lu.update(fid1, img1);                                  <span class="comment">// Save image img1</span></div>
<div class="line">at frame fid1</div>
<div class="line">    lu.update(fid2, img2);                                  <span class="comment">// ...</span></div>
<div class="ttc" id="aclass_level_updater_html"><div class="ttname"><a href="class_level_updater.html">LevelUpdater</a></div><div class="ttdef"><b>Definition:</b> levelupdater.h:104</div></div>
</div><!-- fragment --><p></em></p>
<p ><em></p><dl class="section warning"><dt>Warning</dt><dd>The <a class="el" href="class_level_updater.html">LevelUpdater</a> requires that <b> saved images must be ordered by insertion frame &lt;\B&gt;. If necessary, users must have them sorted before supplying them tp the updater. </b></dd></dl>
<p></em></p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a169e92d6d2a763600034cc59f8a8113d" name="a169e92d6d2a763600034cc59f8a8113d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a169e92d6d2a763600034cc59f8a8113d">&#9670;&nbsp;</a></span>LevelUpdater() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LevelUpdater::LevelUpdater </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   80</span>    : m_pg(0)</div>
<div class="line"><span class="lineno">   81</span>    , m_inputLevel(0)</div>
<div class="line"><span class="lineno">   82</span>    , m_currIdx(0)</div>
<div class="line"><span class="lineno">   83</span>    , m_imageInfo(0)</div>
<div class="line"><span class="lineno">   84</span>    , m_usingTemporaryFile(<span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">   85</span>    , m_opened(<span class="keyword">false</span>) {}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3e6600955c86b053265de95e87962487" name="a3e6600955c86b053265de95e87962487"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e6600955c86b053265de95e87962487">&#9670;&nbsp;</a></span>LevelUpdater() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LevelUpdater::LevelUpdater </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_xsh_simple_level.html">TXshSimpleLevel</a> *&#160;</td>
          <td class="paramname"><em>sl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   90</span>    : m_pg(0)</div>
<div class="line"><span class="lineno">   91</span>    , m_inputLevel(0)</div>
<div class="line"><span class="lineno">   92</span>    , m_imageInfo(0)</div>
<div class="line"><span class="lineno">   93</span>    , m_currIdx(0)</div>
<div class="line"><span class="lineno">   94</span>    , m_opened(<span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">   95</span>    , m_usingTemporaryFile(<span class="keyword">false</span>) {</div>
<div class="line"><span class="lineno">   96</span>  <a class="code hl_function" href="class_level_updater.html#af42de29721580f485bc92e15d399af36">open</a>(sl);</div>
<div class="line"><span class="lineno">   97</span>}</div>
<div class="ttc" id="aclass_level_updater_html_af42de29721580f485bc92e15d399af36"><div class="ttname"><a href="class_level_updater.html#af42de29721580f485bc92e15d399af36">LevelUpdater::open</a></div><div class="ttdeci">void open(const TFilePath &amp;src, TPropertyGroup *lwProperties)</div><div class="ttdef"><b>Definition:</b> levelupdater.cpp:210</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7afc45ef620e00acf73018ebdea49a88" name="a7afc45ef620e00acf73018ebdea49a88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7afc45ef620e00acf73018ebdea49a88">&#9670;&nbsp;</a></span>LevelUpdater() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LevelUpdater::LevelUpdater </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_t_file_path.html">TFilePath</a> &amp;&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_property_group.html">TPropertyGroup</a> *&#160;</td>
          <td class="paramname"><em>lwProperties</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  102</span>    : m_pg(0)</div>
<div class="line"><span class="lineno">  103</span>    , m_inputLevel(0)</div>
<div class="line"><span class="lineno">  104</span>    , m_imageInfo(0)</div>
<div class="line"><span class="lineno">  105</span>    , m_currIdx(0)</div>
<div class="line"><span class="lineno">  106</span>    , m_opened(<span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">  107</span>    , m_usingTemporaryFile(<span class="keyword">false</span>) {</div>
<div class="line"><span class="lineno">  108</span>  <a class="code hl_function" href="class_level_updater.html#af42de29721580f485bc92e15d399af36">open</a>(fp, lwProperties);</div>
<div class="line"><span class="lineno">  109</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af50f66a089f8c612569553296b4fbb86" name="af50f66a089f8c612569553296b4fbb86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af50f66a089f8c612569553296b4fbb86">&#9670;&nbsp;</a></span>~LevelUpdater()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LevelUpdater::~LevelUpdater </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  113</span>                            {</div>
<div class="line"><span class="lineno">  114</span>  <span class="comment">// Please, observe that the try-catch below here is NOT OPTIONAL.</span></div>
<div class="line"><span class="lineno">  115</span>  <span class="comment">// IT IS AN ERROR TO THROW INSIDE A DESTRUCTOR. EVER.</span></div>
<div class="line"><span class="lineno">  116</span>  <span class="comment">// Doing so damages the stack unwinding process - namely, it interferes</span></div>
<div class="line"><span class="lineno">  117</span>  <span class="comment">// with the destruction of OTHER objects going out of scope.</span></div>
<div class="line"><span class="lineno">  118</span>  <span class="comment">// C++ does NOT react well to that (ie could terminate() the process).</span></div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  121</span>    <a class="code hl_function" href="class_level_updater.html#a4f8172c2669826013b052331b24bba1d">close</a>();</div>
<div class="line"><span class="lineno">  122</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  123</span>  }</div>
<div class="line"><span class="lineno">  124</span>}</div>
<div class="ttc" id="aclass_level_updater_html_a4f8172c2669826013b052331b24bba1d"><div class="ttname"><a href="class_level_updater.html#a4f8172c2669826013b052331b24bba1d">LevelUpdater::close</a></div><div class="ttdeci">void close()</div><div class="ttdef"><b>Definition:</b> levelupdater.cpp:413</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a4f8172c2669826013b052331b24bba1d" name="a4f8172c2669826013b052331b24bba1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f8172c2669826013b052331b24bba1d">&#9670;&nbsp;</a></span>close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LevelUpdater::close </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Closes and flushes the level. In case temporary files were used for the level, they replace the originals now. In case the replace procedure failed, the temporaries are (silently, in current implementation) retained on disk. </p>
<div class="fragment"><div class="line"><span class="lineno">  413</span>                         {</div>
<div class="line"><span class="lineno">  414</span>  <span class="keywordflow">if</span> (!m_opened) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>  <span class="comment">// Resume open for write</span></div>
<div class="line"><span class="lineno">  417</span>  resume();</div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  420</span>    <span class="keywordflow">if</span> (m_usingTemporaryFile) {</div>
<div class="line"><span class="lineno">  421</span>      <span class="comment">// Add all remaining frames still in m_fids</span></div>
<div class="line"><span class="lineno">  422</span>      addFramesTo((<span class="keywordtype">int</span>)m_fids.size());</div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>      <span class="comment">// Currently written level is temporary. It must be renamed to its</span></div>
<div class="line"><span class="lineno">  425</span>      <span class="comment">// originally intended path,</span></div>
<div class="line"><span class="lineno">  426</span>      <span class="comment">// if it&#39;s possible to write there. Now, if it&#39;s writable, in particular</span></div>
<div class="line"><span class="lineno">  427</span>      <span class="comment">// it should be readable,</span></div>
<div class="line"><span class="lineno">  428</span>      <span class="comment">// so m_lr should exist.</span></div>
<div class="line"><span class="lineno">  429</span> </div>
<div class="line"><span class="lineno">  430</span>      <span class="comment">// If not... well, the file was corrupt or something. Instead than</span></div>
<div class="line"><span class="lineno">  431</span>      <span class="comment">// attempting to delete it,</span></div>
<div class="line"><span class="lineno">  432</span>      <span class="comment">// we&#39;re begin conservative - this means that no data is lost, but</span></div>
<div class="line"><span class="lineno">  433</span>      <span class="comment">// unfortunately temporaries</span></div>
<div class="line"><span class="lineno">  434</span>      <span class="comment">// might pile up...</span></div>
<div class="line"><span class="lineno">  435</span>      <span class="keywordflow">if</span> (m_lr) {</div>
<div class="line"><span class="lineno">  436</span>        <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> finalPath(m_lr-&gt;getFilePath()), tempPath(m_lw-&gt;getFilePath());</div>
<div class="line"><span class="lineno">  437</span> </div>
<div class="line"><span class="lineno">  438</span>        <span class="comment">// Release m_lr and m_lw - to be sure that no file is kept open while</span></div>
<div class="line"><span class="lineno">  439</span>        <span class="comment">// renaming.</span></div>
<div class="line"><span class="lineno">  440</span>        <span class="comment">// NOTE: releasing m_lr and m_lw should not throw anything. As stated</span></div>
<div class="line"><span class="lineno">  441</span>        <span class="comment">// before, throwing</span></div>
<div class="line"><span class="lineno">  442</span>        <span class="comment">//       in destructors is bad. I&#39;m not sure this is actually guaranteed</span></div>
<div class="line"><span class="lineno">  443</span>        <span class="comment">//       in Toonz, however :(</span></div>
<div class="line"><span class="lineno">  444</span>        m_lr = <a class="code hl_class" href="class_t_level_reader_p.html">TLevelReaderP</a>(), m_lw = <a class="code hl_class" href="class_t_level_writer_p.html">TLevelWriterP</a>();</div>
<div class="line"><span class="lineno">  445</span> </div>
<div class="line"><span class="lineno">  446</span>        <span class="comment">// A temp file didn&#39;t get created. What happened?  Force failure!</span></div>
<div class="line"><span class="lineno">  447</span>        <span class="keywordflow">if</span> (!<a class="code hl_class" href="class_t_file_status.html">TFileStatus</a>(tempPath).doesExist())</div>
<div class="line"><span class="lineno">  448</span>          <span class="keywordflow">throw</span> <a class="code hl_class" href="class_t_system_exception.html">TSystemException</a>(tempPath, <span class="stringliteral">&quot;cant find!&quot;</span>);</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>        <span class="comment">// Rename the level</span></div>
<div class="line"><span class="lineno">  451</span>        TSystem::removeFileOrLevel_throw(finalPath);</div>
<div class="line"><span class="lineno">  452</span>        TSystem::renameFileOrLevel_throw(finalPath,</div>
<div class="line"><span class="lineno">  453</span>                                         tempPath);  <span class="comment">// finalPath &lt;- tempPath</span></div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>        <span class="comment">// If present, add known trailing files</span></div>
<div class="line"><span class="lineno">  456</span>        <span class="keywordflow">if</span> (finalPath.getType() == <span class="stringliteral">&quot;tlv&quot;</span>) {</div>
<div class="line"><span class="lineno">  457</span>          <span class="comment">// Palette file</span></div>
<div class="line"><span class="lineno">  458</span>          <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> finalPalette = finalPath.<a class="code hl_function" href="class_t_file_path.html#a1437b0e0720e9258b622f68b6858e95d">withType</a>(<span class="stringliteral">&quot;tpl&quot;</span>);</div>
<div class="line"><span class="lineno">  459</span>          <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> tempPalette  = tempPath.<a class="code hl_function" href="class_t_file_path.html#a1437b0e0720e9258b622f68b6858e95d">withType</a>(<span class="stringliteral">&quot;tpl&quot;</span>);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>          <span class="keywordflow">if</span> (<a class="code hl_class" href="class_t_file_status.html">TFileStatus</a>(finalPalette).doesExist()) {</div>
<div class="line"><span class="lineno">  462</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="class_t_file_status.html">TFileStatus</a>(tempPalette).doesExist())</div>
<div class="line"><span class="lineno">  463</span>              TSystem::deleteFile(finalPalette);</div>
<div class="line"><span class="lineno">  464</span>            TSystem::renameFile(finalPalette, tempPalette);</div>
<div class="line"><span class="lineno">  465</span>          }</div>
<div class="line"><span class="lineno">  466</span> </div>
<div class="line"><span class="lineno">  467</span>          <span class="comment">// History file</span></div>
<div class="line"><span class="lineno">  468</span>          <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> finalHistory = finalPath.<a class="code hl_function" href="class_t_file_path.html#a1437b0e0720e9258b622f68b6858e95d">withType</a>(<span class="stringliteral">&quot;hst&quot;</span>);</div>
<div class="line"><span class="lineno">  469</span>          <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> tempHistory  = tempPath.<a class="code hl_function" href="class_t_file_path.html#a1437b0e0720e9258b622f68b6858e95d">withType</a>(<span class="stringliteral">&quot;hst&quot;</span>);</div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span>          <span class="keywordflow">if</span> (<a class="code hl_class" href="class_t_file_status.html">TFileStatus</a>(tempHistory).doesExist()) {</div>
<div class="line"><span class="lineno">  472</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="class_t_file_status.html">TFileStatus</a>(finalHistory).doesExist())</div>
<div class="line"><span class="lineno">  473</span>              TSystem::deleteFile(finalHistory);</div>
<div class="line"><span class="lineno">  474</span>            TSystem::renameFile(finalHistory, tempHistory);</div>
<div class="line"><span class="lineno">  475</span>          }</div>
<div class="line"><span class="lineno">  476</span>        }</div>
<div class="line"><span class="lineno">  477</span>      }</div>
<div class="line"><span class="lineno">  478</span> </div>
<div class="line"><span class="lineno">  479</span>      <span class="comment">// NOTE: If for some reason m_lr was not present and we were using a</span></div>
<div class="line"><span class="lineno">  480</span>      <span class="comment">// temporary file, no</span></div>
<div class="line"><span class="lineno">  481</span>      <span class="comment">// renaming takes place. Users could see the __x temporaries and,</span></div>
<div class="line"><span class="lineno">  482</span>      <span class="comment">// eventually, rename them manually</span></div>
<div class="line"><span class="lineno">  483</span>      <span class="comment">// or see what&#39;s wrong with the unwritable file.</span></div>
<div class="line"><span class="lineno">  484</span>    }</div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span>    <span class="comment">// Reset the updater&#39;s status</span></div>
<div class="line"><span class="lineno">  487</span>    reset();</div>
<div class="line"><span class="lineno">  488</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  489</span>    <span class="comment">// Some temporary object could not be renamed. Or some remaining frame could</span></div>
<div class="line"><span class="lineno">  490</span>    <span class="comment">// not be added.</span></div>
<div class="line"><span class="lineno">  491</span>    <span class="comment">// Hopefully, it was not about closing m_lr or m_lw.</span></div>
<div class="line"><span class="lineno">  492</span> </div>
<div class="line"><span class="lineno">  493</span>    <span class="comment">// However, we still intend to reset the updater&#39;s status before rethrowing.</span></div>
<div class="line"><span class="lineno">  494</span>    reset();</div>
<div class="line"><span class="lineno">  495</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  496</span>  }</div>
<div class="line"><span class="lineno">  497</span>}</div>
<div class="ttc" id="aclass_t_file_path_html"><div class="ttname"><a href="class_t_file_path.html">TFilePath</a></div><div class="ttdef"><b>Definition:</b> tfilepath.h:134</div></div>
<div class="ttc" id="aclass_t_file_path_html_a1437b0e0720e9258b622f68b6858e95d"><div class="ttname"><a href="class_t_file_path.html#a1437b0e0720e9258b622f68b6858e95d">TFilePath::withType</a></div><div class="ttdeci">TFilePath withType(const std::string &amp;type) const</div><div class="ttdef"><b>Definition:</b> tfilepath.cpp:774</div></div>
<div class="ttc" id="aclass_t_file_status_html"><div class="ttname"><a href="class_t_file_status.html">TFileStatus</a></div><div class="ttdef"><b>Definition:</b> tsystem.h:36</div></div>
<div class="ttc" id="aclass_t_level_reader_p_html"><div class="ttname"><a href="class_t_level_reader_p.html">TLevelReaderP</a></div><div class="ttdef"><b>Definition:</b> tlevel_io.h:109</div></div>
<div class="ttc" id="aclass_t_system_exception_html"><div class="ttname"><a href="class_t_system_exception.html">TSystemException</a></div><div class="ttdef"><b>Definition:</b> tsystem.h:65</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00774">TFilePath::withType()</a>.</p>

</div>
</div>
<a id="a5f6d3f1058cbdd40eb77ebbcecbe1b43" name="a5f6d3f1058cbdd40eb77ebbcecbe1b43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f6d3f1058cbdd40eb77ebbcecbe1b43">&#9670;&nbsp;</a></span>flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LevelUpdater::flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Flushes the level currently opened for write, <em>suspending</em> the update procedure. Since a level cannot be both opened for read and write at the same time, users could require to flush all updates and suspend (without closing) an update procedure to read some of the data that has just been written. The update procedure will be resumed automatically at the next <a class="el" href="class_level_updater.html#abef1c4aa3413af02ccc0f5dcee5d2895">update()</a> or <a class="el" href="class_level_updater.html#a4f8172c2669826013b052331b24bba1d">close()</a> invocation. </p><dl class="section warning"><dt>Warning</dt><dd>Not all file formats currently support this. A brief list of currently supporting formats include TLV, MOV and multi-file levels, whereas formats <b>not</b> supporting it include PLI and AVI (due to <a class="el" href="class_t_level_writer.html">TLevelWriter</a> not supporting <em>appends</em> to an already existing level). </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  501</span>                         {</div>
<div class="line"><span class="lineno">  502</span>  assert(m_opened);</div>
<div class="line"><span class="lineno">  503</span>  <span class="keywordflow">if</span> (!m_lw) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>  <span class="comment">// In case the level writer could not be destroyed (bad, should really not</span></div>
<div class="line"><span class="lineno">  506</span>  <span class="comment">// throw btw),</span></div>
<div class="line"><span class="lineno">  507</span>  <span class="comment">// reset and rethrow</span></div>
<div class="line"><span class="lineno">  508</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  509</span>    m_lw = <a class="code hl_class" href="class_t_level_writer_p.html">TLevelWriterP</a>();</div>
<div class="line"><span class="lineno">  510</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  511</span>    reset();</div>
<div class="line"><span class="lineno">  512</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  513</span>  }</div>
<div class="line"><span class="lineno">  514</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3764faba4483754996136841c54c0871" name="a3764faba4483754996136841c54c0871"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3764faba4483754996136841c54c0871">&#9670;&nbsp;</a></span>getImageInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="class_t_image_info.html">TImageInfo</a> * LevelUpdater::getImageInfo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the image properties of the updated level, if one already exists. </p>
<div class="fragment"><div class="line"><span class="lineno">  138</span>{ <span class="keywordflow">return</span> m_imageInfo; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4e37712c438721567ec67c7c6531336" name="aa4e37712c438721567ec67c7c6531336"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4e37712c438721567ec67c7c6531336">&#9670;&nbsp;</a></span>getInputLevel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_level_p.html">TLevelP</a> LevelUpdater::getInputLevel </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Returns a description of any already existing level on the attached path (in terms of frames content and palette). </p>
<div class="fragment"><div class="line"><span class="lineno">  135</span>{ <span class="keywordflow">return</span> m_inputLevel; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6de4b9714e2a634b56662942b5491e89" name="a6de4b9714e2a634b56662942b5491e89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6de4b9714e2a634b56662942b5491e89">&#9670;&nbsp;</a></span>getLevelReader()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_level_reader_p.html">TLevelReaderP</a> LevelUpdater::getLevelReader </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  131</span>{ <span class="keywordflow">return</span> m_lr; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac693a2fd15e4e1c90c58dc43f2d98f34" name="ac693a2fd15e4e1c90c58dc43f2d98f34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac693a2fd15e4e1c90c58dc43f2d98f34">&#9670;&nbsp;</a></span>getLevelWriter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_level_writer_p.html">TLevelWriterP</a> LevelUpdater::getLevelWriter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  130</span>{ <span class="keywordflow">return</span> m_lw; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="af42de29721580f485bc92e15d399af36" name="af42de29721580f485bc92e15d399af36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af42de29721580f485bc92e15d399af36">&#9670;&nbsp;</a></span>open() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LevelUpdater::open </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_t_file_path.html">TFilePath</a> &amp;&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_property_group.html">TPropertyGroup</a> *&#160;</td>
          <td class="paramname"><em>lwProperties</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Attaches the updater to the specified path, using and <em> taking ownership &lt;\I&gt; of the supplied write properties. This function may throw in case the specified path has an unrecognized extension, or the file could not be opened for write. </em></p>
<div class="fragment"><div class="line"><span class="lineno">  210</span>                                                               {</div>
<div class="line"><span class="lineno">  211</span>  assert(!m_lw);</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>  <span class="comment">// Find out if a corresponding level already exists on disk - in that case,</span></div>
<div class="line"><span class="lineno">  214</span>  <span class="comment">// load it</span></div>
<div class="line"><span class="lineno">  215</span>  <span class="keywordtype">bool</span> existsLevel = TSystem::doesExistFileOrLevel(fp);</div>
<div class="line"><span class="lineno">  216</span>  <span class="keywordflow">if</span> (existsLevel)</div>
<div class="line"><span class="lineno">  217</span>    buildSourceInfo(fp);  <span class="comment">// Could be !m_lr if level could not be read</span></div>
<div class="line"><span class="lineno">  218</span> </div>
<div class="line"><span class="lineno">  219</span>  <span class="comment">// Build Output Properties if needed</span></div>
<div class="line"><span class="lineno">  220</span>  <span class="keywordflow">if</span> (pg)</div>
<div class="line"><span class="lineno">  221</span>    m_pg = pg-&gt;clone();</div>
<div class="line"><span class="lineno">  222</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  223</span>    buildProperties(fp);  <span class="comment">// Throws only if not even the default properties</span></div>
<div class="line"><span class="lineno">  224</span>                          <span class="comment">// could be found - ie, bad file type</span></div>
<div class="line"><span class="lineno">  225</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  226</span>    <span class="comment">// Decide whether the update procedure requires a temporary file for</span></div>
<div class="line"><span class="lineno">  227</span>    <span class="comment">// appending</span></div>
<div class="line"><span class="lineno">  228</span>    m_usingTemporaryFile = existsLevel &amp;&amp; !supportsRandomAccess(fp);</div>
<div class="line"><span class="lineno">  229</span>    <span class="keywordflow">if</span> (m_usingTemporaryFile) {</div>
<div class="line"><span class="lineno">  230</span>      <span class="comment">// The level requires a temporary to write frames to. Upon closing, the</span></div>
<div class="line"><span class="lineno">  231</span>      <span class="comment">// original level</span></div>
<div class="line"><span class="lineno">  232</span>      <span class="comment">// is deleted and the temporary takes its place. Note that m_lw takes</span></div>
<div class="line"><span class="lineno">  233</span>      <span class="comment">// ownership of the properties group.</span></div>
<div class="line"><span class="lineno">  234</span>      m_lwPath = getNewTemporaryFilePath(fp);</div>
<div class="line"><span class="lineno">  235</span>      m_lw     = <a class="code hl_class" href="class_t_level_writer_p.html">TLevelWriterP</a>(m_lwPath, m_pg-&gt;clone());</div>
<div class="line"><span class="lineno">  236</span> </div>
<div class="line"><span class="lineno">  237</span>      <span class="keywordflow">if</span> (m_inputLevel)</div>
<div class="line"><span class="lineno">  238</span>        <span class="keywordflow">for</span> (TLevel::Iterator it = m_inputLevel-&gt;begin();</div>
<div class="line"><span class="lineno">  239</span>             it != m_inputLevel-&gt;end(); ++it)</div>
<div class="line"><span class="lineno">  240</span>          m_fids.push_back(it-&gt;first);</div>
<div class="line"><span class="lineno">  241</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  242</span>      m_lr =</div>
<div class="line"><span class="lineno">  243</span>          <a class="code hl_class" href="class_t_level_reader_p.html">TLevelReaderP</a>();  <span class="comment">// Release the reader. This is necessary since the</span></div>
<div class="line"><span class="lineno">  244</span>      m_lw = <a class="code hl_class" href="class_t_level_writer_p.html">TLevelWriterP</a>(</div>
<div class="line"><span class="lineno">  245</span>          fp, m_pg-&gt;clone());  <span class="comment">// original file itself will be MODIFIED.</span></div>
<div class="line"><span class="lineno">  246</span>      m_lwPath = fp;</div>
<div class="line"><span class="lineno">  247</span>    }</div>
<div class="line"><span class="lineno">  248</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  249</span>    <span class="comment">// In this case, TLevelWriterP(..) failed, that object was never</span></div>
<div class="line"><span class="lineno">  250</span>    <span class="comment">// constructed,</span></div>
<div class="line"><span class="lineno">  251</span>    <span class="comment">// the assignment m_lw never took place. And m_lw == 0.</span></div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>    <span class="comment">// Reset state and rethrow</span></div>
<div class="line"><span class="lineno">  254</span>    reset();</div>
<div class="line"><span class="lineno">  255</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  256</span>  }</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>  <span class="comment">// In case the writer saves icons inside the output level (TLV case), set the</span></div>
<div class="line"><span class="lineno">  259</span>  <span class="comment">// associated icon size now</span></div>
<div class="line"><span class="lineno">  260</span>  <a class="code hl_class" href="class_t_dimension_t.html">TDimension</a> iconSize = Preferences::instance()-&gt;getIconSize();</div>
<div class="line"><span class="lineno">  261</span>  assert(iconSize.lx &gt; 0 &amp;&amp; iconSize.ly &gt; 0);</div>
<div class="line"><span class="lineno">  262</span>  m_lw-&gt;setIconSize(iconSize);</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>  m_opened = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  265</span>}</div>
<div class="ttc" id="aclass_t_dimension_t_html"><div class="ttname"><a href="class_t_dimension_t.html">TDimensionT&lt; int &gt;</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a655c62c9e4d039c2a0fdb0206645fbd8" name="a655c62c9e4d039c2a0fdb0206645fbd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a655c62c9e4d039c2a0fdb0206645fbd8">&#9670;&nbsp;</a></span>open() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LevelUpdater::open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_xsh_simple_level.html">TXshSimpleLevel</a> *&#160;</td>
          <td class="paramname"><em>sl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Attaches the updater to the specified simple level instance. Format properties are the default in case the level is saved anew. If the level requires the alpha channel, evenutal bpp and alpha properties are upgraded accordingly. This function may throw just like its path-based counterpart. </p>
<div class="fragment"><div class="line"><span class="lineno">  269</span>                                           {</div>
<div class="line"><span class="lineno">  270</span>  assert(!m_lw);</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>  assert(sl &amp;&amp; sl-&gt;<a class="code hl_function" href="class_t_xsh_level.html#a06176566e80858dbb206112db08a92b9">getScene</a>());</div>
<div class="line"><span class="lineno">  273</span>  m_sl = sl;</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>  <span class="keyword">const</span> <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> &amp;fp = sl-&gt;<a class="code hl_function" href="class_t_xsh_level.html#a06176566e80858dbb206112db08a92b9">getScene</a>()-&gt;<a class="code hl_function" href="class_toonz_scene.html#aa2ed57dfbae7f8cf02a4abe47ed533c6">decodeFilePath</a>(sl-&gt;<a class="code hl_function" href="class_t_xsh_simple_level.html#a668293d53a70cca8811db28d87011c55">getPath</a>());</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>  <span class="comment">// Find out if a corresponding level already exists on disk - in that case,</span></div>
<div class="line"><span class="lineno">  278</span>  <span class="comment">// load it</span></div>
<div class="line"><span class="lineno">  279</span>  <span class="keywordtype">bool</span> existsLevel = TSystem::doesExistFileOrLevel(fp);</div>
<div class="line"><span class="lineno">  280</span>  <span class="keywordflow">if</span> (existsLevel)</div>
<div class="line"><span class="lineno">  281</span>    buildSourceInfo(fp);  <span class="comment">// Could be !m_lr if level could not be read</span></div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>  <span class="comment">// Build Output Properties</span></div>
<div class="line"><span class="lineno">  284</span>  buildProperties(fp);  <span class="comment">// May throw if not even the default properties could be</span></div>
<div class="line"><span class="lineno">  285</span>                        <span class="comment">// retrieved</span></div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>  <span class="comment">// If there was no level on disk, or the level properties require the alpha</span></div>
<div class="line"><span class="lineno">  288</span>  <span class="comment">// channel, enforce the</span></div>
<div class="line"><span class="lineno">  289</span>  <span class="comment">// bpp accordingly on m_pg.</span></div>
<div class="line"><span class="lineno">  290</span>  <a class="code hl_class" href="class_level_properties.html">LevelProperties</a> *levelProperties = sl-&gt;<a class="code hl_function" href="class_t_xsh_simple_level.html#ad412dd5c3a6ae3ff20a480dc728b26d2">getProperties</a>();</div>
<div class="line"><span class="lineno">  291</span>  assert(levelProperties);</div>
<div class="line"><span class="lineno">  292</span> </div>
<div class="line"><span class="lineno">  293</span>  <span class="keywordflow">if</span> (levelProperties-&gt;<a class="code hl_function" href="class_level_properties.html#a7d13e24f7deb31c4b9f4b05c430dbab2">hasAlpha</a>() || !existsLevel) {</div>
<div class="line"><span class="lineno">  294</span>    <span class="keywordtype">int</span> bpp = levelProperties-&gt;<a class="code hl_function" href="class_level_properties.html#a7d13e24f7deb31c4b9f4b05c430dbab2">hasAlpha</a>()</div>
<div class="line"><span class="lineno">  295</span>                  ? std::min(32, levelProperties-&gt;<a class="code hl_function" href="class_level_properties.html#a88741317c54640d3b509f32a7c0fdf84">getBpp</a>())</div>
<div class="line"><span class="lineno">  296</span>                  : levelProperties-&gt;getBpp();</div>
<div class="line"><span class="lineno">  297</span>    enforceBpp(m_pg, bpp, existsLevel);</div>
<div class="line"><span class="lineno">  298</span>  }</div>
<div class="line"><span class="lineno">  299</span> </div>
<div class="line"><span class="lineno">  300</span>  <span class="comment">// Should sl-&gt;getPalette() be enforced on m_lw too? It was not present in the</span></div>
<div class="line"><span class="lineno">  301</span>  <span class="comment">// old code...</span></div>
<div class="line"><span class="lineno">  302</span> </div>
<div class="line"><span class="lineno">  303</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  304</span>    <span class="comment">// Decide whether the update procedure requires a temporary file for</span></div>
<div class="line"><span class="lineno">  305</span>    <span class="comment">// appending</span></div>
<div class="line"><span class="lineno">  306</span>    m_usingTemporaryFile = existsLevel &amp;&amp; !supportsRandomAccess(fp);</div>
<div class="line"><span class="lineno">  307</span>    <span class="keywordflow">if</span> (m_usingTemporaryFile) {</div>
<div class="line"><span class="lineno">  308</span>      <span class="comment">// The level requires a temporary to write frames to. Upon closing, the</span></div>
<div class="line"><span class="lineno">  309</span>      <span class="comment">// original level</span></div>
<div class="line"><span class="lineno">  310</span>      <span class="comment">// is deleted and the temporary takes its place.</span></div>
<div class="line"><span class="lineno">  311</span>      m_lwPath = getNewTemporaryFilePath(fp);</div>
<div class="line"><span class="lineno">  312</span>      m_lw     = <a class="code hl_class" href="class_t_level_writer_p.html">TLevelWriterP</a>(m_lwPath, m_pg-&gt;clone());</div>
<div class="line"><span class="lineno">  313</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  314</span>      m_lr = <a class="code hl_class" href="class_t_level_reader_p.html">TLevelReaderP</a>();                   <span class="comment">// Release the reader</span></div>
<div class="line"><span class="lineno">  315</span>      m_lw = <a class="code hl_class" href="class_t_level_writer_p.html">TLevelWriterP</a>(fp, m_pg-&gt;clone());  <span class="comment">// Open for write the usual way</span></div>
<div class="line"><span class="lineno">  316</span>      m_lwPath = fp;</div>
<div class="line"><span class="lineno">  317</span>    }</div>
<div class="line"><span class="lineno">  318</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  319</span>    <span class="comment">// Reset state and rethrow</span></div>
<div class="line"><span class="lineno">  320</span>    reset();</div>
<div class="line"><span class="lineno">  321</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  322</span>  }</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>  <span class="comment">// Load the frames directly from sl</span></div>
<div class="line"><span class="lineno">  325</span>  sl-&gt;<a class="code hl_function" href="class_t_xsh_simple_level.html#a567daee4ca12a0e92445bcf98a6541f1">getFids</a>(m_fids);</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>  <span class="comment">// In case the writer saves icons inside the output level (TLV case), set the</span></div>
<div class="line"><span class="lineno">  328</span>  <span class="comment">// associated icon size now</span></div>
<div class="line"><span class="lineno">  329</span>  <a class="code hl_class" href="class_t_dimension_t.html">TDimension</a> iconSize = Preferences::instance()-&gt;getIconSize();</div>
<div class="line"><span class="lineno">  330</span>  assert(iconSize.lx &gt; 0 &amp;&amp; iconSize.ly &gt; 0);</div>
<div class="line"><span class="lineno">  331</span>  m_lw-&gt;setIconSize(iconSize);</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>  <span class="keywordflow">if</span> (sl-&gt;<a class="code hl_function" href="class_t_xsh_simple_level.html#a2fe15ee3d60e1f5f5c38d6ba75d36812">getContentHistory</a>())</div>
<div class="line"><span class="lineno">  334</span>    m_lw-&gt;setContentHistory(m_sl-&gt;<a class="code hl_function" href="class_t_xsh_simple_level.html#a2fe15ee3d60e1f5f5c38d6ba75d36812">getContentHistory</a>()-&gt;clone());</div>
<div class="line"><span class="lineno">  335</span> </div>
<div class="line"><span class="lineno">  336</span>  m_opened = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  337</span>}</div>
<div class="ttc" id="aclass_level_properties_html"><div class="ttname"><a href="class_level_properties.html">LevelProperties</a></div><div class="ttdoc">Stores the possible properties of a Toonz level.</div><div class="ttdef"><b>Definition:</b> levelproperties.h:75</div></div>
<div class="ttc" id="aclass_level_properties_html_a7d13e24f7deb31c4b9f4b05c430dbab2"><div class="ttname"><a href="class_level_properties.html#a7d13e24f7deb31c4b9f4b05c430dbab2">LevelProperties::hasAlpha</a></div><div class="ttdeci">bool hasAlpha() const</div><div class="ttdoc">Returns whether the level has an alpha channel.</div><div class="ttdef"><b>Definition:</b> levelproperties.h:144</div></div>
<div class="ttc" id="aclass_level_properties_html_a88741317c54640d3b509f32a7c0fdf84"><div class="ttname"><a href="class_level_properties.html#a88741317c54640d3b509f32a7c0fdf84">LevelProperties::getBpp</a></div><div class="ttdeci">int getBpp() const</div><div class="ttdoc">Returns the level's known bits-per-pixel.</div><div class="ttdef"><b>Definition:</b> levelproperties.cpp:114</div></div>
<div class="ttc" id="aclass_t_xsh_level_html_a06176566e80858dbb206112db08a92b9"><div class="ttname"><a href="class_t_xsh_level.html#a06176566e80858dbb206112db08a92b9">TXshLevel::getScene</a></div><div class="ttdeci">ToonzScene * getScene() const</div><div class="ttdoc">Return the ToonzScene the level belongs to;.</div><div class="ttdef"><b>Definition:</b> txshlevel.h:87</div></div>
<div class="ttc" id="aclass_t_xsh_simple_level_html_a2fe15ee3d60e1f5f5c38d6ba75d36812"><div class="ttname"><a href="class_t_xsh_simple_level.html#a2fe15ee3d60e1f5f5c38d6ba75d36812">TXshSimpleLevel::getContentHistory</a></div><div class="ttdeci">const TContentHistory * getContentHistory() const</div><div class="ttdoc">note gets the contentHistory. can be 0</div><div class="ttdef"><b>Definition:</b> txshsimplelevel.h:291</div></div>
<div class="ttc" id="aclass_t_xsh_simple_level_html_a567daee4ca12a0e92445bcf98a6541f1"><div class="ttname"><a href="class_t_xsh_simple_level.html#a567daee4ca12a0e92445bcf98a6541f1">TXshSimpleLevel::getFids</a></div><div class="ttdeci">std::vector&lt; TFrameId &gt; getFids() const</div><div class="ttdoc">Returns a copy of the level's frame ids.</div><div class="ttdef"><b>Definition:</b> txshsimplelevel.cpp:448</div></div>
<div class="ttc" id="aclass_t_xsh_simple_level_html_a668293d53a70cca8811db28d87011c55"><div class="ttname"><a href="class_t_xsh_simple_level.html#a668293d53a70cca8811db28d87011c55">TXshSimpleLevel::getPath</a></div><div class="ttdeci">TFilePath getPath() const override</div><div class="ttdoc">Return the file path associated with the level.</div><div class="ttdef"><b>Definition:</b> txshsimplelevel.h:120</div></div>
<div class="ttc" id="aclass_t_xsh_simple_level_html_ad412dd5c3a6ae3ff20a480dc728b26d2"><div class="ttname"><a href="class_t_xsh_simple_level.html#ad412dd5c3a6ae3ff20a480dc728b26d2">TXshSimpleLevel::getProperties</a></div><div class="ttdeci">LevelProperties * getProperties() const</div><div class="ttdoc">&lt; Returns a pointer to the owned level properties.</div><div class="ttdef"><b>Definition:</b> txshsimplelevel.h:109</div></div>
<div class="ttc" id="aclass_toonz_scene_html_aa2ed57dfbae7f8cf02a4abe47ed533c6"><div class="ttname"><a href="class_toonz_scene.html#aa2ed57dfbae7f8cf02a4abe47ed533c6">ToonzScene::decodeFilePath</a></div><div class="ttdeci">TFilePath decodeFilePath(const TFilePath &amp;) const</div><div class="ttdef"><b>Definition:</b> toonzscene.cpp:1231</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01231">ToonzScene::decodeFilePath()</a>, <a class="el" href="#l00114">LevelProperties::getBpp()</a>, <a class="el" href="#l00291">TXshSimpleLevel::getContentHistory()</a>, <a class="el" href="#l00448">TXshSimpleLevel::getFids()</a>, <a class="el" href="#l00120">TXshSimpleLevel::getPath()</a>, <a class="el" href="#l00109">TXshSimpleLevel::getProperties()</a>, <a class="el" href="#l00087">TXshLevel::getScene()</a>, and <a class="el" href="#l00144">LevelProperties::hasAlpha()</a>.</p>

</div>
</div>
<a id="a4f7c67d1d6bec9272081144a4869897a" name="a4f7c67d1d6bec9272081144a4869897a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f7c67d1d6bec9272081144a4869897a">&#9670;&nbsp;</a></span>opened()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool LevelUpdater::opened </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  154</span>{ <span class="keywordflow">return</span> m_opened; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="abef1c4aa3413af02ccc0f5dcee5d2895" name="abef1c4aa3413af02ccc0f5dcee5d2895"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abef1c4aa3413af02ccc0f5dcee5d2895">&#9670;&nbsp;</a></span>update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LevelUpdater::update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_t_frame_id.html">TFrameId</a> &amp;&#160;</td>
          <td class="paramname"><em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_t_smart_pointer_t.html">TImageP</a> &amp;&#160;</td>
          <td class="paramname"><em>img</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Stores the supplied image in the level, at the specified frame. Remember that frames <b>must</b> be added with increasing fid ordering. </p>
<div class="fragment"><div class="line"><span class="lineno">  390</span>                                                                 {</div>
<div class="line"><span class="lineno">  391</span>  <span class="comment">// Resume open for write</span></div>
<div class="line"><span class="lineno">  392</span>  resume();</div>
<div class="line"><span class="lineno">  393</span> </div>
<div class="line"><span class="lineno">  394</span>  <span class="keywordflow">if</span> (!m_usingTemporaryFile) {</div>
<div class="line"><span class="lineno">  395</span>    <span class="comment">// Plain random access write if supported</span></div>
<div class="line"><span class="lineno">  396</span>    m_lw-&gt;getFrameWriter(fid)-&gt;save(img);</div>
<div class="line"><span class="lineno">  397</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  398</span>  }</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>  <span class="comment">// Otherwise, we must add every frame preceding fid, and *then* add img.</span></div>
<div class="line"><span class="lineno">  401</span>  <span class="comment">// NOTE: This requires that the image sequence is already sorted by fid.</span></div>
<div class="line"><span class="lineno">  402</span>  addFramesTo(std::lower_bound(m_fids.begin() + m_currIdx, m_fids.end(), fid) -</div>
<div class="line"><span class="lineno">  403</span>              m_fids.begin());</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>  <span class="comment">// Save the passed image. In case it overwrites a frame, erase that from the</span></div>
<div class="line"><span class="lineno">  406</span>  <span class="comment">// list too.</span></div>
<div class="line"><span class="lineno">  407</span>  m_lw-&gt;getFrameWriter(fid)-&gt;save(img);</div>
<div class="line"><span class="lineno">  408</span>  <span class="keywordflow">if</span> (m_currIdx &lt; <span class="keywordtype">int</span>(m_fids.size()) &amp;&amp; m_fids[m_currIdx] == fid) ++m_currIdx;</div>
<div class="line"><span class="lineno">  409</span>}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>E:/opentoonz/toonz/sources/include/toonz/<a class="el" href="">levelupdater.h</a></li>
<li>E:/opentoonz/toonz/sources/toonzlib/<a class="el" href="">levelupdater.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
