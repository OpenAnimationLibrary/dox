<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: ImageManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="class_image_manager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">ImageManager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="">imagemanager.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_image_manager_1_1_imp.html">Imp</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:af0a52a2580b51b6f4906688db28b3f9c"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <br />
&#160;&#160;<b>none</b> = 0x0
, <b>dontPutInCache</b> = 0x1
, <b>forceRebuild</b> = 0x2
, <b>toBeModified</b>
, <br />
&#160;&#160;<b>toBeSaved</b> = 0x8
, <b>is64bitEnabled</b> = 0x10
, <b>controlFlags</b> = 0xF
, <b>imageFlags</b>
<br />
 }</td></tr>
<tr class="separator:af0a52a2580b51b6f4906688db28b3f9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a77929fa41680f13417fe748f31a72493"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a77929fa41680f13417fe748f31a72493">bind</a> (const std::string &amp;id, <a class="el" href="class_image_builder.html">ImageBuilder</a> *builder)</td></tr>
<tr class="separator:a77929fa41680f13417fe748f31a72493"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab74305fdae38a7704081f7f777d0d80d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#ab74305fdae38a7704081f7f777d0d80d">unbind</a> (const std::string &amp;id)</td></tr>
<tr class="separator:ab74305fdae38a7704081f7f777d0d80d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53cd4c44dd7cbfdf435cb36d42d140fd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a53cd4c44dd7cbfdf435cb36d42d140fd">isBound</a> (const std::string &amp;id) const</td></tr>
<tr class="memdesc:a53cd4c44dd7cbfdf435cb36d42d140fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the specified id is bound to an image builder.  <a href="class_image_manager.html#a53cd4c44dd7cbfdf435cb36d42d140fd">More...</a><br /></td></tr>
<tr class="separator:a53cd4c44dd7cbfdf435cb36d42d140fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26ff2a78f046da1e442a5c37ab8a075b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a26ff2a78f046da1e442a5c37ab8a075b">rebind</a> (const std::string &amp;srcId, const std::string &amp;dstId)</td></tr>
<tr class="separator:a26ff2a78f046da1e442a5c37ab8a075b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d530b36fa5ec00d694728a2fd54044a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a5d530b36fa5ec00d694728a2fd54044a">renumber</a> (const std::string &amp;srcId, const <a class="el" href="class_t_frame_id.html">TFrameId</a> &amp;fid)</td></tr>
<tr class="separator:a5d530b36fa5ec00d694728a2fd54044a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1cdc120ba64146849566808dfdb8f9c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#af1cdc120ba64146849566808dfdb8f9c">clear</a> ()</td></tr>
<tr class="separator:af1cdc120ba64146849566808dfdb8f9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a117acd4bfe1dd03550fb8faa87071898"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a117acd4bfe1dd03550fb8faa87071898">loadAllTlvIconsAndPutInCache</a> (<a class="el" href="class_t_xsh_simple_level.html">TXshSimpleLevel</a> *, std::vector&lt; <a class="el" href="class_t_frame_id.html">TFrameId</a> &gt;, std::vector&lt; std::string &gt;, bool)</td></tr>
<tr class="separator:a117acd4bfe1dd03550fb8faa87071898"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a534298d4e7278e9e42764965e2389576"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_smart_pointer_t.html">TImageP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a534298d4e7278e9e42764965e2389576">getImage</a> (const std::string &amp;id, int imFlags, void *extData)</td></tr>
<tr class="separator:a534298d4e7278e9e42764965e2389576"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44231d6948d69f54e9a4315049131086"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_image_info.html">TImageInfo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a44231d6948d69f54e9a4315049131086">getInfo</a> (const std::string &amp;id, int imFlags, void *extData)</td></tr>
<tr class="separator:a44231d6948d69f54e9a4315049131086"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34bdaa25c84cd79a7518dbd233a947f4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a34bdaa25c84cd79a7518dbd233a947f4">invalidate</a> (const std::string &amp;id)</td></tr>
<tr class="separator:a34bdaa25c84cd79a7518dbd233a947f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf5a12cc6326ed3d4af2f5ae280ed355"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#aaf5a12cc6326ed3d4af2f5ae280ed355">setImage</a> (const std::string &amp;id, const <a class="el" href="class_t_smart_pointer_t.html">TImageP</a> &amp;img)</td></tr>
<tr class="separator:aaf5a12cc6326ed3d4af2f5ae280ed355"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5e52feb5a9cc1465727944c5b54a8ec"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_builder.html">ImageBuilder</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#ad5e52feb5a9cc1465727944c5b54a8ec">getBuilder</a> (const std::string &amp;id)</td></tr>
<tr class="separator:ad5e52feb5a9cc1465727944c5b54a8ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55ba571c9d452e718b91b2c35330c00c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a55ba571c9d452e718b91b2c35330c00c">isCached</a> (const std::string &amp;id)</td></tr>
<tr class="memdesc:a55ba571c9d452e718b91b2c35330c00c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns whether the identifier has an associated image in cache.  <a href="class_image_manager.html#a55ba571c9d452e718b91b2c35330c00c">More...</a><br /></td></tr>
<tr class="separator:a55ba571c9d452e718b91b2c35330c00c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1262cfa935f461f5641f83d696aca45"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#ad1262cfa935f461f5641f83d696aca45">isModified</a> (const std::string &amp;id)</td></tr>
<tr class="separator:ad1262cfa935f461f5641f83d696aca45"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a035a25f20657745639962afa7675a559"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="class_image_manager.html">ImageManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_manager.html#a035a25f20657745639962afa7675a559">instance</a> ()</td></tr>
<tr class="separator:a035a25f20657745639962afa7675a559"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p ><a class="el" href="class_image_manager.html">ImageManager</a> is a singleton management class that associates string identifiers to image-building objects, able to fetch images on request.</p>
<p >The <a class="el" href="class_image_manager.html">ImageManager</a>'s purpose is similar to that of <a class="el" href="class_t_image_cache.html">TImageCache</a> - which is Toonz's other images storage class - with the difference that users do not supply it directly with the image to be stored, but rather with an object <em>capable</em> of fetching that image. <br  />
<br  />
 Said objects must be reimplemented from the base <a class="el" href="class_image_builder.html">ImageBuilder</a> class, and return an image, and its specifications, upon request.</p>
<p >The role of these image-building objects is that of providing the <em>default</em> image for an identifier on-demand, without prior allocation of resources. <br  />
<br  />
 The <a class="el" href="class_image_manager.html">ImageManager</a> automatically stores built images in the global <a class="el" href="class_t_image_cache.html">TImageCache</a> instance (unless the user explicitly requires not to) in order to minimize the images building process. <br  />
<br  />
 As long as an image bound in the <a class="el" href="class_image_manager.html">ImageManager</a> remains unmodified, users can rebuild default images according to different control modifiers (for example, requiring 64-bit preference, or image subsampling). <br  />
<br  />
 Images stored in the <a class="el" href="class_image_manager.html">ImageManager</a> can be modified by the user (using the toBeModified control flag) or even externally supplied using the <a class="el" href="class_image_manager.html#aaf5a12cc6326ed3d4af2f5ae280ed355">setImage()</a> method.</p>
<p >When an image is modified, it is assumed to override any default-buildable images - thus it is stored in the cache for retrieval, and any control flag modifier is ignored as long as the image is not invalidated(). <br  />
<br  />
 Invalidation of an image can be requested to revert any changes to the image and clear the cache. <br  />
<br  />
 Please, observe that <a class="el" href="class_image_manager.html">ImageManager</a>'s image caching function is thread-safe - and ensures that image building happens only once in case multiple threads simultaneously require an image that was not cached before. Furthermore, there is no serialization overhead for already cached images or image specifications in read-only access.</p>
<dl class="section see"><dt>See also</dt><dd>The <a class="el" href="class_t_image_cache.html">TImageCache</a> and <a class="el" href="class_image_builder.html">ImageBuilder</a> classes. </dd></dl>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="af0a52a2580b51b6f4906688db28b3f9c" name="af0a52a2580b51b6f4906688db28b3f9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0a52a2580b51b6f4906688db28b3f9c">&#9670;&nbsp;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  106</span>       {</div>
<div class="line"><span class="lineno">  107</span>    none           = 0x0,</div>
<div class="line"><span class="lineno">  108</span>    dontPutInCache = 0x1,  <span class="comment">// Prevents IM from storing built images in the cache</span></div>
<div class="line"><span class="lineno">  109</span>    forceRebuild   = 0x2,  <span class="comment">// Forces rebuild of images (like an invalidate())</span></div>
<div class="line"><span class="lineno">  110</span>    toBeModified =</div>
<div class="line"><span class="lineno">  111</span>        0x4,          <span class="comment">// Whether the retrieved image will be signed as modified</span></div>
<div class="line"><span class="lineno">  112</span>    toBeSaved = 0x8,  <span class="comment">// User will save the image, reverts toBeModified</span></div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>    is64bitEnabled = 0x10,  <span class="comment">// Whether 64-bit rasters are allowed to return</span></div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>    controlFlags = 0xF,  <span class="comment">// Flags dealing with management control</span></div>
<div class="line"><span class="lineno">  117</span>    imageFlags =</div>
<div class="line"><span class="lineno">  118</span>        ~controlFlags  <span class="comment">// ImageManager flags supportable by custom ImageBuilders</span></div>
<div class="line"><span class="lineno">  119</span>  };</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a77929fa41680f13417fe748f31a72493" name="a77929fa41680f13417fe748f31a72493"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77929fa41680f13417fe748f31a72493">&#9670;&nbsp;</a></span>bind()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageManager::bind </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_image_builder.html">ImageBuilder</a> *&#160;</td>
          <td class="paramname"><em>builder</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Binds a string identifier to an <a class="el" href="class_image_builder.html">ImageBuilder</a> instance, which is necessary before any image or image data can be retrieved. If the specified id was already bound, it is first unbound. Binding an id to 0 is equivalent to unbinding it. </p>
<div class="fragment"><div class="line"><span class="lineno">  198</span>                                                                     {</div>
<div class="line"><span class="lineno">  199</span>  <span class="keywordflow">if</span> (!builderPtr) {</div>
<div class="line"><span class="lineno">  200</span>    <a class="code hl_function" href="class_image_manager.html#ab74305fdae38a7704081f7f777d0d80d">unbind</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  201</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  202</span>  }</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builderP = m_imp-&gt;m_builders[id];</div>
<div class="line"><span class="lineno">  207</span>  <span class="keywordflow">if</span> (builderP &amp;&amp; builderP-&gt;m_cached) TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a57d63227dfe2532b0aed22c47113be66">remove</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>  builderP = builderPtr;</div>
<div class="line"><span class="lineno">  210</span>}</div>
<div class="ttc" id="aclass_image_manager_html_ab74305fdae38a7704081f7f777d0d80d"><div class="ttname"><a href="class_image_manager.html#ab74305fdae38a7704081f7f777d0d80d">ImageManager::unbind</a></div><div class="ttdeci">bool unbind(const std::string &amp;id)</div><div class="ttdef"><b>Definition:</b> imagemanager.cpp:214</div></div>
<div class="ttc" id="aclass_t_image_cache_html_a57d63227dfe2532b0aed22c47113be66"><div class="ttname"><a href="class_t_image_cache.html#a57d63227dfe2532b0aed22c47113be66">TImageCache::remove</a></div><div class="ttdeci">void remove(const std::string &amp;id)</div><div class="ttdoc">Removes from the image cache the image associated to passed id.</div><div class="ttdef"><b>Definition:</b> timagecache.cpp:1260</div></div>
<div class="ttc" id="aclass_t_smart_pointer_t_html"><div class="ttname"><a href="class_t_smart_pointer_t.html">TSmartPointerT</a></div><div class="ttdef"><b>Definition:</b> tsmartpointer.h:105</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01260">TImageCache::remove()</a>, and <a class="el" href="#l00214">unbind()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00031">TXshChildLevel::~TXshChildLevel()</a>.</p>

</div>
</div>
<a id="af1cdc120ba64146849566808dfdb8f9c" name="af1cdc120ba64146849566808dfdb8f9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1cdc120ba64146849566808dfdb8f9c">&#9670;&nbsp;</a></span>clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageManager::clear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Unbinds all known identifiers, resetting the image manager to its empty state. </p>
<div class="fragment"><div class="line"><span class="lineno">  269</span>                         {</div>
<div class="line"><span class="lineno">  270</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>  TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a6d19207677efac341b81cb84a71924e4">clearSceneImages</a>();</div>
<div class="line"><span class="lineno">  273</span>  m_imp-&gt;clear();</div>
<div class="line"><span class="lineno">  274</span>}</div>
<div class="ttc" id="aclass_t_image_cache_html_a6d19207677efac341b81cb84a71924e4"><div class="ttname"><a href="class_t_image_cache.html#a6d19207677efac341b81cb84a71924e4">TImageCache::clearSceneImages</a></div><div class="ttdeci">void clearSceneImages()</div><div class="ttdef"><b>Definition:</b> timagecache.cpp:1388</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01388">TImageCache::clearSceneImages()</a>.</p>

</div>
</div>
<a id="ad5e52feb5a9cc1465727944c5b54a8ec" name="ad5e52feb5a9cc1465727944c5b54a8ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5e52feb5a9cc1465727944c5b54a8ec">&#9670;&nbsp;</a></span>getBuilder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_builder.html">ImageBuilder</a> * ImageManager::getBuilder </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Returns the <a class="el" href="class_image_builder.html">ImageBuilder</a> instance associate to specified id, or 0 if none was found. </p><dl class="section warning"><dt>Warning</dt><dd>The ImageManger retains ownership of the returned object, which must <b>not</b> be deleted. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  469</span>                                                          {</div>
<div class="line"><span class="lineno">  470</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  473</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  474</span>  <span class="keywordflow">return</span> (it == m_imp-&gt;m_builders.end()) ? (<a class="code hl_class" href="class_image_builder.html">ImageBuilder</a> *)0</div>
<div class="line"><span class="lineno">  475</span>                                         : it-&gt;second.getPointer();</div>
<div class="line"><span class="lineno">  476</span>}</div>
<div class="ttc" id="aclass_image_builder_html"><div class="ttname"><a href="class_image_builder.html">ImageBuilder</a></div><div class="ttdef"><b>Definition:</b> timagecache.cpp:143</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a534298d4e7278e9e42764965e2389576" name="a534298d4e7278e9e42764965e2389576"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a534298d4e7278e9e42764965e2389576">&#9670;&nbsp;</a></span>getImage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_smart_pointer_t.html">TImageP</a> ImageManager::getImage </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>imFlags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>extData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Returns the image built by the object associated with the specified identifier, using the supplied control flags for additional options. Provided the builder type associated to the identifier is known, a further external reference can be supplied to the request. In this case, users should enforce manual <a class="el" href="class_image_manager.html#a34bdaa25c84cd79a7518dbd233a947f4">invalidate()</a> invocations whenever the supplied data changes.</p>
<dl class="section warning"><dt>Warning</dt><dd>Users take responsibility in modifying the returned image's data <b>only</b> when imFlags contains the <code>toBeModified</code> bit. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  311</span>                                              {</div>
<div class="line"><span class="lineno">  312</span>  assert(!((imFlags &amp; ImageManager::toBeModified) &amp;&amp;</div>
<div class="line"><span class="lineno">  313</span>           (imFlags &amp; ImageManager::dontPutInCache)));</div>
<div class="line"><span class="lineno">  314</span>  assert(!((imFlags &amp; ImageManager::toBeModified) &amp;&amp;</div>
<div class="line"><span class="lineno">  315</span>           (imFlags &amp; ImageManager::toBeSaved)));</div>
<div class="line"><span class="lineno">  316</span> </div>
<div class="line"><span class="lineno">  317</span>  <span class="comment">// Lock for table read and try to find data in the cache</span></div>
<div class="line"><span class="lineno">  318</span>  QReadLocker tableLocker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  321</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  322</span>  <span class="keywordflow">if</span> (it == m_imp-&gt;m_builders.end()) <span class="keywordflow">return</span> <a class="code hl_class" href="class_t_smart_pointer_t.html">TImageP</a>();</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builder = it-&gt;second;</div>
<div class="line"><span class="lineno">  325</span>  <span class="keywordtype">bool</span> modified          = builder-&gt;m_modified;</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>  <span class="comment">// Analyze imFlags</span></div>
<div class="line"><span class="lineno">  328</span>  <span class="keywordtype">bool</span> _putInCache =</div>
<div class="line"><span class="lineno">  329</span>      TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a0da071a1466b04f8dc49052102d5e933">isEnabled</a>() &amp;&amp; !(bool)(imFlags &amp; dontPutInCache);</div>
<div class="line"><span class="lineno">  330</span>  <span class="keywordtype">bool</span> _toBeModified = (imFlags &amp; toBeModified);</div>
<div class="line"><span class="lineno">  331</span>  <span class="keywordtype">bool</span> _toBeSaved    = (imFlags &amp; toBeSaved);</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>  <span class="comment">// Update the modified flag according to the specified flags</span></div>
<div class="line"><span class="lineno">  334</span>  <span class="keywordflow">if</span> (_toBeModified)</div>
<div class="line"><span class="lineno">  335</span>    builder-&gt;m_modified = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  336</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_toBeSaved)</div>
<div class="line"><span class="lineno">  337</span>    builder-&gt;m_modified = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>  <span class="comment">// Now, fetch the image.</span></div>
<div class="line"><span class="lineno">  340</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">TImageP</a> img;</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>  <span class="keywordflow">if</span> (builder-&gt;m_cached) {</div>
<div class="line"><span class="lineno">  343</span>    <span class="keywordflow">if</span> (modified || builder-&gt;isImageCompatible(imFlags, extData)) {</div>
<div class="line"><span class="lineno">  344</span>      img = TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#aea3ac2752efd6fa9689f5a7c1e895e41">get</a>(<span class="keywordtype">id</span>, _toBeModified);</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>      assert(img);</div>
<div class="line"><span class="lineno">  347</span>      <span class="keywordflow">if</span> (img) <span class="keywordflow">return</span> img;</div>
<div class="line"><span class="lineno">  348</span>    }</div>
<div class="line"><span class="lineno">  349</span>  }</div>
<div class="line"><span class="lineno">  350</span> </div>
<div class="line"><span class="lineno">  351</span>  <span class="comment">// Lock for image building</span></div>
<div class="line"><span class="lineno">  352</span>  QWriteLocker imageBuildingLocker(&amp;builder-&gt;m_imageBuildingLock);</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>  <span class="comment">// As multiple threads may block on filesLocker, re-check if the image is now</span></div>
<div class="line"><span class="lineno">  355</span>  <span class="comment">// available</span></div>
<div class="line"><span class="lineno">  356</span>  <span class="keywordflow">if</span> (builder-&gt;m_cached) {</div>
<div class="line"><span class="lineno">  357</span>    <span class="keywordflow">if</span> (modified || builder-&gt;isImageCompatible(imFlags, extData)) {</div>
<div class="line"><span class="lineno">  358</span>      img = TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#aea3ac2752efd6fa9689f5a7c1e895e41">get</a>(<span class="keywordtype">id</span>, _toBeModified);</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>      assert(img);</div>
<div class="line"><span class="lineno">  361</span>      <span class="keywordflow">if</span> (img) <span class="keywordflow">return</span> img;</div>
<div class="line"><span class="lineno">  362</span>    }</div>
<div class="line"><span class="lineno">  363</span>  }</div>
<div class="line"><span class="lineno">  364</span> </div>
<div class="line"><span class="lineno">  365</span>  <span class="comment">// The image was either not available or not conforming to the required</span></div>
<div class="line"><span class="lineno">  366</span>  <span class="comment">// specifications.</span></div>
<div class="line"><span class="lineno">  367</span>  <span class="comment">// We have to build it now, then.</span></div>
<div class="line"><span class="lineno">  368</span> </div>
<div class="line"><span class="lineno">  369</span>  <span class="comment">// Build the image</span></div>
<div class="line"><span class="lineno">  370</span>  img = builder-&gt;build(imFlags, extData);</div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span>  <span class="keywordflow">if</span> (img &amp;&amp; _putInCache) {</div>
<div class="line"><span class="lineno">  373</span>    builder-&gt;m_cached   = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  374</span>    builder-&gt;m_modified = _toBeModified;</div>
<div class="line"><span class="lineno">  375</span> </div>
<div class="line"><span class="lineno">  376</span>    TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a124eae4cf370288f42c22b3477cb5163">add</a>(<span class="keywordtype">id</span>, img, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  377</span>  }</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>  <span class="keywordflow">return</span> img;</div>
<div class="line"><span class="lineno">  380</span>}</div>
<div class="ttc" id="aclass_t_image_cache_html_a0da071a1466b04f8dc49052102d5e933"><div class="ttname"><a href="class_t_image_cache.html#a0da071a1466b04f8dc49052102d5e933">TImageCache::isEnabled</a></div><div class="ttdeci">bool isEnabled()</div><div class="ttdoc">Returns true or false whether the cache is active or not.</div><div class="ttdef"><b>Definition:</b> timagecache.cpp:1111</div></div>
<div class="ttc" id="aclass_t_image_cache_html_a124eae4cf370288f42c22b3477cb5163"><div class="ttname"><a href="class_t_image_cache.html#a124eae4cf370288f42c22b3477cb5163">TImageCache::add</a></div><div class="ttdeci">void add(const std::string &amp;id, const TImageP &amp;img, bool overwrite=true)</div><div class="ttdef"><b>Definition:</b> timagecache.cpp:1153</div></div>
<div class="ttc" id="aclass_t_image_cache_html_aea3ac2752efd6fa9689f5a7c1e895e41"><div class="ttname"><a href="class_t_image_cache.html#aea3ac2752efd6fa9689f5a7c1e895e41">TImageCache::get</a></div><div class="ttdeci">TImageP get(const std::string &amp;id, bool toBeModified) const</div><div class="ttdef"><b>Definition:</b> timagecache.cpp:1672</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01153">TImageCache::add()</a>, <a class="el" href="#l01672">TImageCache::get()</a>, and <a class="el" href="#l01111">TImageCache::isEnabled()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00250">ImageRasterizer::build()</a>, <a class="el" href="#l00360">ImageFiller::build()</a>, <a class="el" href="#l00051">Stage::Player::image()</a>, and <a class="el" href="#l02091">TXshSimpleLevel::renumber()</a>.</p>

</div>
</div>
<a id="a44231d6948d69f54e9a4315049131086" name="a44231d6948d69f54e9a4315049131086"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44231d6948d69f54e9a4315049131086">&#9670;&nbsp;</a></span>getInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_image_info.html">TImageInfo</a> * ImageManager::getInfo </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>imFlags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>extData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Returns the image info associated to the specified identifier.</p>
<dl class="section warning"><dt>Warning</dt><dd>The return type is not explicitly <code>const</code> since some of <a class="el" href="class_t_image_info.html" title="Stores description data about a generic image.">TImageInfo</a>'s data (namely, the image's bounding box) may need to be modified by the user together with the associated image. Like in <a class="el" href="class_image_manager.html#a534298d4e7278e9e42764965e2389576">getImage()</a>, users take responsibility in modifying the returned data <b>only</b> when imFlags contains the <code>toBeModified</code> bit. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  279</span>                                                 {</div>
<div class="line"><span class="lineno">  280</span>  <span class="comment">// Lock for table read and try to find data in the cache</span></div>
<div class="line"><span class="lineno">  281</span>  QReadLocker tableLocker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  284</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  285</span>  <span class="keywordflow">if</span> (it == m_imp-&gt;m_builders.end()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builder = it-&gt;second;</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>  assert(!((imFlags &amp; ImageManager::toBeModified) &amp;&amp; !builder-&gt;m_modified));</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>  <span class="comment">// Check cached data</span></div>
<div class="line"><span class="lineno">  292</span>  <span class="keywordflow">if</span> (builder-&gt;areInfosCompatible(imFlags, extData)) <span class="keywordflow">return</span> &amp;builder-&gt;m_info;</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>  QWriteLocker imageBuildingLocker(&amp;builder-&gt;m_imageBuildingLock);</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>  <span class="comment">// Re-check as waiting may have changed the situation</span></div>
<div class="line"><span class="lineno">  297</span>  <span class="keywordflow">if</span> (builder-&gt;areInfosCompatible(imFlags, extData)) <span class="keywordflow">return</span> &amp;builder-&gt;m_info;</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>  <a class="code hl_class" href="class_t_image_info.html">TImageInfo</a> info;</div>
<div class="line"><span class="lineno">  300</span>  <span class="keywordflow">if</span> (builder-&gt;getInfo(info, imFlags, extData)) {</div>
<div class="line"><span class="lineno">  301</span>    builder-&gt;m_info = info;</div>
<div class="line"><span class="lineno">  302</span>    <span class="keywordflow">return</span> &amp;builder-&gt;m_info;</div>
<div class="line"><span class="lineno">  303</span>  }</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  306</span>}</div>
<div class="ttc" id="aclass_t_image_info_html"><div class="ttname"><a href="class_t_image_info.html">TImageInfo</a></div><div class="ttdoc">Stores description data about a generic image.</div><div class="ttdef"><b>Definition:</b> timageinfo.h:35</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l02360">TXshSimpleLevel::getBBox()</a>, and <a class="el" href="#l01083">TXshSimpleLevel::load()</a>.</p>

</div>
</div>
<a id="a035a25f20657745639962afa7675a559" name="a035a25f20657745639962afa7675a559"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a035a25f20657745639962afa7675a559">&#9670;&nbsp;</a></span>instance()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_manager.html">ImageManager</a> * ImageManager::instance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  190</span>                                     {</div>
<div class="line"><span class="lineno">  191</span>  <span class="comment">// Re-introdotto possibile baco: voglio controllare se esiste ancora</span></div>
<div class="line"><span class="lineno">  192</span>  <span class="keyword">static</span> <a class="code hl_class" href="class_image_manager.html">ImageManager</a> theInstance;</div>
<div class="line"><span class="lineno">  193</span>  <span class="keywordflow">return</span> &amp;theInstance;</div>
<div class="line"><span class="lineno">  194</span>}</div>
<div class="ttc" id="aclass_image_manager_html"><div class="ttname"><a href="class_image_manager.html">ImageManager</a></div><div class="ttdef"><b>Definition:</b> imagemanager.h:104</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a34bdaa25c84cd79a7518dbd233a947f4" name="a34bdaa25c84cd79a7518dbd233a947f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34bdaa25c84cd79a7518dbd233a947f4">&#9670;&nbsp;</a></span>invalidate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::invalidate </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Invalidates cached data associated to the specified id, forcing the next <a class="el" href="class_image_manager.html#a44231d6948d69f54e9a4315049131086">getInfo()</a> or <a class="el" href="class_image_manager.html#a534298d4e7278e9e42764965e2389576">getImage()</a> to rebuild it. </p>
<div class="fragment"><div class="line"><span class="lineno">  426</span>                                                 {</div>
<div class="line"><span class="lineno">  427</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  430</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  431</span>  <span class="keywordflow">if</span> (it == m_imp-&gt;m_builders.end()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builder = it-&gt;second;</div>
<div class="line"><span class="lineno">  434</span> </div>
<div class="line"><span class="lineno">  435</span>  builder-&gt;invalidate();</div>
<div class="line"><span class="lineno">  436</span>  builder-&gt;m_cached = builder-&gt;m_modified = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  437</span> </div>
<div class="line"><span class="lineno">  438</span>  TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a57d63227dfe2532b0aed22c47113be66">remove</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  439</span> </div>
<div class="line"><span class="lineno">  440</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  441</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01260">TImageCache::remove()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00351">TXshSimpleLevel::onPaletteChanged()</a>, <a class="el" href="#l00445">setImage()</a>, and <a class="el" href="#l00330">TXshSimpleLevel::touchFrame()</a>.</p>

</div>
</div>
<a id="a53cd4c44dd7cbfdf435cb36d42d140fd" name="a53cd4c44dd7cbfdf435cb36d42d140fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53cd4c44dd7cbfdf435cb36d42d140fd">&#9670;&nbsp;</a></span>isBound()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::isBound </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if the specified id is bound to an image builder. </p>
<div class="fragment"><div class="line"><span class="lineno">  230</span>                                                    {</div>
<div class="line"><span class="lineno">  231</span>  QReadLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  232</span>  <span class="keywordflow">return</span> m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>) != m_imp-&gt;m_builders.end();</div>
<div class="line"><span class="lineno">  233</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l02091">TXshSimpleLevel::renumber()</a>.</p>

</div>
</div>
<a id="a55ba571c9d452e718b91b2c35330c00c" name="a55ba571c9d452e718b91b2c35330c00c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55ba571c9d452e718b91b2c35330c00c">&#9670;&nbsp;</a></span>isCached()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::isCached </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns whether the identifier has an associated image in cache. </p>
<div class="fragment"><div class="line"><span class="lineno">  480</span>                                               {</div>
<div class="line"><span class="lineno">  481</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  482</span> </div>
<div class="line"><span class="lineno">  483</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  484</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  485</span>  <span class="keywordflow">return</span> (it == m_imp-&gt;m_builders.end()) ? false : it-&gt;second-&gt;m_cached;</div>
<div class="line"><span class="lineno">  486</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad1262cfa935f461f5641f83d696aca45" name="ad1262cfa935f461f5641f83d696aca45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1262cfa935f461f5641f83d696aca45">&#9670;&nbsp;</a></span>isModified()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::isModified </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Returns whether the image associated to the specified id has been modified. Observe that modifying an image overrides the build-up of the associated default image - ie any subsequent call to <a class="el" href="class_image_manager.html#a534298d4e7278e9e42764965e2389576">getImage()</a> will ignore control flags and return the stored modified image. </p>
<div class="fragment"><div class="line"><span class="lineno">  490</span>                                                 {</div>
<div class="line"><span class="lineno">  491</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  492</span> </div>
<div class="line"><span class="lineno">  493</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  494</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  495</span>  <span class="keywordflow">return</span> (it == m_imp-&gt;m_builders.end()) ? false : it-&gt;second-&gt;m_modified;</div>
<div class="line"><span class="lineno">  496</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a117acd4bfe1dd03550fb8faa87071898" name="a117acd4bfe1dd03550fb8faa87071898"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a117acd4bfe1dd03550fb8faa87071898">&#9670;&nbsp;</a></span>loadAllTlvIconsAndPutInCache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ImageManager::loadAllTlvIconsAndPutInCache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_xsh_simple_level.html">TXshSimpleLevel</a> *&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="class_t_frame_id.html">TFrameId</a> &gt;&#160;</td>
          <td class="paramname"><em>fids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt;&#160;</td>
          <td class="paramname"><em>iconIds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>cacheImagesAsWell</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  386</span>                                                          {</div>
<div class="line"><span class="lineno">  387</span>  <span class="keywordflow">if</span> (fids.empty() || iconIds.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  388</span>  <span class="comment">// number of fid and iconId should be the same</span></div>
<div class="line"><span class="lineno">  389</span>  <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)fids.size() != (<span class="keywordtype">int</span>)iconIds.size()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>  <span class="comment">// obtain ImageLoader with the first fId</span></div>
<div class="line"><span class="lineno">  392</span>  <a class="code hl_class" href="class_t_image_info.html">TImageInfo</a> info;</div>
<div class="line"><span class="lineno">  393</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  394</span>      m_imp-&gt;m_builders.find(level-&gt;getImageId(fids[0]));</div>
<div class="line"><span class="lineno">  395</span>  <span class="keywordflow">if</span> (it != m_imp-&gt;m_builders.end()) {</div>
<div class="line"><span class="lineno">  396</span>    <span class="keyword">const</span> <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builder = it-&gt;second;</div>
<div class="line"><span class="lineno">  397</span>    assert(builder);</div>
<div class="line"><span class="lineno">  398</span>    assert(builder-&gt;getRefCount() &gt; 0);</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>    <span class="comment">// this function in reimplemented only in ImageLoader</span></div>
<div class="line"><span class="lineno">  401</span>    builder-&gt;buildAllIconsAndPutInCache(level, fids, iconIds,</div>
<div class="line"><span class="lineno">  402</span>                                        cacheImagesAsWell);</div>
<div class="line"><span class="lineno">  403</span>    builder-&gt;getInfo(info, ImageManager::none, 0);</div>
<div class="line"><span class="lineno">  404</span>  }</div>
<div class="line"><span class="lineno">  405</span>  <span class="keywordflow">if</span> (cacheImagesAsWell) {</div>
<div class="line"><span class="lineno">  406</span>    <span class="comment">// reset the savebox</span></div>
<div class="line"><span class="lineno">  407</span>    info.m_x0 = info.m_y0 = 0;</div>
<div class="line"><span class="lineno">  408</span>    info.m_x1             = info.m_lx - 1;</div>
<div class="line"><span class="lineno">  409</span>    info.m_y1             = info.m_ly - 1;</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>    <span class="comment">// put flags to all builders</span></div>
<div class="line"><span class="lineno">  412</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> f = 0; f &lt; fids.size(); f++) {</div>
<div class="line"><span class="lineno">  413</span>      std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  414</span>          m_imp-&gt;m_builders.find(level-&gt;getImageId(fids[f]));</div>
<div class="line"><span class="lineno">  415</span>      <span class="keywordflow">if</span> (it != m_imp-&gt;m_builders.end()) {</div>
<div class="line"><span class="lineno">  416</span>        <span class="keyword">const</span> <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builder = it-&gt;second;</div>
<div class="line"><span class="lineno">  417</span>        builder-&gt;setImageCachedAndModified();</div>
<div class="line"><span class="lineno">  418</span>        builder-&gt;m_info = info;</div>
<div class="line"><span class="lineno">  419</span>      }</div>
<div class="line"><span class="lineno">  420</span>    }</div>
<div class="line"><span class="lineno">  421</span>  }</div>
<div class="line"><span class="lineno">  422</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a26ff2a78f046da1e442a5c37ab8a075b" name="a26ff2a78f046da1e442a5c37ab8a075b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26ff2a78f046da1e442a5c37ab8a075b">&#9670;&nbsp;</a></span>rebind()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::rebind </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>srcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>dstId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Rebinds to a different builder identifier, returning true if the operation succeeded. </p>
<div class="fragment"><div class="line"><span class="lineno">  237</span>                                                                        {</div>
<div class="line"><span class="lineno">  238</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator st =</div>
<div class="line"><span class="lineno">  241</span>      m_imp-&gt;m_builders.find(srcId);</div>
<div class="line"><span class="lineno">  242</span>  <span class="keywordflow">if</span> (st == m_imp-&gt;m_builders.end()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> builder = st-&gt;second;</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>  m_imp-&gt;m_builders.erase(st);</div>
<div class="line"><span class="lineno">  247</span>  m_imp-&gt;m_builders[dstId] = builder;</div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>  m_imp-&gt;m_builders[dstId]-&gt;m_cached   = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  250</span>  m_imp-&gt;m_builders[dstId]-&gt;m_modified = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>  TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a4a55f603009d6f1d884f9d1afee94178">remap</a>(dstId, srcId);</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  255</span>}</div>
<div class="ttc" id="aclass_t_image_cache_html_a4a55f603009d6f1d884f9d1afee94178"><div class="ttname"><a href="class_t_image_cache.html#a4a55f603009d6f1d884f9d1afee94178">TImageCache::remap</a></div><div class="ttdeci">void remap(const std::string &amp;dstId, const std::string &amp;srcId)</div><div class="ttdoc">Rebinds the association between a previously cached image and its id.</div><div class="ttdef"><b>Definition:</b> timagecache.cpp:1317</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01317">TImageCache::remap()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01883">TXshSimpleLevel::makeTlv()</a>, and <a class="el" href="#l02091">TXshSimpleLevel::renumber()</a>.</p>

</div>
</div>
<a id="a5d530b36fa5ec00d694728a2fd54044a" name="a5d530b36fa5ec00d694728a2fd54044a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d530b36fa5ec00d694728a2fd54044a">&#9670;&nbsp;</a></span>renumber()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::renumber </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>srcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_t_frame_id.html">TFrameId</a> &amp;&#160;</td>
          <td class="paramname"><em>fid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  257</span>                                                                       {</div>
<div class="line"><span class="lineno">  258</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator st =</div>
<div class="line"><span class="lineno">  259</span>      m_imp-&gt;m_builders.find(srcId);</div>
<div class="line"><span class="lineno">  260</span>  <span class="keywordflow">if</span> (st == m_imp-&gt;m_builders.end()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>  m_imp-&gt;m_builders[srcId]-&gt;setFid(fid);</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  265</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aaf5a12cc6326ed3d4af2f5ae280ed355" name="aaf5a12cc6326ed3d4af2f5ae280ed355"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf5a12cc6326ed3d4af2f5ae280ed355">&#9670;&nbsp;</a></span>setImage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::setImage </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_t_smart_pointer_t.html">TImageP</a> &amp;&#160;</td>
          <td class="paramname"><em>img</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Overrides the image builder, and manually associates an image to the specified identifier, putting the image in cache and updating the stored image info. If the image reference is empty, the result is equivalent to <a class="el" href="class_image_manager.html#a34bdaa25c84cd79a7518dbd233a947f4">invalidate()</a>. </p>
<div class="fragment"><div class="line"><span class="lineno">  445</span>                                                                   {</div>
<div class="line"><span class="lineno">  446</span>  <span class="keywordflow">if</span> (!img) <span class="keywordflow">return</span> <a class="code hl_function" href="class_image_manager.html#a34bdaa25c84cd79a7518dbd233a947f4">invalidate</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  447</span> </div>
<div class="line"><span class="lineno">  448</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  451</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  452</span>  <span class="keywordflow">if</span> (it == m_imp-&gt;m_builders.end()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builder = it-&gt;second;</div>
<div class="line"><span class="lineno">  455</span> </div>
<div class="line"><span class="lineno">  456</span>  builder-&gt;invalidate();  <span class="comment">// WARNING: Not all infos are correctly restored</span></div>
<div class="line"><span class="lineno">  457</span>  ImageBuilder::setImageInfo(</div>
<div class="line"><span class="lineno">  458</span>      builder-&gt;m_info,</div>
<div class="line"><span class="lineno">  459</span>      img.getPointer());  <span class="comment">// from supplied image - must investigate further...</span></div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>  TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a124eae4cf370288f42c22b3477cb5163">add</a>(<span class="keywordtype">id</span>, img, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  462</span>  builder-&gt;m_cached = builder-&gt;m_modified = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  465</span>}</div>
<div class="ttc" id="aclass_image_manager_html_a34bdaa25c84cd79a7518dbd233a947f4"><div class="ttname"><a href="class_image_manager.html#a34bdaa25c84cd79a7518dbd233a947f4">ImageManager::invalidate</a></div><div class="ttdeci">bool invalidate(const std::string &amp;id)</div><div class="ttdef"><b>Definition:</b> imagemanager.cpp:426</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01153">TImageCache::add()</a>, and <a class="el" href="#l00426">invalidate()</a>.</p>

</div>
</div>
<a id="ab74305fdae38a7704081f7f777d0d80d" name="ab74305fdae38a7704081f7f777d0d80d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab74305fdae38a7704081f7f777d0d80d">&#9670;&nbsp;</a></span>unbind()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageManager::unbind </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Unbinds the specified identifier, returning true if the operation succeeded. </p>
<div class="fragment"><div class="line"><span class="lineno">  214</span>                                             {</div>
<div class="line"><span class="lineno">  215</span>  QWriteLocker locker(&amp;m_imp-&gt;m_tableLock);</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>  std::map&lt;std::string, ImageBuilderP&gt;::iterator it =</div>
<div class="line"><span class="lineno">  218</span>      m_imp-&gt;m_builders.find(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  219</span>  <span class="keywordflow">if</span> (it == m_imp-&gt;m_builders.end()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">ImageBuilderP</a> &amp;builderP = it-&gt;second;</div>
<div class="line"><span class="lineno">  222</span>  <span class="keywordflow">if</span> (builderP &amp;&amp; builderP-&gt;m_cached) TImageCache::instance()-&gt;<a class="code hl_function" href="class_t_image_cache.html#a57d63227dfe2532b0aed22c47113be66">remove</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>  m_imp-&gt;m_builders.erase(it);</div>
<div class="line"><span class="lineno">  225</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  226</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01260">TImageCache::remove()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00198">bind()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>E:/opentoonz/toonz/sources/include/toonz/<a class="el" href="">imagemanager.h</a></li>
<li>E:/opentoonz/toonz/sources/toonzlib/<a class="el" href="">imagemanager.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
