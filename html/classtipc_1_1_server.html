<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: tipc::Server Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacetipc.html">tipc</a></li><li class="navelem"><a class="el" href="classtipc_1_1_server.html">Server</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-slots">Public Slots</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classtipc_1_1_server-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">tipc::Server Class Reference<span class="mlabels"><span class="mlabel">final</span></span></div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="">tipcsrv.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for tipc::Server:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classtipc_1_1_server.png" alt=""/>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-slots" name="pub-slots"></a>
Public Slots</h2></td></tr>
<tr class="memitem:a4389317268a1a30a6ad18028a5054895"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtipc_1_1_server.html#a4389317268a1a30a6ad18028a5054895">onNewConnection</a> ()</td></tr>
<tr class="separator:a4389317268a1a30a6ad18028a5054895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdc655fa7983f262d310a7d615bae7a5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtipc_1_1_server.html#abdc655fa7983f262d310a7d615bae7a5">onError</a> (QLocalSocket::LocalSocketError)</td></tr>
<tr class="separator:abdc655fa7983f262d310a7d615bae7a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2c0797be8f3e662143af3777c746370e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtipc_1_1_server.html#a2c0797be8f3e662143af3777c746370e">addParser</a> (<a class="el" href="classtipc_1_1_message_parser.html">MessageParser</a> *parser)</td></tr>
<tr class="separator:a2c0797be8f3e662143af3777c746370e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4d7595aea65c358e7dbf6e983cda3a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtipc_1_1_server.html#ad4d7595aea65c358e7dbf6e983cda3a4">removeParser</a> (QString header)</td></tr>
<tr class="separator:ad4d7595aea65c358e7dbf6e983cda3a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a931dd6155681015c4f64653f4a99ea46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtipc_1_1_server.html#a931dd6155681015c4f64653f4a99ea46">dispatchSocket</a> (QLocalSocket *socket)</td></tr>
<tr class="separator:a931dd6155681015c4f64653f4a99ea46"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >The <a class="el" href="classtipc_1_1_server.html">tipc::Server</a> class is the base server class for inter-process communication in Toonz-related applications.</p>
<p >A <a class="el" href="classtipc_1_1_server.html">tipc::Server</a> is a specialized QLocalServer which stores header/message-callback associations to perform message parsing. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="abee76ea64103fb9031f29d4895cf32d7" name="abee76ea64103fb9031f29d4895cf32d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abee76ea64103fb9031f29d4895cf32d7">&#9670;&nbsp;</a></span>Server()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tipc::Server::Server </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   53</span>                   : m_lock(<span class="keyword">false</span>) {</div>
<div class="line"><span class="lineno">   54</span>  connect(<span class="keyword">this</span>, SIGNAL(newConnection()), <span class="keyword">this</span>, SLOT(<a class="code hl_slot" href="classtipc_1_1_server.html#a4389317268a1a30a6ad18028a5054895">onNewConnection</a>()));</div>
<div class="line"><span class="lineno">   55</span> </div>
<div class="line"><span class="lineno">   56</span>  <span class="comment">// Add default parsers</span></div>
<div class="line"><span class="lineno">   57</span>  addParser(<span class="keyword">new</span> DefaultMessageParser&lt;SHMEM_REQUEST&gt;);</div>
<div class="line"><span class="lineno">   58</span>  addParser(<span class="keyword">new</span> DefaultMessageParser&lt;SHMEM_RELEASE&gt;);</div>
<div class="line"><span class="lineno">   59</span>  addParser(<span class="keyword">new</span> DefaultMessageParser&lt;TMPFILE_REQUEST&gt;);</div>
<div class="line"><span class="lineno">   60</span>  addParser(<span class="keyword">new</span> DefaultMessageParser&lt;TMPFILE_RELEASE&gt;);</div>
<div class="line"><span class="lineno">   61</span>  addParser(<span class="keyword">new</span> DefaultMessageParser&lt;QUIT_ON_ERROR&gt;);</div>
<div class="line"><span class="lineno">   62</span>}</div>
<div class="ttc" id="aclasstipc_1_1_server_html_a4389317268a1a30a6ad18028a5054895"><div class="ttname"><a href="classtipc_1_1_server.html#a4389317268a1a30a6ad18028a5054895">tipc::Server::onNewConnection</a></div><div class="ttdeci">void onNewConnection()</div><div class="ttdef"><b>Definition:</b> tipcsrv.cpp:87</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b43253db3b7fa22a255ea11e055d906" name="a4b43253db3b7fa22a255ea11e055d906"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b43253db3b7fa22a255ea11e055d906">&#9670;&nbsp;</a></span>~Server()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tipc::Server::~Server </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   66</span>                    {</div>
<div class="line"><span class="lineno">   67</span>  <span class="comment">// Release parsers</span></div>
<div class="line"><span class="lineno">   68</span>  QHash&lt;QString, MessageParser *&gt;::iterator it;</div>
<div class="line"><span class="lineno">   69</span>  <span class="keywordflow">for</span> (it = m_parsers.begin(); it != m_parsers.end(); ++it) <span class="keyword">delete</span> it.value();</div>
<div class="line"><span class="lineno">   70</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2c0797be8f3e662143af3777c746370e" name="a2c0797be8f3e662143af3777c746370e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c0797be8f3e662143af3777c746370e">&#9670;&nbsp;</a></span>addParser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tipc::Server::addParser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtipc_1_1_message_parser.html">MessageParser</a> *&#160;</td>
          <td class="paramname"><em>parser</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   74</span>                                                {</div>
<div class="line"><span class="lineno">   75</span>  m_parsers.insert(parser-&gt;header(), parser);</div>
<div class="line"><span class="lineno">   76</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a931dd6155681015c4f64653f4a99ea46" name="a931dd6155681015c4f64653f4a99ea46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a931dd6155681015c4f64653f4a99ea46">&#9670;&nbsp;</a></span>dispatchSocket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tipc::Server::dispatchSocket </td>
          <td>(</td>
          <td class="paramtype">QLocalSocket *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Generic dispatcher function for socket messages. Acceptable socket messages are composed of a header and a body part. The header part, containing an explanation of the message's body, is the first line of the message, and is expected to be at max 1024 chars long. Depending on the header content, the rest of the message is read in specialized message handler functions. </p>
<div class="fragment"><div class="line"><span class="lineno">  114</span>                                                    {</div>
<div class="line"><span class="lineno">  115</span>  <span class="comment">// The lock is established when a message is currently being processed.</span></div>
<div class="line"><span class="lineno">  116</span>  <span class="comment">// Returning if the lock is set avoids having recursive message processing;</span></div>
<div class="line"><span class="lineno">  117</span>  <span class="comment">// which is possible if a parser expects further message packets.</span></div>
<div class="line"><span class="lineno">  118</span>  <span class="keywordflow">if</span> (m_lock) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>  <a class="code hl_class" href="classtipc_1_1_stream.html">tipc::Stream</a> stream(socket);</div>
<div class="line"><span class="lineno">  121</span>  QString header;</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>  <span class="keywordflow">while</span> (socket-&gt;bytesAvailable() &gt; 0) {</div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">if</span> (!stream.messageReady()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>    Message msg;</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    stream &gt;&gt; msg;</div>
<div class="line"><span class="lineno">  129</span>    msg &gt;&gt; header;</div>
<div class="line"><span class="lineno">  130</span>    assert(!header.isEmpty());</div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span>    tipc_debug(qDebug() &lt;&lt; header &lt;&lt; endl);</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>    QHash&lt;QString, MessageParser *&gt;::iterator it = m_parsers.find(header);</div>
<div class="line"><span class="lineno">  135</span>    <span class="keywordflow">if</span> (it == m_parsers.end()) {</div>
<div class="line"><span class="lineno">  136</span>      tipc_debug(qDebug() &lt;&lt; <span class="stringliteral">&quot;Error: Unrecognized command&quot;</span> &lt;&lt; endl);</div>
<div class="line"><span class="lineno">  137</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  138</span>    }</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>    m_lock = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    MessageParser *parser = it.value();</div>
<div class="line"><span class="lineno">  143</span>    parser-&gt;m_socket      = socket;</div>
<div class="line"><span class="lineno">  144</span>    parser-&gt;m_stream      = &amp;stream;</div>
<div class="line"><span class="lineno">  145</span>    parser-&gt;operator()(msg);</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    m_lock = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>    <span class="comment">// The Message has been read and processed. Send the reply.</span></div>
<div class="line"><span class="lineno">  150</span>    <span class="keywordflow">if</span> (msg.ba().size() &gt; 0) stream &lt;&lt; msg;</div>
<div class="line"><span class="lineno">  151</span>  }</div>
<div class="line"><span class="lineno">  152</span>}</div>
<div class="ttc" id="aclasstipc_1_1_stream_html"><div class="ttname"><a href="classtipc_1_1_stream.html">tipc::Stream</a></div><div class="ttdef"><b>Definition:</b> tipc.h:125</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abdc655fa7983f262d310a7d615bae7a5" name="abdc655fa7983f262d310a7d615bae7a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdc655fa7983f262d310a7d615bae7a5">&#9670;&nbsp;</a></span>onError</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tipc::Server::onError </td>
          <td>(</td>
          <td class="paramtype">QLocalSocket::LocalSocketError&#160;</td>
          <td class="paramname"><em>error</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">slot</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  108</span>                                                           {</div>
<div class="line"><span class="lineno">  109</span>  tipc_debug(qDebug() &lt;&lt; <span class="stringliteral">&quot;Server error #&quot;</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; errorString());</div>
<div class="line"><span class="lineno">  110</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4389317268a1a30a6ad18028a5054895" name="a4389317268a1a30a6ad18028a5054895"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4389317268a1a30a6ad18028a5054895">&#9670;&nbsp;</a></span>onNewConnection</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tipc::Server::onNewConnection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">slot</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Receives a client connection to the server and prepares a socket for the connection. </p>
<div class="fragment"><div class="line"><span class="lineno">   87</span>                                 {</div>
<div class="line"><span class="lineno">   88</span>  tipc_debug(qDebug(<span class="stringliteral">&quot;new connection&quot;</span>));</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>  <span class="comment">// Accept the connection</span></div>
<div class="line"><span class="lineno">   91</span>  QLocalSocket *socket = nextPendingConnection();</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>  <span class="comment">// Allocate a controller for the socket</span></div>
<div class="line"><span class="lineno">   94</span>  SocketController *controller = <span class="keyword">new</span> SocketController;</div>
<div class="line"><span class="lineno">   95</span>  controller-&gt;m_server         = <span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">   96</span>  controller-&gt;m_socket         = socket;</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>  <span class="comment">// Connect the controller to the socket&#39;s signals</span></div>
<div class="line"><span class="lineno">   99</span>  connect(socket, SIGNAL(readyRead()), controller, SLOT(onReadyRead()));</div>
<div class="line"><span class="lineno">  100</span>  connect(socket, SIGNAL(disconnected()), controller, SLOT(onDisconnected()));</div>
<div class="line"><span class="lineno">  101</span>  connect(socket, SIGNAL(disconnected()), socket, SLOT(deleteLater()));</div>
<div class="line"><span class="lineno">  102</span>  connect(socket, SIGNAL(error(QLocalSocket::LocalSocketError)), <span class="keyword">this</span>,</div>
<div class="line"><span class="lineno">  103</span>          SLOT(onError(QLocalSocket::LocalSocketError)));</div>
<div class="line"><span class="lineno">  104</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4d7595aea65c358e7dbf6e983cda3a4" name="ad4d7595aea65c358e7dbf6e983cda3a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4d7595aea65c358e7dbf6e983cda3a4">&#9670;&nbsp;</a></span>removeParser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tipc::Server::removeParser </td>
          <td>(</td>
          <td class="paramtype">QString&#160;</td>
          <td class="paramname"><em>header</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   80</span>                                            {</div>
<div class="line"><span class="lineno">   81</span>  MessageParser *parser = m_parsers.take(header);</div>
<div class="line"><span class="lineno">   82</span>  <span class="keywordflow">if</span> (parser) <span class="keyword">delete</span> parser;</div>
<div class="line"><span class="lineno">   83</span>}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>E:/opentoonz/toonz/sources/include/<a class="el" href="">tipcsrv.h</a></li>
<li>E:/opentoonz/toonz/sources/common/tipc/<a class="el" href="">tipcsrv.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
