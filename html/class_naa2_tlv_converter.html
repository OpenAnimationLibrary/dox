<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: Naa2TlvConverter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="class_naa2_tlv_converter-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">Naa2TlvConverter Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a132f6dbc74f18919c82e1d09eeda44a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a132f6dbc74f18919c82e1d09eeda44a0">setSourceImage</a> (const <a class="el" href="class_t_raster_p_t.html">TRaster32P</a> &amp;srcRas)</td></tr>
<tr class="separator:a132f6dbc74f18919c82e1d09eeda44a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8363dc9951f08203745420ef89b65848"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a8363dc9951f08203745420ef89b65848">setPalette</a> (<a class="el" href="class_t_palette.html">TPalette</a> *palette)</td></tr>
<tr class="separator:a8363dc9951f08203745420ef89b65848"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19266e6fc236f1c71037b4ff9037f447"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_palette.html">TPalette</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a19266e6fc236f1c71037b4ff9037f447">getPalette</a> () const</td></tr>
<tr class="separator:a19266e6fc236f1c71037b4ff9037f447"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c95132fcdc0f8e7243b526c34929cbb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a9c95132fcdc0f8e7243b526c34929cbb">separateRegions</a> ()</td></tr>
<tr class="separator:a9c95132fcdc0f8e7243b526c34929cbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b691387ed3777720d7560944c91fc34"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a4b691387ed3777720d7560944c91fc34">computeLinks</a> ()</td></tr>
<tr class="separator:a4b691387ed3777720d7560944c91fc34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e685ba8107ef1dbe30dd4a49d347193"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a0e685ba8107ef1dbe30dd4a49d347193">findRegionBorders</a> ()</td></tr>
<tr class="separator:a0e685ba8107ef1dbe30dd4a49d347193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5094e8e50745238644eaf21645dffb1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#ae5094e8e50745238644eaf21645dffb1">erodeRegions</a> ()</td></tr>
<tr class="separator:ae5094e8e50745238644eaf21645dffb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2988866d4a3609b1ca1318867e723141"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a2988866d4a3609b1ca1318867e723141">computeMainInkThickness</a> ()</td></tr>
<tr class="separator:a2988866d4a3609b1ca1318867e723141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93df5ceb3d392b0da338ba54d8854181"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a93df5ceb3d392b0da338ba54d8854181">assignColorTypes</a> ()</td></tr>
<tr class="separator:a93df5ceb3d392b0da338ba54d8854181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6496d92f56d05170610a871c0228af77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a6496d92f56d05170610a871c0228af77">addBorderInks</a> ()</td></tr>
<tr class="separator:a6496d92f56d05170610a871c0228af77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a636358a90fd9e6491f535fc09cddb693"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a636358a90fd9e6491f535fc09cddb693">findBackgroundRegions</a> ()</td></tr>
<tr class="separator:a636358a90fd9e6491f535fc09cddb693"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9118d93065548cb1a01661bfee4ec0e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#ab9118d93065548cb1a01661bfee4ec0e">findMainInks</a> ()</td></tr>
<tr class="separator:ab9118d93065548cb1a01661bfee4ec0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a862677aeb8909f6f6c8aec92ec0238"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a7a862677aeb8909f6f6c8aec92ec0238">findLargePaints</a> ()</td></tr>
<tr class="separator:a7a862677aeb8909f6f6c8aec92ec0238"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabbf949273280be231e954fd88f2da88"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#aabbf949273280be231e954fd88f2da88">findThinInks</a> ()</td></tr>
<tr class="separator:aabbf949273280be231e954fd88f2da88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f3e37ed9565884330cf14dca3174391"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a0f3e37ed9565884330cf14dca3174391">findPaints</a> ()</td></tr>
<tr class="separator:a0f3e37ed9565884330cf14dca3174391"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a500f92be650df0fac71b874249558e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a4a500f92be650df0fac71b874249558e">findPaints2</a> ()</td></tr>
<tr class="separator:a4a500f92be650df0fac71b874249558e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4935692bd8410887715578358fba22d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a4935692bd8410887715578358fba22d0">findThinPaints</a> ()</td></tr>
<tr class="separator:a4935692bd8410887715578358fba22d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15c4d3ec5423fe914b197a56011180b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a15c4d3ec5423fe914b197a56011180b9">findSuspectInks</a> ()</td></tr>
<tr class="separator:a15c4d3ec5423fe914b197a56011180b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcbe43bcb6bb6cec6da9b42068feeddb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#afcbe43bcb6bb6cec6da9b42068feeddb">measureThickness</a> ()</td></tr>
<tr class="separator:afcbe43bcb6bb6cec6da9b42068feeddb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49611b50e7951a08c0c27fd4602e96e7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a49611b50e7951a08c0c27fd4602e96e7">measureThickness</a> (int x, int y)</td></tr>
<tr class="separator:a49611b50e7951a08c0c27fd4602e96e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adac817fad601b5981867163088f4cec2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#adac817fad601b5981867163088f4cec2">process</a> (const <a class="el" href="class_t_raster_p_t.html">TRaster32P</a> &amp;srcRas)</td></tr>
<tr class="separator:adac817fad601b5981867163088f4cec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae47d71cceb01ca2b6ea9f0a20de7874e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#ae47d71cceb01ca2b6ea9f0a20de7874e">getRegionIndex</a> (int x, int y) const</td></tr>
<tr class="separator:ae47d71cceb01ca2b6ea9f0a20de7874e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99634f4451b98f749ab9b0d5f015da5b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_toonz_image_p.html">TToonzImageP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a99634f4451b98f749ab9b0d5f015da5b">makeTlv</a> (bool transparentSyntheticInks, QList&lt; int &gt; &amp;usedStyleIds, double dpi=0.0)</td></tr>
<tr class="separator:a99634f4451b98f749ab9b0d5f015da5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3d734da9514382920e8db48e66179bc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_vector_image_p.html">TVectorImageP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#ab3d734da9514382920e8db48e66179bc">vectorize</a> (const <a class="el" href="class_t_toonz_image_p.html">TToonzImageP</a> &amp;ti)</td></tr>
<tr class="separator:ab3d734da9514382920e8db48e66179bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a289ac6bb1db00e86ce3a9de249afcde3"><td class="memItemLeft" align="right" valign="top"><a id="a289ac6bb1db00e86ce3a9de249afcde3" name="a289ac6bb1db00e86ce3a9de249afcde3"></a>
<a class="el" href="class_t_vector_image_p.html">TVectorImageP</a>&#160;</td><td class="memItemRight" valign="bottom"><b>vectorize</b> (const <a class="el" href="class_t_raster_p_t.html">TRaster32P</a> &amp;ras)</td></tr>
<tr class="separator:a289ac6bb1db00e86ce3a9de249afcde3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a428eaeb0f3eaf2062451c6a33d41b319"><td class="memItemLeft" align="right" valign="top"><a id="a428eaeb0f3eaf2062451c6a33d41b319" name="a428eaeb0f3eaf2062451c6a33d41b319"></a>
<a class="el" href="class_t_vector_image_p.html">TVectorImageP</a>&#160;</td><td class="memItemRight" valign="bottom"><b>vectorize</b> ()</td></tr>
<tr class="separator:a428eaeb0f3eaf2062451c6a33d41b319"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad72599e811a8f2211fc47982ac7a86c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#ad72599e811a8f2211fc47982ac7a86c0">removeUnusedStyles</a> (const QList&lt; int &gt; &amp;styleIds)</td></tr>
<tr class="separator:ad72599e811a8f2211fc47982ac7a86c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ad82deae9481139d35a00c97c186396fd"><td class="memItemLeft" align="right" valign="top">const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#ad82deae9481139d35a00c97c186396fd">MaxColorCount</a></td></tr>
<tr class="separator:ad82deae9481139d35a00c97c186396fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a818cf5ab9bec6c237a80d010ba850c82"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt; unsigned short &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a818cf5ab9bec6c237a80d010ba850c82">m_regionRas</a></td></tr>
<tr class="separator:a818cf5ab9bec6c237a80d010ba850c82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b0daae74da1bd01b9f08c4f3e863793"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt; unsigned char &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a0b0daae74da1bd01b9f08c4f3e863793">m_borderRas</a></td></tr>
<tr class="separator:a0b0daae74da1bd01b9f08c4f3e863793"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40cb144beaf2f9ae3762a9be1360783d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt; unsigned char &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a40cb144beaf2f9ae3762a9be1360783d">m_dotRas</a></td></tr>
<tr class="separator:a40cb144beaf2f9ae3762a9be1360783d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca510d1f840fde7592ce170aea57c90f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt; unsigned char &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#aca510d1f840fde7592ce170aea57c90f">m_syntheticInkRas</a></td></tr>
<tr class="separator:aca510d1f840fde7592ce170aea57c90f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae96dfe88c5c33f6e70270049e1a7de6e"><td class="memItemLeft" align="right" valign="top">QVector&lt; TPixel32 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#ae96dfe88c5c33f6e70270049e1a7de6e">m_colors</a></td></tr>
<tr class="separator:ae96dfe88c5c33f6e70270049e1a7de6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1401dcef1312dcd358d1feb1dc42fcaa"><td class="memItemLeft" align="right" valign="top">QVector&lt; <a class="el" href="struct_region_info.html">RegionInfo</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a1401dcef1312dcd358d1feb1dc42fcaa">m_regions</a></td></tr>
<tr class="separator:a1401dcef1312dcd358d1feb1dc42fcaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ddcaf9de0e08d6aa0e2d48fdfce1ad5"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a5ddcaf9de0e08d6aa0e2d48fdfce1ad5">m_inkThickness</a></td></tr>
<tr class="separator:a5ddcaf9de0e08d6aa0e2d48fdfce1ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5be1af2e152f70560a76ada841b7d685"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_palette.html">TPalette</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a5be1af2e152f70560a76ada841b7d685">m_palette</a></td></tr>
<tr class="separator:a5be1af2e152f70560a76ada841b7d685"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ba425d3324998fa444ba91e5fe68272"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_naa2_tlv_converter.html#a8ba425d3324998fa444ba91e5fe68272">m_valid</a></td></tr>
<tr class="separator:a8ba425d3324998fa444ba91e5fe68272"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"></div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac60ed5da6eaa8aa83645e3b2883ed0ae" name="ac60ed5da6eaa8aa83645e3b2883ed0ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac60ed5da6eaa8aa83645e3b2883ed0ae">&#9670;&nbsp;</a></span>Naa2TlvConverter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Naa2TlvConverter::Naa2TlvConverter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   43</span>    : MaxColorCount(1000)</div>
<div class="line"><span class="lineno">   44</span>    , m_regionRas(0)</div>
<div class="line"><span class="lineno">   45</span>    , m_borderRas(0)</div>
<div class="line"><span class="lineno">   46</span>    , m_dotRas(0)</div>
<div class="line"><span class="lineno">   47</span>    , m_syntheticInkRas(0)</div>
<div class="line"><span class="lineno">   48</span>    , m_inkThickness(0)</div>
<div class="line"><span class="lineno">   49</span>    , m_palette(0)</div>
<div class="line"><span class="lineno">   50</span>    , m_valid(<span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>{}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae86460abc499a90416729adb4a2be8d9" name="ae86460abc499a90416729adb4a2be8d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae86460abc499a90416729adb4a2be8d9">&#9670;&nbsp;</a></span>~Naa2TlvConverter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Naa2TlvConverter::~Naa2TlvConverter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   54</span>                                    {</div>
<div class="line"><span class="lineno">   55</span>  <span class="keyword">delete</span> m_regionRas;</div>
<div class="line"><span class="lineno">   56</span>  <span class="keyword">delete</span> m_borderRas;</div>
<div class="line"><span class="lineno">   57</span>  <span class="keyword">delete</span> m_dotRas;</div>
<div class="line"><span class="lineno">   58</span>  <span class="keyword">delete</span> m_syntheticInkRas;</div>
<div class="line"><span class="lineno">   59</span>  <span class="keywordflow">if</span> (m_palette) m_palette-&gt;release();</div>
<div class="line"><span class="lineno">   60</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a6496d92f56d05170610a871c0228af77" name="a6496d92f56d05170610a871c0228af77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6496d92f56d05170610a871c0228af77">&#9670;&nbsp;</a></span>addBorderInks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::addBorderInks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  738</span>{</div>
<div class="line"><span class="lineno">  739</span>  <span class="keywordtype">int</span> lx                   = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  740</span>  <span class="keywordtype">int</span> ly                   = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  741</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> dd[][2] = {{0, -1}, {-1, 0},  {1, 0},  {0, 1},</div>
<div class="line"><span class="lineno">  742</span>                              {1, 1},  {-1, -1}, {-1, 1}, {1, -1}};</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>  m_syntheticInkRas = <span class="keyword">new</span> <a class="code hl_class" href="class_work_raster.html">WorkRaster&lt;unsigned char&gt;</a>(lx, ly);</div>
<div class="line"><span class="lineno">  745</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lx * ly; i++) m_syntheticInkRas-&gt;pixels(0)[i] = 0;</div>
<div class="line"><span class="lineno">  746</span> </div>
<div class="line"><span class="lineno">  747</span>  <span class="comment">// calculate brightness of all colors in order to decide the region on which</span></div>
<div class="line"><span class="lineno">  748</span>  <span class="comment">// the border to be added</span></div>
<div class="line"><span class="lineno">  749</span>  QList&lt;int&gt; colorsBrightness;</div>
<div class="line"><span class="lineno">  750</span>  QVector&lt;TPixel32&gt;::iterator c;</div>
<div class="line"><span class="lineno">  751</span>  <span class="keywordflow">for</span> (c = m_colors.begin(); c != m_colors.end(); ++c)</div>
<div class="line"><span class="lineno">  752</span>    colorsBrightness.append((<span class="keywordtype">int</span>)(*c).r * 30 + (<span class="keywordtype">int</span>)(*c).g * 59 +</div>
<div class="line"><span class="lineno">  753</span>                            (<span class="keywordtype">int</span>)(*c).b * 11);</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>  <span class="keywordtype">int</span> borderInkColorIndex = m_colors.count();</div>
<div class="line"><span class="lineno">  756</span>  m_colors.append(TPixel32(255, 0, 0));</div>
<div class="line"><span class="lineno">  757</span> </div>
<div class="line"><span class="lineno">  758</span>  <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> borderInkRegion;</div>
<div class="line"><span class="lineno">  759</span>  borderInkRegion.type       = RegionInfo::SyntheticInk;</div>
<div class="line"><span class="lineno">  760</span>  borderInkRegion.colorIndex = borderInkColorIndex;</div>
<div class="line"><span class="lineno">  761</span>  <span class="keywordtype">int</span> borderInkRegionIndex   = m_regions.count();</div>
<div class="line"><span class="lineno">  762</span>  m_regions.append(borderInkRegion);</div>
<div class="line"><span class="lineno">  763</span> </div>
<div class="line"><span class="lineno">  764</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  765</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *workScanLine  = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  766</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *borderScanLine = m_borderRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  767</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  768</span>      <span class="keywordtype">int</span> c = workScanLine[x];</div>
<div class="line"><span class="lineno">  769</span>      <span class="keywordflow">if</span> (borderScanLine[x] != 1) <span class="keywordflow">continue</span>;  <span class="comment">// consider border pixel only</span></div>
<div class="line"><span class="lineno">  770</span>      <span class="keywordflow">if</span> (0 == (m_regions[c].type &amp; RegionInfo::Paint) &amp;&amp;</div>
<div class="line"><span class="lineno">  771</span>          m_regions[c].type != RegionInfo::Unknown)</div>
<div class="line"><span class="lineno">  772</span>        <span class="keywordflow">continue</span>;  <span class="comment">// consider paint pixels only</span></div>
<div class="line"><span class="lineno">  773</span> </div>
<div class="line"><span class="lineno">  774</span>      <span class="comment">// is touching a different no-ink pixel?</span></div>
<div class="line"><span class="lineno">  775</span>      <span class="keywordtype">bool</span> touchesOtherRegion = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  776</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {</div>
<div class="line"><span class="lineno">  777</span>        <span class="keywordtype">int</span> x1 = x + dd[j][0], y1 = y + dd[j][1];</div>
<div class="line"><span class="lineno">  778</span>        <span class="keywordflow">if</span> (0 &lt;= x1 &amp;&amp; x1 &lt; lx &amp;&amp; 0 &lt;= y1 &amp;&amp; y1 &lt; ly) {</div>
<div class="line"><span class="lineno">  779</span>          <span class="keywordtype">int</span> c1 = m_regionRas-&gt;pixels(y1)[x1];</div>
<div class="line"><span class="lineno">  780</span> </div>
<div class="line"><span class="lineno">  781</span>          <span class="keywordflow">if</span> (m_regions[c1].type == RegionInfo::Background) {</div>
<div class="line"><span class="lineno">  782</span>            touchesOtherRegion = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  783</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  784</span>          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_regions[c1].type == RegionInfo::Unknown ||</div>
<div class="line"><span class="lineno">  785</span>                     (m_regions[c1].type &amp; RegionInfo::Paint) != 0) {</div>
<div class="line"><span class="lineno">  786</span>            <span class="comment">// OLD: note: we consider only regions with a lower index, to avoid</span></div>
<div class="line"><span class="lineno">  787</span>            <span class="comment">// to create double border strokes</span></div>
<div class="line"><span class="lineno">  788</span>            <span class="comment">// NEW: we put synthetic ink pixels in larger regions</span></div>
<div class="line"><span class="lineno">  789</span>            <span class="comment">// UPDATE 2017/5/12 : we put ink on darker style</span></div>
<div class="line"><span class="lineno">  790</span>            <span class="keywordflow">if</span> (colorsBrightness[m_regions[c1].colorIndex] &gt;</div>
<div class="line"><span class="lineno">  791</span>                colorsBrightness[m_regions[c].colorIndex]) {</div>
<div class="line"><span class="lineno">  792</span>              touchesOtherRegion = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  793</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  794</span>            }</div>
<div class="line"><span class="lineno">  795</span>          }</div>
<div class="line"><span class="lineno">  796</span>        }</div>
<div class="line"><span class="lineno">  797</span>      }</div>
<div class="line"><span class="lineno">  798</span> </div>
<div class="line"><span class="lineno">  799</span>      <span class="keywordflow">if</span> (touchesOtherRegion) {</div>
<div class="line"><span class="lineno">  800</span>        m_syntheticInkRas-&gt;pixels(y)[x] = 1;</div>
<div class="line"><span class="lineno">  801</span>      }</div>
<div class="line"><span class="lineno">  802</span>    }</div>
<div class="line"><span class="lineno">  803</span>  }</div>
<div class="line"><span class="lineno">  804</span>}</div>
<div class="ttc" id="aclass_work_raster_html"><div class="ttname"><a href="class_work_raster.html">WorkRaster&lt; unsigned char &gt;</a></div></div>
<div class="ttc" id="astruct_region_info_html"><div class="ttname"><a href="struct_region_info.html">RegionInfo</a></div><div class="ttdef"><b>Definition:</b> Naa2TlvConverter.h:43</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a93df5ceb3d392b0da338ba54d8854181" name="a93df5ceb3d392b0da338ba54d8854181"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93df5ceb3d392b0da338ba54d8854181">&#9670;&nbsp;</a></span>assignColorTypes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::assignColorTypes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  712</span>                                        {</div>
<div class="line"><span class="lineno">  713</span>  <span class="keywordflow">if</span> (!m_regionRas || !m_borderRas || m_regions.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  714</span>  <span class="keywordtype">int</span> lx = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  715</span>  <span class="keywordtype">int</span> ly = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  716</span> </div>
<div class="line"><span class="lineno">  717</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  718</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  719</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::Unknown) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  720</span>    QList&lt;int&gt; &amp;bs = region.boundaries;</div>
<div class="line"><span class="lineno">  721</span>    <span class="keywordflow">if</span> (bs[0] &gt; 0) {</div>
<div class="line"><span class="lineno">  722</span>      region.type = RegionInfo::LargePaint;</div>
<div class="line"><span class="lineno">  723</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  724</span>      <span class="keywordtype">int</span> b = 0;</div>
<div class="line"><span class="lineno">  725</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt;= 2 &amp;&amp; j &lt; bs.count(); j++) b += bs[j];</div>
<div class="line"><span class="lineno">  726</span>      <span class="keywordflow">if</span> (region.pixelCount &gt; 200 &amp;&amp;</div>
<div class="line"><span class="lineno">  727</span>          (region.pixelCount - b) * 10 &lt; region.pixelCount) {</div>
<div class="line"><span class="lineno">  728</span>        region.type = RegionInfo::ThinInk;</div>
<div class="line"><span class="lineno">  729</span>      }</div>
<div class="line"><span class="lineno">  730</span>    }</div>
<div class="line"><span class="lineno">  731</span>  }</div>
<div class="line"><span class="lineno">  732</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b691387ed3777720d7560944c91fc34" name="a4b691387ed3777720d7560944c91fc34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b691387ed3777720d7560944c91fc34">&#9670;&nbsp;</a></span>computeLinks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::computeLinks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  293</span>                                    {</div>
<div class="line"><span class="lineno">  294</span>  <span class="keywordflow">if</span> (!m_regionRas || m_regions.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  295</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lx   = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  296</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ly   = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  297</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> wrap = lx;</div>
<div class="line"><span class="lineno">  298</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *waScanLine;</div>
<div class="line"><span class="lineno">  299</span>  <span class="keywordtype">int</span> x;</div>
<div class="line"><span class="lineno">  300</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) m_regions[i].perimeter = 0;</div>
<div class="line"><span class="lineno">  301</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  302</span>    waScanLine = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  303</span>    <span class="keywordflow">for</span> (x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  304</span>      <span class="keywordtype">int</span> c     = waScanLine[x];</div>
<div class="line"><span class="lineno">  305</span>      <span class="keywordtype">int</span> cUp   = y &gt; 0 ? waScanLine[x - wrap] : -1;</div>
<div class="line"><span class="lineno">  306</span>      <span class="keywordtype">int</span> cLeft = x &gt; 0 ? waScanLine[x - 1] : -1;</div>
<div class="line"><span class="lineno">  307</span>      <span class="keywordflow">if</span> (c != cUp) {</div>
<div class="line"><span class="lineno">  308</span>        m_regions[c].touchRegion(cUp);</div>
<div class="line"><span class="lineno">  309</span>        m_regions[c].perimeter++;</div>
<div class="line"><span class="lineno">  310</span>        <span class="keywordflow">if</span> (cUp &gt;= 0) {</div>
<div class="line"><span class="lineno">  311</span>          m_regions[cUp].touchRegion(c);</div>
<div class="line"><span class="lineno">  312</span>          m_regions[cUp].perimeter++;</div>
<div class="line"><span class="lineno">  313</span>        }</div>
<div class="line"><span class="lineno">  314</span>      }</div>
<div class="line"><span class="lineno">  315</span>      <span class="keywordflow">if</span> (c != cLeft) {</div>
<div class="line"><span class="lineno">  316</span>        m_regions[c].touchRegion(cLeft);</div>
<div class="line"><span class="lineno">  317</span>        m_regions[c].perimeter++;</div>
<div class="line"><span class="lineno">  318</span>        <span class="keywordflow">if</span> (cLeft &gt;= 0) {</div>
<div class="line"><span class="lineno">  319</span>          m_regions[cLeft].touchRegion(c);</div>
<div class="line"><span class="lineno">  320</span>          m_regions[cLeft].perimeter++;</div>
<div class="line"><span class="lineno">  321</span>        }</div>
<div class="line"><span class="lineno">  322</span>      }</div>
<div class="line"><span class="lineno">  323</span>    }</div>
<div class="line"><span class="lineno">  324</span>    m_regions[waScanLine[lx - 1]].touchRegion(-1);</div>
<div class="line"><span class="lineno">  325</span>  }</div>
<div class="line"><span class="lineno">  326</span>  waScanLine = m_regionRas-&gt;pixels(ly - 1);</div>
<div class="line"><span class="lineno">  327</span>  <span class="keywordflow">for</span> (x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  328</span>    m_regions[waScanLine[x]].touchRegion(-1);</div>
<div class="line"><span class="lineno">  329</span>  }</div>
<div class="line"><span class="lineno">  330</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2988866d4a3609b1ca1318867e723141" name="a2988866d4a3609b1ca1318867e723141"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2988866d4a3609b1ca1318867e723141">&#9670;&nbsp;</a></span>computeMainInkThickness()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::computeMainInkThickness </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  497</span>                                               {</div>
<div class="line"><span class="lineno">  498</span>  m_inkThickness  = 0.0;</div>
<div class="line"><span class="lineno">  499</span>  <span class="keywordtype">int</span> largestArea = 0;</div>
<div class="line"><span class="lineno">  500</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  501</span>    <span class="keywordflow">if</span> (m_regions[i].type != RegionInfo::MainInk) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  502</span>    <span class="keywordflow">if</span> (m_regions[i].pixelCount &lt; largestArea) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  503</span>    largestArea = m_regions[i].pixelCount;</div>
<div class="line"><span class="lineno">  504</span>    <span class="keywordflow">if</span> (i == 55) {</div>
<div class="line"><span class="lineno">  505</span>      <span class="keywordtype">int</span> x = 123;</div>
<div class="line"><span class="lineno">  506</span>    }</div>
<div class="line"><span class="lineno">  507</span>    QList&lt;int&gt; &amp;bs = m_regions[i].boundaries;</div>
<div class="line"><span class="lineno">  508</span>    Q_ASSERT(bs[1] &gt; 0);</div>
<div class="line"><span class="lineno">  509</span>    <span class="keywordtype">int</span> perimeter = m_regions[i].perimeter;</div>
<div class="line"><span class="lineno">  510</span>    <span class="keywordtype">int</span> area      = bs[1];</div>
<div class="line"><span class="lineno">  511</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 2; j &lt; bs.count() &amp;&amp; bs[j] * 2 &gt; bs[1]; j++) area += bs[j];</div>
<div class="line"><span class="lineno">  512</span>    <span class="keywordflow">if</span> (perimeter &gt; 0) {</div>
<div class="line"><span class="lineno">  513</span>      m_inkThickness = 2 * (double)area / (<span class="keywordtype">double</span>)perimeter;</div>
<div class="line"><span class="lineno">  514</span>    }</div>
<div class="line"><span class="lineno">  515</span>  }</div>
<div class="line"><span class="lineno">  516</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae5094e8e50745238644eaf21645dffb1" name="ae5094e8e50745238644eaf21645dffb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5094e8e50745238644eaf21645dffb1">&#9670;&nbsp;</a></span>erodeRegions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::erodeRegions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  409</span>                                    {</div>
<div class="line"><span class="lineno">  410</span>  QTime clock;</div>
<div class="line"><span class="lineno">  411</span>  clock.start();</div>
<div class="line"><span class="lineno">  412</span>  <span class="keywordflow">if</span> (!m_regionRas || !m_borderRas) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  413</span>  <span class="keywordtype">int</span> lx = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  414</span>  <span class="keywordtype">int</span> ly = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> dd[][2] = {{-1, -1}, {0, -1}, {1, -1}, {-1, 0},</div>
<div class="line"><span class="lineno">  417</span>                              {1, 0},   {-1, 1}, {0, 1},  {1, 1}};</div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; 10; iter++) {</div>
<div class="line"><span class="lineno">  420</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  421</span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *workScanLine  = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  422</span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *borderScanLine = m_borderRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  423</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  424</span>        <span class="keywordflow">if</span> (borderScanLine[x] != iter + 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  425</span>        <span class="keywordtype">int</span> c = workScanLine[x];</div>
<div class="line"><span class="lineno">  426</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {</div>
<div class="line"><span class="lineno">  427</span>          <span class="keywordtype">int</span> x1 = x + dd[j][0], y1 = y + dd[j][1];</div>
<div class="line"><span class="lineno">  428</span>          <span class="keywordflow">if</span> (!(0 &lt;= x1 &amp;&amp; x1 &lt; lx &amp;&amp; 0 &lt;= y1 &amp;&amp; y1 &lt; ly)) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  429</span>          <span class="keywordtype">int</span> c1 = m_regionRas-&gt;pixels(y1)[x1];</div>
<div class="line"><span class="lineno">  430</span>          <span class="keywordtype">int</span> b1 = m_borderRas-&gt;pixels(y1)[x1];</div>
<div class="line"><span class="lineno">  431</span>          <span class="keywordflow">if</span> (c1 == c &amp;&amp; b1 == 0) m_borderRas-&gt;pixels(y1)[x1] = iter + 2;</div>
<div class="line"><span class="lineno">  432</span>        }</div>
<div class="line"><span class="lineno">  433</span>      }</div>
<div class="line"><span class="lineno">  434</span>    }</div>
<div class="line"><span class="lineno">  435</span>  }</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) m_regions[i].boundaries.clear();</div>
<div class="line"><span class="lineno">  438</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  439</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *workScanLine  = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *borderScanLine = m_borderRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  441</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  442</span>      <span class="keywordtype">int</span> c          = workScanLine[x];</div>
<div class="line"><span class="lineno">  443</span>      <span class="keywordtype">int</span> b          = borderScanLine[x];</div>
<div class="line"><span class="lineno">  444</span>      <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;r  = m_regions[c];</div>
<div class="line"><span class="lineno">  445</span>      QList&lt;int&gt; &amp;bs = r.boundaries;</div>
<div class="line"><span class="lineno">  446</span>      <span class="keywordflow">while</span> (bs.count() &lt;= b) bs.append(0);</div>
<div class="line"><span class="lineno">  447</span>      bs[b]++;</div>
<div class="line"><span class="lineno">  448</span>      <span class="keywordflow">if</span> (b == bs.count() - 1) r.pos = QPoint(x, y);</div>
<div class="line"><span class="lineno">  449</span>      <span class="keywordflow">if</span> (r.x0 &gt; r.x1) {</div>
<div class="line"><span class="lineno">  450</span>        r.x0 = r.x1 = x;</div>
<div class="line"><span class="lineno">  451</span>        r.y0 = r.y1 = y;</div>
<div class="line"><span class="lineno">  452</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  453</span>        <span class="keywordflow">if</span> (x &lt; r.x0)</div>
<div class="line"><span class="lineno">  454</span>          r.x0 = x;</div>
<div class="line"><span class="lineno">  455</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &gt; r.x1)</div>
<div class="line"><span class="lineno">  456</span>          r.x1 = x;</div>
<div class="line"><span class="lineno">  457</span>        <span class="keywordflow">if</span> (y &lt; r.y0)</div>
<div class="line"><span class="lineno">  458</span>          r.y0 = y;</div>
<div class="line"><span class="lineno">  459</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (y &gt; r.y1)</div>
<div class="line"><span class="lineno">  460</span>          r.y1 = y;</div>
<div class="line"><span class="lineno">  461</span>      }</div>
<div class="line"><span class="lineno">  462</span>    }</div>
<div class="line"><span class="lineno">  463</span>  }</div>
<div class="line"><span class="lineno">  464</span>  qDebug() &lt;&lt; <span class="stringliteral">&quot;Erode regions. time = &quot;</span> &lt;&lt; clock.elapsed();</div>
<div class="line"><span class="lineno">  465</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a636358a90fd9e6491f535fc09cddb693" name="a636358a90fd9e6491f535fc09cddb693"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a636358a90fd9e6491f535fc09cddb693">&#9670;&nbsp;</a></span>findBackgroundRegions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findBackgroundRegions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  336</span>                                             {</div>
<div class="line"><span class="lineno">  337</span>  <span class="keywordflow">if</span> (!m_regionRas || m_regions.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  338</span>  <span class="keywordtype">int</span> lx = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  339</span>  <span class="keywordtype">int</span> ly = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>  <span class="comment">// find the whitest color</span></div>
<div class="line"><span class="lineno">  342</span>  <span class="keywordtype">int</span> bgColorIndex = -1;</div>
<div class="line"><span class="lineno">  343</span>  <span class="keywordtype">int</span> maxV         = 0;</div>
<div class="line"><span class="lineno">  344</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_colors.count(); i++) {</div>
<div class="line"><span class="lineno">  345</span>    TPixel color = m_colors.at(i);</div>
<div class="line"><span class="lineno">  346</span>    <span class="keywordtype">int</span> v        = color.r + color.g + color.b;</div>
<div class="line"><span class="lineno">  347</span>    <span class="keywordtype">int</span> a        = std::min({color.r, color.g, color.b});</div>
<div class="line"><span class="lineno">  348</span>    <span class="keywordflow">if</span> (a &lt; 230) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  349</span>    <span class="keywordflow">if</span> (v &gt; maxV) {</div>
<div class="line"><span class="lineno">  350</span>      bgColorIndex = i;</div>
<div class="line"><span class="lineno">  351</span>      maxV         = v;</div>
<div class="line"><span class="lineno">  352</span>    }</div>
<div class="line"><span class="lineno">  353</span>  }</div>
<div class="line"><span class="lineno">  354</span>  <span class="keywordflow">if</span> (bgColorIndex &lt; 0) {</div>
<div class="line"><span class="lineno">  355</span>    <span class="comment">// no white found. no bg region</span></div>
<div class="line"><span class="lineno">  356</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  357</span>  }</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  360</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region                                 = m_regions[i];</div>
<div class="line"><span class="lineno">  361</span>    <span class="keywordflow">if</span> (region.colorIndex == bgColorIndex) region.type = RegionInfo::Background;</div>
<div class="line"><span class="lineno">  362</span>  }</div>
<div class="line"><span class="lineno">  363</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a862677aeb8909f6f6c8aec92ec0238" name="a7a862677aeb8909f6f6c8aec92ec0238"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a862677aeb8909f6f6c8aec92ec0238">&#9670;&nbsp;</a></span>findLargePaints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findLargePaints </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  520</span>                                       {</div>
<div class="line"><span class="lineno">  521</span>  <span class="keywordflow">if</span> (!m_regionRas || !m_borderRas || m_regions.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  522</span>  QSet&lt;int&gt; largePaintColors;</div>
<div class="line"><span class="lineno">  523</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  524</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  525</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::Unknown) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  526</span>    QList&lt;int&gt; &amp;bs = region.boundaries;</div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordflow">if</span> (bs[0] &gt; 0) {</div>
<div class="line"><span class="lineno">  528</span>      region.type = RegionInfo::LargePaint;</div>
<div class="line"><span class="lineno">  529</span>      largePaintColors.insert(region.colorIndex);</div>
<div class="line"><span class="lineno">  530</span>    }</div>
<div class="line"><span class="lineno">  531</span>  }</div>
<div class="line"><span class="lineno">  532</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  533</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  534</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::Unknown) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  535</span>    <span class="keywordflow">if</span> (largePaintColors.contains(region.colorIndex))</div>
<div class="line"><span class="lineno">  536</span>      region.type = RegionInfo::LargePaint;</div>
<div class="line"><span class="lineno">  537</span>  }</div>
<div class="line"><span class="lineno">  538</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab9118d93065548cb1a01661bfee4ec0e" name="ab9118d93065548cb1a01661bfee4ec0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9118d93065548cb1a01661bfee4ec0e">&#9670;&nbsp;</a></span>findMainInks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findMainInks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  470</span>                                    {</div>
<div class="line"><span class="lineno">  471</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  472</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  473</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::Unknown) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  474</span>    <span class="keywordflow">if</span> (region.isBackground() || region.type == RegionInfo::LargePaint ||</div>
<div class="line"><span class="lineno">  475</span>        region.boundaries[0] &gt; 0)</div>
<div class="line"><span class="lineno">  476</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  477</span>    <span class="keywordtype">double</span> ap2 =</div>
<div class="line"><span class="lineno">  478</span>        100000.0 * (double)region.pixelCount / pow((<span class="keywordtype">double</span>)region.perimeter, 2);</div>
<div class="line"><span class="lineno">  479</span>    <span class="keywordflow">if</span> (ap2 &gt; 100) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  480</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c : region.links.keys()) {</div>
<div class="line"><span class="lineno">  481</span>      <span class="keywordflow">if</span> (c &gt;= 0 &amp;&amp; (m_regions[c].isBackground() ||</div>
<div class="line"><span class="lineno">  482</span>                     m_regions[c].type == RegionInfo::LargePaint)) {</div>
<div class="line"><span class="lineno">  483</span>        <span class="keywordtype">int</span> strength = region.links[c];</div>
<div class="line"><span class="lineno">  484</span>        <span class="keywordflow">if</span> (strength &gt; 50) {</div>
<div class="line"><span class="lineno">  485</span>          m_regions[i].type = RegionInfo::MainInk;</div>
<div class="line"><span class="lineno">  486</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  487</span>        }</div>
<div class="line"><span class="lineno">  488</span>      }</div>
<div class="line"><span class="lineno">  489</span>    }</div>
<div class="line"><span class="lineno">  490</span>  }</div>
<div class="line"><span class="lineno">  491</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0f3e37ed9565884330cf14dca3174391" name="a0f3e37ed9565884330cf14dca3174391"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f3e37ed9565884330cf14dca3174391">&#9670;&nbsp;</a></span>findPaints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findPaints </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  566</span>                                  {</div>
<div class="line"><span class="lineno">  567</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  568</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  569</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::Unknown) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  570</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c : m_regions[i].links.keys()) {</div>
<div class="line"><span class="lineno">  571</span>      <span class="keywordflow">if</span> (c &gt;= 0 &amp;&amp; m_regions[c].isInk()) {</div>
<div class="line"><span class="lineno">  572</span>        m_regions[i].type = RegionInfo::Paint;</div>
<div class="line"><span class="lineno">  573</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  574</span>      }</div>
<div class="line"><span class="lineno">  575</span>    }</div>
<div class="line"><span class="lineno">  576</span>  }</div>
<div class="line"><span class="lineno">  577</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4a500f92be650df0fac71b874249558e" name="a4a500f92be650df0fac71b874249558e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a500f92be650df0fac71b874249558e">&#9670;&nbsp;</a></span>findPaints2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findPaints2 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  581</span>                                   {</div>
<div class="line"><span class="lineno">  582</span>  <span class="keywordtype">double</span> avThickness = 0.0;</div>
<div class="line"><span class="lineno">  583</span>  <span class="keywordtype">int</span> m              = 0;</div>
<div class="line"><span class="lineno">  584</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  585</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  586</span>    <span class="keywordflow">if</span> (region.type == RegionInfo::MainInk) {</div>
<div class="line"><span class="lineno">  587</span>      avThickness += region.thickness * region.pixelCount;</div>
<div class="line"><span class="lineno">  588</span>      m += region.pixelCount;</div>
<div class="line"><span class="lineno">  589</span>    }</div>
<div class="line"><span class="lineno">  590</span>  }</div>
<div class="line"><span class="lineno">  591</span>  <span class="keywordflow">if</span> (m &gt; 0) {</div>
<div class="line"><span class="lineno">  592</span>    avThickness = avThickness / m;</div>
<div class="line"><span class="lineno">  593</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  594</span>    avThickness = 1.5;  <span class="comment">// this should never happen</span></div>
<div class="line"><span class="lineno">  595</span>  }</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  598</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  599</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::Unknown) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  600</span> </div>
<div class="line"><span class="lineno">  601</span>    <span class="keywordflow">if</span> (region.thickness &gt; 0.0) {</div>
<div class="line"><span class="lineno">  602</span>      <span class="keywordflow">if</span> (region.thickness &lt; 1.2 * avThickness)</div>
<div class="line"><span class="lineno">  603</span>        region.type = RegionInfo::Ink;</div>
<div class="line"><span class="lineno">  604</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  605</span>        region.type = RegionInfo::Paint;</div>
<div class="line"><span class="lineno">  606</span>    }</div>
<div class="line"><span class="lineno">  607</span>  }</div>
<div class="line"><span class="lineno">  608</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0e685ba8107ef1dbe30dd4a49d347193" name="a0e685ba8107ef1dbe30dd4a49d347193"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e685ba8107ef1dbe30dd4a49d347193">&#9670;&nbsp;</a></span>findRegionBorders()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findRegionBorders </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  369</span>                                         {</div>
<div class="line"><span class="lineno">  370</span>  <span class="keywordflow">if</span> (!m_regionRas) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  371</span>  <span class="keywordtype">int</span> lx = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  372</span>  <span class="keywordtype">int</span> ly = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  373</span>  <span class="keyword">delete</span> m_borderRas;</div>
<div class="line"><span class="lineno">  374</span>  m_borderRas = <span class="keyword">new</span> <a class="code hl_class" href="class_work_raster.html">WorkRaster&lt;unsigned char&gt;</a>(lx, ly);</div>
<div class="line"><span class="lineno">  375</span> </div>
<div class="line"><span class="lineno">  376</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> dd[][2] = {{-1, -1}, {0, -1}, {1, -1}, {-1, 0},</div>
<div class="line"><span class="lineno">  377</span>                              {1, 0},   {-1, 1}, {0, 1},  {1, 1}};</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>  <span class="comment">// find region-region boundaries</span></div>
<div class="line"><span class="lineno">  380</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  381</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *workScanLine  = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  382</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *borderScanLine = m_borderRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  383</span> </div>
<div class="line"><span class="lineno">  384</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  385</span>      <span class="keywordtype">int</span> k = workScanLine[x];</div>
<div class="line"><span class="lineno">  386</span>      Q_ASSERT(0 &lt;= k &amp;&amp; k &lt; m_regions.count());</div>
<div class="line"><span class="lineno">  387</span>      <span class="keywordtype">int</span> isBoundary = 0;</div>
<div class="line"><span class="lineno">  388</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 8; j++) {</div>
<div class="line"><span class="lineno">  389</span>        <span class="keywordtype">int</span> x1 = x + dd[j][0], y1 = y + dd[j][1];</div>
<div class="line"><span class="lineno">  390</span>        <span class="keywordflow">if</span> (0 &lt;= x1 &amp;&amp; x1 &lt; lx &amp;&amp; 0 &lt;= y1 &amp;&amp; y1 &lt; ly) {</div>
<div class="line"><span class="lineno">  391</span>          <span class="keywordtype">int</span> k1 = m_regionRas-&gt;pixels(y1)[x1];</div>
<div class="line"><span class="lineno">  392</span>          <span class="keywordflow">if</span> (k1 != k) {</div>
<div class="line"><span class="lineno">  393</span>            isBoundary = 1;</div>
<div class="line"><span class="lineno">  394</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  395</span>          }</div>
<div class="line"><span class="lineno">  396</span>        }</div>
<div class="line"><span class="lineno">  397</span>      }</div>
<div class="line"><span class="lineno">  398</span>      borderScanLine[x] = isBoundary;</div>
<div class="line"><span class="lineno">  399</span>    }</div>
<div class="line"><span class="lineno">  400</span>  }</div>
<div class="line"><span class="lineno">  401</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a15c4d3ec5423fe914b197a56011180b9" name="a15c4d3ec5423fe914b197a56011180b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15c4d3ec5423fe914b197a56011180b9">&#9670;&nbsp;</a></span>findSuspectInks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findSuspectInks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  639</span>                                       {</div>
<div class="line"><span class="lineno">  640</span>  QMultiMap&lt;TUINT32, int&gt; paintColorTable;</div>
<div class="line"><span class="lineno">  641</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  642</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  643</span>    <span class="keywordflow">if</span> (0 == (region.type &amp; RegionInfo::Paint)) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  644</span>    TPixel32 color = m_colors[region.colorIndex];</div>
<div class="line"><span class="lineno">  645</span>    <span class="keywordflow">if</span> (color == TPixel32(0, 0, 0)) {</div>
<div class="line"><span class="lineno">  646</span>      <span class="keywordtype">int</span> x = 1234;</div>
<div class="line"><span class="lineno">  647</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  648</span>    }</div>
<div class="line"><span class="lineno">  649</span>    TUINT32 rawColor = *(TUINT32 *)&amp;color;</div>
<div class="line"><span class="lineno">  650</span>    paintColorTable.insert(rawColor, i);</div>
<div class="line"><span class="lineno">  651</span>  }</div>
<div class="line"><span class="lineno">  652</span> </div>
<div class="line"><span class="lineno">  653</span>  <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><span class="lineno">  654</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  655</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  656</span>    <span class="keywordflow">if</span> (region.isInk() &amp;&amp; region.links.size() == 2) {</div>
<div class="line"><span class="lineno">  657</span>      <span class="keywordtype">int</span> ra = region.links.keys().at(0), rb = region.links.keys().at(1);</div>
<div class="line"><span class="lineno">  658</span>      <span class="keywordflow">if</span> (ra &gt;= 0 &amp;&amp; rb &gt;= 0) {</div>
<div class="line"><span class="lineno">  659</span>        <span class="keywordflow">if</span> (!m_regions[ra].isInk()) qSwap(ra, rb);</div>
<div class="line"><span class="lineno">  660</span>        <span class="keywordflow">if</span> (m_regions[ra].isInk() &amp;&amp; !m_regions[rb].isInk()) {</div>
<div class="line"><span class="lineno">  661</span>          <span class="keywordtype">int</span> sa = region.links[ra];</div>
<div class="line"><span class="lineno">  662</span>          <span class="keywordtype">int</span> sb = region.links[rb];</div>
<div class="line"><span class="lineno">  663</span>          <span class="keywordflow">if</span> (sa &gt; sb) {</div>
<div class="line"><span class="lineno">  664</span>            region.type = RegionInfo::Paint;</div>
<div class="line"><span class="lineno">  665</span>            count++;</div>
<div class="line"><span class="lineno">  666</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  667</span>          }</div>
<div class="line"><span class="lineno">  668</span>        }</div>
<div class="line"><span class="lineno">  669</span>      }</div>
<div class="line"><span class="lineno">  670</span>    }</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::ThinInk) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  673</span>    TUINT32 rawColor = *(TUINT32 *)&amp;m_colors[region.colorIndex];</div>
<div class="line"><span class="lineno">  674</span>    if (paintColorTable.contains(rawColor)) {</div>
<div class="line"><span class="lineno">  675</span>      region.type = RegionInfo::Unknown;</div>
<div class="line"><span class="lineno">  676</span>      count++;</div>
<div class="line"><span class="lineno">  677</span>    }</div>
<div class="line"><span class="lineno">  678</span>  }</div>
<div class="line"><span class="lineno">  679</span> </div>
<div class="line"><span class="lineno">  680</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  681</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  682</span>    <span class="keywordflow">if</span> (region.isInk() &amp;&amp; 10 &lt;= region.pixelCount &amp;&amp; region.pixelCount &lt; 100) {</div>
<div class="line"><span class="lineno">  683</span>      <span class="keywordtype">int</span> lx = region.x1 - region.x0 + 1;</div>
<div class="line"><span class="lineno">  684</span>      <span class="keywordtype">int</span> ly = region.y1 - region.y0 + 1;</div>
<div class="line"><span class="lineno">  685</span>      <span class="keywordtype">int</span> d  = std::max(lx, ly);</div>
<div class="line"><span class="lineno">  686</span>      <span class="keywordflow">if</span> (std::min(lx, ly) * 2 &gt; std::max(lx, ly) &amp;&amp; region.pixelCount &gt; d * d / 2) {</div>
<div class="line"><span class="lineno">  687</span>        region.type = RegionInfo::Paint;</div>
<div class="line"><span class="lineno">  688</span>      }</div>
<div class="line"><span class="lineno">  689</span>    }</div>
<div class="line"><span class="lineno">  690</span> </div>
<div class="line"><span class="lineno">  691</span>    <span class="keywordflow">if</span> (region.type == RegionInfo::Paint ||</div>
<div class="line"><span class="lineno">  692</span>        region.type == RegionInfo::Unknown) {</div>
<div class="line"><span class="lineno">  693</span>      <span class="keywordtype">bool</span> isInk = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  694</span>      <span class="keywordflow">if</span> (region.boundaries.at(0) == 0) {</div>
<div class="line"><span class="lineno">  695</span>        <span class="keywordflow">if</span> (region.boundaries.count() == 2)</div>
<div class="line"><span class="lineno">  696</span>          isInk = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  697</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (region.boundaries.count() == 3) {</div>
<div class="line"><span class="lineno">  698</span>          <span class="keywordtype">int</span> b1                 = region.boundaries.at(1);</div>
<div class="line"><span class="lineno">  699</span>          <span class="keywordtype">int</span> b2                 = region.boundaries.at(2);</div>
<div class="line"><span class="lineno">  700</span>          <span class="keywordflow">if</span> (b1 * 2 &lt; b2) isInk = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  701</span>        }</div>
<div class="line"><span class="lineno">  702</span>      }</div>
<div class="line"><span class="lineno">  703</span>      <span class="keywordflow">if</span> (isInk) region.type = RegionInfo::Ink;</div>
<div class="line"><span class="lineno">  704</span>    }</div>
<div class="line"><span class="lineno">  705</span>  }</div>
<div class="line"><span class="lineno">  706</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aabbf949273280be231e954fd88f2da88" name="aabbf949273280be231e954fd88f2da88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabbf949273280be231e954fd88f2da88">&#9670;&nbsp;</a></span>findThinInks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findThinInks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  542</span>                                    {</div>
<div class="line"><span class="lineno">  543</span>  <span class="keywordflow">if</span> (!m_regionRas || !m_borderRas || m_regions.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  544</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  545</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  546</span>    <span class="keywordflow">if</span> (region.type != RegionInfo::Unknown) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  547</span>    QList&lt;int&gt; &amp;bs = region.boundaries;</div>
<div class="line"><span class="lineno">  548</span>    <span class="keywordflow">if</span> (bs.count() == 2)</div>
<div class="line"><span class="lineno">  549</span>      region.type = RegionInfo::ThinInk;</div>
<div class="line"><span class="lineno">  550</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bs.count() == 3) {</div>
<div class="line"><span class="lineno">  551</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  552</span>      <span class="keywordflow">if</span> (bs[2] * 5 &lt; bs[1]) region.type = RegionInfo::ThinInk;</div>
<div class="line"><span class="lineno">  553</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  554</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  555</span>      <span class="keywordtype">int</span> k = 1;</div>
<div class="line"><span class="lineno">  556</span>      <span class="keywordtype">int</span> s = 0;</div>
<div class="line"><span class="lineno">  557</span>      <span class="keywordflow">while</span> (k &lt; bs.count() &amp;&amp; s * 100 &lt; region.pixelCount * 90) s += bs[k++];</div>
<div class="line"><span class="lineno">  558</span>      <span class="keywordflow">if</span> (region.pixelCount &gt; 100 &amp;&amp; k &lt;= 3)</div>
<div class="line"><span class="lineno">  559</span>        region.type = RegionInfo::ThinInk;  <span class="comment">// era Ink per qualche ragione</span></div>
<div class="line"><span class="lineno">  560</span>    }</div>
<div class="line"><span class="lineno">  561</span>  }</div>
<div class="line"><span class="lineno">  562</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4935692bd8410887715578358fba22d0" name="a4935692bd8410887715578358fba22d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4935692bd8410887715578358fba22d0">&#9670;&nbsp;</a></span>findThinPaints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::findThinPaints </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  612</span>                                      {</div>
<div class="line"><span class="lineno">  613</span>  <span class="keywordtype">int</span> lx = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  614</span>  <span class="keywordtype">int</span> ly = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  615</span> </div>
<div class="line"><span class="lineno">  616</span>  QList&lt;int&gt; regions;</div>
<div class="line"><span class="lineno">  617</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  618</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  619</span>    <span class="keywordflow">if</span> (!region.isInk()) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  620</span>    <span class="keywordflow">if</span> (region.type == RegionInfo::MainInk) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  621</span> </div>
<div class="line"><span class="lineno">  622</span>    <span class="keywordtype">int</span> inkBoundary = 0;</div>
<div class="line"><span class="lineno">  623</span>    QMap&lt;int, int&gt;::ConstIterator it;</div>
<div class="line"><span class="lineno">  624</span>    <span class="keywordflow">for</span> (it = region.links.begin(); it != region.links.end(); ++it) {</div>
<div class="line"><span class="lineno">  625</span>      <span class="keywordtype">int</span> c            = it.key();</div>
<div class="line"><span class="lineno">  626</span>      <span class="keywordtype">int</span> linkStrength = it.value();  <span class="comment">// number of contact points</span></div>
<div class="line"><span class="lineno">  627</span>      <span class="keywordflow">if</span> (c &gt;= 0 &amp;&amp; m_regions[c].isInk()) inkBoundary += linkStrength;</div>
<div class="line"><span class="lineno">  628</span>    }</div>
<div class="line"><span class="lineno">  629</span>    region.inkBoundary = inkBoundary;</div>
<div class="line"><span class="lineno">  630</span>    <span class="keywordflow">if</span> (inkBoundary * 100 &gt; region.perimeter * 80) regions.append(i);</div>
<div class="line"><span class="lineno">  631</span>  }</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c : regions)</div>
<div class="line"><span class="lineno">  634</span>    m_regions[c].type = RegionInfo::SmallPaint;</div>
<div class="line"><span class="lineno">  635</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a19266e6fc236f1c71037b4ff9037f447" name="a19266e6fc236f1c71037b4ff9037f447"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19266e6fc236f1c71037b4ff9037f447">&#9670;&nbsp;</a></span>getPalette()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_palette.html">TPalette</a> * Naa2TlvConverter::getPalette </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  117</span>{ <span class="keywordflow">return</span> m_palette; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae47d71cceb01ca2b6ea9f0a20de7874e" name="ae47d71cceb01ca2b6ea9f0a20de7874e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae47d71cceb01ca2b6ea9f0a20de7874e">&#9670;&nbsp;</a></span>getRegionIndex()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Naa2TlvConverter::getRegionIndex </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  141</span>                                         {</div>
<div class="line"><span class="lineno">  142</span>    <span class="keywordflow">if</span> (!!m_regionRas &amp;&amp; 0 &lt;= x &amp;&amp; x &lt; m_regionRas-&gt;getLx() &amp;&amp; 0 &lt;= y &amp;&amp;</div>
<div class="line"><span class="lineno">  143</span>        y &lt; m_regionRas-&gt;getLy())</div>
<div class="line"><span class="lineno">  144</span>      <span class="keywordflow">return</span> m_regionRas-&gt;pixels(y)[x];</div>
<div class="line"><span class="lineno">  145</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  146</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  147</span>  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a99634f4451b98f749ab9b0d5f015da5b" name="a99634f4451b98f749ab9b0d5f015da5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99634f4451b98f749ab9b0d5f015da5b">&#9670;&nbsp;</a></span>makeTlv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_toonz_image_p.html">TToonzImageP</a> Naa2TlvConverter::makeTlv </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>transparentSyntheticInks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QList&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>usedStyleIds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dpi</em> = <code>0.0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1015</span>                                                                             {</div>
<div class="line"><span class="lineno"> 1016</span>  <span class="keywordflow">if</span> (!m_valid || m_colors.empty() || m_regions.empty() || !m_regionRas)</div>
<div class="line"><span class="lineno"> 1017</span>    <span class="keywordflow">return</span> <a class="code hl_class" href="class_t_toonz_image_p.html">TToonzImageP</a>();</div>
<div class="line"><span class="lineno"> 1018</span>  <span class="keywordtype">int</span> lx                = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno"> 1019</span>  <span class="keywordtype">int</span> ly                = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno"> 1020</span>  <a class="code hl_class" href="class_t_palette.html">TPalette</a> *palette     = m_palette;</div>
<div class="line"><span class="lineno"> 1021</span>  <span class="keywordflow">if</span> (!palette) palette = <span class="keyword">new</span> <a class="code hl_class" href="class_t_palette.html">TPalette</a>();</div>
<div class="line"><span class="lineno"> 1022</span> </div>
<div class="line"><span class="lineno"> 1023</span>  <a class="code hl_class" href="class_t_raster_p_t.html">TRasterCM32P</a> ras(lx, ly);</div>
<div class="line"><span class="lineno"> 1024</span> </div>
<div class="line"><span class="lineno"> 1025</span>  QList&lt;int&gt; styleIds;</div>
<div class="line"><span class="lineno"> 1026</span> </div>
<div class="line"><span class="lineno"> 1027</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_colors.count() - 1; i++) {</div>
<div class="line"><span class="lineno"> 1028</span>    TPixel32 color  = m_colors.at(i);</div>
<div class="line"><span class="lineno"> 1029</span>    <span class="keywordtype">int</span> styleId     = palette-&gt;getClosestStyle(color);</div>
<div class="line"><span class="lineno"> 1030</span>    <a class="code hl_class" href="class_t_color_style.html">TColorStyle</a> *cs = styleId &lt; 0 ? 0 : palette-&gt;getStyle(styleId);</div>
<div class="line"><span class="lineno"> 1031</span>    <span class="keywordflow">if</span> (cs) {</div>
<div class="line"><span class="lineno"> 1032</span>      <span class="keywordflow">if</span> (cs-&gt;<a class="code hl_function" href="class_t_color_style.html#abd78dd4e3ff3e2e78b647195f7622aa7">getMainColor</a>() != color) cs = 0;</div>
<div class="line"><span class="lineno"> 1033</span>    }</div>
<div class="line"><span class="lineno"> 1034</span>    <span class="keywordflow">if</span> (cs == 0) {</div>
<div class="line"><span class="lineno"> 1035</span>      styleId = palette-&gt;addStyle(color);</div>
<div class="line"><span class="lineno"> 1036</span>      palette-&gt;getPage(0)-&gt;addStyle(styleId);</div>
<div class="line"><span class="lineno"> 1037</span>      cs = palette-&gt;getStyle(styleId);</div>
<div class="line"><span class="lineno"> 1038</span>    }</div>
<div class="line"><span class="lineno"> 1039</span>    styleIds.append(styleId);</div>
<div class="line"><span class="lineno"> 1040</span>    <span class="keywordflow">if</span> (!usedStyleIds.contains(styleId)) usedStyleIds.append(styleId);</div>
<div class="line"><span class="lineno"> 1041</span>  }</div>
<div class="line"><span class="lineno"> 1042</span>  styleIds.append(0);  <span class="comment">// synthetic ink</span></div>
<div class="line"><span class="lineno"> 1043</span> </div>
<div class="line"><span class="lineno"> 1044</span>  <span class="comment">// int syntheticInkStyleId = palette-&gt;getPage(0)-&gt;addStyle(TPixel32(0,0,0,0));</span></div>
<div class="line"><span class="lineno"> 1045</span>  <span class="comment">// styleIds.append(syntheticInkStyleId);</span></div>
<div class="line"><span class="lineno"> 1046</span> </div>
<div class="line"><span class="lineno"> 1047</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno"> 1048</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *workScanLine = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno"> 1049</span>    <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a> *outScanLine      = ras-&gt;pixels(y);</div>
<div class="line"><span class="lineno"> 1050</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno"> 1051</span>      <span class="keywordtype">int</span> c = workScanLine[x];</div>
<div class="line"><span class="lineno"> 1052</span>      Q_ASSERT(0 &lt;= c &amp;&amp; c &lt; m_regions.count());</div>
<div class="line"><span class="lineno"> 1053</span> </div>
<div class="line"><span class="lineno"> 1054</span>      <span class="keywordtype">int</span> color = m_regions[c].colorIndex;</div>
<div class="line"><span class="lineno"> 1055</span>      Q_ASSERT(0 &lt;= color &amp;&amp; color &lt; styleIds.count());</div>
<div class="line"><span class="lineno"> 1056</span> </div>
<div class="line"><span class="lineno"> 1057</span>      <span class="keywordtype">int</span> styleId = styleIds.at(color);</div>
<div class="line"><span class="lineno"> 1058</span> </div>
<div class="line"><span class="lineno"> 1059</span>      RegionInfo::Type type = m_regions.at(c).type;</div>
<div class="line"><span class="lineno"> 1060</span>      <span class="keywordflow">if</span> (type == RegionInfo::Background)</div>
<div class="line"><span class="lineno"> 1061</span>        outScanLine[x] = <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a>();</div>
<div class="line"><span class="lineno"> 1062</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type &amp; RegionInfo::Ink)</div>
<div class="line"><span class="lineno"> 1063</span>        outScanLine[x] = <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a>(styleId, 0, 0);</div>
<div class="line"><span class="lineno"> 1064</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_syntheticInkRas-&gt;pixels(y)[x] == 1)</div>
<div class="line"><span class="lineno"> 1065</span>        outScanLine[x] =</div>
<div class="line"><span class="lineno"> 1066</span>            <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a>(transparentSyntheticInks ? 0 : styleId, 0, 0);</div>
<div class="line"><span class="lineno"> 1067</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1068</span>        outScanLine[x] = <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a>(0, styleId, 255);</div>
<div class="line"><span class="lineno"> 1069</span>    }</div>
<div class="line"><span class="lineno"> 1070</span>  }</div>
<div class="line"><span class="lineno"> 1071</span> </div>
<div class="line"><span class="lineno"> 1072</span>  <span class="keyword">struct </span>locals {</div>
<div class="line"><span class="lineno"> 1073</span>    <span class="keyword">static</span> <span class="keywordtype">bool</span> compare(<span class="keyword">const</span> QPair&lt;int, int&gt; &amp;p1, <span class="keyword">const</span> QPair&lt;int, int&gt; &amp;p2) {</div>
<div class="line"><span class="lineno"> 1074</span>      <span class="keywordflow">return</span> p1.second &gt; p2.second;</div>
<div class="line"><span class="lineno"> 1075</span>    }</div>
<div class="line"><span class="lineno"> 1076</span> </div>
<div class="line"><span class="lineno"> 1077</span>    <span class="keyword">static</span> <span class="keywordtype">void</span> addPaint(QList&lt;QPair&lt;int, int&gt;&gt; &amp;list, <span class="keyword">const</span> <span class="keywordtype">int</span> paintId) {</div>
<div class="line"><span class="lineno"> 1078</span>      <span class="keywordflow">if</span> (paintId == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1079</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; list.size(); i++)</div>
<div class="line"><span class="lineno"> 1080</span>        <span class="keywordflow">if</span> (list[i].first == paintId) {</div>
<div class="line"><span class="lineno"> 1081</span>          list[i].second += 1;</div>
<div class="line"><span class="lineno"> 1082</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1083</span>        }</div>
<div class="line"><span class="lineno"> 1084</span>      list.append(QPair&lt;int, int&gt;(paintId, 1));</div>
<div class="line"><span class="lineno"> 1085</span>    }</div>
<div class="line"><span class="lineno"> 1086</span>  };  <span class="comment">// locals</span></div>
<div class="line"><span class="lineno"> 1087</span> </div>
<div class="line"><span class="lineno"> 1088</span>  <span class="comment">// Here, expand paint area under the solid ink pixel in order to prevent the</span></div>
<div class="line"><span class="lineno"> 1089</span>  <span class="comment">// gap appears when the &quot;Add Antialiasing&quot; option is activated.</span></div>
<div class="line"><span class="lineno"> 1090</span>  <a class="code hl_class" href="class_t_raster_p_t.html">TRasterCM32P</a> copiedRas = ras-&gt;clone();</div>
<div class="line"><span class="lineno"> 1091</span>  copiedRas-&gt;lock();</div>
<div class="line"><span class="lineno"> 1092</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno"> 1093</span>    <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a> *topScanLine    = copiedRas-&gt;pixels((y == 0) ? y : y - 1);</div>
<div class="line"><span class="lineno"> 1094</span>    <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a> *middleScanLine = copiedRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno"> 1095</span>    <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a> *bottomScanLine = copiedRas-&gt;pixels((y == ly - 1) ? y : y + 1);</div>
<div class="line"><span class="lineno"> 1096</span>    <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a> *outScanLine    = ras-&gt;pixels(y);</div>
<div class="line"><span class="lineno"> 1097</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno"> 1098</span>      <span class="keywordflow">if</span> (!middleScanLine[x].isPureInk() || middleScanLine[x].getPaint() != 0)</div>
<div class="line"><span class="lineno"> 1099</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1100</span> </div>
<div class="line"><span class="lineno"> 1101</span>      <span class="keywordtype">int</span> prev_x = (x == 0) ? x : x - 1;</div>
<div class="line"><span class="lineno"> 1102</span>      <span class="keywordtype">int</span> next_x = (x == lx - 1) ? x : x + 1;</div>
<div class="line"><span class="lineno"> 1103</span>      QList&lt;QPair&lt;int, int&gt;&gt; neighborPaints;</div>
<div class="line"><span class="lineno"> 1104</span>      locals::addPaint(neighborPaints, topScanLine[prev_x].getPaint());</div>
<div class="line"><span class="lineno"> 1105</span>      locals::addPaint(neighborPaints, topScanLine[x].getPaint());</div>
<div class="line"><span class="lineno"> 1106</span>      locals::addPaint(neighborPaints, topScanLine[next_x].getPaint());</div>
<div class="line"><span class="lineno"> 1107</span>      locals::addPaint(neighborPaints, middleScanLine[prev_x].getPaint());</div>
<div class="line"><span class="lineno"> 1108</span>      locals::addPaint(neighborPaints, middleScanLine[next_x].getPaint());</div>
<div class="line"><span class="lineno"> 1109</span>      locals::addPaint(neighborPaints, bottomScanLine[prev_x].getPaint());</div>
<div class="line"><span class="lineno"> 1110</span>      locals::addPaint(neighborPaints, bottomScanLine[x].getPaint());</div>
<div class="line"><span class="lineno"> 1111</span>      locals::addPaint(neighborPaints, bottomScanLine[next_x].getPaint());</div>
<div class="line"><span class="lineno"> 1112</span>      std::sort(neighborPaints.begin(), neighborPaints.end(), locals::compare);</div>
<div class="line"><span class="lineno"> 1113</span> </div>
<div class="line"><span class="lineno"> 1114</span>      <span class="keywordflow">if</span> (!neighborPaints.isEmpty())</div>
<div class="line"><span class="lineno"> 1115</span>        outScanLine[x].setPaint(neighborPaints[0].first);</div>
<div class="line"><span class="lineno"> 1116</span>    }</div>
<div class="line"><span class="lineno"> 1117</span>  }</div>
<div class="line"><span class="lineno"> 1118</span>  copiedRas-&gt;unlock();</div>
<div class="line"><span class="lineno"> 1119</span> </div>
<div class="line"><span class="lineno"> 1120</span>  <a class="code hl_class" href="class_t_toonz_image_p.html">TToonzImageP</a> ti = <span class="keyword">new</span> <a class="code hl_class" href="class_t_toonz_image.html">TToonzImage</a>(ras, ras-&gt;getBounds());</div>
<div class="line"><span class="lineno"> 1121</span>  ti-&gt;setPalette(palette);</div>
<div class="line"><span class="lineno"> 1122</span> </div>
<div class="line"><span class="lineno"> 1123</span>  <span class="keywordflow">if</span> (dpi &gt; 0.0)  <span class="comment">// for now, accept only square pixel</span></div>
<div class="line"><span class="lineno"> 1124</span>    ti-&gt;setDpi(dpi, dpi);</div>
<div class="line"><span class="lineno"> 1125</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1126</span>    ti-&gt;setDpi(72, 72);</div>
<div class="line"><span class="lineno"> 1127</span> </div>
<div class="line"><span class="lineno"> 1128</span>  <span class="keywordflow">return</span> ti;</div>
<div class="line"><span class="lineno"> 1129</span>}</div>
<div class="ttc" id="aclass_t_color_style_html"><div class="ttname"><a href="class_t_color_style.html">TColorStyle</a></div><div class="ttdoc">Abstract class representing a color style in a Toonz palette.</div><div class="ttdef"><b>Definition:</b> tcolorstyles.h:84</div></div>
<div class="ttc" id="aclass_t_color_style_html_abd78dd4e3ff3e2e78b647195f7622aa7"><div class="ttname"><a href="class_t_color_style.html#abd78dd4e3ff3e2e78b647195f7622aa7">TColorStyle::getMainColor</a></div><div class="ttdeci">virtual TPixel32 getMainColor() const</div><div class="ttdoc">Returns the style's main color, or black if none.</div><div class="ttdef"><b>Definition:</b> tcolorstyles.h:245</div></div>
<div class="ttc" id="aclass_t_palette_html"><div class="ttname"><a href="class_t_palette.html">TPalette</a></div><div class="ttdoc">The class representing a Toonz palette object.</div><div class="ttdef"><b>Definition:</b> tpalette.h:85</div></div>
<div class="ttc" id="aclass_t_pixel_c_m32_html"><div class="ttname"><a href="class_t_pixel_c_m32.html">TPixelCM32</a></div><div class="ttdoc">Toonz5.0 color-map, 12+12+8 bits (ink,paint,tone)</div><div class="ttdef"><b>Definition:</b> tpixelcm.h:22</div></div>
<div class="ttc" id="aclass_t_raster_p_t_html"><div class="ttname"><a href="class_t_raster_p_t.html">TRasterPT&lt; TPixelCM32 &gt;</a></div></div>
<div class="ttc" id="aclass_t_toonz_image_html"><div class="ttname"><a href="class_t_toonz_image.html">TToonzImage</a></div><div class="ttdoc">An image containing a Toonz raster.</div><div class="ttdef"><b>Definition:</b> ttoonzimage.h:23</div></div>
<div class="ttc" id="aclass_t_toonz_image_p_html"><div class="ttname"><a href="class_t_toonz_image_p.html">TToonzImageP</a></div><div class="ttdef"><b>Definition:</b> ttoonzimage.h:126</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afcbe43bcb6bb6cec6da9b42068feeddb" name="afcbe43bcb6bb6cec6da9b42068feeddb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcbe43bcb6bb6cec6da9b42068feeddb">&#9670;&nbsp;</a></span>measureThickness() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::measureThickness </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  808</span>                                        {</div>
<div class="line"><span class="lineno">  809</span>  QTime timer;</div>
<div class="line"><span class="lineno">  810</span>  timer.start();</div>
<div class="line"><span class="lineno">  811</span>  <span class="keywordflow">if</span> (!m_regionRas || !m_borderRas) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  812</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *regionBuffer = m_regionRas-&gt;pixels();</div>
<div class="line"><span class="lineno">  813</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *borderBuffer  = m_borderRas-&gt;pixels();</div>
<div class="line"><span class="lineno">  814</span>  <span class="keywordtype">int</span> lx                       = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  815</span>  <span class="keywordtype">int</span> ly                       = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  816</span> </div>
<div class="line"><span class="lineno">  817</span>  <span class="keywordflow">if</span> (!m_dotRas || m_dotRas-&gt;getLx() != lx || m_dotRas-&gt;getLy() != ly) {</div>
<div class="line"><span class="lineno">  818</span>    <span class="keyword">delete</span> m_dotRas;</div>
<div class="line"><span class="lineno">  819</span>    m_dotRas = <span class="keyword">new</span> <a class="code hl_class" href="class_work_raster.html">WorkRaster&lt;unsigned char&gt;</a>(lx, ly);</div>
<div class="line"><span class="lineno">  820</span>  }</div>
<div class="line"><span class="lineno">  821</span>  memset(m_dotRas-&gt;pixels(), 0, lx * ly);</div>
<div class="line"><span class="lineno">  822</span>  <span class="comment">// for(int i=0;i&lt;lx*ly;i++) m_dotRas-&gt;pixels()[i]=0;</span></div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dotBuffer = m_dotRas-&gt;pixels();</div>
<div class="line"><span class="lineno">  825</span> </div>
<div class="line"><span class="lineno">  826</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  827</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  828</span>      <span class="keywordflow">if</span> (borderBuffer[y * lx + x] != 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  829</span>      <span class="keywordflow">if</span> (dotBuffer[y * lx + x] != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  830</span>      <span class="keywordtype">int</span> regionId       = regionBuffer[y * lx + x];</div>
<div class="line"><span class="lineno">  831</span>      <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[regionId];</div>
<div class="line"><span class="lineno">  832</span>      <span class="keywordtype">int</span> type           = region.type;</div>
<div class="line"><span class="lineno">  833</span>      <span class="keywordflow">if</span> (type == RegionInfo::Background || type == RegionInfo::LargePaint ||</div>
<div class="line"><span class="lineno">  834</span>          type == RegionInfo::ThinInk)</div>
<div class="line"><span class="lineno">  835</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  836</span> </div>
<div class="line"><span class="lineno">  837</span>      <span class="keywordtype">int</span> thickness = measureThickness(x, y);</div>
<div class="line"><span class="lineno">  838</span>      <span class="keywordflow">if</span> (thickness &lt; 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  839</span>      QMap&lt;int, int&gt;::Iterator it = region.thicknessHistogram.find(thickness);</div>
<div class="line"><span class="lineno">  840</span>      <span class="keywordflow">if</span> (it != region.thicknessHistogram.end())</div>
<div class="line"><span class="lineno">  841</span>        it.value() += 1;</div>
<div class="line"><span class="lineno">  842</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  843</span>        region.thicknessHistogram.insert(thickness, 1);</div>
<div class="line"><span class="lineno">  844</span>    }</div>
<div class="line"><span class="lineno">  845</span>  }</div>
<div class="line"><span class="lineno">  846</span> </div>
<div class="line"><span class="lineno">  847</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) {</div>
<div class="line"><span class="lineno">  848</span>    <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;region = m_regions[i];</div>
<div class="line"><span class="lineno">  849</span>    <span class="keywordtype">int</span> type           = region.type;</div>
<div class="line"><span class="lineno">  850</span>    <span class="keywordflow">if</span> (type == RegionInfo::Background || type == RegionInfo::LargePaint ||</div>
<div class="line"><span class="lineno">  851</span>        type == RegionInfo::ThinInk)</div>
<div class="line"><span class="lineno">  852</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  853</span>    <span class="keywordtype">int</span> thicknessCount = 0;</div>
<div class="line"><span class="lineno">  854</span>    <span class="keywordtype">double</span> thickness   = 0.0;</div>
<div class="line"><span class="lineno">  855</span>    <span class="keywordflow">for</span> (QMap&lt;int, int&gt;::Iterator it = region.thicknessHistogram.begin();</div>
<div class="line"><span class="lineno">  856</span>         it != region.thicknessHistogram.end(); ++it) {</div>
<div class="line"><span class="lineno">  857</span>      thicknessCount += it.value();</div>
<div class="line"><span class="lineno">  858</span>      thickness += it.key() * it.value();</div>
<div class="line"><span class="lineno">  859</span>    }</div>
<div class="line"><span class="lineno">  860</span>    <span class="keywordflow">if</span> (thicknessCount &gt; 0) {</div>
<div class="line"><span class="lineno">  861</span>      thickness *= 1.0 / thicknessCount;</div>
<div class="line"><span class="lineno">  862</span>      region.thickness = thickness;</div>
<div class="line"><span class="lineno">  863</span>    }</div>
<div class="line"><span class="lineno">  864</span>  }</div>
<div class="line"><span class="lineno">  865</span>  qDebug() &lt;&lt; <span class="stringliteral">&quot;measure thickness. time=&quot;</span> &lt;&lt; timer.elapsed();</div>
<div class="line"><span class="lineno">  866</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a49611b50e7951a08c0c27fd4602e96e7" name="a49611b50e7951a08c0c27fd4602e96e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49611b50e7951a08c0c27fd4602e96e7">&#9670;&nbsp;</a></span>measureThickness() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Naa2TlvConverter::measureThickness </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  870</span>                                                     {</div>
<div class="line"><span class="lineno">  871</span>  <span class="keywordflow">if</span> (!m_regionRas || !m_borderRas || !m_dotRas) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  872</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *regionBuffer = m_regionRas-&gt;pixels();</div>
<div class="line"><span class="lineno">  873</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *borderBuffer  = m_borderRas-&gt;pixels();</div>
<div class="line"><span class="lineno">  874</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dotBuffer     = m_dotRas-&gt;pixels();</div>
<div class="line"><span class="lineno">  875</span> </div>
<div class="line"><span class="lineno">  876</span>  <span class="keywordtype">int</span> lx = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  877</span>  <span class="keywordtype">int</span> ly = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  878</span> </div>
<div class="line"><span class="lineno">  879</span>  <span class="keywordtype">int</span> k0 = lx * y0 + x0;</div>
<div class="line"><span class="lineno">  880</span>  <span class="comment">// no needs to worry about image limits</span></div>
<div class="line"><span class="lineno">  881</span>  <span class="keywordflow">if</span> (x0 - 1 &lt; 0 || x0 + 1 &gt;= lx || y0 - 1 &lt; 0 || y0 + 1 &gt;= ly) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  882</span>  <span class="comment">// we must start from a border</span></div>
<div class="line"><span class="lineno">  883</span>  <span class="keywordflow">if</span> (borderBuffer[k0] != 1) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  884</span> </div>
<div class="line"><span class="lineno">  885</span>  <span class="comment">// far from other measures</span></div>
<div class="line"><span class="lineno">  886</span>  <span class="keywordflow">if</span> (dotBuffer[k0] != 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  887</span> </div>
<div class="line"><span class="lineno">  888</span>  <span class="keywordtype">int</span> regionId     = regionBuffer[k0];</div>
<div class="line"><span class="lineno">  889</span>  <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> &amp;info = m_regions[regionId];</div>
<div class="line"><span class="lineno">  890</span> </div>
<div class="line"><span class="lineno">  891</span>  <span class="comment">// directions</span></div>
<div class="line"><span class="lineno">  892</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> dd[8] = {1, lx + 1, lx, lx - 1, -1, -1 - lx, -lx, 1 - lx};</div>
<div class="line"><span class="lineno">  893</span> </div>
<div class="line"><span class="lineno">  894</span>  <span class="comment">// a is a direction index; a : inside; a+1 : outside</span></div>
<div class="line"><span class="lineno">  895</span>  <span class="keywordtype">int</span> a = 0;</div>
<div class="line"><span class="lineno">  896</span>  <span class="keywordflow">while</span> (a &lt; 8 &amp;&amp;</div>
<div class="line"><span class="lineno">  897</span>         !(regionBuffer[k0 + dd[a]] == regionId &amp;&amp;</div>
<div class="line"><span class="lineno">  898</span>           regionBuffer[k0 + dd[(a + 1) % 8]] != regionId))</div>
<div class="line"><span class="lineno">  899</span>    a++;</div>
<div class="line"><span class="lineno">  900</span>  <span class="keywordflow">if</span> (a == 8) {</div>
<div class="line"><span class="lineno">  901</span>    <span class="comment">// k0 is an isolated point or (strange!) an intern point</span></div>
<div class="line"><span class="lineno">  902</span>    qDebug() &lt;&lt; <span class="stringliteral">&quot;Isolated point or intern point&quot;</span>;</div>
<div class="line"><span class="lineno">  903</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  904</span>  }</div>
<div class="line"><span class="lineno">  905</span>  <span class="keywordtype">int</span> ka = k0 + dd[a];</div>
<div class="line"><span class="lineno">  906</span> </div>
<div class="line"><span class="lineno">  907</span>  <span class="keywordtype">int</span> b                                          = (a + 2) % 8;</div>
<div class="line"><span class="lineno">  908</span>  <span class="keywordflow">while</span> (regionBuffer[k0 + dd[b]] != regionId) b = (b + 1) % 8;</div>
<div class="line"><span class="lineno">  909</span>  <span class="comment">// a..b = boundaries</span></div>
<div class="line"><span class="lineno">  910</span>  <span class="keywordtype">int</span> kb = k0 + dd[b];</div>
<div class="line"><span class="lineno">  911</span>  <span class="keywordflow">if</span> (a == b || ((b + 1) % 8) == a) <span class="keywordflow">return</span> -1;  <span class="comment">// k0 is a corner</span></div>
<div class="line"><span class="lineno">  912</span> </div>
<div class="line"><span class="lineno">  913</span>  dotBuffer[k0] = 1;</div>
<div class="line"><span class="lineno">  914</span>  dotBuffer[ka] = 2;</div>
<div class="line"><span class="lineno">  915</span>  dotBuffer[kb] = 3;</div>
<div class="line"><span class="lineno">  916</span> </div>
<div class="line"><span class="lineno">  917</span>  <span class="keywordtype">int</span> c       = (b + 1) % 8;</div>
<div class="line"><span class="lineno">  918</span>  <span class="keywordtype">bool</span> isThin = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  919</span>  <span class="keywordflow">while</span> (c != a) {</div>
<div class="line"><span class="lineno">  920</span>    <span class="keywordflow">if</span> (regionBuffer[k0 + dd[c]] != regionId) {</div>
<div class="line"><span class="lineno">  921</span>      isThin = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  922</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  923</span>    }</div>
<div class="line"><span class="lineno">  924</span>    c = (c + 1) % 8;</div>
<div class="line"><span class="lineno">  925</span>  }</div>
<div class="line"><span class="lineno">  926</span>  <span class="keywordflow">if</span> (isThin) {</div>
<div class="line"><span class="lineno">  927</span>    <span class="comment">// stroke larga un pixel, con paint da una parte e dall&#39;altra.</span></div>
<div class="line"><span class="lineno">  928</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  929</span>  }</div>
<div class="line"><span class="lineno">  930</span> </div>
<div class="line"><span class="lineno">  931</span>  <span class="keywordtype">int</span> baseLength = 3;</div>
<div class="line"><span class="lineno">  932</span> </div>
<div class="line"><span class="lineno">  933</span>  <span class="keywordtype">int</span> d      = b;</div>
<div class="line"><span class="lineno">  934</span>  <span class="keywordtype">int</span> oldk   = k0;</div>
<div class="line"><span class="lineno">  935</span>  <span class="keywordtype">int</span> k      = kb;</div>
<div class="line"><span class="lineno">  936</span>  <span class="keywordtype">int</span> lastd2 = 0;</div>
<div class="line"><span class="lineno">  937</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; baseLength; i++) {</div>
<div class="line"><span class="lineno">  938</span>    <span class="keywordtype">int</span> x = k % lx;</div>
<div class="line"><span class="lineno">  939</span>    <span class="keywordtype">int</span> y = k / lx;</div>
<div class="line"><span class="lineno">  940</span>    <span class="keywordflow">if</span> (x &lt;= 1 || x &gt;= lx - 1 || y &lt;= 1 || y &gt;= ly - 1)</div>
<div class="line"><span class="lineno">  941</span>      <span class="keywordflow">break</span>;  <span class="comment">// just to be sure</span></div>
<div class="line"><span class="lineno">  942</span>    <span class="keywordtype">int</span> d2 = (x - x0) * (x - x0) + (y - y0) * (y - y0);</div>
<div class="line"><span class="lineno">  943</span>    <span class="keywordflow">if</span> (d2 &lt;= lastd2) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  944</span>    lastd2                                          = d2;</div>
<div class="line"><span class="lineno">  945</span>    <span class="keywordtype">int</span> d1                                          = (d + 4) % 8;</div>
<div class="line"><span class="lineno">  946</span>    d1                                              = (d1 + 1) % 8;</div>
<div class="line"><span class="lineno">  947</span>    <span class="keywordflow">while</span> (regionBuffer[k + dd[d1]] != regionId) d1 = (d1 + 1) % 8;</div>
<div class="line"><span class="lineno">  948</span>    Q_ASSERT(regionBuffer[k + dd[d1]] == regionId);</div>
<div class="line"><span class="lineno">  949</span>    oldk         = k;</div>
<div class="line"><span class="lineno">  950</span>    k            = k + dd[d1];</div>
<div class="line"><span class="lineno">  951</span>    d            = d1;</div>
<div class="line"><span class="lineno">  952</span>    dotBuffer[k] = 4;</div>
<div class="line"><span class="lineno">  953</span>  }</div>
<div class="line"><span class="lineno">  954</span> </div>
<div class="line"><span class="lineno">  955</span>  <span class="comment">// punto ad un estremo (lungo il confine)</span></div>
<div class="line"><span class="lineno">  956</span>  <span class="keywordtype">int</span> x1 = k % lx;</div>
<div class="line"><span class="lineno">  957</span>  <span class="keywordtype">int</span> y1 = k / lx;</div>
<div class="line"><span class="lineno">  958</span> </div>
<div class="line"><span class="lineno">  959</span>  d      = a;</div>
<div class="line"><span class="lineno">  960</span>  oldk   = k0;</div>
<div class="line"><span class="lineno">  961</span>  k      = ka;</div>
<div class="line"><span class="lineno">  962</span>  lastd2 = 0;</div>
<div class="line"><span class="lineno">  963</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; baseLength; i++) {</div>
<div class="line"><span class="lineno">  964</span>    <span class="keywordtype">int</span> x = k % lx;</div>
<div class="line"><span class="lineno">  965</span>    <span class="keywordtype">int</span> y = k / lx;</div>
<div class="line"><span class="lineno">  966</span>    <span class="keywordflow">if</span> (x &lt;= 1 || x &gt;= lx - 1 || y &lt;= 1 || y &gt;= ly - 1)</div>
<div class="line"><span class="lineno">  967</span>      <span class="keywordflow">break</span>;  <span class="comment">// just to be sure</span></div>
<div class="line"><span class="lineno">  968</span>    <span class="keywordtype">int</span> d2 = (x - x0) * (x - x0) + (y - y0) * (y - y0);</div>
<div class="line"><span class="lineno">  969</span>    <span class="keywordflow">if</span> (d2 &lt;= lastd2) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  970</span>    lastd2                                          = d2;</div>
<div class="line"><span class="lineno">  971</span>    <span class="keywordtype">int</span> d1                                          = (d + 4) % 8;</div>
<div class="line"><span class="lineno">  972</span>    d1                                              = (d1 + 7) % 8;</div>
<div class="line"><span class="lineno">  973</span>    <span class="keywordflow">while</span> (regionBuffer[k + dd[d1]] != regionId) d1 = (d1 + 7) % 8;</div>
<div class="line"><span class="lineno">  974</span>    Q_ASSERT(regionBuffer[k + dd[d1]] == regionId);</div>
<div class="line"><span class="lineno">  975</span>    oldk         = k;</div>
<div class="line"><span class="lineno">  976</span>    k            = k + dd[d1];</div>
<div class="line"><span class="lineno">  977</span>    d            = d1;</div>
<div class="line"><span class="lineno">  978</span>    dotBuffer[k] = 5;</div>
<div class="line"><span class="lineno">  979</span>  }</div>
<div class="line"><span class="lineno">  980</span> </div>
<div class="line"><span class="lineno">  981</span>  <span class="comment">// punto all&#39;estremo opposto (lungo il confine)</span></div>
<div class="line"><span class="lineno">  982</span>  <span class="keywordtype">int</span> x2 = k % lx;</div>
<div class="line"><span class="lineno">  983</span>  <span class="keywordtype">int</span> y2 = k / lx;</div>
<div class="line"><span class="lineno">  984</span> </div>
<div class="line"><span class="lineno">  985</span>  <span class="keywordtype">int</span> dx = y2 - y1, dy = x1 - x2;</div>
<div class="line"><span class="lineno">  986</span> </div>
<div class="line"><span class="lineno">  987</span>  <span class="keywordtype">int</span> delta2 = dx * dx + dy * dy;</div>
<div class="line"><span class="lineno">  988</span>  <span class="keywordflow">if</span> (delta2 &lt; baseLength * baseLength * 3) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  989</span> </div>
<div class="line"><span class="lineno">  990</span>  <span class="keywordtype">int</span> adx = abs(dx), ady = abs(dy);</div>
<div class="line"><span class="lineno">  991</span>  <span class="keywordtype">int</span> sgx = dx &gt; 0 ? 1 : -1, sgy = dy &gt; 0 ? 1 : -1;</div>
<div class="line"><span class="lineno">  992</span>  <span class="keywordtype">int</span> thickness          = 1;</div>
<div class="line"><span class="lineno">  993</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> maxThickness = 64;</div>
<div class="line"><span class="lineno">  994</span>  <span class="keywordflow">for</span> (; thickness &lt; maxThickness; thickness++) {</div>
<div class="line"><span class="lineno">  995</span>    <span class="keywordtype">int</span> x, y;</div>
<div class="line"><span class="lineno">  996</span>    <span class="keywordflow">if</span> (adx &gt; ady) {</div>
<div class="line"><span class="lineno">  997</span>      x = x0 + thickness * sgx;</div>
<div class="line"><span class="lineno">  998</span>      y = y0 + sgy * (thickness * ady + adx / 2) / adx;</div>
<div class="line"><span class="lineno">  999</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1000</span>      y = y0 + thickness * sgy;</div>
<div class="line"><span class="lineno"> 1001</span>      x = x0 + sgx * (thickness * adx + ady / 2) / ady;</div>
<div class="line"><span class="lineno"> 1002</span>    }</div>
<div class="line"><span class="lineno"> 1003</span>    k = y * lx + x;</div>
<div class="line"><span class="lineno"> 1004</span>    <span class="keywordflow">if</span> (0 &lt;= x &amp;&amp; x &lt; lx &amp;&amp; 0 &lt;= y &amp;&amp; y &lt; ly &amp;&amp; regionBuffer[k] == regionId)</div>
<div class="line"><span class="lineno"> 1005</span>      dotBuffer[k] = 6;</div>
<div class="line"><span class="lineno"> 1006</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1007</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1008</span>  }</div>
<div class="line"><span class="lineno"> 1009</span>  <span class="keywordflow">return</span> thickness;</div>
<div class="line"><span class="lineno"> 1010</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="adac817fad601b5981867163088f4cec2" name="adac817fad601b5981867163088f4cec2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adac817fad601b5981867163088f4cec2">&#9670;&nbsp;</a></span>process()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::process </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_t_raster_p_t.html">TRaster32P</a> &amp;&#160;</td>
          <td class="paramname"><em>srcRas</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   70</span>                                                       {</div>
<div class="line"><span class="lineno">   71</span>  m_valid = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   72</span>  setSourceImage(srcRas);</div>
<div class="line"><span class="lineno">   73</span>  <span class="keywordflow">if</span> (!m_valid) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span>  separateRegions();</div>
<div class="line"><span class="lineno">   76</span> </div>
<div class="line"><span class="lineno">   77</span>  computeLinks();</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>  findRegionBorders();</div>
<div class="line"><span class="lineno">   80</span>  erodeRegions();</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>  findLargePaints();</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>  findBackgroundRegions();</div>
<div class="line"><span class="lineno">   85</span>  findMainInks();</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>  <span class="comment">// computeMainInkThickness();</span></div>
<div class="line"><span class="lineno">   88</span>  findThinInks();</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>  measureThickness();</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>  <span class="comment">// findPaints();</span></div>
<div class="line"><span class="lineno">   93</span>  findPaints2();</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>  findThinPaints();</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>  findSuspectInks();</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>  addBorderInks();</div>
<div class="line"><span class="lineno">  100</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad72599e811a8f2211fc47982ac7a86c0" name="ad72599e811a8f2211fc47982ac7a86c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad72599e811a8f2211fc47982ac7a86c0">&#9670;&nbsp;</a></span>removeUnusedStyles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::removeUnusedStyles </td>
          <td>(</td>
          <td class="paramtype">const QList&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>styleIds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1165</span>                                                                    {</div>
<div class="line"><span class="lineno"> 1166</span>  <span class="comment">// Remove unused styles from input palette</span></div>
<div class="line"><span class="lineno"> 1167</span>  <span class="keywordflow">if</span> (!m_palette) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1168</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = m_palette-&gt;<a class="code hl_function" href="class_t_palette.html#afd211cadf0f047450bc31897f858fa73">getPageCount</a>() - 1; p &gt;= 0; p--) {</div>
<div class="line"><span class="lineno"> 1169</span>    <a class="code hl_class" href="class_t_palette_1_1_page.html">TPalette::Page</a> *page = m_palette-&gt;<a class="code hl_function" href="class_t_palette.html#a25f83b7baf3eb774e50c726fa702056c">getPage</a>(p);</div>
<div class="line"><span class="lineno"> 1170</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s = page-&gt;<a class="code hl_function" href="class_t_palette_1_1_page.html#ae6d6b899ee10f5b3900081acd882f8ee">getStyleCount</a>() - 1; s &gt;= 0; s--) {</div>
<div class="line"><span class="lineno"> 1171</span>      <span class="keywordtype">int</span> styleId = page-&gt;<a class="code hl_function" href="class_t_palette_1_1_page.html#a3d6eed995ee8b1c22d50a73911a45786">getStyleId</a>(s);</div>
<div class="line"><span class="lineno"> 1172</span>      <span class="keywordflow">if</span> (styleId == -1) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1173</span>      <span class="comment">// check if the style is used or not</span></div>
<div class="line"><span class="lineno"> 1174</span>      <span class="keywordflow">if</span> (!styleIds.contains(styleId)) page-&gt;<a class="code hl_function" href="class_t_palette_1_1_page.html#a7619abc839bf063d3065596235171982">removeStyle</a>(s);</div>
<div class="line"><span class="lineno"> 1175</span>    }</div>
<div class="line"><span class="lineno"> 1176</span>    <span class="comment">// erase empty page</span></div>
<div class="line"><span class="lineno"> 1177</span>    <span class="keywordflow">if</span> (page-&gt;<a class="code hl_function" href="class_t_palette_1_1_page.html#ae6d6b899ee10f5b3900081acd882f8ee">getStyleCount</a>() == 0) m_palette-&gt;<a class="code hl_function" href="class_t_palette.html#a6a18830b8f209aac7c13bccfe88b19e4">erasePage</a>(p);</div>
<div class="line"><span class="lineno"> 1178</span>  }</div>
<div class="line"><span class="lineno"> 1179</span>}</div>
<div class="ttc" id="aclass_t_palette_1_1_page_html"><div class="ttname"><a href="class_t_palette_1_1_page.html">TPalette::Page</a></div><div class="ttdoc">A palette page is a restricted view of a palette instance.</div><div class="ttdef"><b>Definition:</b> tpalette.h:94</div></div>
<div class="ttc" id="aclass_t_palette_1_1_page_html_a3d6eed995ee8b1c22d50a73911a45786"><div class="ttname"><a href="class_t_palette_1_1_page.html#a3d6eed995ee8b1c22d50a73911a45786">TPalette::Page::getStyleId</a></div><div class="ttdeci">int getStyleId(int indexInPage) const</div><div class="ttdef"><b>Definition:</b> tpalette.cpp:132</div></div>
<div class="ttc" id="aclass_t_palette_1_1_page_html_a7619abc839bf063d3065596235171982"><div class="ttname"><a href="class_t_palette_1_1_page.html#a7619abc839bf063d3065596235171982">TPalette::Page::removeStyle</a></div><div class="ttdeci">void removeStyle(int indexInPage)</div><div class="ttdef"><b>Definition:</b> tpalette.cpp:203</div></div>
<div class="ttc" id="aclass_t_palette_1_1_page_html_ae6d6b899ee10f5b3900081acd882f8ee"><div class="ttname"><a href="class_t_palette_1_1_page.html#ae6d6b899ee10f5b3900081acd882f8ee">TPalette::Page::getStyleCount</a></div><div class="ttdeci">int getStyleCount() const</div><div class="ttdoc">Returns the number of the styles contained in the page.</div><div class="ttdef"><b>Definition:</b> tpalette.h:121</div></div>
<div class="ttc" id="aclass_t_palette_html_a25f83b7baf3eb774e50c726fa702056c"><div class="ttname"><a href="class_t_palette.html#a25f83b7baf3eb774e50c726fa702056c">TPalette::getPage</a></div><div class="ttdeci">Page * getPage(int pageIndex)</div><div class="ttdef"><b>Definition:</b> tpalette.cpp:372</div></div>
<div class="ttc" id="aclass_t_palette_html_a6a18830b8f209aac7c13bccfe88b19e4"><div class="ttname"><a href="class_t_palette.html#a6a18830b8f209aac7c13bccfe88b19e4">TPalette::erasePage</a></div><div class="ttdeci">void erasePage(int index)</div><div class="ttdoc">Deletes the index-th page.</div><div class="ttdef"><b>Definition:</b> tpalette.cpp:406</div></div>
<div class="ttc" id="aclass_t_palette_html_afd211cadf0f047450bc31897f858fa73"><div class="ttname"><a href="class_t_palette.html#afd211cadf0f047450bc31897f858fa73">TPalette::getPageCount</a></div><div class="ttdeci">int getPageCount() const</div><div class="ttdoc">specified style id.</div><div class="ttdef"><b>Definition:</b> tpalette.cpp:368</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9c95132fcdc0f8e7243b526c34929cbb" name="a9c95132fcdc0f8e7243b526c34929cbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c95132fcdc0f8e7243b526c34929cbb">&#9670;&nbsp;</a></span>separateRegions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::separateRegions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  168</span>                                       {</div>
<div class="line"><span class="lineno">  169</span>  <span class="keywordflow">if</span> (!m_regionRas) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  170</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> lx   = m_regionRas-&gt;getLx();</div>
<div class="line"><span class="lineno">  171</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ly   = m_regionRas-&gt;getLy();</div>
<div class="line"><span class="lineno">  172</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> wrap = lx;</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>  <span class="comment">// we assume that m_regions contains almost no information (except:</span></div>
<div class="line"><span class="lineno">  175</span>  <span class="comment">// m_regions[i].colorIndex == i)</span></div>
<div class="line"><span class="lineno">  176</span>  m_regions.clear();</div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>  <a class="code hl_class" href="class_work_raster.html">WorkRaster&lt;int&gt;</a> wb(lx, ly);  <span class="comment">// work buffer</span></div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>  QVector&lt;int&gt; regionMap;  <span class="comment">// wb pixels =&gt; region indices</span></div>
<div class="line"><span class="lineno">  181</span>  QList&lt;int&gt; freeRegions;</div>
<div class="line"><span class="lineno">  182</span> </div>
<div class="line"><span class="lineno">  183</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  184</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *waScanLine = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  185</span>    <span class="keywordtype">int</span> *wbScanLine            = wb.pixels(y);</div>
<div class="line"><span class="lineno">  186</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  187</span>      <span class="keywordtype">int</span> c       = waScanLine[x];</div>
<div class="line"><span class="lineno">  188</span>      <span class="keywordtype">int</span> cUp     = y &gt; 0 ? waScanLine[x - wrap] : -1;</div>
<div class="line"><span class="lineno">  189</span>      <span class="keywordtype">int</span> cLeft   = x &gt; 0 ? waScanLine[x - 1] : -1;</div>
<div class="line"><span class="lineno">  190</span>      <span class="keywordtype">int</span> cUpLeft = x &gt; 0 &amp;&amp; y &gt; 0 ? waScanLine[x - wrap - 1] : -1;</div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>      <span class="keywordflow">if</span> (c != cUp &amp;&amp; c != cLeft &amp;&amp; c != cUpLeft) {</div>
<div class="line"><span class="lineno">  193</span>        <span class="comment">// no connection: create a new region</span></div>
<div class="line"><span class="lineno">  194</span>        Q_ASSERT(0 &lt;= c &amp;&amp; c &lt; m_colors.count());</div>
<div class="line"><span class="lineno">  195</span>        <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> region;</div>
<div class="line"><span class="lineno">  196</span>        region.colorIndex = c;</div>
<div class="line"><span class="lineno">  197</span>        <span class="keywordtype">int</span> regionIndex;</div>
<div class="line"><span class="lineno">  198</span>        <span class="keywordflow">if</span> (!freeRegions.empty()) {</div>
<div class="line"><span class="lineno">  199</span>          <span class="comment">// use a previously discarded region</span></div>
<div class="line"><span class="lineno">  200</span>          regionIndex = freeRegions.back();</div>
<div class="line"><span class="lineno">  201</span>          freeRegions.pop_back();</div>
<div class="line"><span class="lineno">  202</span>          m_regions[regionIndex] = region;</div>
<div class="line"><span class="lineno">  203</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  204</span>          <span class="comment">// create a new region</span></div>
<div class="line"><span class="lineno">  205</span>          regionIndex = m_regions.count();</div>
<div class="line"><span class="lineno">  206</span>          m_regions.append(region);</div>
<div class="line"><span class="lineno">  207</span>        }</div>
<div class="line"><span class="lineno">  208</span>        wbScanLine[x] = regionMap.count();</div>
<div class="line"><span class="lineno">  209</span>        regionMap.append(regionIndex);</div>
<div class="line"><span class="lineno">  210</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  211</span>        <span class="comment">// at least one connection</span></div>
<div class="line"><span class="lineno">  212</span>        <span class="keywordflow">if</span> (c == cUpLeft)</div>
<div class="line"><span class="lineno">  213</span>          wbScanLine[x] = wbScanLine[x - wrap - 1];</div>
<div class="line"><span class="lineno">  214</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == cUp)</div>
<div class="line"><span class="lineno">  215</span>          wbScanLine[x] = wbScanLine[x - wrap];</div>
<div class="line"><span class="lineno">  216</span>        <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  217</span>          Q_ASSERT(c == cLeft);</div>
<div class="line"><span class="lineno">  218</span>          wbScanLine[x] = wbScanLine[x - 1];</div>
<div class="line"><span class="lineno">  219</span>        }</div>
<div class="line"><span class="lineno">  220</span>      }</div>
<div class="line"><span class="lineno">  221</span> </div>
<div class="line"><span class="lineno">  222</span>      <span class="comment">// merge if needed</span></div>
<div class="line"><span class="lineno">  223</span>      <span class="keywordflow">if</span> (cUp == cLeft &amp;&amp; cUp &gt;= 0 &amp;&amp;</div>
<div class="line"><span class="lineno">  224</span>          regionMap[wbScanLine[x - 1]] != regionMap[wbScanLine[x - wrap]]) {</div>
<div class="line"><span class="lineno">  225</span>        <span class="comment">// merge</span></div>
<div class="line"><span class="lineno">  226</span>        <span class="keywordtype">int</span> pixelToDiscard = wbScanLine[x - 1];</div>
<div class="line"><span class="lineno">  227</span>        <span class="keywordtype">int</span> pixelToKeep    = wbScanLine[x - wrap];</div>
<div class="line"><span class="lineno">  228</span>        Q_ASSERT(pixelToDiscard != pixelToKeep);</div>
<div class="line"><span class="lineno">  229</span>        <span class="keywordtype">int</span> regionToDiscard = regionMap[pixelToDiscard];</div>
<div class="line"><span class="lineno">  230</span>        <span class="keywordtype">int</span> regionToKeep    = regionMap[pixelToKeep];</div>
<div class="line"><span class="lineno">  231</span>        Q_ASSERT(regionToDiscard != regionToKeep);</div>
<div class="line"><span class="lineno">  232</span>        Q_ASSERT(m_regions[regionToDiscard].type != RegionInfo::Unused);</div>
<div class="line"><span class="lineno">  233</span>        Q_ASSERT(m_regions[regionToKeep].type != RegionInfo::Unused);</div>
<div class="line"><span class="lineno">  234</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; regionMap.count(); i++)</div>
<div class="line"><span class="lineno">  235</span>          <span class="keywordflow">if</span> (regionMap[i] == regionToDiscard) regionMap[i] = regionToKeep;</div>
<div class="line"><span class="lineno">  236</span>        <span class="comment">// wbScanLine[x] = pixelToKeep;</span></div>
<div class="line"><span class="lineno">  237</span>        m_regions[regionToDiscard].type = RegionInfo::Unused;</div>
<div class="line"><span class="lineno">  238</span>        freeRegions.append(regionToDiscard);</div>
<div class="line"><span class="lineno">  239</span>      }</div>
<div class="line"><span class="lineno">  240</span>    }</div>
<div class="line"><span class="lineno">  241</span>  }</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>  <span class="comment">// fill gaps</span></div>
<div class="line"><span class="lineno">  244</span>  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">  245</span>    <span class="comment">// just remove topmost Unused regions</span></div>
<div class="line"><span class="lineno">  246</span>    <span class="keywordflow">if</span> (!m_regions.empty() &amp;&amp; m_regions.back().type == RegionInfo::Unused) {</div>
<div class="line"><span class="lineno">  247</span>      m_regions.pop_back();</div>
<div class="line"><span class="lineno">  248</span>      <span class="keywordtype">int</span> k = m_regions.count();</div>
<div class="line"><span class="lineno">  249</span>      freeRegions.removeAll(k);</div>
<div class="line"><span class="lineno">  250</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!freeRegions.empty()) {</div>
<div class="line"><span class="lineno">  251</span>      <span class="comment">// last region is used, but there is at least a free region with lower</span></div>
<div class="line"><span class="lineno">  252</span>      <span class="comment">// index: move it there</span></div>
<div class="line"><span class="lineno">  253</span>      <span class="keywordtype">int</span> regionToDiscard = m_regions.count() - 1;</div>
<div class="line"><span class="lineno">  254</span>      <span class="keywordtype">int</span> regionToKeep    = freeRegions.back();</div>
<div class="line"><span class="lineno">  255</span>      freeRegions.pop_back();</div>
<div class="line"><span class="lineno">  256</span>      Q_ASSERT(m_regions[regionToKeep].type == RegionInfo::Unused);</div>
<div class="line"><span class="lineno">  257</span>      Q_ASSERT(m_regions[regionToDiscard].type != RegionInfo::Unused);</div>
<div class="line"><span class="lineno">  258</span>      Q_ASSERT(regionToKeep &lt; regionToDiscard);</div>
<div class="line"><span class="lineno">  259</span>      m_regions[regionToKeep] = m_regions[regionToDiscard];</div>
<div class="line"><span class="lineno">  260</span>      <span class="comment">// pop the region to discard</span></div>
<div class="line"><span class="lineno">  261</span>      m_regions.pop_back();</div>
<div class="line"><span class="lineno">  262</span>      <span class="comment">// update map</span></div>
<div class="line"><span class="lineno">  263</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; regionMap.count(); i++)</div>
<div class="line"><span class="lineno">  264</span>        <span class="keywordflow">if</span> (regionMap[i] == regionToDiscard) regionMap[i] = regionToKeep;</div>
<div class="line"><span class="lineno">  265</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  266</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  267</span>  }</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>  Q_ASSERT(freeRegions.empty());</div>
<div class="line"><span class="lineno">  270</span> </div>
<div class="line"><span class="lineno">  271</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_regions.count(); i++) m_regions[i].pixelCount = 0;</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span>  <span class="comment">// wb =&gt; m_regionRas</span></div>
<div class="line"><span class="lineno">  274</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *regionScanLine = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordtype">int</span> *wbScanLine                = wb.pixels(y);</div>
<div class="line"><span class="lineno">  277</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  278</span>      <span class="keywordtype">int</span> regionIndex   = regionMap[wbScanLine[x]];</div>
<div class="line"><span class="lineno">  279</span>      regionScanLine[x] = (<span class="keywordtype">unsigned</span> short)regionIndex;</div>
<div class="line"><span class="lineno">  280</span>      m_regions[regionIndex].pixelCount++;</div>
<div class="line"><span class="lineno">  281</span>    }</div>
<div class="line"><span class="lineno">  282</span>  }</div>
<div class="line"><span class="lineno">  283</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8363dc9951f08203745420ef89b65848" name="a8363dc9951f08203745420ef89b65848"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8363dc9951f08203745420ef89b65848">&#9670;&nbsp;</a></span>setPalette()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::setPalette </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_palette.html">TPalette</a> *&#160;</td>
          <td class="paramname"><em>palette</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   62</span>                                                   {</div>
<div class="line"><span class="lineno">   63</span>  <span class="keywordflow">if</span> (m_palette != palette) {</div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordflow">if</span> (palette) palette-&gt;addRef();</div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordflow">if</span> (m_palette) m_palette-&gt;release();</div>
<div class="line"><span class="lineno">   66</span>    m_palette = palette;</div>
<div class="line"><span class="lineno">   67</span>  }</div>
<div class="line"><span class="lineno">   68</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a132f6dbc74f18919c82e1d09eeda44a0" name="a132f6dbc74f18919c82e1d09eeda44a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a132f6dbc74f18919c82e1d09eeda44a0">&#9670;&nbsp;</a></span>setSourceImage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Naa2TlvConverter::setSourceImage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_t_raster_p_t.html">TRaster32P</a> &amp;&#160;</td>
          <td class="paramname"><em>srcRas</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  111</span>                                                              {</div>
<div class="line"><span class="lineno">  112</span>  <span class="keywordtype">int</span> lx = srcRas-&gt;getSize().lx;</div>
<div class="line"><span class="lineno">  113</span>  <span class="keywordtype">int</span> ly = srcRas-&gt;getSize().ly;</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>  m_colors.clear();</div>
<div class="line"><span class="lineno">  116</span>  m_regions.clear();</div>
<div class="line"><span class="lineno">  117</span>  <span class="keyword">delete</span> m_regionRas;</div>
<div class="line"><span class="lineno">  118</span>  m_regionRas = <span class="keyword">new</span> <a class="code hl_class" href="class_work_raster.html">WorkRaster&lt;unsigned short&gt;</a>(lx, ly);</div>
<div class="line"><span class="lineno">  119</span>  <span class="keyword">delete</span> m_borderRas;</div>
<div class="line"><span class="lineno">  120</span>  m_borderRas = 0;</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>  <span class="keyword">delete</span> m_dotRas;</div>
<div class="line"><span class="lineno">  123</span>  m_dotRas = 0;</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>  <span class="keyword">delete</span> m_syntheticInkRas;</div>
<div class="line"><span class="lineno">  126</span>  m_syntheticInkRas = 0;</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>  QMap&lt;TPixel32, int&gt; colorTable;</div>
<div class="line"><span class="lineno">  129</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; ly; y++) {</div>
<div class="line"><span class="lineno">  130</span>    TPixel32 *srcScanLine          = srcRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *regionScanLine = m_regionRas-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  132</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; lx; x++) {</div>
<div class="line"><span class="lineno">  133</span>      TPixel32 srcPix = overPixOnWhite(srcScanLine[x]);</div>
<div class="line"><span class="lineno">  134</span>      QMap&lt;TPixel32, int&gt;::ConstIterator it = colorTable.find(srcPix);</div>
<div class="line"><span class="lineno">  135</span>      <span class="keywordflow">if</span> (it == colorTable.end()) {</div>
<div class="line"><span class="lineno">  136</span>        <span class="comment">// found new color (and therefore new region)</span></div>
<div class="line"><span class="lineno">  137</span>        <a class="code hl_struct" href="struct_region_info.html">RegionInfo</a> r;</div>
<div class="line"><span class="lineno">  138</span>        <span class="comment">// add new color</span></div>
<div class="line"><span class="lineno">  139</span>        r.colorIndex = m_colors.count();</div>
<div class="line"><span class="lineno">  140</span>        m_colors.append(srcPix);</div>
<div class="line"><span class="lineno">  141</span>        r.pixelCount = 1;</div>
<div class="line"><span class="lineno">  142</span>        <span class="comment">// add new region</span></div>
<div class="line"><span class="lineno">  143</span>        <span class="keywordtype">int</span> regionIndex = m_regions.count();</div>
<div class="line"><span class="lineno">  144</span>        m_regions.append(r);</div>
<div class="line"><span class="lineno">  145</span>        <span class="comment">// update raster and colorTable</span></div>
<div class="line"><span class="lineno">  146</span>        regionScanLine[x] = regionIndex;</div>
<div class="line"><span class="lineno">  147</span>        colorTable.insert(srcPix, regionIndex);</div>
<div class="line"><span class="lineno">  148</span>        <span class="keywordflow">if</span> (m_colors.count() &gt; MaxColorCount) {</div>
<div class="line"><span class="lineno">  149</span>          <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  150</span>        }</div>
<div class="line"><span class="lineno">  151</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  152</span>        <span class="comment">// already defined color</span></div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordtype">int</span> regionIndex   = it.value();</div>
<div class="line"><span class="lineno">  154</span>        regionScanLine[x] = regionIndex;</div>
<div class="line"><span class="lineno">  155</span>        m_regions[regionIndex].pixelCount++;</div>
<div class="line"><span class="lineno">  156</span>      }</div>
<div class="line"><span class="lineno">  157</span>    }</div>
<div class="line"><span class="lineno">  158</span>  }</div>
<div class="line"><span class="lineno">  159</span>  m_valid = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  160</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab3d734da9514382920e8db48e66179bc" name="ab3d734da9514382920e8db48e66179bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3d734da9514382920e8db48e66179bc">&#9670;&nbsp;</a></span>vectorize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_vector_image_p.html">TVectorImageP</a> Naa2TlvConverter::vectorize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_t_toonz_image_p.html">TToonzImageP</a> &amp;&#160;</td>
          <td class="paramname"><em>ti</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1133</span>                                                                {</div>
<div class="line"><span class="lineno"> 1134</span>  <a class="code hl_class" href="class_centerline_configuration.html">CenterlineConfiguration</a> conf;</div>
<div class="line"><span class="lineno"> 1135</span>  <span class="keywordflow">if</span> (!ti) <span class="keywordflow">return</span> <a class="code hl_class" href="class_t_vector_image_p.html">TVectorImageP</a>();</div>
<div class="line"><span class="lineno"> 1136</span>  <a class="code hl_class" href="class_t_palette.html">TPalette</a> *palette = ti-&gt;getPalette();</div>
<div class="line"><span class="lineno"> 1137</span> </div>
<div class="line"><span class="lineno"> 1138</span>  <a class="code hl_class" href="class_vectorizer_core.html">VectorizerCore</a> vc;</div>
<div class="line"><span class="lineno"> 1139</span> </div>
<div class="line"><span class="lineno"> 1140</span>  <a class="code hl_class" href="class_t_affine.html">TAffine</a> dpiAff;</div>
<div class="line"><span class="lineno"> 1141</span>  <span class="keywordtype">double</span> factor = <a class="code hl_variable" href="namespace_stage.html#ad3e22e31e2bb6fc1d95a572facce2d5b">Stage::inch</a>;</div>
<div class="line"><span class="lineno"> 1142</span>  <span class="keywordtype">double</span> dpix = factor / 72, dpiy = factor / 72;</div>
<div class="line"><span class="lineno"> 1143</span> </div>
<div class="line"><span class="lineno"> 1144</span>  ti-&gt;getDpi(dpix, dpiy);</div>
<div class="line"><span class="lineno"> 1145</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> center = ti-&gt;getRaster()-&gt;getCenterD();</div>
<div class="line"><span class="lineno"> 1146</span> </div>
<div class="line"><span class="lineno"> 1147</span>  <span class="keywordflow">if</span> (dpix != 0.0 &amp;&amp; dpiy != 0.0) dpiAff = <a class="code hl_class" href="class_t_scale.html">TScale</a>(factor / dpix, factor / dpiy);</div>
<div class="line"><span class="lineno"> 1148</span>  factor                                 = norm(dpiAff * <a class="code hl_class" href="class_t_point_t.html">TPointD</a>(1, 0));</div>
<div class="line"><span class="lineno"> 1149</span> </div>
<div class="line"><span class="lineno"> 1150</span>  conf.<a class="code hl_variable" href="class_vectorizer_configuration.html#a35f1f35835fee0dfe6aaf83fa9ea1489">m_affine</a>         = dpiAff * <a class="code hl_class" href="class_t_translation.html">TTranslation</a>(-center);</div>
<div class="line"><span class="lineno"> 1151</span>  conf.<a class="code hl_variable" href="class_vectorizer_configuration.html#a3af044b6f16e74b4b03ce0dccf76b9bc">m_thickScale</a>     = factor;</div>
<div class="line"><span class="lineno"> 1152</span>  conf.<a class="code hl_variable" href="class_vectorizer_configuration.html#a7986237762ccb55c79ce6fd35e879152">m_leaveUnpainted</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1153</span>  conf.<a class="code hl_variable" href="class_centerline_configuration.html#a4c4a77c10cb68f8211811946b6e534cd">m_makeFrame</a>      = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1154</span>  conf.<a class="code hl_variable" href="class_centerline_configuration.html#aa2a67569aa3e9fb55cf2fb1f3fea7129">m_penalty</a>        = 0.0;</div>
<div class="line"><span class="lineno"> 1155</span>  conf.<a class="code hl_variable" href="class_centerline_configuration.html#a4adf92caa1da18bd842398a86fbfed35">m_despeckling</a>    = 0;</div>
<div class="line"><span class="lineno"> 1156</span> </div>
<div class="line"><span class="lineno"> 1157</span>  <a class="code hl_class" href="class_t_smart_pointer_t.html">TImageP</a> img(ti.getPointer());</div>
<div class="line"><span class="lineno"> 1158</span>  <a class="code hl_class" href="class_t_vector_image_p.html">TVectorImageP</a> vi = vc.<a class="code hl_function" href="class_vectorizer_core.html#ac12b78770400b604498680eff445f244">vectorize</a>(img, conf, palette);</div>
<div class="line"><span class="lineno"> 1159</span>  vi-&gt;setPalette(palette);</div>
<div class="line"><span class="lineno"> 1160</span>  <span class="keywordflow">return</span> vi;</div>
<div class="line"><span class="lineno"> 1161</span>}</div>
<div class="ttc" id="aclass_centerline_configuration_html"><div class="ttname"><a href="class_centerline_configuration.html">CenterlineConfiguration</a></div><div class="ttdoc">CenterlineConfiguration is the VectorizerConfiguration specialization for the centerline vectorizatio...</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:87</div></div>
<div class="ttc" id="aclass_centerline_configuration_html_a4adf92caa1da18bd842398a86fbfed35"><div class="ttname"><a href="class_centerline_configuration.html#a4adf92caa1da18bd842398a86fbfed35">CenterlineConfiguration::m_despeckling</a></div><div class="ttdeci">int m_despeckling</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:93</div></div>
<div class="ttc" id="aclass_centerline_configuration_html_a4c4a77c10cb68f8211811946b6e534cd"><div class="ttname"><a href="class_centerline_configuration.html#a4c4a77c10cb68f8211811946b6e534cd">CenterlineConfiguration::m_makeFrame</a></div><div class="ttdeci">bool m_makeFrame</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:119</div></div>
<div class="ttc" id="aclass_centerline_configuration_html_aa2a67569aa3e9fb55cf2fb1f3fea7129"><div class="ttname"><a href="class_centerline_configuration.html#aa2a67569aa3e9fb55cf2fb1f3fea7129">CenterlineConfiguration::m_penalty</a></div><div class="ttdeci">double m_penalty</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:110</div></div>
<div class="ttc" id="aclass_t_affine_html"><div class="ttname"><a href="class_t_affine.html">TAffine</a></div><div class="ttdoc">This is the base class for the affine transformations.</div><div class="ttdef"><b>Definition:</b> tgeometry.h:864</div></div>
<div class="ttc" id="aclass_t_point_t_html"><div class="ttname"><a href="class_t_point_t.html">TPointT&lt; double &gt;</a></div></div>
<div class="ttc" id="aclass_t_scale_html"><div class="ttname"><a href="class_t_scale.html">TScale</a></div><div class="ttdef"><b>Definition:</b> tgeometry.h:1133</div></div>
<div class="ttc" id="aclass_t_smart_pointer_t_html"><div class="ttname"><a href="class_t_smart_pointer_t.html">TSmartPointerT&lt; TImage &gt;</a></div></div>
<div class="ttc" id="aclass_t_translation_html"><div class="ttname"><a href="class_t_translation.html">TTranslation</a></div><div class="ttdef"><b>Definition:</b> tgeometry.h:1074</div></div>
<div class="ttc" id="aclass_t_vector_image_p_html"><div class="ttname"><a href="class_t_vector_image_p.html">TVectorImageP</a></div><div class="ttdef"><b>Definition:</b> tvectorimage.h:417</div></div>
<div class="ttc" id="aclass_vectorizer_configuration_html_a35f1f35835fee0dfe6aaf83fa9ea1489"><div class="ttname"><a href="class_vectorizer_configuration.html#a35f1f35835fee0dfe6aaf83fa9ea1489">VectorizerConfiguration::m_affine</a></div><div class="ttdeci">TAffine m_affine</div><div class="ttdoc">Affine transform applied to the vectorization results.</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:61</div></div>
<div class="ttc" id="aclass_vectorizer_configuration_html_a3af044b6f16e74b4b03ce0dccf76b9bc"><div class="ttname"><a href="class_vectorizer_configuration.html#a3af044b6f16e74b4b03ce0dccf76b9bc">VectorizerConfiguration::m_thickScale</a></div><div class="ttdeci">double m_thickScale</div><div class="ttdoc">Impose a thickness reduction by this ratio.</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:62</div></div>
<div class="ttc" id="aclass_vectorizer_configuration_html_a7986237762ccb55c79ce6fd35e879152"><div class="ttname"><a href="class_vectorizer_configuration.html#a7986237762ccb55c79ce6fd35e879152">VectorizerConfiguration::m_leaveUnpainted</a></div><div class="ttdeci">bool m_leaveUnpainted</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:58</div></div>
<div class="ttc" id="aclass_vectorizer_core_html"><div class="ttname"><a href="class_vectorizer_core.html">VectorizerCore</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizer.h:37</div></div>
<div class="ttc" id="aclass_vectorizer_core_html_ac12b78770400b604498680eff445f244"><div class="ttname"><a href="class_vectorizer_core.html#ac12b78770400b604498680eff445f244">VectorizerCore::vectorize</a></div><div class="ttdeci">TVectorImageP vectorize(const TImageP &amp;image, const VectorizerConfiguration &amp;c, TPalette *palette)</div><div class="ttdef"><b>Definition:</b> toutlinevectorizer.cpp:1612</div></div>
<div class="ttc" id="anamespace_stage_html_ad3e22e31e2bb6fc1d95a572facce2d5b"><div class="ttname"><a href="namespace_stage.html#ad3e22e31e2bb6fc1d95a572facce2d5b">Stage::inch</a></div><div class="ttdeci">DVVAR const double inch</div><div class="ttdef"><b>Definition:</b> stageplayer.h:37</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a0b0daae74da1bd01b9f08c4f3e863793" name="a0b0daae74da1bd01b9f08c4f3e863793"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b0daae74da1bd01b9f08c4f3e863793">&#9670;&nbsp;</a></span>m_borderRas</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt;unsigned char&gt;* Naa2TlvConverter::m_borderRas</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae96dfe88c5c33f6e70270049e1a7de6e" name="ae96dfe88c5c33f6e70270049e1a7de6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae96dfe88c5c33f6e70270049e1a7de6e">&#9670;&nbsp;</a></span>m_colors</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">QVector&lt;TPixel32&gt; Naa2TlvConverter::m_colors</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a40cb144beaf2f9ae3762a9be1360783d" name="a40cb144beaf2f9ae3762a9be1360783d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40cb144beaf2f9ae3762a9be1360783d">&#9670;&nbsp;</a></span>m_dotRas</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt;unsigned char&gt;* Naa2TlvConverter::m_dotRas</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5ddcaf9de0e08d6aa0e2d48fdfce1ad5" name="a5ddcaf9de0e08d6aa0e2d48fdfce1ad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ddcaf9de0e08d6aa0e2d48fdfce1ad5">&#9670;&nbsp;</a></span>m_inkThickness</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Naa2TlvConverter::m_inkThickness</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5be1af2e152f70560a76ada841b7d685" name="a5be1af2e152f70560a76ada841b7d685"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5be1af2e152f70560a76ada841b7d685">&#9670;&nbsp;</a></span>m_palette</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_palette.html">TPalette</a>* Naa2TlvConverter::m_palette</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a818cf5ab9bec6c237a80d010ba850c82" name="a818cf5ab9bec6c237a80d010ba850c82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a818cf5ab9bec6c237a80d010ba850c82">&#9670;&nbsp;</a></span>m_regionRas</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt;unsigned short&gt;* Naa2TlvConverter::m_regionRas</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1401dcef1312dcd358d1feb1dc42fcaa" name="a1401dcef1312dcd358d1feb1dc42fcaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1401dcef1312dcd358d1feb1dc42fcaa">&#9670;&nbsp;</a></span>m_regions</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">QVector&lt;<a class="el" href="struct_region_info.html">RegionInfo</a>&gt; Naa2TlvConverter::m_regions</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aca510d1f840fde7592ce170aea57c90f" name="aca510d1f840fde7592ce170aea57c90f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca510d1f840fde7592ce170aea57c90f">&#9670;&nbsp;</a></span>m_syntheticInkRas</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_work_raster.html">WorkRaster</a>&lt;unsigned char&gt;* Naa2TlvConverter::m_syntheticInkRas</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8ba425d3324998fa444ba91e5fe68272" name="a8ba425d3324998fa444ba91e5fe68272"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ba425d3324998fa444ba91e5fe68272">&#9670;&nbsp;</a></span>m_valid</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Naa2TlvConverter::m_valid</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad82deae9481139d35a00c97c186396fd" name="ad82deae9481139d35a00c97c186396fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad82deae9481139d35a00c97c186396fd">&#9670;&nbsp;</a></span>MaxColorCount</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const int Naa2TlvConverter::MaxColorCount</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>E:/opentoonz/toonz/sources/include/toonz/<a class="el" href="">Naa2TlvConverter.h</a></li>
<li>E:/opentoonz/toonz/sources/toonzlib/<a class="el" href="">Naa2TlvConverter.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
