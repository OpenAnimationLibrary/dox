<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: RenderCommand Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="class_render_command-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">RenderCommand Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae9478a6c901774d759c2909c459ae173"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#ae9478a6c901774d759c2909c459ae173">init</a> (bool isPreview)</td></tr>
<tr class="separator:ae9478a6c901774d759c2909c459ae173"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a719be4812e9e27958f2dce68d4a8feff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#a719be4812e9e27958f2dce68d4a8feff">rasterRender</a> (bool isPreview)</td></tr>
<tr class="separator:a719be4812e9e27958f2dce68d4a8feff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05c1d0a15649217b5218597719cff23e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#a05c1d0a15649217b5218597719cff23e">multimediaRender</a> ()</td></tr>
<tr class="memdesc:a05c1d0a15649217b5218597719cff23e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Specialized render invocation for multimedia rendering.  <a href="class_render_command.html#a05c1d0a15649217b5218597719cff23e">More...</a><br /></td></tr>
<tr class="separator:a05c1d0a15649217b5218597719cff23e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa18238bc4ddc0ab09eb17585a52ce148"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#aa18238bc4ddc0ab09eb17585a52ce148">onRender</a> ()</td></tr>
<tr class="separator:aa18238bc4ddc0ab09eb17585a52ce148"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0045283ec09c6e344682fe5f4e947e46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#a0045283ec09c6e344682fe5f4e947e46">onFastRender</a> ()</td></tr>
<tr class="separator:a0045283ec09c6e344682fe5f4e947e46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ccd5e8b39ac86d467b723ef2c5698fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#a1ccd5e8b39ac86d467b723ef2c5698fc">onPreview</a> ()</td></tr>
<tr class="separator:a1ccd5e8b39ac86d467b723ef2c5698fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad7d8dcaac8c807cf8505a371b27cbee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#aad7d8dcaac8c807cf8505a371b27cbee">doRender</a> (bool isPreview)</td></tr>
<tr class="separator:aad7d8dcaac8c807cf8505a371b27cbee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a42ced7d7bb157404ca185c5ce412b3f4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_render_command.html#a42ced7d7bb157404ca185c5ce412b3f4">resetBgColor</a> ()</td></tr>
<tr class="separator:a42ced7d7bb157404ca185c5ce412b3f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"></div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="af12021a0064de4456d18797d24618dc7" name="af12021a0064de4456d18797d24618dc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af12021a0064de4456d18797d24618dc7">&#9670;&nbsp;</a></span>RenderCommand()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">RenderCommand::RenderCommand </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  206</span>      : m_r0(0)</div>
<div class="line"><span class="lineno">  207</span>      , m_r1(-1)</div>
<div class="line"><span class="lineno">  208</span>      , m_step(1)</div>
<div class="line"><span class="lineno">  209</span>      , m_numFrames(0)</div>
<div class="line"><span class="lineno">  210</span>      , m_r(0)</div>
<div class="line"><span class="lineno">  211</span>      , m_stepd(1)</div>
<div class="line"><span class="lineno">  212</span>      , m_oldCameraRes(0, 0)</div>
<div class="line"><span class="lineno">  213</span>      , m_timeStretchFactor(1)</div>
<div class="line"><span class="lineno">  214</span>      , m_multimediaRender(0) {</div>
<div class="line"><span class="lineno">  215</span>    setCommandHandler(<span class="stringliteral">&quot;MI_Render&quot;</span>, <span class="keyword">this</span>, &amp;RenderCommand::onRender);</div>
<div class="line"><span class="lineno">  216</span>    setCommandHandler(<span class="stringliteral">&quot;MI_FastRender&quot;</span>, <span class="keyword">this</span>, &amp;RenderCommand::onFastRender);</div>
<div class="line"><span class="lineno">  217</span>    setCommandHandler(<span class="stringliteral">&quot;MI_Preview&quot;</span>, <span class="keyword">this</span>, &amp;RenderCommand::onPreview);</div>
<div class="line"><span class="lineno">  218</span>  }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aad7d8dcaac8c807cf8505a371b27cbee" name="aad7d8dcaac8c807cf8505a371b27cbee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad7d8dcaac8c807cf8505a371b27cbee">&#9670;&nbsp;</a></span>doRender()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RenderCommand::doRender </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isPreview</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  822</span>                                           {</div>
<div class="line"><span class="lineno">  823</span>  <span class="keywordtype">bool</span> isWritable = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  824</span>  <span class="keywordtype">bool</span> isMultiFrame;</div>
<div class="line"><span class="lineno">  825</span>  <span class="comment">/*--</span></div>
<div class="line"><span class="lineno">  826</span><span class="comment">   * 初期化処理。フレーム範囲の計算や、Renderの場合はOutputSettingsから保存先パスも作る</span></div>
<div class="line"><span class="lineno">  827</span><span class="comment">   * --*/</span></div>
<div class="line"><span class="lineno">  828</span>  <span class="keywordflow">if</span> (!init(isPreview)) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  829</span>  <span class="keywordflow">if</span> (m_fp.<a class="code hl_function" href="class_t_file_path.html#a698bbf714436eb6923359044900cde2b">getDots</a>() == <span class="stringliteral">&quot;.&quot;</span>) {</div>
<div class="line"><span class="lineno">  830</span>    isMultiFrame = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  831</span>    <a class="code hl_class" href="class_t_file_status.html">TFileStatus</a> fs(m_fp);</div>
<div class="line"><span class="lineno">  832</span>    <span class="keywordflow">if</span> (fs.doesExist()) isWritable = fs.isWritable();</div>
<div class="line"><span class="lineno">  833</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  834</span>    isMultiFrame  = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  835</span>    <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> dir = m_fp.<a class="code hl_function" href="class_t_file_path.html#a1f5014e9c396bc2268820c19bc15657d">getParentDir</a>();</div>
<div class="line"><span class="lineno">  836</span>    QDir qDir(QString::fromStdWString(dir.getWideString()));</div>
<div class="line"><span class="lineno">  837</span>    QString levelName =</div>
<div class="line"><span class="lineno">  838</span>        QRegExp::escape(QString::fromStdWString(m_fp.getWideName()));</div>
<div class="line"><span class="lineno">  839</span>    QString levelType = QString::fromStdString(m_fp.<a class="code hl_function" href="class_t_file_path.html#aefca624df1a5468a4c78ec6d5dbfae26">getType</a>());</div>
<div class="line"><span class="lineno">  840</span>    QString exp(levelName + <span class="stringliteral">&quot;.[0-9]{1,4}.&quot;</span> + levelType);</div>
<div class="line"><span class="lineno">  841</span>    QRegExp regExp(exp);</div>
<div class="line"><span class="lineno">  842</span>    QStringList list        = qDir.entryList(QDir::Files);</div>
<div class="line"><span class="lineno">  843</span>    QStringList livelFrames = list.filter(regExp);</div>
<div class="line"><span class="lineno">  844</span> </div>
<div class="line"><span class="lineno">  845</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  846</span>    <span class="keywordflow">for</span> (i = 0; i &lt; livelFrames.size() &amp;&amp; isWritable; i++) {</div>
<div class="line"><span class="lineno">  847</span>      <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> frame = dir + <a class="code hl_class" href="class_t_file_path.html">TFilePath</a>(livelFrames[i].toStdWString());</div>
<div class="line"><span class="lineno">  848</span>      <span class="keywordflow">if</span> (frame.isEmpty() || !frame.isAbsolute()) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  849</span>      <a class="code hl_class" href="class_t_file_status.html">TFileStatus</a> fs(frame);</div>
<div class="line"><span class="lineno">  850</span>      isWritable = fs.isWritable();</div>
<div class="line"><span class="lineno">  851</span>    }</div>
<div class="line"><span class="lineno">  852</span>  }</div>
<div class="line"><span class="lineno">  853</span>  <span class="keywordflow">if</span> (!isWritable) {</div>
<div class="line"><span class="lineno">  854</span>    QString str = QObject::tr(</div>
<div class="line"><span class="lineno">  855</span>        <span class="stringliteral">&quot;It is not possible to write the output:  the file&quot;</span>, <span class="stringliteral">&quot;RenderCommand&quot;</span>);</div>
<div class="line"><span class="lineno">  856</span>    str += isMultiFrame ? QObject::tr(<span class="stringliteral">&quot;s are read only.&quot;</span>, <span class="stringliteral">&quot;RenderCommand&quot;</span>)</div>
<div class="line"><span class="lineno">  857</span>                        : QObject::tr(<span class="stringliteral">&quot; is read only.&quot;</span>, <span class="stringliteral">&quot;RenderCommand&quot;</span>);</div>
<div class="line"><span class="lineno">  858</span>    DVGui::warning(str);</div>
<div class="line"><span class="lineno">  859</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  860</span>  }</div>
<div class="line"><span class="lineno">  861</span> </div>
<div class="line"><span class="lineno">  862</span>  <a class="code hl_class" href="class_toonz_scene.html">ToonzScene</a> *scene = 0;</div>
<div class="line"><span class="lineno">  863</span>  <a class="code hl_class" href="class_t_camera.html">TCamera</a> *camera   = 0;</div>
<div class="line"><span class="lineno">  864</span> </div>
<div class="line"><span class="lineno">  865</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  866</span>    <span class="comment">/*-- Xsheetノードに繋がっている各ラインごとに計算するモード。</span></div>
<div class="line"><span class="lineno">  867</span><span class="comment">            MultipleRender で Schematic Flows または Fx Schematic Terminal Nodes</span></div>
<div class="line"><span class="lineno">  868</span><span class="comment">    が選択されている場合</span></div>
<div class="line"><span class="lineno">  869</span><span class="comment">    --*/</span></div>
<div class="line"><span class="lineno">  870</span>    <span class="keywordflow">if</span> (m_multimediaRender)</div>
<div class="line"><span class="lineno">  871</span>      <a class="code hl_function" href="class_render_command.html#a05c1d0a15649217b5218597719cff23e">multimediaRender</a>();</div>
<div class="line"><span class="lineno">  872</span> </div>
<div class="line"><span class="lineno">  873</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  874</span>      <span class="comment">/*-- 通常のRendering --*/</span></div>
<div class="line"><span class="lineno">  875</span>      rasterRender(isPreview);</div>
<div class="line"><span class="lineno">  876</span>  } <span class="keywordflow">catch</span> (<a class="code hl_class" href="class_t_exception.html">TException</a> &amp;e) {</div>
<div class="line"><span class="lineno">  877</span>    DVGui::warning(QString::fromStdString(::to_string(e.getMessage())));</div>
<div class="line"><span class="lineno">  878</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  879</span>    DVGui::warning(</div>
<div class="line"><span class="lineno">  880</span>        QObject::tr(<span class="stringliteral">&quot;It is not possible to complete the rendering.&quot;</span>));</div>
<div class="line"><span class="lineno">  881</span>  }</div>
<div class="line"><span class="lineno">  882</span>}</div>
<div class="ttc" id="aclass_render_command_html_a05c1d0a15649217b5218597719cff23e"><div class="ttname"><a href="class_render_command.html#a05c1d0a15649217b5218597719cff23e">RenderCommand::multimediaRender</a></div><div class="ttdeci">void multimediaRender()</div><div class="ttdoc">Specialized render invocation for multimedia rendering.</div><div class="ttdef"><b>Definition:</b> rendercommand.cpp:721</div></div>
<div class="ttc" id="aclass_t_camera_html"><div class="ttname"><a href="class_t_camera.html">TCamera</a></div><div class="ttdoc">The TCamera class provides a camera and allows its management.</div><div class="ttdef"><b>Definition:</b> tcamera.h:33</div></div>
<div class="ttc" id="aclass_t_exception_html"><div class="ttname"><a href="class_t_exception.html">TException</a></div><div class="ttdef"><b>Definition:</b> texception.h:18</div></div>
<div class="ttc" id="aclass_t_file_path_html"><div class="ttname"><a href="class_t_file_path.html">TFilePath</a></div><div class="ttdef"><b>Definition:</b> tfilepath.h:134</div></div>
<div class="ttc" id="aclass_t_file_path_html_a1f5014e9c396bc2268820c19bc15657d"><div class="ttname"><a href="class_t_file_path.html#a1f5014e9c396bc2268820c19bc15657d">TFilePath::getParentDir</a></div><div class="ttdeci">TFilePath getParentDir() const</div><div class="ttdef"><b>Definition:</b> tfilepath.cpp:683</div></div>
<div class="ttc" id="aclass_t_file_path_html_a698bbf714436eb6923359044900cde2b"><div class="ttname"><a href="class_t_file_path.html#a698bbf714436eb6923359044900cde2b">TFilePath::getDots</a></div><div class="ttdeci">std::string getDots() const</div><div class="ttdef"><b>Definition:</b> tfilepath.cpp:539</div></div>
<div class="ttc" id="aclass_t_file_path_html_aefca624df1a5468a4c78ec6d5dbfae26"><div class="ttname"><a href="class_t_file_path.html#aefca624df1a5468a4c78ec6d5dbfae26">TFilePath::getType</a></div><div class="ttdeci">std::string getType() const</div><div class="ttdef"><b>Definition:</b> tfilepath.h:225</div></div>
<div class="ttc" id="aclass_t_file_status_html"><div class="ttname"><a href="class_t_file_status.html">TFileStatus</a></div><div class="ttdef"><b>Definition:</b> tsystem.h:36</div></div>
<div class="ttc" id="aclass_toonz_scene_html"><div class="ttname"><a href="class_toonz_scene.html">ToonzScene</a></div><div class="ttdef"><b>Definition:</b> toonzscene.h:42</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae9478a6c901774d759c2909c459ae173" name="ae9478a6c901774d759c2909c459ae173"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9478a6c901774d759c2909c459ae173">&#9670;&nbsp;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool RenderCommand::init </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isPreview</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  234</span>                                       {</div>
<div class="line"><span class="lineno">  235</span>  <a class="code hl_class" href="class_toonz_scene.html">ToonzScene</a> *scene       = <a class="code hl_function" href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a>()-&gt;<a class="code hl_function" href="class_t_app.html#abbbf1fae564e9e510826eda4f6637d20">getCurrentScene</a>()-&gt;getScene();</div>
<div class="line"><span class="lineno">  236</span>  <a class="code hl_class" href="class_t_scene_properties.html">TSceneProperties</a> *sprop = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>();</div>
<div class="line"><span class="lineno">  237</span>  <span class="comment">/*-- Preview/Renderに応じてそれぞれのSettingを取得 --*/</span></div>
<div class="line"><span class="lineno">  238</span>  <a class="code hl_class" href="class_t_output_properties.html">TOutputProperties</a> &amp;outputSettings = isPreview ? *sprop-&gt;<a class="code hl_function" href="class_t_scene_properties.html#a0b905e0ea16e27aa5e67da31e469026e">getPreviewProperties</a>()</div>
<div class="line"><span class="lineno">  239</span>                                                : *sprop-&gt;<a class="code hl_function" href="class_t_scene_properties.html#abea7b4b8e4f0cedbf753b26ec30b5331">getOutputProperties</a>();</div>
<div class="line"><span class="lineno">  240</span>  outputSettings.<a class="code hl_function" href="class_t_output_properties.html#aae127cbd8b19eaed0b0fbaf589349176">getRange</a>(m_r0, m_r1, m_step);</div>
<div class="line"><span class="lineno">  241</span>  <span class="comment">/*-- シーン全体のレンダリングの場合、m_r1をScene長に設定 --*/</span></div>
<div class="line"><span class="lineno">  242</span>  <span class="keywordflow">if</span> (m_r0 == 0 &amp;&amp; m_r1 == -1) {</div>
<div class="line"><span class="lineno">  243</span>    m_r0 = 0;</div>
<div class="line"><span class="lineno">  244</span>    m_r1 = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#ab5cd3ad6f894b1acc5656ca747a80627">getFrameCount</a>() - 1;</div>
<div class="line"><span class="lineno">  245</span>  }</div>
<div class="line"><span class="lineno">  246</span>  <span class="keywordflow">if</span> (m_r0 &lt; 0) m_r0                       = 0;</div>
<div class="line"><span class="lineno">  247</span>  <span class="keywordflow">if</span> (m_r1 &gt;= scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#ab5cd3ad6f894b1acc5656ca747a80627">getFrameCount</a>()) m_r1 = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#ab5cd3ad6f894b1acc5656ca747a80627">getFrameCount</a>() - 1;</div>
<div class="line"><span class="lineno">  248</span>  <span class="keywordflow">if</span> (m_r1 &lt; m_r0) {</div>
<div class="line"><span class="lineno">  249</span>    DVGui::warning(QObject::tr(</div>
<div class="line"><span class="lineno">  250</span>        <span class="stringliteral">&quot;The command cannot be executed because the scene is empty.&quot;</span>));</div>
<div class="line"><span class="lineno">  251</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  252</span>    <span class="comment">// throw TException(&quot;empty scene&quot;);</span></div>
<div class="line"><span class="lineno">  253</span>    <span class="comment">// non so perche&#39;, ma termina il programma</span></div>
<div class="line"><span class="lineno">  254</span>    <span class="comment">// nonostante il try all&#39;inizio</span></div>
<div class="line"><span class="lineno">  255</span>  }</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>  <span class="comment">// Initialize the preview case</span></div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>  <span class="comment">/*TRenderSettings rs = sprop-&gt;getPreviewProperties()-&gt;getRenderSettings();</span></div>
<div class="line"><span class="lineno">  260</span><span class="comment">TRenderSettings rso = sprop-&gt;getOutputProperties()-&gt;getRenderSettings();</span></div>
<div class="line"><span class="lineno">  261</span><span class="comment">rs.m_stereoscopic=true;</span></div>
<div class="line"><span class="lineno">  262</span><span class="comment">rs.m_stereoscopicShift=0.05;</span></div>
<div class="line"><span class="lineno">  263</span><span class="comment">rso.m_stereoscopic=true;</span></div>
<div class="line"><span class="lineno">  264</span><span class="comment">rso.m_stereoscopicShift=0.05;</span></div>
<div class="line"><span class="lineno">  265</span><span class="comment">sprop-&gt;getPreviewProperties()-&gt;setRenderSettings(rs);</span></div>
<div class="line"><span class="lineno">  266</span><span class="comment">sprop-&gt;getOutputProperties()-&gt;setRenderSettings(rso);*/</span></div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span>  <span class="keywordflow">if</span> (isPreview) {</div>
<div class="line"><span class="lineno">  269</span>    <span class="comment">/*--</span></div>
<div class="line"><span class="lineno">  270</span><span class="comment">     * PreviewではTimeStretchを考慮しないので、そのままフレーム値を格納してゆく</span></div>
<div class="line"><span class="lineno">  271</span><span class="comment">     * --*/</span></div>
<div class="line"><span class="lineno">  272</span>    m_numFrames        = (int)(m_r1 - m_r0 + 1);</div>
<div class="line"><span class="lineno">  273</span>    m_r                = m_r0;</div>
<div class="line"><span class="lineno">  274</span>    m_stepd            = m_step;</div>
<div class="line"><span class="lineno">  275</span>    m_multimediaRender = 0;</div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  277</span>  }</div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>  <span class="comment">// Full render case</span></div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>  <span class="comment">// Read the output filepath</span></div>
<div class="line"><span class="lineno">  282</span>  <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> fp = outputSettings.<a class="code hl_function" href="class_t_output_properties.html#ab082a7e84177a558484d648215e4b4f7">getPath</a>();</div>
<div class="line"><span class="lineno">  283</span> </div>
<div class="line"><span class="lineno">  284</span>  <span class="comment">// you cannot render an untitled scene to scene folder</span></div>
<div class="line"><span class="lineno">  285</span>  <span class="keywordflow">if</span> (scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a53cbaf09f551658479eb743e153ab6bc">isUntitled</a>() &amp;&amp; <a class="code hl_class" href="class_t_file_path.html">TFilePath</a>(<span class="stringliteral">&quot;$scenefolder&quot;</span>).isAncestorOf(fp)) {</div>
<div class="line"><span class="lineno">  286</span>    DVGui::warning(</div>
<div class="line"><span class="lineno">  287</span>        QObject::tr(<span class="stringliteral">&quot;The scene is not yet saved and the output destination is &quot;</span></div>
<div class="line"><span class="lineno">  288</span>                    <span class="stringliteral">&quot;set to $scenefolder.\nSave the scene first.&quot;</span>));</div>
<div class="line"><span class="lineno">  289</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  290</span>  }</div>
<div class="line"><span class="lineno">  291</span> </div>
<div class="line"><span class="lineno">  292</span>  <span class="comment">/*-- ファイル名が指定されていない場合は、シーン名を出力ファイル名にする --*/</span></div>
<div class="line"><span class="lineno">  293</span>  <span class="keywordflow">if</span> (fp.getWideName() == L<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><span class="lineno">  294</span>    fp = fp.<a class="code hl_function" href="class_t_file_path.html#a3ebf9ced558cfef97a60bba536b23c6f">withName</a>(scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#ad42b52b671b094f66e003c4b7ebefd45">getScenePath</a>().<a class="code hl_function" href="class_t_file_path.html#af94f9b0aeceb6cdb980fa1789473503a">getName</a>());</div>
<div class="line"><span class="lineno">  295</span>  <span class="comment">/*-- ラスタ画像の場合、ファイル名にフレーム番号を追加 --*/</span></div>
<div class="line"><span class="lineno">  296</span>  <span class="keywordflow">if</span> (TFileType::getInfo(fp) == TFileType::RASTER_IMAGE ||</div>
<div class="line"><span class="lineno">  297</span>      fp.<a class="code hl_function" href="class_t_file_path.html#aefca624df1a5468a4c78ec6d5dbfae26">getType</a>() == <span class="stringliteral">&quot;pct&quot;</span> || fp.<a class="code hl_function" href="class_t_file_path.html#aefca624df1a5468a4c78ec6d5dbfae26">getType</a>() == <span class="stringliteral">&quot;pic&quot;</span> ||</div>
<div class="line"><span class="lineno">  298</span>      fp.<a class="code hl_function" href="class_t_file_path.html#aefca624df1a5468a4c78ec6d5dbfae26">getType</a>() == <span class="stringliteral">&quot;pict&quot;</span>)  <span class="comment">// pct e&#39; un formato&quot;livello&quot; (ha i settings di</span></div>
<div class="line"><span class="lineno">  299</span>                               <span class="comment">// quicktime) ma fatto di diversi frames</span></div>
<div class="line"><span class="lineno">  300</span>    fp = fp.<a class="code hl_function" href="class_t_file_path.html#a12f35b225e1882372ad7e02ad7fce543">withFrame</a>(TFrameId::EMPTY_FRAME);</div>
<div class="line"><span class="lineno">  301</span>  fp   = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#aa2ed57dfbae7f8cf02a4abe47ed533c6">decodeFilePath</a>(fp);</div>
<div class="line"><span class="lineno">  302</span>  <span class="keywordflow">if</span> (!<a class="code hl_class" href="class_t_file_status.html">TFileStatus</a>(fp.<a class="code hl_function" href="class_t_file_path.html#a1f5014e9c396bc2268820c19bc15657d">getParentDir</a>()).doesExist()) {</div>
<div class="line"><span class="lineno">  303</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  304</span>      <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> parent = fp.<a class="code hl_function" href="class_t_file_path.html#a1f5014e9c396bc2268820c19bc15657d">getParentDir</a>();</div>
<div class="line"><span class="lineno">  305</span>      TSystem::mkDir(parent);</div>
<div class="line"><span class="lineno">  306</span>      DvDirModel::instance()-&gt;refreshFolder(parent.<a class="code hl_function" href="class_t_file_path.html#a1f5014e9c396bc2268820c19bc15657d">getParentDir</a>());</div>
<div class="line"><span class="lineno">  307</span>    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="class_t_exception.html">TException</a> &amp;e) {</div>
<div class="line"><span class="lineno">  308</span>      DVGui::warning(</div>
<div class="line"><span class="lineno">  309</span>          QObject::tr(<span class="stringliteral">&quot;It is not possible to create folder : %1&quot;</span>)</div>
<div class="line"><span class="lineno">  310</span>              .arg(QString::fromStdString(::to_string(e.getMessage()))));</div>
<div class="line"><span class="lineno">  311</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  312</span>    } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  313</span>      DVGui::warning(QObject::tr(<span class="stringliteral">&quot;It is not possible to create a folder.&quot;</span>));</div>
<div class="line"><span class="lineno">  314</span>      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  315</span>    }</div>
<div class="line"><span class="lineno">  316</span>  }</div>
<div class="line"><span class="lineno">  317</span>  m_fp = fp;</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>  <span class="comment">// Retrieve camera infos</span></div>
<div class="line"><span class="lineno">  320</span>  <span class="keyword">const</span> <a class="code hl_class" href="class_t_camera.html">TCamera</a> *camera =</div>
<div class="line"><span class="lineno">  321</span>      isPreview ? scene-&gt;getCurrentPreviewCamera() : scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a750b5ab623ccec744013b0c83bf20abc">getCurrentCamera</a>();</div>
<div class="line"><span class="lineno">  322</span>  <a class="code hl_class" href="class_t_dimension_t.html">TDimension</a> cameraSize = camera-&gt;<a class="code hl_function" href="class_t_camera.html#a9a7c573e7a2c397ffae4b747809ea2a5">getRes</a>();</div>
<div class="line"><span class="lineno">  323</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> cameraDpi     = camera-&gt;<a class="code hl_function" href="class_t_camera.html#adf45510b5dc53f6481308ef489fbd5a9">getDpi</a>();</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>  <span class="comment">// Retrieve render interval/step/times</span></div>
<div class="line"><span class="lineno">  326</span>  <span class="keywordtype">double</span> stretchTo = (double)outputSettings.<a class="code hl_function" href="class_t_output_properties.html#afa7c771452b57b50047aa4afc6032cad">getRenderSettings</a>().<a class="code hl_variable" href="class_t_render_settings.html#a6b8313c094bdb0c2ab6902b1f895694e">m_timeStretchTo</a>;</div>
<div class="line"><span class="lineno">  327</span>  <span class="keywordtype">double</span> stretchFrom =</div>
<div class="line"><span class="lineno">  328</span>      (double)outputSettings.<a class="code hl_function" href="class_t_output_properties.html#afa7c771452b57b50047aa4afc6032cad">getRenderSettings</a>().<a class="code hl_variable" href="class_t_render_settings.html#aec1a905d4eec617a546c286480f41b2a">m_timeStretchFrom</a>;</div>
<div class="line"><span class="lineno">  329</span> </div>
<div class="line"><span class="lineno">  330</span>  m_timeStretchFactor = stretchTo / stretchFrom;</div>
<div class="line"><span class="lineno">  331</span>  m_stepd             = m_step / m_timeStretchFactor;</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>  <span class="keywordtype">int</span> stretchedR0 = tfloor(m_r0 * m_timeStretchFactor);</div>
<div class="line"><span class="lineno">  334</span>  <span class="keywordtype">int</span> stretchedR1 = tceil((m_r1 + 1) * m_timeStretchFactor) - 1;</div>
<div class="line"><span class="lineno">  335</span> </div>
<div class="line"><span class="lineno">  336</span>  m_r         = stretchedR0 / m_timeStretchFactor;</div>
<div class="line"><span class="lineno">  337</span>  m_numFrames = (stretchedR1 - stretchedR0) / m_step + 1;</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>  <span class="comment">// Update the multimedia render switch</span></div>
<div class="line"><span class="lineno">  340</span>  m_multimediaRender = outputSettings.getMultimediaRendering();</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  343</span>}</div>
<div class="ttc" id="aclass_t_app_html_a24088f8647d5d9447fcec6b9b9bbf9eb"><div class="ttname"><a href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a></div><div class="ttdeci">static TApp * instance()</div><div class="ttdef"><b>Definition:</b> tapp.cpp:215</div></div>
<div class="ttc" id="aclass_t_app_html_abbbf1fae564e9e510826eda4f6637d20"><div class="ttname"><a href="class_t_app.html#abbbf1fae564e9e510826eda4f6637d20">TApp::getCurrentScene</a></div><div class="ttdeci">TSceneHandle * getCurrentScene() const override</div><div class="ttdef"><b>Definition:</b> tapp.h:106</div></div>
<div class="ttc" id="aclass_t_camera_html_a9a7c573e7a2c397ffae4b747809ea2a5"><div class="ttname"><a href="class_t_camera.html#a9a7c573e7a2c397ffae4b747809ea2a5">TCamera::getRes</a></div><div class="ttdeci">const TDimension &amp; getRes() const</div><div class="ttdef"><b>Definition:</b> tcamera.h:72</div></div>
<div class="ttc" id="aclass_t_camera_html_adf45510b5dc53f6481308ef489fbd5a9"><div class="ttname"><a href="class_t_camera.html#adf45510b5dc53f6481308ef489fbd5a9">TCamera::getDpi</a></div><div class="ttdeci">TPointD getDpi() const</div><div class="ttdef"><b>Definition:</b> tcamera.cpp:62</div></div>
<div class="ttc" id="aclass_t_dimension_t_html"><div class="ttname"><a href="class_t_dimension_t.html">TDimensionT&lt; int &gt;</a></div></div>
<div class="ttc" id="aclass_t_file_path_html_a12f35b225e1882372ad7e02ad7fce543"><div class="ttname"><a href="class_t_file_path.html#a12f35b225e1882372ad7e02ad7fce543">TFilePath::withFrame</a></div><div class="ttdeci">TFilePath withFrame(const TFrameId &amp;frame, TFrameId::FrameFormat format=TFrameId::USE_CURRENT_FORMAT) const</div><div class="ttdef"><b>Definition:</b> tfilepath.cpp:860</div></div>
<div class="ttc" id="aclass_t_file_path_html_a3ebf9ced558cfef97a60bba536b23c6f"><div class="ttname"><a href="class_t_file_path.html#a3ebf9ced558cfef97a60bba536b23c6f">TFilePath::withName</a></div><div class="ttdeci">TFilePath withName(const std::string &amp;name) const</div><div class="ttdef"><b>Definition:</b> tfilepath.cpp:802</div></div>
<div class="ttc" id="aclass_t_file_path_html_af94f9b0aeceb6cdb980fa1789473503a"><div class="ttname"><a href="class_t_file_path.html#af94f9b0aeceb6cdb980fa1789473503a">TFilePath::getName</a></div><div class="ttdeci">std::string getName() const</div><div class="ttdef"><b>Definition:</b> tfilepath.cpp:636</div></div>
<div class="ttc" id="aclass_t_output_properties_html"><div class="ttname"><a href="class_t_output_properties.html">TOutputProperties</a></div><div class="ttdef"><b>Definition:</b> toutputproperties.h:63</div></div>
<div class="ttc" id="aclass_t_output_properties_html_aae127cbd8b19eaed0b0fbaf589349176"><div class="ttname"><a href="class_t_output_properties.html#aae127cbd8b19eaed0b0fbaf589349176">TOutputProperties::getRange</a></div><div class="ttdeci">bool getRange(int &amp;r0, int &amp;r1, int &amp;step) const</div><div class="ttdef"><b>Definition:</b> outputproperties.cpp:128</div></div>
<div class="ttc" id="aclass_t_output_properties_html_ab082a7e84177a558484d648215e4b4f7"><div class="ttname"><a href="class_t_output_properties.html#ab082a7e84177a558484d648215e4b4f7">TOutputProperties::getPath</a></div><div class="ttdeci">TFilePath getPath() const</div><div class="ttdef"><b>Definition:</b> outputproperties.cpp:116</div></div>
<div class="ttc" id="aclass_t_output_properties_html_afa7c771452b57b50047aa4afc6032cad"><div class="ttname"><a href="class_t_output_properties.html#afa7c771452b57b50047aa4afc6032cad">TOutputProperties::getRenderSettings</a></div><div class="ttdeci">const TRenderSettings &amp; getRenderSettings() const</div><div class="ttdef"><b>Definition:</b> toutputproperties.h:181</div></div>
<div class="ttc" id="aclass_t_point_t_html"><div class="ttname"><a href="class_t_point_t.html">TPointT&lt; double &gt;</a></div></div>
<div class="ttc" id="aclass_t_render_settings_html_a6b8313c094bdb0c2ab6902b1f895694e"><div class="ttname"><a href="class_t_render_settings.html#a6b8313c094bdb0c2ab6902b1f895694e">TRenderSettings::m_timeStretchTo</a></div><div class="ttdeci">double m_timeStretchTo</div><div class="ttdef"><b>Definition:</b> trasterfx.h:110</div></div>
<div class="ttc" id="aclass_t_render_settings_html_aec1a905d4eec617a546c286480f41b2a"><div class="ttname"><a href="class_t_render_settings.html#aec1a905d4eec617a546c286480f41b2a">TRenderSettings::m_timeStretchFrom</a></div><div class="ttdeci">double m_timeStretchFrom</div><div class="ttdef"><b>Definition:</b> trasterfx.h:109</div></div>
<div class="ttc" id="aclass_t_scene_properties_html"><div class="ttname"><a href="class_t_scene_properties.html">TSceneProperties</a></div><div class="ttdef"><b>Definition:</b> sceneproperties.h:49</div></div>
<div class="ttc" id="aclass_t_scene_properties_html_a0b905e0ea16e27aa5e67da31e469026e"><div class="ttname"><a href="class_t_scene_properties.html#a0b905e0ea16e27aa5e67da31e469026e">TSceneProperties::getPreviewProperties</a></div><div class="ttdeci">TOutputProperties * getPreviewProperties() const</div><div class="ttdef"><b>Definition:</b> sceneproperties.h:151</div></div>
<div class="ttc" id="aclass_t_scene_properties_html_abea7b4b8e4f0cedbf753b26ec30b5331"><div class="ttname"><a href="class_t_scene_properties.html#abea7b4b8e4f0cedbf753b26ec30b5331">TSceneProperties::getOutputProperties</a></div><div class="ttdeci">TOutputProperties * getOutputProperties() const</div><div class="ttdef"><b>Definition:</b> sceneproperties.h:145</div></div>
<div class="ttc" id="aclass_toonz_scene_html_a53cbaf09f551658479eb743e153ab6bc"><div class="ttname"><a href="class_toonz_scene.html#a53cbaf09f551658479eb743e153ab6bc">ToonzScene::isUntitled</a></div><div class="ttdeci">bool isUntitled() const</div><div class="ttdef"><b>Definition:</b> toonzscene.cpp:345</div></div>
<div class="ttc" id="aclass_toonz_scene_html_a750b5ab623ccec744013b0c83bf20abc"><div class="ttname"><a href="class_toonz_scene.html#a750b5ab623ccec744013b0c83bf20abc">ToonzScene::getCurrentCamera</a></div><div class="ttdeci">TCamera * getCurrentCamera()</div><div class="ttdef"><b>Definition:</b> toonzscene.cpp:1472</div></div>
<div class="ttc" id="aclass_toonz_scene_html_a8ef96fedc17d7def810ac419b0939254"><div class="ttname"><a href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">ToonzScene::getProperties</a></div><div class="ttdeci">TSceneProperties * getProperties() const</div><div class="ttdoc">&lt; Returns a pointer to the scene's properties.</div><div class="ttdef"><b>Definition:</b> toonzscene.h:87</div></div>
<div class="ttc" id="aclass_toonz_scene_html_aa2ed57dfbae7f8cf02a4abe47ed533c6"><div class="ttname"><a href="class_toonz_scene.html#aa2ed57dfbae7f8cf02a4abe47ed533c6">ToonzScene::decodeFilePath</a></div><div class="ttdeci">TFilePath decodeFilePath(const TFilePath &amp;) const</div><div class="ttdef"><b>Definition:</b> toonzscene.cpp:1231</div></div>
<div class="ttc" id="aclass_toonz_scene_html_ab5cd3ad6f894b1acc5656ca747a80627"><div class="ttname"><a href="class_toonz_scene.html#ab5cd3ad6f894b1acc5656ca747a80627">ToonzScene::getFrameCount</a></div><div class="ttdeci">int getFrameCount() const</div><div class="ttdef"><b>Definition:</b> toonzscene.cpp:704</div></div>
<div class="ttc" id="aclass_toonz_scene_html_ad42b52b671b094f66e003c4b7ebefd45"><div class="ttname"><a href="class_toonz_scene.html#ad42b52b671b094f66e003c4b7ebefd45">ToonzScene::getScenePath</a></div><div class="ttdeci">TFilePath getScenePath() const</div><div class="ttdoc">Returns the scene's file path.</div><div class="ttdef"><b>Definition:</b> toonzscene.h:59</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a05c1d0a15649217b5218597719cff23e" name="a05c1d0a15649217b5218597719cff23e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05c1d0a15649217b5218597719cff23e">&#9670;&nbsp;</a></span>multimediaRender()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RenderCommand::multimediaRender </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Specialized render invocation for multimedia rendering. </p>
<div class="fragment"><div class="line"><span class="lineno">  721</span>                                     {</div>
<div class="line"><span class="lineno">  722</span>  <a class="code hl_class" href="class_toonz_scene.html">ToonzScene</a> *scene = <a class="code hl_function" href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a>()-&gt;<a class="code hl_function" href="class_t_app.html#abbbf1fae564e9e510826eda4f6637d20">getCurrentScene</a>()-&gt;getScene();</div>
<div class="line"><span class="lineno">  723</span>  std::string ext   = m_fp.<a class="code hl_function" href="class_t_file_path.html#aefca624df1a5468a4c78ec6d5dbfae26">getType</a>();</div>
<div class="line"><span class="lineno">  724</span> </div>
<div class="line"><span class="lineno">  725</span><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><span class="lineno">  726</span>  <span class="keywordflow">if</span> (ext == <span class="stringliteral">&quot;avi&quot;</span>) {</div>
<div class="line"><span class="lineno">  727</span>    <a class="code hl_class" href="class_t_property_group.html">TPropertyGroup</a> *props =</div>
<div class="line"><span class="lineno">  728</span>        scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#abea7b4b8e4f0cedbf753b26ec30b5331">getOutputProperties</a>()-&gt;<a class="code hl_function" href="class_t_output_properties.html#a9ef174e6f6239219fa563b037246c8d4">getFileFormatProperties</a>(</div>
<div class="line"><span class="lineno">  729</span>            ext);</div>
<div class="line"><span class="lineno">  730</span>    std::string codecName = props-&gt;<a class="code hl_function" href="class_t_property_group.html#afb08f3145e5f77da6f163cdc9decad2f">getProperty</a>(0)-&gt;getValueAsString();</div>
<div class="line"><span class="lineno">  731</span>    <a class="code hl_class" href="class_t_dimension_t.html">TDimension</a> res        = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a750b5ab623ccec744013b0c83bf20abc">getCurrentCamera</a>()-&gt;<a class="code hl_function" href="class_t_camera.html#a9a7c573e7a2c397ffae4b747809ea2a5">getRes</a>();</div>
<div class="line"><span class="lineno">  732</span>    <span class="keywordflow">if</span> (!AviCodecRestrictions::canWriteMovie(::to_wstring(codecName), res)) {</div>
<div class="line"><span class="lineno">  733</span>      QString msg(</div>
<div class="line"><span class="lineno">  734</span>          QObject::tr(<span class="stringliteral">&quot;The resolution of the output camera does not fit with &quot;</span></div>
<div class="line"><span class="lineno">  735</span>                      <span class="stringliteral">&quot;the options chosen for the output file format.&quot;</span>));</div>
<div class="line"><span class="lineno">  736</span>      DVGui::warning(msg);</div>
<div class="line"><span class="lineno">  737</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  738</span>    }</div>
<div class="line"><span class="lineno">  739</span>  }</div>
<div class="line"><span class="lineno">  740</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  741</span> </div>
<div class="line"><span class="lineno">  742</span>  <a class="code hl_class" href="class_t_output_properties.html">TOutputProperties</a> *prop = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#abea7b4b8e4f0cedbf753b26ec30b5331">getOutputProperties</a>();</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>  <span class="comment">// Build thread count</span></div>
<div class="line"><span class="lineno">  745</span>  <span class="keywordtype">int</span> index = prop-&gt;getThreadIndex();</div>
<div class="line"><span class="lineno">  746</span> </div>
<div class="line"><span class="lineno">  747</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> procCount       = TSystem::getProcessorCount();</div>
<div class="line"><span class="lineno">  748</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> threadCounts[3] = {1, procCount / 2, procCount};</div>
<div class="line"><span class="lineno">  749</span> </div>
<div class="line"><span class="lineno">  750</span>  <span class="keywordtype">int</span> threadCount = threadCounts[index];</div>
<div class="line"><span class="lineno">  751</span> </div>
<div class="line"><span class="lineno">  752</span>  <span class="comment">// Build raster granularity size</span></div>
<div class="line"><span class="lineno">  753</span>  index = prop-&gt;getMaxTileSizeIndex();</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> maxTileSizes[4] = {</div>
<div class="line"><span class="lineno">  756</span>      (std::numeric_limits&lt;int&gt;::max)(), TOutputProperties::LargeVal,</div>
<div class="line"><span class="lineno">  757</span>      TOutputProperties::MediumVal, TOutputProperties::SmallVal};</div>
<div class="line"><span class="lineno">  758</span> </div>
<div class="line"><span class="lineno">  759</span>  <a class="code hl_class" href="class_t_render_settings.html">TRenderSettings</a> rs = prop-&gt;<a class="code hl_function" href="class_t_output_properties.html#afa7c771452b57b50047aa4afc6032cad">getRenderSettings</a>();</div>
<div class="line"><span class="lineno">  760</span>  rs.<a class="code hl_variable" href="class_t_render_settings.html#a4b0770f4a243e1f32a60efefebf0e11b">m_maxTileSize</a>   = maxTileSizes[index];</div>
<div class="line"><span class="lineno">  761</span> </div>
<div class="line"><span class="lineno">  762</span>  <a class="code hl_class" href="class_multimedia_renderer.html">MultimediaRenderer</a> multimediaRenderer(</div>
<div class="line"><span class="lineno">  763</span>      scene, m_fp, prop-&gt;getMultimediaRendering(), threadCount);</div>
<div class="line"><span class="lineno">  764</span>  multimediaRenderer.setRenderSettings(rs);</div>
<div class="line"><span class="lineno">  765</span> </div>
<div class="line"><span class="lineno">  766</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> cameraDpi = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a750b5ab623ccec744013b0c83bf20abc">getCurrentCamera</a>()-&gt;<a class="code hl_function" href="class_t_camera.html#adf45510b5dc53f6481308ef489fbd5a9">getDpi</a>();</div>
<div class="line"><span class="lineno">  767</span>  multimediaRenderer.setDpi(cameraDpi.x, cameraDpi.y);</div>
<div class="line"><span class="lineno">  768</span>  multimediaRenderer.enablePrecomputing(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_numFrames; ++i, m_r += m_stepd)</div>
<div class="line"><span class="lineno">  771</span>    multimediaRenderer.addFrame(m_r);</div>
<div class="line"><span class="lineno">  772</span> </div>
<div class="line"><span class="lineno">  773</span>  <a class="code hl_class" href="class_multimedia_progress_bar.html">MultimediaProgressBar</a> *listener =</div>
<div class="line"><span class="lineno">  774</span>      <span class="keyword">new</span> <a class="code hl_class" href="class_multimedia_progress_bar.html">MultimediaProgressBar</a>(&amp;multimediaRenderer);</div>
<div class="line"><span class="lineno">  775</span>  QObject::connect(listener, SIGNAL(canceled()), &amp;multimediaRenderer,</div>
<div class="line"><span class="lineno">  776</span>                   SLOT(onCanceled()));</div>
<div class="line"><span class="lineno">  777</span>  multimediaRenderer.addListener(listener);</div>
<div class="line"><span class="lineno">  778</span> </div>
<div class="line"><span class="lineno">  779</span>  multimediaRenderer.start();</div>
<div class="line"><span class="lineno">  780</span>}</div>
<div class="ttc" id="aclass_multimedia_progress_bar_html"><div class="ttname"><a href="class_multimedia_progress_bar.html">MultimediaProgressBar</a></div><div class="ttdef"><b>Definition:</b> rendercommand.cpp:601</div></div>
<div class="ttc" id="aclass_multimedia_renderer_html"><div class="ttname"><a href="class_multimedia_renderer.html">MultimediaRenderer</a></div><div class="ttdef"><b>Definition:</b> multimediarenderer.h:49</div></div>
<div class="ttc" id="aclass_t_output_properties_html_a9ef174e6f6239219fa563b037246c8d4"><div class="ttname"><a href="class_t_output_properties.html#a9ef174e6f6239219fa563b037246c8d4">TOutputProperties::getFileFormatProperties</a></div><div class="ttdeci">TPropertyGroup * getFileFormatProperties(std::string ext)</div><div class="ttdef"><b>Definition:</b> outputproperties.cpp:156</div></div>
<div class="ttc" id="aclass_t_property_group_html"><div class="ttname"><a href="class_t_property_group.html">TPropertyGroup</a></div><div class="ttdef"><b>Definition:</b> tproperty.h:430</div></div>
<div class="ttc" id="aclass_t_property_group_html_afb08f3145e5f77da6f163cdc9decad2f"><div class="ttname"><a href="class_t_property_group.html#afb08f3145e5f77da6f163cdc9decad2f">TPropertyGroup::getProperty</a></div><div class="ttdeci">TProperty * getProperty(std::string name)</div><div class="ttdoc">returns 0 if the property doesn't exist</div><div class="ttdef"><b>Definition:</b> tproperty.cpp:67</div></div>
<div class="ttc" id="aclass_t_render_settings_html"><div class="ttname"><a href="class_t_render_settings.html">TRenderSettings</a></div><div class="ttdoc">Data class containing the relevant additional information needed in a render process.</div><div class="ttdef"><b>Definition:</b> trasterfx.h:61</div></div>
<div class="ttc" id="aclass_t_render_settings_html_a4b0770f4a243e1f32a60efefebf0e11b"><div class="ttname"><a href="class_t_render_settings.html#a4b0770f4a243e1f32a60efefebf0e11b">TRenderSettings::m_maxTileSize</a></div><div class="ttdeci">int m_maxTileSize</div><div class="ttdef"><b>Definition:</b> trasterfx.h:120</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00506">MultimediaRenderer::addFrame()</a>, <a class="el" href="#l01472">ToonzScene::getCurrentCamera()</a>, <a class="el" href="#l00106">TApp::getCurrentScene()</a>, <a class="el" href="#l00062">TCamera::getDpi()</a>, <a class="el" href="#l00156">TOutputProperties::getFileFormatProperties()</a>, <a class="el" href="#l00145">TSceneProperties::getOutputProperties()</a>, <a class="el" href="#l00087">ToonzScene::getProperties()</a>, <a class="el" href="#l00067">TPropertyGroup::getProperty()</a>, <a class="el" href="#l00181">TOutputProperties::getRenderSettings()</a>, <a class="el" href="#l00072">TCamera::getRes()</a>, <a class="el" href="#l00225">TFilePath::getType()</a>, <a class="el" href="#l00215">TApp::instance()</a>, <a class="el" href="#l00120">TRenderSettings::m_maxTileSize</a>, and <a class="el" href="#l00533">MultimediaRenderer::start()</a>.</p>

</div>
</div>
<a id="a0045283ec09c6e344682fe5f4e947e46" name="a0045283ec09c6e344682fe5f4e947e46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0045283ec09c6e344682fe5f4e947e46">&#9670;&nbsp;</a></span>onFastRender()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RenderCommand::onFastRender </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  786</span>                                 {</div>
<div class="line"><span class="lineno">  787</span>  <a class="code hl_class" href="class_t_output_properties.html">TOutputProperties</a> *prop = <a class="code hl_function" href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a>()</div>
<div class="line"><span class="lineno">  788</span>                                -&gt;<a class="code hl_function" href="class_t_app.html#abbbf1fae564e9e510826eda4f6637d20">getCurrentScene</a>()</div>
<div class="line"><span class="lineno">  789</span>                                -&gt;getScene()</div>
<div class="line"><span class="lineno">  790</span>                                -&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()</div>
<div class="line"><span class="lineno">  791</span>                                -&gt;<a class="code hl_function" href="class_t_scene_properties.html#abea7b4b8e4f0cedbf753b26ec30b5331">getOutputProperties</a>();</div>
<div class="line"><span class="lineno">  792</span>  QString sceneName = QString::fromStdWString(</div>
<div class="line"><span class="lineno">  793</span>      <a class="code hl_function" href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a>()-&gt;getCurrentScene()-&gt;getScene()-&gt;getSceneName());</div>
<div class="line"><span class="lineno">  794</span>  QString location = Preferences::instance()-&gt;getFastRenderPath();</div>
<div class="line"><span class="lineno">  795</span>  <span class="keywordflow">if</span> (location == <span class="stringliteral">&quot;desktop&quot;</span> || location == <span class="stringliteral">&quot;Desktop&quot;</span>) {</div>
<div class="line"><span class="lineno">  796</span>    location =</div>
<div class="line"><span class="lineno">  797</span>        QStandardPaths::writableLocation(QStandardPaths::DesktopLocation);</div>
<div class="line"><span class="lineno">  798</span>  }</div>
<div class="line"><span class="lineno">  799</span>  <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> path     = <a class="code hl_class" href="class_t_file_path.html">TFilePath</a>(location) + <a class="code hl_class" href="class_t_file_path.html">TFilePath</a>(sceneName + <span class="stringliteral">&quot;.mp4&quot;</span>);</div>
<div class="line"><span class="lineno">  800</span>  <a class="code hl_class" href="class_t_file_path.html">TFilePath</a> currPath = prop-&gt;<a class="code hl_function" href="class_t_output_properties.html#ab082a7e84177a558484d648215e4b4f7">getPath</a>();</div>
<div class="line"><span class="lineno">  801</span> </div>
<div class="line"><span class="lineno">  802</span>  QStringList formats;</div>
<div class="line"><span class="lineno">  803</span>  TImageWriter::getSupportedFormats(formats, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  804</span>  TLevelWriter::getSupportedFormats(formats, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  805</span>  Tiio::Writer::getSupportedFormats(formats, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  806</span>  <span class="keywordflow">if</span> (!formats.contains(<span class="stringliteral">&quot;mp4&quot;</span>)) {</div>
<div class="line"><span class="lineno">  807</span>    QString msg = QObject::tr(</div>
<div class="line"><span class="lineno">  808</span>        <span class="stringliteral">&quot;FFmpeg not found, please set the location in the Preferences and &quot;</span></div>
<div class="line"><span class="lineno">  809</span>        <span class="stringliteral">&quot;restart.&quot;</span>);</div>
<div class="line"><span class="lineno">  810</span>    DVGui::warning(msg);</div>
<div class="line"><span class="lineno">  811</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  812</span>  }</div>
<div class="line"><span class="lineno">  813</span>  prop-&gt;<a class="code hl_function" href="class_t_output_properties.html#abd2cedbcd56198c5d6e9e9ffcd51767e">setPath</a>(path);</div>
<div class="line"><span class="lineno">  814</span>  doRender(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  815</span>  prop-&gt;<a class="code hl_function" href="class_t_output_properties.html#abd2cedbcd56198c5d6e9e9ffcd51767e">setPath</a>(currPath);</div>
<div class="line"><span class="lineno">  816</span>}</div>
<div class="ttc" id="aclass_t_output_properties_html_abd2cedbcd56198c5d6e9e9ffcd51767e"><div class="ttname"><a href="class_t_output_properties.html#abd2cedbcd56198c5d6e9e9ffcd51767e">TOutputProperties::setPath</a></div><div class="ttdeci">void setPath(const TFilePath &amp;fp)</div><div class="ttdef"><b>Definition:</b> outputproperties.cpp:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ccd5e8b39ac86d467b723ef2c5698fc" name="a1ccd5e8b39ac86d467b723ef2c5698fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ccd5e8b39ac86d467b723ef2c5698fc">&#9670;&nbsp;</a></span>onPreview()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RenderCommand::onPreview </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  818</span>{ doRender(<span class="keyword">true</span>); }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa18238bc4ddc0ab09eb17585a52ce148" name="aa18238bc4ddc0ab09eb17585a52ce148"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa18238bc4ddc0ab09eb17585a52ce148">&#9670;&nbsp;</a></span>onRender()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RenderCommand::onRender </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  784</span>{ doRender(<span class="keyword">false</span>); }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a719be4812e9e27958f2dce68d4a8feff" name="a719be4812e9e27958f2dce68d4a8feff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a719be4812e9e27958f2dce68d4a8feff">&#9670;&nbsp;</a></span>rasterRender()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RenderCommand::rasterRender </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isPreview</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  446</span>                                               {</div>
<div class="line"><span class="lineno">  447</span>  <a class="code hl_class" href="class_toonz_scene.html">ToonzScene</a> *scene = <a class="code hl_function" href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a>()-&gt;<a class="code hl_function" href="class_t_app.html#abbbf1fae564e9e510826eda4f6637d20">getCurrentScene</a>()-&gt;getScene();</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span>  <span class="keywordflow">if</span> (isPreview) {</div>
<div class="line"><span class="lineno">  450</span>    <span class="comment">// Let the PreviewFxManager own the rest. Just pass him the current output</span></div>
<div class="line"><span class="lineno">  451</span>    <span class="comment">// node.</span></div>
<div class="line"><span class="lineno">  452</span>    <a class="code hl_function" href="class_preview_fx_manager.html#a540923ef1e799396ddf8bba11bb3c8c6">PreviewFxManager::instance</a>()-&gt;<a class="code hl_function" href="class_preview_fx_manager.html#a5a633f9f858d2ea0e6ccee709d495b74">showNewPreview</a>(</div>
<div class="line"><span class="lineno">  453</span>        (<a class="code hl_class" href="class_t_fx.html">TFx</a> *)scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#ae3c828e3223fd809fd59189233d0576a">getXsheet</a>()-&gt;<a class="code hl_function" href="class_t_xsheet.html#adc7c74cce346abf3699bb250eb17a9c2">getFxDag</a>()-&gt;getCurrentOutputFx());</div>
<div class="line"><span class="lineno">  454</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  455</span>  }</div>
<div class="line"><span class="lineno">  456</span> </div>
<div class="line"><span class="lineno">  457</span>  std::string ext = m_fp.<a class="code hl_function" href="class_t_file_path.html#aefca624df1a5468a4c78ec6d5dbfae26">getType</a>();</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><span class="lineno">  460</span>  <span class="keywordflow">if</span> (ext == <span class="stringliteral">&quot;avi&quot;</span> &amp;&amp; !isPreview) {</div>
<div class="line"><span class="lineno">  461</span>    <a class="code hl_class" href="class_t_property_group.html">TPropertyGroup</a> *props =</div>
<div class="line"><span class="lineno">  462</span>        scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#abea7b4b8e4f0cedbf753b26ec30b5331">getOutputProperties</a>()-&gt;<a class="code hl_function" href="class_t_output_properties.html#a9ef174e6f6239219fa563b037246c8d4">getFileFormatProperties</a>(</div>
<div class="line"><span class="lineno">  463</span>            ext);</div>
<div class="line"><span class="lineno">  464</span>    std::string codecName = props-&gt;<a class="code hl_function" href="class_t_property_group.html#afb08f3145e5f77da6f163cdc9decad2f">getProperty</a>(0)-&gt;getValueAsString();</div>
<div class="line"><span class="lineno">  465</span>    <a class="code hl_class" href="class_t_dimension_t.html">TDimension</a> res        = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a750b5ab623ccec744013b0c83bf20abc">getCurrentCamera</a>()-&gt;<a class="code hl_function" href="class_t_camera.html#a9a7c573e7a2c397ffae4b747809ea2a5">getRes</a>();</div>
<div class="line"><span class="lineno">  466</span>    <span class="keywordflow">if</span> (!AviCodecRestrictions::canWriteMovie(::to_wstring(codecName), res)) {</div>
<div class="line"><span class="lineno">  467</span>      QString msg(</div>
<div class="line"><span class="lineno">  468</span>          QObject::tr(<span class="stringliteral">&quot;The resolution of the output camera does not fit with &quot;</span></div>
<div class="line"><span class="lineno">  469</span>                      <span class="stringliteral">&quot;the options chosen for the output file format.&quot;</span>));</div>
<div class="line"><span class="lineno">  470</span>      DVGui::warning(msg);</div>
<div class="line"><span class="lineno">  471</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  472</span>    }</div>
<div class="line"><span class="lineno">  473</span>  }</div>
<div class="line"><span class="lineno">  474</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>  TPixel32 currBgColor = scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#a64ab8a16be2294c8fc135286c45cc2cf">getBgColor</a>();</div>
<div class="line"><span class="lineno">  477</span>  m_priorBgColor       = currBgColor;</div>
<div class="line"><span class="lineno">  478</span>  <span class="comment">// fixes background colors for non alpha-enabled movie types (eventually</span></div>
<div class="line"><span class="lineno">  479</span>  <span class="comment">// transparent gif would be good)</span></div>
<div class="line"><span class="lineno">  480</span>  currBgColor.m = 255;</div>
<div class="line"><span class="lineno">  481</span>  <span class="comment">// Mov may have alpha channel under some settings (Millions of Colors+ color</span></div>
<div class="line"><span class="lineno">  482</span>  <span class="comment">// depth). I tried to make OT to detect the mov settings and adaptively switch</span></div>
<div class="line"><span class="lineno">  483</span>  <span class="comment">// the behavior, but ended in vain :-(</span></div>
<div class="line"><span class="lineno">  484</span>  <span class="comment">// So I just omitted every mov from applying solid background as a quick fix.</span></div>
<div class="line"><span class="lineno">  485</span>  <span class="keywordflow">if</span> (isMovieType(ext) &amp;&amp; ext != <span class="stringliteral">&quot;mov&quot;</span>) {</div>
<div class="line"><span class="lineno">  486</span>    scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#a56b62cc35382ceb147e19df2cf11750d">setBgColor</a>(currBgColor);</div>
<div class="line"><span class="lineno">  487</span>  }</div>
<div class="line"><span class="lineno">  488</span>  <span class="comment">// for non alpha-enabled images (like jpg), background color will be inserted</span></div>
<div class="line"><span class="lineno">  489</span>  <span class="comment">// in  TImageWriter::save() (see timage_io.cpp)</span></div>
<div class="line"><span class="lineno">  490</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  491</span>    TImageWriter::setBackgroundColor(currBgColor);</div>
<div class="line"><span class="lineno">  492</span> </div>
<div class="line"><span class="lineno">  493</span>  <span class="comment">// Extract output properties</span></div>
<div class="line"><span class="lineno">  494</span>  <a class="code hl_class" href="class_t_output_properties.html">TOutputProperties</a> *prop = isPreview</div>
<div class="line"><span class="lineno">  495</span>                                ? scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#a0b905e0ea16e27aa5e67da31e469026e">getPreviewProperties</a>()</div>
<div class="line"><span class="lineno">  496</span>                                : scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#abea7b4b8e4f0cedbf753b26ec30b5331">getOutputProperties</a>();</div>
<div class="line"><span class="lineno">  497</span> </div>
<div class="line"><span class="lineno">  498</span>  <span class="comment">// Build thread count</span></div>
<div class="line"><span class="lineno">  499</span>  <span class="comment">/*-- Dedicated CPUs のコンボボックス (Single, Half, All) --*/</span></div>
<div class="line"><span class="lineno">  500</span>  <span class="keywordtype">int</span> index = prop-&gt;getThreadIndex();</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> procCount       = TSystem::getProcessorCount();</div>
<div class="line"><span class="lineno">  503</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> threadCounts[3] = {1, procCount / 2, procCount};</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>  <span class="keywordtype">int</span> threadCount = threadCounts[index];</div>
<div class="line"><span class="lineno">  506</span> </div>
<div class="line"><span class="lineno">  507</span>  <span class="comment">/*-- MovieRendererを作る。Previewの場合はファイルパスは空 --*/</span></div>
<div class="line"><span class="lineno">  508</span>  <a class="code hl_class" href="class_movie_renderer.html">MovieRenderer</a> movieRenderer(scene, isPreview ? <a class="code hl_class" href="class_t_file_path.html">TFilePath</a>() : m_fp,</div>
<div class="line"><span class="lineno">  509</span>                              threadCount, isPreview);</div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>  <a class="code hl_class" href="class_t_render_settings.html">TRenderSettings</a> rs = prop-&gt;<a class="code hl_function" href="class_t_output_properties.html#afa7c771452b57b50047aa4afc6032cad">getRenderSettings</a>();</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>  <span class="comment">// Build raster granularity size</span></div>
<div class="line"><span class="lineno">  514</span>  index = prop-&gt;getMaxTileSizeIndex();</div>
<div class="line"><span class="lineno">  515</span> </div>
<div class="line"><span class="lineno">  516</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> maxTileSizes[4] = {</div>
<div class="line"><span class="lineno">  517</span>      (std::numeric_limits&lt;int&gt;::max)(), TOutputProperties::LargeVal,</div>
<div class="line"><span class="lineno">  518</span>      TOutputProperties::MediumVal, TOutputProperties::SmallVal};</div>
<div class="line"><span class="lineno">  519</span>  rs.<a class="code hl_variable" href="class_t_render_settings.html#a4b0770f4a243e1f32a60efefebf0e11b">m_maxTileSize</a> = maxTileSizes[index];</div>
<div class="line"><span class="lineno">  520</span> </div>
<div class="line"><span class="lineno">  521</span>  <span class="comment">// Build</span></div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>  <span class="comment">/*-- RenderSettingsをセット --*/</span></div>
<div class="line"><span class="lineno">  524</span>  movieRenderer.setRenderSettings(rs);</div>
<div class="line"><span class="lineno">  525</span>  <span class="comment">/*-- カメラDPIの取得、セット --*/</span></div>
<div class="line"><span class="lineno">  526</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> cameraDpi = isPreview ? scene-&gt;getCurrentPreviewCamera()-&gt;<a class="code hl_function" href="class_t_camera.html#adf45510b5dc53f6481308ef489fbd5a9">getDpi</a>()</div>
<div class="line"><span class="lineno">  527</span>                                : scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a750b5ab623ccec744013b0c83bf20abc">getCurrentCamera</a>()-&gt;<a class="code hl_function" href="class_t_camera.html#adf45510b5dc53f6481308ef489fbd5a9">getDpi</a>();</div>
<div class="line"><span class="lineno">  528</span>  movieRenderer.setDpi(cameraDpi.x, cameraDpi.y);</div>
<div class="line"><span class="lineno">  529</span>  <span class="comment">// Precomputing causes a long delay for ffmpeg imported types</span></div>
<div class="line"><span class="lineno">  530</span>  <span class="keywordflow">if</span> (!isPreview &amp;&amp; !Preferences::instance()-&gt;getPrecompute())</div>
<div class="line"><span class="lineno">  531</span>    movieRenderer.enablePrecomputing(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  532</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  533</span>    movieRenderer.enablePrecomputing(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>  <span class="comment">/*-- プログレス ダイアログの作成 --*/</span></div>
<div class="line"><span class="lineno">  536</span>  <a class="code hl_class" href="class_render_listener.html">RenderListener</a> *listener =</div>
<div class="line"><span class="lineno">  537</span>      <span class="keyword">new</span> <a class="code hl_class" href="class_render_listener.html">RenderListener</a>(movieRenderer.getTRenderer(), m_fp,</div>
<div class="line"><span class="lineno">  538</span>                         ((m_numFrames - 1) / m_step) + 1, isPreview);</div>
<div class="line"><span class="lineno">  539</span>  QObject::connect(listener, SIGNAL(canceled()), &amp;movieRenderer,</div>
<div class="line"><span class="lineno">  540</span>                   SLOT(onCanceled()));</div>
<div class="line"><span class="lineno">  541</span>  movieRenderer.addListener(listener);</div>
<div class="line"><span class="lineno">  542</span> </div>
<div class="line"><span class="lineno">  543</span>  <span class="keywordtype">bool</span> fieldRendering = rs.<a class="code hl_variable" href="class_t_render_settings.html#a48bbcbb6ca2cad3de97f4cabea09cd2f">m_fieldPrevalence</a> != <a class="code hl_enumvalue" href="class_t_render_settings.html#aff548d2c58f7c6adea513ab32526eae8acc9a06de2f74e1ae1404282226d6a2d9">TRenderSettings::NoField</a>;</div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>  <span class="comment">/*-- buildSceneFxの進行状況を表示するプログレスバー --*/</span></div>
<div class="line"><span class="lineno">  546</span>  QProgressBar *buildSceneProgressBar =</div>
<div class="line"><span class="lineno">  547</span>      <span class="keyword">new</span> QProgressBar(<a class="code hl_function" href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a>()-&gt;getMainWindow());</div>
<div class="line"><span class="lineno">  548</span>  buildSceneProgressBar-&gt;setAttribute(Qt::WA_DeleteOnClose);</div>
<div class="line"><span class="lineno">  549</span>  buildSceneProgressBar-&gt;setWindowFlags(Qt::SubWindow | Qt::Dialog);</div>
<div class="line"><span class="lineno">  550</span>  buildSceneProgressBar-&gt;setMinimum(0);</div>
<div class="line"><span class="lineno">  551</span>  buildSceneProgressBar-&gt;setMaximum(m_numFrames - 1);</div>
<div class="line"><span class="lineno">  552</span>  buildSceneProgressBar-&gt;setValue(0);</div>
<div class="line"><span class="lineno">  553</span>  buildSceneProgressBar-&gt;move(600, 500);</div>
<div class="line"><span class="lineno">  554</span>  buildSceneProgressBar-&gt;setWindowTitle(</div>
<div class="line"><span class="lineno">  555</span>      QObject::tr(<span class="stringliteral">&quot;Building Schematic...&quot;</span>, <span class="stringliteral">&quot;RenderCommand&quot;</span>));</div>
<div class="line"><span class="lineno">  556</span>  buildSceneProgressBar-&gt;show();</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_numFrames; ++i, m_r += m_stepd) {</div>
<div class="line"><span class="lineno">  559</span>    buildSceneProgressBar-&gt;setValue(i);</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>    <span class="keywordflow">if</span> (rs.<a class="code hl_variable" href="class_t_render_settings.html#aadbd5a3a50b242b366a93023d5f7da07">m_stereoscopic</a>) scene-&gt;shiftCameraX(-rs.<a class="code hl_variable" href="class_t_render_settings.html#a8c9cade2391a50017b4ad623f653c82f">m_stereoscopicShift</a> / 2);</div>
<div class="line"><span class="lineno">  562</span>    <a class="code hl_class" href="class_t_fx_pair.html">TFxPair</a> fx;</div>
<div class="line"><span class="lineno">  563</span>    fx.m_frameA = buildSceneFx(scene, m_r, rs.<a class="code hl_variable" href="class_t_render_settings.html#a52dd41881bbf6aaf953fe300be2e233e">m_shrinkX</a>, isPreview);</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>    <span class="keywordflow">if</span> (fieldRendering &amp;&amp; !isPreview)</div>
<div class="line"><span class="lineno">  566</span>      fx.m_frameB = buildSceneFx(scene, m_r + 0.5 / m_timeStretchFactor,</div>
<div class="line"><span class="lineno">  567</span>                                 rs.<a class="code hl_variable" href="class_t_render_settings.html#a52dd41881bbf6aaf953fe300be2e233e">m_shrinkX</a>, isPreview);</div>
<div class="line"><span class="lineno">  568</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rs.<a class="code hl_variable" href="class_t_render_settings.html#aadbd5a3a50b242b366a93023d5f7da07">m_stereoscopic</a>) {</div>
<div class="line"><span class="lineno">  569</span>      scene-&gt;shiftCameraX(rs.<a class="code hl_variable" href="class_t_render_settings.html#a8c9cade2391a50017b4ad623f653c82f">m_stereoscopicShift</a>);</div>
<div class="line"><span class="lineno">  570</span>      fx.m_frameB = buildSceneFx(scene, m_r + 0.5 / m_timeStretchFactor,</div>
<div class="line"><span class="lineno">  571</span>                                 rs.<a class="code hl_variable" href="class_t_render_settings.html#a52dd41881bbf6aaf953fe300be2e233e">m_shrinkX</a>, isPreview);</div>
<div class="line"><span class="lineno">  572</span>      scene-&gt;shiftCameraX(-rs.<a class="code hl_variable" href="class_t_render_settings.html#a8c9cade2391a50017b4ad623f653c82f">m_stereoscopicShift</a> / 2);</div>
<div class="line"><span class="lineno">  573</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  574</span>      fx.m_frameB = <a class="code hl_class" href="class_t_raster_fx_p.html">TRasterFxP</a>();</div>
<div class="line"><span class="lineno">  575</span>    <span class="comment">/*-- movieRendererにフレーム毎のFxを登録 --*/</span></div>
<div class="line"><span class="lineno">  576</span>    movieRenderer.addFrame(m_r, fx);</div>
<div class="line"><span class="lineno">  577</span>  }</div>
<div class="line"><span class="lineno">  578</span>  <span class="comment">/*-- プログレスバーを閉じる --*/</span></div>
<div class="line"><span class="lineno">  579</span>  buildSceneProgressBar-&gt;close();</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>  <span class="comment">// resetViewer(); //TODO cancella le immagini dell&#39;eventuale render precedente</span></div>
<div class="line"><span class="lineno">  582</span>  <span class="comment">// FileViewerPopupPool::instance()-&gt;getCurrent()-&gt;onClose();</span></div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>  movieRenderer.start();</div>
<div class="line"><span class="lineno">  585</span>}</div>
<div class="ttc" id="aclass_movie_renderer_html"><div class="ttname"><a href="class_movie_renderer.html">MovieRenderer</a></div><div class="ttdef"><b>Definition:</b> movierenderer.h:42</div></div>
<div class="ttc" id="aclass_preview_fx_manager_html_a540923ef1e799396ddf8bba11bb3c8c6"><div class="ttname"><a href="class_preview_fx_manager.html#a540923ef1e799396ddf8bba11bb3c8c6">PreviewFxManager::instance</a></div><div class="ttdeci">static PreviewFxManager * instance()</div><div class="ttdoc">Returns the instance of the PreviewFxManager object.</div><div class="ttdef"><b>Definition:</b> previewfxmanager.cpp:1219</div></div>
<div class="ttc" id="aclass_preview_fx_manager_html_a5a633f9f858d2ea0e6ccee709d495b74"><div class="ttname"><a href="class_preview_fx_manager.html#a5a633f9f858d2ea0e6ccee709d495b74">PreviewFxManager::showNewPreview</a></div><div class="ttdeci">FlipBook * showNewPreview(TFxP fx, bool forceFlipbook=false)</div><div class="ttdef"><b>Definition:</b> previewfxmanager.cpp:1226</div></div>
<div class="ttc" id="aclass_render_listener_html"><div class="ttname"><a href="class_render_listener.html">RenderListener</a></div><div class="ttdef"><b>Definition:</b> rendercommand.cpp:348</div></div>
<div class="ttc" id="aclass_t_fx_html"><div class="ttname"><a href="class_t_fx.html">TFx</a></div><div class="ttdef"><b>Definition:</b> tfx.h:352</div></div>
<div class="ttc" id="aclass_t_fx_pair_html"><div class="ttname"><a href="class_t_fx_pair.html">TFxPair</a></div><div class="ttdef"><b>Definition:</b> trenderer.h:31</div></div>
<div class="ttc" id="aclass_t_raster_fx_p_html"><div class="ttname"><a href="class_t_raster_fx_p.html">TRasterFxP</a></div><div class="ttdef"><b>Definition:</b> trasterfx.h:317</div></div>
<div class="ttc" id="aclass_t_render_settings_html_a48bbcbb6ca2cad3de97f4cabea09cd2f"><div class="ttname"><a href="class_t_render_settings.html#a48bbcbb6ca2cad3de97f4cabea09cd2f">TRenderSettings::m_fieldPrevalence</a></div><div class="ttdeci">FieldPrevalence m_fieldPrevalence</div><div class="ttdoc">Field prevalence of the required frame.</div><div class="ttdef"><b>Definition:</b> trasterfx.h:131</div></div>
<div class="ttc" id="aclass_t_render_settings_html_a52dd41881bbf6aaf953fe300be2e233e"><div class="ttname"><a href="class_t_render_settings.html#a52dd41881bbf6aaf953fe300be2e233e">TRenderSettings::m_shrinkX</a></div><div class="ttdeci">int m_shrinkX</div><div class="ttdef"><b>Definition:</b> trasterfx.h:125</div></div>
<div class="ttc" id="aclass_t_render_settings_html_a8c9cade2391a50017b4ad623f653c82f"><div class="ttname"><a href="class_t_render_settings.html#a8c9cade2391a50017b4ad623f653c82f">TRenderSettings::m_stereoscopicShift</a></div><div class="ttdeci">double m_stereoscopicShift</div><div class="ttdef"><b>Definition:</b> trasterfx.h:112</div></div>
<div class="ttc" id="aclass_t_render_settings_html_aadbd5a3a50b242b366a93023d5f7da07"><div class="ttname"><a href="class_t_render_settings.html#aadbd5a3a50b242b366a93023d5f7da07">TRenderSettings::m_stereoscopic</a></div><div class="ttdeci">bool m_stereoscopic</div><div class="ttdef"><b>Definition:</b> trasterfx.h:133</div></div>
<div class="ttc" id="aclass_t_render_settings_html_aff548d2c58f7c6adea513ab32526eae8acc9a06de2f74e1ae1404282226d6a2d9"><div class="ttname"><a href="class_t_render_settings.html#aff548d2c58f7c6adea513ab32526eae8acc9a06de2f74e1ae1404282226d6a2d9">TRenderSettings::NoField</a></div><div class="ttdeci">@ NoField</div><div class="ttdoc">Common rendering.</div><div class="ttdef"><b>Definition:</b> trasterfx.h:89</div></div>
<div class="ttc" id="aclass_t_scene_properties_html_a56b62cc35382ceb147e19df2cf11750d"><div class="ttname"><a href="class_t_scene_properties.html#a56b62cc35382ceb147e19df2cf11750d">TSceneProperties::setBgColor</a></div><div class="ttdeci">void setBgColor(const TPixel32 &amp;color)</div><div class="ttdef"><b>Definition:</b> sceneproperties.cpp:138</div></div>
<div class="ttc" id="aclass_t_scene_properties_html_a64ab8a16be2294c8fc135286c45cc2cf"><div class="ttname"><a href="class_t_scene_properties.html#a64ab8a16be2294c8fc135286c45cc2cf">TSceneProperties::getBgColor</a></div><div class="ttdeci">TPixel getBgColor() const</div><div class="ttdef"><b>Definition:</b> sceneproperties.h:189</div></div>
<div class="ttc" id="aclass_t_xsheet_html_adc7c74cce346abf3699bb250eb17a9c2"><div class="ttname"><a href="class_t_xsheet.html#adc7c74cce346abf3699bb250eb17a9c2">TXsheet::getFxDag</a></div><div class="ttdeci">FxDag * getFxDag() const</div><div class="ttdef"><b>Definition:</b> txsheet.cpp:1564</div></div>
<div class="ttc" id="aclass_toonz_scene_html_ae3c828e3223fd809fd59189233d0576a"><div class="ttname"><a href="class_toonz_scene.html#ae3c828e3223fd809fd59189233d0576a">ToonzScene::getXsheet</a></div><div class="ttdeci">TXsheet * getXsheet() const</div><div class="ttdoc">Returns a pointer to the scene's current xsheet.</div><div class="ttdef"><b>Definition:</b> toonzscene.cpp:957</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a42ced7d7bb157404ca185c5ce412b3f4" name="a42ced7d7bb157404ca185c5ce412b3f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42ced7d7bb157404ca185c5ce412b3f4">&#9670;&nbsp;</a></span>resetBgColor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void RenderCommand::resetBgColor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  589</span>                                 {</div>
<div class="line"><span class="lineno">  590</span>  <a class="code hl_class" href="class_toonz_scene.html">ToonzScene</a> *scene = <a class="code hl_function" href="class_t_app.html#a24088f8647d5d9447fcec6b9b9bbf9eb">TApp::instance</a>()-&gt;<a class="code hl_function" href="class_t_app.html#abbbf1fae564e9e510826eda4f6637d20">getCurrentScene</a>()-&gt;getScene();</div>
<div class="line"><span class="lineno">  591</span>  scene-&gt;<a class="code hl_function" href="class_toonz_scene.html#a8ef96fedc17d7def810ac419b0939254">getProperties</a>()-&gt;<a class="code hl_function" href="class_t_scene_properties.html#a56b62cc35382ceb147e19df2cf11750d">setBgColor</a>(m_priorBgColor);</div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>  <span class="comment">// revert background color settings</span></div>
<div class="line"><span class="lineno">  594</span>  TImageWriter::setBackgroundColor(</div>
<div class="line"><span class="lineno">  595</span>      Preferences::instance()-&gt;getRasterBackgroundColor());</div>
<div class="line"><span class="lineno">  596</span>}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>E:/opentoonz/toonz/sources/toonz/<a class="el" href="">rendercommand.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
