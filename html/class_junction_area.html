<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: JunctionArea Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="class_junction_area-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">JunctionArea Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aedbe43fafac38c429a9f791a2ab0752c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#aedbe43fafac38c429a9f791a2ab0752c">expandArea</a> (unsigned int initial)</td></tr>
<tr class="separator:aedbe43fafac38c429a9f791a2ab0752c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a569fd3969f5d6cdbc617f6f614424bbe"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#a569fd3969f5d6cdbc617f6f614424bbe">checkShape</a> ()</td></tr>
<tr class="separator:a569fd3969f5d6cdbc617f6f614424bbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c785e55a400cd7fc0568c722d44b8fd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#a2c785e55a400cd7fc0568c722d44b8fd">solveJunctionPosition</a> ()</td></tr>
<tr class="separator:a2c785e55a400cd7fc0568c722d44b8fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdfc1853619e50172bd2387dd2f1d941"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#acdfc1853619e50172bd2387dd2f1d941">makeHeights</a> ()</td></tr>
<tr class="separator:acdfc1853619e50172bd2387dd2f1d941"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab553dbae07dc4858b213df4891b8fce9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#ab553dbae07dc4858b213df4891b8fce9">calculateReconstruction</a> ()</td></tr>
<tr class="separator:ab553dbae07dc4858b213df4891b8fce9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78527861db5c74e9ef78fd31d8098c4c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#a78527861db5c74e9ef78fd31d8098c4c">sequencesPullBack</a> ()</td></tr>
<tr class="separator:a78527861db5c74e9ef78fd31d8098c4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5c035689a23a026fde856c952d62366"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#ab5c035689a23a026fde856c952d62366">apply</a> ()</td></tr>
<tr class="separator:ab5c035689a23a026fde856c952d62366"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:acd27f171593baa7ac33e1dde79b1fc1e"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_entering_sequence.html">EnteringSequence</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#acd27f171593baa7ac33e1dde79b1fc1e">m_enteringSequences</a></td></tr>
<tr class="separator:acd27f171593baa7ac33e1dde79b1fc1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e13501653143b2822f4356862a72048"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#a2e13501653143b2822f4356862a72048">m_jointsAbsorbed</a></td></tr>
<tr class="separator:a2e13501653143b2822f4356862a72048"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26981f954c2703efd6cb63b4e6009434"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_point_t.html">TPointD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_junction_area.html#a26981f954c2703efd6cb63b4e6009434">m_newJointPosition</a></td></tr>
<tr class="separator:a26981f954c2703efd6cb63b4e6009434"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"></div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3ceaa28114e113c45dc551e0b5e045e9" name="a3ceaa28114e113c45dc551e0b5e045e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ceaa28114e113c45dc551e0b5e045e9">&#9670;&nbsp;</a></span>JunctionArea()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">JunctionArea::JunctionArea </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  315</span>{}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab5c035689a23a026fde856c952d62366" name="ab5c035689a23a026fde856c952d62366"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5c035689a23a026fde856c952d62366">&#9670;&nbsp;</a></span>apply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JunctionArea::apply </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  843</span>                         {</div>
<div class="line"><span class="lineno">  844</span>  std::vector&lt;EnteringSequence&gt;::iterator a;</div>
<div class="line"><span class="lineno">  845</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newJoint, newSkeletonNode;</div>
<div class="line"><span class="lineno">  846</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> head, headLink, tail, tailLink;</div>
<div class="line"><span class="lineno">  847</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> outerJoint, outerLink;</div>
<div class="line"><span class="lineno">  848</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, next, nextLink;</div>
<div class="line"><span class="lineno">  849</span> </div>
<div class="line"><span class="lineno">  850</span>  <span class="comment">// First, check if Entering Sequences pullback is possible</span></div>
<div class="line"><span class="lineno">  851</span>  <span class="keywordflow">if</span> (!sequencesPullBack()) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  852</span> </div>
<div class="line"><span class="lineno">  853</span>  <span class="comment">// Then, we can substitute the old configuration</span></div>
<div class="line"><span class="lineno">  854</span>  <span class="comment">// First, sign as &#39;ELIMINATED&#39; all absorbed joints</span></div>
<div class="line"><span class="lineno">  855</span>  <span class="keywordflow">for</span> (i = 0; i &lt; m_jointsAbsorbed.size(); ++i)</div>
<div class="line"><span class="lineno">  856</span>    currJSGraph-&gt;node(m_jointsAbsorbed[i])</div>
<div class="line"><span class="lineno">  857</span>        .setAttribute(JointSequenceGraph::ELIMINATED);</div>
<div class="line"><span class="lineno">  858</span> </div>
<div class="line"><span class="lineno">  859</span>  newJoint = currJSGraph-&gt;newNode();</div>
<div class="line"><span class="lineno">  860</span> </div>
<div class="line"><span class="lineno">  861</span>  <span class="keywordflow">for</span> (a = m_enteringSequences.begin(); a != m_enteringSequences.end(); ++a) {</div>
<div class="line"><span class="lineno">  862</span>    <span class="comment">// Initialize infos</span></div>
<div class="line"><span class="lineno">  863</span>    newSkeletonNode =</div>
<div class="line"><span class="lineno">  864</span>        a-&gt;m_graphHolder-&gt;newNode(<a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a>(m_newJointPosition, a-&gt;m_height));</div>
<div class="line"><span class="lineno">  865</span> </div>
<div class="line"><span class="lineno">  866</span>    <span class="comment">// Retrieve sequence infos to substitute</span></div>
<div class="line"><span class="lineno">  867</span>    <span class="comment">// NOTE: We update *tail* infos in currJSGraph sequences after each &quot;apply&quot;</span></div>
<div class="line"><span class="lineno">  868</span> </div>
<div class="line"><span class="lineno">  869</span>    <span class="keyword">const</span> <a class="code hl_class" href="class_graph_1_1_link.html">JointSequenceGraph::Link</a> &amp;tempLink =</div>
<div class="line"><span class="lineno">  870</span>        currJSGraph-&gt;getNode(a-&gt;m_initialJoint).getLink(a-&gt;m_outerLink);</div>
<div class="line"><span class="lineno">  871</span> </div>
<div class="line"><span class="lineno">  872</span>    head     = tempLink-&gt;m_head;</div>
<div class="line"><span class="lineno">  873</span>    headLink = tempLink-&gt;m_headLink;</div>
<div class="line"><span class="lineno">  874</span>    tail     = tempLink-&gt;m_tail;</div>
<div class="line"><span class="lineno">  875</span>    tailLink = tempLink-&gt;m_tailLink;</div>
<div class="line"><span class="lineno">  876</span> </div>
<div class="line"><span class="lineno">  877</span>    outerJoint = tempLink.getNext();</div>
<div class="line"><span class="lineno">  878</span> </div>
<div class="line"><span class="lineno">  879</span>    <span class="comment">// Find outerLink - from outerJoint to a-&gt;m_initialJoint</span></div>
<div class="line"><span class="lineno">  880</span>    <span class="keywordflow">for</span> (i = 0;</div>
<div class="line"><span class="lineno">  881</span>         (currJSGraph-&gt;getNode(outerJoint).getLink(i)-&gt;m_tail != head) ||</div>
<div class="line"><span class="lineno">  882</span>         (currJSGraph-&gt;getNode(outerJoint).getLink(i)-&gt;m_tailLink != headLink);</div>
<div class="line"><span class="lineno">  883</span>         ++i)</div>
<div class="line"><span class="lineno">  884</span>      ;</div>
<div class="line"><span class="lineno">  885</span>    outerLink = i;</div>
<div class="line"><span class="lineno">  886</span> </div>
<div class="line"><span class="lineno">  887</span>    <span class="comment">// Now, provide skeleton linkages</span></div>
<div class="line"><span class="lineno">  888</span>    <span class="comment">// NOTE: Discriminate between the following cases</span></div>
<div class="line"><span class="lineno">  889</span>    <span class="comment">// a) m_head-&gt;degree == 2</span></div>
<div class="line"><span class="lineno">  890</span>    <span class="comment">// b) m_head == m_tail</span></div>
<div class="line"><span class="lineno">  891</span>    <span class="comment">// c) m_head == original m_head - or, (m_head!=m_tail &amp;&amp; m_head-&gt;deg&gt;2)</span></div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>    <span class="keywordflow">if</span> (a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head).degree() == 2) {</div>
<div class="line"><span class="lineno">  894</span>      a-&gt;m_graphHolder-&gt;newLink(newSkeletonNode, a-&gt;m_head);</div>
<div class="line"><span class="lineno">  895</span> </div>
<div class="line"><span class="lineno">  896</span>      a-&gt;m_graphHolder-&gt;node(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  897</span>          .link(!a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  898</span>          .setNext(newSkeletonNode);</div>
<div class="line"><span class="lineno">  899</span>      a-&gt;m_graphHolder-&gt;node(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  900</span>          .link(!a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  901</span>          -&gt;setAttribute(SkeletonArc::ROAD);</div>
<div class="line"><span class="lineno">  902</span>      <span class="comment">// Better clear road attribute or set it?</span></div>
<div class="line"><span class="lineno">  903</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;m_head == tail) {</div>
<div class="line"><span class="lineno">  904</span>      a-&gt;m_graphHolder-&gt;newLink(newSkeletonNode, tail);</div>
<div class="line"><span class="lineno">  905</span> </div>
<div class="line"><span class="lineno">  906</span>      a-&gt;m_graphHolder-&gt;node(tail).link(tailLink).setNext(newSkeletonNode);</div>
<div class="line"><span class="lineno">  907</span>      a-&gt;m_graphHolder-&gt;node(tail).link(tailLink)-&gt;setAttribute(</div>
<div class="line"><span class="lineno">  908</span>          SkeletonArc::ROAD);</div>
<div class="line"><span class="lineno">  909</span>    } <span class="keywordflow">else</span>  <span class="comment">//(a-&gt;m_head == head)</span></div>
<div class="line"><span class="lineno">  910</span>    {</div>
<div class="line"><span class="lineno">  911</span>      <span class="comment">// In this case, better introduce further a new substitute of head</span></div>
<div class="line"><span class="lineno">  912</span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newHead = a-&gt;m_graphHolder-&gt;newNode(</div>
<div class="line"><span class="lineno">  913</span>          <a class="code hl_class" href="class_t3_d_point_t.html">T3DPointD</a>(*a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head)));</div>
<div class="line"><span class="lineno">  914</span> </div>
<div class="line"><span class="lineno">  915</span>      a-&gt;m_graphHolder-&gt;newLink(newSkeletonNode, newHead);</div>
<div class="line"><span class="lineno">  916</span>      a-&gt;m_graphHolder-&gt;newLink(newHead, newSkeletonNode);</div>
<div class="line"><span class="lineno">  917</span> </div>
<div class="line"><span class="lineno">  918</span>      <span class="comment">// Link newHead on the other side</span></div>
<div class="line"><span class="lineno">  919</span>      next     = a-&gt;m_graphHolder-&gt;getNode(head).getLink(headLink).getNext();</div>
<div class="line"><span class="lineno">  920</span>      nextLink = a-&gt;m_graphHolder-&gt;getNode(next).linkOfNode(head);</div>
<div class="line"><span class="lineno">  921</span> </div>
<div class="line"><span class="lineno">  922</span>      a-&gt;m_graphHolder-&gt;newLink(newHead, next);</div>
<div class="line"><span class="lineno">  923</span>      a-&gt;m_graphHolder-&gt;node(next).link(nextLink).setNext(newHead);</div>
<div class="line"><span class="lineno">  924</span>    }</div>
<div class="line"><span class="lineno">  925</span> </div>
<div class="line"><span class="lineno">  926</span>    <span class="comment">// Finally, update joint linkings and sequence tails.</span></div>
<div class="line"><span class="lineno">  927</span>    <a class="code hl_class" href="class_sequence.html">Sequence</a> newSequence;</div>
<div class="line"><span class="lineno">  928</span> </div>
<div class="line"><span class="lineno">  929</span>    newSequence.m_graphHolder = a-&gt;m_graphHolder;</div>
<div class="line"><span class="lineno">  930</span>    newSequence.m_head        = newSkeletonNode;</div>
<div class="line"><span class="lineno">  931</span>    newSequence.m_headLink    = 0;</div>
<div class="line"><span class="lineno">  932</span>    newSequence.m_tail        = tail;</div>
<div class="line"><span class="lineno">  933</span>    newSequence.m_tailLink    = tailLink;</div>
<div class="line"><span class="lineno">  934</span> </div>
<div class="line"><span class="lineno">  935</span>    currJSGraph-&gt;node(outerJoint).link(outerLink).setNext(newJoint);</div>
<div class="line"><span class="lineno">  936</span>    currJSGraph-&gt;node(outerJoint).link(outerLink)-&gt;m_tail     = newSkeletonNode;</div>
<div class="line"><span class="lineno">  937</span>    currJSGraph-&gt;node(outerJoint).link(outerLink)-&gt;m_tailLink = 0;</div>
<div class="line"><span class="lineno">  938</span> </div>
<div class="line"><span class="lineno">  939</span>    currJSGraph-&gt;newLink(newJoint, outerJoint, newSequence);</div>
<div class="line"><span class="lineno">  940</span>  }</div>
<div class="line"><span class="lineno">  941</span>}</div>
<div class="ttc" id="aclass_graph_1_1_link_html"><div class="ttname"><a href="class_graph_1_1_link.html">Graph::Link</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectP.h:124</div></div>
<div class="ttc" id="aclass_sequence_html"><div class="ttname"><a href="class_sequence.html">Sequence</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectP.h:389</div></div>
<div class="ttc" id="aclass_t3_d_point_t_html"><div class="ttname"><a href="class_t3_d_point_t.html">T3DPointT&lt; double &gt;</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab553dbae07dc4858b213df4891b8fce9" name="ab553dbae07dc4858b213df4891b8fce9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab553dbae07dc4858b213df4891b8fce9">&#9670;&nbsp;</a></span>calculateReconstruction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool JunctionArea::calculateReconstruction </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  746</span>                                           {</div>
<div class="line"><span class="lineno">  747</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  748</span> </div>
<div class="line"><span class="lineno">  749</span>  <span class="keywordflow">if</span> (m_enteringSequences.size() == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  750</span> </div>
<div class="line"><span class="lineno">  751</span>  <span class="comment">// Apply preliminary tests for this Junction Area</span></div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>  <span class="comment">// a) Check if endpoints got absorbed by the expansion process</span></div>
<div class="line"><span class="lineno">  754</span>  <span class="keywordflow">for</span> (i = 0; i &lt; m_jointsAbsorbed.size(); ++i)</div>
<div class="line"><span class="lineno">  755</span>    <span class="keywordflow">if</span> (currJSGraph-&gt;getNode(m_jointsAbsorbed[i]).degree() == 1) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  756</span> </div>
<div class="line"><span class="lineno">  757</span>  <span class="comment">// b) Check if the contours shape resembles that of a crossing</span></div>
<div class="line"><span class="lineno">  758</span> </div>
<div class="line"><span class="lineno">  759</span>  sort(m_enteringSequences.begin(), m_enteringSequences.end(),</div>
<div class="line"><span class="lineno">  760</span>       <a class="code hl_class" href="class_ent_sequence_less.html">EntSequenceLess</a>());</div>
<div class="line"><span class="lineno">  761</span> </div>
<div class="line"><span class="lineno">  762</span>  <span class="keywordflow">if</span> (!checkShape()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  763</span> </div>
<div class="line"><span class="lineno">  764</span>  <span class="comment">// c) Build the new junction Point plane position</span></div>
<div class="line"><span class="lineno">  765</span>  <span class="keywordflow">if</span> (!solveJunctionPosition()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  766</span> </div>
<div class="line"><span class="lineno">  767</span>  <span class="comment">// d) Build joint optimal heights (each for entering sequence...)</span></div>
<div class="line"><span class="lineno">  768</span>  <span class="keywordflow">if</span> (!makeHeights()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  771</span>}</div>
<div class="ttc" id="aclass_ent_sequence_less_html"><div class="ttname"><a href="class_ent_sequence_less.html">EntSequenceLess</a></div><div class="ttdef"><b>Definition:</b> tcenterlineadjustments.cpp:732</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a569fd3969f5d6cdbc617f6f614424bbe" name="a569fd3969f5d6cdbc617f6f614424bbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a569fd3969f5d6cdbc617f6f614424bbe">&#9670;&nbsp;</a></span>checkShape()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool JunctionArea::checkShape </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  410</span>                                     {</div>
<div class="line"><span class="lineno">  411</span>  std::vector&lt;EnteringSequence&gt;::iterator a, b;</div>
<div class="line"><span class="lineno">  412</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node, contour, first, last, n;</div>
<div class="line"><span class="lineno">  413</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> A, A1, B, B1, P, P1;</div>
<div class="line"><span class="lineno">  414</span>  <span class="keywordtype">bool</span> result = 1;</div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>  <span class="comment">// First, sign all outgoing arcs&#39; m_leftGeneratingNode as end of</span></div>
<div class="line"><span class="lineno">  417</span>  <span class="comment">// control procedure</span></div>
<div class="line"><span class="lineno">  418</span>  <span class="keywordflow">for</span> (a = m_enteringSequences.begin(); a != m_enteringSequences.end(); ++a) {</div>
<div class="line"><span class="lineno">  419</span>    node = a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  420</span>               .getLink(a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  421</span>               -&gt;getLeftGenerator();</div>
<div class="line"><span class="lineno">  422</span>    contour = a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  423</span>                  .getLink(a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  424</span>                  -&gt;getLeftContour();</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    (*currContourFamily)[contour][node].setAttribute(<a class="code hl_enumvalue" href="class_contour_node.html#a7a113f0a25502174a87d6880481bd93ea8de7fd01c4a177059180266e06358cd1">ContourNode::JR_RESERVED</a>);</div>
<div class="line"><span class="lineno">  427</span>  }</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>  <span class="comment">// Now, check shape</span></div>
<div class="line"><span class="lineno">  430</span>  <span class="keywordflow">for</span> (a = m_enteringSequences.begin(), b = m_enteringSequences.end() - 1;</div>
<div class="line"><span class="lineno">  431</span>       a != m_enteringSequences.end(); b = a, ++a) {</div>
<div class="line"><span class="lineno">  432</span>    <span class="comment">// Initialize contour check</span></div>
<div class="line"><span class="lineno">  433</span>    first = a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  434</span>                .getLink(a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  435</span>                -&gt;getRightGenerator();</div>
<div class="line"><span class="lineno">  436</span>    <span class="comment">// last= b-&gt;m_graphHolder-&gt;getNode(b-&gt;m_head).getLink(b-&gt;m_headLink)</span></div>
<div class="line"><span class="lineno">  437</span>    <span class="comment">//  -&gt;getLeftGenerator();</span></div>
<div class="line"><span class="lineno">  438</span>    contour = a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  439</span>                  .getLink(a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  440</span>                  -&gt;getRightContour();</div>
<div class="line"><span class="lineno">  441</span>    n = (*currContourFamily)[contour].size();</div>
<div class="line"><span class="lineno">  442</span> </div>
<div class="line"><span class="lineno">  443</span>    <span class="comment">// Better this effective way to find the last</span></div>
<div class="line"><span class="lineno">  444</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numChecked = 0;</div>
<div class="line"><span class="lineno">  445</span>    <span class="keywordflow">for</span> (last = first; !(*currContourFamily)[contour][last].hasAttribute(</div>
<div class="line"><span class="lineno">  446</span>                           <a class="code hl_enumvalue" href="class_contour_node.html#a7a113f0a25502174a87d6880481bd93ea8de7fd01c4a177059180266e06358cd1">ContourNode::JR_RESERVED</a>) &amp;&amp;</div>
<div class="line"><span class="lineno">  447</span>                       numChecked &lt; n;</div>
<div class="line"><span class="lineno">  448</span>         last = (last + 1) % n, ++numChecked)</div>
<div class="line"><span class="lineno">  449</span>      ;</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>    <span class="comment">// Security check</span></div>
<div class="line"><span class="lineno">  452</span>    <span class="keywordflow">if</span> (numChecked == n) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>    A  = planeProjection((*currContourFamily)[contour][first].m_position);</div>
<div class="line"><span class="lineno">  455</span>    A1 = planeProjection(</div>
<div class="line"><span class="lineno">  456</span>        (*currContourFamily)[contour][(first + 1) % n].m_position);</div>
<div class="line"><span class="lineno">  457</span>    B  = planeProjection((*currContourFamily)[contour][last].m_position);</div>
<div class="line"><span class="lineno">  458</span>    B1 = planeProjection(</div>
<div class="line"><span class="lineno">  459</span>        (*currContourFamily)[contour][(last + 1) % n].m_position);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">for</span> (node = first; !(*currContourFamily)[contour][node].hasAttribute(</div>
<div class="line"><span class="lineno">  462</span>             <a class="code hl_enumvalue" href="class_contour_node.html#a7a113f0a25502174a87d6880481bd93ea8de7fd01c4a177059180266e06358cd1">ContourNode::JR_RESERVED</a>);</div>
<div class="line"><span class="lineno">  463</span>         node = (node + 1) % n) {</div>
<div class="line"><span class="lineno">  464</span>      P  = planeProjection((*currContourFamily)[contour][node].m_position);</div>
<div class="line"><span class="lineno">  465</span>      P1 = planeProjection(</div>
<div class="line"><span class="lineno">  466</span>          (*currContourFamily)[contour][(node + 1) % n].m_position);</div>
<div class="line"><span class="lineno">  467</span> </div>
<div class="line"><span class="lineno">  468</span>      <span class="comment">// EXPLANATION:</span></div>
<div class="line"><span class="lineno">  469</span>      <span class="comment">// Segment P-P1  must be included in fat lines passing for A-A1 or B-B1</span></div>
<div class="line"><span class="lineno">  470</span>      result &amp;=</div>
<div class="line"><span class="lineno">  471</span>          (fabs(cross(P - A, normalize(A1 - A))) &lt; a-&gt;m_height * shapeDistMul &amp;&amp;</div>
<div class="line"><span class="lineno">  472</span>           fabs(cross(P1 - A, normalize(A1 - A))) &lt; a-&gt;m_height * shapeDistMul)</div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>          ||</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>          (fabs(cross(P - B, normalize(B1 - B))) &lt; b-&gt;m_height * shapeDistMul &amp;&amp;</div>
<div class="line"><span class="lineno">  477</span>           fabs(cross(P1 - B, normalize(B1 - B))) &lt; b-&gt;m_height * shapeDistMul);</div>
<div class="line"><span class="lineno">  478</span>    }</div>
<div class="line"><span class="lineno">  479</span>  }</div>
<div class="line"><span class="lineno">  480</span> </div>
<div class="line"><span class="lineno">  481</span>  <span class="comment">// Finally, restore nodes attributes</span></div>
<div class="line"><span class="lineno">  482</span>  <span class="keywordflow">for</span> (a = m_enteringSequences.begin(); a != m_enteringSequences.end(); ++a) {</div>
<div class="line"><span class="lineno">  483</span>    node = a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  484</span>               .getLink(a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  485</span>               -&gt;getLeftGenerator();</div>
<div class="line"><span class="lineno">  486</span>    contour = a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head)</div>
<div class="line"><span class="lineno">  487</span>                  .getLink(a-&gt;m_headLink)</div>
<div class="line"><span class="lineno">  488</span>                  -&gt;getLeftContour();</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>    (*currContourFamily)[contour][node].clearAttribute(</div>
<div class="line"><span class="lineno">  491</span>        <a class="code hl_enumvalue" href="class_contour_node.html#a7a113f0a25502174a87d6880481bd93ea8de7fd01c4a177059180266e06358cd1">ContourNode::JR_RESERVED</a>);</div>
<div class="line"><span class="lineno">  492</span>  }</div>
<div class="line"><span class="lineno">  493</span> </div>
<div class="line"><span class="lineno">  494</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  495</span>}</div>
<div class="ttc" id="aclass_contour_node_html_a7a113f0a25502174a87d6880481bd93ea8de7fd01c4a177059180266e06358cd1"><div class="ttname"><a href="class_contour_node.html#a7a113f0a25502174a87d6880481bd93ea8de7fd01c4a177059180266e06358cd1">ContourNode::JR_RESERVED</a></div><div class="ttdeci">@ JR_RESERVED</div><div class="ttdoc">Reserved for joints recovery.</div><div class="ttdef"><b>Definition:</b> tcenterlinevectP.h:276</div></div>
<div class="ttc" id="aclass_t_point_t_html"><div class="ttname"><a href="class_t_point_t.html">TPointT&lt; double &gt;</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aedbe43fafac38c429a9f791a2ab0752c" name="aedbe43fafac38c429a9f791a2ab0752c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedbe43fafac38c429a9f791a2ab0752c">&#9670;&nbsp;</a></span>expandArea()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void JunctionArea::expandArea </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>initial</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  338</span>                                                         {</div>
<div class="line"><span class="lineno">  339</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a;</div>
<div class="line"><span class="lineno">  340</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> curr, currLink;</div>
<div class="line"><span class="lineno">  341</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, iLink, iNext;</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>  m_jointsAbsorbed.push_back(initial);</div>
<div class="line"><span class="lineno">  344</span>  currJSGraph-&gt;node(initial).setAttribute(</div>
<div class="line"><span class="lineno">  345</span>      JointSequenceGraph::REACHED);  <span class="comment">// Nodes absorbed gets signed</span></div>
<div class="line"><span class="lineno">  346</span> </div>
<div class="line"><span class="lineno">  347</span>  <span class="keywordflow">for</span> (a = 0; a &lt; m_jointsAbsorbed.size(); ++a) {</div>
<div class="line"><span class="lineno">  348</span>    <span class="comment">// Extract a joint from vector</span></div>
<div class="line"><span class="lineno">  349</span>    curr = m_jointsAbsorbed[a];</div>
<div class="line"><span class="lineno">  350</span> </div>
<div class="line"><span class="lineno">  351</span>    <span class="keywordflow">for</span> (currLink = 0; currLink &lt; currJSGraph-&gt;getNode(curr).getLinksCount();</div>
<div class="line"><span class="lineno">  352</span>         ++currLink) {</div>
<div class="line"><span class="lineno">  353</span>      <a class="code hl_class" href="class_sequence.html">Sequence</a> &amp;s = *currJSGraph-&gt;node(curr).link(currLink);</div>
<div class="line"><span class="lineno">  354</span>      <span class="keywordflow">if</span> (s.m_graphHolder-&gt;getNode(s.m_head)</div>
<div class="line"><span class="lineno">  355</span>              .getLink(s.m_headLink)</div>
<div class="line"><span class="lineno">  356</span>              .getAccess()) {</div>
<div class="line"><span class="lineno">  357</span>        <span class="comment">// Expand into all nearby sequences, until a ROAD is found</span></div>
<div class="line"><span class="lineno">  358</span>        i     = s.m_head;</div>
<div class="line"><span class="lineno">  359</span>        iLink = s.m_headLink;</div>
<div class="line"><span class="lineno">  360</span>        <span class="keywordflow">for</span> (; i != s.m_tail &amp;&amp;</div>
<div class="line"><span class="lineno">  361</span>               !s.m_graphHolder-&gt;getNode(i).getLink(iLink)-&gt;hasAttribute(</div>
<div class="line"><span class="lineno">  362</span>                   SkeletonArc::ROAD);</div>
<div class="line"><span class="lineno">  363</span>             s.next(i, iLink))</div>
<div class="line"><span class="lineno">  364</span>          ;</div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span>        <span class="comment">// If the sequence has been completely run, include next joint in the</span></div>
<div class="line"><span class="lineno">  367</span>        <span class="comment">// expansion procedure AND sign it as &#39;REACHED&#39;</span></div>
<div class="line"><span class="lineno">  368</span>        <span class="keywordflow">if</span> (i == s.m_tail) {</div>
<div class="line"><span class="lineno">  369</span>          iNext = currJSGraph-&gt;getNode(curr).getLink(currLink).getNext();</div>
<div class="line"><span class="lineno">  370</span>          <span class="keywordflow">if</span> (!currJSGraph-&gt;node(iNext).hasAttribute(</div>
<div class="line"><span class="lineno">  371</span>                  JointSequenceGraph::REACHED)) {</div>
<div class="line"><span class="lineno">  372</span>            currJSGraph-&gt;node(iNext).setAttribute(JointSequenceGraph::REACHED);</div>
<div class="line"><span class="lineno">  373</span>            m_jointsAbsorbed.push_back(iNext);</div>
<div class="line"><span class="lineno">  374</span>          }</div>
<div class="line"><span class="lineno">  375</span>          <span class="comment">// Negate access to this sequence</span></div>
<div class="line"><span class="lineno">  376</span>          s.m_graphHolder-&gt;node(s.m_tail).link(s.m_tailLink).setAccess(0);</div>
<div class="line"><span class="lineno">  377</span>          s.m_graphHolder-&gt;node(s.m_head).link(s.m_headLink).setAccess(0);</div>
<div class="line"><span class="lineno">  378</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  379</span>          <span class="comment">// Initialize and copy the entering sequence found</span></div>
<div class="line"><span class="lineno">  380</span>          m_enteringSequences.push_back(<a class="code hl_class" href="class_entering_sequence.html">EnteringSequence</a>(s));</div>
<div class="line"><span class="lineno">  381</span>          m_enteringSequences.back().m_head     = i;</div>
<div class="line"><span class="lineno">  382</span>          m_enteringSequences.back().m_headLink = iLink;</div>
<div class="line"><span class="lineno">  383</span> </div>
<div class="line"><span class="lineno">  384</span>          <span class="comment">// Initialize entering directions</span></div>
<div class="line"><span class="lineno">  385</span>          iNext = s.m_graphHolder-&gt;getNode(i).getLink(iLink).getNext();</div>
<div class="line"><span class="lineno">  386</span>          m_enteringSequences.back().m_direction = planeProjection(</div>
<div class="line"><span class="lineno">  387</span>              *s.m_graphHolder-&gt;getNode(i) - *s.m_graphHolder-&gt;getNode(iNext));</div>
<div class="line"><span class="lineno">  388</span>          m_enteringSequences.back().m_direction =</div>
<div class="line"><span class="lineno">  389</span>              m_enteringSequences.back().m_direction *</div>
<div class="line"><span class="lineno">  390</span>              (1 / norm(m_enteringSequences.back().m_direction));</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>          <span class="comment">// Initialize entering height / slope</span></div>
<div class="line"><span class="lineno">  393</span>          m_enteringSequences.back().m_height = s.m_graphHolder-&gt;getNode(i)-&gt;z;</div>
<div class="line"><span class="lineno">  394</span> </div>
<div class="line"><span class="lineno">  395</span>          <span class="comment">// Also store pointer to link toward the joint at the end of sequence</span></div>
<div class="line"><span class="lineno">  396</span>          m_enteringSequences.back().m_initialJoint = curr;</div>
<div class="line"><span class="lineno">  397</span>          m_enteringSequences.back().m_outerLink    = currLink;</div>
<div class="line"><span class="lineno">  398</span>        }</div>
<div class="line"><span class="lineno">  399</span>      }</div>
<div class="line"><span class="lineno">  400</span>    }</div>
<div class="line"><span class="lineno">  401</span>  }</div>
<div class="line"><span class="lineno">  402</span>}</div>
<div class="ttc" id="aclass_entering_sequence_html"><div class="ttname"><a href="class_entering_sequence.html">EnteringSequence</a></div><div class="ttdef"><b>Definition:</b> tcenterlineadjustments.cpp:294</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acdfc1853619e50172bd2387dd2f1d941" name="acdfc1853619e50172bd2387dd2f1d941"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdfc1853619e50172bd2387dd2f1d941">&#9670;&nbsp;</a></span>makeHeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool JunctionArea::makeHeights </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  668</span>                                      {</div>
<div class="line"><span class="lineno">  669</span>  std::vector&lt;unsigned int&gt; heightOrderedIndices;</div>
<div class="line"><span class="lineno">  670</span>  std::vector&lt;unsigned int&gt; rightIntervalBounds;</div>
<div class="line"><span class="lineno">  671</span>  std::vector&lt;double&gt; optimalHeights;</div>
<div class="line"><span class="lineno">  672</span> </div>
<div class="line"><span class="lineno">  673</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, n, m;</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>  <span class="comment">// Sort entering sequences&#39; indices for increasing height/thickness</span></div>
<div class="line"><span class="lineno">  676</span>  heightOrderedIndices.resize(m_enteringSequences.size());</div>
<div class="line"><span class="lineno">  677</span>  <span class="keywordflow">for</span> (i = 0; i &lt; m_enteringSequences.size(); ++i) heightOrderedIndices[i] = i;</div>
<div class="line"><span class="lineno">  678</span>  sort(heightOrderedIndices.begin(), heightOrderedIndices.end(),</div>
<div class="line"><span class="lineno">  679</span>       <a class="code hl_class" href="classh_less.html">hLess</a>(m_enteringSequences));</div>
<div class="line"><span class="lineno">  680</span> </div>
<div class="line"><span class="lineno">  681</span>  <span class="comment">// Initialize globals/references</span></div>
<div class="line"><span class="lineno">  682</span>  currEnterings    = &amp;m_enteringSequences;</div>
<div class="line"><span class="lineno">  683</span>  heightIndicesPtr = &amp;heightOrderedIndices;</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>  optMeanError = 0;</div>
<div class="line"><span class="lineno">  686</span>  optHeights   = &amp;optimalHeights;</div>
<div class="line"><span class="lineno">  687</span> </div>
<div class="line"><span class="lineno">  688</span>  <span class="comment">// Now build height-mean configurations and launch their tests</span></div>
<div class="line"><span class="lineno">  689</span>  n = m_enteringSequences.size();</div>
<div class="line"><span class="lineno">  690</span> </div>
<div class="line"><span class="lineno">  691</span>  <span class="comment">// The m=0 case is done first, apart</span></div>
<div class="line"><span class="lineno">  692</span>  rightIntervalBounds.resize(0);</div>
<div class="line"><span class="lineno">  693</span>  tryConfiguration(rightIntervalBounds);</div>
<div class="line"><span class="lineno">  694</span>  <span class="keywordflow">for</span> (m = 1; m &lt; n &amp;&amp; optimalHeights.empty(); ++m) {</div>
<div class="line"><span class="lineno">  695</span>    <span class="comment">// Initialize bounds</span></div>
<div class="line"><span class="lineno">  696</span>    rightIntervalBounds.resize(1);</div>
<div class="line"><span class="lineno">  697</span>    rightIntervalBounds[0] = 0;</div>
<div class="line"><span class="lineno">  698</span> </div>
<div class="line"><span class="lineno">  699</span>    <span class="keywordflow">while</span> (!rightIntervalBounds.empty()) {</div>
<div class="line"><span class="lineno">  700</span>      <span class="comment">// Fill bounds if necessary</span></div>
<div class="line"><span class="lineno">  701</span>      <span class="keywordflow">while</span> (rightIntervalBounds.size() &lt; m)</div>
<div class="line"><span class="lineno">  702</span>        rightIntervalBounds.push_back(rightIntervalBounds.back() + 1);</div>
<div class="line"><span class="lineno">  703</span> </div>
<div class="line"><span class="lineno">  704</span>      tryConfiguration(rightIntervalBounds);</div>
<div class="line"><span class="lineno">  705</span> </div>
<div class="line"><span class="lineno">  706</span>      <span class="comment">//&#39;Advance&#39; configuration: increment last index and pop those</span></div>
<div class="line"><span class="lineno">  707</span>      <span class="comment">// exceeding valid size. If bounds gets empty, done all configs</span></div>
<div class="line"><span class="lineno">  708</span>      <span class="comment">// with m+1 intervals.</span></div>
<div class="line"><span class="lineno">  709</span>      <span class="keywordflow">while</span> ((</div>
<div class="line"><span class="lineno">  710</span>          ++rightIntervalBounds.back(),</div>
<div class="line"><span class="lineno">  711</span>          rightIntervalBounds.back() &lt; n - 1 - (m - rightIntervalBounds.size())</div>
<div class="line"><span class="lineno">  712</span>              ? 0</div>
<div class="line"><span class="lineno">  713</span>              : (rightIntervalBounds.pop_back(), !rightIntervalBounds.empty())))</div>
<div class="line"><span class="lineno">  714</span>        ;</div>
<div class="line"><span class="lineno">  715</span>    }</div>
<div class="line"><span class="lineno">  716</span>  }</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>  <span class="keywordflow">if</span> (!optimalHeights.empty()) {</div>
<div class="line"><span class="lineno">  719</span>    <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i) m_enteringSequences[i].m_height = optimalHeights[i];</div>
<div class="line"><span class="lineno">  720</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  721</span>  }</div>
<div class="line"><span class="lineno">  722</span> </div>
<div class="line"><span class="lineno">  723</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  724</span>}</div>
<div class="ttc" id="aclassh_less_html"><div class="ttname"><a href="classh_less.html">hLess</a></div><div class="ttdef"><b>Definition:</b> tcenterlineadjustments.cpp:640</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a78527861db5c74e9ef78fd31d8098c4c" name="a78527861db5c74e9ef78fd31d8098c4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78527861db5c74e9ef78fd31d8098c4c">&#9670;&nbsp;</a></span>sequencesPullBack()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool JunctionArea::sequencesPullBack </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  787</span>                                            {</div>
<div class="line"><span class="lineno">  788</span>  std::vector&lt;EnteringSequence&gt;::iterator a;</div>
<div class="line"><span class="lineno">  789</span>  <span class="keywordtype">double</span> alongLinePosition, distanceFromLine;</div>
<div class="line"><span class="lineno">  790</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, iLink, tail;</div>
<div class="line"><span class="lineno">  791</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> P;</div>
<div class="line"><span class="lineno">  792</span> </div>
<div class="line"><span class="lineno">  793</span>  <span class="keywordflow">for</span> (a = m_enteringSequences.begin(); a != m_enteringSequences.end(); ++a) {</div>
<div class="line"><span class="lineno">  794</span>    i     = a-&gt;m_head;</div>
<div class="line"><span class="lineno">  795</span>    iLink = a-&gt;m_headLink;</div>
<div class="line"><span class="lineno">  796</span>    <span class="comment">// NOTE: updated tails are stored this way, *DONT* look in a-&gt;m_tail</span></div>
<div class="line"><span class="lineno">  797</span>    <span class="comment">// because these typically store old infos</span></div>
<div class="line"><span class="lineno">  798</span>    tail =</div>
<div class="line"><span class="lineno">  799</span>        currJSGraph-&gt;getNode(a-&gt;m_initialJoint).getLink(a-&gt;m_outerLink)-&gt;m_tail;</div>
<div class="line"><span class="lineno">  800</span>    P = planeProjection(*a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head));</div>
<div class="line"><span class="lineno">  801</span> </div>
<div class="line"><span class="lineno">  802</span>    <span class="keywordflow">while</span> (i != tail) {</div>
<div class="line"><span class="lineno">  803</span>      alongLinePosition = a-&gt;m_direction * (m_newJointPosition - P);</div>
<div class="line"><span class="lineno">  804</span>      distanceFromLine  = tdistance(m_newJointPosition, a-&gt;m_direction, P);</div>
<div class="line"><span class="lineno">  805</span> </div>
<div class="line"><span class="lineno">  806</span>      <span class="keywordflow">if</span> (alongLinePosition &gt;= 0 &amp;&amp;</div>
<div class="line"><span class="lineno">  807</span>          (distanceFromLine / alongLinePosition) &lt;= 0.5)</div>
<div class="line"><span class="lineno">  808</span>        <span class="keywordflow">goto</span> found_pull_back;</div>
<div class="line"><span class="lineno">  809</span> </div>
<div class="line"><span class="lineno">  810</span>      <span class="comment">// We then take the next arc and check it</span></div>
<div class="line"><span class="lineno">  811</span> </div>
<div class="line"><span class="lineno">  812</span>      <span class="keywordflow">if</span> (!a-&gt;m_graphHolder-&gt;getNode(i).getLink(iLink)-&gt;hasAttribute(</div>
<div class="line"><span class="lineno">  813</span>              SkeletonArc::ROAD))</div>
<div class="line"><span class="lineno">  814</span>        <span class="keywordflow">return</span> 0;  <span class="comment">// Pull back failed</span></div>
<div class="line"><span class="lineno">  815</span> </div>
<div class="line"><span class="lineno">  816</span>      a-&gt;next(i, iLink);</div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>      P = planeProjection(*a-&gt;m_graphHolder-&gt;getNode(i));</div>
<div class="line"><span class="lineno">  819</span>      <span class="keywordflow">if</span> (tdistance(P, a-&gt;m_direction, m_newJointPosition) &gt;</div>
<div class="line"><span class="lineno">  820</span>          std::max(pullBackMul * a-&gt;m_height, 1.0))</div>
<div class="line"><span class="lineno">  821</span>        <span class="keywordflow">return</span> 0;  <span class="comment">// Pull back failed</span></div>
<div class="line"><span class="lineno">  822</span>    }</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>    <span class="comment">// Now checking opposite sequence extremity</span></div>
<div class="line"><span class="lineno">  825</span>    <span class="keywordflow">if</span> (alongLinePosition &lt; 0 || (distanceFromLine / alongLinePosition) &gt; 0.5)</div>
<div class="line"><span class="lineno">  826</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  827</span> </div>
<div class="line"><span class="lineno">  828</span>  found_pull_back:</div>
<div class="line"><span class="lineno">  829</span> </div>
<div class="line"><span class="lineno">  830</span>    a-&gt;m_head     = i;</div>
<div class="line"><span class="lineno">  831</span>    a-&gt;m_headLink = iLink;</div>
<div class="line"><span class="lineno">  832</span>  }</div>
<div class="line"><span class="lineno">  833</span> </div>
<div class="line"><span class="lineno">  834</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  835</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2c785e55a400cd7fc0568c722d44b8fd" name="a2c785e55a400cd7fc0568c722d44b8fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c785e55a400cd7fc0568c722d44b8fd">&#9670;&nbsp;</a></span>solveJunctionPosition()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool JunctionArea::solveJunctionPosition </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  503</span>                                                {</div>
<div class="line"><span class="lineno">  504</span>  std::vector&lt;EnteringSequence&gt;::iterator a;</div>
<div class="line"><span class="lineno">  505</span>  <span class="keywordtype">double</span> Sx2 = 0, Sy2 = 0, Sxy = 0;</div>
<div class="line"><span class="lineno">  506</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> P, v, b;</div>
<div class="line"><span class="lineno">  507</span>  <span class="keywordtype">double</span> h;</div>
<div class="line"><span class="lineno">  508</span> </div>
<div class="line"><span class="lineno">  509</span>  <span class="comment">// Build preliminary sums for the linear system</span></div>
<div class="line"><span class="lineno">  510</span>  <span class="keywordflow">for</span> (a = m_enteringSequences.begin(); a != m_enteringSequences.end(); ++a) {</div>
<div class="line"><span class="lineno">  511</span>    h = a-&gt;m_height;</div>
<div class="line"><span class="lineno">  512</span>    v = a-&gt;m_direction;</div>
<div class="line"><span class="lineno">  513</span>    P = planeProjection(*a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head));</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>    <span class="comment">// Height-weighted problem</span></div>
<div class="line"><span class="lineno">  516</span>    Sx2 += sq(v.x) * h;</div>
<div class="line"><span class="lineno">  517</span>    Sy2 += sq(v.y) * h;</div>
<div class="line"><span class="lineno">  518</span>    Sxy += v.x * v.y * h;</div>
<div class="line"><span class="lineno">  519</span>    b.x += h * (sq(v.y) * P.x - (v.x * v.y * P.y));</div>
<div class="line"><span class="lineno">  520</span>    b.y += h * (sq(v.x) * P.y - (v.x * v.y * P.x));</div>
<div class="line"><span class="lineno">  521</span>  }</div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>  <span class="comment">// First check problem determinant</span></div>
<div class="line"><span class="lineno">  524</span>  <span class="keywordtype">double</span> det = Sx2 * Sy2 - sq(Sxy);</div>
<div class="line"><span class="lineno">  525</span>  <span class="keywordflow">if</span> (fabs(det) &lt; 0.1) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  526</span> </div>
<div class="line"><span class="lineno">  527</span>  <span class="comment">// Now construct linear system</span></div>
<div class="line"><span class="lineno">  528</span>  <a class="code hl_class" href="class_t_affine.html">TAffine</a> M(Sx2 / det, Sxy / det, 0, Sxy / det, Sy2 / det, 0);</div>
<div class="line"><span class="lineno">  529</span> </div>
<div class="line"><span class="lineno">  530</span>  m_newJointPosition = M * b;</div>
<div class="line"><span class="lineno">  531</span> </div>
<div class="line"><span class="lineno">  532</span>  <span class="comment">// Finally, check if J is too far from the line extensions of the entering</span></div>
<div class="line"><span class="lineno">  533</span>  <span class="comment">// sequences</span></div>
<div class="line"><span class="lineno">  534</span>  <span class="keywordflow">for</span> (a = m_enteringSequences.begin(); a != m_enteringSequences.end(); ++a) {</div>
<div class="line"><span class="lineno">  535</span>    P = planeProjection(*a-&gt;m_graphHolder-&gt;getNode(a-&gt;m_head));</div>
<div class="line"><span class="lineno">  536</span>    <span class="keywordflow">if</span> (tdistance(m_newJointPosition, a-&gt;m_direction, P) &gt;</div>
<div class="line"><span class="lineno">  537</span>        a-&gt;m_height * lineDistMul)</div>
<div class="line"><span class="lineno">  538</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  539</span>  }</div>
<div class="line"><span class="lineno">  540</span> </div>
<div class="line"><span class="lineno">  541</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  542</span>}</div>
<div class="ttc" id="aclass_t_affine_html"><div class="ttname"><a href="class_t_affine.html">TAffine</a></div><div class="ttdoc">This is the base class for the affine transformations.</div><div class="ttdef"><b>Definition:</b> tgeometry.h:864</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="acd27f171593baa7ac33e1dde79b1fc1e" name="acd27f171593baa7ac33e1dde79b1fc1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd27f171593baa7ac33e1dde79b1fc1e">&#9670;&nbsp;</a></span>m_enteringSequences</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="class_entering_sequence.html">EnteringSequence</a>&gt; JunctionArea::m_enteringSequences</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2e13501653143b2822f4356862a72048" name="a2e13501653143b2822f4356862a72048"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e13501653143b2822f4356862a72048">&#9670;&nbsp;</a></span>m_jointsAbsorbed</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; JunctionArea::m_jointsAbsorbed</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a26981f954c2703efd6cb63b4e6009434" name="a26981f954c2703efd6cb63b4e6009434"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26981f954c2703efd6cb63b4e6009434">&#9670;&nbsp;</a></span>m_newJointPosition</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_point_t.html">TPointD</a> JunctionArea::m_newJointPosition</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>E:/opentoonz/toonz/sources/toonzlib/<a class="el" href="">tcenterlineadjustments.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
