<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>opentoonz: CenterLineVectorizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">opentoonz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="class_center_line_vectorizer-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">CenterLineVectorizer Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for CenterLineVectorizer:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_center_line_vectorizer.png" usemap="#CenterLineVectorizer_map" alt=""/>
  <map id="CenterLineVectorizer_map" name="CenterLineVectorizer_map">
<area href="class_outline_vectorizer.html" alt="OutlineVectorizer" shape="rect" coords="0,56,133,80"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aefe0ad76f88c5a267a18ef8663a11aaf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_node.html">Node</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#aefe0ad76f88c5a267a18ef8663a11aaf">findOtherSide</a> (<a class="el" href="class_node.html">Node</a> *node)</td></tr>
<tr class="separator:aefe0ad76f88c5a267a18ef8663a11aaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84d22990d2965b24dd7acaf144a5198a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a84d22990d2965b24dd7acaf144a5198a">testOtherSide</a> (<a class="el" href="class_node.html">Node</a> *na1, <a class="el" href="class_node.html">Node</a> *nb1, double &amp;startDist2)</td></tr>
<tr class="separator:a84d22990d2965b24dd7acaf144a5198a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35b4481491e415a5ec4c959f14ca72b7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_point_t.html">TPointD</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a35b4481491e415a5ec4c959f14ca72b7">computeCenter</a> (<a class="el" href="class_node.html">Node</a> *na, <a class="el" href="class_node.html">Node</a> *nb, double &amp;r)</td></tr>
<tr class="separator:a35b4481491e415a5ec4c959f14ca72b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec4c99ec49c1f60ef3ab7b2deddb2e7"><td class="memItemLeft" align="right" valign="top"><a id="a2ec4c99ec49c1f60ef3ab7b2deddb2e7" name="a2ec4c99ec49c1f60ef3ab7b2deddb2e7"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>isHole</b> (<a class="el" href="class_node.html">Node</a> *startNode)</td></tr>
<tr class="separator:a2ec4c99ec49c1f60ef3ab7b2deddb2e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8028bc5ca943c715d0e2e83b8c5f93b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#aa8028bc5ca943c715d0e2e83b8c5f93b">traceLine</a> (<a class="el" href="class_data_pixel.html">DataPixel</a> *pix)</td></tr>
<tr class="separator:aa8028bc5ca943c715d0e2e83b8c5f93b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3653204fe174f3ee2e8e948fa4d98abd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_point_t.html">TPoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a3653204fe174f3ee2e8e948fa4d98abd">computeGradient</a> (<a class="el" href="class_data_pixel.html">DataPixel</a> *pix)</td></tr>
<tr class="separator:a3653204fe174f3ee2e8e948fa4d98abd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac571134072897ccf4423f3735220f21a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#ac571134072897ccf4423f3735220f21a">CenterLineVectorizer</a> (const <a class="el" href="class_vectorizer_configuration.html">VectorizerConfiguration</a> &amp;configuration, <a class="el" href="class_t_palette.html">TPalette</a> *palette)</td></tr>
<tr class="separator:ac571134072897ccf4423f3735220f21a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31d02653b419e608d1240880d373ce93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a31d02653b419e608d1240880d373ce93">clearNodes</a> ()</td></tr>
<tr class="separator:a31d02653b419e608d1240880d373ce93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb2eaeca611b945dae5496ef1578ab58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#abb2eaeca611b945dae5496ef1578ab58">createNodes</a> ()</td></tr>
<tr class="separator:abb2eaeca611b945dae5496ef1578ab58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf8b684369a409bb3347c90d825c31e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#adf8b684369a409bb3347c90d825c31e7">clearJunctions</a> ()</td></tr>
<tr class="separator:adf8b684369a409bb3347c90d825c31e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18d0a55d7aa6568610cc8074f7c8db90"><td class="memItemLeft" align="right" valign="top"><a id="a18d0a55d7aa6568610cc8074f7c8db90" name="a18d0a55d7aa6568610cc8074f7c8db90"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>makeOutputRaster</b> ()</td></tr>
<tr class="separator:a18d0a55d7aa6568610cc8074f7c8db90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac876387fb568da716cf6889bbb1bd6fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#ac876387fb568da716cf6889bbb1bd6fb">makeDataRaster</a> (const <a class="el" href="class_t_smart_pointer_t.html">TRasterP</a> &amp;src)</td></tr>
<tr class="separator:ac876387fb568da716cf6889bbb1bd6fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a495495a31a414962849bc2e927bcc5df"><td class="memItemLeft" align="right" valign="top"><a id="a495495a31a414962849bc2e927bcc5df" name="a495495a31a414962849bc2e927bcc5df"></a>
<a class="el" href="class_data_pixel.html">DataPixel</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>findUnvisitedInkPixel</b> ()</td></tr>
<tr class="separator:a495495a31a414962849bc2e927bcc5df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a969e440077bf9a0c9809e63b937d6221"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a969e440077bf9a0c9809e63b937d6221">linkNextProtoStroke</a> (<a class="el" href="class_proto_stroke.html">ProtoStroke</a> *const dstProtoStroke, <a class="el" href="class_junction.html">Junction</a> *const currJunction, const int k)</td></tr>
<tr class="separator:a969e440077bf9a0c9809e63b937d6221"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b6f195a993b2f2eb728f345730d35f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a8b6f195a993b2f2eb728f345730d35f8">joinProtoStrokes</a> (<a class="el" href="class_proto_stroke.html">ProtoStroke</a> *const dstProtoStroke)</td></tr>
<tr class="separator:a8b6f195a993b2f2eb728f345730d35f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7890f448caa3a69ad4c149eb2a8078a1"><td class="memItemLeft" align="right" valign="top"><a id="a7890f448caa3a69ad4c149eb2a8078a1" name="a7890f448caa3a69ad4c149eb2a8078a1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>resolveUnvisitedNode</b> (<a class="el" href="class_node.html">Node</a> *node)</td></tr>
<tr class="separator:a7890f448caa3a69ad4c149eb2a8078a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff37418e696de2fa49085d53c8f664e7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_junction.html">Junction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#aff37418e696de2fa49085d53c8f664e7">mergeJunctions</a> (const std::list&lt; <a class="el" href="class_junction_merge.html">JunctionMerge</a> &gt; &amp;junctions)</td></tr>
<tr class="separator:aff37418e696de2fa49085d53c8f664e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a3d7d1cd895e3ffa710592f5e0f2ccb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a8a3d7d1cd895e3ffa710592f5e0f2ccb">joinJunctions</a> ()</td></tr>
<tr class="separator:a8a3d7d1cd895e3ffa710592f5e0f2ccb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d0f6aaf6c7e8e31820ff55df1af4ef6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a9d0f6aaf6c7e8e31820ff55df1af4ef6">createJunctionPolygon</a> (<a class="el" href="class_junction.html">Junction</a> *junction)</td></tr>
<tr class="separator:a9d0f6aaf6c7e8e31820ff55df1af4ef6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0c75b40affba85bc1dcbf14d451dc03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#aa0c75b40affba85bc1dcbf14d451dc03">handleLinks</a> ()</td></tr>
<tr class="separator:aa0c75b40affba85bc1dcbf14d451dc03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a385916cdd69ff0d1b0c0387566df51f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a385916cdd69ff0d1b0c0387566df51f9">handleJunctions</a> ()</td></tr>
<tr class="separator:a385916cdd69ff0d1b0c0387566df51f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31dc81993155e7526139b9ba23cfb8d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a31dc81993155e7526139b9ba23cfb8d3">createStrokes</a> ()</td></tr>
<tr class="separator:a31dc81993155e7526139b9ba23cfb8d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a737d432f55b524213921db37dcccf4ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a737d432f55b524213921db37dcccf4ac">createRegions</a> ()</td></tr>
<tr class="separator:a737d432f55b524213921db37dcccf4ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affd8c8cd55bbd5511ec941d3e2eb3acc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#affd8c8cd55bbd5511ec941d3e2eb3acc">vectorize</a> ()</td></tr>
<tr class="separator:affd8c8cd55bbd5511ec941d3e2eb3acc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64e746f48131a5fff831c84d8dd091c5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a64e746f48131a5fff831c84d8dd091c5">init</a> ()</td></tr>
<tr class="separator:a64e746f48131a5fff831c84d8dd091c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec5e64a4ab988c590744c621e1fe4e94"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_node.html">Node</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#aec5e64a4ab988c590744c621e1fe4e94">createNode</a> (<a class="el" href="class_data_pixel.html">DataPixel</a> *pix)</td></tr>
<tr class="separator:aec5e64a4ab988c590744c621e1fe4e94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65157f31162e7fc32420d5b4e62e51b2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a65157f31162e7fc32420d5b4e62e51b2">link</a> (<a class="el" href="class_data_pixel.html">DataPixel</a> *pix, <a class="el" href="class_data_pixel.html">DataPixel</a> *from, <a class="el" href="class_data_pixel.html">DataPixel</a> *to)</td></tr>
<tr class="separator:a65157f31162e7fc32420d5b4e62e51b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a5ad41dd6e5eca752f3ce3eba0a18a783"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_smart_pointer_t.html">TRasterP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a5ad41dd6e5eca752f3ce3eba0a18a783">m_src</a></td></tr>
<tr class="separator:a5ad41dd6e5eca752f3ce3eba0a18a783"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a479dbf8f9aadd0aabf67ba52e50bfa36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_vectorizer_configuration.html">VectorizerConfiguration</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a479dbf8f9aadd0aabf67ba52e50bfa36">m_configuration</a></td></tr>
<tr class="separator:a479dbf8f9aadd0aabf67ba52e50bfa36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d73af2fd7d369e0cfa6d4108f24639e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_raster_p_t.html">DataRasterP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a3d73af2fd7d369e0cfa6d4108f24639e">m_dataRaster</a></td></tr>
<tr class="separator:a3d73af2fd7d369e0cfa6d4108f24639e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41ad2fbcf51a61f6b95589953f020efe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvector.html">vector</a>&lt; pair&lt; int, <a class="el" href="class_t_raster_p_t.html">DataRasterP</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a41ad2fbcf51a61f6b95589953f020efe">m_dataRasterArray</a></td></tr>
<tr class="separator:a41ad2fbcf51a61f6b95589953f020efe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c6992c280df0ee2ccac31a524faa247"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_vector_image_p.html">TVectorImageP</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a2c6992c280df0ee2ccac31a524faa247">m_vimage</a></td></tr>
<tr class="separator:a2c6992c280df0ee2ccac31a524faa247"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6a4f544b2ccaf516d017ddc2f102605"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvector.html">vector</a>&lt; <a class="el" href="class_node.html">Node</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#aa6a4f544b2ccaf516d017ddc2f102605">m_nodes</a></td></tr>
<tr class="separator:aa6a4f544b2ccaf516d017ddc2f102605"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fc61cc2459f73a30df52c1e63dcd45a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvector.html">vector</a>&lt; <a class="el" href="class_junction.html">Junction</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a9fc61cc2459f73a30df52c1e63dcd45a">m_junctions</a></td></tr>
<tr class="separator:a9fc61cc2459f73a30df52c1e63dcd45a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae27f83ea716828cb95dabb942cc222ac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvector.html">vector</a>&lt; <a class="el" href="class_junction_link.html">JunctionLink</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#ae27f83ea716828cb95dabb942cc222ac">m_links</a></td></tr>
<tr class="separator:ae27f83ea716828cb95dabb942cc222ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33c730773e3ebeeab0285a058e8ccdff"><td class="memItemLeft" align="right" valign="top">list&lt; <a class="el" href="class_proto_stroke.html">ProtoStroke</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#a33c730773e3ebeeab0285a058e8ccdff">m_protoStrokes</a></td></tr>
<tr class="separator:a33c730773e3ebeeab0285a058e8ccdff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabe35c50f2c12cdb4f398f863e884d7a"><td class="memItemLeft" align="right" valign="top">list&lt; <a class="el" href="class_proto_region.html">ProtoRegion</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_center_line_vectorizer.html#aabe35c50f2c12cdb4f398f863e884d7a">m_protoRegions</a></td></tr>
<tr class="separator:aabe35c50f2c12cdb4f398f863e884d7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"></div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac571134072897ccf4423f3735220f21a" name="ac571134072897ccf4423f3735220f21a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac571134072897ccf4423f3735220f21a">&#9670;&nbsp;</a></span>CenterLineVectorizer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CenterLineVectorizer::CenterLineVectorizer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_vectorizer_configuration.html">VectorizerConfiguration</a> &amp;&#160;</td>
          <td class="paramname"><em>configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_palette.html">TPalette</a> *&#160;</td>
          <td class="paramname"><em>palette</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  277</span>      : m_configuration(configuration), m_palette(palette) {}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d8ba95fae41919439996a973efd1206" name="a9d8ba95fae41919439996a973efd1206"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d8ba95fae41919439996a973efd1206">&#9670;&nbsp;</a></span>~CenterLineVectorizer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CenterLineVectorizer::~CenterLineVectorizer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  464</span>                                            {</div>
<div class="line"><span class="lineno">  465</span>  clearNodes();</div>
<div class="line"><span class="lineno">  466</span>  clearJunctions();</div>
<div class="line"><span class="lineno">  467</span> </div>
<div class="line"><span class="lineno">  468</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="lineno">  469</span>  m_outlines.clear();</div>
<div class="line"><span class="lineno">  470</span>  m_unvisitedNodes.clear();</div>
<div class="line"><span class="lineno">  471</span>  m_junctionPolygons.clear();</div>
<div class="line"><span class="lineno">  472</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>  m_links.clear();</div>
<div class="line"><span class="lineno">  475</span>  m_protoStrokes.clear();</div>
<div class="line"><span class="lineno">  476</span>  m_protoRegions.clear();</div>
<div class="line"><span class="lineno">  477</span>  <span class="comment">// m_protoHoles.clear();</span></div>
<div class="line"><span class="lineno">  478</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="adf8b684369a409bb3347c90d825c31e7" name="adf8b684369a409bb3347c90d825c31e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf8b684369a409bb3347c90d825c31e7">&#9670;&nbsp;</a></span>clearJunctions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::clearJunctions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  489</span>                                          {</div>
<div class="line"><span class="lineno">  490</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)m_junctions.size(); i++) <span class="keyword">delete</span> m_junctions[i];</div>
<div class="line"><span class="lineno">  491</span>  m_junctions.clear();</div>
<div class="line"><span class="lineno">  492</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a31d02653b419e608d1240880d373ce93" name="a31d02653b419e608d1240880d373ce93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31d02653b419e608d1240880d373ce93">&#9670;&nbsp;</a></span>clearNodes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::clearNodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  482</span>                                      {</div>
<div class="line"><span class="lineno">  483</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)m_nodes.size(); i++) <span class="keyword">delete</span> m_nodes[i];</div>
<div class="line"><span class="lineno">  484</span>  m_nodes.clear();</div>
<div class="line"><span class="lineno">  485</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a35b4481491e415a5ec4c959f14ca72b7" name="a35b4481491e415a5ec4c959f14ca72b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35b4481491e415a5ec4c959f14ca72b7">&#9670;&nbsp;</a></span>computeCenter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_point_t.html">TPointD</a> CenterLineVectorizer::computeCenter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_node.html">Node</a> *&#160;</td>
          <td class="paramname"><em>na</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_node.html">Node</a> *&#160;</td>
          <td class="paramname"><em>nb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  807</span>                                                                         {</div>
<div class="line"><span class="lineno">  808</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> pa = convert(na-&gt;m_pixel-&gt;m_pos);</div>
<div class="line"><span class="lineno">  809</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> pb = convert(nb-&gt;m_pixel-&gt;m_pos);</div>
<div class="line"><span class="lineno">  810</span>  r          = THICKNESS_LIMIT;</div>
<div class="line"><span class="lineno">  811</span>  <span class="keywordflow">if</span> (pa == pb) <span class="keywordflow">return</span> pa;</div>
<div class="line"><span class="lineno">  812</span> </div>
<div class="line"><span class="lineno">  813</span>  <a class="code hl_class" href="class_t_point_t.html">TPointD</a> center((pa + pb) * 0.5);</div>
<div class="line"><span class="lineno">  814</span>  r = norm(pa - pb) * 0.5;</div>
<div class="line"><span class="lineno">  815</span>  <span class="keywordflow">return</span> center;</div>
<div class="line"><span class="lineno">  816</span> </div>
<div class="line"><span class="lineno">  817</span>  <span class="comment">/*    double vsum = 0.0;</span></div>
<div class="line"><span class="lineno">  818</span><span class="comment">  TPointD d = pa-pb;</span></div>
<div class="line"><span class="lineno">  819</span><span class="comment">  if(fabs(d.x)&gt;fabs(d.y))</span></div>
<div class="line"><span class="lineno">  820</span><span class="comment">{</span></div>
<div class="line"><span class="lineno">  821</span><span class="comment">          if(pa.x&gt;pb.x) std::swap(pa,pb);</span></div>
<div class="line"><span class="lineno">  822</span><span class="comment">          for(int x = pa.x; x&lt;=pb.x; x++)</span></div>
<div class="line"><span class="lineno">  823</span><span class="comment">          {</span></div>
<div class="line"><span class="lineno">  824</span><span class="comment">                  int y = pa.y + (pb.y-pa.y)*(x-pa.x)/(pb.x-pa.x);</span></div>
<div class="line"><span class="lineno">  825</span><span class="comment">                  int v = 255-m_dataRaster-&gt;pixels(y)[x].m_value;</span></div>
<div class="line"><span class="lineno">  826</span><span class="comment">                  center += v * TPointD(x,y);</span></div>
<div class="line"><span class="lineno">  827</span><span class="comment">                  vsum += v;</span></div>
<div class="line"><span class="lineno">  828</span><span class="comment">  }</span></div>
<div class="line"><span class="lineno">  829</span><span class="comment">}</span></div>
<div class="line"><span class="lineno">  830</span><span class="comment">  else</span></div>
<div class="line"><span class="lineno">  831</span><span class="comment">{</span></div>
<div class="line"><span class="lineno">  832</span><span class="comment">          if(pa.y&gt;pb.y) std::swap(pa,pb);</span></div>
<div class="line"><span class="lineno">  833</span><span class="comment">          for(int y = pa.y; y&lt;=pb.y; y++)</span></div>
<div class="line"><span class="lineno">  834</span><span class="comment">          {</span></div>
<div class="line"><span class="lineno">  835</span><span class="comment">                  int x = pa.x + (pb.x-pa.x)*(y-pa.y)/(pb.y-pa.y);</span></div>
<div class="line"><span class="lineno">  836</span><span class="comment">                  int v = 255-m_dataRaster-&gt;pixels(y)[x].m_value;</span></div>
<div class="line"><span class="lineno">  837</span><span class="comment">                  center += v * TPointD(x,y);</span></div>
<div class="line"><span class="lineno">  838</span><span class="comment">                  vsum += v;</span></div>
<div class="line"><span class="lineno">  839</span><span class="comment">          }</span></div>
<div class="line"><span class="lineno">  840</span><span class="comment">}</span></div>
<div class="line"><span class="lineno">  841</span><span class="comment">  assert(vsum&gt;0);</span></div>
<div class="line"><span class="lineno">  842</span><span class="comment">  r = 0.5*vsum/255.0;</span></div>
<div class="line"><span class="lineno">  843</span><span class="comment">  return center * (1/vsum);</span></div>
<div class="line"><span class="lineno">  844</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno">  845</span>}</div>
<div class="ttc" id="aclass_t_point_t_html"><div class="ttname"><a href="class_t_point_t.html">TPointT&lt; double &gt;</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3653204fe174f3ee2e8e948fa4d98abd" name="a3653204fe174f3ee2e8e948fa4d98abd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3653204fe174f3ee2e8e948fa4d98abd">&#9670;&nbsp;</a></span>computeGradient()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_point_t.html">TPoint</a> CenterLineVectorizer::computeGradient </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_data_pixel.html">DataPixel</a> *&#160;</td>
          <td class="paramname"><em>pix</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  252</span>                                         {</div>
<div class="line"><span class="lineno">  253</span>    assert(m_dataRaster);</div>
<div class="line"><span class="lineno">  254</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> wrap = m_dataRaster-&gt;getWrap();</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>    <a class="code hl_class" href="class_t_point_t.html">TPoint</a> g(0, 0);</div>
<div class="line"><span class="lineno">  257</span>    <span class="keywordtype">int</span> n, s, w, e, nw, sw, ne, se;</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>    w  = pix[-1].m_value;</div>
<div class="line"><span class="lineno">  260</span>    nw = pix[-1 + wrap].m_value;</div>
<div class="line"><span class="lineno">  261</span>    sw = pix[-1 - wrap].m_value;</div>
<div class="line"><span class="lineno">  262</span> </div>
<div class="line"><span class="lineno">  263</span>    e  = pix[+1].m_value;</div>
<div class="line"><span class="lineno">  264</span>    ne = pix[+1 + wrap].m_value;</div>
<div class="line"><span class="lineno">  265</span>    se = pix[+1 - wrap].m_value;</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>    n = pix[+wrap].m_value;</div>
<div class="line"><span class="lineno">  268</span>    s = pix[-wrap].m_value;</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>    g.y = -sw + ne - se + nw + 2 * (n - s);</div>
<div class="line"><span class="lineno">  271</span>    g.x = -sw + ne + se - nw + 2 * (e - w);</div>
<div class="line"><span class="lineno">  272</span>    <span class="keywordflow">return</span> g;</div>
<div class="line"><span class="lineno">  273</span>  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d0f6aaf6c7e8e31820ff55df1af4ef6" name="a9d0f6aaf6c7e8e31820ff55df1af4ef6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d0f6aaf6c7e8e31820ff55df1af4ef6">&#9670;&nbsp;</a></span>createJunctionPolygon()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::createJunctionPolygon </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_junction.html">Junction</a> *&#160;</td>
          <td class="paramname"><em>junction</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1852</span>                                                                   {</div>
<div class="line"><span class="lineno"> 1853</span>  <span class="comment">// int size = junction-&gt;m_nodes.size();</span></div>
<div class="line"><span class="lineno"> 1854</span>  <span class="comment">//    std::sort(junction-&gt;m_nodes.begin(), junction-&gt;m_nodes.end(),</span></div>
<div class="line"><span class="lineno"> 1855</span>  <span class="comment">// CompareJunctionNodes(junction-&gt;m_center));</span></div>
<div class="line"><span class="lineno"> 1856</span>  <span class="comment">//    std::reverse(junction-&gt;m_nodes.begin(), junction-&gt;m_nodes.end());</span></div>
<div class="line"><span class="lineno"> 1857</span>  <span class="comment">// std::deque&lt;Node*&gt;::iterator it, it_temp;</span></div>
<div class="line"><span class="lineno"> 1858</span>  std::deque&lt;Node *&gt;::iterator it, it_temp;</div>
<div class="line"><span class="lineno"> 1859</span>  <span class="keywordflow">for</span> (it = junction-&gt;m_nodes.begin(); it != junction-&gt;m_nodes.end(); it++) {</div>
<div class="line"><span class="lineno"> 1860</span>    <span class="keywordtype">int</span> step = 0;</div>
<div class="line"><span class="lineno"> 1861</span> </div>
<div class="line"><span class="lineno"> 1862</span>    <a class="code hl_class" href="class_node.html">Node</a> *currNode;</div>
<div class="line"><span class="lineno"> 1863</span>    <a class="code hl_class" href="class_node.html">Node</a> *otherNode;</div>
<div class="line"><span class="lineno"> 1864</span> </div>
<div class="line"><span class="lineno"> 1865</span>    <span class="keywordflow">if</span> (it + 1 == junction-&gt;m_nodes.end())</div>
<div class="line"><span class="lineno"> 1866</span>      otherNode = *junction-&gt;m_nodes.begin();</div>
<div class="line"><span class="lineno"> 1867</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1868</span>      otherNode = *(it + 1);</div>
<div class="line"><span class="lineno"> 1869</span> </div>
<div class="line"><span class="lineno"> 1870</span>    <span class="comment">/*      currNode = (*it)-&gt;m_prev;</span></div>
<div class="line"><span class="lineno"> 1871</span><span class="comment">    if(!currNode-&gt;m_visited)</span></div>
<div class="line"><span class="lineno"> 1872</span><span class="comment">    {</span></div>
<div class="line"><span class="lineno"> 1873</span><span class="comment">            step=0;</span></div>
<div class="line"><span class="lineno"> 1874</span><span class="comment">            while(!currNode-&gt;m_visited &amp;&amp; currNode-&gt;m_junction != junction)</span></div>
<div class="line"><span class="lineno"> 1875</span><span class="comment">            {</span></div>
<div class="line"><span class="lineno"> 1876</span><span class="comment">                    it = junction-&gt;m_nodes.insert(it+1, currNode);</span></div>
<div class="line"><span class="lineno"> 1877</span><span class="comment">                    currNode-&gt;m_visited = true;</span></div>
<div class="line"><span class="lineno"> 1878</span><span class="comment">                    currNode = currNode-&gt;m_prev;</span></div>
<div class="line"><span class="lineno"> 1879</span><span class="comment">                    ++step;</span></div>
<div class="line"><span class="lineno"> 1880</span><span class="comment">            }</span></div>
<div class="line"><span class="lineno"> 1881</span><span class="comment">            if(currNode-&gt;m_junction != junction)</span></div>
<div class="line"><span class="lineno"> 1882</span><span class="comment">                    for(int i=0; i&lt;step; ++i)</span></div>
<div class="line"><span class="lineno"> 1883</span><span class="comment">                    {</span></div>
<div class="line"><span class="lineno"> 1884</span><span class="comment">                            currNode = currNode-&gt;m_next;</span></div>
<div class="line"><span class="lineno"> 1885</span><span class="comment">                            currNode-&gt;m_visited = false;</span></div>
<div class="line"><span class="lineno"> 1886</span><span class="comment">                            it = junction-&gt;m_nodes.erase(it);</span></div>
<div class="line"><span class="lineno"> 1887</span><span class="comment">                            --it;</span></div>
<div class="line"><span class="lineno"> 1888</span><span class="comment">                    }</span></div>
<div class="line"><span class="lineno"> 1889</span><span class="comment">            else</span></div>
<div class="line"><span class="lineno"> 1890</span><span class="comment">            {</span></div>
<div class="line"><span class="lineno"> 1891</span><span class="comment">                    if(currNode != otherNode)</span></div>
<div class="line"><span class="lineno"> 1892</span><span class="comment">                    {</span></div>
<div class="line"><span class="lineno"> 1893</span><span class="comment">                            it_temp = std::find(junction-&gt;m_nodes.begin(),</span></div>
<div class="line"><span class="lineno"> 1894</span><span class="comment">junction-&gt;m_nodes.end(),</span></div>
<div class="line"><span class="lineno"> 1895</span><span class="comment">currNode);</span></div>
<div class="line"><span class="lineno"> 1896</span><span class="comment">                            if(it+1 == junction-&gt;m_nodes.end())</span></div>
<div class="line"><span class="lineno"> 1897</span><span class="comment">                                    std::swap(*junction-&gt;m_nodes.begin(),</span></div>
<div class="line"><span class="lineno"> 1898</span><span class="comment">*it_temp);</span></div>
<div class="line"><span class="lineno"> 1899</span><span class="comment">                            else</span></div>
<div class="line"><span class="lineno"> 1900</span><span class="comment">                                    std::swap(*(it+1), *it_temp);</span></div>
<div class="line"><span class="lineno"> 1901</span><span class="comment">                    }</span></div>
<div class="line"><span class="lineno"> 1902</span><span class="comment">                    continue;</span></div>
<div class="line"><span class="lineno"> 1903</span><span class="comment">            }</span></div>
<div class="line"><span class="lineno"> 1904</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 1905</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno"> 1906</span>    currNode = (*it)-&gt;m_next;</div>
<div class="line"><span class="lineno"> 1907</span>    <span class="keywordflow">if</span> (!currNode-&gt;m_visited) {</div>
<div class="line"><span class="lineno"> 1908</span>      step = 0;</div>
<div class="line"><span class="lineno"> 1909</span>      <span class="keywordflow">while</span> (!currNode-&gt;m_visited &amp;&amp; currNode-&gt;m_junction != junction) {</div>
<div class="line"><span class="lineno"> 1910</span>        it                  = junction-&gt;m_nodes.insert(it + 1, currNode);</div>
<div class="line"><span class="lineno"> 1911</span>        currNode-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1912</span>        currNode            = currNode-&gt;m_next;</div>
<div class="line"><span class="lineno"> 1913</span>        ++step;</div>
<div class="line"><span class="lineno"> 1914</span>      }</div>
<div class="line"><span class="lineno"> 1915</span>      <span class="keywordflow">if</span> (currNode-&gt;m_junction != junction)  <span class="comment">//|| currNode != otherNode)</span></div>
<div class="line"><span class="lineno"> 1916</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; step; ++i) {</div>
<div class="line"><span class="lineno"> 1917</span>          currNode            = currNode-&gt;m_prev;</div>
<div class="line"><span class="lineno"> 1918</span>          currNode-&gt;m_visited = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1919</span>          it                  = junction-&gt;m_nodes.erase(it);</div>
<div class="line"><span class="lineno"> 1920</span>          --it;</div>
<div class="line"><span class="lineno"> 1921</span>        }</div>
<div class="line"><span class="lineno"> 1922</span>      <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1923</span>        <span class="comment">//              assert(*(it+1) == otherNode || (it+1 ==</span></div>
<div class="line"><span class="lineno"> 1924</span>        <span class="comment">// junction-&gt;m_nodes.end() &amp;&amp; *junction-&gt;m_nodes.begin() == otherNode)</span></div>
<div class="line"><span class="lineno"> 1925</span>        <span class="comment">// );</span></div>
<div class="line"><span class="lineno"> 1926</span>        <span class="keywordflow">if</span> (currNode != otherNode) {</div>
<div class="line"><span class="lineno"> 1927</span>          <a class="code hl_class" href="class_node.html">Node</a> tempNode = *otherNode;</div>
<div class="line"><span class="lineno"> 1928</span>          *otherNode    = *currNode;</div>
<div class="line"><span class="lineno"> 1929</span>          *currNode     = tempNode;</div>
<div class="line"><span class="lineno"> 1930</span>          <span class="comment">//                    it_temp =</span></div>
<div class="line"><span class="lineno"> 1931</span>          <span class="comment">// std::find(junction-&gt;m_nodes.begin(),</span></div>
<div class="line"><span class="lineno"> 1932</span>          <span class="comment">// junction-&gt;m_nodes.end(), currNode);</span></div>
<div class="line"><span class="lineno"> 1933</span>          <span class="comment">//                    assert(it_temp !=</span></div>
<div class="line"><span class="lineno"> 1934</span>          <span class="comment">// junction-&gt;m_nodes.end());</span></div>
<div class="line"><span class="lineno"> 1935</span>          <span class="comment">//                    if(it+1 ==</span></div>
<div class="line"><span class="lineno"> 1936</span>          <span class="comment">// junction-&gt;m_nodes.end())</span></div>
<div class="line"><span class="lineno"> 1937</span>          <span class="comment">//                        std::swap(*junction-&gt;m_nodes.begin(),</span></div>
<div class="line"><span class="lineno"> 1938</span>          <span class="comment">//*it_temp);</span></div>
<div class="line"><span class="lineno"> 1939</span>          <span class="comment">//                    else</span></div>
<div class="line"><span class="lineno"> 1940</span>          <span class="comment">//                        std::swap(*(it+1),</span></div>
<div class="line"><span class="lineno"> 1941</span>          <span class="comment">//*it_temp);</span></div>
<div class="line"><span class="lineno"> 1942</span>        }</div>
<div class="line"><span class="lineno"> 1943</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1944</span>      }</div>
<div class="line"><span class="lineno"> 1945</span>    }</div>
<div class="line"><span class="lineno"> 1946</span>  }</div>
<div class="line"><span class="lineno"> 1947</span>}</div>
<div class="ttc" id="aclass_node_html"><div class="ttname"><a href="class_node.html">Node</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizerOld.cpp:107</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aec5e64a4ab988c590744c621e1fe4e94" name="aec5e64a4ab988c590744c621e1fe4e94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec5e64a4ab988c590744c621e1fe4e94">&#9670;&nbsp;</a></span>createNode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_node.html">Node</a> * CenterLineVectorizer::createNode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_data_pixel.html">DataPixel</a> *&#160;</td>
          <td class="paramname"><em>pix</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1285</span>                                                     {</div>
<div class="line"><span class="lineno"> 1286</span>  <a class="code hl_class" href="class_node.html">Node</a> *node    = <span class="keyword">new</span> <a class="code hl_class" href="class_node.html">Node</a>();</div>
<div class="line"><span class="lineno"> 1287</span>  node-&gt;m_pixel = pix;</div>
<div class="line"><span class="lineno"> 1288</span>  node-&gt;m_other = pix-&gt;m_node;</div>
<div class="line"><span class="lineno"> 1289</span>  pix-&gt;m_node   = node;</div>
<div class="line"><span class="lineno"> 1290</span>  m_nodes.push_back(node);</div>
<div class="line"><span class="lineno"> 1291</span>  <span class="keywordflow">return</span> node;</div>
<div class="line"><span class="lineno"> 1292</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="abb2eaeca611b945dae5496ef1578ab58" name="abb2eaeca611b945dae5496ef1578ab58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb2eaeca611b945dae5496ef1578ab58">&#9670;&nbsp;</a></span>createNodes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::createNodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1296</span>{}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a737d432f55b524213921db37dcccf4ac" name="a737d432f55b524213921db37dcccf4ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a737d432f55b524213921db37dcccf4ac">&#9670;&nbsp;</a></span>createRegions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::createRegions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 2418</span>                                         {</div>
<div class="line"><span class="lineno"> 2419</span>  std::list&lt;ProtoRegion&gt;::iterator it_regions;</div>
<div class="line"><span class="lineno"> 2420</span>  <span class="keywordflow">for</span> (it_regions = m_protoRegions.begin(); it_regions != m_protoRegions.end();</div>
<div class="line"><span class="lineno"> 2421</span>       it_regions++) {</div>
<div class="line"><span class="lineno"> 2422</span>    assert(it_regions-&gt;m_points.size() &gt; 4);</div>
<div class="line"><span class="lineno"> 2423</span>    <a class="code hl_struct" href="class_t_stroke.html">TStroke</a> *stroke = <a class="code hl_function" href="class_t_stroke.html#a4d47a76de56f5a121aeae50098d6cc8f">TStroke::interpolate</a>(it_regions-&gt;m_points, 0.1);</div>
<div class="line"><span class="lineno"> 2424</span>    stroke-&gt;<a class="code hl_function" href="class_t_stroke.html#afa2c66ae11a70e68b3de3ce0b4cfb049">setSelfLoop</a>();</div>
<div class="line"><span class="lineno"> 2425</span>    stroke-&gt;<a class="code hl_function" href="class_t_stroke.html#a33f59dfbed74b577700351eac8c2fc7b">setStyle</a>(m_configuration.m_strokeStyleId);</div>
<div class="line"><span class="lineno"> 2426</span>    m_vimage-&gt;addStroke(stroke);</div>
<div class="line"><span class="lineno"> 2427</span> </div>
<div class="line"><span class="lineno"> 2428</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno"> 2429</span><span class="comment">    if(it_regions-&gt;m_isConvex)</span></div>
<div class="line"><span class="lineno"> 2430</span><span class="comment">            m_vimage-&gt;fill(it_regions-&gt;m_center, TPalette::DefaultStrokeStyle);</span></div>
<div class="line"><span class="lineno"> 2431</span><span class="comment">    else</span></div>
<div class="line"><span class="lineno"> 2432</span><span class="comment">    {</span></div>
<div class="line"><span class="lineno"> 2433</span><span class="comment">            TPointD internalPoint;</span></div>
<div class="line"><span class="lineno"> 2434</span><span class="comment">            internalPoint = rotate90(it_regions-&gt;m_points[1] -</span></div>
<div class="line"><span class="lineno"> 2435</span><span class="comment">it_regions-&gt;m_points[0]);</span></div>
<div class="line"><span class="lineno"> 2436</span><span class="comment">            assert(norm2(internalPoint) != 0);</span></div>
<div class="line"><span class="lineno"> 2437</span><span class="comment">            normalize(internalPoint);</span></div>
<div class="line"><span class="lineno"> 2438</span><span class="comment">            internalPoint = internalPoint*0.001 + 0.5*(it_regions-&gt;m_points[1] +</span></div>
<div class="line"><span class="lineno"> 2439</span><span class="comment">it_regions-&gt;m_points[0]);</span></div>
<div class="line"><span class="lineno"> 2440</span><span class="comment">            m_vimage-&gt;fill(internalPoint, TPalette::DefaultStrokeStyle);</span></div>
<div class="line"><span class="lineno"> 2441</span><span class="comment">    }*/</span></div>
<div class="line"><span class="lineno"> 2442</span>  }</div>
<div class="line"><span class="lineno"> 2443</span>}</div>
<div class="ttc" id="aclass_t_stroke_html"><div class="ttname"><a href="class_t_stroke.html">TStroke</a></div><div class="ttdef"><b>Definition:</b> tstroke.h:47</div></div>
<div class="ttc" id="aclass_t_stroke_html_a33f59dfbed74b577700351eac8c2fc7b"><div class="ttname"><a href="class_t_stroke.html#a33f59dfbed74b577700351eac8c2fc7b">TStroke::setStyle</a></div><div class="ttdeci">void setStyle(int styleId)</div><div class="ttdef"><b>Definition:</b> tstroke.cpp:2370</div></div>
<div class="ttc" id="aclass_t_stroke_html_a4d47a76de56f5a121aeae50098d6cc8f"><div class="ttname"><a href="class_t_stroke.html#a4d47a76de56f5a121aeae50098d6cc8f">TStroke::interpolate</a></div><div class="ttdeci">static TStroke * interpolate(const std::vector&lt; TThickPoint &gt; &amp;points, double error, bool findCorners=true)</div><div class="ttdoc">Get a stroke from a TThickPoint vector.</div><div class="ttdef"><b>Definition:</b> tstroke.cpp:3720</div></div>
<div class="ttc" id="aclass_t_stroke_html_afa2c66ae11a70e68b3de3ce0b4cfb049"><div class="ttname"><a href="class_t_stroke.html#afa2c66ae11a70e68b3de3ce0b4cfb049">TStroke::setSelfLoop</a></div><div class="ttdeci">void setSelfLoop(bool loop=true)</div><div class="ttdoc">Set a loop stroke.</div><div class="ttdef"><b>Definition:</b> tstroke.cpp:2469</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a31dc81993155e7526139b9ba23cfb8d3" name="a31dc81993155e7526139b9ba23cfb8d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31dc81993155e7526139b9ba23cfb8d3">&#9670;&nbsp;</a></span>createStrokes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::createStrokes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 2341</span>                                         {</div>
<div class="line"><span class="lineno"> 2342</span>  std::list&lt;ProtoStroke&gt;::iterator it_centerlines = m_protoStrokes.begin();</div>
<div class="line"><span class="lineno"> 2343</span>  <span class="keywordflow">for</span> (; it_centerlines != m_protoStrokes.end(); it_centerlines++) {</div>
<div class="line"><span class="lineno"> 2344</span>    <span class="keywordflow">if</span> (!it_centerlines-&gt;m_points.empty()) {</div>
<div class="line"><span class="lineno"> 2345</span>      joinProtoStrokes(&amp;(*it_centerlines));</div>
<div class="line"><span class="lineno"> 2346</span>      <span class="keywordflow">if</span> (it_centerlines-&gt;m_points.size() &lt;= 1) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 2347</span> </div>
<div class="line"><span class="lineno"> 2348</span>      std::vector&lt;TThickPoint&gt; points;</div>
<div class="line"><span class="lineno"> 2349</span>      std::deque&lt;TThickPoint&gt;::iterator it;</div>
<div class="line"><span class="lineno"> 2350</span> </div>
<div class="line"><span class="lineno"> 2351</span>      <span class="keywordflow">if</span> (m_configuration.m_smoothness &gt; 0)  <span class="comment">// gmt: prima era true</span></div>
<div class="line"><span class="lineno"> 2352</span>      {</div>
<div class="line"><span class="lineno"> 2353</span>        <span class="comment">// gmt, 30-3-2006:</span></div>
<div class="line"><span class="lineno"> 2354</span>        <span class="comment">/*</span></div>
<div class="line"><span class="lineno"> 2355</span><span class="comment">        it = it_centerlines-&gt;m_points.begin()+1;</span></div>
<div class="line"><span class="lineno"> 2356</span><span class="comment">        for(;;)</span></div>
<div class="line"><span class="lineno"> 2357</span><span class="comment">        {</span></div>
<div class="line"><span class="lineno"> 2358</span><span class="comment">                if( it &gt;=</span></div>
<div class="line"><span class="lineno"> 2359</span><span class="comment">        it_centerlines-&gt;m_points.end()-(m_configuration.m_smoothness+1)) break;</span></div>
<div class="line"><span class="lineno"> 2360</span><span class="comment">                for(int j=0; j&lt;m_configuration.m_smoothness;j++)</span></div>
<div class="line"><span class="lineno"> 2361</span><span class="comment">                        it = it_centerlines-&gt;m_points.erase(it);</span></div>
<div class="line"><span class="lineno"> 2362</span><span class="comment">                ++it;</span></div>
<div class="line"><span class="lineno"> 2363</span><span class="comment">        }</span></div>
<div class="line"><span class="lineno"> 2364</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno"> 2365</span>        <span class="comment">// gmt. credo che l&#39;idea sia di lasciare un punto e</span></div>
<div class="line"><span class="lineno"> 2366</span>        <span class="comment">// toglierne m_configuration.m_smoothness e cosi&#39; via fino alla fine</span></div>
<div class="line"><span class="lineno"> 2367</span>        <span class="comment">// n.b. ho modificato il comportamento sugli eventuali ultimi punti</span></div>
<div class="line"><span class="lineno"> 2368</span>        <span class="comment">// (&lt;m_configuration.m_smoothness) che prima venivano lasciati e adesso</span></div>
<div class="line"><span class="lineno"> 2369</span>        <span class="comment">// vengono tolti</span></div>
<div class="line"><span class="lineno"> 2370</span>        std::deque&lt;TThickPoint&gt; &amp;points = it_centerlines-&gt;m_points;</div>
<div class="line"><span class="lineno"> 2371</span>        it                              = points.begin();</div>
<div class="line"><span class="lineno"> 2372</span>        <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno"> 2373</span>          <span class="keywordflow">if</span> (it == points.end()) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2374</span>          ++it;</div>
<div class="line"><span class="lineno"> 2375</span>          <span class="keywordtype">int</span> maxD = std::distance(it, points.end());</div>
<div class="line"><span class="lineno"> 2376</span>          <span class="keywordtype">int</span> d    = tmin(maxD, m_configuration.m_smoothness);</div>
<div class="line"><span class="lineno"> 2377</span>          <span class="keywordflow">if</span> (d == 0) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2378</span>          it = points.erase(it, it + d);</div>
<div class="line"><span class="lineno"> 2379</span>        }</div>
<div class="line"><span class="lineno"> 2380</span>      }</div>
<div class="line"><span class="lineno"> 2381</span>      it = it_centerlines-&gt;m_points.begin();</div>
<div class="line"><span class="lineno"> 2382</span>      points.push_back(*it);</div>
<div class="line"><span class="lineno"> 2383</span>      assert(it-&gt;thick &gt;= THICKNESS_LIMIT);</div>
<div class="line"><span class="lineno"> 2384</span>      <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> old = *it;</div>
<div class="line"><span class="lineno"> 2385</span>      <span class="keywordflow">for</span> (it++; it != it_centerlines-&gt;m_points.end(); ++it) {</div>
<div class="line"><span class="lineno"> 2386</span>        assert(it-&gt;thick &gt;= THICKNESS_LIMIT);</div>
<div class="line"><span class="lineno"> 2387</span>        <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> point(0.5 * (*it + old), 0.5 * (it-&gt;thick + old.thick));</div>
<div class="line"><span class="lineno"> 2388</span>        points.push_back(point);</div>
<div class="line"><span class="lineno"> 2389</span>        old = *it;</div>
<div class="line"><span class="lineno"> 2390</span>      }</div>
<div class="line"><span class="lineno"> 2391</span>      points.push_back(it_centerlines-&gt;m_points.back());</div>
<div class="line"><span class="lineno"> 2392</span> </div>
<div class="line"><span class="lineno"> 2393</span>      <span class="keywordtype">int</span> n = points.size();</div>
<div class="line"><span class="lineno"> 2394</span>      <span class="keywordflow">if</span> (n &gt; 5) {</div>
<div class="line"><span class="lineno"> 2395</span>        <span class="keywordtype">double</span> *rr = <span class="keyword">new</span> <span class="keywordtype">double</span>[n];</div>
<div class="line"><span class="lineno"> 2396</span>        <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 2397</span>        <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) rr[i] = points[i].thick;</div>
<div class="line"><span class="lineno"> 2398</span>        <span class="keywordflow">for</span> (i            = 2; i &lt; n - 2; i++)</div>
<div class="line"><span class="lineno"> 2399</span>          points[i].thick = 0.8 * (1 / 5.0) * (<span class="comment">/*rr[i-4]+rr[i-3]*/</span> +rr[i - 2] +</div>
<div class="line"><span class="lineno"> 2400</span>                                               rr[i - 1] + rr[i] + rr[i + 1] +</div>
<div class="line"><span class="lineno"> 2401</span>                                               rr[i + 2] <span class="comment">/*+rr[i+3]+rr[i+4]*/</span>);</div>
<div class="line"><span class="lineno"> 2402</span>        points[0].thick = points[1].thick =</div>
<div class="line"><span class="lineno"> 2403</span>            points[2].thick;  <span class="comment">//=points[3].thick;//=points[4].thick;</span></div>
<div class="line"><span class="lineno"> 2404</span>        points[n - 1].thick = points[n - 2].thick =</div>
<div class="line"><span class="lineno"> 2405</span>            points[n - 3].thick;  <span class="comment">//=points[n-4].thick;//=points[n-5].thick;</span></div>
<div class="line"><span class="lineno"> 2406</span>        <span class="keyword">delete</span>[] rr;</div>
<div class="line"><span class="lineno"> 2407</span>      }</div>
<div class="line"><span class="lineno"> 2408</span>      <a class="code hl_struct" href="class_t_stroke.html">TStroke</a> *stroke =</div>
<div class="line"><span class="lineno"> 2409</span>          <a class="code hl_function" href="class_t_stroke.html#a4d47a76de56f5a121aeae50098d6cc8f">TStroke::interpolate</a>(points, m_configuration.m_interpolationError);</div>
<div class="line"><span class="lineno"> 2410</span>      stroke-&gt;<a class="code hl_function" href="class_t_stroke.html#a33f59dfbed74b577700351eac8c2fc7b">setStyle</a>(m_configuration.m_strokeStyleId);  <span class="comment">// FirstUserStyle+2);</span></div>
<div class="line"><span class="lineno"> 2411</span>      m_vimage-&gt;addStroke(stroke);</div>
<div class="line"><span class="lineno"> 2412</span>    }</div>
<div class="line"><span class="lineno"> 2413</span>  }</div>
<div class="line"><span class="lineno"> 2414</span>}</div>
<div class="ttc" id="aclass_t_thick_point_html"><div class="ttname"><a href="class_t_thick_point.html">TThickPoint</a></div><div class="ttdef"><b>Definition:</b> tgeometry.h:366</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aefe0ad76f88c5a267a18ef8663a11aaf" name="aefe0ad76f88c5a267a18ef8663a11aaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefe0ad76f88c5a267a18ef8663a11aaf">&#9670;&nbsp;</a></span>findOtherSide()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_node.html">Node</a> * CenterLineVectorizer::findOtherSide </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_node.html">Node</a> *&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  858</span>                                                    {</div>
<div class="line"><span class="lineno">  859</span>  <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *pix = node-&gt;m_pixel;</div>
<div class="line"><span class="lineno">  860</span> </div>
<div class="line"><span class="lineno">  861</span>  <a class="code hl_class" href="class_t_point_t.html">TPoint</a> dir = -computeGradient(pix);</div>
<div class="line"><span class="lineno">  862</span>  <span class="keywordflow">if</span> (dir == <a class="code hl_class" href="class_t_point_t.html">TPoint</a>(0, 0)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  863</span>  <a class="code hl_class" href="class_t_point_t.html">TPoint</a> d1(tsign(dir.x), 0), d2(0, tsign(dir.y));</div>
<div class="line"><span class="lineno">  864</span>  <span class="keywordtype">int</span> num = abs(dir.y), den = abs(dir.x);</div>
<div class="line"><span class="lineno">  865</span>  <span class="keywordflow">if</span> (num &gt; den) {</div>
<div class="line"><span class="lineno">  866</span>    std::swap(d1, d2);</div>
<div class="line"><span class="lineno">  867</span>    std::swap(num, den);</div>
<div class="line"><span class="lineno">  868</span>  }</div>
<div class="line"><span class="lineno">  869</span>  <a class="code hl_class" href="class_t_point_t.html">TPoint</a> pos = pix-&gt;m_pos;</div>
<div class="line"><span class="lineno">  870</span>  <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  871</span>  <span class="keywordflow">for</span> (i = 0;; i++) {</div>
<div class="line"><span class="lineno">  872</span>    <a class="code hl_class" href="class_t_point_t.html">TPoint</a> q(pos.x + d1.x * i + d2.x * num * i / den,</div>
<div class="line"><span class="lineno">  873</span>             pos.y + d1.y * i + d2.y * num * i / den);</div>
<div class="line"><span class="lineno">  874</span>    <span class="comment">// if (!m_dataRaster-&gt;getBounds().contains(q)) break;</span></div>
<div class="line"><span class="lineno">  875</span>    <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *nextPix = m_dataRaster-&gt;pixels(q.y) + q.x;</div>
<div class="line"><span class="lineno">  876</span>    <span class="keywordflow">if</span> (nextPix-&gt;m_ink == <span class="keyword">false</span>) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  877</span>    pix = nextPix;</div>
<div class="line"><span class="lineno">  878</span>  }</div>
<div class="line"><span class="lineno">  879</span>  assert(pix);</div>
<div class="line"><span class="lineno">  880</span>  <span class="keywordflow">if</span> (!pix-&gt;m_node) {</div>
<div class="line"><span class="lineno">  881</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> wrap = m_dataRaster-&gt;getWrap();</div>
<div class="line"><span class="lineno">  882</span>    <span class="keywordflow">if</span> (pix[-1].m_node)</div>
<div class="line"><span class="lineno">  883</span>      pix--;</div>
<div class="line"><span class="lineno">  884</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pix[1].m_node)</div>
<div class="line"><span class="lineno">  885</span>      pix++;</div>
<div class="line"><span class="lineno">  886</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pix[wrap].m_node)</div>
<div class="line"><span class="lineno">  887</span>      pix += wrap;</div>
<div class="line"><span class="lineno">  888</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pix[-wrap].m_node)</div>
<div class="line"><span class="lineno">  889</span>      pix -= wrap;</div>
<div class="line"><span class="lineno">  890</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  891</span>      assert(0);</div>
<div class="line"><span class="lineno">  892</span>    }</div>
<div class="line"><span class="lineno">  893</span>  }</div>
<div class="line"><span class="lineno">  894</span>  <span class="keywordflow">if</span> (!pix-&gt;m_node) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  895</span>  <a class="code hl_class" href="class_node.html">Node</a> *q                                 = pix-&gt;m_node;</div>
<div class="line"><span class="lineno">  896</span>  <span class="keywordflow">while</span> (q-&gt;m_pixel == 0 &amp;&amp; q-&gt;m_other) q = q-&gt;m_other;</div>
<div class="line"><span class="lineno">  897</span>  assert(q &amp;&amp; q-&gt;m_pixel == pix);</div>
<div class="line"><span class="lineno">  898</span> </div>
<div class="line"><span class="lineno">  899</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 5; i++) {</div>
<div class="line"><span class="lineno">  900</span>    <span class="keywordflow">if</span> (!q-&gt;m_prev) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  901</span>    q = q-&gt;m_prev;</div>
<div class="line"><span class="lineno">  902</span>  }</div>
<div class="line"><span class="lineno">  903</span> </div>
<div class="line"><span class="lineno">  904</span>  <a class="code hl_class" href="class_node.html">Node</a> *best       = q;</div>
<div class="line"><span class="lineno">  905</span>  <span class="keywordtype">double</span> bestDist2 = computeDistance2(q, node);</div>
<div class="line"><span class="lineno">  906</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 10; i++) {</div>
<div class="line"><span class="lineno">  907</span>    q = q-&gt;m_next;</div>
<div class="line"><span class="lineno">  908</span>    <span class="keywordflow">if</span> (!q) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  909</span>    <span class="keywordtype">double</span> dist2 = computeDistance2(q, node);</div>
<div class="line"><span class="lineno">  910</span>    <span class="keywordflow">if</span> (dist2 &lt; bestDist2) {</div>
<div class="line"><span class="lineno">  911</span>      bestDist2 = dist2;</div>
<div class="line"><span class="lineno">  912</span>      best      = q;</div>
<div class="line"><span class="lineno">  913</span>    }</div>
<div class="line"><span class="lineno">  914</span>  }</div>
<div class="line"><span class="lineno">  915</span> </div>
<div class="line"><span class="lineno">  916</span>  <span class="keywordflow">return</span> best;</div>
<div class="line"><span class="lineno">  917</span>}</div>
<div class="ttc" id="aclass_data_pixel_html"><div class="ttname"><a href="class_data_pixel.html">DataPixel</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizerOld.cpp:87</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a385916cdd69ff0d1b0c0387566df51f9" name="a385916cdd69ff0d1b0c0387566df51f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a385916cdd69ff0d1b0c0387566df51f9">&#9670;&nbsp;</a></span>handleJunctions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::handleJunctions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 2074</span>                                           {</div>
<div class="line"><span class="lineno"> 2075</span>  std::vector&lt;Junction *&gt;::iterator it_junction = m_junctions.begin();</div>
<div class="line"><span class="lineno"> 2076</span>  <span class="keywordflow">for</span> (it_junction = m_junctions.begin(); it_junction &lt; m_junctions.end();</div>
<div class="line"><span class="lineno"> 2077</span>       it_junction++) {</div>
<div class="line"><span class="lineno"> 2078</span>    <a class="code hl_class" href="class_junction.html">Junction</a> *currJunction = *it_junction;</div>
<div class="line"><span class="lineno"> 2079</span> </div>
<div class="line"><span class="lineno"> 2080</span>    <span class="keywordflow">if</span> (currJunction-&gt;m_protoStrokes.empty()) {</div>
<div class="line"><span class="lineno"> 2081</span>      std::deque&lt;Node *&gt;::iterator it_node;</div>
<div class="line"><span class="lineno"> 2082</span>      <span class="keywordflow">for</span> (it_node = currJunction-&gt;m_nodes.begin();</div>
<div class="line"><span class="lineno"> 2083</span>           it_node != currJunction-&gt;m_nodes.end(); ++it_node) {</div>
<div class="line"><span class="lineno"> 2084</span>        (*it_node)-&gt;m_junction = 0;</div>
<div class="line"><span class="lineno"> 2085</span>        (*it_node)-&gt;m_visited  = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2086</span>      }</div>
<div class="line"><span class="lineno"> 2087</span>      <span class="keyword">delete</span> currJunction;</div>
<div class="line"><span class="lineno"> 2088</span>      it_junction = m_junctions.erase(it_junction);</div>
<div class="line"><span class="lineno"> 2089</span>      --it_junction;</div>
<div class="line"><span class="lineno"> 2090</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 2091</span>    }</div>
<div class="line"><span class="lineno"> 2092</span> </div>
<div class="line"><span class="lineno"> 2093</span>    std::vector&lt;ProtoStroke *&gt;::iterator it;</div>
<div class="line"><span class="lineno"> 2094</span> </div>
<div class="line"><span class="lineno"> 2095</span>    <span class="comment">// set polygon center</span></div>
<div class="line"><span class="lineno"> 2096</span>    <span class="comment">/*      double size = currJunction-&gt;m_nodes.size();</span></div>
<div class="line"><span class="lineno"> 2097</span><span class="comment">    std::deque&lt;Node*&gt;::iterator it_node;</span></div>
<div class="line"><span class="lineno"> 2098</span><span class="comment">    for(it_node = currJunction-&gt;m_nodes.begin();</span></div>
<div class="line"><span class="lineno"> 2099</span><span class="comment">it_node!=currJunction-&gt;m_nodes.end(); it_node++)</span></div>
<div class="line"><span class="lineno"> 2100</span><span class="comment">    {</span></div>
<div class="line"><span class="lineno"> 2101</span><span class="comment">            currJunction-&gt;m_center += convert( (*it_node)-&gt;m_pixel-&gt;m_pos );</span></div>
<div class="line"><span class="lineno"> 2102</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 2103</span><span class="comment">    currJunction-&gt;m_center = currJunction-&gt;m_center * (1/size);</span></div>
<div class="line"><span class="lineno"> 2104</span><span class="comment"></span> </div>
<div class="line"><span class="lineno"> 2105</span><span class="comment">    size = currJunction-&gt;m_protoStrokes.size();</span></div>
<div class="line"><span class="lineno"> 2106</span><span class="comment">    if(size == 0)</span></div>
<div class="line"><span class="lineno"> 2107</span><span class="comment">    {</span></div>
<div class="line"><span class="lineno"> 2108</span><span class="comment">            currJunction-&gt;m_center.thick = THICKNESS_LIMIT;</span></div>
<div class="line"><span class="lineno"> 2109</span><span class="comment">            continue;</span></div>
<div class="line"><span class="lineno"> 2110</span><span class="comment">    }</span></div>
<div class="line"><span class="lineno"> 2111</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno"> 2112</span>    <span class="keywordtype">double</span> size = currJunction-&gt;m_protoStrokes.size();</div>
<div class="line"><span class="lineno"> 2113</span>    <span class="keywordflow">for</span> (it = currJunction-&gt;m_protoStrokes.begin();</div>
<div class="line"><span class="lineno"> 2114</span>         it != currJunction-&gt;m_protoStrokes.end(); it++) {</div>
<div class="line"><span class="lineno"> 2115</span>      <span class="keywordflow">if</span> (((*it))-&gt;m_startJunction == currJunction &amp;&amp;</div>
<div class="line"><span class="lineno"> 2116</span>          (*it)-&gt;m_endJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2117</span>        currJunction-&gt;m_center += 0.5 * (*it)-&gt;m_points.front();</div>
<div class="line"><span class="lineno"> 2118</span>        currJunction-&gt;m_center += 0.5 * (*it)-&gt;m_points.back();</div>
<div class="line"><span class="lineno"> 2119</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((*it))-&gt;m_startJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2120</span>        currJunction-&gt;m_center += (*it)-&gt;m_points.front();</div>
<div class="line"><span class="lineno"> 2121</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*it)-&gt;m_endJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2122</span>        currJunction-&gt;m_center += (*it)-&gt;m_points.back();</div>
<div class="line"><span class="lineno"> 2123</span>      }</div>
<div class="line"><span class="lineno"> 2124</span>    }</div>
<div class="line"><span class="lineno"> 2125</span>    currJunction-&gt;m_center = currJunction-&gt;m_center * (1 / size);</div>
<div class="line"><span class="lineno"> 2126</span>  }</div>
<div class="line"><span class="lineno"> 2127</span> </div>
<div class="line"><span class="lineno"> 2128</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="lineno"> 2129</span>  <span class="keywordtype">int</span> j = 0;</div>
<div class="line"><span class="lineno"> 2130</span>  <span class="keywordflow">for</span> (; j &lt; (int)m_nodes.size(); j++) {</div>
<div class="line"><span class="lineno"> 2131</span>    <a class="code hl_class" href="class_node.html">Node</a> *node = m_nodes[j];</div>
<div class="line"><span class="lineno"> 2132</span>    <span class="keywordflow">if</span> (!node-&gt;m_visited &amp;&amp; node-&gt;m_pixel) {</div>
<div class="line"><span class="lineno"> 2133</span>      m_unvisitedNodes.push_back(convert(node-&gt;m_pixel-&gt;m_pos));</div>
<div class="line"><span class="lineno"> 2134</span>      <span class="comment">//            resolveUnvisitedNode(node);</span></div>
<div class="line"><span class="lineno"> 2135</span>    }</div>
<div class="line"><span class="lineno"> 2136</span>  }</div>
<div class="line"><span class="lineno"> 2137</span> </div>
<div class="line"><span class="lineno"> 2138</span>  <span class="keywordflow">for</span> (j = 0; j &lt; (int)m_nodes.size(); j++) {</div>
<div class="line"><span class="lineno"> 2139</span>    <a class="code hl_class" href="class_node.html">Node</a> *node = m_nodes[j];</div>
<div class="line"><span class="lineno"> 2140</span>    <span class="comment">//      assert(node-&gt;m_visited || !node-&gt;m_pixel);</span></div>
<div class="line"><span class="lineno"> 2141</span>    <span class="keywordflow">if</span> (node-&gt;m_pixel == 0 || node-&gt;m_flag) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 2142</span>    outputNodes(node);</div>
<div class="line"><span class="lineno"> 2143</span>  }</div>
<div class="line"><span class="lineno"> 2144</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 2145</span> </div>
<div class="line"><span class="lineno"> 2146</span>  joinJunctions();</div>
<div class="line"><span class="lineno"> 2147</span>  <span class="comment">//    return;</span></div>
<div class="line"><span class="lineno"> 2148</span>  <span class="keywordflow">for</span> (it_junction = m_junctions.begin(); it_junction &lt; m_junctions.end();</div>
<div class="line"><span class="lineno"> 2149</span>       it_junction++) {</div>
<div class="line"><span class="lineno"> 2150</span>    <a class="code hl_class" href="class_junction.html">Junction</a> *currJunction = *it_junction;</div>
<div class="line"><span class="lineno"> 2151</span>    <span class="keywordflow">if</span> (currJunction-&gt;m_center.thick &lt; 2 * THICKNESS_LIMIT)</div>
<div class="line"><span class="lineno"> 2152</span>      currJunction-&gt;m_center.thick = 2 * THICKNESS_LIMIT;</div>
<div class="line"><span class="lineno"> 2153</span> </div>
<div class="line"><span class="lineno"> 2154</span>    std::vector&lt;ProtoStroke *&gt;::iterator it, it_next;</div>
<div class="line"><span class="lineno"> 2155</span> </div>
<div class="line"><span class="lineno"> 2156</span>    createJunctionPolygon(currJunction);</div>
<div class="line"><span class="lineno"> 2157</span> </div>
<div class="line"><span class="lineno"> 2158</span>    currJunction-&gt;m_junctionOrder = currJunction-&gt;m_protoStrokes.size();</div>
<div class="line"><span class="lineno"> 2159</span> </div>
<div class="line"><span class="lineno"> 2160</span>    <span class="keywordflow">if</span> (currJunction-&gt;m_protoStrokes.size() == 3) {</div>
<div class="line"><span class="lineno"> 2161</span>      std::vector&lt;ProtoStroke *&gt;::iterator it_e =</div>
<div class="line"><span class="lineno"> 2162</span>          currJunction-&gt;m_protoStrokes.end();</div>
<div class="line"><span class="lineno"> 2163</span>      std::vector&lt;ProtoStroke *&gt;::iterator it_candidate1 = it_e,</div>
<div class="line"><span class="lineno"> 2164</span>                                           it_candidate2 = it_e;</div>
<div class="line"><span class="lineno"> 2165</span>      <span class="keywordtype">int</span> candidate1_k, candidate2_k;</div>
<div class="line"><span class="lineno"> 2166</span>      <span class="keywordtype">double</span> candidateProbability = JOIN_LIMIT;</div>
<div class="line"><span class="lineno"> 2167</span>      <span class="keywordtype">int</span> k, next_k;</div>
<div class="line"><span class="lineno"> 2168</span>      <span class="keywordflow">for</span> (it = currJunction-&gt;m_protoStrokes.begin(); it != it_e; it++) {</div>
<div class="line"><span class="lineno"> 2169</span>        <span class="keywordflow">if</span> (((*it))-&gt;m_startJunction == currJunction)</div>
<div class="line"><span class="lineno"> 2170</span>          k = 0;</div>
<div class="line"><span class="lineno"> 2171</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*it)-&gt;m_endJunction == currJunction)</div>
<div class="line"><span class="lineno"> 2172</span>          k = 1;</div>
<div class="line"><span class="lineno"> 2173</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2174</span>          assert(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 2175</span> </div>
<div class="line"><span class="lineno"> 2176</span>        <span class="keywordflow">if</span> (isFalseBranch(k, *it, 0, currJunction-&gt;m_center)) {</div>
<div class="line"><span class="lineno"> 2177</span>          currJunction-&gt;m_protoStrokes.erase(it);</div>
<div class="line"><span class="lineno"> 2178</span>          currJunction-&gt;m_locked = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2179</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 2180</span>        }</div>
<div class="line"><span class="lineno"> 2181</span> </div>
<div class="line"><span class="lineno"> 2182</span>        it_next = it;</div>
<div class="line"><span class="lineno"> 2183</span>        it_next++;</div>
<div class="line"><span class="lineno"> 2184</span>        <span class="keywordflow">for</span> (; it_next != it_e; it_next++) {</div>
<div class="line"><span class="lineno"> 2185</span>          <span class="keywordtype">double</span> probability;</div>
<div class="line"><span class="lineno"> 2186</span>          <span class="keywordflow">if</span> (((*it_next))-&gt;m_startJunction == currJunction)</div>
<div class="line"><span class="lineno"> 2187</span>            next_k = 0;</div>
<div class="line"><span class="lineno"> 2188</span>          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*it_next)-&gt;m_endJunction == currJunction)</div>
<div class="line"><span class="lineno"> 2189</span>            next_k = 1;</div>
<div class="line"><span class="lineno"> 2190</span>          <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2191</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 2192</span> </div>
<div class="line"><span class="lineno"> 2193</span>          <span class="keywordflow">if</span> (k == 0) {</div>
<div class="line"><span class="lineno"> 2194</span>            <span class="keywordflow">if</span> (next_k == 0)</div>
<div class="line"><span class="lineno"> 2195</span>              probability = 1 - norm2((*it)-&gt;m_startDirection +</div>
<div class="line"><span class="lineno"> 2196</span>                                      (*it_next)-&gt;m_startDirection);</div>
<div class="line"><span class="lineno"> 2197</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2198</span>              probability = 1 - norm2((*it)-&gt;m_startDirection +</div>
<div class="line"><span class="lineno"> 2199</span>                                      (*it_next)-&gt;m_endDirection);</div>
<div class="line"><span class="lineno"> 2200</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2201</span>            <span class="keywordflow">if</span> (next_k == 0)</div>
<div class="line"><span class="lineno"> 2202</span>              probability = 1 - norm2((*it)-&gt;m_endDirection +</div>
<div class="line"><span class="lineno"> 2203</span>                                      (*it_next)-&gt;m_startDirection);</div>
<div class="line"><span class="lineno"> 2204</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 2205</span>              probability =</div>
<div class="line"><span class="lineno"> 2206</span>                  1 - norm2((*it)-&gt;m_endDirection + (*it_next)-&gt;m_endDirection);</div>
<div class="line"><span class="lineno"> 2207</span>          }</div>
<div class="line"><span class="lineno"> 2208</span>          <span class="keywordflow">if</span> (probability &gt; candidateProbability ||</div>
<div class="line"><span class="lineno"> 2209</span>              (*it)-&gt;m_points.size() &lt; 3) {</div>
<div class="line"><span class="lineno"> 2210</span>            candidateProbability = probability;</div>
<div class="line"><span class="lineno"> 2211</span>            it_candidate1        = it;</div>
<div class="line"><span class="lineno"> 2212</span>            it_candidate2        = it_next;</div>
<div class="line"><span class="lineno"> 2213</span>            candidate1_k         = k;</div>
<div class="line"><span class="lineno"> 2214</span>            candidate2_k         = next_k;</div>
<div class="line"><span class="lineno"> 2215</span>          }</div>
<div class="line"><span class="lineno"> 2216</span>        }</div>
<div class="line"><span class="lineno"> 2217</span>      }</div>
<div class="line"><span class="lineno"> 2218</span>      <span class="keywordflow">if</span> (currJunction-&gt;m_protoStrokes.size() == 3 &amp;&amp; it_candidate1 != it_e &amp;&amp;</div>
<div class="line"><span class="lineno"> 2219</span>          it_candidate2 != it_e) {</div>
<div class="line"><span class="lineno"> 2220</span>        <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> p1 = (candidate1_k == 0)</div>
<div class="line"><span class="lineno"> 2221</span>                             ? (*it_candidate1)-&gt;m_points.front()</div>
<div class="line"><span class="lineno"> 2222</span>                             : (*it_candidate1)-&gt;m_points.back();</div>
<div class="line"><span class="lineno"> 2223</span>        <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> p2 = (candidate2_k == 0)</div>
<div class="line"><span class="lineno"> 2224</span>                             ? (*it_candidate2)-&gt;m_points.front()</div>
<div class="line"><span class="lineno"> 2225</span>                             : (*it_candidate2)-&gt;m_points.back();</div>
<div class="line"><span class="lineno"> 2226</span>        currJunction-&gt;m_center = 0.5 * (p1 + p2);</div>
<div class="line"><span class="lineno"> 2227</span>      }</div>
<div class="line"><span class="lineno"> 2228</span>    }</div>
<div class="line"><span class="lineno"> 2229</span>    <span class="keywordflow">if</span> (<span class="keyword">false</span> || currJunction-&gt;m_protoStrokes.size() == 2) {</div>
<div class="line"><span class="lineno"> 2230</span>      <a class="code hl_class" href="class_t_point_t.html">TPointD</a> a1, a2, b1, b2;</div>
<div class="line"><span class="lineno"> 2231</span> </div>
<div class="line"><span class="lineno"> 2232</span>      <span class="keywordflow">if</span> (currJunction-&gt;m_protoStrokes[0]-&gt;m_startJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2233</span>        a1 = currJunction-&gt;m_protoStrokes[0]-&gt;m_points.front();</div>
<div class="line"><span class="lineno"> 2234</span>        a2 = currJunction-&gt;m_protoStrokes[0]-&gt;m_startDirection - a1;</div>
<div class="line"><span class="lineno"> 2235</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2236</span>        assert(currJunction-&gt;m_protoStrokes[0]-&gt;m_endJunction == currJunction);</div>
<div class="line"><span class="lineno"> 2237</span>        a1 = currJunction-&gt;m_protoStrokes[0]-&gt;m_points.back();</div>
<div class="line"><span class="lineno"> 2238</span>        a2 = currJunction-&gt;m_protoStrokes[0]-&gt;m_endDirection - a1;</div>
<div class="line"><span class="lineno"> 2239</span>      }</div>
<div class="line"><span class="lineno"> 2240</span> </div>
<div class="line"><span class="lineno"> 2241</span>      <span class="keywordflow">if</span> (currJunction-&gt;m_protoStrokes[1]-&gt;m_startJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2242</span>        b1 = currJunction-&gt;m_protoStrokes[1]-&gt;m_points.front();</div>
<div class="line"><span class="lineno"> 2243</span>        b2 = currJunction-&gt;m_protoStrokes[1]-&gt;m_startDirection - b1;</div>
<div class="line"><span class="lineno"> 2244</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2245</span>        assert(currJunction-&gt;m_protoStrokes[1]-&gt;m_endJunction == currJunction);</div>
<div class="line"><span class="lineno"> 2246</span>        b1 = currJunction-&gt;m_protoStrokes[1]-&gt;m_points.back();</div>
<div class="line"><span class="lineno"> 2247</span>        b2 = currJunction-&gt;m_protoStrokes[1]-&gt;m_endDirection - b1;</div>
<div class="line"><span class="lineno"> 2248</span>      }</div>
<div class="line"><span class="lineno"> 2249</span> </div>
<div class="line"><span class="lineno"> 2250</span><span class="comment">/*          TPointD intersection;</span></div>
<div class="line"><span class="lineno"> 2251</span><span class="comment">            RectIntersectionResult res;</span></div>
<div class="line"><span class="lineno"> 2252</span><span class="comment">            res = rectsIntersect(a1, a2, b1, b2, intersection);</span></div>
<div class="line"><span class="lineno"> 2253</span><span class="comment">//          assert(res == intersected);</span></div>
<div class="line"><span class="lineno"> 2254</span><span class="comment">            if( norm(intersection - currJunction-&gt;m_center) &lt; 5 &amp;&amp; res == </span></div>
<div class="line"><span class="lineno"> 2255</span><span class="comment">intersected)</span></div>
<div class="line"><span class="lineno"> 2256</span><span class="comment">            {</span></div>
<div class="line"><span class="lineno"> 2257</span><span class="comment">                currJunction-&gt;m_center.x = intersection.x;</span></div>
<div class="line"><span class="lineno"> 2258</span><span class="comment">                currJunction-&gt;m_center.y = intersection.y;</span></div>
<div class="line"><span class="lineno"> 2259</span><span class="comment">            }</span></div>
<div class="line"><span class="lineno"> 2260</span><span class="comment">*/</span>      }</div>
<div class="line"><span class="lineno"> 2261</span> </div>
<div class="line"><span class="lineno"> 2262</span><span class="keywordflow">if</span> (<span class="keyword">true</span> || currJunction-&gt;m_nodes.size() &lt;= 12 || currJunction-&gt;isConvex()) {</div>
<div class="line"><span class="lineno"> 2263</span>  <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> junctionPoint(currJunction-&gt;m_center);</div>
<div class="line"><span class="lineno"> 2264</span>  <span class="keywordflow">for</span> (it = currJunction-&gt;m_protoStrokes.begin();</div>
<div class="line"><span class="lineno"> 2265</span>       it != currJunction-&gt;m_protoStrokes.end(); it++) {</div>
<div class="line"><span class="lineno"> 2266</span>    assert((*it)-&gt;m_startJunction == currJunction ||</div>
<div class="line"><span class="lineno"> 2267</span>           (*it)-&gt;m_endJunction == currJunction);</div>
<div class="line"><span class="lineno"> 2268</span>    <span class="keywordflow">if</span> ((*it)-&gt;m_startJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2269</span>      <a class="code hl_class" href="class_t_point_t.html">TPointD</a> deltaPoint = (*it)-&gt;m_points.front() - junctionPoint;</div>
<div class="line"><span class="lineno"> 2270</span>      <span class="keywordtype">double</span> deltaThick  = (*it)-&gt;m_points.front().thick - junctionPoint.thick;</div>
<div class="line"><span class="lineno"> 2271</span>      <span class="keywordflow">if</span> (norm2(deltaPoint) &gt; 0.2) {</div>
<div class="line"><span class="lineno"> 2272</span>        <span class="keywordflow">if</span> (norm2(deltaPoint) &gt; 2) {</div>
<div class="line"><span class="lineno"> 2273</span>          (*it)-&gt;m_points.push_front(</div>
<div class="line"><span class="lineno"> 2274</span>              <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(junctionPoint + 0.7 * deltaPoint,</div>
<div class="line"><span class="lineno"> 2275</span>                          junctionPoint.thick + 0.7 * deltaThick));</div>
<div class="line"><span class="lineno"> 2276</span>          (*it)-&gt;m_points.push_front(</div>
<div class="line"><span class="lineno"> 2277</span>              <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(junctionPoint + 0.4 * deltaPoint,</div>
<div class="line"><span class="lineno"> 2278</span>                          junctionPoint.thick + 0.4 * deltaThick));</div>
<div class="line"><span class="lineno"> 2279</span>        }</div>
<div class="line"><span class="lineno"> 2280</span>        (*it)-&gt;m_points.push_front(</div>
<div class="line"><span class="lineno"> 2281</span>            <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(junctionPoint + 0.0 * deltaPoint,</div>
<div class="line"><span class="lineno"> 2282</span>                        junctionPoint.thick + 0.0 * deltaThick));</div>
<div class="line"><span class="lineno"> 2283</span>      }</div>
<div class="line"><span class="lineno"> 2284</span>    }</div>
<div class="line"><span class="lineno"> 2285</span>    <span class="keywordflow">if</span> ((*it)-&gt;m_endJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2286</span>      <a class="code hl_class" href="class_t_point_t.html">TPointD</a> deltaPoint = (*it)-&gt;m_points.back() - junctionPoint;</div>
<div class="line"><span class="lineno"> 2287</span>      <span class="keywordtype">double</span> deltaThick  = (*it)-&gt;m_points.back().thick - junctionPoint.thick;</div>
<div class="line"><span class="lineno"> 2288</span>      <span class="keywordflow">if</span> (norm2(deltaPoint) &gt; 0.2) {</div>
<div class="line"><span class="lineno"> 2289</span>        <span class="keywordflow">if</span> (norm2(deltaPoint) &gt; 2) {</div>
<div class="line"><span class="lineno"> 2290</span>          (*it)-&gt;m_points.push_back(</div>
<div class="line"><span class="lineno"> 2291</span>              <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(junctionPoint + 0.7 * deltaPoint,</div>
<div class="line"><span class="lineno"> 2292</span>                          junctionPoint.thick + 0.7 * deltaThick));</div>
<div class="line"><span class="lineno"> 2293</span>          (*it)-&gt;m_points.push_back(</div>
<div class="line"><span class="lineno"> 2294</span>              <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(junctionPoint + 0.4 * deltaPoint,</div>
<div class="line"><span class="lineno"> 2295</span>                          junctionPoint.thick + 0.4 * deltaThick));</div>
<div class="line"><span class="lineno"> 2296</span>        }</div>
<div class="line"><span class="lineno"> 2297</span>        (*it)-&gt;m_points.push_back(</div>
<div class="line"><span class="lineno"> 2298</span>            <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(junctionPoint + 0.0 * deltaPoint,</div>
<div class="line"><span class="lineno"> 2299</span>                        junctionPoint.thick + 0.0 * deltaThick));</div>
<div class="line"><span class="lineno"> 2300</span>      }</div>
<div class="line"><span class="lineno"> 2301</span>    }</div>
<div class="line"><span class="lineno"> 2302</span>  }</div>
<div class="line"><span class="lineno"> 2303</span>} <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2304</span>  <a class="code hl_class" href="class_proto_region.html">ProtoRegion</a> region(currJunction-&gt;isConvex());</div>
<div class="line"><span class="lineno"> 2305</span>  region.m_center = currJunction-&gt;m_center;</div>
<div class="line"><span class="lineno"> 2306</span> </div>
<div class="line"><span class="lineno"> 2307</span>  std::deque&lt;Node *&gt;::iterator it_nodes;</div>
<div class="line"><span class="lineno"> 2308</span>  <span class="keywordflow">for</span> (it_nodes = currJunction-&gt;m_nodes.begin();</div>
<div class="line"><span class="lineno"> 2309</span>       it_nodes != currJunction-&gt;m_nodes.end(); it_nodes++)</div>
<div class="line"><span class="lineno"> 2310</span>    region.m_points.push_back(</div>
<div class="line"><span class="lineno"> 2311</span>        <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(convert((*it_nodes)-&gt;m_pixel-&gt;m_pos), 0.0));</div>
<div class="line"><span class="lineno"> 2312</span> </div>
<div class="line"><span class="lineno"> 2313</span>  region.m_points.push_back(<a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(</div>
<div class="line"><span class="lineno"> 2314</span>      convert((*currJunction-&gt;m_nodes.begin())-&gt;m_pixel-&gt;m_pos), 0.0));</div>
<div class="line"><span class="lineno"> 2315</span> </div>
<div class="line"><span class="lineno"> 2316</span>  m_protoRegions.push_back(region);</div>
<div class="line"><span class="lineno"> 2317</span> </div>
<div class="line"><span class="lineno"> 2318</span>  <span class="keywordflow">for</span> (it = currJunction-&gt;m_protoStrokes.begin();</div>
<div class="line"><span class="lineno"> 2319</span>       it != currJunction-&gt;m_protoStrokes.end(); it++) {</div>
<div class="line"><span class="lineno"> 2320</span>    <span class="keywordflow">if</span> ((*it)-&gt;m_startJunction == currJunction &amp;&amp;</div>
<div class="line"><span class="lineno"> 2321</span>        (*it)-&gt;m_endJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2322</span>      <span class="keywordflow">if</span> ((*it)-&gt;m_points.size() &lt; 10) (*it)-&gt;m_points.clear();</div>
<div class="line"><span class="lineno"> 2323</span>    }</div>
<div class="line"><span class="lineno"> 2324</span> </div>
<div class="line"><span class="lineno"> 2325</span>    <span class="keywordflow">if</span> ((*it)-&gt;m_startJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2326</span>      (*it)-&gt;m_startJunction = 0;</div>
<div class="line"><span class="lineno"> 2327</span>    }</div>
<div class="line"><span class="lineno"> 2328</span>    <span class="keywordflow">if</span> ((*it)-&gt;m_endJunction == currJunction) {</div>
<div class="line"><span class="lineno"> 2329</span>      (*it)-&gt;m_endJunction = 0;</div>
<div class="line"><span class="lineno"> 2330</span>    }</div>
<div class="line"><span class="lineno"> 2331</span>  }</div>
<div class="line"><span class="lineno"> 2332</span>  currJunction-&gt;m_protoStrokes.clear();</div>
<div class="line"><span class="lineno"> 2333</span>}</div>
<div class="line"><span class="lineno"> 2334</span>  }</div>
<div class="line"><span class="lineno"> 2335</span> </div>
<div class="line"><span class="lineno"> 2336</span>  <span class="comment">// handleLinks();</span></div>
<div class="line"><span class="lineno"> 2337</span>}</div>
<div class="ttc" id="aclass_junction_html"><div class="ttname"><a href="class_junction.html">Junction</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizerOld.cpp:135</div></div>
<div class="ttc" id="aclass_proto_region_html"><div class="ttname"><a href="class_proto_region.html">ProtoRegion</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizerOld.cpp:173</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa0c75b40affba85bc1dcbf14d451dc03" name="aa0c75b40affba85bc1dcbf14d451dc03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0c75b40affba85bc1dcbf14d451dc03">&#9670;&nbsp;</a></span>handleLinks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::handleLinks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1951</span>                                       {</div>
<div class="line"><span class="lineno"> 1952</span>  std::vector&lt;JunctionLink&gt;::iterator it_links;</div>
<div class="line"><span class="lineno"> 1953</span>  <span class="keywordflow">for</span> (it_links = m_links.begin(); it_links != m_links.end(); ++it_links) {</div>
<div class="line"><span class="lineno"> 1954</span>    <a class="code hl_class" href="class_proto_stroke.html">ProtoStroke</a> linkingProtoStroke;</div>
<div class="line"><span class="lineno"> 1955</span> </div>
<div class="line"><span class="lineno"> 1956</span>    <span class="comment">// initialize points</span></div>
<div class="line"><span class="lineno"> 1957</span>    <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> p1 = it_links-&gt;m_first-&gt;m_center;</div>
<div class="line"><span class="lineno"> 1958</span>    <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> p2 = it_links-&gt;m_second-&gt;m_center - p1;</div>
<div class="line"><span class="lineno"> 1959</span>    linkingProtoStroke.m_points.push_back(</div>
<div class="line"><span class="lineno"> 1960</span>        <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(p1, JUNCTION_THICKNESS_RATIO * p1.thick));</div>
<div class="line"><span class="lineno"> 1961</span>    linkingProtoStroke.m_points.push_back(<a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(</div>
<div class="line"><span class="lineno"> 1962</span>        p1 + 0.5 * p2, JUNCTION_THICKNESS_RATIO * (p1.thick + 0.5 * p2.thick)));</div>
<div class="line"><span class="lineno"> 1963</span>    linkingProtoStroke.m_points.push_back(</div>
<div class="line"><span class="lineno"> 1964</span>        <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(p1 + p2, JUNCTION_THICKNESS_RATIO * (p1.thick + p2.thick)));</div>
<div class="line"><span class="lineno"> 1965</span> </div>
<div class="line"><span class="lineno"> 1966</span>    <span class="comment">// initialize directions</span></div>
<div class="line"><span class="lineno"> 1967</span>    setEndpointsDirections(linkingProtoStroke);</div>
<div class="line"><span class="lineno"> 1968</span> </div>
<div class="line"><span class="lineno"> 1969</span>    <span class="comment">// initialize junctions</span></div>
<div class="line"><span class="lineno"> 1970</span>    <span class="comment">/*      linkingProtoStroke.m_startJunction = it_links-&gt;first;</span></div>
<div class="line"><span class="lineno"> 1971</span><span class="comment">    linkingProtoStroke.m_endJunction = it_links-&gt;second;*/</span></div>
<div class="line"><span class="lineno"> 1972</span>    m_protoStrokes.push_back(linkingProtoStroke);</div>
<div class="line"><span class="lineno"> 1973</span>    <span class="comment">/*      it_links-&gt;first-&gt;m_protoStrokes.push_back(&amp;m_protoStrokes.back());</span></div>
<div class="line"><span class="lineno"> 1974</span><span class="comment">    it_links-&gt;second-&gt;m_protoStrokes.push_back(&amp;m_protoStrokes.back());*/</span></div>
<div class="line"><span class="lineno"> 1975</span>  }</div>
<div class="line"><span class="lineno"> 1976</span>}</div>
<div class="ttc" id="aclass_proto_stroke_html"><div class="ttname"><a href="class_proto_stroke.html">ProtoStroke</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizerOld.cpp:153</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a64e746f48131a5fff831c84d8dd091c5" name="a64e746f48131a5fff831c84d8dd091c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64e746f48131a5fff831c84d8dd091c5">&#9670;&nbsp;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  725</span>                                {</div>
<div class="line"><span class="lineno">  726</span>  <span class="keywordtype">int</span> y;</div>
<div class="line"><span class="lineno">  727</span> </div>
<div class="line"><span class="lineno">  728</span>  <span class="comment">/*m_links.clear();</span></div>
<div class="line"><span class="lineno">  729</span><span class="comment">  m_protoStrokes.clear();</span></div>
<div class="line"><span class="lineno">  730</span><span class="comment">  m_protoRegions.clear();</span></div>
<div class="line"><span class="lineno">  731</span><span class="comment">  clearNodes();</span></div>
<div class="line"><span class="lineno">  732</span><span class="comment">  clearJunctions();*/</span></div>
<div class="line"><span class="lineno">  733</span> </div>
<div class="line"><span class="lineno">  734</span>  <a class="code hl_class" href="class_t_raster_p_t.html">DataRasterP</a> dataRaster = m_dataRaster;</div>
<div class="line"><span class="lineno">  735</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> wrap         = dataRaster-&gt;getWrap();</div>
<div class="line"><span class="lineno">  736</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> delta[]      = {-wrap - 1, -wrap, -wrap + 1, 1,</div>
<div class="line"><span class="lineno">  737</span>                       wrap + 1,  wrap,  wrap - 1,  -1};</div>
<div class="line"><span class="lineno">  738</span> </div>
<div class="line"><span class="lineno">  739</span>  <span class="keywordflow">for</span> (y = 1; y &lt; dataRaster-&gt;getLy() - 1; y++) {</div>
<div class="line"><span class="lineno">  740</span>    <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *pix    = dataRaster-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  741</span>    <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *endPix = pix + dataRaster-&gt;getLx() - 1;</div>
<div class="line"><span class="lineno">  742</span>    pix++;</div>
<div class="line"><span class="lineno">  743</span>    <span class="keywordflow">for</span> (pix++; pix &lt; endPix; ++pix) {</div>
<div class="line"><span class="lineno">  744</span>      <span class="keywordflow">if</span> ((pix-&gt;m_ink == <span class="keyword">false</span>) || (pix[-wrap].m_ink &amp;&amp; pix[wrap].m_ink &amp;&amp;</div>
<div class="line"><span class="lineno">  745</span>                                    pix[-1].m_ink &amp;&amp; pix[1].m_ink))</div>
<div class="line"><span class="lineno">  746</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  747</span>      <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  748</span>      <span class="keywordflow">for</span> (i = 0; i &lt; 8; i++)</div>
<div class="line"><span class="lineno">  749</span>        <span class="keywordflow">if</span> (pix[delta[i]].m_ink &amp;&amp; pix[delta[(i + 1) &amp; 0x7]].m_ink == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">  750</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  751</span>      <span class="keywordtype">int</span> start = i;</div>
<div class="line"><span class="lineno">  752</span>      <span class="keywordflow">if</span> (i == 8) <span class="keywordflow">continue</span>;  <span class="comment">// punto isolato</span></div>
<div class="line"><span class="lineno">  753</span>      <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">  754</span>        <span class="keywordtype">int</span> j = (i + 1) &amp; 0x7;</div>
<div class="line"><span class="lineno">  755</span>        assert(i &lt; 8 &amp;&amp; pix[delta[i]].m_ink);</div>
<div class="line"><span class="lineno">  756</span>        assert(j &lt; 8 &amp;&amp; pix[delta[j]].m_ink == <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  757</span>        <span class="keywordflow">do</span></div>
<div class="line"><span class="lineno">  758</span>          j = (j + 1) &amp; 0x7;</div>
<div class="line"><span class="lineno">  759</span>        <span class="keywordflow">while</span> (pix[delta[j]].m_ink == <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  760</span>        assert(j &lt; 8 &amp;&amp; pix[delta[j]].m_ink);</div>
<div class="line"><span class="lineno">  761</span>        <span class="keywordflow">if</span> (((i + 2) &amp; 0x7) != j || (i &amp; 1) == 0) {</div>
<div class="line"><span class="lineno">  762</span>          <span class="comment">// il bianco comprende anche un fianco</span></div>
<div class="line"><span class="lineno">  763</span>          link(pix, pix + delta[i], pix + delta[j]);</div>
<div class="line"><span class="lineno">  764</span>        }</div>
<div class="line"><span class="lineno">  765</span>        i = j;</div>
<div class="line"><span class="lineno">  766</span>        assert(i &lt; 8);</div>
<div class="line"><span class="lineno">  767</span>        <span class="keywordflow">while</span> (pix[delta[(i + 1) &amp; 0x7]].m_ink) i = (i + 1) &amp; 0x7;</div>
<div class="line"><span class="lineno">  768</span>        assert(i &lt; 8 &amp;&amp; pix[delta[i]].m_ink);</div>
<div class="line"><span class="lineno">  769</span>        assert(pix[delta[(i + 1) &amp; 0x7]].m_ink == <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  770</span>        <span class="keywordflow">if</span> (i == start) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  771</span>      }</div>
<div class="line"><span class="lineno">  772</span>    }</div>
<div class="line"><span class="lineno">  773</span>  }</div>
<div class="line"><span class="lineno">  774</span>}</div>
<div class="ttc" id="aclass_t_raster_p_t_html"><div class="ttname"><a href="class_t_raster_p_t.html">TRasterPT&lt; DataPixel &gt;</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8a3d7d1cd895e3ffa710592f5e0f2ccb" name="a8a3d7d1cd895e3ffa710592f5e0f2ccb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a3d7d1cd895e3ffa710592f5e0f2ccb">&#9670;&nbsp;</a></span>joinJunctions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::joinJunctions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1685</span>                                         {</div>
<div class="line"><span class="lineno"> 1686</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)m_junctions.size(); i++) {</div>
<div class="line"><span class="lineno"> 1687</span>    <a class="code hl_class" href="class_junction.html">Junction</a> *currJunction = m_junctions[i];</div>
<div class="line"><span class="lineno"> 1688</span> </div>
<div class="line"><span class="lineno"> 1689</span>    <span class="comment">//      if(currJunction-&gt;m_nodes.size() &lt;= 2) continue;</span></div>
<div class="line"><span class="lineno"> 1690</span> </div>
<div class="line"><span class="lineno"> 1691</span>    std::list&lt;JunctionMerge&gt; joinJunctions;</div>
<div class="line"><span class="lineno"> 1692</span>    joinJunctions.push_back(<a class="code hl_class" href="class_junction_merge.html">JunctionMerge</a>(currJunction));</div>
<div class="line"><span class="lineno"> 1693</span> </div>
<div class="line"><span class="lineno"> 1694</span>    <span class="comment">//      std::sort(currJunction-&gt;m_nodes.begin(),</span></div>
<div class="line"><span class="lineno"> 1695</span>    <span class="comment">// currJunction-&gt;m_nodes.end());</span></div>
<div class="line"><span class="lineno"> 1696</span>    std::deque&lt;Node *&gt;::iterator it;</div>
<div class="line"><span class="lineno"> 1697</span>    <span class="keywordflow">for</span> (it = currJunction-&gt;m_nodes.begin(); it != currJunction-&gt;m_nodes.end();</div>
<div class="line"><span class="lineno"> 1698</span>         it++) {</div>
<div class="line"><span class="lineno"> 1699</span>      <a class="code hl_class" href="class_node.html">Node</a> *currNode = *it;</div>
<div class="line"><span class="lineno"> 1700</span>      <a class="code hl_class" href="class_node.html">Node</a> *prevNode = *it;</div>
<div class="line"><span class="lineno"> 1701</span>      <a class="code hl_class" href="class_node.html">Node</a> *nextNode = *it;</div>
<div class="line"><span class="lineno"> 1702</span>      std::vector&lt;JunctionLink&gt;::iterator it_link;</div>
<div class="line"><span class="lineno"> 1703</span>      <span class="keywordtype">int</span> j;</div>
<div class="line"><span class="lineno"> 1704</span>      <span class="keywordflow">for</span> (j = 0; <span class="keyword">true</span>; ++j) {</div>
<div class="line"><span class="lineno"> 1705</span>        prevNode            = prevNode-&gt;m_prev;</div>
<div class="line"><span class="lineno"> 1706</span>        prevNode-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1707</span>        <span class="keywordflow">if</span> (prevNode-&gt;m_junction != 0 &amp;&amp; prevNode-&gt;m_junction != currJunction) {</div>
<div class="line"><span class="lineno"> 1708</span>          <span class="comment">// double junctionMaxDist = 3.5*currJunction-&gt;m_center.thick;</span></div>
<div class="line"><span class="lineno"> 1709</span>          it_link = std::find(m_links.begin(), m_links.end(),</div>
<div class="line"><span class="lineno"> 1710</span>                              <a class="code hl_class" href="class_junction_link.html">JunctionLink</a>(currJunction, prevNode-&gt;m_junction));</div>
<div class="line"><span class="lineno"> 1711</span>          <span class="comment">/*                    if( j &gt;= 1*SEARCH_WINDOW &amp;&amp;</span></div>
<div class="line"><span class="lineno"> 1712</span><span class="comment">                        norm(currJunction-&gt;m_center - prevNode-&gt;m_junction-&gt;m_center) &gt;= </span></div>
<div class="line"><span class="lineno"> 1713</span><span class="comment">junctionMaxDist)</span></div>
<div class="line"><span class="lineno"> 1714</span><span class="comment">                    {</span></div>
<div class="line"><span class="lineno"> 1715</span><span class="comment">                        assert(false);</span></div>
<div class="line"><span class="lineno"> 1716</span><span class="comment">                        if(it_link == m_links.end())</span></div>
<div class="line"><span class="lineno"> 1717</span><span class="comment">                            m_links.push_back(JunctionLink(currJunction, prevNode-&gt;m_junction));</span></div>
<div class="line"><span class="lineno"> 1718</span><span class="comment">                        else</span></div>
<div class="line"><span class="lineno"> 1719</span><span class="comment">                            ++(it_link-&gt;m_order);</span></div>
<div class="line"><span class="lineno"> 1720</span><span class="comment">                    }</span></div>
<div class="line"><span class="lineno"> 1721</span><span class="comment">                    else*/</span> <span class="keywordflow">if</span> (it_link == m_links.end() &amp;&amp;</div>
<div class="line"><span class="lineno"> 1722</span>                                                   std::find(</div>
<div class="line"><span class="lineno"> 1723</span>                                                       joinJunctions.begin(),</div>
<div class="line"><span class="lineno"> 1724</span>                                                       joinJunctions.end(),</div>
<div class="line"><span class="lineno"> 1725</span>                                                       <a class="code hl_class" href="class_junction_merge.html">JunctionMerge</a>(</div>
<div class="line"><span class="lineno"> 1726</span>                                                           prevNode</div>
<div class="line"><span class="lineno"> 1727</span>                                                               -&gt;m_junction)) ==</div>
<div class="line"><span class="lineno"> 1728</span>                                                       joinJunctions.end()) {</div>
<div class="line"><span class="lineno"> 1729</span>            joinJunctions.push_back(</div>
<div class="line"><span class="lineno"> 1730</span>                <a class="code hl_class" href="class_junction_merge.html">JunctionMerge</a>(prevNode-&gt;m_junction, currNode, prevNode, <span class="keyword">false</span>));</div>
<div class="line"><span class="lineno"> 1731</span>          }</div>
<div class="line"><span class="lineno"> 1732</span>        }</div>
<div class="line"><span class="lineno"> 1733</span>        <span class="keywordflow">if</span> (prevNode-&gt;m_visited) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1734</span>      }</div>
<div class="line"><span class="lineno"> 1735</span>      <span class="keywordflow">for</span> (j = 0; <span class="keyword">true</span>; ++j) {</div>
<div class="line"><span class="lineno"> 1736</span>        nextNode            = nextNode-&gt;m_next;</div>
<div class="line"><span class="lineno"> 1737</span>        prevNode-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1738</span>        <span class="keywordflow">if</span> (nextNode-&gt;m_junction != 0 &amp;&amp; nextNode-&gt;m_junction != currJunction) {</div>
<div class="line"><span class="lineno"> 1739</span>          <span class="comment">// double junctionMaxDist = 3.5*currJunction-&gt;m_center.thick;</span></div>
<div class="line"><span class="lineno"> 1740</span>          it_link = std::find(m_links.begin(), m_links.end(),</div>
<div class="line"><span class="lineno"> 1741</span>                              <a class="code hl_class" href="class_junction_link.html">JunctionLink</a>(currJunction, nextNode-&gt;m_junction));</div>
<div class="line"><span class="lineno"> 1742</span>          <span class="comment">/*                    if( j &gt;= 1*SEARCH_WINDOW &amp;&amp;</span></div>
<div class="line"><span class="lineno"> 1743</span><span class="comment">                        norm(currJunction-&gt;m_center - nextNode-&gt;m_junction-&gt;m_center) &gt;= </span></div>
<div class="line"><span class="lineno"> 1744</span><span class="comment">junctionMaxDist )</span></div>
<div class="line"><span class="lineno"> 1745</span><span class="comment">                    {</span></div>
<div class="line"><span class="lineno"> 1746</span><span class="comment">                        assert(false);</span></div>
<div class="line"><span class="lineno"> 1747</span><span class="comment">                        if(it_link == m_links.end())</span></div>
<div class="line"><span class="lineno"> 1748</span><span class="comment">                            m_links.push_back(JunctionLink(currJunction, nextNode-&gt;m_junction));</span></div>
<div class="line"><span class="lineno"> 1749</span><span class="comment">                        else</span></div>
<div class="line"><span class="lineno"> 1750</span><span class="comment">                            ++(it_link-&gt;m_order);</span></div>
<div class="line"><span class="lineno"> 1751</span><span class="comment">                    }</span></div>
<div class="line"><span class="lineno"> 1752</span><span class="comment">                    else*/</span> <span class="keywordflow">if</span> (it_link == m_links.end() &amp;&amp;</div>
<div class="line"><span class="lineno"> 1753</span>                                                   std::find(</div>
<div class="line"><span class="lineno"> 1754</span>                                                       joinJunctions.begin(),</div>
<div class="line"><span class="lineno"> 1755</span>                                                       joinJunctions.end(),</div>
<div class="line"><span class="lineno"> 1756</span>                                                       <a class="code hl_class" href="class_junction_merge.html">JunctionMerge</a>(</div>
<div class="line"><span class="lineno"> 1757</span>                                                           nextNode</div>
<div class="line"><span class="lineno"> 1758</span>                                                               -&gt;m_junction)) ==</div>
<div class="line"><span class="lineno"> 1759</span>                                                       joinJunctions.end()) {</div>
<div class="line"><span class="lineno"> 1760</span>            joinJunctions.push_back(</div>
<div class="line"><span class="lineno"> 1761</span>                <a class="code hl_class" href="class_junction_merge.html">JunctionMerge</a>(nextNode-&gt;m_junction, currNode, nextNode, <span class="keyword">true</span>));</div>
<div class="line"><span class="lineno"> 1762</span>          }</div>
<div class="line"><span class="lineno"> 1763</span>        }</div>
<div class="line"><span class="lineno"> 1764</span>        <span class="keywordflow">if</span> (nextNode-&gt;m_visited) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1765</span>      }</div>
<div class="line"><span class="lineno"> 1766</span>    }</div>
<div class="line"><span class="lineno"> 1767</span>    <span class="keywordflow">if</span> (joinJunctions.size() &gt; 1) {</div>
<div class="line"><span class="lineno"> 1768</span>      <span class="comment">// erase duplicate junctions</span></div>
<div class="line"><span class="lineno"> 1769</span>      <span class="comment">//            joinJunctions.sort();</span></div>
<div class="line"><span class="lineno"> 1770</span>      <span class="comment">//            std::sort(joinJunctions.begin(),</span></div>
<div class="line"><span class="lineno"> 1771</span>      <span class="comment">// joinJunctions.end());</span></div>
<div class="line"><span class="lineno"> 1772</span>      <span class="comment">//            std::list&lt;JunctionMerge&gt;::iterator it_newEnd;</span></div>
<div class="line"><span class="lineno"> 1773</span>      <span class="comment">//            it_newEnd = std::unique(joinJunctions.begin(),</span></div>
<div class="line"><span class="lineno"> 1774</span>      <span class="comment">// joinJunctions.end());</span></div>
<div class="line"><span class="lineno"> 1775</span>      <span class="comment">//            assert(it_newEnd == joinJunctions.end());</span></div>
<div class="line"><span class="lineno"> 1776</span>      <span class="comment">//            joinJunctions.erase(it_newEnd,</span></div>
<div class="line"><span class="lineno"> 1777</span>      <span class="comment">// joinJunctions.end());</span></div>
<div class="line"><span class="lineno"> 1778</span> </div>
<div class="line"><span class="lineno"> 1779</span>      <a class="code hl_class" href="class_junction.html">Junction</a> *newJunction = mergeJunctions(joinJunctions);</div>
<div class="line"><span class="lineno"> 1780</span>      assert(newJunction);</div>
<div class="line"><span class="lineno"> 1781</span>      m_junctions.push_back(newJunction);</div>
<div class="line"><span class="lineno"> 1782</span>    }</div>
<div class="line"><span class="lineno"> 1783</span>    joinJunctions.clear();</div>
<div class="line"><span class="lineno"> 1784</span>  }</div>
<div class="line"><span class="lineno"> 1785</span>}</div>
<div class="ttc" id="aclass_junction_link_html"><div class="ttname"><a href="class_junction_link.html">JunctionLink</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizerOld.cpp:198</div></div>
<div class="ttc" id="aclass_junction_merge_html"><div class="ttname"><a href="class_junction_merge.html">JunctionMerge</a></div><div class="ttdef"><b>Definition:</b> tcenterlinevectorizerOld.cpp:181</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8b6f195a993b2f2eb728f345730d35f8" name="a8b6f195a993b2f2eb728f345730d35f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b6f195a993b2f2eb728f345730d35f8">&#9670;&nbsp;</a></span>joinProtoStrokes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::joinProtoStrokes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_proto_stroke.html">ProtoStroke</a> *const&#160;</td>
          <td class="paramname"><em>dstProtoStroke</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1470</span>                                                                             {</div>
<div class="line"><span class="lineno"> 1471</span>  <span class="comment">// std::deque&lt;TThickPoint&gt; &amp;dstPoints = dstProtoStroke-&gt;m_points;</span></div>
<div class="line"><span class="lineno"> 1472</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 2; k++) {</div>
<div class="line"><span class="lineno"> 1473</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno"> 1474</span>      <a class="code hl_class" href="class_junction.html">Junction</a> *currJunction;</div>
<div class="line"><span class="lineno"> 1475</span>      <span class="keywordflow">if</span> (k == 0 &amp;&amp; !dstProtoStroke-&gt;m_startJunction)</div>
<div class="line"><span class="lineno"> 1476</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1477</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k == 0)</div>
<div class="line"><span class="lineno"> 1478</span>        currJunction = dstProtoStroke-&gt;m_startJunction;</div>
<div class="line"><span class="lineno"> 1479</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dstProtoStroke-&gt;m_endJunction)</div>
<div class="line"><span class="lineno"> 1480</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1481</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1482</span>        currJunction = dstProtoStroke-&gt;m_endJunction;</div>
<div class="line"><span class="lineno"> 1483</span> </div>
<div class="line"><span class="lineno"> 1484</span>      <span class="keywordflow">if</span> (!linkNextProtoStroke(dstProtoStroke, currJunction, k)) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1485</span>    }</div>
<div class="line"><span class="lineno"> 1486</span>  }</div>
<div class="line"><span class="lineno"> 1487</span>  std::vector&lt;ProtoStroke *&gt;::iterator it;</div>
<div class="line"><span class="lineno"> 1488</span>  <span class="keywordflow">if</span> (dstProtoStroke-&gt;m_startJunction) {</div>
<div class="line"><span class="lineno"> 1489</span>    it = std::find(dstProtoStroke-&gt;m_startJunction-&gt;m_protoStrokes.begin(),</div>
<div class="line"><span class="lineno"> 1490</span>                   dstProtoStroke-&gt;m_startJunction-&gt;m_protoStrokes.end(),</div>
<div class="line"><span class="lineno"> 1491</span>                   dstProtoStroke);</div>
<div class="line"><span class="lineno"> 1492</span>    <span class="keywordflow">if</span> (it != dstProtoStroke-&gt;m_startJunction-&gt;m_protoStrokes.end())</div>
<div class="line"><span class="lineno"> 1493</span>      dstProtoStroke-&gt;m_startJunction-&gt;m_protoStrokes.erase(it);</div>
<div class="line"><span class="lineno"> 1494</span>    dstProtoStroke-&gt;m_startJunction = 0;</div>
<div class="line"><span class="lineno"> 1495</span>  }</div>
<div class="line"><span class="lineno"> 1496</span>  <span class="keywordflow">if</span> (dstProtoStroke-&gt;m_endJunction) {</div>
<div class="line"><span class="lineno"> 1497</span>    it = std::find(dstProtoStroke-&gt;m_endJunction-&gt;m_protoStrokes.begin(),</div>
<div class="line"><span class="lineno"> 1498</span>                   dstProtoStroke-&gt;m_endJunction-&gt;m_protoStrokes.end(),</div>
<div class="line"><span class="lineno"> 1499</span>                   dstProtoStroke);</div>
<div class="line"><span class="lineno"> 1500</span>    <span class="keywordflow">if</span> (it != dstProtoStroke-&gt;m_endJunction-&gt;m_protoStrokes.end())</div>
<div class="line"><span class="lineno"> 1501</span>      dstProtoStroke-&gt;m_endJunction-&gt;m_protoStrokes.erase(it);</div>
<div class="line"><span class="lineno"> 1502</span>    dstProtoStroke-&gt;m_endJunction = 0;</div>
<div class="line"><span class="lineno"> 1503</span>  }</div>
<div class="line"><span class="lineno"> 1504</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a65157f31162e7fc32420d5b4e62e51b2" name="a65157f31162e7fc32420d5b4e62e51b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65157f31162e7fc32420d5b4e62e51b2">&#9670;&nbsp;</a></span>link()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::link </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_data_pixel.html">DataPixel</a> *&#160;</td>
          <td class="paramname"><em>pix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_data_pixel.html">DataPixel</a> *&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_data_pixel.html">DataPixel</a> *&#160;</td>
          <td class="paramname"><em>to</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  497</span>                                                   {</div>
<div class="line"><span class="lineno">  498</span>  <a class="code hl_class" href="class_node.html">Node</a> *srcNode = 0, *dstNode = 0, *node = 0;</div>
<div class="line"><span class="lineno">  499</span>  <a class="code hl_class" href="class_node.html">Node</a> *tmp;</div>
<div class="line"><span class="lineno">  500</span>  <span class="keywordflow">for</span> (tmp = pix-&gt;m_node; tmp; tmp = tmp-&gt;m_other) {</div>
<div class="line"><span class="lineno">  501</span>    <span class="keywordflow">if</span> (tmp-&gt;m_pixel == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  502</span>    <span class="keywordflow">if</span> (tmp-&gt;m_prev &amp;&amp; tmp-&gt;m_prev-&gt;m_pixel == srcPix) {</div>
<div class="line"><span class="lineno">  503</span>      assert(srcNode == 0);</div>
<div class="line"><span class="lineno">  504</span>      <span class="keywordflow">if</span> (node) {</div>
<div class="line"><span class="lineno">  505</span>        assert(node-&gt;m_next-&gt;m_pixel == dstPix);</div>
<div class="line"><span class="lineno">  506</span>        assert(node-&gt;m_prev == 0);</div>
<div class="line"><span class="lineno">  507</span>        node-&gt;m_prev        = tmp-&gt;m_prev;</div>
<div class="line"><span class="lineno">  508</span>        tmp-&gt;m_prev-&gt;m_next = node;</div>
<div class="line"><span class="lineno">  509</span>        tmp-&gt;m_next = tmp-&gt;m_prev = 0;</div>
<div class="line"><span class="lineno">  510</span>        tmp-&gt;m_pixel              = 0;</div>
<div class="line"><span class="lineno">  511</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  512</span>      }</div>
<div class="line"><span class="lineno">  513</span>      assert(tmp-&gt;m_next == 0);</div>
<div class="line"><span class="lineno">  514</span>      srcNode = tmp-&gt;m_prev;</div>
<div class="line"><span class="lineno">  515</span>      node    = tmp;</div>
<div class="line"><span class="lineno">  516</span>    }</div>
<div class="line"><span class="lineno">  517</span>    <span class="keywordflow">if</span> (tmp-&gt;m_next &amp;&amp; tmp-&gt;m_next-&gt;m_pixel == dstPix) {</div>
<div class="line"><span class="lineno">  518</span>      assert(dstNode == 0);</div>
<div class="line"><span class="lineno">  519</span>      <span class="keywordflow">if</span> (node) {</div>
<div class="line"><span class="lineno">  520</span>        assert(node-&gt;m_prev-&gt;m_pixel == srcPix);</div>
<div class="line"><span class="lineno">  521</span>        assert(node-&gt;m_next == 0);</div>
<div class="line"><span class="lineno">  522</span>        node-&gt;m_next        = tmp-&gt;m_next;</div>
<div class="line"><span class="lineno">  523</span>        tmp-&gt;m_next-&gt;m_prev = node;</div>
<div class="line"><span class="lineno">  524</span>        tmp-&gt;m_next = tmp-&gt;m_prev = 0;</div>
<div class="line"><span class="lineno">  525</span>        tmp-&gt;m_pixel              = 0;</div>
<div class="line"><span class="lineno">  526</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  527</span>      }</div>
<div class="line"><span class="lineno">  528</span>      assert(tmp-&gt;m_prev == 0);</div>
<div class="line"><span class="lineno">  529</span>      dstNode = tmp-&gt;m_next;</div>
<div class="line"><span class="lineno">  530</span>      node    = tmp;</div>
<div class="line"><span class="lineno">  531</span>    }</div>
<div class="line"><span class="lineno">  532</span>  }</div>
<div class="line"><span class="lineno">  533</span>  <span class="keywordflow">if</span> (!node) node       = createNode(pix);</div>
<div class="line"><span class="lineno">  534</span>  <span class="keywordflow">if</span> (!srcNode) srcNode = createNode(srcPix);</div>
<div class="line"><span class="lineno">  535</span>  <span class="keywordflow">if</span> (!dstNode) dstNode = createNode(dstPix);</div>
<div class="line"><span class="lineno">  536</span> </div>
<div class="line"><span class="lineno">  537</span>  <span class="keywordflow">if</span> (!node-&gt;m_next) {</div>
<div class="line"><span class="lineno">  538</span>    node-&gt;m_next = dstNode;</div>
<div class="line"><span class="lineno">  539</span>    assert(dstNode-&gt;m_prev == 0);</div>
<div class="line"><span class="lineno">  540</span>    dstNode-&gt;m_prev = node;</div>
<div class="line"><span class="lineno">  541</span>  }</div>
<div class="line"><span class="lineno">  542</span>  <span class="keywordflow">if</span> (!node-&gt;m_prev) {</div>
<div class="line"><span class="lineno">  543</span>    node-&gt;m_prev = srcNode;</div>
<div class="line"><span class="lineno">  544</span>    assert(srcNode-&gt;m_next == 0);</div>
<div class="line"><span class="lineno">  545</span>    srcNode-&gt;m_next = node;</div>
<div class="line"><span class="lineno">  546</span>  }</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>  assert(node-&gt;m_next == dstNode);</div>
<div class="line"><span class="lineno">  549</span>  assert(node-&gt;m_prev == srcNode);</div>
<div class="line"><span class="lineno">  550</span>  assert(dstNode-&gt;m_prev == node);</div>
<div class="line"><span class="lineno">  551</span>  assert(srcNode-&gt;m_next == node);</div>
<div class="line"><span class="lineno">  552</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a969e440077bf9a0c9809e63b937d6221" name="a969e440077bf9a0c9809e63b937d6221"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a969e440077bf9a0c9809e63b937d6221">&#9670;&nbsp;</a></span>linkNextProtoStroke()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CenterLineVectorizer::linkNextProtoStroke </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_proto_stroke.html">ProtoStroke</a> *const&#160;</td>
          <td class="paramname"><em>dstProtoStroke</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_junction.html">Junction</a> *const&#160;</td>
          <td class="paramname"><em>currJunction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1323</span>                                                                            {</div>
<div class="line"><span class="lineno"> 1324</span>  assert(dstProtoStroke);</div>
<div class="line"><span class="lineno"> 1325</span>  assert(currJunction);</div>
<div class="line"><span class="lineno"> 1326</span>  <span class="comment">//    if(dstProtoStroke-&gt;m_startJunction == dstProtoStroke-&gt;m_endJunction)</span></div>
<div class="line"><span class="lineno"> 1327</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1328</span>  <span class="keywordflow">if</span> (k == 0 &amp;&amp; dstProtoStroke-&gt;m_startJunction-&gt;m_locked ||</div>
<div class="line"><span class="lineno"> 1329</span>      k == 1 &amp;&amp; dstProtoStroke-&gt;m_endJunction-&gt;m_locked)</div>
<div class="line"><span class="lineno"> 1330</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1331</span> </div>
<div class="line"><span class="lineno"> 1332</span>  <a class="code hl_class" href="class_proto_stroke.html">ProtoStroke</a> *srcProtoStroke = 0;</div>
<div class="line"><span class="lineno"> 1333</span>  <a class="code hl_class" href="class_junction.html">Junction</a> *nextJunction      = 0;</div>
<div class="line"><span class="lineno"> 1334</span> </div>
<div class="line"><span class="lineno"> 1335</span>  std::vector&lt;ProtoStroke *&gt;::iterator it;</div>
<div class="line"><span class="lineno"> 1336</span>  std::vector&lt;ProtoStroke *&gt;::iterator it_e =</div>
<div class="line"><span class="lineno"> 1337</span>      currJunction-&gt;m_protoStrokes.end();</div>
<div class="line"><span class="lineno"> 1338</span>  std::vector&lt;ProtoStroke *&gt;::iterator it_candidate = it_e;</div>
<div class="line"><span class="lineno"> 1339</span>  <span class="keywordtype">double</span> candidateProbability                       = JOIN_LIMIT;</div>
<div class="line"><span class="lineno"> 1340</span>  <span class="keywordtype">int</span> candidate_k;</div>
<div class="line"><span class="lineno"> 1341</span>  <span class="keywordflow">for</span> (it = currJunction-&gt;m_protoStrokes.begin(); it != it_e; it++) {</div>
<div class="line"><span class="lineno"> 1342</span>    <span class="comment">// erase dstProtoStroke in currJunction</span></div>
<div class="line"><span class="lineno"> 1343</span>    <span class="keywordflow">if</span> (*it == dstProtoStroke) {</div>
<div class="line"><span class="lineno"> 1344</span>      it   = currJunction-&gt;m_protoStrokes.erase(it);</div>
<div class="line"><span class="lineno"> 1345</span>      it_e = currJunction-&gt;m_protoStrokes.end();</div>
<div class="line"><span class="lineno"> 1346</span>      <span class="keywordflow">if</span> (candidateProbability == JOIN_LIMIT) it_candidate = it_e;</div>
<div class="line"><span class="lineno"> 1347</span>      <span class="keywordflow">if</span> (it == it_e) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1348</span>    }</div>
<div class="line"><span class="lineno"> 1349</span>    <span class="keywordtype">double</span> probability;</div>
<div class="line"><span class="lineno"> 1350</span>    <span class="keywordtype">int</span> next_k;</div>
<div class="line"><span class="lineno"> 1351</span>    <span class="keywordflow">if</span> (((*it))-&gt;m_startJunction == currJunction)</div>
<div class="line"><span class="lineno"> 1352</span>      next_k = 0;</div>
<div class="line"><span class="lineno"> 1353</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*it)-&gt;m_endJunction == currJunction)</div>
<div class="line"><span class="lineno"> 1354</span>      next_k = 1;</div>
<div class="line"><span class="lineno"> 1355</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1356</span>      assert(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1357</span> </div>
<div class="line"><span class="lineno"> 1358</span>    <span class="keywordflow">if</span> (k == 0) {</div>
<div class="line"><span class="lineno"> 1359</span>      <span class="keywordflow">if</span> (next_k == 0)</div>
<div class="line"><span class="lineno"> 1360</span>        probability = 1 - norm2(dstProtoStroke-&gt;m_startDirection +</div>
<div class="line"><span class="lineno"> 1361</span>                                (*it)-&gt;m_startDirection);</div>
<div class="line"><span class="lineno"> 1362</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1363</span>        probability =</div>
<div class="line"><span class="lineno"> 1364</span>            1 - norm2(dstProtoStroke-&gt;m_startDirection + (*it)-&gt;m_endDirection);</div>
<div class="line"><span class="lineno"> 1365</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1366</span>      <span class="keywordflow">if</span> (next_k == 0)</div>
<div class="line"><span class="lineno"> 1367</span>        probability =</div>
<div class="line"><span class="lineno"> 1368</span>            1 - norm2(dstProtoStroke-&gt;m_endDirection + (*it)-&gt;m_startDirection);</div>
<div class="line"><span class="lineno"> 1369</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1370</span>        probability =</div>
<div class="line"><span class="lineno"> 1371</span>            1 - norm2(dstProtoStroke-&gt;m_endDirection + (*it)-&gt;m_endDirection);</div>
<div class="line"><span class="lineno"> 1372</span>    }</div>
<div class="line"><span class="lineno"> 1373</span> </div>
<div class="line"><span class="lineno"> 1374</span>    <span class="keywordflow">if</span> (probability &gt; candidateProbability ||</div>
<div class="line"><span class="lineno"> 1375</span>        <span class="comment">//          currJunction-&gt;m_junctionOrder == 2 ||</span></div>
<div class="line"><span class="lineno"> 1376</span>        (*it)-&gt;m_points.size() &lt; 3) {</div>
<div class="line"><span class="lineno"> 1377</span>      it_candidate         = it;</div>
<div class="line"><span class="lineno"> 1378</span>      candidateProbability = probability;</div>
<div class="line"><span class="lineno"> 1379</span>      candidate_k          = next_k;</div>
<div class="line"><span class="lineno"> 1380</span>    }</div>
<div class="line"><span class="lineno"> 1381</span>  }</div>
<div class="line"><span class="lineno"> 1382</span> </div>
<div class="line"><span class="lineno"> 1383</span>  <span class="keywordflow">if</span> (it_candidate == it_e) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1384</span>  srcProtoStroke = *it_candidate;</div>
<div class="line"><span class="lineno"> 1385</span>  assert(srcProtoStroke);</div>
<div class="line"><span class="lineno"> 1386</span> </div>
<div class="line"><span class="lineno"> 1387</span>  <span class="keywordflow">if</span> ((*it_candidate)-&gt;m_startJunction == (*it_candidate)-&gt;m_endJunction)</div>
<div class="line"><span class="lineno"> 1388</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1389</span>  <span class="comment">/*    if(k==0)</span></div>
<div class="line"><span class="lineno"> 1390</span><span class="comment">  {</span></div>
<div class="line"><span class="lineno"> 1391</span><span class="comment">          if(   candidate_k == 0 &amp;&amp; dstProtoStroke-&gt;m_startJunction ==</span></div>
<div class="line"><span class="lineno"> 1392</span><span class="comment">(*it_candidate)-&gt;m_endJunction ||</span></div>
<div class="line"><span class="lineno"> 1393</span><span class="comment">                  candidate_k == 1 &amp;&amp; dstProtoStroke-&gt;m_startJunction ==</span></div>
<div class="line"><span class="lineno"> 1394</span><span class="comment">(*it_candidate)-&gt;m_startJunction    )</span></div>
<div class="line"><span class="lineno"> 1395</span><span class="comment">                  return false;</span></div>
<div class="line"><span class="lineno"> 1396</span><span class="comment">  }</span></div>
<div class="line"><span class="lineno"> 1397</span><span class="comment">  else if(k==1)</span></div>
<div class="line"><span class="lineno"> 1398</span><span class="comment">  {</span></div>
<div class="line"><span class="lineno"> 1399</span><span class="comment">          if(   candidate_k == 0 &amp;&amp; dstProtoStroke-&gt;m_endJunction ==</span></div>
<div class="line"><span class="lineno"> 1400</span><span class="comment">(*it_candidate)-&gt;m_endJunction ||</span></div>
<div class="line"><span class="lineno"> 1401</span><span class="comment">                  candidate_k == 1 &amp;&amp; dstProtoStroke-&gt;m_endJunction ==</span></div>
<div class="line"><span class="lineno"> 1402</span><span class="comment">(*it_candidate)-&gt;m_startJunction    )</span></div>
<div class="line"><span class="lineno"> 1403</span><span class="comment">                  return false;</span></div>
<div class="line"><span class="lineno"> 1404</span><span class="comment">  }</span></div>
<div class="line"><span class="lineno"> 1405</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno"> 1406</span>  <span class="keywordflow">if</span> (candidate_k == 0)</div>
<div class="line"><span class="lineno"> 1407</span>    nextJunction = (*it_candidate)-&gt;m_endJunction;</div>
<div class="line"><span class="lineno"> 1408</span>  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1409</span>    nextJunction = (*it_candidate)-&gt;m_startJunction;</div>
<div class="line"><span class="lineno"> 1410</span> </div>
<div class="line"><span class="lineno"> 1411</span>  <span class="keywordflow">if</span> (k == 0) {</div>
<div class="line"><span class="lineno"> 1412</span>    <span class="keywordflow">if</span> (candidate_k == 0) {</div>
<div class="line"><span class="lineno"> 1413</span>      dstProtoStroke-&gt;m_points.insert(dstProtoStroke-&gt;m_points.begin(),</div>
<div class="line"><span class="lineno"> 1414</span>                                      srcProtoStroke-&gt;m_points.rbegin(),</div>
<div class="line"><span class="lineno"> 1415</span>                                      srcProtoStroke-&gt;m_points.rend());</div>
<div class="line"><span class="lineno"> 1416</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1417</span>      dstProtoStroke-&gt;m_points.insert(dstProtoStroke-&gt;m_points.begin(),</div>
<div class="line"><span class="lineno"> 1418</span>                                      srcProtoStroke-&gt;m_points.begin(),</div>
<div class="line"><span class="lineno"> 1419</span>                                      srcProtoStroke-&gt;m_points.end());</div>
<div class="line"><span class="lineno"> 1420</span>    }</div>
<div class="line"><span class="lineno"> 1421</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1422</span>    <span class="keywordflow">if</span> (candidate_k == 0) {</div>
<div class="line"><span class="lineno"> 1423</span>      dstProtoStroke-&gt;m_points.insert(dstProtoStroke-&gt;m_points.end(),</div>
<div class="line"><span class="lineno"> 1424</span>                                      srcProtoStroke-&gt;m_points.begin(),</div>
<div class="line"><span class="lineno"> 1425</span>                                      srcProtoStroke-&gt;m_points.end());</div>
<div class="line"><span class="lineno"> 1426</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1427</span>      dstProtoStroke-&gt;m_points.insert(dstProtoStroke-&gt;m_points.end(),</div>
<div class="line"><span class="lineno"> 1428</span>                                      srcProtoStroke-&gt;m_points.rbegin(),</div>
<div class="line"><span class="lineno"> 1429</span>                                      srcProtoStroke-&gt;m_points.rend());</div>
<div class="line"><span class="lineno"> 1430</span>    }</div>
<div class="line"><span class="lineno"> 1431</span>  }</div>
<div class="line"><span class="lineno"> 1432</span> </div>
<div class="line"><span class="lineno"> 1433</span>  srcProtoStroke-&gt;m_points.clear();</div>
<div class="line"><span class="lineno"> 1434</span>  srcProtoStroke-&gt;m_startJunction = 0;</div>
<div class="line"><span class="lineno"> 1435</span>  srcProtoStroke-&gt;m_endJunction   = 0;</div>
<div class="line"><span class="lineno"> 1436</span> </div>
<div class="line"><span class="lineno"> 1437</span>  <span class="comment">// refresh currJunction</span></div>
<div class="line"><span class="lineno"> 1438</span>  currJunction-&gt;m_protoStrokes.erase(it_candidate);</div>
<div class="line"><span class="lineno"> 1439</span> </div>
<div class="line"><span class="lineno"> 1440</span>  <span class="comment">// refresh nextJunction</span></div>
<div class="line"><span class="lineno"> 1441</span>  <span class="keywordflow">if</span> (nextJunction) {</div>
<div class="line"><span class="lineno"> 1442</span>    it = std::find(nextJunction-&gt;m_protoStrokes.begin(),</div>
<div class="line"><span class="lineno"> 1443</span>                   nextJunction-&gt;m_protoStrokes.end(), srcProtoStroke);</div>
<div class="line"><span class="lineno"> 1444</span>    assert(it != nextJunction-&gt;m_protoStrokes.end());</div>
<div class="line"><span class="lineno"> 1445</span>    nextJunction-&gt;m_protoStrokes.erase(it);</div>
<div class="line"><span class="lineno"> 1446</span>    nextJunction-&gt;m_protoStrokes.push_back(dstProtoStroke);</div>
<div class="line"><span class="lineno"> 1447</span>  }</div>
<div class="line"><span class="lineno"> 1448</span> </div>
<div class="line"><span class="lineno"> 1449</span>  <span class="keywordflow">if</span> (k == 0) {</div>
<div class="line"><span class="lineno"> 1450</span>    dstProtoStroke-&gt;m_startJunction = nextJunction;</div>
<div class="line"><span class="lineno"> 1451</span> </div>
<div class="line"><span class="lineno"> 1452</span>    <span class="keywordflow">if</span> (candidate_k == 0)</div>
<div class="line"><span class="lineno"> 1453</span>      dstProtoStroke-&gt;m_startDirection = srcProtoStroke-&gt;m_endDirection;</div>
<div class="line"><span class="lineno"> 1454</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1455</span>      dstProtoStroke-&gt;m_startDirection = srcProtoStroke-&gt;m_startDirection;</div>
<div class="line"><span class="lineno"> 1456</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1457</span>    dstProtoStroke-&gt;m_endJunction = nextJunction;</div>
<div class="line"><span class="lineno"> 1458</span> </div>
<div class="line"><span class="lineno"> 1459</span>    <span class="keywordflow">if</span> (candidate_k == 0)</div>
<div class="line"><span class="lineno"> 1460</span>      dstProtoStroke-&gt;m_endDirection = srcProtoStroke-&gt;m_endDirection;</div>
<div class="line"><span class="lineno"> 1461</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1462</span>      dstProtoStroke-&gt;m_endDirection = srcProtoStroke-&gt;m_startDirection;</div>
<div class="line"><span class="lineno"> 1463</span>  }</div>
<div class="line"><span class="lineno"> 1464</span>  <span class="keywordflow">if</span> (!nextJunction) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1465</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1466</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac876387fb568da716cf6889bbb1bd6fb" name="ac876387fb568da716cf6889bbb1bd6fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac876387fb568da716cf6889bbb1bd6fb">&#9670;&nbsp;</a></span>makeDataRaster()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::makeDataRaster </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_t_smart_pointer_t.html">TRasterP</a> &amp;&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  566</span>                                                             {</div>
<div class="line"><span class="lineno">  567</span>  m_vimage = <span class="keyword">new</span> <a class="code hl_class" href="class_t_vector_image.html">TVectorImage</a>();</div>
<div class="line"><span class="lineno">  568</span>  <span class="keywordflow">if</span> (!src) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  569</span>  m_src = src;</div>
<div class="line"><span class="lineno">  570</span> </div>
<div class="line"><span class="lineno">  571</span>  clearNodes();</div>
<div class="line"><span class="lineno">  572</span>  clearJunctions();</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>  <span class="keywordtype">int</span> ii, x, y = 0;</div>
<div class="line"><span class="lineno">  575</span>  <a class="code hl_class" href="class_t_raster_p_t.html">TRaster32P</a> srcRGBM = (<a class="code hl_class" href="class_t_raster_p_t.html">TRaster32P</a>)m_src;</div>
<div class="line"><span class="lineno">  576</span>  <a class="code hl_class" href="class_t_raster_p_t.html">TRasterCM32P</a> srcCM = (<a class="code hl_class" href="class_t_raster_p_t.html">TRasterCM32P</a>)m_src;</div>
<div class="line"><span class="lineno">  577</span>  <a class="code hl_class" href="class_t_raster_p_t.html">TRasterGR8P</a> srcGR  = (<a class="code hl_class" href="class_t_raster_p_t.html">TRasterGR8P</a>)m_src;</div>
<div class="line"><span class="lineno">  578</span> </div>
<div class="line"><span class="lineno">  579</span>  <a class="code hl_class" href="class_t_raster_p_t.html">DataRasterP</a> dataRaster(m_src-&gt;getSize().lx + 2, m_src-&gt;getSize().ly + 2);</div>
<div class="line"><span class="lineno">  580</span>  <span class="keywordtype">int</span> ly              = dataRaster-&gt;getLy();</div>
<div class="line"><span class="lineno">  581</span>  <span class="keywordtype">int</span> lx              = dataRaster-&gt;getLx();</div>
<div class="line"><span class="lineno">  582</span>  <span class="keywordtype">int</span> wrap            = dataRaster-&gt;getWrap();</div>
<div class="line"><span class="lineno">  583</span>  <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *dataPix0 = dataRaster-&gt;pixels(0);</div>
<div class="line"><span class="lineno">  584</span>  <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *dataPix1 = dataRaster-&gt;pixels(0) + m_src-&gt;getLx() + 1;</div>
<div class="line"><span class="lineno">  585</span>  <span class="keywordflow">for</span> (y = 0; y &lt; ly; y++, dataPix0 += wrap, dataPix1 += wrap) {</div>
<div class="line"><span class="lineno">  586</span>    dataPix0-&gt;m_pos.x = 0;</div>
<div class="line"><span class="lineno">  587</span>    dataPix1-&gt;m_pos.x = lx - 1;</div>
<div class="line"><span class="lineno">  588</span>    dataPix0-&gt;m_pos.y = dataPix1-&gt;m_pos.y = y;</div>
<div class="line"><span class="lineno">  589</span>    dataPix0-&gt;m_value = dataPix1-&gt;m_value = 0;</div>
<div class="line"><span class="lineno">  590</span>    dataPix0-&gt;m_ink = dataPix1-&gt;m_ink = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  591</span>    dataPix0-&gt;m_node = dataPix1-&gt;m_node = 0;</div>
<div class="line"><span class="lineno">  592</span>  }</div>
<div class="line"><span class="lineno">  593</span>  dataPix0 = dataRaster-&gt;pixels(0);</div>
<div class="line"><span class="lineno">  594</span>  dataPix1 = dataRaster-&gt;pixels(ly - 1);</div>
<div class="line"><span class="lineno">  595</span>  <span class="keywordflow">for</span> (x = 0; x &lt; lx; x++, dataPix0++, dataPix1++) {</div>
<div class="line"><span class="lineno">  596</span>    dataPix0-&gt;m_pos.x = dataPix1-&gt;m_pos.x = x;</div>
<div class="line"><span class="lineno">  597</span>    dataPix0-&gt;m_pos.y                     = 0;</div>
<div class="line"><span class="lineno">  598</span>    dataPix1-&gt;m_pos.y                     = ly - 1;</div>
<div class="line"><span class="lineno">  599</span>    dataPix0-&gt;m_value = dataPix1-&gt;m_value = 0;</div>
<div class="line"><span class="lineno">  600</span>    dataPix0-&gt;m_ink = dataPix1-&gt;m_ink = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  601</span>    dataPix0-&gt;m_node = dataPix1-&gt;m_node = 0;</div>
<div class="line"><span class="lineno">  602</span>  }</div>
<div class="line"><span class="lineno">  603</span> </div>
<div class="line"><span class="lineno">  604</span>  <span class="keywordflow">if</span> (srcRGBM) {</div>
<div class="line"><span class="lineno">  605</span>    assert(m_palette);</div>
<div class="line"><span class="lineno">  606</span>    <span class="keywordtype">int</span> inkId = m_palette-&gt;<a class="code hl_function" href="class_t_palette.html#a43a27667c3b3583b2b3e1a9f307e7b42">addStyle</a>(m_configuration.m_inkColor);</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    m_dataRasterArray.push_back(pair&lt;int, DataRasterP&gt;(inkId, dataRaster));</div>
<div class="line"><span class="lineno">  609</span>    <span class="keywordtype">int</span> maxDistance2 =</div>
<div class="line"><span class="lineno">  610</span>        m_configuration.<a class="code hl_variable" href="class_vectorizer_configuration.html#a6c193af0fd43ebee088cb2adf28181ca">m_threshold</a> * m_configuration.<a class="code hl_variable" href="class_vectorizer_configuration.html#a6c193af0fd43ebee088cb2adf28181ca">m_threshold</a>;</div>
<div class="line"><span class="lineno">  611</span> </div>
<div class="line"><span class="lineno">  612</span>    <span class="keywordflow">for</span> (y = 0; y &lt; m_src-&gt;getLy(); y++) {</div>
<div class="line"><span class="lineno">  613</span>      TPixel32 *inPix    = srcRGBM-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  614</span>      TPixel32 *inEndPix = inPix + srcRGBM-&gt;getLx();</div>
<div class="line"><span class="lineno">  615</span>      <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *dataPix = dataRaster-&gt;pixels(y + 1) + 1;</div>
<div class="line"><span class="lineno">  616</span>      x                  = 0;</div>
<div class="line"><span class="lineno">  617</span>      <span class="keywordflow">while</span> (inPix &lt; inEndPix) {</div>
<div class="line"><span class="lineno">  618</span>        *dataPix      = <a class="code hl_class" href="class_data_pixel.html">DataPixel</a>();</div>
<div class="line"><span class="lineno">  619</span>        <span class="keywordtype">int</span> distance2 = colorDistance2(m_configuration.m_inkColor, *inPix);</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>        <span class="comment">// int value = (inPix-&gt;r + 2*inPix-&gt;g + inPix-&gt;b)&gt;&gt;2;</span></div>
<div class="line"><span class="lineno">  622</span>        <span class="keywordflow">if</span> (y == 0 || y == m_src-&gt;getLy() - 1 || x == 0 ||</div>
<div class="line"><span class="lineno">  623</span>            x == m_src-&gt;getLx() - 1) {</div>
<div class="line"><span class="lineno">  624</span>          dataPix-&gt;m_value = 255;</div>
<div class="line"><span class="lineno">  625</span>          dataPix-&gt;m_ink   = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  626</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  627</span>          dataPix-&gt;m_value = (inPix-&gt;r + 2 * inPix-&gt;g + inPix-&gt;b) &gt;&gt; 2;</div>
<div class="line"><span class="lineno">  628</span>          dataPix-&gt;m_ink   = (distance2 &lt; maxDistance2);</div>
<div class="line"><span class="lineno">  629</span>        }</div>
<div class="line"><span class="lineno">  630</span>        dataPix-&gt;m_pos.x = x++;</div>
<div class="line"><span class="lineno">  631</span>        dataPix-&gt;m_pos.y = y;</div>
<div class="line"><span class="lineno">  632</span>        dataPix-&gt;m_node  = 0;</div>
<div class="line"><span class="lineno">  633</span>        <span class="comment">// dataPix-&gt;m_index = index++;</span></div>
<div class="line"><span class="lineno">  634</span>        inPix++;</div>
<div class="line"><span class="lineno">  635</span>        dataPix++;</div>
<div class="line"><span class="lineno">  636</span>      }</div>
<div class="line"><span class="lineno">  637</span>    }</div>
<div class="line"><span class="lineno">  638</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (srcGR) {</div>
<div class="line"><span class="lineno">  639</span>    assert(m_palette);</div>
<div class="line"><span class="lineno">  640</span>    <span class="keywordtype">int</span> inkId = m_palette-&gt;<a class="code hl_function" href="class_t_palette.html#a43a27667c3b3583b2b3e1a9f307e7b42">addStyle</a>(m_configuration.m_inkColor);</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>    m_dataRasterArray.push_back(pair&lt;int, DataRasterP&gt;(inkId, dataRaster));</div>
<div class="line"><span class="lineno">  643</span>    <span class="keywordtype">int</span> threshold = m_configuration.<a class="code hl_variable" href="class_vectorizer_configuration.html#a6c193af0fd43ebee088cb2adf28181ca">m_threshold</a>;</div>
<div class="line"><span class="lineno">  644</span> </div>
<div class="line"><span class="lineno">  645</span>    <span class="keywordflow">for</span> (y = 0; y &lt; m_src-&gt;getLy(); y++) {</div>
<div class="line"><span class="lineno">  646</span>      <a class="code hl_class" href="class_t_pixel_g_r8.html">TPixelGR8</a> *inPix    = srcGR-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  647</span>      <a class="code hl_class" href="class_t_pixel_g_r8.html">TPixelGR8</a> *inEndPix = inPix + srcGR-&gt;getLx();</div>
<div class="line"><span class="lineno">  648</span>      <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *dataPix  = dataRaster-&gt;pixels(y + 1) + 1;</div>
<div class="line"><span class="lineno">  649</span>      x                   = 0;</div>
<div class="line"><span class="lineno">  650</span>      <span class="keywordflow">while</span> (inPix &lt; inEndPix) {</div>
<div class="line"><span class="lineno">  651</span>        *dataPix = <a class="code hl_class" href="class_data_pixel.html">DataPixel</a>();</div>
<div class="line"><span class="lineno">  652</span>        <span class="comment">// int distance2 = colorDistance2(m_configuration.m_inkColor, *inPix);</span></div>
<div class="line"><span class="lineno">  653</span> </div>
<div class="line"><span class="lineno">  654</span>        <span class="comment">// int value = (inPix-&gt;r + 2*inPix-&gt;g + inPix-&gt;b)&gt;&gt;2;</span></div>
<div class="line"><span class="lineno">  655</span>        <span class="keywordflow">if</span> (y == 0 || y == m_src-&gt;getLy() - 1 || x == 0 ||</div>
<div class="line"><span class="lineno">  656</span>            x == m_src-&gt;getLx() - 1) {</div>
<div class="line"><span class="lineno">  657</span>          dataPix-&gt;m_value = 255;</div>
<div class="line"><span class="lineno">  658</span>          dataPix-&gt;m_ink   = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  659</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  660</span>          dataPix-&gt;m_value = inPix-&gt;value;</div>
<div class="line"><span class="lineno">  661</span>          dataPix-&gt;m_ink   = (inPix-&gt;value &lt; threshold);</div>
<div class="line"><span class="lineno">  662</span>        }</div>
<div class="line"><span class="lineno">  663</span>        dataPix-&gt;m_pos.x = x++;</div>
<div class="line"><span class="lineno">  664</span>        dataPix-&gt;m_pos.y = y;</div>
<div class="line"><span class="lineno">  665</span>        dataPix-&gt;m_node  = 0;</div>
<div class="line"><span class="lineno">  666</span>        <span class="comment">// dataPix-&gt;m_index = index++;</span></div>
<div class="line"><span class="lineno">  667</span>        inPix++;</div>
<div class="line"><span class="lineno">  668</span>        dataPix++;</div>
<div class="line"><span class="lineno">  669</span>      }</div>
<div class="line"><span class="lineno">  670</span>    }</div>
<div class="line"><span class="lineno">  671</span>  }</div>
<div class="line"><span class="lineno">  672</span> </div>
<div class="line"><span class="lineno">  673</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (srcCM) {</div>
<div class="line"><span class="lineno">  674</span>    <span class="keywordtype">int</span> currInk, nextInk = 0;</div>
<div class="line"><span class="lineno">  675</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">  676</span>      <span class="keywordtype">int</span> threshold =</div>
<div class="line"><span class="lineno">  677</span>          m_configuration.<a class="code hl_variable" href="class_vectorizer_configuration.html#a6c193af0fd43ebee088cb2adf28181ca">m_threshold</a>;  <span class="comment">// tolerance: 1-&gt;MAX thresh: 1-255</span></div>
<div class="line"><span class="lineno">  678</span>      currInk = nextInk;</div>
<div class="line"><span class="lineno">  679</span>      nextInk = 0;</div>
<div class="line"><span class="lineno">  680</span>      m_dataRasterArray.push_back(pair&lt;int, DataRasterP&gt;(currInk, dataRaster));</div>
<div class="line"><span class="lineno">  681</span> </div>
<div class="line"><span class="lineno">  682</span>      <span class="comment">// inizializza la parte centrale</span></div>
<div class="line"><span class="lineno">  683</span>      <span class="keywordflow">for</span> (y = 0; y &lt; srcCM-&gt;getLy(); y++) {</div>
<div class="line"><span class="lineno">  684</span>        <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a> *inPix    = srcCM-&gt;pixels(y);</div>
<div class="line"><span class="lineno">  685</span>        <a class="code hl_class" href="class_t_pixel_c_m32.html">TPixelCM32</a> *inEndPix = inPix + m_src-&gt;getLx();</div>
<div class="line"><span class="lineno">  686</span>        <a class="code hl_class" href="class_data_pixel.html">DataPixel</a> *dataPix   = dataRaster-&gt;pixels(y + 1) + 1;</div>
<div class="line"><span class="lineno">  687</span>        x                    = 0;</div>
<div class="line"><span class="lineno">  688</span>        <span class="keywordflow">while</span> (inPix &lt; inEndPix) {</div>
<div class="line"><span class="lineno">  689</span>          *dataPix  = <a class="code hl_class" href="class_data_pixel.html">DataPixel</a>();</div>
<div class="line"><span class="lineno">  690</span>          <span class="keywordtype">int</span> value = inPix-&gt;getTone();</div>
<div class="line"><span class="lineno">  691</span>          <span class="keywordflow">if</span> (value &lt; 255 &amp;&amp; !m_configuration.m_ignoreInkColors) {</div>
<div class="line"><span class="lineno">  692</span>            <span class="keywordtype">int</span> ink = inPix-&gt;getInk();</div>
<div class="line"><span class="lineno">  693</span>            <span class="keywordflow">if</span> (currInk == 0) {</div>
<div class="line"><span class="lineno">  694</span>              currInk                        = ink;</div>
<div class="line"><span class="lineno">  695</span>              m_dataRasterArray.back().first = ink;</div>
<div class="line"><span class="lineno">  696</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ink != currInk) {</div>
<div class="line"><span class="lineno">  697</span>              value = 255;</div>
<div class="line"><span class="lineno">  698</span>              <span class="keywordflow">if</span> (nextInk == 0) {</div>
<div class="line"><span class="lineno">  699</span>                <span class="keywordflow">for</span> (ii = 0; ii &lt; (int)m_dataRasterArray.size() - 1; ii++)</div>
<div class="line"><span class="lineno">  700</span>                  <span class="keywordflow">if</span> (m_dataRasterArray[ii].first == ink) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  701</span>                <span class="keywordflow">if</span> (ii == (<span class="keywordtype">int</span>)m_dataRasterArray.size() - 1) nextInk = ink;</div>
<div class="line"><span class="lineno">  702</span>              }</div>
<div class="line"><span class="lineno">  703</span>            }</div>
<div class="line"><span class="lineno">  704</span>          }</div>
<div class="line"><span class="lineno">  705</span>          <span class="comment">// TPixel col = m_palette-&gt;getStyle(inPix-&gt;getInk())-&gt;getMainColor();</span></div>
<div class="line"><span class="lineno">  706</span>          dataPix-&gt;m_pos.x = x++;</div>
<div class="line"><span class="lineno">  707</span>          dataPix-&gt;m_pos.y = y;</div>
<div class="line"><span class="lineno">  708</span>          dataPix-&gt;m_value = value;</div>
<div class="line"><span class="lineno">  709</span>          dataPix-&gt;m_ink   = (value &lt; threshold);</div>
<div class="line"><span class="lineno">  710</span>          dataPix-&gt;m_node  = 0;</div>
<div class="line"><span class="lineno">  711</span>          <span class="comment">// dataPix-&gt;m_index = index++;</span></div>
<div class="line"><span class="lineno">  712</span>          inPix++;</div>
<div class="line"><span class="lineno">  713</span>          dataPix++;</div>
<div class="line"><span class="lineno">  714</span>        }</div>
<div class="line"><span class="lineno">  715</span>      }</div>
<div class="line"><span class="lineno">  716</span>    } <span class="keywordflow">while</span> (nextInk != 0);</div>
<div class="line"><span class="lineno">  717</span>    <span class="keywordflow">if</span> (m_configuration.m_ignoreInkColors) {</div>
<div class="line"><span class="lineno">  718</span>      assert(m_dataRasterArray.size() == 1);</div>
<div class="line"><span class="lineno">  719</span>      m_dataRasterArray.back().first = 1;</div>
<div class="line"><span class="lineno">  720</span>    }</div>
<div class="line"><span class="lineno">  721</span>  } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  722</span>    assert(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  723</span>}</div>
<div class="ttc" id="aclass_t_palette_html_a43a27667c3b3583b2b3e1a9f307e7b42"><div class="ttname"><a href="class_t_palette.html#a43a27667c3b3583b2b3e1a9f307e7b42">TPalette::addStyle</a></div><div class="ttdeci">int addStyle(TColorStyle *style)</div><div class="ttdef"><b>Definition:</b> tpalette.cpp:314</div></div>
<div class="ttc" id="aclass_t_pixel_c_m32_html"><div class="ttname"><a href="class_t_pixel_c_m32.html">TPixelCM32</a></div><div class="ttdoc">Toonz5.0 color-map, 12+12+8 bits (ink,paint,tone)</div><div class="ttdef"><b>Definition:</b> tpixelcm.h:22</div></div>
<div class="ttc" id="aclass_t_pixel_g_r8_html"><div class="ttname"><a href="class_t_pixel_g_r8.html">TPixelGR8</a></div><div class="ttdef"><b>Definition:</b> tpixelgr.h:35</div></div>
<div class="ttc" id="aclass_t_vector_image_html"><div class="ttname"><a href="class_t_vector_image.html">TVectorImage</a></div><div class="ttdef"><b>Definition:</b> tvectorimage.h:58</div></div>
<div class="ttc" id="aclass_vectorizer_configuration_html_a6c193af0fd43ebee088cb2adf28181ca"><div class="ttname"><a href="class_vectorizer_configuration.html#a6c193af0fd43ebee088cb2adf28181ca">VectorizerConfiguration::m_threshold</a></div><div class="ttdeci">int m_threshold</div><div class="ttdef"><b>Definition:</b> vectorizerparameters.h:54</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff37418e696de2fa49085d53c8f664e7" name="aff37418e696de2fa49085d53c8f664e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff37418e696de2fa49085d53c8f664e7">&#9670;&nbsp;</a></span>mergeJunctions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_junction.html">Junction</a> * CenterLineVectorizer::mergeJunctions </td>
          <td>(</td>
          <td class="paramtype">const std::list&lt; <a class="el" href="class_junction_merge.html">JunctionMerge</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>junctions</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1543</span>                                             {</div>
<div class="line"><span class="lineno"> 1544</span>  <a class="code hl_class" href="class_junction.html">Junction</a> *newJunction = <span class="keyword">new</span> <a class="code hl_class" href="class_junction.html">Junction</a>();</div>
<div class="line"><span class="lineno"> 1545</span> </div>
<div class="line"><span class="lineno"> 1546</span>  std::list&lt;JunctionMerge&gt;::const_iterator it_junction;</div>
<div class="line"><span class="lineno"> 1547</span>  std::deque&lt;Node *&gt;::iterator it_startNode, it_endNode;</div>
<div class="line"><span class="lineno"> 1548</span> </div>
<div class="line"><span class="lineno"> 1549</span>  <span class="keywordflow">for</span> (it_junction = junctions.begin(); it_junction != junctions.end();</div>
<div class="line"><span class="lineno"> 1550</span>       ++it_junction) {</div>
<div class="line"><span class="lineno"> 1551</span>    newJunction-&gt;m_center += it_junction-&gt;m_junction-&gt;m_center;</div>
<div class="line"><span class="lineno"> 1552</span> </div>
<div class="line"><span class="lineno"> 1553</span>    std::deque&lt;Node *&gt;::iterator it_node;</div>
<div class="line"><span class="lineno"> 1554</span>    <span class="keywordflow">if</span> (it_junction-&gt;m_startNode == 0 &amp;&amp; it_junction-&gt;m_endNode == 0) {</div>
<div class="line"><span class="lineno"> 1555</span>      <span class="keywordflow">for</span> (it_node = it_junction-&gt;m_junction-&gt;m_nodes.begin();</div>
<div class="line"><span class="lineno"> 1556</span>           it_node != it_junction-&gt;m_junction-&gt;m_nodes.end(); ++it_node) {</div>
<div class="line"><span class="lineno"> 1557</span>        (*it_node)-&gt;m_junction = newJunction;</div>
<div class="line"><span class="lineno"> 1558</span>        newJunction-&gt;m_nodes.push_back(*it_node);</div>
<div class="line"><span class="lineno"> 1559</span>      }</div>
<div class="line"><span class="lineno"> 1560</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1561</span>      <span class="comment">//            if(</span></div>
<div class="line"><span class="lineno"> 1562</span>      <span class="comment">// isContained(it_junction-&gt;m_junction-&gt;m_center, newJunction-&gt;m_nodes) )</span></div>
<div class="line"><span class="lineno"> 1563</span>      <span class="comment">// continue;</span></div>
<div class="line"><span class="lineno"> 1564</span>      <span class="comment">/*            if(</span></div>
<div class="line"><span class="lineno"> 1565</span><span class="comment">      it_junction-&gt;m_junction-&gt;m_nodes.size() &lt; 3)</span></div>
<div class="line"><span class="lineno"> 1566</span><span class="comment">      {</span></div>
<div class="line"><span class="lineno"> 1567</span><span class="comment">              std::vector&lt;ProtoStroke*&gt;::iterator it_protoStroke;</span></div>
<div class="line"><span class="lineno"> 1568</span><span class="comment">              bool ignoreJunction = false;</span></div>
<div class="line"><span class="lineno"> 1569</span><span class="comment">              for(it_protoStroke =</span></div>
<div class="line"><span class="lineno"> 1570</span><span class="comment">      it_junction-&gt;m_junction-&gt;m_protoStrokes.begin();</span></div>
<div class="line"><span class="lineno"> 1571</span><span class="comment">                      it_protoStroke!=it_junction-&gt;m_junction-&gt;m_protoStrokes.end();</span></div>
<div class="line"><span class="lineno"> 1572</span><span class="comment">                      ++it_protoStroke)</span></div>
<div class="line"><span class="lineno"> 1573</span><span class="comment">              {</span></div>
<div class="line"><span class="lineno"> 1574</span><span class="comment">                      if(   (*it_protoStroke)-&gt;m_startJunction ==</span></div>
<div class="line"><span class="lineno"> 1575</span><span class="comment">      newJunction</span></div>
<div class="line"><span class="lineno"> 1576</span><span class="comment">      ||</span></div>
<div class="line"><span class="lineno"> 1577</span><span class="comment">                              (*it_protoStroke)-&gt;m_endJunction == newJunction )</span></div>
<div class="line"><span class="lineno"> 1578</span><span class="comment">                      {</span></div>
<div class="line"><span class="lineno"> 1579</span><span class="comment">                              ignoreJunction = true;</span></div>
<div class="line"><span class="lineno"> 1580</span><span class="comment">                              break;</span></div>
<div class="line"><span class="lineno"> 1581</span><span class="comment">                      }</span></div>
<div class="line"><span class="lineno"> 1582</span><span class="comment">              }</span></div>
<div class="line"><span class="lineno"> 1583</span><span class="comment">              if(ignoreJunction) continue;</span></div>
<div class="line"><span class="lineno"> 1584</span><span class="comment">      }</span></div>
<div class="line"><span class="lineno"> 1585</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno"> 1586</span> </div>
<div class="line"><span class="lineno"> 1587</span>      it_startNode =</div>
<div class="line"><span class="lineno"> 1588</span>          std::find(newJunction-&gt;m_nodes.begin(), newJunction-&gt;m_nodes.end(),</div>
<div class="line"><span class="lineno"> 1589</span>                    it_junction-&gt;m_startNode);</div>
<div class="line"><span class="lineno"> 1590</span>      assert(it_startNode != newJunction-&gt;m_nodes.end());</div>
<div class="line"><span class="lineno"> 1591</span>      it_endNode = std::find(it_junction-&gt;m_junction-&gt;m_nodes.begin(),</div>
<div class="line"><span class="lineno"> 1592</span>                             it_junction-&gt;m_junction-&gt;m_nodes.end(),</div>
<div class="line"><span class="lineno"> 1593</span>                             it_junction-&gt;m_endNode);</div>
<div class="line"><span class="lineno"> 1594</span>      assert(it_endNode != it_junction-&gt;m_junction-&gt;m_nodes.end());</div>
<div class="line"><span class="lineno"> 1595</span> </div>
<div class="line"><span class="lineno"> 1596</span>      <span class="keywordflow">for</span> (it_node = it_junction-&gt;m_junction-&gt;m_nodes.begin();</div>
<div class="line"><span class="lineno"> 1597</span>           it_node != it_junction-&gt;m_junction-&gt;m_nodes.end(); ++it_node) {</div>
<div class="line"><span class="lineno"> 1598</span>        (*it_node)-&gt;m_junction = newJunction;</div>
<div class="line"><span class="lineno"> 1599</span>      }</div>
<div class="line"><span class="lineno"> 1600</span> </div>
<div class="line"><span class="lineno"> 1601</span>      <span class="keywordflow">if</span> (it_junction-&gt;m_isNext) {</div>
<div class="line"><span class="lineno"> 1602</span>        ++it_startNode;</div>
<div class="line"><span class="lineno"> 1603</span>        newJunction-&gt;m_nodes.insert(</div>
<div class="line"><span class="lineno"> 1604</span>            it_startNode, it_junction-&gt;m_junction-&gt;m_nodes.begin(), it_endNode);</div>
<div class="line"><span class="lineno"> 1605</span>        it_startNode =</div>
<div class="line"><span class="lineno"> 1606</span>            std::find(newJunction-&gt;m_nodes.begin(), newJunction-&gt;m_nodes.end(),</div>
<div class="line"><span class="lineno"> 1607</span>                      it_junction-&gt;m_startNode);</div>
<div class="line"><span class="lineno"> 1608</span>        assert(it_startNode != newJunction-&gt;m_nodes.end());</div>
<div class="line"><span class="lineno"> 1609</span>        ++it_startNode;</div>
<div class="line"><span class="lineno"> 1610</span>        newJunction-&gt;m_nodes.insert(it_startNode, it_endNode,</div>
<div class="line"><span class="lineno"> 1611</span>                                    it_junction-&gt;m_junction-&gt;m_nodes.end());</div>
<div class="line"><span class="lineno"> 1612</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1613</span>        ++it_endNode;</div>
<div class="line"><span class="lineno"> 1614</span>        newJunction-&gt;m_nodes.insert(</div>
<div class="line"><span class="lineno"> 1615</span>            it_startNode, it_junction-&gt;m_junction-&gt;m_nodes.begin(), it_endNode);</div>
<div class="line"><span class="lineno"> 1616</span>        it_startNode =</div>
<div class="line"><span class="lineno"> 1617</span>            std::find(newJunction-&gt;m_nodes.begin(), newJunction-&gt;m_nodes.end(),</div>
<div class="line"><span class="lineno"> 1618</span>                      it_junction-&gt;m_startNode);</div>
<div class="line"><span class="lineno"> 1619</span>        assert(it_startNode != newJunction-&gt;m_nodes.end());</div>
<div class="line"><span class="lineno"> 1620</span>        newJunction-&gt;m_nodes.insert(it_startNode, it_endNode,</div>
<div class="line"><span class="lineno"> 1621</span>                                    it_junction-&gt;m_junction-&gt;m_nodes.end());</div>
<div class="line"><span class="lineno"> 1622</span>      }</div>
<div class="line"><span class="lineno"> 1623</span>    }</div>
<div class="line"><span class="lineno"> 1624</span> </div>
<div class="line"><span class="lineno"> 1625</span>    std::vector&lt;ProtoStroke *&gt;::iterator it_protoStroke;</div>
<div class="line"><span class="lineno"> 1626</span>    <span class="keywordflow">for</span> (it_protoStroke = it_junction-&gt;m_junction-&gt;m_protoStrokes.begin();</div>
<div class="line"><span class="lineno"> 1627</span>         it_protoStroke != it_junction-&gt;m_junction-&gt;m_protoStrokes.end();</div>
<div class="line"><span class="lineno"> 1628</span>         ++it_protoStroke) {</div>
<div class="line"><span class="lineno"> 1629</span>      <span class="keywordflow">if</span> ((*it_protoStroke)-&gt;m_startJunction == it_junction-&gt;m_junction) {</div>
<div class="line"><span class="lineno"> 1630</span>        (*it_protoStroke)-&gt;m_startJunction = newJunction;</div>
<div class="line"><span class="lineno"> 1631</span>        newJunction-&gt;m_protoStrokes.push_back(*it_protoStroke);</div>
<div class="line"><span class="lineno"> 1632</span>      }</div>
<div class="line"><span class="lineno"> 1633</span>      <span class="keywordflow">if</span> ((*it_protoStroke)-&gt;m_endJunction == it_junction-&gt;m_junction) {</div>
<div class="line"><span class="lineno"> 1634</span>        (*it_protoStroke)-&gt;m_endJunction = newJunction;</div>
<div class="line"><span class="lineno"> 1635</span>        newJunction-&gt;m_protoStrokes.push_back(*it_protoStroke);</div>
<div class="line"><span class="lineno"> 1636</span>      }</div>
<div class="line"><span class="lineno"> 1637</span>    }</div>
<div class="line"><span class="lineno"> 1638</span> </div>
<div class="line"><span class="lineno"> 1639</span>    std::vector&lt;JunctionLink&gt;::iterator it_links;</div>
<div class="line"><span class="lineno"> 1640</span>    <span class="keywordflow">for</span> (it_links = m_links.begin(); it_links != m_links.end(); ++it_links) {</div>
<div class="line"><span class="lineno"> 1641</span>      <span class="keywordflow">if</span> (it_links-&gt;m_first == it_junction-&gt;m_junction)</div>
<div class="line"><span class="lineno"> 1642</span>        it_links-&gt;m_first = newJunction;</div>
<div class="line"><span class="lineno"> 1643</span>      <span class="keywordflow">if</span> (it_links-&gt;m_second == it_junction-&gt;m_junction)</div>
<div class="line"><span class="lineno"> 1644</span>        it_links-&gt;m_second = newJunction;</div>
<div class="line"><span class="lineno"> 1645</span>    }</div>
<div class="line"><span class="lineno"> 1646</span> </div>
<div class="line"><span class="lineno"> 1647</span>    <span class="comment">// erase old junction</span></div>
<div class="line"><span class="lineno"> 1648</span>    std::vector&lt;Junction *&gt;::iterator it;</div>
<div class="line"><span class="lineno"> 1649</span>    it = std::find(m_junctions.begin(), m_junctions.end(),</div>
<div class="line"><span class="lineno"> 1650</span>                   it_junction-&gt;m_junction);</div>
<div class="line"><span class="lineno"> 1651</span>    assert(it != m_junctions.end());</div>
<div class="line"><span class="lineno"> 1652</span>    <span class="keyword">delete</span> it_junction-&gt;m_junction;</div>
<div class="line"><span class="lineno"> 1653</span>    m_junctions.erase(it);</div>
<div class="line"><span class="lineno"> 1654</span>  }</div>
<div class="line"><span class="lineno"> 1655</span>  <span class="keywordtype">double</span> size           = junctions.size();</div>
<div class="line"><span class="lineno"> 1656</span>  newJunction-&gt;m_center = newJunction-&gt;m_center * (1 / size);</div>
<div class="line"><span class="lineno"> 1657</span> </div>
<div class="line"><span class="lineno"> 1658</span>  std::vector&lt;ProtoStroke *&gt;::iterator it_protoStroke;</div>
<div class="line"><span class="lineno"> 1659</span>  <span class="keywordflow">for</span> (it_protoStroke = newJunction-&gt;m_protoStrokes.begin();</div>
<div class="line"><span class="lineno"> 1660</span>       it_protoStroke != newJunction-&gt;m_protoStrokes.end(); ++it_protoStroke) {</div>
<div class="line"><span class="lineno"> 1661</span>    <span class="keywordflow">if</span> ((*it_protoStroke)-&gt;m_points.size() &lt; 6 &amp;&amp;</div>
<div class="line"><span class="lineno"> 1662</span>        (*it_protoStroke)-&gt;m_startJunction == newJunction &amp;&amp;</div>
<div class="line"><span class="lineno"> 1663</span>        (*it_protoStroke)-&gt;m_endJunction == newJunction) {</div>
<div class="line"><span class="lineno"> 1664</span>      (*it_protoStroke)-&gt;m_points.clear();</div>
<div class="line"><span class="lineno"> 1665</span>      (*it_protoStroke)-&gt;m_startJunction = (*it_protoStroke)-&gt;m_endJunction = 0;</div>
<div class="line"><span class="lineno"> 1666</span> </div>
<div class="line"><span class="lineno"> 1667</span>      <a class="code hl_class" href="class_proto_stroke.html">ProtoStroke</a> *protoStroke = *it_protoStroke;</div>
<div class="line"><span class="lineno"> 1668</span>      <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno"> 1669</span>        std::vector&lt;ProtoStroke *&gt;::iterator it;</div>
<div class="line"><span class="lineno"> 1670</span>        it = std::find(newJunction-&gt;m_protoStrokes.begin(),</div>
<div class="line"><span class="lineno"> 1671</span>                       newJunction-&gt;m_protoStrokes.end(), protoStroke);</div>
<div class="line"><span class="lineno"> 1672</span>        <span class="keywordflow">if</span> (it == newJunction-&gt;m_protoStrokes.end()) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1673</span>        newJunction-&gt;m_protoStrokes.erase(it);</div>
<div class="line"><span class="lineno"> 1674</span>      }</div>
<div class="line"><span class="lineno"> 1675</span>      <span class="keywordflow">if</span> (newJunction-&gt;m_protoStrokes.empty()) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1676</span>      it_protoStroke = newJunction-&gt;m_protoStrokes.begin();</div>
<div class="line"><span class="lineno"> 1677</span>    }</div>
<div class="line"><span class="lineno"> 1678</span>  }</div>
<div class="line"><span class="lineno"> 1679</span> </div>
<div class="line"><span class="lineno"> 1680</span>  <span class="keywordflow">return</span> newJunction;</div>
<div class="line"><span class="lineno"> 1681</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a84d22990d2965b24dd7acaf144a5198a" name="a84d22990d2965b24dd7acaf144a5198a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84d22990d2965b24dd7acaf144a5198a">&#9670;&nbsp;</a></span>testOtherSide()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CenterLineVectorizer::testOtherSide </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_node.html">Node</a> *&#160;</td>
          <td class="paramname"><em>na1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_node.html">Node</a> *&#160;</td>
          <td class="paramname"><em>nb1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>startDist2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1003</span>                                                             {</div>
<div class="line"><span class="lineno"> 1004</span>  <span class="keywordflow">if</span> (na1-&gt;m_pixel-&gt;m_pos == nb1-&gt;m_pixel-&gt;m_pos || na1-&gt;m_next == nb1 ||</div>
<div class="line"><span class="lineno"> 1005</span>      na1-&gt;m_prev == nb1 || na1-&gt;m_next-&gt;m_next == nb1 ||</div>
<div class="line"><span class="lineno"> 1006</span>      na1-&gt;m_prev-&gt;m_prev == nb1)</div>
<div class="line"><span class="lineno"> 1007</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1008</span> </div>
<div class="line"><span class="lineno"> 1009</span>  <a class="code hl_class" href="class_node.html">Node</a> *na2 = na1-&gt;m_next;</div>
<div class="line"><span class="lineno"> 1010</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; 3; ++i) {</div>
<div class="line"><span class="lineno"> 1011</span>    na2       = na2-&gt;m_next;</div>
<div class="line"><span class="lineno"> 1012</span>    <a class="code hl_class" href="class_node.html">Node</a> *nb2 = findOtherSide(na2);</div>
<div class="line"><span class="lineno"> 1013</span>    <span class="keywordflow">if</span> (nb2 == 0 &amp;&amp; i == 3) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1014</span>    <span class="keywordflow">if</span> (nb2 == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1015</span> </div>
<div class="line"><span class="lineno"> 1016</span>    <span class="keywordtype">double</span> newStartDist2                       = computeDistance2(na2, nb2);</div>
<div class="line"><span class="lineno"> 1017</span>    <span class="keywordflow">if</span> (newStartDist2 &gt; startDist2) startDist2 = newStartDist2;</div>
<div class="line"><span class="lineno"> 1018</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3 * i + 1; ++j) {</div>
<div class="line"><span class="lineno"> 1019</span>      <span class="keywordflow">if</span> (nb2 == nb1) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1020</span>      nb2 = nb2-&gt;m_next;</div>
<div class="line"><span class="lineno"> 1021</span>    }</div>
<div class="line"><span class="lineno"> 1022</span>  }</div>
<div class="line"><span class="lineno"> 1023</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1024</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa8028bc5ca943c715d0e2e83b8c5f93b" name="aa8028bc5ca943c715d0e2e83b8c5f93b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8028bc5ca943c715d0e2e83b8c5f93b">&#9670;&nbsp;</a></span>traceLine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::traceLine </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_data_pixel.html">DataPixel</a> *&#160;</td>
          <td class="paramname"><em>pix</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1092</span>                                                   {</div>
<div class="line"><span class="lineno"> 1093</span>  <a class="code hl_class" href="class_junction.html">Junction</a> *startJunction = 0;</div>
<div class="line"><span class="lineno"> 1094</span>  <a class="code hl_class" href="class_junction.html">Junction</a> *endJunction   = 0;</div>
<div class="line"><span class="lineno"> 1095</span>  assert(m_dataRaster);</div>
<div class="line"><span class="lineno"> 1096</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> wrap = m_dataRaster-&gt;getWrap();</div>
<div class="line"><span class="lineno"> 1097</span>  <span class="comment">//  TRect bounds = m_dataRaster-&gt;getBounds();</span></div>
<div class="line"><span class="lineno"> 1098</span>  <span class="keywordflow">if</span> (!pix-&gt;m_ink) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1099</span>  <span class="keywordflow">while</span> (pix-&gt;m_node == 0) pix -= wrap;</div>
<div class="line"><span class="lineno"> 1100</span> </div>
<div class="line"><span class="lineno"> 1101</span>  <a class="code hl_class" href="class_node.html">Node</a> *node                                               = pix-&gt;m_node;</div>
<div class="line"><span class="lineno"> 1102</span>  <span class="keywordflow">while</span> (node &amp;&amp; node-&gt;m_pixel == 0 &amp;&amp; node-&gt;m_other) node = node-&gt;m_other;</div>
<div class="line"><span class="lineno"> 1103</span>  assert(node &amp;&amp; node-&gt;m_pixel == pix);</div>
<div class="line"><span class="lineno"> 1104</span> </div>
<div class="line"><span class="lineno"> 1105</span>  <a class="code hl_class" href="class_node.html">Node</a> *naa = node;</div>
<div class="line"><span class="lineno"> 1106</span> </div>
<div class="line"><span class="lineno"> 1107</span>  <span class="keywordtype">bool</span> isSamePixel;</div>
<div class="line"><span class="lineno"> 1108</span>  <span class="keywordflow">if</span> (node-&gt;m_other &amp;&amp; node-&gt;m_other-&gt;m_pixel &amp;&amp;</div>
<div class="line"><span class="lineno"> 1109</span>      (node-&gt;m_pixel-&gt;m_pos == node-&gt;m_other-&gt;m_pixel-&gt;m_pos)) {</div>
<div class="line"><span class="lineno"> 1110</span>    node        = node-&gt;m_other;</div>
<div class="line"><span class="lineno"> 1111</span>    isSamePixel = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1112</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1113</span>    node        = findOtherSide(node);</div>
<div class="line"><span class="lineno"> 1114</span>    isSamePixel = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1115</span>  }</div>
<div class="line"><span class="lineno"> 1116</span>  <span class="keywordflow">if</span> (node == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1117</span>  <a class="code hl_class" href="class_node.html">Node</a> *nbb = node;</div>
<div class="line"><span class="lineno"> 1118</span> </div>
<div class="line"><span class="lineno"> 1119</span>  <span class="keywordflow">if</span> (naa-&gt;m_visited || nbb-&gt;m_visited) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1120</span> </div>
<div class="line"><span class="lineno"> 1121</span>  <span class="keywordtype">double</span> startDist2 = computeDistance2(naa, nbb);</div>
<div class="line"><span class="lineno"> 1122</span>  <span class="keywordflow">if</span> (startDist2 &gt; 2000) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1123</span>  <span class="keywordflow">if</span> (startDist2 &lt; THICKNESS_LIMIT_2) startDist2 = THICKNESS_LIMIT_2;</div>
<div class="line"><span class="lineno"> 1124</span> </div>
<div class="line"><span class="lineno"> 1125</span>  <span class="comment">// try to detect errors in findOtherSide</span></div>
<div class="line"><span class="lineno"> 1126</span>  <span class="keywordflow">if</span> (!isSamePixel &amp;&amp; !testOtherSide(naa, nbb, startDist2)) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1127</span> </div>
<div class="line"><span class="lineno"> 1128</span>  <span class="keywordtype">double</span> minDist2 = 0;</div>
<div class="line"><span class="lineno"> 1129</span>  <span class="keywordtype">double</span> maxDist2 = startDist2 + 3.0;</div>
<div class="line"><span class="lineno"> 1130</span>  <span class="keywordflow">if</span> (startDist2 &gt; 36) {</div>
<div class="line"><span class="lineno"> 1131</span>    minDist2 = startDist2 / 2;</div>
<div class="line"><span class="lineno"> 1132</span>    maxDist2 = startDist2 + 0.25 * startDist2;</div>
<div class="line"><span class="lineno"> 1133</span>  }</div>
<div class="line"><span class="lineno"> 1134</span>  <span class="keywordflow">if</span> (naa-&gt;m_next == nbb || naa-&gt;m_prev == nbb) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1135</span> </div>
<div class="line"><span class="lineno"> 1136</span>  naa-&gt;m_visited = nbb-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1137</span>  std::deque&lt;TThickPoint&gt; dpoints;</div>
<div class="line"><span class="lineno"> 1138</span> </div>
<div class="line"><span class="lineno"> 1139</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 2; k++) {</div>
<div class="line"><span class="lineno"> 1140</span>    <a class="code hl_class" href="class_node.html">Node</a> *na = naa;</div>
<div class="line"><span class="lineno"> 1141</span>    <a class="code hl_class" href="class_node.html">Node</a> *nb = nbb;</div>
<div class="line"><span class="lineno"> 1142</span> </div>
<div class="line"><span class="lineno"> 1143</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno"> 1144</span>      <a class="code hl_class" href="class_t_point_t.html">TPoint</a> &amp;pa = na-&gt;m_pixel-&gt;m_pos;</div>
<div class="line"><span class="lineno"> 1145</span>      <a class="code hl_class" href="class_t_point_t.html">TPoint</a> &amp;pb = nb-&gt;m_pixel-&gt;m_pos;</div>
<div class="line"><span class="lineno"> 1146</span>      <a class="code hl_class" href="class_t_point_t.html">TPoint</a> ba  = pb - pa;</div>
<div class="line"><span class="lineno"> 1147</span> </div>
<div class="line"><span class="lineno"> 1148</span>      <a class="code hl_class" href="class_node.html">Node</a> *na1 = na-&gt;m_next;</div>
<div class="line"><span class="lineno"> 1149</span>      <a class="code hl_class" href="class_node.html">Node</a> *nb1 = nb-&gt;m_prev;</div>
<div class="line"><span class="lineno"> 1150</span>      <span class="comment">// if (!na1 || !nb1) break;</span></div>
<div class="line"><span class="lineno"> 1151</span> </div>
<div class="line"><span class="lineno"> 1152</span>      <a class="code hl_class" href="class_t_point_t.html">TPoint</a> da = na1-&gt;m_pixel-&gt;m_pos - pb;</div>
<div class="line"><span class="lineno"> 1153</span>      <a class="code hl_class" href="class_t_point_t.html">TPoint</a> db = nb1-&gt;m_pixel-&gt;m_pos - pa;</div>
<div class="line"><span class="lineno"> 1154</span> </div>
<div class="line"><span class="lineno"> 1155</span>      <span class="keywordflow">if</span> (na1-&gt;m_junction || nb1-&gt;m_junction) {</div>
<div class="line"><span class="lineno"> 1156</span>        na1-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1157</span>        nb1-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1158</span>        <a class="code hl_class" href="class_t_point_t.html">TPointD</a> p1;</div>
<div class="line"><span class="lineno"> 1159</span>        <span class="keywordflow">if</span> (na1-&gt;m_junction &amp;&amp; nb1-&gt;m_junction) {</div>
<div class="line"><span class="lineno"> 1160</span>          <span class="comment">//                    assert(na1-&gt;m_junction ==</span></div>
<div class="line"><span class="lineno"> 1161</span>          <span class="comment">// nb1-&gt;m_junction);</span></div>
<div class="line"><span class="lineno"> 1162</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1163</span>          <span class="keywordflow">if</span> (na1-&gt;m_junction) {</div>
<div class="line"><span class="lineno"> 1164</span>            p1              = convert(nb1-&gt;m_pixel-&gt;m_pos);</div>
<div class="line"><span class="lineno"> 1165</span>            nb1-&gt;m_junction = na1-&gt;m_junction;</div>
<div class="line"><span class="lineno"> 1166</span>            na1-&gt;m_junction-&gt;m_nodes.push_front(nb1);</div>
<div class="line"><span class="lineno"> 1167</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1168</span>            p1              = convert(na1-&gt;m_pixel-&gt;m_pos);</div>
<div class="line"><span class="lineno"> 1169</span>            na1-&gt;m_junction = nb1-&gt;m_junction;</div>
<div class="line"><span class="lineno"> 1170</span>            nb1-&gt;m_junction-&gt;m_nodes.push_back(na1);</div>
<div class="line"><span class="lineno"> 1171</span>          }</div>
<div class="line"><span class="lineno"> 1172</span>        }</div>
<div class="line"><span class="lineno"> 1173</span>        <span class="keywordtype">double</span> r;</div>
<div class="line"><span class="lineno"> 1174</span>        <a class="code hl_class" href="class_t_point_t.html">TPointD</a> center;</div>
<div class="line"><span class="lineno"> 1175</span>        <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> point;</div>
<div class="line"><span class="lineno"> 1176</span> </div>
<div class="line"><span class="lineno"> 1177</span>        center                     = computeCenter(na, nb, r);</div>
<div class="line"><span class="lineno"> 1178</span>        <span class="keywordflow">if</span> (r &lt; THICKNESS_LIMIT) r = THICKNESS_LIMIT;</div>
<div class="line"><span class="lineno"> 1179</span>        point                      = <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(center, r);</div>
<div class="line"><span class="lineno"> 1180</span>        <span class="keywordflow">if</span> (k == 0)</div>
<div class="line"><span class="lineno"> 1181</span>          dpoints.push_front(point);</div>
<div class="line"><span class="lineno"> 1182</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1183</span>          dpoints.push_back(point);</div>
<div class="line"><span class="lineno"> 1184</span> </div>
<div class="line"><span class="lineno"> 1185</span>        center                     = computeCenter(na1, nb1, r);</div>
<div class="line"><span class="lineno"> 1186</span>        <span class="keywordflow">if</span> (r &lt; THICKNESS_LIMIT) r = THICKNESS_LIMIT;</div>
<div class="line"><span class="lineno"> 1187</span>        point                      = <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a>(center, r);</div>
<div class="line"><span class="lineno"> 1188</span>        <span class="keywordflow">if</span> (k == 0)</div>
<div class="line"><span class="lineno"> 1189</span>          dpoints.push_front(point);</div>
<div class="line"><span class="lineno"> 1190</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1191</span>          dpoints.push_back(point);</div>
<div class="line"><span class="lineno"> 1192</span> </div>
<div class="line"><span class="lineno"> 1193</span>        <span class="keywordflow">if</span> (k == 0)</div>
<div class="line"><span class="lineno"> 1194</span>          startJunction = na1-&gt;m_junction;</div>
<div class="line"><span class="lineno"> 1195</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1196</span>          endJunction = na1-&gt;m_junction;</div>
<div class="line"><span class="lineno"> 1197</span> </div>
<div class="line"><span class="lineno"> 1198</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1199</span>      }</div>
<div class="line"><span class="lineno"> 1200</span> </div>
<div class="line"><span class="lineno"> 1201</span>      <span class="comment">//            if(da*ba&gt;-db*ba)</span></div>
<div class="line"><span class="lineno"> 1202</span>      <span class="keywordflow">if</span> (norm2(db) &gt;= norm2(da)) {</div>
<div class="line"><span class="lineno"> 1203</span>        <span class="keywordflow">if</span> (na1-&gt;m_visited) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1204</span> </div>
<div class="line"><span class="lineno"> 1205</span>        na            = na1;</div>
<div class="line"><span class="lineno"> 1206</span>        na-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1207</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="lineno"> 1208</span>        getOutPix(na-&gt;m_pixel) = TPixel32::Red;</div>
<div class="line"><span class="lineno"> 1209</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1210</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1211</span>        <span class="keywordflow">if</span> (nb1-&gt;m_visited) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1212</span> </div>
<div class="line"><span class="lineno"> 1213</span>        nb            = nb1;</div>
<div class="line"><span class="lineno"> 1214</span>        nb-&gt;m_visited = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1215</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="lineno"> 1216</span>        getOutPix(nb-&gt;m_pixel) = TPixel32::Green;</div>
<div class="line"><span class="lineno"> 1217</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1218</span>      }</div>
<div class="line"><span class="lineno"> 1219</span>      <span class="keywordtype">double</span> distance2                = computeDistance2(na, nb);</div>
<div class="line"><span class="lineno"> 1220</span>      <span class="keywordflow">if</span> (distance2 &lt; 0.25) distance2 = 0.25;</div>
<div class="line"><span class="lineno"> 1221</span> </div>
<div class="line"><span class="lineno"> 1222</span>      <span class="keywordtype">double</span> r;</div>
<div class="line"><span class="lineno"> 1223</span>      <a class="code hl_class" href="class_t_point_t.html">TPointD</a> center             = computeCenter(na, nb, r);</div>
<div class="line"><span class="lineno"> 1224</span>      <span class="keywordflow">if</span> (r &lt; THICKNESS_LIMIT) r = THICKNESS_LIMIT;</div>
<div class="line"><span class="lineno"> 1225</span>      <a class="code hl_class" href="class_t_thick_point.html">TThickPoint</a> point(center, r);</div>
<div class="line"><span class="lineno"> 1226</span>      <a class="code hl_class" href="class_t_point_t.html">TPointI</a> pos = convert(center);</div>
<div class="line"><span class="lineno"> 1227</span>      <span class="comment">// TPixel32  *inPix = m_src-&gt;pixels(pos.y);</span></div>
<div class="line"><span class="lineno"> 1228</span>      <span class="comment">// inPix += pos.x;</span></div>
<div class="line"><span class="lineno"> 1229</span>      <span class="comment">// int value = (inPix-&gt;r + 2*inPix-&gt;g + inPix-&gt;b)&gt;&gt;2;</span></div>
<div class="line"><span class="lineno"> 1230</span> </div>
<div class="line"><span class="lineno"> 1231</span>      <span class="keywordflow">if</span> (distance2 &gt; maxDist2 || distance2 &lt; minDist2 || na-&gt;m_next == nb ||</div>
<div class="line"><span class="lineno"> 1232</span>          na-&gt;m_prev == nb</div>
<div class="line"><span class="lineno"> 1233</span>          <span class="comment">//|| isJunction(na, nb)</span></div>
<div class="line"><span class="lineno"> 1234</span>          <span class="comment">//|| !(value&lt;200)</span></div>
<div class="line"><span class="lineno"> 1235</span>          ) {</div>
<div class="line"><span class="lineno"> 1236</span>        <span class="keywordflow">if</span> (na-&gt;m_next == nb || na-&gt;m_prev == nb || na-&gt;m_next-&gt;m_next == nb ||</div>
<div class="line"><span class="lineno"> 1237</span>            na-&gt;m_prev-&gt;m_prev == nb) {</div>
<div class="line"><span class="lineno"> 1238</span>          <span class="keywordflow">if</span> (k == 0) {</div>
<div class="line"><span class="lineno"> 1239</span>            <span class="keywordflow">if</span> (!dpoints.empty()) dpoints.pop_front();</div>
<div class="line"><span class="lineno"> 1240</span>            <span class="keywordflow">if</span> (!dpoints.empty()) dpoints.pop_front();</div>
<div class="line"><span class="lineno"> 1241</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1242</span>            <span class="keywordflow">if</span> (!dpoints.empty()) dpoints.pop_back();</div>
<div class="line"><span class="lineno"> 1243</span>            <span class="keywordflow">if</span> (!dpoints.empty()) dpoints.pop_back();</div>
<div class="line"><span class="lineno"> 1244</span>          }</div>
<div class="line"><span class="lineno"> 1245</span>        }</div>
<div class="line"><span class="lineno"> 1246</span>        <span class="comment">//              if(k==0) dpoints.push_front(point);</span></div>
<div class="line"><span class="lineno"> 1247</span>        <span class="comment">//              else dpoints.push_back(point);</span></div>
<div class="line"><span class="lineno"> 1248</span>        na-&gt;m_junction = nb-&gt;m_junction = <span class="keyword">new</span> <a class="code hl_class" href="class_junction.html">Junction</a>();</div>
<div class="line"><span class="lineno"> 1249</span>        na-&gt;m_junction-&gt;m_nodes.push_back(nb);</div>
<div class="line"><span class="lineno"> 1250</span>        nb-&gt;m_junction-&gt;m_nodes.push_back(na);</div>
<div class="line"><span class="lineno"> 1251</span>        m_junctions.push_back(na-&gt;m_junction);</div>
<div class="line"><span class="lineno"> 1252</span> </div>
<div class="line"><span class="lineno"> 1253</span>        <span class="keywordflow">if</span> (k == 0)</div>
<div class="line"><span class="lineno"> 1254</span>          startJunction = na-&gt;m_junction;</div>
<div class="line"><span class="lineno"> 1255</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1256</span>          endJunction = na-&gt;m_junction;</div>
<div class="line"><span class="lineno"> 1257</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1258</span>      }</div>
<div class="line"><span class="lineno"> 1259</span>      <span class="keywordflow">if</span> (k == 0)</div>
<div class="line"><span class="lineno"> 1260</span>        dpoints.push_front(point);</div>
<div class="line"><span class="lineno"> 1261</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1262</span>        dpoints.push_back(point);</div>
<div class="line"><span class="lineno"> 1263</span>    }</div>
<div class="line"><span class="lineno"> 1264</span> </div>
<div class="line"><span class="lineno"> 1265</span>    std::swap(naa, nbb);</div>
<div class="line"><span class="lineno"> 1266</span>  }</div>
<div class="line"><span class="lineno"> 1267</span>  <span class="keywordflow">if</span> (dpoints.size() == 0)</div>
<div class="line"><span class="lineno"> 1268</span>    naa-&gt;m_visited = nbb-&gt;m_visited = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1269</span>  <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1270</span>    m_protoStrokes.push_back(<a class="code hl_class" href="class_proto_stroke.html">ProtoStroke</a>(dpoints.begin(), dpoints.end()));</div>
<div class="line"><span class="lineno"> 1271</span>    setEndpointsDirections(m_protoStrokes.back());</div>
<div class="line"><span class="lineno"> 1272</span>    <span class="keywordflow">if</span> (startJunction) {</div>
<div class="line"><span class="lineno"> 1273</span>      m_protoStrokes.back().m_startJunction = startJunction;</div>
<div class="line"><span class="lineno"> 1274</span>      startJunction-&gt;m_protoStrokes.push_back(&amp;m_protoStrokes.back());</div>
<div class="line"><span class="lineno"> 1275</span>    }</div>
<div class="line"><span class="lineno"> 1276</span>    <span class="keywordflow">if</span> (endJunction) {</div>
<div class="line"><span class="lineno"> 1277</span>      m_protoStrokes.back().m_endJunction = endJunction;</div>
<div class="line"><span class="lineno"> 1278</span>      endJunction-&gt;m_protoStrokes.push_back(&amp;m_protoStrokes.back());</div>
<div class="line"><span class="lineno"> 1279</span>    }</div>
<div class="line"><span class="lineno"> 1280</span>  }</div>
<div class="line"><span class="lineno"> 1281</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="affd8c8cd55bbd5511ec941d3e2eb3acc" name="affd8c8cd55bbd5511ec941d3e2eb3acc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affd8c8cd55bbd5511ec941d3e2eb3acc">&#9670;&nbsp;</a></span>vectorize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CenterLineVectorizer::vectorize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 2447</span>                                     {</div>
<div class="line"><span class="lineno"> 2448</span>  <span class="keywordtype">int</span> j = 0;</div>
<div class="line"><span class="lineno"> 2449</span> </div>
<div class="line"><span class="lineno"> 2450</span>  <span class="keywordflow">for</span> (j = 0; j &lt; (int)m_nodes.size(); j++) {</div>
<div class="line"><span class="lineno"> 2451</span>    <a class="code hl_class" href="class_node.html">Node</a> *node = m_nodes[j];</div>
<div class="line"><span class="lineno"> 2452</span>    <span class="keywordflow">if</span> (node-&gt;m_pixel == 0 || node-&gt;m_visited) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 2453</span>    traceLine(node-&gt;m_pixel);</div>
<div class="line"><span class="lineno"> 2454</span>  }</div>
<div class="line"><span class="lineno"> 2455</span> </div>
<div class="line"><span class="lineno"> 2456</span>  handleJunctions();</div>
<div class="line"><span class="lineno"> 2457</span>  createStrokes();</div>
<div class="line"><span class="lineno"> 2458</span>  createRegions();</div>
<div class="line"><span class="lineno"> 2459</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a479dbf8f9aadd0aabf67ba52e50bfa36" name="a479dbf8f9aadd0aabf67ba52e50bfa36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a479dbf8f9aadd0aabf67ba52e50bfa36">&#9670;&nbsp;</a></span>m_configuration</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_vectorizer_configuration.html">VectorizerConfiguration</a> CenterLineVectorizer::m_configuration</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3d73af2fd7d369e0cfa6d4108f24639e" name="a3d73af2fd7d369e0cfa6d4108f24639e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d73af2fd7d369e0cfa6d4108f24639e">&#9670;&nbsp;</a></span>m_dataRaster</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_raster_p_t.html">DataRasterP</a> CenterLineVectorizer::m_dataRaster</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a41ad2fbcf51a61f6b95589953f020efe" name="a41ad2fbcf51a61f6b95589953f020efe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41ad2fbcf51a61f6b95589953f020efe">&#9670;&nbsp;</a></span>m_dataRasterArray</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvector.html">vector</a>&lt;pair&lt;int, <a class="el" href="class_t_raster_p_t.html">DataRasterP</a>&gt; &gt; CenterLineVectorizer::m_dataRasterArray</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9fc61cc2459f73a30df52c1e63dcd45a" name="a9fc61cc2459f73a30df52c1e63dcd45a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fc61cc2459f73a30df52c1e63dcd45a">&#9670;&nbsp;</a></span>m_junctions</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvector.html">vector</a>&lt;<a class="el" href="class_junction.html">Junction</a> *&gt; CenterLineVectorizer::m_junctions</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae27f83ea716828cb95dabb942cc222ac" name="ae27f83ea716828cb95dabb942cc222ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae27f83ea716828cb95dabb942cc222ac">&#9670;&nbsp;</a></span>m_links</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvector.html">vector</a>&lt;<a class="el" href="class_junction_link.html">JunctionLink</a>&gt; CenterLineVectorizer::m_links</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa6a4f544b2ccaf516d017ddc2f102605" name="aa6a4f544b2ccaf516d017ddc2f102605"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6a4f544b2ccaf516d017ddc2f102605">&#9670;&nbsp;</a></span>m_nodes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvector.html">vector</a>&lt;<a class="el" href="class_node.html">Node</a> *&gt; CenterLineVectorizer::m_nodes</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aabe35c50f2c12cdb4f398f863e884d7a" name="aabe35c50f2c12cdb4f398f863e884d7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabe35c50f2c12cdb4f398f863e884d7a">&#9670;&nbsp;</a></span>m_protoRegions</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">list&lt;<a class="el" href="class_proto_region.html">ProtoRegion</a>&gt; CenterLineVectorizer::m_protoRegions</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a33c730773e3ebeeab0285a058e8ccdff" name="a33c730773e3ebeeab0285a058e8ccdff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33c730773e3ebeeab0285a058e8ccdff">&#9670;&nbsp;</a></span>m_protoStrokes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">list&lt;<a class="el" href="class_proto_stroke.html">ProtoStroke</a>&gt; CenterLineVectorizer::m_protoStrokes</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5ad41dd6e5eca752f3ce3eba0a18a783" name="a5ad41dd6e5eca752f3ce3eba0a18a783"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ad41dd6e5eca752f3ce3eba0a18a783">&#9670;&nbsp;</a></span>m_src</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_smart_pointer_t.html">TRasterP</a> CenterLineVectorizer::m_src</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2c6992c280df0ee2ccac31a524faa247" name="a2c6992c280df0ee2ccac31a524faa247"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c6992c280df0ee2ccac31a524faa247">&#9670;&nbsp;</a></span>m_vimage</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_vector_image_p.html">TVectorImageP</a> CenterLineVectorizer::m_vimage</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>E:/opentoonz/toonz/sources/toonzlib/<a class="el" href="">tcenterlinevectorizerOld.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
