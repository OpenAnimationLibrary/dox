\hypertarget{class_plastic_deformer_1_1_imp}{}\doxysection{Plastic\+Deformer\+::Imp Class Reference}
\label{class_plastic_deformer_1_1_imp}\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a890dd7efb2b9f037192f034c873b991b}{initialize}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TTexture\+MeshP}} \&mesh)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_ac2b7bfb258149f87159697f4795e6a94}{compile}} (const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&handles, int $\ast$face\+Hints)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a18df26c986dcd4a851156d7e74ddc40e}{deform}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$dst\+Handles, double $\ast$dst\+Vertices\+Coords)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a58134a51a9a44ce85936515fdf48c4f4}{copy\+Originals}} (double $\ast$dst\+Vertices\+Coords)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a351e84c7985d23ecaa7f3b92f6d836ca}{initialize\+Step1}} ()
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4a9aaed87fba0e547359781d4192f2bf}{compile\+Step1}} (const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&handles)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a75bf19eb012d33f05009bf1bd533915b}{deform\+Step1}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$dst\+Handles, double $\ast$dst\+Vertices\+Coords)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_ad9b21302fa262b7bd7b06602b904af85}{release\+Initialized\+Data}} ()
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5b08cd7f6969873db02067de2e336f76}{initialize\+Step2}} ()
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5a59f28a2d3292ad083b430ccda3f5ab}{compile\+Step2}} (const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&handles)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2444196def13652cab5b148d47be7c6c}{deform\+Step2}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$dst\+Handles, double $\ast$dst\+Vertices\+Coords)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2a44655a7dd30c72e1fcd545ddf424c9}{initialize\+Step3}} ()
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aa5863e83558331b4b0ddd3d6c956fab9}{compile\+Step3}} (const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&handles)
\item 
void \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a314bba8c7824dc7e477b53687392fccb}{deform\+Step3}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$dst\+Handles, double $\ast$dst\+Vertices\+Coords)
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TTexture\+MeshP}} \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\+\_\+mesh}}
\begin{DoxyCompactList}\small\item\em Deformed mesh (cannot be changed) \end{DoxyCompactList}\item 
std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\+\_\+handles}}
\begin{DoxyCompactList}\small\item\em Compiled handles. \end{DoxyCompactList}\item 
std\+::vector$<$ Linear\+Constraint $>$ \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bc9cface4b10940047f37fc5bacc23a}{m\+\_\+constraints1}}
\item 
std\+::vector$<$ Linear\+Constraint $>$ \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}{m\+\_\+constraints3}}
\begin{DoxyCompactList}\small\item\em Compiled constraints (depends on the above) \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}{m\+\_\+compiled}}
\begin{DoxyCompactList}\small\item\em Whether the deformer is ready to deform() \end{DoxyCompactList}\item 
\mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin\+::spmat}} \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}{m\+\_\+G}}
\item 
Super\+Factors\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a59de886fbbab45ca04bf36e8e65f9c0c}{m\+\_\+invC}}
\begin{DoxyCompactList}\small\item\em C\textquotesingle{}s factors (C is G plus linear constraints) \end{DoxyCompactList}\item 
Double\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}{m\+\_\+q}}
\begin{DoxyCompactList}\small\item\em Step 1\textquotesingle{}s known term. \end{DoxyCompactList}\item 
Double\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aa2a2a9a79d90c0d32006a5f7e29a7156}{m\+\_\+out}}
\begin{DoxyCompactList}\small\item\em Step 1\textquotesingle{}s result. \end{DoxyCompactList}\item 
std\+::vector$<$ Super\+Factors\+Ptr $>$ \mbox{\hyperlink{class_plastic_deformer_1_1_imp_ac0ea4056571d3d82487490b2603e53a3}{m\+\_\+invF}}
\begin{DoxyCompactList}\small\item\em Each of step 2\textquotesingle{}s systems factorizations. \end{DoxyCompactList}\item 
TPoint\+DPtr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a1c4fadda8377962d536a7dd9848d844b}{m\+\_\+relative\+Coords}}
\item 
double \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a7b894c1286126c329aace2879bb22f7f}{m\+\_\+v}} \mbox{[}4\mbox{]}
\item 
double \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a131fb40ce682e124812af5b6e6fa6fe2}{m\+\_\+c}} \mbox{[}4\mbox{]}
\begin{DoxyCompactList}\small\item\em Known term and output coordinates. \end{DoxyCompactList}\item 
TPoint\+DPtr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a17733fbd44cac0801e7713c3d9ade7cd}{m\+\_\+fit\+Triangles}}
\begin{DoxyCompactList}\small\item\em Output face coordinates. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin\+::spmat}} \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}{m\+\_\+H}}
\begin{DoxyCompactList}\small\item\em Step 3\textquotesingle{}s system entries. \end{DoxyCompactList}\item 
Super\+Factors\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a0abb33a3267e98306f8377ab67294ef1}{m\+\_\+invK}}
\begin{DoxyCompactList}\small\item\em System inverse. \end{DoxyCompactList}\item 
Double\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aa07b28a2aac383cdfee3381e39e0a0c8}{m\+\_\+fx}}
\item 
Double\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\+\_\+fy}}
\begin{DoxyCompactList}\small\item\em Known terms. \end{DoxyCompactList}\item 
Double\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aaa73e9b062be1ca3e7c0e9431a450c5b}{m\+\_\+x}}
\item 
Double\+Ptr \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a79166603414d14c8271531330f7641e5}{m\+\_\+y}}
\begin{DoxyCompactList}\small\item\em Output values. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a82b5e5ff086b36b23290b7e5bc40b60e}\label{class_plastic_deformer_1_1_imp_a82b5e5ff086b36b23290b7e5bc40b60e}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!Imp@{Imp}}
\index{Imp@{Imp}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{Imp()}{Imp()}}
{\footnotesize\ttfamily Plastic\+Deformer\+::\+Imp\+::\+Imp (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00332 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_ac2b7bfb258149f87159697f4795e6a94}\label{class_plastic_deformer_1_1_imp_ac2b7bfb258149f87159697f4795e6a94}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!compile@{compile}}
\index{compile@{compile}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{compile()}{compile()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::compile (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&}]{handles,  }\item[{int $\ast$}]{face\+Hints }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00354                                                    \{}
\DoxyCodeLine{00355   assert(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}});}
\DoxyCodeLine{00356 }
\DoxyCodeLine{00357   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.clear(), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.reserve(handles.size());}
\DoxyCodeLine{00358   m\_constraints1.clear(), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}{m\_constraints3}}.clear();}
\DoxyCodeLine{00359 }
\DoxyCodeLine{00360   LinearConstraint constr;}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362   \textcolor{comment}{// Build the linear constraints raising from the mesh-\/handles pairing}}
\DoxyCodeLine{00363   \textcolor{keywordtype}{int} h, hCount = handles.size();}
\DoxyCodeLine{00364   \textcolor{keywordflow}{for} (h = 0; h < hCount; ++h) \{}
\DoxyCodeLine{00365     \textcolor{keywordtype}{int} localFaceIdx = -\/1, \&faceIdx = faceHints ? faceHints[h] : localFaceIdx;}
\DoxyCodeLine{00366 }
\DoxyCodeLine{00367     ::buildTriangularCoordinates(*\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}, faceIdx, handles[h].m\_pos,}
\DoxyCodeLine{00368                                  constr.m\_k[0], constr.m\_k[1], constr.m\_k[2]);}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370     \textcolor{keywordflow}{if} (faceIdx >= 0) \{}
\DoxyCodeLine{00371       constr.m\_h = h;}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373       \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>faceVertices(faceIdx, constr.m\_v[0], constr.m\_v[1],}
\DoxyCodeLine{00374                            constr.m\_v[2]);}
\DoxyCodeLine{00375       m\_constraints1.push\_back(constr);}
\DoxyCodeLine{00376       \textcolor{keywordflow}{if} (handles[h].m\_interpolate) \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}{m\_constraints3}}.push\_back(constr);}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378       \textcolor{comment}{// Store the handles to retain precompiled data}}
\DoxyCodeLine{00379       \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.push\_back(handles[h]);}
\DoxyCodeLine{00380     \}}
\DoxyCodeLine{00381   \}}
\DoxyCodeLine{00382 }
\DoxyCodeLine{00383   \textcolor{comment}{// m\_handles = handles;                              // NOT directly copied}}
\DoxyCodeLine{00384   \textcolor{comment}{// like this: some handles could be}}
\DoxyCodeLine{00385   \textcolor{comment}{// (geometrically) OUTSIDE the mesh!}}
\DoxyCodeLine{00386 }
\DoxyCodeLine{00387   \textcolor{comment}{// Now, invoke the actual compilation procedures}}
\DoxyCodeLine{00388   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}{m\_compiled}} = \textcolor{keyword}{true};}
\DoxyCodeLine{00389 }
\DoxyCodeLine{00390   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.size() < 2) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00391 }
\DoxyCodeLine{00392   compileStep1(handles);  \textcolor{comment}{// These may set m\_compiled = false. Must still be}}
\DoxyCodeLine{00393   compileStep2(handles);  \textcolor{comment}{// called even when that happens -\/ as they are}}
\DoxyCodeLine{00394   compileStep3(handles);  \textcolor{comment}{// responsible for resources reclamation.}}
\DoxyCodeLine{00395 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a4a9aaed87fba0e547359781d4192f2bf}\label{class_plastic_deformer_1_1_imp_a4a9aaed87fba0e547359781d4192f2bf}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!compileStep1@{compileStep1}}
\index{compileStep1@{compileStep1}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{compileStep1()}{compileStep1()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::compile\+Step1 (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&}]{handles }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00500                                              \{}
\DoxyCodeLine{00501   \textcolor{comment}{// First, release resources}}
\DoxyCodeLine{00502   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a59de886fbbab45ca04bf36e8e65f9c0c}{m\_invC}}.reset();}
\DoxyCodeLine{00503   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}{m\_q}}.reset();}
\DoxyCodeLine{00504   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aa2a2a9a79d90c0d32006a5f7e29a7156}{m\_out}}.reset();}
\DoxyCodeLine{00505 }
\DoxyCodeLine{00506   \textcolor{comment}{// Now, start compiling}}
\DoxyCodeLine{00507   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_texture_mesh}{TTextureMesh}} \&mesh = *\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}};}
\DoxyCodeLine{00508   \textcolor{keywordtype}{int} vCount = mesh.verticesCount(), hCount = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.size();}
\DoxyCodeLine{00509 }
\DoxyCodeLine{00510   \textcolor{keywordtype}{int} cSize = 2 * (vCount + hCount);  \textcolor{comment}{// Coefficients count}}
\DoxyCodeLine{00511 }
\DoxyCodeLine{00512   \textcolor{comment}{// Initialize C with G}}
\DoxyCodeLine{00513   \mbox{\hyperlink{structtlin_1_1_super_matrix}{tlin::SuperMatrix}} *trC = 0;}
\DoxyCodeLine{00514   \{}
\DoxyCodeLine{00515     \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin::spmat}} C(cSize, cSize);}
\DoxyCodeLine{00516     C.entries()                      = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}{m\_G}}.entries();}
\DoxyCodeLine{00517     C.entries().hashFunctor().m\_cols = C.cols();}
\DoxyCodeLine{00518     C.entries().rehash(C.entries()}
\DoxyCodeLine{00519                            .buckets()}
\DoxyCodeLine{00520                            .size());  \textcolor{comment}{// Rehash to entries according to C's size}}
\DoxyCodeLine{00521 }
\DoxyCodeLine{00522     \textcolor{comment}{// Add the entries constraining handles}}
\DoxyCodeLine{00523     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00524     std::vector<LinearConstraint>::iterator ht, hEnd(m\_constraints1.end());}
\DoxyCodeLine{00525     \textcolor{keywordflow}{for} (i = 0, ht = m\_constraints1.begin(); ht != hEnd; ++i, ++ht)}
\DoxyCodeLine{00526       addConstraint2d(2 * (vCount + i), *ht, C);}
\DoxyCodeLine{00527 }
\DoxyCodeLine{00528     tlin::traduceS(C, trC);}
\DoxyCodeLine{00529   \}}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531   \textcolor{comment}{// Build m\_invC}}
\DoxyCodeLine{00532   \mbox{\hyperlink{structtlin_1_1_super_factors}{tlin::SuperFactors}} *invC = 0;}
\DoxyCodeLine{00533   tlin::factorize(trC, invC);}
\DoxyCodeLine{00534 }
\DoxyCodeLine{00535   tlin::freeS(trC);}
\DoxyCodeLine{00536 }
\DoxyCodeLine{00537   \textcolor{keywordflow}{if} (invC) \{}
\DoxyCodeLine{00538     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a59de886fbbab45ca04bf36e8e65f9c0c}{m\_invC}}.reset(invC);}
\DoxyCodeLine{00539 }
\DoxyCodeLine{00540     \textcolor{comment}{// Reallocate arrays}}
\DoxyCodeLine{00541     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}{m\_q}}.reset(\textcolor{keyword}{new} \textcolor{keywordtype}{double}[cSize]);}
\DoxyCodeLine{00542     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aa2a2a9a79d90c0d32006a5f7e29a7156}{m\_out}}.reset(\textcolor{keyword}{new} \textcolor{keywordtype}{double}[cSize]);}
\DoxyCodeLine{00543 }
\DoxyCodeLine{00544     memset(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}{m\_q}}.get(), 0,}
\DoxyCodeLine{00545            2 * vCount *}
\DoxyCodeLine{00546                \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));  \textcolor{comment}{// Initialize the system's known term with 0}}
\DoxyCodeLine{00547   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00548     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}{m\_compiled}} = \textcolor{keyword}{false};}
\DoxyCodeLine{00549 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a5a59f28a2d3292ad083b430ccda3f5ab}\label{class_plastic_deformer_1_1_imp_a5a59f28a2d3292ad083b430ccda3f5ab}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!compileStep2@{compileStep2}}
\index{compileStep2@{compileStep2}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{compileStep2()}{compileStep2()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::compile\+Step2 (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&}]{handles }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00637                                              \{}
\DoxyCodeLine{00638   \textcolor{comment}{// Nothing to do :)}}
\DoxyCodeLine{00639 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_aa5863e83558331b4b0ddd3d6c956fab9}\label{class_plastic_deformer_1_1_imp_aa5863e83558331b4b0ddd3d6c956fab9}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!compileStep3@{compileStep3}}
\index{compileStep3@{compileStep3}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{compileStep3()}{compileStep3()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::compile\+Step3 (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}} $>$ \&}]{handles }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00761                                              \{}
\DoxyCodeLine{00762   \textcolor{comment}{// First, release resources}}
\DoxyCodeLine{00763   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a0abb33a3267e98306f8377ab67294ef1}{m\_invK}}.reset();}
\DoxyCodeLine{00764   m\_x.reset();}
\DoxyCodeLine{00765   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a79166603414d14c8271531330f7641e5}{m\_y}}.reset();}
\DoxyCodeLine{00766   m\_fx.reset();}
\DoxyCodeLine{00767   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}.reset();}
\DoxyCodeLine{00768 }
\DoxyCodeLine{00769   \textcolor{comment}{// If compilation already failed, skip}}
\DoxyCodeLine{00770   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}{m\_compiled}}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00771 }
\DoxyCodeLine{00772   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_texture_mesh}{TTextureMesh}} \&mesh = *\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}};}
\DoxyCodeLine{00773 }
\DoxyCodeLine{00774   \textcolor{keywordtype}{int} vCount = mesh.verticesCount();}
\DoxyCodeLine{00775   \textcolor{keywordtype}{int} kSize  = vCount + \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}{m\_constraints3}}.size();}
\DoxyCodeLine{00776 }
\DoxyCodeLine{00777   \textcolor{comment}{// Initialize K with H}}
\DoxyCodeLine{00778   \mbox{\hyperlink{structtlin_1_1_super_matrix}{tlin::SuperMatrix}} *trK = 0;}
\DoxyCodeLine{00779   \{}
\DoxyCodeLine{00780     \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin::spmat}} K(kSize, kSize);}
\DoxyCodeLine{00781     K.entries()                      = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}{m\_H}}.entries();}
\DoxyCodeLine{00782     K.entries().hashFunctor().m\_cols = K.cols();}
\DoxyCodeLine{00783     K.entries().rehash(K.entries()}
\DoxyCodeLine{00784                            .buckets()}
\DoxyCodeLine{00785                            .size());  \textcolor{comment}{// Rehash to entries according to K's size}}
\DoxyCodeLine{00786 }
\DoxyCodeLine{00787     \textcolor{comment}{// Add the entries constraining handles}}
\DoxyCodeLine{00788     \textcolor{keywordtype}{int} c, cnstrCount = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}{m\_constraints3}}.size();}
\DoxyCodeLine{00789     \textcolor{keywordflow}{for} (c = 0; c < cnstrCount; ++c) \{}
\DoxyCodeLine{00790       \textcolor{comment}{// Add the linear constraint to the system}}
\DoxyCodeLine{00791       addConstraint1d(vCount + c, \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}{m\_constraints3}}[c], K);}
\DoxyCodeLine{00792     \}}
\DoxyCodeLine{00793 }
\DoxyCodeLine{00794     tlin::traduceS(K, trK);}
\DoxyCodeLine{00795   \}}
\DoxyCodeLine{00796 }
\DoxyCodeLine{00797   \textcolor{comment}{// Build m\_invK}}
\DoxyCodeLine{00798   \mbox{\hyperlink{structtlin_1_1_super_factors}{tlin::SuperFactors}} *invK = 0;}
\DoxyCodeLine{00799   tlin::factorize(trK, invK);}
\DoxyCodeLine{00800 }
\DoxyCodeLine{00801   tlin::freeS(trK);}
\DoxyCodeLine{00802 }
\DoxyCodeLine{00803   \textcolor{keywordflow}{if} (invK) \{}
\DoxyCodeLine{00804     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a0abb33a3267e98306f8377ab67294ef1}{m\_invK}}.reset(invK);}
\DoxyCodeLine{00805 }
\DoxyCodeLine{00806     m\_x.reset(\textcolor{keyword}{new} \textcolor{keywordtype}{double}[kSize]);}
\DoxyCodeLine{00807     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a79166603414d14c8271531330f7641e5}{m\_y}}.reset(\textcolor{keyword}{new} \textcolor{keywordtype}{double}[kSize]);}
\DoxyCodeLine{00808     m\_fx.reset(\textcolor{keyword}{new} \textcolor{keywordtype}{double}[kSize]);}
\DoxyCodeLine{00809     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}.reset(\textcolor{keyword}{new} \textcolor{keywordtype}{double}[kSize]);}
\DoxyCodeLine{00810   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00811     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}{m\_compiled}} = \textcolor{keyword}{false};}
\DoxyCodeLine{00812 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a58134a51a9a44ce85936515fdf48c4f4}\label{class_plastic_deformer_1_1_imp_a58134a51a9a44ce85936515fdf48c4f4}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!copyOriginals@{copyOriginals}}
\index{copyOriginals@{copyOriginals}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{copyOriginals()}{copyOriginals()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::copy\+Originals (\begin{DoxyParamCaption}\item[{double $\ast$}]{dst\+Vertices\+Coords }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00437                                                                 \{}
\DoxyCodeLine{00438   \textcolor{keywordtype}{int} v, vCount = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>verticesCount();}
\DoxyCodeLine{00439   \textcolor{keywordflow}{for} (v = 0; v != vCount; ++v, dstVerticesCoords += 2) \{}
\DoxyCodeLine{00440     dstVerticesCoords[0] = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>vertex(v).P().x;}
\DoxyCodeLine{00441     dstVerticesCoords[1] = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>vertex(v).P().y;}
\DoxyCodeLine{00442   \}}
\DoxyCodeLine{00443 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a18df26c986dcd4a851156d7e74ddc40e}\label{class_plastic_deformer_1_1_imp_a18df26c986dcd4a851156d7e74ddc40e}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!deform@{deform}}
\index{deform@{deform}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{deform()}{deform()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::deform (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$}]{dst\+Handles,  }\item[{double $\ast$}]{dst\+Vertices\+Coords }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00400                                                              \{}
\DoxyCodeLine{00401   assert(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}});}
\DoxyCodeLine{00402   assert(dstVerticesCoords);}
\DoxyCodeLine{00403 }
\DoxyCodeLine{00404   \textcolor{comment}{// Deal with trivial cases}}
\DoxyCodeLine{00405   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}{m\_compiled}} || \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.size() == 0) \{}
\DoxyCodeLine{00406     \textcolor{comment}{// Cannot deform anything -\/ just copy the source mesh vertices into dst ones}}
\DoxyCodeLine{00407     copyOriginals(dstVerticesCoords);}
\DoxyCodeLine{00408     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00409   \}}
\DoxyCodeLine{00410 }
\DoxyCodeLine{00411   assert(dstHandles);}
\DoxyCodeLine{00412 }
\DoxyCodeLine{00413   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.size() == 1) \{}
\DoxyCodeLine{00414     \textcolor{comment}{// 1 handle inside the mesh -\/ pure translational case}}
\DoxyCodeLine{00415 }
\DoxyCodeLine{00416     \textcolor{keyword}{const} \mbox{\hyperlink{struct_plastic_handle}{PlasticHandle}} \&srcHandle = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.front();}
\DoxyCodeLine{00417     \textcolor{keyword}{const} \mbox{\hyperlink{class_t_point_t}{TPointD}} \&dstHandlePos    = dstHandles[m\_constraints1.front().m\_h];}
\DoxyCodeLine{00418 }
\DoxyCodeLine{00419     \mbox{\hyperlink{class_t_point_t}{TPointD}} shift(dstHandlePos -\/ srcHandle.\mbox{\hyperlink{struct_plastic_handle_aa3f36d119fdcf5c5e73086b4a1ee708d}{m\_pos}});}
\DoxyCodeLine{00420 }
\DoxyCodeLine{00421     \textcolor{keywordtype}{int} v, vCount = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>verticesCount();}
\DoxyCodeLine{00422     \textcolor{keywordflow}{for} (v = 0; v != vCount; ++v, dstVerticesCoords += 2) \{}
\DoxyCodeLine{00423       dstVerticesCoords[0] = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>vertex(v).P().x + shift.x;}
\DoxyCodeLine{00424       dstVerticesCoords[1] = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>vertex(v).P().y + shift.y;}
\DoxyCodeLine{00425     \}}
\DoxyCodeLine{00426 }
\DoxyCodeLine{00427     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00428   \}}
\DoxyCodeLine{00429 }
\DoxyCodeLine{00430   deformStep1(dstHandles, dstVerticesCoords);}
\DoxyCodeLine{00431   deformStep2(dstHandles, dstVerticesCoords);}
\DoxyCodeLine{00432   deformStep3(dstHandles, dstVerticesCoords);}
\DoxyCodeLine{00433 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a75bf19eb012d33f05009bf1bd533915b}\label{class_plastic_deformer_1_1_imp_a75bf19eb012d33f05009bf1bd533915b}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!deformStep1@{deformStep1}}
\index{deformStep1@{deformStep1}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{deformStep1()}{deformStep1()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::deform\+Step1 (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$}]{dst\+Handles,  }\item[{double $\ast$}]{dst\+Vertices\+Coords }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00554                                                                   \{}
\DoxyCodeLine{00555   \textcolor{keywordtype}{int} vCount2 = 2 * \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>verticesCount();}
\DoxyCodeLine{00556   \textcolor{keywordtype}{int} cSize   = vCount2 + 2 * \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.size();}
\DoxyCodeLine{00557 }
\DoxyCodeLine{00558   \textcolor{comment}{// Copy destination handles into the system's known term}}
\DoxyCodeLine{00559   \textcolor{keywordtype}{int} i, h;}
\DoxyCodeLine{00560   \textcolor{keywordflow}{for} (i = vCount2, h = 0; i < cSize; i += 2, ++h) \{}
\DoxyCodeLine{00561     \textcolor{keyword}{const} \mbox{\hyperlink{class_t_point_t}{TPointD}} \&dstHandlePos = dstHandles[m\_constraints1[h].m\_h];}
\DoxyCodeLine{00562 }
\DoxyCodeLine{00563     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}{m\_q}}[i] = dstHandlePos.x;  \textcolor{comment}{// NOTE: We could use calloc on-\/the-\/fly, sparing}}
\DoxyCodeLine{00564     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}{m\_q}}[i + 1] =}
\DoxyCodeLine{00565         dstHandlePos.y;  \textcolor{comment}{// some memory. Have to benchmark the cost, though...}}
\DoxyCodeLine{00566   \}}
\DoxyCodeLine{00567 }
\DoxyCodeLine{00568   \textcolor{comment}{// Solve the linear system}}
\DoxyCodeLine{00569   \textcolor{keywordtype}{double} *out = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aa2a2a9a79d90c0d32006a5f7e29a7156}{m\_out}}.get();}
\DoxyCodeLine{00570   tlin::solve(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a59de886fbbab45ca04bf36e8e65f9c0c}{m\_invC}}.get(), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}{m\_q}}.get(), out);}
\DoxyCodeLine{00571 }
\DoxyCodeLine{00572 \textcolor{preprocessor}{\#ifdef GL\_DEBUG}}
\DoxyCodeLine{00573 }
\DoxyCodeLine{00574   glColor3d(1.0, 0.0, 0.0);  \textcolor{comment}{// Red}}
\DoxyCodeLine{00575   glBegin(GL\_LINES);}
\DoxyCodeLine{00576 }
\DoxyCodeLine{00577   \textcolor{comment}{// Draw deformed mesh edges}}
\DoxyCodeLine{00578   \textcolor{keywordtype}{int} e, eCount = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>edgesCount();}
\DoxyCodeLine{00579   \textcolor{keywordflow}{for} (e = 0; e < eCount; ++e) \{}
\DoxyCodeLine{00580     \textcolor{keyword}{const} \mbox{\hyperlink{classtcg_1_1_edge}{TTextureMesh::edge\_type}} \&ed = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>edge(e);}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582     \textcolor{keywordtype}{double} *x0 = out + 2 * ed.vertex(0), *x1 = out + 2 * ed.vertex(1);}
\DoxyCodeLine{00583 }
\DoxyCodeLine{00584     glVertex2d(*x0, *(x0 + 1));}
\DoxyCodeLine{00585     glVertex2d(*x1, *(x1 + 1));}
\DoxyCodeLine{00586   \}}
\DoxyCodeLine{00587 }
\DoxyCodeLine{00588   glEnd();}
\DoxyCodeLine{00589 }
\DoxyCodeLine{00590 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00591 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a2444196def13652cab5b148d47be7c6c}\label{class_plastic_deformer_1_1_imp_a2444196def13652cab5b148d47be7c6c}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!deformStep2@{deformStep2}}
\index{deformStep2@{deformStep2}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{deformStep2()}{deformStep2()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::deform\+Step2 (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$}]{dst\+Handles,  }\item[{double $\ast$}]{dst\+Vertices\+Coords }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00644                                                                   \{}
\DoxyCodeLine{00645   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_texture_mesh}{TTextureMesh}} \&mesh = *\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}};}
\DoxyCodeLine{00646   \textcolor{keywordtype}{int} vCount               = mesh.verticesCount();}
\DoxyCodeLine{00647 }
\DoxyCodeLine{00648   memset(m\_fx.get(), 0,}
\DoxyCodeLine{00649          vCount * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));  \textcolor{comment}{// These should be part of step 3...}}
\DoxyCodeLine{00650   memset(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}.get(), 0,}
\DoxyCodeLine{00651          vCount * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));  \textcolor{comment}{// They are filled here just for convenience}}
\DoxyCodeLine{00652 }
\DoxyCodeLine{00653   \textcolor{comment}{// Build fit triangles}}
\DoxyCodeLine{00654   \mbox{\hyperlink{class_t_point_t}{TPointD}} *fitTri = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a17733fbd44cac0801e7713c3d9ade7cd}{m\_fitTriangles}}.get(), *relCoord = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a1c4fadda8377962d536a7dd9848d844b}{m\_relativeCoords}}.get();}
\DoxyCodeLine{00655   \textcolor{keywordtype}{double} *out1 = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_aa2a2a9a79d90c0d32006a5f7e29a7156}{m\_out}}.get();}
\DoxyCodeLine{00656 }
\DoxyCodeLine{00657   \textcolor{keywordtype}{int} f, fCount = mesh.facesCount();}
\DoxyCodeLine{00658   \textcolor{keywordflow}{for} (f = 0; f < fCount; ++f, fitTri += 3, ++relCoord) \{}
\DoxyCodeLine{00659     \textcolor{keywordtype}{int} v0, v1, v2;}
\DoxyCodeLine{00660     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>faceVertices(f, v0, v1, v2);}
\DoxyCodeLine{00661 }
\DoxyCodeLine{00662     \textcolor{keyword}{const} \mbox{\hyperlink{struct_rigid_point}{RigidPoint}} \&p0 = mesh.vertex(v0).P(), \&p1 = mesh.vertex(v1).P(),}
\DoxyCodeLine{00663                      \&p2 = mesh.vertex(v2).P();}
\DoxyCodeLine{00664 }
\DoxyCodeLine{00665     \textcolor{keywordtype}{double} *v0x = out1 + (v0 << 1), *v0y = v0x + 1, *v1x = out1 + (v1 << 1),}
\DoxyCodeLine{00666            *v1y = v1x + 1, *v2x = out1 + (v2 << 1), *v2y = v2x + 1;}
\DoxyCodeLine{00667 }
\DoxyCodeLine{00668     build\_c(*v0x, *v0y, *v1x, *v1y, *v2x, *v2y, relCoord-\/>x, relCoord-\/>y, \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a131fb40ce682e124812af5b6e6fa6fe2}{m\_c}});}
\DoxyCodeLine{00669 }
\DoxyCodeLine{00670     \textcolor{keywordtype}{double} *vPtr = (\textcolor{keywordtype}{double} *)m\_v;}
\DoxyCodeLine{00671     tlin::solve(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_ac0ea4056571d3d82487490b2603e53a3}{m\_invF}}[f].get(), (\textcolor{keywordtype}{double} *)\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a131fb40ce682e124812af5b6e6fa6fe2}{m\_c}}, vPtr);}
\DoxyCodeLine{00672 }
\DoxyCodeLine{00673     fitTri[0].x = m\_v[0], fitTri[0].y = m\_v[1];}
\DoxyCodeLine{00674     fitTri[1].x = m\_v[2], fitTri[1].y = m\_v[3];}
\DoxyCodeLine{00675 }
\DoxyCodeLine{00676     fitTri[2].x = fitTri[0].x + relCoord-\/>x * (fitTri[1].x -\/ fitTri[0].x) +}
\DoxyCodeLine{00677                   relCoord-\/>y * (fitTri[1].y -\/ fitTri[0].y);}
\DoxyCodeLine{00678     fitTri[2].y = fitTri[0].y + relCoord-\/>x * (fitTri[1].y -\/ fitTri[0].y) +}
\DoxyCodeLine{00679                   relCoord-\/>y * (fitTri[0].x -\/ fitTri[1].x);}
\DoxyCodeLine{00680 }
\DoxyCodeLine{00681     \textcolor{comment}{// Scale with respect to baricenter. The baricenter is used since it makes}}
\DoxyCodeLine{00682     \textcolor{comment}{// distance from vertices equally}}
\DoxyCodeLine{00683     \textcolor{comment}{// weighting -\/ which is the same expected when minimizing positions (by}}
\DoxyCodeLine{00684     \textcolor{comment}{// collateral effect) in the next step.}}
\DoxyCodeLine{00685     \mbox{\hyperlink{class_t_point_t}{TPointD}} baricenter((fitTri[0].x + fitTri[1].x + fitTri[2].x) / 3.0,}
\DoxyCodeLine{00686                        (fitTri[0].y + fitTri[1].y + fitTri[2].y) / 3.0);}
\DoxyCodeLine{00687 }
\DoxyCodeLine{00688     \textcolor{keywordtype}{double} scale = sqrt(}
\DoxyCodeLine{00689         norm2(\mbox{\hyperlink{class_t_point_t}{TPointD}}(p1.x -\/ p0.x, p1.y -\/ p0.y)) /}
\DoxyCodeLine{00690         norm2(\mbox{\hyperlink{class_t_point_t}{TPointD}}(fitTri[1].x -\/ fitTri[0].x, fitTri[1].y -\/ fitTri[0].y)));}
\DoxyCodeLine{00691 }
\DoxyCodeLine{00692     fitTri[0] = scale * (fitTri[0] -\/ baricenter) + baricenter;}
\DoxyCodeLine{00693     fitTri[1] = scale * (fitTri[1] -\/ baricenter) + baricenter;}
\DoxyCodeLine{00694     fitTri[2] = scale * (fitTri[2] -\/ baricenter) + baricenter;}
\DoxyCodeLine{00695 }
\DoxyCodeLine{00696     \textcolor{comment}{// Build f -\/-\/ note: this should be part of step 3, we're just avoiding the}}
\DoxyCodeLine{00697     \textcolor{comment}{// same cycle twice :)}}
\DoxyCodeLine{00698     add\_f\_values(v0, v1, fitTri[0].x, fitTri[1].x,}
\DoxyCodeLine{00699                  std::min(p0.rigidity, p1.rigidity), m\_fx.get());}
\DoxyCodeLine{00700     add\_f\_values(v0, v1, fitTri[0].y, fitTri[1].y,}
\DoxyCodeLine{00701                  std::min(p0.rigidity, p1.rigidity), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}.get());}
\DoxyCodeLine{00702 }
\DoxyCodeLine{00703     add\_f\_values(v1, v2, fitTri[1].x, fitTri[2].x,}
\DoxyCodeLine{00704                  std::min(p1.rigidity, p2.rigidity), m\_fx.get());}
\DoxyCodeLine{00705     add\_f\_values(v1, v2, fitTri[1].y, fitTri[2].y,}
\DoxyCodeLine{00706                  std::min(p1.rigidity, p2.rigidity), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}.get());}
\DoxyCodeLine{00707 }
\DoxyCodeLine{00708     add\_f\_values(v2, v0, fitTri[2].x, fitTri[0].x,}
\DoxyCodeLine{00709                  std::min(p2.rigidity, p0.rigidity), m\_fx.get());}
\DoxyCodeLine{00710     add\_f\_values(v2, v0, fitTri[2].y, fitTri[0].y,}
\DoxyCodeLine{00711                  std::min(p2.rigidity, p0.rigidity), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}.get());}
\DoxyCodeLine{00712   \}}
\DoxyCodeLine{00713 }
\DoxyCodeLine{00714 \textcolor{preprocessor}{\#ifdef GL\_DEBUG}}
\DoxyCodeLine{00715 }
\DoxyCodeLine{00716   glColor3d(0.0, 0.0, 1.0);  \textcolor{comment}{// Blue}}
\DoxyCodeLine{00717 }
\DoxyCodeLine{00718   \textcolor{comment}{// Draw fit triangles}}
\DoxyCodeLine{00719   fitTri = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a17733fbd44cac0801e7713c3d9ade7cd}{m\_fitTriangles}}.get();}
\DoxyCodeLine{00720 }
\DoxyCodeLine{00721   \textcolor{keywordflow}{for} (f = 0; f < fCount; ++f, fitTri += 3) \{}
\DoxyCodeLine{00722     glBegin(GL\_LINE\_LOOP);}
\DoxyCodeLine{00723 }
\DoxyCodeLine{00724     glVertex2d(fitTri[0].x, fitTri[0].y);}
\DoxyCodeLine{00725     glVertex2d(fitTri[1].x, fitTri[1].y);}
\DoxyCodeLine{00726     glVertex2d(fitTri[2].x, fitTri[2].y);}
\DoxyCodeLine{00727 }
\DoxyCodeLine{00728     glEnd();}
\DoxyCodeLine{00729   \}}
\DoxyCodeLine{00730 }
\DoxyCodeLine{00731 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00732 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a314bba8c7824dc7e477b53687392fccb}\label{class_plastic_deformer_1_1_imp_a314bba8c7824dc7e477b53687392fccb}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!deformStep3@{deformStep3}}
\index{deformStep3@{deformStep3}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{deformStep3()}{deformStep3()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::deform\+Step3 (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} $\ast$}]{dst\+Handles,  }\item[{double $\ast$}]{dst\+Vertices\+Coords }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00817                                                                   \{}
\DoxyCodeLine{00818   \textcolor{keywordtype}{int} v, vCount = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}}-\/>verticesCount();}
\DoxyCodeLine{00819   \textcolor{keywordtype}{int} c;}
\DoxyCodeLine{00820   \textcolor{keywordtype}{int} h, hCount = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}.size();}
\DoxyCodeLine{00821 }
\DoxyCodeLine{00822   \textcolor{keywordflow}{for} (c = 0, h = 0; h < hCount; ++h) \{}
\DoxyCodeLine{00823     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}{m\_handles}}[h].m\_interpolate) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00824 }
\DoxyCodeLine{00825     \textcolor{keyword}{const} \mbox{\hyperlink{class_t_point_t}{TPointD}} \&dstHandlePos = dstHandles[m\_constraints1[h].m\_h];}
\DoxyCodeLine{00826 }
\DoxyCodeLine{00827     m\_fx[vCount + c] = dstHandlePos.x;}
\DoxyCodeLine{00828     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}[vCount + c] = dstHandlePos.y;}
\DoxyCodeLine{00829 }
\DoxyCodeLine{00830     ++c;}
\DoxyCodeLine{00831   \}}
\DoxyCodeLine{00832 }
\DoxyCodeLine{00833   \textcolor{keywordtype}{double} *x = m\_x.get(), *y = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a79166603414d14c8271531330f7641e5}{m\_y}}.get();}
\DoxyCodeLine{00834   tlin::solve(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a0abb33a3267e98306f8377ab67294ef1}{m\_invK}}.get(), m\_fx.get(), x);}
\DoxyCodeLine{00835   tlin::solve(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a0abb33a3267e98306f8377ab67294ef1}{m\_invK}}.get(), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}{m\_fy}}.get(), y);}
\DoxyCodeLine{00836 }
\DoxyCodeLine{00837   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00838   \textcolor{keywordflow}{for} (i = v = 0; v < vCount; ++v, i += 2) \{}
\DoxyCodeLine{00839     dstVerticesCoords[i]     = m\_x[v];}
\DoxyCodeLine{00840     dstVerticesCoords[i + 1] = \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a79166603414d14c8271531330f7641e5}{m\_y}}[v];}
\DoxyCodeLine{00841   \}}
\DoxyCodeLine{00842 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a890dd7efb2b9f037192f034c873b991b}\label{class_plastic_deformer_1_1_imp_a890dd7efb2b9f037192f034c873b991b}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!initialize@{initialize}}
\index{initialize@{initialize}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{initialize()}{initialize()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::initialize (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TTexture\+MeshP}} \&}]{mesh }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00336                                                              \{}
\DoxyCodeLine{00337   assert(\textcolor{stringliteral}{"{}Input mesh must be squeezed!"{}} \&\&}
\DoxyCodeLine{00338          mesh-\/>verticesCount() == mesh-\/>vertices().nodesCount() \&\&}
\DoxyCodeLine{00339          mesh-\/>edgesCount() == mesh-\/>edges().nodesCount() \&\&}
\DoxyCodeLine{00340          mesh-\/>facesCount() == mesh-\/>faces().nodesCount());}
\DoxyCodeLine{00341 }
\DoxyCodeLine{00342   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}} = mesh;}
\DoxyCodeLine{00343 }
\DoxyCodeLine{00344   initializeStep1();}
\DoxyCodeLine{00345   initializeStep2();}
\DoxyCodeLine{00346   initializeStep3();}
\DoxyCodeLine{00347 }
\DoxyCodeLine{00348   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}{m\_compiled}} = \textcolor{keyword}{false};  \textcolor{comment}{// Compilation is expected after a new initialization}}
\DoxyCodeLine{00349 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a351e84c7985d23ecaa7f3b92f6d836ca}\label{class_plastic_deformer_1_1_imp_a351e84c7985d23ecaa7f3b92f6d836ca}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!initializeStep1@{initializeStep1}}
\index{initializeStep1@{initializeStep1}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{initializeStep1()}{initializeStep1()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::initialize\+Step1 (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00463                                          \{}
\DoxyCodeLine{00464   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_texture_mesh}{TTextureMesh}} \&mesh = *\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}};}
\DoxyCodeLine{00465   \textcolor{keywordtype}{int} vCount = mesh.verticesCount(), vCount\_2 = 2 * vCount;}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}{m\_G}} = \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin::spmat}}(vCount\_2, vCount\_2);}
\DoxyCodeLine{00468 }
\DoxyCodeLine{00469   \textcolor{comment}{// Initialize the linear system indices for the stored mesh}}
\DoxyCodeLine{00470   \textcolor{keywordtype}{int} f, fCount = mesh.facesCount();}
\DoxyCodeLine{00471   \textcolor{keywordflow}{for} (f = 0; f < fCount; ++f) \{}
\DoxyCodeLine{00472     \textcolor{keywordtype}{int} v0, v1, v2;}
\DoxyCodeLine{00473     mesh.faceVertices(f, v0, v1, v2);}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475     \textcolor{keywordtype}{int} v0x = 2 * v0;   \textcolor{comment}{// We'll use 2 params per vertex -\/ with}}
\DoxyCodeLine{00476     \textcolor{keywordtype}{int} v0y = v0x + 1;  \textcolor{comment}{// adjacent x and y parameters}}
\DoxyCodeLine{00477     \textcolor{keywordtype}{int} v1x = 2 * v1;}
\DoxyCodeLine{00478     \textcolor{keywordtype}{int} v1y = v1x + 1;}
\DoxyCodeLine{00479     \textcolor{keywordtype}{int} v2x = 2 * v2;}
\DoxyCodeLine{00480     \textcolor{keywordtype}{int} v2y = v2x + 1;}
\DoxyCodeLine{00481 }
\DoxyCodeLine{00482     \textcolor{keyword}{const} \mbox{\hyperlink{classtcg_1_1_vertex}{TTextureMesh::vertex\_type}} \&vx0 = mesh.vertex(v0);}
\DoxyCodeLine{00483     \textcolor{keyword}{const} \mbox{\hyperlink{classtcg_1_1_vertex}{TTextureMesh::vertex\_type}} \&vx1 = mesh.vertex(v1);}
\DoxyCodeLine{00484     \textcolor{keyword}{const} \mbox{\hyperlink{classtcg_1_1_vertex}{TTextureMesh::vertex\_type}} \&vx2 = mesh.vertex(v2);}
\DoxyCodeLine{00485 }
\DoxyCodeLine{00486     \mbox{\hyperlink{class_t_point_t}{TPointD}} c0, c1, c2;}
\DoxyCodeLine{00487     c2 = \mbox{\hyperlink{namespacetcg_1_1point__ops_a6864fda72cc735d5024c496d8c4cbc4c}{tcg::point\_ops::ortCoords}}(vx2.P(), vx0.P(), vx1.P());}
\DoxyCodeLine{00488     c0 = \mbox{\hyperlink{namespacetcg_1_1point__ops_a6864fda72cc735d5024c496d8c4cbc4c}{tcg::point\_ops::ortCoords}}(vx0.P(), vx1.P(), vx2.P());}
\DoxyCodeLine{00489     c1 = \mbox{\hyperlink{namespacetcg_1_1point__ops_a6864fda72cc735d5024c496d8c4cbc4c}{tcg::point\_ops::ortCoords}}(vx1.P(), vx2.P(), vx0.P());}
\DoxyCodeLine{00490 }
\DoxyCodeLine{00491     addGValues(v0x, v0y, v1x, v1y, v2x, v2y, c2.x, c2.y, vx2.P().rigidity, \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}{m\_G}});}
\DoxyCodeLine{00492     addGValues(v1x, v1y, v2x, v2y, v0x, v0y, c0.x, c0.y, vx0.P().rigidity, \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}{m\_G}});}
\DoxyCodeLine{00493     addGValues(v2x, v2y, v0x, v0y, v1x, v1y, c1.x, c1.y, vx1.P().rigidity, \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}{m\_G}});}
\DoxyCodeLine{00494   \}}
\DoxyCodeLine{00495 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a5b08cd7f6969873db02067de2e336f76}\label{class_plastic_deformer_1_1_imp_a5b08cd7f6969873db02067de2e336f76}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!initializeStep2@{initializeStep2}}
\index{initializeStep2@{initializeStep2}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{initializeStep2()}{initializeStep2()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::initialize\+Step2 (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00597                                          \{}
\DoxyCodeLine{00598   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_texture_mesh}{TTextureMesh}} \&mesh = *\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}};}
\DoxyCodeLine{00599   \textcolor{keywordtype}{int} f, fCount = mesh.facesCount();}
\DoxyCodeLine{00600 }
\DoxyCodeLine{00601   \textcolor{comment}{// Clear and re-\/initialize vars}}
\DoxyCodeLine{00602   \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin::spmat}} F(4, 4);}
\DoxyCodeLine{00603   \mbox{\hyperlink{structtlin_1_1_super_matrix}{tlin::SuperMatrix}} *trF;}
\DoxyCodeLine{00604 }
\DoxyCodeLine{00605   std::vector<SuperFactorsPtr>(fCount).swap(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_ac0ea4056571d3d82487490b2603e53a3}{m\_invF}});}
\DoxyCodeLine{00606 }
\DoxyCodeLine{00607   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a1c4fadda8377962d536a7dd9848d844b}{m\_relativeCoords}}.reset(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_point_t}{TPointD}}[fCount]);}
\DoxyCodeLine{00608   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a17733fbd44cac0801e7713c3d9ade7cd}{m\_fitTriangles}}.reset(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_point_t}{TPointD}}[3 * fCount]);}
\DoxyCodeLine{00609 }
\DoxyCodeLine{00610   \textcolor{comment}{// Build step 2's system factorizations (yep, can be done at this point)}}
\DoxyCodeLine{00611   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_point_t}{TPointD}} *p0, *p1, *p2;}
\DoxyCodeLine{00612 }
\DoxyCodeLine{00613   \textcolor{keywordflow}{for} (f = 0; f < fCount; ++f) \{}
\DoxyCodeLine{00614     ::vertices(mesh, f, p0, p1, p2);}
\DoxyCodeLine{00615 }
\DoxyCodeLine{00616     \mbox{\hyperlink{class_t_point_t}{TPointD}} c(\mbox{\hyperlink{namespacetcg_1_1point__ops_a6864fda72cc735d5024c496d8c4cbc4c}{tcg::point\_ops::ortCoords}}(*p2, *p0, *p1));}
\DoxyCodeLine{00617     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a1c4fadda8377962d536a7dd9848d844b}{m\_relativeCoords}}[f] = c;}
\DoxyCodeLine{00618 }
\DoxyCodeLine{00619     F.clear();}
\DoxyCodeLine{00620     buildF(c.x, c.y, F);}
\DoxyCodeLine{00621 }
\DoxyCodeLine{00622     trF = 0;}
\DoxyCodeLine{00623     tlin::traduceS(F, trF);}
\DoxyCodeLine{00624 }
\DoxyCodeLine{00625     \mbox{\hyperlink{structtlin_1_1_super_factors}{tlin::SuperFactors}} *invF = 0;}
\DoxyCodeLine{00626 }
\DoxyCodeLine{00627     tlin::factorize(trF, invF);}
\DoxyCodeLine{00628     \mbox{\hyperlink{class_plastic_deformer_1_1_imp_ac0ea4056571d3d82487490b2603e53a3}{m\_invF}}[f].reset(invF);}
\DoxyCodeLine{00629 }
\DoxyCodeLine{00630     tlin::freeS(trF);}
\DoxyCodeLine{00631   \}}
\DoxyCodeLine{00632 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a2a44655a7dd30c72e1fcd545ddf424c9}\label{class_plastic_deformer_1_1_imp_a2a44655a7dd30c72e1fcd545ddf424c9}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!initializeStep3@{initializeStep3}}
\index{initializeStep3@{initializeStep3}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{initializeStep3()}{initializeStep3()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::initialize\+Step3 (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00738                                          \{}
\DoxyCodeLine{00739   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_texture_mesh}{TTextureMesh}} \&mesh = *\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}{m\_mesh}};}
\DoxyCodeLine{00740   \textcolor{keywordtype}{int} vCount               = mesh.verticesCount();}
\DoxyCodeLine{00741 }
\DoxyCodeLine{00742   \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}{m\_H}} = \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin::spmat}}(vCount, vCount);}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00744   \textcolor{keywordtype}{int} f, fCount = mesh.facesCount();}
\DoxyCodeLine{00745   \textcolor{keywordflow}{for} (f = 0; f < fCount; ++f) \{}
\DoxyCodeLine{00746     \textcolor{keywordtype}{int} v0, v1, v2;}
\DoxyCodeLine{00747     mesh.faceVertices(f, v0, v1, v2);}
\DoxyCodeLine{00748 }
\DoxyCodeLine{00749     \textcolor{keyword}{const} \mbox{\hyperlink{struct_rigid_point}{RigidPoint}} \&p0 = mesh.vertex(v0).P(), \&p1 = mesh.vertex(v1).P(),}
\DoxyCodeLine{00750                      \&p2 = mesh.vertex(v2).P();}
\DoxyCodeLine{00751 }
\DoxyCodeLine{00752     addHValues(v0, v1, std::min(p0.rigidity, p1.rigidity), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}{m\_H}});}
\DoxyCodeLine{00753     addHValues(v1, v2, std::min(p1.rigidity, p2.rigidity), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}{m\_H}});}
\DoxyCodeLine{00754     addHValues(v2, v0, std::min(p2.rigidity, p0.rigidity), \mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}{m\_H}});}
\DoxyCodeLine{00755   \}}
\DoxyCodeLine{00756 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_ad9b21302fa262b7bd7b06602b904af85}\label{class_plastic_deformer_1_1_imp_ad9b21302fa262b7bd7b06602b904af85}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!releaseInitializedData@{releaseInitializedData}}
\index{releaseInitializedData@{releaseInitializedData}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{releaseInitializedData()}{releaseInitializedData()}}
{\footnotesize\ttfamily void Plastic\+Deformer\+::\+Imp\+::release\+Initialized\+Data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00447                                                 \{}
\DoxyCodeLine{00448   \textcolor{comment}{// Release m\_G and m\_H}}
\DoxyCodeLine{00449   \{}
\DoxyCodeLine{00450     \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin::spmat}} temp;}
\DoxyCodeLine{00451     swap(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}{m\_G}}, temp);}
\DoxyCodeLine{00452   \}  \textcolor{comment}{// Ensure resources release by swapping them}}
\DoxyCodeLine{00453   \{}
\DoxyCodeLine{00454     \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin::spmat}} temp;}
\DoxyCodeLine{00455     swap(\mbox{\hyperlink{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}{m\_H}}, temp);}
\DoxyCodeLine{00456   \}  \textcolor{comment}{// with newly initialized instances}}
\DoxyCodeLine{00457 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a131fb40ce682e124812af5b6e6fa6fe2}\label{class_plastic_deformer_1_1_imp_a131fb40ce682e124812af5b6e6fa6fe2}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_c@{m\_c}}
\index{m\_c@{m\_c}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_c}{m\_c}}
{\footnotesize\ttfamily double Plastic\+Deformer\+::\+Imp\+::m\+\_\+c\mbox{[}4\mbox{]}}



Known term and output coordinates. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}\label{class_plastic_deformer_1_1_imp_a8fc7acfe531d1878a794d6d5ceb79e51}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_compiled@{m\_compiled}}
\index{m\_compiled@{m\_compiled}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_compiled}{m\_compiled}}
{\footnotesize\ttfamily bool Plastic\+Deformer\+::\+Imp\+::m\+\_\+compiled}



Whether the deformer is ready to deform() 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a4bc9cface4b10940047f37fc5bacc23a}\label{class_plastic_deformer_1_1_imp_a4bc9cface4b10940047f37fc5bacc23a}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_constraints1@{m\_constraints1}}
\index{m\_constraints1@{m\_constraints1}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_constraints1}{m\_constraints1}}
{\footnotesize\ttfamily std\+::vector$<$Linear\+Constraint$>$ Plastic\+Deformer\+::\+Imp\+::m\+\_\+constraints1}

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}\label{class_plastic_deformer_1_1_imp_a4b0daf08e021d033d23f00cf9dd0b7bd}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_constraints3@{m\_constraints3}}
\index{m\_constraints3@{m\_constraints3}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_constraints3}{m\_constraints3}}
{\footnotesize\ttfamily std\+::vector$<$Linear\+Constraint$>$ Plastic\+Deformer\+::\+Imp\+::m\+\_\+constraints3}



Compiled constraints (depends on the above) 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a17733fbd44cac0801e7713c3d9ade7cd}\label{class_plastic_deformer_1_1_imp_a17733fbd44cac0801e7713c3d9ade7cd}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_fitTriangles@{m\_fitTriangles}}
\index{m\_fitTriangles@{m\_fitTriangles}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_fitTriangles}{m\_fitTriangles}}
{\footnotesize\ttfamily TPoint\+DPtr Plastic\+Deformer\+::\+Imp\+::m\+\_\+fit\+Triangles}



Output face coordinates. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_aa07b28a2aac383cdfee3381e39e0a0c8}\label{class_plastic_deformer_1_1_imp_aa07b28a2aac383cdfee3381e39e0a0c8}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_fx@{m\_fx}}
\index{m\_fx@{m\_fx}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_fx}{m\_fx}}
{\footnotesize\ttfamily Double\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+fx}

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}\label{class_plastic_deformer_1_1_imp_a2e2518f11645b367985004d2e10761ff}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_fy@{m\_fy}}
\index{m\_fy@{m\_fy}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_fy}{m\_fy}}
{\footnotesize\ttfamily Double\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+fy}



Known terms. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}\label{class_plastic_deformer_1_1_imp_a5817a69ce471cf0229db9ef862456e73}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_G@{m\_G}}
\index{m\_G@{m\_G}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_G}{m\_G}}
{\footnotesize\ttfamily \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin\+::spmat}} Plastic\+Deformer\+::\+Imp\+::m\+\_\+G}

Pre-\/initialized entries for the 1st linear system \mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}\label{class_plastic_deformer_1_1_imp_a4bf3621f6d00d4c0fc2e2fe027169ea5}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_H@{m\_H}}
\index{m\_H@{m\_H}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_H}{m\_H}}
{\footnotesize\ttfamily \mbox{\hyperlink{classtlin_1_1sparse__matrix}{tlin\+::spmat}} Plastic\+Deformer\+::\+Imp\+::m\+\_\+H}



Step 3\textquotesingle{}s system entries. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}\label{class_plastic_deformer_1_1_imp_afc0fb583bac752141d0945492262d916}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_handles@{m\_handles}}
\index{m\_handles@{m\_handles}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_handles}{m\_handles}}
{\footnotesize\ttfamily std\+::vector$<$\mbox{\hyperlink{struct_plastic_handle}{Plastic\+Handle}}$>$ Plastic\+Deformer\+::\+Imp\+::m\+\_\+handles}



Compiled handles. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a59de886fbbab45ca04bf36e8e65f9c0c}\label{class_plastic_deformer_1_1_imp_a59de886fbbab45ca04bf36e8e65f9c0c}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_invC@{m\_invC}}
\index{m\_invC@{m\_invC}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_invC}{m\_invC}}
{\footnotesize\ttfamily Super\+Factors\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+invC}



C\textquotesingle{}s factors (C is G plus linear constraints) 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_ac0ea4056571d3d82487490b2603e53a3}\label{class_plastic_deformer_1_1_imp_ac0ea4056571d3d82487490b2603e53a3}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_invF@{m\_invF}}
\index{m\_invF@{m\_invF}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_invF}{m\_invF}}
{\footnotesize\ttfamily std\+::vector$<$Super\+Factors\+Ptr$>$ Plastic\+Deformer\+::\+Imp\+::m\+\_\+invF}



Each of step 2\textquotesingle{}s systems factorizations. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a0abb33a3267e98306f8377ab67294ef1}\label{class_plastic_deformer_1_1_imp_a0abb33a3267e98306f8377ab67294ef1}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_invK@{m\_invK}}
\index{m\_invK@{m\_invK}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_invK}{m\_invK}}
{\footnotesize\ttfamily Super\+Factors\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+invK}



System inverse. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}\label{class_plastic_deformer_1_1_imp_a97f7b9db8e9c790d0d095d9d476a341b}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_mesh@{m\_mesh}}
\index{m\_mesh@{m\_mesh}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_mesh}{m\_mesh}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TTexture\+MeshP}} Plastic\+Deformer\+::\+Imp\+::m\+\_\+mesh}



Deformed mesh (cannot be changed) 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_aa2a2a9a79d90c0d32006a5f7e29a7156}\label{class_plastic_deformer_1_1_imp_aa2a2a9a79d90c0d32006a5f7e29a7156}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_out@{m\_out}}
\index{m\_out@{m\_out}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_out}{m\_out}}
{\footnotesize\ttfamily Double\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+out}



Step 1\textquotesingle{}s result. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}\label{class_plastic_deformer_1_1_imp_a5bd33b3aeb6c6832e481dc583e2c382d}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_q@{m\_q}}
\index{m\_q@{m\_q}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_q}{m\_q}}
{\footnotesize\ttfamily Double\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+q}



Step 1\textquotesingle{}s known term. 

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a1c4fadda8377962d536a7dd9848d844b}\label{class_plastic_deformer_1_1_imp_a1c4fadda8377962d536a7dd9848d844b}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_relativeCoords@{m\_relativeCoords}}
\index{m\_relativeCoords@{m\_relativeCoords}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_relativeCoords}{m\_relativeCoords}}
{\footnotesize\ttfamily TPoint\+DPtr Plastic\+Deformer\+::\+Imp\+::m\+\_\+relative\+Coords}

Faces\textquotesingle{} p2 coordinates in (p0, p1)\textquotesingle{}s orthogonal reference \mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a7b894c1286126c329aace2879bb22f7f}\label{class_plastic_deformer_1_1_imp_a7b894c1286126c329aace2879bb22f7f}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_v@{m\_v}}
\index{m\_v@{m\_v}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_v}{m\_v}}
{\footnotesize\ttfamily double Plastic\+Deformer\+::\+Imp\+::m\+\_\+v\mbox{[}4\mbox{]}}

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_aaa73e9b062be1ca3e7c0e9431a450c5b}\label{class_plastic_deformer_1_1_imp_aaa73e9b062be1ca3e7c0e9431a450c5b}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_x@{m\_x}}
\index{m\_x@{m\_x}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_x}{m\_x}}
{\footnotesize\ttfamily Double\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+x}

\mbox{\Hypertarget{class_plastic_deformer_1_1_imp_a79166603414d14c8271531330f7641e5}\label{class_plastic_deformer_1_1_imp_a79166603414d14c8271531330f7641e5}} 
\index{PlasticDeformer::Imp@{PlasticDeformer::Imp}!m\_y@{m\_y}}
\index{m\_y@{m\_y}!PlasticDeformer::Imp@{PlasticDeformer::Imp}}
\doxysubsubsection{\texorpdfstring{m\_y}{m\_y}}
{\footnotesize\ttfamily Double\+Ptr Plastic\+Deformer\+::\+Imp\+::m\+\_\+y}



Output values. 



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnzext/\mbox{\hyperlink{plasticdeformer_8cpp}{plasticdeformer.\+cpp}}\end{DoxyCompactItemize}
