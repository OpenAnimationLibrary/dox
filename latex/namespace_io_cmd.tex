\hypertarget{namespace_io_cmd}{}\doxysection{Io\+Cmd Namespace Reference}
\label{namespace_io_cmd}\index{IoCmd@{IoCmd}}


Contains command functions related to Toonz I/O. ~\newline
  


\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_io_cmd_1_1_converting_popup}{Converting\+Popup}}
\item 
struct \mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}}
\begin{DoxyCompactList}\small\item\em Collection of options accepted by the export level command. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{Load\+Resource\+Arguments}}
\begin{DoxyCompactList}\small\item\em Composite data used describing a group of Toonz resources to be loaded. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{struct_io_cmd_1_1_overwrite_callbacks}{Overwrite\+Callbacks}}
\item 
struct \mbox{\hyperlink{struct_io_cmd_1_1_progress_callbacks}{Progress\+Callbacks}}
\end{DoxyCompactItemize}
\doxysubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Save\+Scene\+Flags} \{ {\bfseries SILENTLY\+\_\+\+OVERWRITE} = 0x1
, {\bfseries SAVE\+\_\+\+SUBXSHEET} = 0x2
, {\bfseries AUTO\+\_\+\+SAVE} = 0x4
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \mbox{\hyperlink{namespace_io_cmd_afbfa3598864913d35bef6b4cb75c1e45}{exported\+Image}} (const std\+::string \&ext, const \mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} \&sl, const \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} \&fid, const \mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}} \&opts=\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}}())
\begin{DoxyCompactList}\small\item\em Intended for preview purposes, computes the image that will be exported by the \mbox{\hyperlink{namespace_io_cmd_a99bbb49fbdaab858ec5310ab8c72521a}{export\+Level()}} command. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{namespace_io_cmd_a99bbb49fbdaab858ec5310ab8c72521a}{export\+Level}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, \mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$sl=0, \mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}} opts=\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}}(), \mbox{\hyperlink{struct_io_cmd_1_1_overwrite_callbacks}{Overwrite\+Callbacks}} $\ast$overwrite\+CB=0, \mbox{\hyperlink{struct_io_cmd_1_1_progress_callbacks}{Progress\+Callbacks}} $\ast$progress\+CB=0)
\begin{DoxyCompactList}\small\item\em Exports passed level to the specified path. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespace_io_cmd_a0744065a16191fcb9785de9edcef0c39}{new\+Scene}} ()
\item 
bool \mbox{\hyperlink{namespace_io_cmd_aa93737c840f2f6389c72c65e178186fc}{load\+Scene}} (\mbox{\hyperlink{class_toonz_scene}{Toonz\+Scene}} \&scene, const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&scene\+Path, bool import)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_aacb798ecd90262670a20d3cdc9730d92}{load\+Scene}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&scene\+Path, bool update\+Recent\+File=true, bool check\+Save\+Old\+Scene=true)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a576f240ddca3be721c59540731b8547f}{load\+Scene}} ()
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a869809aa031fe7dccc55472657e459ae}{load\+Sub\+Scene}} ()
\item 
bool \mbox{\hyperlink{namespace_io_cmd_af6331f41f6a68e8fac4d25fbf12a9596}{load\+Sub\+Scene}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&scene\+Path)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a62f202786d36605ae3e1c4d3b99651a3}{save\+Scene}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp, int flags)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_aa7115d1d248236e7274bfe5f947f028a}{save\+Scene}} (int flags=0)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a98582f18716776eccfc2332996cd615b}{save\+Level}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a1553ac159a224b46c7ab172b048125e9}{save\+Level}} ()
\item 
bool \mbox{\hyperlink{namespace_io_cmd_ace7b0a1cc73ddbfc14483d3415609396}{save\+Level}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp, \mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$sl, bool overwrite)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_af73b59e57b994553e045e193655d8a8c}{save\+Level}} (\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$sl)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_ac7e81603b00421a5921bdf482a458758}{save\+All}} (int flags=0)
\item 
void \mbox{\hyperlink{namespace_io_cmd_a1872b1c5260e011f557d45631eed83c5}{save\+Non\+Scene\+Files}} ()
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a3e9b7393f785dd784c38efe0788b45a4}{save\+Sound}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp, \mbox{\hyperlink{class_t_xsh_sound_level}{TXsh\+Sound\+Level}} $\ast$sc, bool overwrite)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a0d61d8a7c69ed6a011f7addd5adb1390}{save\+Sound}} (\mbox{\hyperlink{class_t_xsh_sound_level}{TXsh\+Sound\+Level}} $\ast$sc)
\item 
int \mbox{\hyperlink{namespace_io_cmd_a107f6d3100b922e0c09e9b4aa1a8602a}{load\+Resources}} (\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{Load\+Resource\+Arguments}} \&args, bool update\+Recent\+Files=true, \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block}{Load\+Resource\+Arguments\+::\+Scoped\+Block}} $\ast$sb=0)
\item 
int \mbox{\hyperlink{namespace_io_cmd_a0e4a4aacfc92a744c3eb69ee087946db}{load\+Resource\+Folders}} (\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{Load\+Resource\+Arguments}} \&args, \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block}{Load\+Resource\+Arguments\+::\+Scoped\+Block}} $\ast$sb=0)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a717e5aae0e8ee4b19a6e58cbda8bfecf}{expose\+Level}} (\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$sl, int row, int col, bool insert=false, bool over\+Write=false)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a1923da5539d48874d2ae236af8462e98}{expose\+Level}} (\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$sl, int row, int col, const std\+::vector$<$ \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} $>$ \&fids, bool insert=false, bool over\+Write=false)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_a5e6da51135e070996c599fe16bd4bbd3}{save\+Scene\+If\+Needed}} (QString msg)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_abfb5ff0c0d7c59bef7802b8ce55d15fc}{expose\+Comment}} (int row, int \&col, QList$<$ QString $>$ comment\+List, QString file\+Name)
\begin{DoxyCompactList}\small\item\em Create and expose column with comment in {\bfseries{comment\+List}}. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{namespace_io_cmd_a4f2faadbbacdf21975a71dfaaa0f30f6}{import\+Lip\+Sync}} (\mbox{\hyperlink{class_t_file_path}{TFile\+Path}} level\+Path, QList$<$ \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} $>$ frame\+List, QList$<$ QString $>$ comment\+List, QString file\+Name)
\item 
bool \mbox{\hyperlink{namespace_io_cmd_aa512f1a040d635719070d84e1fe4e733}{take\+Care\+Scene\+Folder\+Items\+On\+Save\+Scene\+As}} (\mbox{\hyperlink{class_toonz_scene}{Toonz\+Scene}} $\ast$scene, const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&new\+Path, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$subxsh, QHash$<$ \mbox{\hyperlink{class_t_xsh_level}{TXsh\+Level}} $\ast$, \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} $>$ \&org\+Level\+Paths)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Contains command functions related to Toonz I/O. ~\newline
 

\doxysubsection{Enumeration Type Documentation}
\mbox{\Hypertarget{namespace_io_cmd_a2e85d0d7111af66de5d2ec589939c43a}\label{namespace_io_cmd_a2e85d0d7111af66de5d2ec589939c43a}} 
\index{IoCmd@{IoCmd}!SaveSceneFlags@{SaveSceneFlags}}
\index{SaveSceneFlags@{SaveSceneFlags}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{SaveSceneFlags}{SaveSceneFlags}}
{\footnotesize\ttfamily enum Io\+Cmd\+::\+Save\+Scene\+Flags}


\begin{DoxyCode}{0}
\DoxyCodeLine{00186                     \{}
\DoxyCodeLine{00187   SILENTLY\_OVERWRITE = 0x1,}
\DoxyCodeLine{00188   SAVE\_SUBXSHEET     = 0x2,}
\DoxyCodeLine{00189   AUTO\_SAVE          = 0x4}
\DoxyCodeLine{00190 \};}

\end{DoxyCode}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespace_io_cmd_afbfa3598864913d35bef6b4cb75c1e45}\label{namespace_io_cmd_afbfa3598864913d35bef6b4cb75c1e45}} 
\index{IoCmd@{IoCmd}!exportedImage@{exportedImage}}
\index{exportedImage@{exportedImage}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{exportedImage()}{exportedImage()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} Io\+Cmd\+::exported\+Image (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{ext,  }\item[{const \mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} \&}]{sl,  }\item[{const \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} \&}]{fid,  }\item[{const \mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}} \&}]{opts = {\ttfamily \mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}}()} }\end{DoxyParamCaption})}



Intended for preview purposes, computes the image that will be exported by the \mbox{\hyperlink{namespace_io_cmd_a99bbb49fbdaab858ec5310ab8c72521a}{export\+Level()}} command. 

\begin{DoxyRemark}{Remarks}
Supplied image {\itshape may} be the one retrievable by sl, depending on whether the specified options require it to be modified.
\end{DoxyRemark}
\begin{DoxyReturn}{Returns}
The image that will be exported by the \mbox{\hyperlink{namespace_io_cmd_a99bbb49fbdaab858ec5310ab8c72521a}{export\+Level()}} command. 
\end{DoxyReturn}

\begin{DoxyParams}{Parameters}
{\em ext} & File extension -\/ like {\itshape tga}, {\itshape tlv}, {\itshape png}, etc... \\
\hline
{\em sl} & Level host of the image to be exported. \\
\hline
{\em fid} & Frame of the image in sl. \\
\hline
{\em opts} & Export options. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00397                                                              \{}
\DoxyCodeLine{00398   ImageExporter exporter(sl, opts);}
\DoxyCodeLine{00399 }
\DoxyCodeLine{00400   \textcolor{keywordflow}{return} exporter.exportedImage(fid, (ext == \textcolor{stringliteral}{"{}tlv"{}}) ? TZP\_TYPE : OVL\_TYPE);}
\DoxyCodeLine{00401 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a99bbb49fbdaab858ec5310ab8c72521a}\label{namespace_io_cmd_a99bbb49fbdaab858ec5310ab8c72521a}} 
\index{IoCmd@{IoCmd}!exportLevel@{exportLevel}}
\index{exportLevel@{exportLevel}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{exportLevel()}{exportLevel()}}
{\footnotesize\ttfamily bool Io\+Cmd\+::export\+Level (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{path,  }\item[{\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$}]{sl = {\ttfamily 0},  }\item[{\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}}}]{opts = {\ttfamily \mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{Export\+Level\+Options}}()},  }\item[{\mbox{\hyperlink{struct_io_cmd_1_1_overwrite_callbacks}{Overwrite\+Callbacks}} $\ast$}]{overwrite\+CB = {\ttfamily 0},  }\item[{\mbox{\hyperlink{struct_io_cmd_1_1_progress_callbacks}{Progress\+Callbacks}} $\ast$}]{progress\+CB = {\ttfamily 0} }\end{DoxyParamCaption})}



Exports passed level to the specified path. 

\begin{DoxyReturn}{Returns}
Whether the level was successfully exported {\itshape in its entirety}. User cancels are reported as failures, even if a part of the level has been successfully exported.
\end{DoxyReturn}
This function performs level export depending on the specified path\textquotesingle{}s extension, and optional parameters. If no input level is specified for the export, this function attempts the export of currently active level (if any).

This function allows external callbacks to deal with overwrite and progress notifications. If no callback is supplied to the function, default ones will be used. 
\begin{DoxyParams}{Parameters}
{\em path} & File path to export the level to. \\
\hline
{\em sl} & Level to export; if {\ttfamily 0}, current level will be used. \\
\hline
{\em opts} & Export options. \\
\hline
{\em overwrite\+CB} & External callbacks to overwrite requests. \\
\hline
{\em progress\+CB} & External callbacks to progress notifications. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00416                                                        \{}
\DoxyCodeLine{00417   \textcolor{keyword}{struct }Locals \{}
\DoxyCodeLine{00418     \textcolor{keyword}{const} \mbox{\hyperlink{class_t_file_path}{TFilePath}} \&m\_path;}
\DoxyCodeLine{00419     \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *m\_sl;}
\DoxyCodeLine{00420     \textcolor{keyword}{const} \mbox{\hyperlink{struct_io_cmd_1_1_export_level_options}{ExportLevelOptions}} \&m\_opts;}
\DoxyCodeLine{00421 }
\DoxyCodeLine{00422     \mbox{\hyperlink{struct_io_cmd_1_1_overwrite_callbacks}{OverwriteCallbacks}} *m\_overwriteCB;}
\DoxyCodeLine{00423     \mbox{\hyperlink{struct_io_cmd_1_1_progress_callbacks}{ProgressCallbacks}} *m\_progressCB;}
\DoxyCodeLine{00424 }
\DoxyCodeLine{00425     \textcolor{keywordtype}{bool} exportToMultifile() \{}
\DoxyCodeLine{00426       ImageExporter exporter(*m\_sl, m\_opts);}
\DoxyCodeLine{00427 }
\DoxyCodeLine{00428       TXshLevelType outputLevelType =}
\DoxyCodeLine{00429           (m\_path.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}tlv"{}}) ? TZP\_TYPE : OVL\_TYPE;}
\DoxyCodeLine{00430 }
\DoxyCodeLine{00431       \textcolor{keywordtype}{bool} firstTime = \textcolor{keyword}{true};}
\DoxyCodeLine{00432       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m\_sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a3fe127306d6669a3eb9e9d8802660d7b}{getFrameCount}}(); ++i) \{}
\DoxyCodeLine{00433         \textcolor{keywordflow}{if} (m\_progressCB-\/>canceled()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00434 }
\DoxyCodeLine{00435         \textcolor{comment}{// Prepare frame export path}}
\DoxyCodeLine{00436         \mbox{\hyperlink{class_t_file_path}{TFilePath}} fpout;}
\DoxyCodeLine{00437 }
\DoxyCodeLine{00438         \textcolor{keywordflow}{if} (m\_opts.\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options_ad03d9f575e978f592f7793d3be93b500}{m\_forRetas}}) \{}
\DoxyCodeLine{00439           QString pathOut =}
\DoxyCodeLine{00440               QString::fromStdWString(m\_path.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}().getWideString()) +}
\DoxyCodeLine{00441               \textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)"{}} + QString::fromStdString(m\_path.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()) +}
\DoxyCodeLine{00442               QString::fromStdString(m\_sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a07279a40ffad2c6ccc597c0a418f78fb}{index2fid}}(i).expand()) + \textcolor{stringliteral}{"{}."{}} +}
\DoxyCodeLine{00443               QString::fromStdString(m\_path.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}());}
\DoxyCodeLine{00444           fpout = \mbox{\hyperlink{class_t_file_path}{TFilePath}}(pathOut.toStdString());}
\DoxyCodeLine{00445         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00446           fpout = \mbox{\hyperlink{class_t_file_path}{TFilePath}}(m\_path.\mbox{\hyperlink{class_t_file_path_a12f35b225e1882372ad7e02ad7fce543}{withFrame}}(m\_sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a07279a40ffad2c6ccc597c0a418f78fb}{index2fid}}(i)));}
\DoxyCodeLine{00447 }
\DoxyCodeLine{00448         \textcolor{comment}{// Ask for overwrite permission in case a level with the built path}}
\DoxyCodeLine{00449         \textcolor{comment}{// already exists}}
\DoxyCodeLine{00450         \textcolor{keywordflow}{if} (firstTime) \{}
\DoxyCodeLine{00451           firstTime = \textcolor{keyword}{false};}
\DoxyCodeLine{00452 }
\DoxyCodeLine{00453           \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(fpout)) \{}
\DoxyCodeLine{00454             QApplication::restoreOverrideCursor();}
\DoxyCodeLine{00455             \textcolor{keywordtype}{bool} overwrite = m\_overwriteCB-\/>\mbox{\hyperlink{struct_io_cmd_1_1_overwrite_callbacks_a38783ba3d36c85d69e87faaf13f38d30}{overwriteRequest}}(fpout);}
\DoxyCodeLine{00456             QApplication::setOverrideCursor(Qt::WaitCursor);}
\DoxyCodeLine{00457 }
\DoxyCodeLine{00458             \textcolor{keywordflow}{if} (!overwrite) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00459           \}}
\DoxyCodeLine{00460         \}}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462         \textcolor{comment}{// Retrieve the image to export at current frame}}
\DoxyCodeLine{00463         \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img =}
\DoxyCodeLine{00464             exporter.exportedImage(m\_sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a07279a40ffad2c6ccc597c0a418f78fb}{index2fid}}(i), outputLevelType);}
\DoxyCodeLine{00465         assert(img);}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467         \textcolor{comment}{// Save the prepared fullcolor image to file}}
\DoxyCodeLine{00468         \mbox{\hyperlink{class_t_image_writer}{TImageWriter}} iw(fpout);}
\DoxyCodeLine{00469         iw.setProperties(m\_opts.\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options_a7037b7cdde2fb931afd66ff9392fab13}{m\_props}});}
\DoxyCodeLine{00470         iw.save(img);}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472         m\_progressCB-\/>setValue(i + 1);}
\DoxyCodeLine{00473       \}}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00476     \}}
\DoxyCodeLine{00477 }
\DoxyCodeLine{00478     \textcolor{keywordtype}{bool} exportToTlv() \{}
\DoxyCodeLine{00479       \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp(m\_path.withNoFrame());}
\DoxyCodeLine{00480 }
\DoxyCodeLine{00481       \textcolor{comment}{// Remove any existing level}}
\DoxyCodeLine{00482       \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(fp)) \{}
\DoxyCodeLine{00483         \textcolor{keywordtype}{bool} overwrite = m\_overwriteCB-\/>\mbox{\hyperlink{struct_io_cmd_1_1_overwrite_callbacks_a38783ba3d36c85d69e87faaf13f38d30}{overwriteRequest}}(fp);}
\DoxyCodeLine{00484         \textcolor{keywordflow}{if} (!overwrite) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00485 }
\DoxyCodeLine{00486         TSystem::deleteFile(fp);}
\DoxyCodeLine{00487       \}}
\DoxyCodeLine{00488 }
\DoxyCodeLine{00489       TSystem::removeFileOrLevel(fp.withType(\textcolor{stringliteral}{"{}tpl"{}}));}
\DoxyCodeLine{00490 }
\DoxyCodeLine{00491       \textcolor{comment}{// Export level}}
\DoxyCodeLine{00492       \mbox{\hyperlink{class_t_level_writer_p}{TLevelWriterP}} lw(fp);}
\DoxyCodeLine{00493 }
\DoxyCodeLine{00494       ImageExporter exporter(*m\_sl, m\_opts);}
\DoxyCodeLine{00495 }
\DoxyCodeLine{00496       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m\_sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a3fe127306d6669a3eb9e9d8802660d7b}{getFrameCount}}(); ++i) \{}
\DoxyCodeLine{00497         \textcolor{keywordflow}{if} (m\_progressCB-\/>canceled()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00498 }
\DoxyCodeLine{00499         \textcolor{keyword}{const} \mbox{\hyperlink{class_t_frame_id}{TFrameId}} \&fid = m\_sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a07279a40ffad2c6ccc597c0a418f78fb}{index2fid}}(i);}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501         \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img = exporter.exportedImage(fid, TZP\_TYPE);}
\DoxyCodeLine{00502         assert(img);}
\DoxyCodeLine{00503 }
\DoxyCodeLine{00504         lw-\/>getFrameWriter(fid)-\/>save(img);}
\DoxyCodeLine{00505 }
\DoxyCodeLine{00506         m\_progressCB-\/>setValue(i + 1);}
\DoxyCodeLine{00507       \}}
\DoxyCodeLine{00508 }
\DoxyCodeLine{00509       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00510     \}}
\DoxyCodeLine{00511   \};  \textcolor{comment}{// Locals}}
\DoxyCodeLine{00512 }
\DoxyCodeLine{00513   \textcolor{comment}{// Use default values in case some were not specified by input}}
\DoxyCodeLine{00514 }
\DoxyCodeLine{00515   \textcolor{comment}{// Level}}
\DoxyCodeLine{00516   \textcolor{keywordflow}{if} (!sl) \{}
\DoxyCodeLine{00517     sl = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>getSimpleLevel();}
\DoxyCodeLine{00518 }
\DoxyCodeLine{00519     \textcolor{keywordflow}{if} (!sl) \{}
\DoxyCodeLine{00520       DVGui::error(QObject::tr(\textcolor{stringliteral}{"{}No level selected!"{}}));}
\DoxyCodeLine{00521       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00522     \}}
\DoxyCodeLine{00523   \}}
\DoxyCodeLine{00524 }
\DoxyCodeLine{00525   \textcolor{keywordflow}{if} (sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a7c256d2745209a181a2dbccdec949c5e}{isEmpty}}()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00526 }
\DoxyCodeLine{00527   \textcolor{comment}{// Output properties}}
\DoxyCodeLine{00528   \textcolor{keywordflow}{if} (!opts.\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options_a7037b7cdde2fb931afd66ff9392fab13}{m\_props}}) \{}
\DoxyCodeLine{00529     \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{00530     opts.\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options_a7037b7cdde2fb931afd66ff9392fab13}{m\_props}} =}
\DoxyCodeLine{00531         scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_abea7b4b8e4f0cedbf753b26ec30b5331}{getOutputProperties}}()-\/>\mbox{\hyperlink{class_t_output_properties_a9ef174e6f6239219fa563b037246c8d4}{getFileFormatProperties}}(}
\DoxyCodeLine{00532             path.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}());}
\DoxyCodeLine{00533   \}}
\DoxyCodeLine{00534 }
\DoxyCodeLine{00535   \textcolor{comment}{// Camera (todo)}}
\DoxyCodeLine{00536   assert(opts.\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options_a8df94678a4989d05c5d59b564bd8d603}{m\_camera}}.\mbox{\hyperlink{class_t_camera_a9a7c573e7a2c397ffae4b747809ea2a5}{getRes}}().lx > 0 \&\& opts.\mbox{\hyperlink{struct_io_cmd_1_1_export_level_options_a8df94678a4989d05c5d59b564bd8d603}{m\_camera}}.\mbox{\hyperlink{class_t_camera_a9a7c573e7a2c397ffae4b747809ea2a5}{getRes}}().ly > 0);}
\DoxyCodeLine{00537 }
\DoxyCodeLine{00538   \textcolor{comment}{// Callbacks}}
\DoxyCodeLine{00539   std::unique\_ptr<OverwriteCallbacks> overwriteDefault(}
\DoxyCodeLine{00540       overwriteCB ? 0 : (overwriteCB = \textcolor{keyword}{new} ExportOverwriteCB()));}
\DoxyCodeLine{00541   std::unique\_ptr<ProgressCallbacks> progressDefault(}
\DoxyCodeLine{00542       progressCB ? 0 : (progressCB = \textcolor{keyword}{new} ExportProgressCB()));}
\DoxyCodeLine{00543 }
\DoxyCodeLine{00544   \textcolor{comment}{// Initialize variables}}
\DoxyCodeLine{00545   Locals locals = \{path, sl, opts, overwriteCB, progressCB\};}
\DoxyCodeLine{00546 }
\DoxyCodeLine{00547   progressCB-\/>setProcessedName(QString::fromStdWString(path.getWideString()));}
\DoxyCodeLine{00548   progressCB-\/>setRange(0, sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a3fe127306d6669a3eb9e9d8802660d7b}{getFrameCount}}());}
\DoxyCodeLine{00549 }
\DoxyCodeLine{00550   \textcolor{comment}{// Export level}}
\DoxyCodeLine{00551   BusyCursorOverride cursorOverride;}
\DoxyCodeLine{00552   QCoreApplication::processEvents();  \textcolor{comment}{// Refresh screen.   ...But WHY is this}}
\DoxyCodeLine{00553                                       \textcolor{comment}{//                      necessary?}}
\DoxyCodeLine{00554   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00555     \textcolor{keywordflow}{return} (path.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}tlv"{}}) ? assert(sl-\/>\mbox{\hyperlink{class_t_xsh_level_a1a147f1e970a62120c0bbaf0020a8932}{getType}}() == PLI\_XSHLEVEL),}
\DoxyCodeLine{00556            locals.exportToTlv() : locals.exportToMultifile();}
\DoxyCodeLine{00557   \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{00558     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00559   \}}
\DoxyCodeLine{00560 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00122}{TApp\+::get\+Current\+Level()}}, \mbox{\hyperlink{l00106}{TApp\+::get\+Current\+Scene()}}, \mbox{\hyperlink{l00156}{TOutput\+Properties\+::get\+File\+Format\+Properties()}}, \mbox{\hyperlink{l00158}{TXsh\+Simple\+Level\+::get\+Frame\+Count()}}, \mbox{\hyperlink{l00636}{TFile\+Path\+::get\+Name()}}, \mbox{\hyperlink{l00145}{TScene\+Properties\+::get\+Output\+Properties()}}, \mbox{\hyperlink{l00683}{TFile\+Path\+::get\+Parent\+Dir()}}, \mbox{\hyperlink{l00087}{Toonz\+Scene\+::get\+Properties()}}, \mbox{\hyperlink{l00072}{TCamera\+::get\+Res()}}, \mbox{\hyperlink{l00225}{TFile\+Path\+::get\+Type()}}, \mbox{\hyperlink{l00081}{TXsh\+Level\+::get\+Type()}}, \mbox{\hyperlink{l00544}{TXsh\+Simple\+Level\+::index2fid()}}, \mbox{\hyperlink{l00215}{TApp\+::instance()}}, \mbox{\hyperlink{l00147}{TXsh\+Simple\+Level\+::is\+Empty()}}, \mbox{\hyperlink{l00066}{Io\+Cmd\+::\+Export\+Level\+Options\+::m\+\_\+camera}}, \mbox{\hyperlink{l00076}{Io\+Cmd\+::\+Export\+Level\+Options\+::m\+\_\+for\+Retas}}, \mbox{\hyperlink{l00063}{Io\+Cmd\+::\+Export\+Level\+Options\+::m\+\_\+props}}, \mbox{\hyperlink{struct_io_cmd_1_1_overwrite_callbacks_a38783ba3d36c85d69e87faaf13f38d30}{Io\+Cmd\+::\+Overwrite\+Callbacks\+::overwrite\+Request()}}, \mbox{\hyperlink{l00860}{TFile\+Path\+::with\+Frame()}}, and \mbox{\hyperlink{l00774}{TFile\+Path\+::with\+Type()}}.



Referenced by \mbox{\hyperlink{l00610}{Export\+Level\+Popup\+::execute()}}.

\mbox{\Hypertarget{namespace_io_cmd_abfb5ff0c0d7c59bef7802b8ce55d15fc}\label{namespace_io_cmd_abfb5ff0c0d7c59bef7802b8ce55d15fc}} 
\index{IoCmd@{IoCmd}!exposeComment@{exposeComment}}
\index{exposeComment@{exposeComment}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{exposeComment()}{exposeComment()}}
{\footnotesize\ttfamily bool Io\+Cmd\+::expose\+Comment (\begin{DoxyParamCaption}\item[{int}]{row,  }\item[{int \&}]{col,  }\item[{QList$<$ QString $>$}]{comment\+List,  }\item[{QString}]{file\+Name }\end{DoxyParamCaption})}



Create and expose column with comment in {\bfseries{comment\+List}}. 


\begin{DoxyCode}{0}
\DoxyCodeLine{02647                                             \{}
\DoxyCodeLine{02648   \mbox{\hyperlink{class_t_app}{TApp}} *app                         = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{02649   \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh                      = app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>getXsheet();}
\DoxyCodeLine{02650   \mbox{\hyperlink{class_t_xsh_sound_text_column}{TXshSoundTextColumn}} *textSoundCol = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_xsh_sound_text_column}{TXshSoundTextColumn}}();}
\DoxyCodeLine{02651   textSoundCol-\/>\mbox{\hyperlink{class_t_xsh_column_ad4badbad6279671e8a42037873647de9}{setXsheet}}(xsh);}
\DoxyCodeLine{02652   textSoundCol-\/>createSoundTextLevel(row, commentList);}
\DoxyCodeLine{02653   \textcolor{keywordtype}{bool} columnInserted = beforeCellsInsert(xsh, row, col, commentList.size(),}
\DoxyCodeLine{02654                                           TXshColumn::eSoundTextType);}
\DoxyCodeLine{02655   xsh-\/>\mbox{\hyperlink{class_t_xsheet_a5ea42662e27e52ef36ce77b4a5d8e06c}{insertColumn}}(col, textSoundCol);}
\DoxyCodeLine{02656 }
\DoxyCodeLine{02657   \textcolor{comment}{// Setto il nome di dafult della colonna al nome del file magpie.}}
\DoxyCodeLine{02658   \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj = xsh-\/>\mbox{\hyperlink{class_t_xsheet_a13d9b9c08ca8dde39769f5644e046ee5}{getStageObject}}(TStageObjectId::ColumnId(col));}
\DoxyCodeLine{02659   std::string str   = fileName.toStdString();}
\DoxyCodeLine{02660   obj-\/>setName(str);}
\DoxyCodeLine{02661 }
\DoxyCodeLine{02662   TUndoManager::manager()-\/>add(}
\DoxyCodeLine{02663       \textcolor{keyword}{new} ExposeCommentUndo(textSoundCol, col, columnInserted, fileName));}
\DoxyCodeLine{02664 }
\DoxyCodeLine{02665   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02666 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00110}{TApp\+::get\+Current\+Xsheet()}}, \mbox{\hyperlink{l00542}{TXsheet\+::get\+Stage\+Object()}}, \mbox{\hyperlink{l01324}{TXsheet\+::insert\+Column()}}, \mbox{\hyperlink{l00215}{TApp\+::instance()}}, and \mbox{\hyperlink{l00232}{TXsh\+Column\+::set\+Xsheet()}}.

\mbox{\Hypertarget{namespace_io_cmd_a717e5aae0e8ee4b19a6e58cbda8bfecf}\label{namespace_io_cmd_a717e5aae0e8ee4b19a6e58cbda8bfecf}} 
\index{IoCmd@{IoCmd}!exposeLevel@{exposeLevel}}
\index{exposeLevel@{exposeLevel}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{exposeLevel()}{exposeLevel()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::expose\+Level (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$}]{sl,  }\item[{int}]{row,  }\item[{int}]{col,  }\item[{bool}]{insert = {\ttfamily false},  }\item[{bool}]{over\+Write = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02604                                         \{}
\DoxyCodeLine{02605   \mbox{\hyperlink{class_t_app}{TApp}} *app    = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{02606   \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh = app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>getXsheet();}
\DoxyCodeLine{02607   assert(xsh);}
\DoxyCodeLine{02608   std::vector<TFrameId> fids;}
\DoxyCodeLine{02609   sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a567daee4ca12a0e92445bcf98a6541f1}{getFids}}(fids);}
\DoxyCodeLine{02610   \textcolor{keywordflow}{return} exposeLevel(sl, row, col, fids, insert, overWrite);}
\DoxyCodeLine{02611 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a1923da5539d48874d2ae236af8462e98}\label{namespace_io_cmd_a1923da5539d48874d2ae236af8462e98}} 
\index{IoCmd@{IoCmd}!exposeLevel@{exposeLevel}}
\index{exposeLevel@{exposeLevel}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{exposeLevel()}{exposeLevel()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::expose\+Level (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$}]{sl,  }\item[{int}]{row,  }\item[{int}]{col,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} $>$ \&}]{fids,  }\item[{bool}]{insert = {\ttfamily false},  }\item[{bool}]{over\+Write = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02619                                         \{}
\DoxyCodeLine{02620   assert(sl);}
\DoxyCodeLine{02621 }
\DoxyCodeLine{02622   \mbox{\hyperlink{class_t_app}{TApp}} *app    = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{02623   \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh = app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>getXsheet();}
\DoxyCodeLine{02624   assert(xsh);}
\DoxyCodeLine{02625   \textcolor{keywordtype}{int} frameCount         = fids.size();}
\DoxyCodeLine{02626   \textcolor{keywordtype}{bool} insertEmptyColumn = \textcolor{keyword}{false};}
\DoxyCodeLine{02627   \textcolor{keywordflow}{if} (!insert \&\& !overWrite)}
\DoxyCodeLine{02628     insertEmptyColumn = beforeCellsInsert(}
\DoxyCodeLine{02629         xsh, row, col, fids.size(), \mbox{\hyperlink{class_t_xsh_column_ae8f60aa38588cfb590725ce632ee6d02}{TXshColumn::toColumnType}}(sl-\/>\mbox{\hyperlink{class_t_xsh_level_a1a147f1e970a62120c0bbaf0020a8932}{getType}}()));}
\DoxyCodeLine{02630   ExposeType type = eNone;}
\DoxyCodeLine{02631   \textcolor{keywordflow}{if} (insert) type = eShiftCells;}
\DoxyCodeLine{02632   \textcolor{keywordflow}{if} (overWrite) type = eOverWrite;}
\DoxyCodeLine{02633   ExposeLevelUndo *undo =}
\DoxyCodeLine{02634       \textcolor{keyword}{new} ExposeLevelUndo(sl, row, col, frameCount, insertEmptyColumn, type);}
\DoxyCodeLine{02635   xsh-\/>\mbox{\hyperlink{class_t_xsheet_ad2812514a3f36e1a61cbf71aa7f21cd5}{exposeLevel}}(row, col, sl, fids, overWrite);}
\DoxyCodeLine{02636   undo-\/>setFids(fids);}
\DoxyCodeLine{02637   TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{02638   app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>notifyXsheetChanged();}
\DoxyCodeLine{02639   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02640 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a4f2faadbbacdf21975a71dfaaa0f30f6}\label{namespace_io_cmd_a4f2faadbbacdf21975a71dfaaa0f30f6}} 
\index{IoCmd@{IoCmd}!importLipSync@{importLipSync}}
\index{importLipSync@{importLipSync}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{importLipSync()}{importLipSync()}}
{\footnotesize\ttfamily bool Io\+Cmd\+::import\+Lip\+Sync (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_file_path}{TFile\+Path}}}]{level\+Path,  }\item[{QList$<$ \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} $>$}]{frame\+List,  }\item[{QList$<$ QString $>$}]{comment\+List,  }\item[{QString}]{file\+Name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02673                                                                         \{}
\DoxyCodeLine{02674   \mbox{\hyperlink{class_t_app}{TApp}} *app = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{02675   \textcolor{keywordtype}{int} col   = app-\/>\mbox{\hyperlink{class_t_app_a1e294e7cff300851d12a8c3d196943f6}{getCurrentColumn}}()-\/>getColumnIndex();}
\DoxyCodeLine{02676   \textcolor{keywordtype}{int} row   = app-\/>\mbox{\hyperlink{class_t_app_a35516f8175dab3ccdf3d6d3c3e5f59ae}{getCurrentFrame}}()-\/>getFrameIndex();}
\DoxyCodeLine{02677 }
\DoxyCodeLine{02678   \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{IoCmd::LoadResourceArguments}} args;}
\DoxyCodeLine{02679   \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block}{IoCmd::LoadResourceArguments::ScopedBlock}} sb;}
\DoxyCodeLine{02680 }
\DoxyCodeLine{02681   \textcolor{comment}{// Create text column}}
\DoxyCodeLine{02682   \mbox{\hyperlink{namespace_io_cmd_abfb5ff0c0d7c59bef7802b8ce55d15fc}{IoCmd::exposeComment}}(row, col, commentList, fileName);}
\DoxyCodeLine{02683 }
\DoxyCodeLine{02684   \textcolor{comment}{// Load Level}}
\DoxyCodeLine{02685   args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.push\_back(levelPath);}
\DoxyCodeLine{02686   args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_aa69846d3da53cf7e64af73da3116c26a}{expose}} = \textcolor{keyword}{false};}
\DoxyCodeLine{02687 }
\DoxyCodeLine{02688   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{namespace_io_cmd_a107f6d3100b922e0c09e9b4aa1a8602a}{IoCmd::loadResources}}(args, \textcolor{keyword}{false}, \&sb)) \{}
\DoxyCodeLine{02689     DVGui::error(QObject::tr(\textcolor{stringliteral}{"{}It is not possible to load the level \%1"{}})}
\DoxyCodeLine{02690                      .arg(toQString(levelPath)));}
\DoxyCodeLine{02691     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02692   \}}
\DoxyCodeLine{02693 }
\DoxyCodeLine{02694   \textcolor{comment}{// Expose Level in xsheet}}
\DoxyCodeLine{02695   assert(args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a25af81323f9227d846e6aa7dbd4d6908}{loadedLevels}}.size() == 1);}
\DoxyCodeLine{02696   \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *loadedLevel = args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a25af81323f9227d846e6aa7dbd4d6908}{loadedLevels}}.at(0);}
\DoxyCodeLine{02697 }
\DoxyCodeLine{02698   std::vector<TFrameId> fids;}
\DoxyCodeLine{02699   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < frameList.size(); i++) fids.push\_back(frameList.at(i));}
\DoxyCodeLine{02700 }
\DoxyCodeLine{02701   \textcolor{keywordflow}{if} (!IoCmd::exposeLevel(loadedLevel-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}(), row, col, fids)) \{}
\DoxyCodeLine{02702     DVGui::error(QObject::tr(\textcolor{stringliteral}{"{}It is not possible to load the level \%1"{}})}
\DoxyCodeLine{02703                      .arg(toQString(levelPath)));}
\DoxyCodeLine{02704     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02705   \}}
\DoxyCodeLine{02706 }
\DoxyCodeLine{02707   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02708 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a0e4a4aacfc92a744c3eb69ee087946db}\label{namespace_io_cmd_a0e4a4aacfc92a744c3eb69ee087946db}} 
\index{IoCmd@{IoCmd}!loadResourceFolders@{loadResourceFolders}}
\index{loadResourceFolders@{loadResourceFolders}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{loadResourceFolders()}{loadResourceFolders()}}
{\footnotesize\ttfamily int Io\+Cmd\+::load\+Resource\+Folders (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{Load\+Resource\+Arguments}} \&}]{args,  }\item[{\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block}{Load\+Resource\+Arguments\+::\+Scoped\+Block}} $\ast$}]{sb = {\ttfamily 0} }\end{DoxyParamCaption})}

Loads the specified folders in current xsheet. \begin{DoxyReturn}{Returns}
The actually loaded levels count. 
\end{DoxyReturn}

\begin{DoxyParams}{Parameters}
{\em args} & Resource folders to be loaded. \\
\hline
{\em sb} & Load block. May be nonzero in order to extend block data access and finalization. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00522                                                                      \{}
\DoxyCodeLine{00523   \textcolor{keyword}{struct }locals \{}
\DoxyCodeLine{00524     \textcolor{keyword}{static} LRArgs::ResourceData toResourceData(\textcolor{keyword}{const} Resource \&rsrc) \{}
\DoxyCodeLine{00525       LRArgs::ResourceData rd(rsrc.m\_path.absoluteResourcePath());}
\DoxyCodeLine{00526       rd.m\_options = rsrc.m\_levelOptions;}
\DoxyCodeLine{00527 }
\DoxyCodeLine{00528       \textcolor{keywordflow}{return} rd;}
\DoxyCodeLine{00529     \}}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isExternPath(\textcolor{keyword}{const} \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} \&scene,}
\DoxyCodeLine{00532                              \textcolor{keyword}{const} LRArgs::ResourceData \&rd) \{}
\DoxyCodeLine{00533       \textcolor{keywordflow}{return} scene.\mbox{\hyperlink{class_toonz_scene_a657e45d8e257f7c2047022b75dc8600d}{isExternPath}}(rd.m\_path);}
\DoxyCodeLine{00534     \}}
\DoxyCodeLine{00535   \};  \textcolor{comment}{// locals}}
\DoxyCodeLine{00536 }
\DoxyCodeLine{00537   boost::optional<LRArgs::ScopedBlock> sb\_;}
\DoxyCodeLine{00538   \textcolor{keywordflow}{if} (!sb) sb = (sb\_ = boost::in\_place()).get\_ptr();}
\DoxyCodeLine{00539 }
\DoxyCodeLine{00540   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{00541   assert(scene);}
\DoxyCodeLine{00542 }
\DoxyCodeLine{00543   \textcolor{comment}{// Loading options popup}}
\DoxyCodeLine{00544 }
\DoxyCodeLine{00545   \textcolor{comment}{// Deal with import decision}}
\DoxyCodeLine{00546   \textcolor{keywordtype}{bool} \textcolor{keyword}{import} = \textcolor{keyword}{false};}
\DoxyCodeLine{00547   \{}
\DoxyCodeLine{00548     \textcolor{keywordflow}{if} (std::any\_of(}
\DoxyCodeLine{00549             args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.begin(), args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.end(),}
\DoxyCodeLine{00550             boost::bind(locals::isExternPath, boost::cref(*scene), \_1))) \{}
\DoxyCodeLine{00551       \textcolor{comment}{// Ask for data import in this case}}
\DoxyCodeLine{00552       \textcolor{keywordtype}{int} resolutionButton = DVGui::MsgBox(}
\DoxyCodeLine{00553           QObject::tr(\textcolor{stringliteral}{"{}Selected folders don't belong to the current project.\(\backslash\)n"{}}}
\DoxyCodeLine{00554                       \textcolor{stringliteral}{"{}Do you want to import them or load from their original "{}}}
\DoxyCodeLine{00555                       \textcolor{stringliteral}{"{}location?"{}}),}
\DoxyCodeLine{00556           QObject::tr(\textcolor{stringliteral}{"{}Load"{}}), QObject::tr(\textcolor{stringliteral}{"{}Import"{}}), QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}}));}
\DoxyCodeLine{00557 }
\DoxyCodeLine{00558       \textcolor{keyword}{enum} \{ CLOSED, LOAD, IMPORT, CANCELED \};}
\DoxyCodeLine{00559       \textcolor{keywordflow}{switch} (resolutionButton) \{}
\DoxyCodeLine{00560       \textcolor{keywordflow}{case} CLOSED:}
\DoxyCodeLine{00561       \textcolor{keywordflow}{case} CANCELED:}
\DoxyCodeLine{00562         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00563 }
\DoxyCodeLine{00564       \textcolor{keywordflow}{case} IMPORT:}
\DoxyCodeLine{00565         \textcolor{keyword}{import} = \textcolor{keyword}{true};}
\DoxyCodeLine{00566       \}}
\DoxyCodeLine{00567     \}}
\DoxyCodeLine{00568   \}}
\DoxyCodeLine{00569 }
\DoxyCodeLine{00570   \textcolor{comment}{// Select resources to be loaded}}
\DoxyCodeLine{00571   std::vector<Resource> resources;}
\DoxyCodeLine{00572 }
\DoxyCodeLine{00573   boost::for\_each(}
\DoxyCodeLine{00574       args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}} |}
\DoxyCodeLine{00575           boost::adaptors::transformed(boost::bind<const TFilePath \&>(}
\DoxyCodeLine{00576               \&LRArgs::ResourceData::m\_path, \_1)),}
\DoxyCodeLine{00577       boost::bind(::buildResources, boost::ref(resources), \_1, \mbox{\hyperlink{class_t_file_path}{TFilePath}}()));}
\DoxyCodeLine{00578 }
\DoxyCodeLine{00579   \textcolor{comment}{// Import them if required}}
\DoxyCodeLine{00580   \textcolor{keywordflow}{if} (\textcolor{keyword}{import}) ::import(*scene, resources, *sb);}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582   \textcolor{comment}{// Temporarily substitute args' import policy}}
\DoxyCodeLine{00583   \textcolor{keyword}{struct }SubstImportPolicy \{}
\DoxyCodeLine{00584     LRArgs \&m\_args;}
\DoxyCodeLine{00585     LRArgs::ImportPolicy m\_policy;}
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587     SubstImportPolicy(LRArgs \&args, LRArgs::ImportPolicy policy)}
\DoxyCodeLine{00588         : m\_args(args), m\_policy(args.importPolicy) \{}
\DoxyCodeLine{00589       args.importPolicy = policy;}
\DoxyCodeLine{00590     \}}
\DoxyCodeLine{00591 }
\DoxyCodeLine{00592     \string~SubstImportPolicy() \{ m\_args.importPolicy = m\_policy; \}}
\DoxyCodeLine{00593 }
\DoxyCodeLine{00594   \} substImportPolicy(args, \textcolor{keyword}{import} ? LRArgs::IMPORT : LRArgs::LOAD);}
\DoxyCodeLine{00595 }
\DoxyCodeLine{00596   \textcolor{comment}{// Perform loading via loadResources()}}
\DoxyCodeLine{00597   args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.assign(}
\DoxyCodeLine{00598       boost::make\_transform\_iterator(resources.begin(), locals::toResourceData),}
\DoxyCodeLine{00599       boost::make\_transform\_iterator(resources.end(), locals::toResourceData));}
\DoxyCodeLine{00600 }
\DoxyCodeLine{00601   \textcolor{keywordflow}{return} \mbox{\hyperlink{namespace_io_cmd_a107f6d3100b922e0c09e9b4aa1a8602a}{IoCmd::loadResources}}(args, \textcolor{keyword}{false}, sb);}
\DoxyCodeLine{00602 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00106}{TApp\+::get\+Current\+Scene()}}, \mbox{\hyperlink{l00215}{TApp\+::instance()}}, \mbox{\hyperlink{l01457}{Toonz\+Scene\+::is\+Extern\+Path()}}, \mbox{\hyperlink{l02357}{load\+Resources()}}, and \mbox{\hyperlink{l00105}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::resource\+Datas}}.



Referenced by \mbox{\hyperlink{l02357}{load\+Resources()}}.

\mbox{\Hypertarget{namespace_io_cmd_a107f6d3100b922e0c09e9b4aa1a8602a}\label{namespace_io_cmd_a107f6d3100b922e0c09e9b4aa1a8602a}} 
\index{IoCmd@{IoCmd}!loadResources@{loadResources}}
\index{loadResources@{loadResources}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{loadResources()}{loadResources()}}
{\footnotesize\ttfamily int Io\+Cmd\+::load\+Resources (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{Load\+Resource\+Arguments}} \&}]{args,  }\item[{bool}]{update\+Recent\+Files = {\ttfamily true},  }\item[{\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block}{Load\+Resource\+Arguments\+::\+Scoped\+Block}} $\ast$}]{sb = {\ttfamily 0} }\end{DoxyParamCaption})}

\begin{DoxyNote}{Note}
Will fallback to \mbox{\hyperlink{namespace_io_cmd_a0e4a4aacfc92a744c3eb69ee087946db}{load\+Resource\+Folders()}} in case all argument paths are folders. ~\newline
 
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em args} & Resources to be loaded. \\
\hline
{\em update\+Recent\+Files} & Whether Toonz\textquotesingle{}s {\itshape Recent Files} list must be updated. \\
\hline
{\em sb} & Load block. May be nonzero in order to extend block data access and finalization. Loads a group of resources by path. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The actually loaded levels count. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{02358                                               \{}
\DoxyCodeLine{02359   \textcolor{keyword}{struct }locals \{}
\DoxyCodeLine{02360     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isDir(\textcolor{keyword}{const} \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_resource_data}{LoadResourceArguments::ResourceData}} \&rd) \{}
\DoxyCodeLine{02361       \textcolor{keywordflow}{return} QFileInfo(rd.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_resource_data_a5bba0a59458b3487b03c8b1c84fea3c3}{m\_path}}.getQString()).isDir();}
\DoxyCodeLine{02362     \}}
\DoxyCodeLine{02363   \};  \textcolor{comment}{// locals}}
\DoxyCodeLine{02364 }
\DoxyCodeLine{02365   \textcolor{keywordflow}{if} (args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.empty()) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{02366 }
\DoxyCodeLine{02367   \textcolor{comment}{// Redirect to resource folders loading in case they're all dirs}}
\DoxyCodeLine{02368   \textcolor{keywordflow}{if} (std::all\_of(args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.begin(), args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.end(),}
\DoxyCodeLine{02369                   locals::isDir))}
\DoxyCodeLine{02370     \textcolor{keywordflow}{return} \mbox{\hyperlink{namespace_io_cmd_a0e4a4aacfc92a744c3eb69ee087946db}{loadResourceFolders}}(args, sb);}
\DoxyCodeLine{02371 }
\DoxyCodeLine{02372   boost::optional<LoadScopedBlock> sb\_;}
\DoxyCodeLine{02373   \textcolor{keywordflow}{if} (!sb) sb = (sb\_ = boost::in\_place()).get\_ptr();}
\DoxyCodeLine{02374 }
\DoxyCodeLine{02375   \textcolor{keywordtype}{int} \&row0 = args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a841efe5b92fc94bcd62d15c331d76d7d}{row0}}, \&col0 = args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a06a4463ae47ce6583f81b513b651e03a}{col0}}, \&row1 = args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a4735e60a793fe8885cd0f3255faf2914}{row1}},}
\DoxyCodeLine{02376       \&col1 = args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_afd8529f5422883575f0e3f5011b6de78}{col1}};}
\DoxyCodeLine{02377 }
\DoxyCodeLine{02378   \textcolor{comment}{// Setup local variables}}
\DoxyCodeLine{02379   \mbox{\hyperlink{class_t_app}{TApp}} *app         = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{02380   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{02381   \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh      = scene-\/>\mbox{\hyperlink{class_toonz_scene_ae3c828e3223fd809fd59189233d0576a}{getXsheet}}();}
\DoxyCodeLine{02382   \textcolor{comment}{// use current frame/column if row/col is not set}}
\DoxyCodeLine{02383   \textcolor{keywordflow}{if} (row0 == -\/1) row0 = app-\/>\mbox{\hyperlink{class_t_app_a35516f8175dab3ccdf3d6d3c3e5f59ae}{getCurrentFrame}}()-\/>getFrameIndex();}
\DoxyCodeLine{02384   \textcolor{keywordflow}{if} (col0 == -\/1) col0 = app-\/>\mbox{\hyperlink{class_t_app_a1e294e7cff300851d12a8c3d196943f6}{getCurrentColumn}}()-\/>getColumnIndex();}
\DoxyCodeLine{02385 }
\DoxyCodeLine{02386   \textcolor{keywordtype}{int} rCount = args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.size(), loadedCount = 0;}
\DoxyCodeLine{02387   \textcolor{keywordtype}{bool} isSoundLevel = \textcolor{keyword}{false};}
\DoxyCodeLine{02388 }
\DoxyCodeLine{02389   \textcolor{comment}{// show wait cursor in case of caching all images because it is time consuming}}
\DoxyCodeLine{02390   \textcolor{keywordflow}{if} (args.cachingBehavior == LoadResourceArguments::ALL\_ICONS\_AND\_IMAGES)}
\DoxyCodeLine{02391     QApplication::setOverrideCursor(Qt::WaitCursor);}
\DoxyCodeLine{02392 }
\DoxyCodeLine{02393   \textcolor{comment}{// Initialize progress dialog}}
\DoxyCodeLine{02394   \mbox{\hyperlink{class_d_v_gui_1_1_progress_dialog}{DVGui::ProgressDialog}} *progressDialog =}
\DoxyCodeLine{02395       (rCount > 1) ? \&sb-\/>\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block_a679b890db3bf0ba3fd212e814b507c4d}{progressDialog}}() : 0;}
\DoxyCodeLine{02396 }
\DoxyCodeLine{02397   \textcolor{keywordflow}{if} (progressDialog) \{}
\DoxyCodeLine{02398     progressDialog-\/>setModal(\textcolor{keyword}{true});}
\DoxyCodeLine{02399     progressDialog-\/>setMinimum(0);}
\DoxyCodeLine{02400     progressDialog-\/>setMaximum(rCount);}
\DoxyCodeLine{02401     progressDialog-\/>show();}
\DoxyCodeLine{02402   \}}
\DoxyCodeLine{02403 }
\DoxyCodeLine{02404   \textcolor{comment}{// Initialize import dialog}}
\DoxyCodeLine{02405   ResourceImportDialog importDialog;}
\DoxyCodeLine{02406   \textcolor{keywordflow}{if} (args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a7d1d2640d9f2f1e82e1b55584b2519c5}{importPolicy}} != LoadResourceArguments::ASK\_USER) \{}
\DoxyCodeLine{02407     importDialog.setImportEnabled(args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a7d1d2640d9f2f1e82e1b55584b2519c5}{importPolicy}} ==}
\DoxyCodeLine{02408                                   LoadResourceArguments::IMPORT);}
\DoxyCodeLine{02409   \}}
\DoxyCodeLine{02410 }
\DoxyCodeLine{02411   std::vector<TFilePath> paths;}
\DoxyCodeLine{02412   \textcolor{keywordtype}{int} all = 0;}
\DoxyCodeLine{02413 }
\DoxyCodeLine{02414   \textcolor{comment}{// Loop for all the resources to load}}
\DoxyCodeLine{02415   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} r = 0; r != rCount; ++r) \{}
\DoxyCodeLine{02416     \textcolor{keywordflow}{if} (importDialog.aborted()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{02417 }
\DoxyCodeLine{02418     QString origName =}
\DoxyCodeLine{02419         args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}[r].m\_path.withoutParentDir().getQString();}
\DoxyCodeLine{02420 }
\DoxyCodeLine{02421     LoadResourceArguments::ResourceData rd(args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}[r]);}
\DoxyCodeLine{02422     \mbox{\hyperlink{class_t_file_path}{TFilePath}} \&path = rd.m\_path;}
\DoxyCodeLine{02423 }
\DoxyCodeLine{02424     \textcolor{keywordflow}{if} (!rd.m\_path.isLevelName())}
\DoxyCodeLine{02425       path = \mbox{\hyperlink{class_t_file_path}{TFilePath}}(path.getLevelNameW()).\mbox{\hyperlink{class_t_file_path_a09d12d68c4264183e0268dde6f592b2e}{withParentDir}}(path.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}());}
\DoxyCodeLine{02426 }
\DoxyCodeLine{02427     \textcolor{keywordflow}{if} (std::find(paths.begin(), paths.end(), path) != paths.end()) \{}
\DoxyCodeLine{02428       \textcolor{keywordflow}{if} (!all) \{}
\DoxyCodeLine{02429         QString question =}
\DoxyCodeLine{02430             QObject::tr(}
\DoxyCodeLine{02431                 \textcolor{stringliteral}{"{}File '\%1' will reload level '\%2' as a duplicate column in the "{}}}
\DoxyCodeLine{02432                 \textcolor{stringliteral}{"{}xsheet.\(\backslash\)n\(\backslash\)nAllow duplicate?"{}})}
\DoxyCodeLine{02433                 .arg(origName)}
\DoxyCodeLine{02434                 .arg(QString::fromStdString(path.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()));}
\DoxyCodeLine{02435         QString Yes    = QObject::tr(\textcolor{stringliteral}{"{}Allow"{}});}
\DoxyCodeLine{02436         QString YesAll = QObject::tr(\textcolor{stringliteral}{"{}Allow All Dups"{}});}
\DoxyCodeLine{02437         QString No     = QObject::tr(\textcolor{stringliteral}{"{}No"{}});}
\DoxyCodeLine{02438         QString NoAll  = QObject::tr(\textcolor{stringliteral}{"{}No to All Dups"{}});}
\DoxyCodeLine{02439         \textcolor{keywordtype}{int} ret        = DVGui::MsgBox(question, Yes, YesAll, No, NoAll, 0);}
\DoxyCodeLine{02440         \textcolor{keywordflow}{switch} (ret) \{}
\DoxyCodeLine{02441         \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{02442           all = 1;  \textcolor{comment}{// YesAll}}
\DoxyCodeLine{02443         \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{02444           \textcolor{keywordflow}{break};  \textcolor{comment}{// Yes}}
\DoxyCodeLine{02445         \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{02446           all = 2;  \textcolor{comment}{// NoAll}}
\DoxyCodeLine{02447         \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{02448           \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02449         \}}
\DoxyCodeLine{02450       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (all == 2)}
\DoxyCodeLine{02451         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02452     \}}
\DoxyCodeLine{02453     paths.push\_back(path);}
\DoxyCodeLine{02454 }
\DoxyCodeLine{02455     \textcolor{keywordflow}{if} (progressDialog) \{}
\DoxyCodeLine{02456       \textcolor{keywordflow}{if} (progressDialog-\/>wasCanceled())}
\DoxyCodeLine{02457         \textcolor{keywordflow}{break};}
\DoxyCodeLine{02458       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02459         progressDialog-\/>setLabelText(}
\DoxyCodeLine{02460             DVGui::ProgressDialog::tr(\textcolor{stringliteral}{"{}Loading \(\backslash\)"{}\%1\(\backslash\)"{}..."{}})}
\DoxyCodeLine{02461                 .arg(path.getQString()));}
\DoxyCodeLine{02462         progressDialog-\/>setValue(r);}
\DoxyCodeLine{02463 }
\DoxyCodeLine{02464         QCoreApplication::processEvents();}
\DoxyCodeLine{02465       \}}
\DoxyCodeLine{02466     \}}
\DoxyCodeLine{02467 }
\DoxyCodeLine{02468     \textcolor{keywordtype}{bool} isLastResource = (r == rCount -\/ 1);}
\DoxyCodeLine{02469     importDialog.setIsLastResource(isLastResource);}
\DoxyCodeLine{02470 }
\DoxyCodeLine{02471     \textcolor{keywordtype}{bool} isScene = (TFileType::getInfo(path) == TFileType::TOONZSCENE);}
\DoxyCodeLine{02472 }
\DoxyCodeLine{02473     \textcolor{keywordflow}{if} (scene-\/>\mbox{\hyperlink{class_toonz_scene_a657e45d8e257f7c2047022b75dc8600d}{isExternPath}}(path) || isScene) \{}
\DoxyCodeLine{02474       \textcolor{comment}{// extern resource: import or link?}}
\DoxyCodeLine{02475       \textcolor{keywordtype}{int} ret = importDialog.askImportQuestion(path);}
\DoxyCodeLine{02476       \textcolor{keywordflow}{if} (ret == ResourceImportDialog::A\_CANCEL) \textcolor{keywordflow}{break};}
\DoxyCodeLine{02477     \}}
\DoxyCodeLine{02478 }
\DoxyCodeLine{02479     \textcolor{comment}{// for the scene file}}
\DoxyCodeLine{02480     \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *xl = 0;}
\DoxyCodeLine{02481     \textcolor{keywordflow}{if} (isScene) \{}
\DoxyCodeLine{02482       \mbox{\hyperlink{class_t_file_path}{TFilePath}} oldDstFolder = importDialog.getDstFolder();}
\DoxyCodeLine{02483       \mbox{\hyperlink{class_t_file_path}{TFilePath}} dstFolder = (Preferences::instance()-\/>isSubsceneFolderEnabled())}
\DoxyCodeLine{02484                                 ? \mbox{\hyperlink{class_t_file_path}{TFilePath}}(path.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}())}
\DoxyCodeLine{02485                                 : \mbox{\hyperlink{class_t_file_path}{TFilePath}}();}
\DoxyCodeLine{02486 }
\DoxyCodeLine{02487       importDialog.setDstFolder(dstFolder);}
\DoxyCodeLine{02488       importDialog.setIsLastResource(\textcolor{keyword}{false});}
\DoxyCodeLine{02489 }
\DoxyCodeLine{02490       \textcolor{comment}{// load the scene as subXsheet}}
\DoxyCodeLine{02491       \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{02492         xl = loadChildLevel(scene, path, row0, col0, importDialog);}
\DoxyCodeLine{02493         \textcolor{keywordflow}{if} (dstFolder != \mbox{\hyperlink{class_t_file_path}{TFilePath}}())}
\DoxyCodeLine{02494           app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>notifyCastFolderAdded(}
\DoxyCodeLine{02495               scene-\/>\mbox{\hyperlink{class_toonz_scene_ac1a8bf0d2cec4f59c87b0001991264b5}{getLevelSet}}()-\/>getDefaultFolder() + dstFolder);}
\DoxyCodeLine{02496         \textcolor{comment}{// increment the number of resources actually loaded}}
\DoxyCodeLine{02497         ++loadedCount;}
\DoxyCodeLine{02498         \textcolor{comment}{// move the column to the right}}
\DoxyCodeLine{02499         ++col0;}
\DoxyCodeLine{02500         \textcolor{comment}{// register the loaded level to args}}
\DoxyCodeLine{02501         args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a25af81323f9227d846e6aa7dbd4d6908}{loadedLevels}}.push\_back(xl);}
\DoxyCodeLine{02502         app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>notifyXsheetSoundChanged();}
\DoxyCodeLine{02503       \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{02504       \}}
\DoxyCodeLine{02505 }
\DoxyCodeLine{02506       importDialog.setIsLastResource(isLastResource);}
\DoxyCodeLine{02507       importDialog.setDstFolder(oldDstFolder);}
\DoxyCodeLine{02508 }
\DoxyCodeLine{02509       app-\/>\mbox{\hyperlink{class_t_app_a1e294e7cff300851d12a8c3d196943f6}{getCurrentColumn}}()-\/>setColumnIndex(col0);}
\DoxyCodeLine{02510 }
\DoxyCodeLine{02511       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02512     \}}
\DoxyCodeLine{02513     \textcolor{comment}{// for other level files}}
\DoxyCodeLine{02514     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02515       \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{02516         path = importDialog.process(scene, 0, path);}
\DoxyCodeLine{02517         \textcolor{comment}{// path = scene-\/>decodeFilePath(codedPath);}}
\DoxyCodeLine{02518       \} \textcolor{keywordflow}{catch} (std::string msg) \{}
\DoxyCodeLine{02519         error(QString::fromStdString(msg));}
\DoxyCodeLine{02520         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02521       \}}
\DoxyCodeLine{02522 }
\DoxyCodeLine{02523       \textcolor{keywordflow}{if} (importDialog.aborted()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{02524     \}}
\DoxyCodeLine{02525     \textcolor{keywordflow}{if} (path.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}psd"{}}) \{}
\DoxyCodeLine{02526       \textcolor{keyword}{static} \mbox{\hyperlink{class_psd_settings_popup}{PsdSettingsPopup}} *popup = 0;}
\DoxyCodeLine{02527       \textcolor{keywordflow}{if} (!popup) \{}
\DoxyCodeLine{02528         popup = \textcolor{keyword}{new} \mbox{\hyperlink{class_psd_settings_popup}{PsdSettingsPopup}}();}
\DoxyCodeLine{02529       \}}
\DoxyCodeLine{02530       popup-\/>setPath(path);}
\DoxyCodeLine{02531 }
\DoxyCodeLine{02532       \textcolor{keywordtype}{int} ret = popup-\/>exec();}
\DoxyCodeLine{02533       \textcolor{keywordflow}{if} (ret == 0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02534 }
\DoxyCodeLine{02535       loadedCount += loadPSDResource(args, updateRecentFile, popup);}
\DoxyCodeLine{02536 }
\DoxyCodeLine{02537       \textcolor{keywordflow}{if} (updateRecentFile)}
\DoxyCodeLine{02538         RecentFiles::instance()-\/>addFilePath(}
\DoxyCodeLine{02539             toQString(scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(path)), RecentFiles::Level);}
\DoxyCodeLine{02540     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02541       \textcolor{comment}{// reuse TFrameIds retrieved by FileBrowser}}
\DoxyCodeLine{02542       std::vector<TFrameId> fIds;}
\DoxyCodeLine{02543       \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{int})args.frameIdsSet.size() > r)  \textcolor{comment}{// if there is fIds to be reused}}
\DoxyCodeLine{02544       \{}
\DoxyCodeLine{02545         fIds = args.frameIdsSet[r];}
\DoxyCodeLine{02546       \}}
\DoxyCodeLine{02547 }
\DoxyCodeLine{02548       \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{02549         xl = ::loadResource(}
\DoxyCodeLine{02550             scene, rd, args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a145368ccf000dac53d511c77d2829e66}{castFolder}}, row0, col0, row1, col1, args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_aa69846d3da53cf7e64af73da3116c26a}{expose}},}
\DoxyCodeLine{02551 \#if (\_\_cplusplus > 199711L)}
\DoxyCodeLine{02552             std::move(fIds),}
\DoxyCodeLine{02553 \#\textcolor{keywordflow}{else}}
\DoxyCodeLine{02554             fIds,}
\DoxyCodeLine{02555 \#endif}
\DoxyCodeLine{02556             args.xFrom, args.xTo, args.levelName, args.step, args.inc,}
\DoxyCodeLine{02557             args.frameCount, args.doesFileActuallyExist);}
\DoxyCodeLine{02558         \textcolor{keywordflow}{if} (updateRecentFile) \{}
\DoxyCodeLine{02559           RecentFiles::instance()-\/>addFilePath(}
\DoxyCodeLine{02560               toQString(scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(path)), RecentFiles::Level);}
\DoxyCodeLine{02561         \}}
\DoxyCodeLine{02562       \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_exception}{TException}} \&e) \{}
\DoxyCodeLine{02563         error(QString::fromStdWString(e.getMessage()));}
\DoxyCodeLine{02564       \}}
\DoxyCodeLine{02565       \textcolor{comment}{// if load success}}
\DoxyCodeLine{02566       \textcolor{keywordflow}{if} (xl) \{}
\DoxyCodeLine{02567         isSoundLevel = isSoundLevel || xl-\/>\mbox{\hyperlink{class_t_xsh_level_a1a147f1e970a62120c0bbaf0020a8932}{getType}}() == SND\_XSHLEVEL;}
\DoxyCodeLine{02568         \textcolor{comment}{// register the loaded level to args}}
\DoxyCodeLine{02569         args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a25af81323f9227d846e6aa7dbd4d6908}{loadedLevels}}.push\_back(xl);}
\DoxyCodeLine{02570         \textcolor{comment}{// increment the number of loaded resources}}
\DoxyCodeLine{02571         ++loadedCount;}
\DoxyCodeLine{02572 }
\DoxyCodeLine{02573         \textcolor{comment}{// load the image data of all frames to cache at the beginning}}
\DoxyCodeLine{02574         \textcolor{keywordflow}{if} (args.cachingBehavior != LoadResourceArguments::ON\_DEMAND) \{}
\DoxyCodeLine{02575           \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *simpleLevel = xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}();}
\DoxyCodeLine{02576           \textcolor{keywordflow}{if} (simpleLevel \&\& simpleLevel-\/>\mbox{\hyperlink{class_t_xsh_level_a1a147f1e970a62120c0bbaf0020a8932}{getType}}() == TZP\_XSHLEVEL) \{}
\DoxyCodeLine{02577             \textcolor{keywordtype}{bool} cacheImagesAsWell =}
\DoxyCodeLine{02578                 (args.cachingBehavior ==}
\DoxyCodeLine{02579                  LoadResourceArguments::ALL\_ICONS\_AND\_IMAGES);}
\DoxyCodeLine{02580             simpleLevel-\/>loadAllIconsAndPutInCache(cacheImagesAsWell);}
\DoxyCodeLine{02581           \}}
\DoxyCodeLine{02582         \}}
\DoxyCodeLine{02583       \}}
\DoxyCodeLine{02584     \}}
\DoxyCodeLine{02585   \}}
\DoxyCodeLine{02586 }
\DoxyCodeLine{02587   \textcolor{keywordflow}{if} (loadedCount) app-\/>\mbox{\hyperlink{class_t_app_a35516f8175dab3ccdf3d6d3c3e5f59ae}{getCurrentFrame}}()-\/>setFrameIndex(row0);}
\DoxyCodeLine{02588 }
\DoxyCodeLine{02589   sb-\/>\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block_ae0b3928706b6cf9b7347a5994a6adefa}{data}}().m\_loadedCount += loadedCount;}
\DoxyCodeLine{02590   sb-\/>\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block_ae0b3928706b6cf9b7347a5994a6adefa}{data}}().m\_hasSoundLevel = sb-\/>\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block_ae0b3928706b6cf9b7347a5994a6adefa}{data}}().m\_hasSoundLevel || isSoundLevel;}
\DoxyCodeLine{02591 }
\DoxyCodeLine{02592   \textcolor{comment}{// revert the cursor}}
\DoxyCodeLine{02593   \textcolor{keywordflow}{if} (args.cachingBehavior == LoadResourceArguments::ALL\_ICONS\_AND\_IMAGES)}
\DoxyCodeLine{02594     QApplication::restoreOverrideCursor();}
\DoxyCodeLine{02595 }
\DoxyCodeLine{02596   \textcolor{keywordflow}{return} loadedCount;}
\DoxyCodeLine{02597 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00110}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::cast\+Folder}}, \mbox{\hyperlink{l00116}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::col0}}, \mbox{\hyperlink{l00119}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::col1}}, \mbox{\hyperlink{l00076}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::\+Scoped\+Block\+::data()}}, \mbox{\hyperlink{l01231}{Toonz\+Scene\+::decode\+File\+Path()}}, \mbox{\hyperlink{l00124}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::expose}}, \mbox{\hyperlink{l00118}{TApp\+::get\+Current\+Column()}}, \mbox{\hyperlink{l00114}{TApp\+::get\+Current\+Frame()}}, \mbox{\hyperlink{l00106}{TApp\+::get\+Current\+Scene()}}, \mbox{\hyperlink{l00110}{TApp\+::get\+Current\+Xsheet()}}, \mbox{\hyperlink{l00093}{Toonz\+Scene\+::get\+Level\+Set()}}, \mbox{\hyperlink{l00636}{TFile\+Path\+::get\+Name()}}, \mbox{\hyperlink{l00683}{TFile\+Path\+::get\+Parent\+Dir()}}, \mbox{\hyperlink{l00095}{TXsh\+Level\+::get\+Simple\+Level()}}, \mbox{\hyperlink{l00225}{TFile\+Path\+::get\+Type()}}, \mbox{\hyperlink{l00081}{TXsh\+Level\+::get\+Type()}}, \mbox{\hyperlink{l00957}{Toonz\+Scene\+::get\+Xsheet()}}, \mbox{\hyperlink{l00122}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::import\+Policy}}, \mbox{\hyperlink{l00215}{TApp\+::instance()}}, \mbox{\hyperlink{l01457}{Toonz\+Scene\+::is\+Extern\+Path()}}, \mbox{\hyperlink{l00127}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::loaded\+Levels}}, \mbox{\hyperlink{l00521}{load\+Resource\+Folders()}}, \mbox{\hyperlink{l02318}{Load\+Scoped\+Block\+::\+Data\+::m\+\_\+has\+Sound\+Level}}, \mbox{\hyperlink{l02317}{Load\+Scoped\+Block\+::\+Data\+::m\+\_\+loaded\+Count}}, \mbox{\hyperlink{l00086}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::\+Resource\+Data\+::m\+\_\+path}}, \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_1_1_scoped_block_a679b890db3bf0ba3fd212e814b507c4d}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::\+Scoped\+Block\+::progress\+Dialog()}}, \mbox{\hyperlink{l00105}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::resource\+Datas}}, \mbox{\hyperlink{l00114}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::row0}}, \mbox{\hyperlink{l00118}{Io\+Cmd\+::\+Load\+Resource\+Arguments\+::row1}}, and \mbox{\hyperlink{l00853}{TFile\+Path\+::with\+Parent\+Dir()}}.



Referenced by \mbox{\hyperlink{l01166}{Load\+Level\+Popup\+::execute()}}, \mbox{\hyperlink{l01550}{Save\+Level\+As\+Popup\+::execute()}}, \mbox{\hyperlink{l01783}{Replace\+Level\+Popup\+::execute()}}, and \mbox{\hyperlink{l00521}{load\+Resource\+Folders()}}.

\mbox{\Hypertarget{namespace_io_cmd_a576f240ddca3be721c59540731b8547f}\label{namespace_io_cmd_a576f240ddca3be721c59540731b8547f}} 
\index{IoCmd@{IoCmd}!loadScene@{loadScene}}
\index{loadScene@{loadScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{loadScene()}{loadScene()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::load\+Scene (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02091                       \{}
\DoxyCodeLine{02092   \mbox{\hyperlink{class_t_selection}{TSelection}} *oldSelection =}
\DoxyCodeLine{02093       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a6e0ee1978807a89009571ed5ce44323b}{getCurrentSelection}}()-\/>getSelection();}
\DoxyCodeLine{02094   \mbox{\hyperlink{class_file_selection}{FileSelection}} *fileSelection =}
\DoxyCodeLine{02095       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_file_selection}{FileSelection}} *\textcolor{keyword}{>}(TSelection::getCurrent());}
\DoxyCodeLine{02096   \textcolor{keywordflow}{if} (fileSelection) \{}
\DoxyCodeLine{02097     std::vector<TFilePath> files;}
\DoxyCodeLine{02098     fileSelection-\/>getSelectedFiles(files);}
\DoxyCodeLine{02099     \textcolor{keywordflow}{if} (files.size() == 1 \&\& files[0] != \mbox{\hyperlink{class_t_file_path}{TFilePath}}() \&\&}
\DoxyCodeLine{02100         files[0].\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}tnz"{}})}
\DoxyCodeLine{02101       \textcolor{keywordflow}{return} loadScene(files[0]);}
\DoxyCodeLine{02102   \}}
\DoxyCodeLine{02103 }
\DoxyCodeLine{02104   \textcolor{keyword}{static} \mbox{\hyperlink{class_load_scene_popup}{LoadScenePopup}} *popup = 0;}
\DoxyCodeLine{02105   \textcolor{keywordflow}{if} (!popup) \{}
\DoxyCodeLine{02106     popup = \textcolor{keyword}{new} \mbox{\hyperlink{class_load_scene_popup}{LoadScenePopup}}();}
\DoxyCodeLine{02107   \}}
\DoxyCodeLine{02108   \textcolor{keywordtype}{int} ret = popup-\/>exec();}
\DoxyCodeLine{02109   \textcolor{keywordflow}{if} (ret == QDialog::Accepted) \{}
\DoxyCodeLine{02110     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02111   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02112     \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a6e0ee1978807a89009571ed5ce44323b}{getCurrentSelection}}()-\/>setSelection(oldSelection);}
\DoxyCodeLine{02113     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02114   \}}
\DoxyCodeLine{02115 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_aacb798ecd90262670a20d3cdc9730d92}\label{namespace_io_cmd_aacb798ecd90262670a20d3cdc9730d92}} 
\index{IoCmd@{IoCmd}!loadScene@{loadScene}}
\index{loadScene@{loadScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{loadScene()}{loadScene()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::load\+Scene (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{scene\+Path,  }\item[{bool}]{update\+Recent\+File = {\ttfamily true},  }\item[{bool}]{check\+Save\+Old\+Scene = {\ttfamily true} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01833                                               \{}
\DoxyCodeLine{01834   RenderingSuspender suspender;}
\DoxyCodeLine{01835 }
\DoxyCodeLine{01836   \textcolor{keywordflow}{if} (checkSaveOldScene)}
\DoxyCodeLine{01837     \textcolor{keywordflow}{if} (!saveSceneIfNeeded(QApplication::tr(\textcolor{stringliteral}{"{}Load Scene"{}}))) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01838   assert(!path.isEmpty());}
\DoxyCodeLine{01839   \mbox{\hyperlink{class_t_file_path}{TFilePath}} scenePath = path;}
\DoxyCodeLine{01840   \textcolor{keywordtype}{bool} importScene    = \textcolor{keyword}{false};}
\DoxyCodeLine{01841   \textcolor{keywordtype}{bool} isXdts         = scenePath.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}xdts"{}};}
\DoxyCodeLine{01842   \textcolor{keywordflow}{if} (scenePath.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}"{}}) scenePath = scenePath.\mbox{\hyperlink{class_t_file_path_a1437b0e0720e9258b622f68b6858e95d}{withType}}(\textcolor{stringliteral}{"{}tnz"{}});}
\DoxyCodeLine{01843   \textcolor{keywordflow}{if} (scenePath.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() != \textcolor{stringliteral}{"{}tnz"{}} \&\& !isXdts) \{}
\DoxyCodeLine{01844     QString msg;}
\DoxyCodeLine{01845     msg = QObject::tr(\textcolor{stringliteral}{"{}File \%1 doesn't look like a TOONZ Scene"{}})}
\DoxyCodeLine{01846               .arg(QString::fromStdWString(scenePath.getWideString()));}
\DoxyCodeLine{01847     DVGui::error(msg);}
\DoxyCodeLine{01848     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01849   \}}
\DoxyCodeLine{01850   \textcolor{keywordflow}{if} (!TSystem::doesExistFileOrLevel(scenePath)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01851 }
\DoxyCodeLine{01852   \mbox{\hyperlink{class_t_file_path}{TFilePath}} scenePathTemp(scenePath.getWideString() +}
\DoxyCodeLine{01853                           QString(\textcolor{stringliteral}{"{}.tmp"{}}).toStdWString());}
\DoxyCodeLine{01854   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(scenePathTemp)) \{}
\DoxyCodeLine{01855     QString question =}
\DoxyCodeLine{01856         QObject::tr(}
\DoxyCodeLine{01857             \textcolor{stringliteral}{"{}A prior save of Scene '\%1' was critically interrupted. \(\backslash\)n\(\backslash\)}}
\DoxyCodeLine{01858 \textcolor{stringliteral}{\(\backslash\)nA partial save file was generated and changes may be manually salvaged from '\%2'.\(\backslash\)n\(\backslash\)}}
\DoxyCodeLine{01859 \textcolor{stringliteral}{\(\backslash\)nDo you wish to continue loading the last good save or stop and try to salvage the prior save?"{}})}
\DoxyCodeLine{01860             .arg(QString::fromStdWString(scenePath.getWideString()))}
\DoxyCodeLine{01861             .arg(QString::fromStdWString(scenePathTemp.getWideString()));}
\DoxyCodeLine{01862     QString continueAnswer = QObject::tr(\textcolor{stringliteral}{"{}Continue"{}});}
\DoxyCodeLine{01863     QString cancelAnswer   = QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}});}
\DoxyCodeLine{01864     \textcolor{keywordtype}{int} ret = DVGui::MsgBox(question, continueAnswer, cancelAnswer, 0);}
\DoxyCodeLine{01865     \textcolor{keywordflow}{if} (ret == 2)}
\DoxyCodeLine{01866       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01867     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01868       TSystem::removeFileOrLevel(scenePathTemp);}
\DoxyCodeLine{01869   \}}
\DoxyCodeLine{01870 }
\DoxyCodeLine{01871   \mbox{\hyperlink{class_t_project_manager}{TProjectManager}} *pm    = \mbox{\hyperlink{class_t_project_manager_a150ca0d6e2eb171b8117b0c5f03dbfad}{TProjectManager::instance}}();}
\DoxyCodeLine{01872   \mbox{\hyperlink{class_t_smart_pointer_t}{TProjectP}} sceneProject = pm-\/>\mbox{\hyperlink{class_t_project_manager_adcc7fc8cb7656b12f54b773ee6448735}{loadSceneProject}}(scenePath);}
\DoxyCodeLine{01873   \textcolor{keywordflow}{if} (!sceneProject) \{}
\DoxyCodeLine{01874     QString msg;}
\DoxyCodeLine{01875     msg = QObject::tr(}
\DoxyCodeLine{01876               \textcolor{stringliteral}{"{}It is not possible to load the scene \%1 because it does not "{}}}
\DoxyCodeLine{01877               \textcolor{stringliteral}{"{}belong to any project."{}})}
\DoxyCodeLine{01878               .arg(QString::fromStdWString(scenePath.getWideString()));}
\DoxyCodeLine{01879     DVGui::warning(msg);}
\DoxyCodeLine{01880   \}}
\DoxyCodeLine{01881   \textcolor{keywordflow}{if} (sceneProject \&\& !sceneProject-\/>isCurrent()) \{}
\DoxyCodeLine{01882     QString currentProjectName = QString::fromStdWString(}
\DoxyCodeLine{01883         pm-\/>\mbox{\hyperlink{class_t_project_manager_a5267cfeae48d4e7585c3fc56d8d5b0b3}{getCurrentProject}}()-\/>getName().getWideString());}
\DoxyCodeLine{01884     QString sceneProjectName =}
\DoxyCodeLine{01885         QString::fromStdWString(sceneProject-\/>getName().getWideString());}
\DoxyCodeLine{01886 }
\DoxyCodeLine{01887     \textcolor{comment}{/*QString question = "{}The Scene '"{}}}
\DoxyCodeLine{01888 \textcolor{comment}{            + QString::fromStdWString(scenePath.getWideString())}}
\DoxyCodeLine{01889 \textcolor{comment}{+ "{}' belongs to project '"{} + sceneProjectName + "{}'.\(\backslash\)n"{}}}
\DoxyCodeLine{01890 \textcolor{comment}{+ "{}What do you want to do?"{};*/}}
\DoxyCodeLine{01891     QString question =}
\DoxyCodeLine{01892         QObject::tr(}
\DoxyCodeLine{01893             \textcolor{stringliteral}{"{}The Scene '\%1' belongs to project '\%2'.\(\backslash\)nWhat do you want to do?"{}})}
\DoxyCodeLine{01894             .arg(QString::fromStdWString(scenePath.getWideString()))}
\DoxyCodeLine{01895             .arg(sceneProjectName);}
\DoxyCodeLine{01896     QString importAnswer        = QObject::tr(\textcolor{stringliteral}{"{}Import Scene"{}});}
\DoxyCodeLine{01897     QString switchProjectAnswer = QObject::tr(\textcolor{stringliteral}{"{}Change Project"{}});}
\DoxyCodeLine{01898     QString cancelAnswer        = QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}});}
\DoxyCodeLine{01899     \textcolor{keywordtype}{int} ret = DVGui::MsgBox(question, importAnswer, switchProjectAnswer,}
\DoxyCodeLine{01900                             cancelAnswer, 0);}
\DoxyCodeLine{01901     \textcolor{keywordflow}{if} (ret == 3 || ret == 0) \{}
\DoxyCodeLine{01902       newScene();}
\DoxyCodeLine{01903       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01904     \}}
\DoxyCodeLine{01905     \textcolor{keywordflow}{if} (ret == 2)}
\DoxyCodeLine{01906       pm-\/>\mbox{\hyperlink{class_t_project_manager_aa55b362becc698e787db40c822f79bc3}{setCurrentProjectPath}}(sceneProject-\/>getProjectPath());}
\DoxyCodeLine{01907     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01908       importScene = \textcolor{keyword}{true};}
\DoxyCodeLine{01909   \}}
\DoxyCodeLine{01910   QApplication::setOverrideCursor(Qt::WaitCursor);}
\DoxyCodeLine{01911 }
\DoxyCodeLine{01912   TUndoManager::manager()-\/>reset();}
\DoxyCodeLine{01913   IconGenerator::instance()-\/>clearRequests();}
\DoxyCodeLine{01914   IconGenerator::instance()-\/>clearSceneIcons();}
\DoxyCodeLine{01915   ImageManager::instance()-\/>\mbox{\hyperlink{class_image_manager_af1cdc120ba64146849566808dfdb8f9c}{clear}}();}
\DoxyCodeLine{01916 }
\DoxyCodeLine{01917   CacheFxCommand::instance()-\/>onNewScene();}
\DoxyCodeLine{01918 }
\DoxyCodeLine{01919 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{01920   \textcolor{comment}{// INTERMEDIATE CACHE RESULTS MANAGEMENT: Clear all resources not accessed in}}
\DoxyCodeLine{01921   \textcolor{comment}{// the last 2 sessions}}
\DoxyCodeLine{01922   TCacheResourcePool::instance()-\/>clearAccessedAfterSessions(}
\DoxyCodeLine{01923       1);  \textcolor{comment}{// 0 would be after this session}}
\DoxyCodeLine{01924 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01925 }
\DoxyCodeLine{01926   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = \textcolor{keyword}{new} \mbox{\hyperlink{class_toonz_scene}{ToonzScene}}();}
\DoxyCodeLine{01927   TImageStyle::setCurrentScene(scene);}
\DoxyCodeLine{01928   printf(\textcolor{stringliteral}{"{}\%s:\%s Progressing:\(\backslash\)n"{}}, \_\_FILE\_\_, \_\_FUNCTION\_\_);}
\DoxyCodeLine{01929   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{01930     \textcolor{keywordflow}{if} (isXdts)}
\DoxyCodeLine{01931       XdtsIo::loadXdtsScene(scene, scenePath);}
\DoxyCodeLine{01932     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01933       \textcolor{comment}{/*-\/-\/ Load -\/-\/*/}}
\DoxyCodeLine{01934       scene-\/>load(scenePath);}
\DoxyCodeLine{01935     \textcolor{comment}{// import if needed}}
\DoxyCodeLine{01936     \mbox{\hyperlink{class_t_project_manager}{TProjectManager}} *pm      = \mbox{\hyperlink{class_t_project_manager_a150ca0d6e2eb171b8117b0c5f03dbfad}{TProjectManager::instance}}();}
\DoxyCodeLine{01937     \mbox{\hyperlink{class_t_smart_pointer_t}{TProjectP}} currentProject = pm-\/>\mbox{\hyperlink{class_t_project_manager_a5267cfeae48d4e7585c3fc56d8d5b0b3}{getCurrentProject}}();}
\DoxyCodeLine{01938     \textcolor{keywordflow}{if} (!scene-\/>\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}() || scene-\/>\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}()-\/>\mbox{\hyperlink{class_t_project_ab97b51d9527c7ede8dc52dc0007dc27b}{getProjectPath}}() !=}
\DoxyCodeLine{01939                                     currentProject-\/>getProjectPath()) \{}
\DoxyCodeLine{01940       ResourceImportDialog resourceLoader;}
\DoxyCodeLine{01941       \textcolor{comment}{// resourceLoader.setImportEnabled(true);}}
\DoxyCodeLine{01942       \mbox{\hyperlink{class_resource_importer}{ResourceImporter}} importer(scene, currentProject.getPointer(),}
\DoxyCodeLine{01943                                 resourceLoader);}
\DoxyCodeLine{01944       \mbox{\hyperlink{class_scene_resources}{SceneResources}} resources(scene, scene-\/>\mbox{\hyperlink{class_toonz_scene_ae3c828e3223fd809fd59189233d0576a}{getXsheet}}());}
\DoxyCodeLine{01945       resources.accept(\&importer);}
\DoxyCodeLine{01946       scene-\/>\mbox{\hyperlink{class_toonz_scene_a815ecf4f07a92f9f9fef693f762c1228}{setScenePath}}(importer.getImportedScenePath());}
\DoxyCodeLine{01947       scene-\/>\mbox{\hyperlink{class_toonz_scene_aa7aac33fc53c47ea5baff597e5f18a9b}{setProject}}(currentProject.getPointer());}
\DoxyCodeLine{01948     \}}
\DoxyCodeLine{01949     VersionControlManager::instance()-\/>setFrameRange(scene-\/>\mbox{\hyperlink{class_toonz_scene_ac1a8bf0d2cec4f59c87b0001991264b5}{getLevelSet}}());}
\DoxyCodeLine{01950   \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{01951     printf(\textcolor{stringliteral}{"{}\%s:\%s Exception ...:\(\backslash\)n"{}}, \_\_FILE\_\_, \_\_FUNCTION\_\_);}
\DoxyCodeLine{01952     QString msg;}
\DoxyCodeLine{01953     msg = QObject::tr(}
\DoxyCodeLine{01954               \textcolor{stringliteral}{"{}There were problems loading the scene \%1.\(\backslash\)n Some files may be "{}}}
\DoxyCodeLine{01955               \textcolor{stringliteral}{"{}missing."{}})}
\DoxyCodeLine{01956               .arg(QString::fromStdWString(scenePath.getWideString()));}
\DoxyCodeLine{01957     DVGui::warning(msg);}
\DoxyCodeLine{01958   \}}
\DoxyCodeLine{01959   printf(\textcolor{stringliteral}{"{}\%s:\%s end load:\(\backslash\)n"{}}, \_\_FILE\_\_, \_\_FUNCTION\_\_);}
\DoxyCodeLine{01960   \mbox{\hyperlink{class_t_project}{TProject}} *project = scene-\/>\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}();}
\DoxyCodeLine{01961   \textcolor{keywordflow}{if} (!project) \{}
\DoxyCodeLine{01962     project = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_project}{TProject}}();}
\DoxyCodeLine{01963     project-\/>setFolder(\textcolor{stringliteral}{"{}project"{}}, scenePath);}
\DoxyCodeLine{01964     scene-\/>\mbox{\hyperlink{class_toonz_scene_aa7aac33fc53c47ea5baff597e5f18a9b}{setProject}}(project);}
\DoxyCodeLine{01965   \}}
\DoxyCodeLine{01966   \mbox{\hyperlink{class_t_app}{TApp}} *app = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01967   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setScene(scene);}
\DoxyCodeLine{01968   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>notifyNameSceneChange();}
\DoxyCodeLine{01969   app-\/>\mbox{\hyperlink{class_t_app_a35516f8175dab3ccdf3d6d3c3e5f59ae}{getCurrentFrame}}()-\/>setFrame(0);}
\DoxyCodeLine{01970   app-\/>\mbox{\hyperlink{class_t_app_a1e294e7cff300851d12a8c3d196943f6}{getCurrentColumn}}()-\/>setColumnIndex(0);}
\DoxyCodeLine{01971   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = 0;}
\DoxyCodeLine{01972   \textcolor{keywordflow}{if} (app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}() \&\& app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>getSimpleLevel())}
\DoxyCodeLine{01973     palette = app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>getSimpleLevel()-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a9aea4f8e34caef293d5e5c7694047564}{getPalette}}();}
\DoxyCodeLine{01974   app-\/>\mbox{\hyperlink{class_t_app_a33dbcbc578915e0b69fe6927b74cf426}{getCurrentPalette}}()-\/>setPalette(palette);}
\DoxyCodeLine{01975   app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>notifyXsheetSoundChanged();}
\DoxyCodeLine{01976   app-\/>\mbox{\hyperlink{class_t_app_a0d91c122eec2b756b7c4780014e49f9e}{getCurrentObject}}()-\/>setIsSpline(\textcolor{keyword}{false});}
\DoxyCodeLine{01977 }
\DoxyCodeLine{01978   Previewer::clearAll();}
\DoxyCodeLine{01979   \mbox{\hyperlink{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}{PreviewFxManager::instance}}()-\/>\mbox{\hyperlink{class_preview_fx_manager_a3cf458cfc0955a610007cb537638d592}{reset}}();}
\DoxyCodeLine{01980   \textcolor{comment}{// updateCleanupSettingsPopup();}}
\DoxyCodeLine{01981   \textcolor{comment}{/*-\/ CleanupParameter -\/*/}}
\DoxyCodeLine{01982   \mbox{\hyperlink{class_cleanup_parameters}{CleanupParameters}} *cp = scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_a84e6735bb0b0ea5054b9592c9612aff9}{getCleanupParameters}}();}
\DoxyCodeLine{01983   CleanupParameters::GlobalParameters.assign(cp);}
\DoxyCodeLine{01984 }
\DoxyCodeLine{01985   CacheFxCommand::instance()-\/>onSceneLoaded();}
\DoxyCodeLine{01986 }
\DoxyCodeLine{01987 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{01988   TCacheResourcePool::instance()-\/>\mbox{\hyperlink{class_t_cache_resource_pool_afc0d81a64dacaacdad079fb1c3edb9f8}{setPath}}(}
\DoxyCodeLine{01989       QString::fromStdWString(}
\DoxyCodeLine{01990           ToonzFolder::getCacheRootFolder().getWideString()),}
\DoxyCodeLine{01991       QString::fromStdWString(project-\/>\mbox{\hyperlink{class_t_project_a258a4b6435978b730722a92ab104cd89}{getName}}().getWideName()),}
\DoxyCodeLine{01992       QString::fromStdWString(scene-\/>\mbox{\hyperlink{class_toonz_scene_a1fa0a1cbf9eb6360d980392acc99924b}{getSceneName}}()));}
\DoxyCodeLine{01993 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01994 }
\DoxyCodeLine{01995   UnitParameters::setFieldGuideAspectRatio(}
\DoxyCodeLine{01996       scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_ab4d1ebda4565709e8b66387c72b03fdb}{getFieldGuideAspectRatio}}());}
\DoxyCodeLine{01997   IconGenerator::instance()-\/>invalidateSceneIcon();}
\DoxyCodeLine{01998   DvDirModel::instance()-\/>refreshFolder(scenePath.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}());}
\DoxyCodeLine{01999   \textcolor{comment}{// set dirty for xdts files since converted tnz is not yet saved}}
\DoxyCodeLine{02000   \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(isXdts);}
\DoxyCodeLine{02001   History::instance()-\/>addItem(scenePath);}
\DoxyCodeLine{02002   \textcolor{keywordflow}{if} (updateRecentFile)}
\DoxyCodeLine{02003     RecentFiles::instance()-\/>addFilePath(}
\DoxyCodeLine{02004         toQString(scenePath), RecentFiles::Scene,}
\DoxyCodeLine{02005         QString::fromStdString(scene-\/>\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}()-\/>\mbox{\hyperlink{class_t_project_a258a4b6435978b730722a92ab104cd89}{getName}}().\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()));}
\DoxyCodeLine{02006   QApplication::restoreOverrideCursor();}
\DoxyCodeLine{02007 }
\DoxyCodeLine{02008   \textcolor{keywordtype}{int} forbiddenLevelCount = 0;}
\DoxyCodeLine{02009   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < scene-\/>\mbox{\hyperlink{class_toonz_scene_ac1a8bf0d2cec4f59c87b0001991264b5}{getLevelSet}}()-\/>getLevelCount(); i++) \{}
\DoxyCodeLine{02010     \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *xl = scene-\/>\mbox{\hyperlink{class_toonz_scene_ac1a8bf0d2cec4f59c87b0001991264b5}{getLevelSet}}()-\/>getLevel(i);}
\DoxyCodeLine{02011     \textcolor{keywordflow}{if} (xl \&\& xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}() \&\&}
\DoxyCodeLine{02012         xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}()-\/>\mbox{\hyperlink{class_t_xsh_simple_level_ad412dd5c3a6ae3ff20a480dc728b26d2}{getProperties}}()-\/>\mbox{\hyperlink{class_level_properties_a068ff23123a2afeeedbe2eeacccf6299}{isForbidden}}())}
\DoxyCodeLine{02013       forbiddenLevelCount++;}
\DoxyCodeLine{02014   \}}
\DoxyCodeLine{02015   \textcolor{keywordflow}{if} (forbiddenLevelCount > 0) \{}
\DoxyCodeLine{02016     QString msg;}
\DoxyCodeLine{02017     msg = QObject::tr(}
\DoxyCodeLine{02018               \textcolor{stringliteral}{"{}There were problems loading the scene \%1.\(\backslash\)nSome levels have not "{}}}
\DoxyCodeLine{02019               \textcolor{stringliteral}{"{}been loaded because their version is not supported"{}})}
\DoxyCodeLine{02020               .arg(QString::fromStdWString(scenePath.getWideString()));}
\DoxyCodeLine{02021     DVGui::warning(msg);}
\DoxyCodeLine{02022   \}}
\DoxyCodeLine{02023 }
\DoxyCodeLine{02024   \textcolor{keywordtype}{bool} exist = TSystem::doesExistFileOrLevel(}
\DoxyCodeLine{02025       scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}()));}
\DoxyCodeLine{02026   QAction *act = CommandManager::instance()-\/>getAction(MI\_RevertScene);}
\DoxyCodeLine{02027   \textcolor{keywordflow}{if} (act) act-\/>setEnabled(exist);}
\DoxyCodeLine{02028 }
\DoxyCodeLine{02029   \textcolor{comment}{// check if the output dpi is incompatible with pixels only mode}}
\DoxyCodeLine{02030   \textcolor{keywordflow}{if} (Preferences::instance()-\/>getPixelsOnly()) \{}
\DoxyCodeLine{02031     \mbox{\hyperlink{class_t_point_t}{TPointD}} dpi = scene-\/>\mbox{\hyperlink{class_toonz_scene_a750b5ab623ccec744013b0c83bf20abc}{getCurrentCamera}}()-\/>\mbox{\hyperlink{class_t_camera_adf45510b5dc53f6481308ef489fbd5a9}{getDpi}}();}
\DoxyCodeLine{02032     \textcolor{keywordflow}{if} (!areAlmostEqual(dpi.x, Stage::standardDpi, 0.1) ||}
\DoxyCodeLine{02033         !areAlmostEqual(dpi.y, Stage::standardDpi, 0.1)) \{}
\DoxyCodeLine{02034       QString question = QObject::tr(}
\DoxyCodeLine{02035           \textcolor{stringliteral}{"{}This scene is incompatible with pixels only mode of the current "{}}}
\DoxyCodeLine{02036           \textcolor{stringliteral}{"{}OpenToonz version.\(\backslash\)nWhat would you like to do?"{}});}
\DoxyCodeLine{02037       QString turnOffPixelAnswer = QObject::tr(\textcolor{stringliteral}{"{}Turn off pixels only mode"{}});}
\DoxyCodeLine{02038       QString resizeSceneAnswer =}
\DoxyCodeLine{02039           QObject::tr(\textcolor{stringliteral}{"{}Keep pixels only mode on and resize the scene"{}});}
\DoxyCodeLine{02040       \textcolor{keywordtype}{int} ret =}
\DoxyCodeLine{02041           DVGui::MsgBox(question, turnOffPixelAnswer, resizeSceneAnswer, 0);}
\DoxyCodeLine{02042       \textcolor{keywordflow}{if} (ret == 0) \{}
\DoxyCodeLine{02043       \}                     \textcolor{comment}{// do nothing}}
\DoxyCodeLine{02044       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 1) \{  \textcolor{comment}{// Turn off pixels only mode}}
\DoxyCodeLine{02045         Preferences::instance()-\/>setValue(pixelsOnly, \textcolor{keyword}{false});}
\DoxyCodeLine{02046         app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>notifyPixelUnitSelected(\textcolor{keyword}{false});}
\DoxyCodeLine{02047       \} \textcolor{keywordflow}{else} \{  \textcolor{comment}{// ret = 2 : Resize the scene}}
\DoxyCodeLine{02048         \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}} camSize = scene-\/>\mbox{\hyperlink{class_toonz_scene_a750b5ab623ccec744013b0c83bf20abc}{getCurrentCamera}}()-\/>\mbox{\hyperlink{class_t_camera_a6f561eca912177c2150b3e57816f02f6}{getSize}}();}
\DoxyCodeLine{02049         \mbox{\hyperlink{class_t_dimension_t}{TDimension}} camRes(camSize.lx * Stage::standardDpi,}
\DoxyCodeLine{02050                           camSize.ly * Stage::standardDpi);}
\DoxyCodeLine{02051         scene-\/>\mbox{\hyperlink{class_toonz_scene_a750b5ab623ccec744013b0c83bf20abc}{getCurrentCamera}}()-\/>\mbox{\hyperlink{class_t_camera_a10db423cceb7e3696e6db43409c565f4}{setRes}}(camRes);}
\DoxyCodeLine{02052         app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{02053         app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>notifyXsheetChanged();}
\DoxyCodeLine{02054       \}}
\DoxyCodeLine{02055     \}}
\DoxyCodeLine{02056   \}}
\DoxyCodeLine{02057 }
\DoxyCodeLine{02058   \textcolor{comment}{// Check if the scene saved with the previous version AND the premultiply}}
\DoxyCodeLine{02059   \textcolor{comment}{// option is set to PNG level setting}}
\DoxyCodeLine{02060   \textcolor{keywordflow}{if} (scene-\/>getVersionNumber() <}
\DoxyCodeLine{02061       VersionNumber(71, 1)) \{  \textcolor{comment}{// V1.4 = 71.0 , V1.5 = 71.1}}
\DoxyCodeLine{02062     QStringList modifiedPNGLevelNames;}
\DoxyCodeLine{02063     std::vector<TXshLevel *> levels;}
\DoxyCodeLine{02064     scene-\/>\mbox{\hyperlink{class_toonz_scene_ac1a8bf0d2cec4f59c87b0001991264b5}{getLevelSet}}()-\/>listLevels(levels);}
\DoxyCodeLine{02065     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} level : levels) \{}
\DoxyCodeLine{02066       \textcolor{keywordflow}{if} (!level || !level-\/>getSimpleLevel()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02067       \mbox{\hyperlink{class_t_file_path}{TFilePath}} path = level-\/>getPath();}
\DoxyCodeLine{02068       \textcolor{keywordflow}{if} (path.isEmpty() || path.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() != \textcolor{stringliteral}{"{}png"{}}) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02069       \textcolor{keywordflow}{if} (level-\/>getSimpleLevel()-\/>getProperties()-\/>doPremultiply()) \{}
\DoxyCodeLine{02070         level-\/>getSimpleLevel()-\/>getProperties()-\/>setDoPremultiply(\textcolor{keyword}{false});}
\DoxyCodeLine{02071         modifiedPNGLevelNames.append(QString::fromStdWString(level-\/>getName()));}
\DoxyCodeLine{02072       \}}
\DoxyCodeLine{02073     \}}
\DoxyCodeLine{02074     \textcolor{keywordflow}{if} (!modifiedPNGLevelNames.isEmpty()) \{}
\DoxyCodeLine{02075       DVGui::info(QObject::tr(\textcolor{stringliteral}{"{}The Premultiply options in the following levels "{}}}
\DoxyCodeLine{02076                               \textcolor{stringliteral}{"{}are disabled, since PNG files are premultiplied "{}}}
\DoxyCodeLine{02077                               \textcolor{stringliteral}{"{}on loading in the current version: \%1"{}})}
\DoxyCodeLine{02078                       .arg(modifiedPNGLevelNames.join(\textcolor{stringliteral}{"{}, "{}})));}
\DoxyCodeLine{02079       app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{02080     \}}
\DoxyCodeLine{02081   \}}
\DoxyCodeLine{02082 }
\DoxyCodeLine{02083   printf(\textcolor{stringliteral}{"{}\%s:\%s loadScene() completed :\(\backslash\)n"{}}, \_\_FILE\_\_, \_\_FUNCTION\_\_);}
\DoxyCodeLine{02084   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02085 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_aa93737c840f2f6389c72c65e178186fc}\label{namespace_io_cmd_aa93737c840f2f6389c72c65e178186fc}} 
\index{IoCmd@{IoCmd}!loadScene@{loadScene}}
\index{loadScene@{loadScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{loadScene()}{loadScene()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::load\+Scene (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_toonz_scene}{Toonz\+Scene}} \&}]{scene,  }\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{scene\+Path,  }\item[{bool}]{import }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01807                                    \{}
\DoxyCodeLine{01808   \textcolor{keywordflow}{if} (!TSystem::doesExistFileOrLevel(scenePath)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01809   scene.load(scenePath);}
\DoxyCodeLine{01810   \textcolor{comment}{// import if needed}}
\DoxyCodeLine{01811   \mbox{\hyperlink{class_t_project_manager}{TProjectManager}} *pm      = \mbox{\hyperlink{class_t_project_manager_a150ca0d6e2eb171b8117b0c5f03dbfad}{TProjectManager::instance}}();}
\DoxyCodeLine{01812   \mbox{\hyperlink{class_t_smart_pointer_t}{TProjectP}} currentProject = pm-\/>\mbox{\hyperlink{class_t_project_manager_a5267cfeae48d4e7585c3fc56d8d5b0b3}{getCurrentProject}}();}
\DoxyCodeLine{01813   \textcolor{keywordflow}{if} (!scene.\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01814   \textcolor{keywordflow}{if} (scene.\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}()-\/>\mbox{\hyperlink{class_t_project_ab97b51d9527c7ede8dc52dc0007dc27b}{getProjectPath}}() !=}
\DoxyCodeLine{01815       currentProject-\/>getProjectPath()) \{}
\DoxyCodeLine{01816     ResourceImportDialog resourceLoader;}
\DoxyCodeLine{01817     \textcolor{comment}{// resourceLoader.setImportEnabled(true);}}
\DoxyCodeLine{01818     \mbox{\hyperlink{class_resource_importer}{ResourceImporter}} importer(\&scene, currentProject.getPointer(),}
\DoxyCodeLine{01819                               resourceLoader);}
\DoxyCodeLine{01820     \mbox{\hyperlink{class_scene_resources}{SceneResources}} resources(\&scene, scene.\mbox{\hyperlink{class_toonz_scene_ae3c828e3223fd809fd59189233d0576a}{getXsheet}}());}
\DoxyCodeLine{01821     resources.accept(\&importer);}
\DoxyCodeLine{01822     scene.\mbox{\hyperlink{class_toonz_scene_a815ecf4f07a92f9f9fef693f762c1228}{setScenePath}}(importer.getImportedScenePath());}
\DoxyCodeLine{01823     scene.\mbox{\hyperlink{class_toonz_scene_aa7aac33fc53c47ea5baff597e5f18a9b}{setProject}}(currentProject.getPointer());}
\DoxyCodeLine{01824   \}}
\DoxyCodeLine{01825   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01826 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a869809aa031fe7dccc55472657e459ae}\label{namespace_io_cmd_a869809aa031fe7dccc55472657e459ae}} 
\index{IoCmd@{IoCmd}!loadSubScene@{loadSubScene}}
\index{loadSubScene@{loadSubScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{loadSubScene()}{loadSubScene()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::load\+Sub\+Scene (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02120                          \{}
\DoxyCodeLine{02121   \mbox{\hyperlink{class_t_selection}{TSelection}} *oldSelection =}
\DoxyCodeLine{02122       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a6e0ee1978807a89009571ed5ce44323b}{getCurrentSelection}}()-\/>getSelection();}
\DoxyCodeLine{02123   \mbox{\hyperlink{class_file_selection}{FileSelection}} *fileSelection =}
\DoxyCodeLine{02124       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_file_selection}{FileSelection}} *\textcolor{keyword}{>}(TSelection::getCurrent());}
\DoxyCodeLine{02125 }
\DoxyCodeLine{02126   \textcolor{keywordflow}{if} (fileSelection) \{}
\DoxyCodeLine{02127     \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{IoCmd::LoadResourceArguments}} args;}
\DoxyCodeLine{02128     \{}
\DoxyCodeLine{02129       std::vector<TFilePath> filePaths;}
\DoxyCodeLine{02130       fileSelection-\/>getSelectedFiles(filePaths);}
\DoxyCodeLine{02131 }
\DoxyCodeLine{02132       args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.assign(filePaths.begin(), filePaths.end());}
\DoxyCodeLine{02133     \}}
\DoxyCodeLine{02134 }
\DoxyCodeLine{02135     \textcolor{keywordflow}{if} (args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}.size() == 1 \&\&}
\DoxyCodeLine{02136         args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}[0].m\_path != \mbox{\hyperlink{class_t_file_path}{TFilePath}}() \&\&}
\DoxyCodeLine{02137         args.\mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments_a5175016c278fd5a031f149abf4f77cb1}{resourceDatas}}[0].m\_path.getType() == \textcolor{stringliteral}{"{}tnz"{}}) \{}
\DoxyCodeLine{02138       \mbox{\hyperlink{namespace_io_cmd_a107f6d3100b922e0c09e9b4aa1a8602a}{loadResources}}(args);}
\DoxyCodeLine{02139       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02140     \}}
\DoxyCodeLine{02141   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02142     \textcolor{keyword}{static} \mbox{\hyperlink{class_load_sub_scene_popup}{LoadSubScenePopup}} *popup = 0;}
\DoxyCodeLine{02143     \textcolor{keywordflow}{if} (!popup) \{}
\DoxyCodeLine{02144       popup = \textcolor{keyword}{new} \mbox{\hyperlink{class_load_sub_scene_popup}{LoadSubScenePopup}}();}
\DoxyCodeLine{02145       popup-\/>addFilterType(\textcolor{stringliteral}{"{}tnz"{}});}
\DoxyCodeLine{02146     \}}
\DoxyCodeLine{02147     \textcolor{keywordtype}{int} ret = popup-\/>exec();}
\DoxyCodeLine{02148     \textcolor{keywordflow}{if} (ret == QDialog::Accepted) \{}
\DoxyCodeLine{02149       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{02150       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02151     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02152       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a6e0ee1978807a89009571ed5ce44323b}{getCurrentSelection}}()-\/>setSelection(oldSelection);}
\DoxyCodeLine{02153       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02154     \}}
\DoxyCodeLine{02155   \}}
\DoxyCodeLine{02156   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02157 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_af6331f41f6a68e8fac4d25fbf12a9596}\label{namespace_io_cmd_af6331f41f6a68e8fac4d25fbf12a9596}} 
\index{IoCmd@{IoCmd}!loadSubScene@{loadSubScene}}
\index{loadSubScene@{loadSubScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{loadSubScene()}{loadSubScene()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::load\+Sub\+Scene (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{scene\+Path }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02159                                                    \{}
\DoxyCodeLine{02160   \mbox{\hyperlink{struct_io_cmd_1_1_load_resource_arguments}{IoCmd::LoadResourceArguments}} args(scenePath);}
\DoxyCodeLine{02161 }
\DoxyCodeLine{02162   \textcolor{keywordflow}{if} (args.resourceDatas.size() == 1 \&\&}
\DoxyCodeLine{02163       args.resourceDatas[0].m\_path != \mbox{\hyperlink{class_t_file_path}{TFilePath}}() \&\&}
\DoxyCodeLine{02164       args.resourceDatas[0].m\_path.getType() == \textcolor{stringliteral}{"{}tnz"{}}) \{}
\DoxyCodeLine{02165     \mbox{\hyperlink{namespace_io_cmd_a107f6d3100b922e0c09e9b4aa1a8602a}{loadResources}}(args);}
\DoxyCodeLine{02166     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02167   \}}
\DoxyCodeLine{02168 }
\DoxyCodeLine{02169   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02170 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a0744065a16191fcb9785de9edcef0c39}\label{namespace_io_cmd_a0744065a16191fcb9785de9edcef0c39}} 
\index{IoCmd@{IoCmd}!newScene@{newScene}}
\index{newScene@{newScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{newScene()}{newScene()}}
{\footnotesize\ttfamily void Io\+Cmd\+::new\+Scene (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01312                      \{}
\DoxyCodeLine{01313   RenderingSuspender suspender;}
\DoxyCodeLine{01314   \mbox{\hyperlink{class_t_app}{TApp}} *app        = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01315   \textcolor{keywordtype}{double} cameraDpi = 120;  \textcolor{comment}{// used to be 64 and 53.33333}}
\DoxyCodeLine{01316 }
\DoxyCodeLine{01317   \textcolor{keywordflow}{if} (!saveSceneIfNeeded(QApplication::tr(\textcolor{stringliteral}{"{}New Scene"{}}))) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01318 }
\DoxyCodeLine{01319   IconGenerator::instance()-\/>clearRequests();}
\DoxyCodeLine{01320   IconGenerator::instance()-\/>clearSceneIcons();}
\DoxyCodeLine{01321   ImageManager::instance()-\/>\mbox{\hyperlink{class_image_manager_af1cdc120ba64146849566808dfdb8f9c}{clear}}();}
\DoxyCodeLine{01322   FullColorPalette::instance()-\/>clear();}
\DoxyCodeLine{01323 }
\DoxyCodeLine{01324   CacheFxCommand::instance()-\/>onNewScene();}
\DoxyCodeLine{01325   CacheFxCommand::instance()-\/>onSceneLoaded();}
\DoxyCodeLine{01326 }
\DoxyCodeLine{01327 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{01328   \textcolor{comment}{// INTERMEDIATE CACHE RESULTS MANAGEMENT: Clear all resources not accessed in}}
\DoxyCodeLine{01329   \textcolor{comment}{// the last 2 sessions}}
\DoxyCodeLine{01330   TCacheResourcePool::instance()-\/>clearAccessedAfterSessions(}
\DoxyCodeLine{01331       1);  \textcolor{comment}{// 0 would be after this session}}
\DoxyCodeLine{01332 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01333 }
\DoxyCodeLine{01334   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = \textcolor{keyword}{new} \mbox{\hyperlink{class_toonz_scene}{ToonzScene}}();}
\DoxyCodeLine{01335   TImageStyle::setCurrentScene(scene);}
\DoxyCodeLine{01336 }
\DoxyCodeLine{01337   \mbox{\hyperlink{class_t_camera}{TCamera}} *camera = scene-\/>\mbox{\hyperlink{class_toonz_scene_a750b5ab623ccec744013b0c83bf20abc}{getCurrentCamera}}();}
\DoxyCodeLine{01338   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} res(1920, 1080);}
\DoxyCodeLine{01339   \textcolor{comment}{// TDimension res(768, 576);}}
\DoxyCodeLine{01340   camera-\/>\mbox{\hyperlink{class_t_camera_a10db423cceb7e3696e6db43409c565f4}{setRes}}(res);}
\DoxyCodeLine{01341   camera-\/>\mbox{\hyperlink{class_t_camera_ac17ef8e563e599d7f1df4755e827de83}{setSize}}(}
\DoxyCodeLine{01342       \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}}((\textcolor{keywordtype}{double})res.lx / cameraDpi, (\textcolor{keywordtype}{double})res.ly / cameraDpi));}
\DoxyCodeLine{01343   scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_a56b62cc35382ceb147e19df2cf11750d}{setBgColor}}(TPixel32::White);}
\DoxyCodeLine{01344   \mbox{\hyperlink{class_t_project_manager_a150ca0d6e2eb171b8117b0c5f03dbfad}{TProjectManager::instance}}()-\/>\mbox{\hyperlink{class_t_project_manager_a930e00976b60a69ae1708bfd08ebf038}{initializeScene}}(scene);}
\DoxyCodeLine{01345   \textcolor{keywordflow}{if} (Preferences::instance()-\/>getPixelsOnly()) \{}
\DoxyCodeLine{01346     \mbox{\hyperlink{class_t_camera}{TCamera}} *updateCamera = scene-\/>\mbox{\hyperlink{class_toonz_scene_a750b5ab623ccec744013b0c83bf20abc}{getCurrentCamera}}();}
\DoxyCodeLine{01347     \mbox{\hyperlink{class_t_dimension_t}{TDimension}} updateRes  = updateCamera-\/>\mbox{\hyperlink{class_t_camera_a9a7c573e7a2c397ffae4b747809ea2a5}{getRes}}();}
\DoxyCodeLine{01348     updateCamera-\/>\mbox{\hyperlink{class_t_camera_ac17ef8e563e599d7f1df4755e827de83}{setSize}}(\mbox{\hyperlink{class_t_dimension_t}{TDimensionD}}((\textcolor{keywordtype}{double})updateRes.lx / cameraDpi,}
\DoxyCodeLine{01349                                       (\textcolor{keywordtype}{double})updateRes.ly / cameraDpi));}
\DoxyCodeLine{01350   \}}
\DoxyCodeLine{01351   \textcolor{comment}{// Must set current scene after initializeScene!!}}
\DoxyCodeLine{01352   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setScene(scene);}
\DoxyCodeLine{01353   \textcolor{comment}{// initializeScene() load project cleanup palette: set it to cleanup palette}}
\DoxyCodeLine{01354   \textcolor{comment}{// handle.}}
\DoxyCodeLine{01355   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()}
\DoxyCodeLine{01356                           -\/>\mbox{\hyperlink{class_t_scene_properties_a84e6735bb0b0ea5054b9592c9612aff9}{getCleanupParameters}}()}
\DoxyCodeLine{01357                           -\/>m\_cleanupPalette.getPointer();}
\DoxyCodeLine{01358   \mbox{\hyperlink{class_palette_controller}{PaletteController}} *paletteController = app-\/>getPaletteController();}
\DoxyCodeLine{01359   paletteController-\/>getCurrentCleanupPalette()-\/>setPalette(palette, -\/1);}
\DoxyCodeLine{01360   paletteController-\/>editLevelPalette();}
\DoxyCodeLine{01361 }
\DoxyCodeLine{01362   \mbox{\hyperlink{class_t_file_path}{TFilePath}} scenePath = scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}();}
\DoxyCodeLine{01363   DvDirModel::instance()-\/>refreshFolder(scenePath.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}());}
\DoxyCodeLine{01364 }
\DoxyCodeLine{01365   Previewer::clearAll();}
\DoxyCodeLine{01366   \mbox{\hyperlink{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}{PreviewFxManager::instance}}()-\/>\mbox{\hyperlink{class_preview_fx_manager_a3cf458cfc0955a610007cb537638d592}{reset}}();}
\DoxyCodeLine{01367 }
\DoxyCodeLine{01368   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>notifyNameSceneChange();}
\DoxyCodeLine{01369   IconGenerator::instance()-\/>invalidateSceneIcon();}
\DoxyCodeLine{01370   \mbox{\hyperlink{class_tool_handle}{ToolHandle}} *toolH = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_ad70b447aff489792cfc3dbac7150a540}{getCurrentTool}}();}
\DoxyCodeLine{01371   \textcolor{keywordflow}{if} (toolH \&\& toolH-\/>getTool()) toolH-\/>getTool()-\/>reset();}
\DoxyCodeLine{01372 }
\DoxyCodeLine{01373   CommandManager::instance()-\/>execute(\textcolor{stringliteral}{"{}T\_Hand"{}});}
\DoxyCodeLine{01374 }
\DoxyCodeLine{01375   CommandManager::instance()-\/>enable(MI\_SaveSubxsheetAs, \textcolor{keyword}{false});}
\DoxyCodeLine{01376 }
\DoxyCodeLine{01377   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>notifySceneChanged();}
\DoxyCodeLine{01378   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{01379   app-\/>\mbox{\hyperlink{class_t_app_a0d91c122eec2b756b7c4780014e49f9e}{getCurrentObject}}()-\/>setIsSpline(\textcolor{keyword}{false});}
\DoxyCodeLine{01380   app-\/>\mbox{\hyperlink{class_t_app_a1e294e7cff300851d12a8c3d196943f6}{getCurrentColumn}}()-\/>setColumnIndex(0);}
\DoxyCodeLine{01381 }
\DoxyCodeLine{01382   \mbox{\hyperlink{class_cleanup_parameters}{CleanupParameters}} *cp = scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_a84e6735bb0b0ea5054b9592c9612aff9}{getCleanupParameters}}();}
\DoxyCodeLine{01383   CleanupParameters::GlobalParameters.assign(cp);}
\DoxyCodeLine{01384 }
\DoxyCodeLine{01385   \textcolor{comment}{// updateCleanupSettingsPopup();}}
\DoxyCodeLine{01386 }
\DoxyCodeLine{01387   \mbox{\hyperlink{class_cleanup_preview_check_a231efbbe4e3356757b725452d5efb62d}{CleanupPreviewCheck::instance}}()-\/>setIsEnabled(\textcolor{keyword}{false});}
\DoxyCodeLine{01388   \mbox{\hyperlink{class_camera_test_check_adc1033b93dea95f49db36d8fb668e16d}{CameraTestCheck::instance}}()-\/>setIsEnabled(\textcolor{keyword}{false});}
\DoxyCodeLine{01389   \mbox{\hyperlink{class_set_scan_cropbox_check_a3dd35523f1e74906ecfd25d62921a490}{SetScanCropboxCheck::instance}}()-\/>setIsEnabled(\textcolor{keyword}{false});}
\DoxyCodeLine{01390 }
\DoxyCodeLine{01391   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>isApplicationStarting())}
\DoxyCodeLine{01392     QApplication::clipboard()-\/>clear();}
\DoxyCodeLine{01393   TSelection::setCurrent(0);}
\DoxyCodeLine{01394   TUndoManager::manager()-\/>reset();}
\DoxyCodeLine{01395 }
\DoxyCodeLine{01396   \textcolor{keywordtype}{bool} exist = TSystem::doesExistFileOrLevel(}
\DoxyCodeLine{01397       scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}()));}
\DoxyCodeLine{01398   QAction *act = CommandManager::instance()-\/>getAction(MI\_RevertScene);}
\DoxyCodeLine{01399   \textcolor{keywordflow}{if} (act) act-\/>setEnabled(exist);}
\DoxyCodeLine{01400 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_ac7e81603b00421a5921bdf482a458758}\label{namespace_io_cmd_ac7e81603b00421a5921bdf482a458758}} 
\index{IoCmd@{IoCmd}!saveAll@{saveAll}}
\index{saveAll@{saveAll}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveAll()}{saveAll()}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+All (\begin{DoxyParamCaption}\item[{int}]{flags = {\ttfamily 0} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01727                              \{}
\DoxyCodeLine{01728   \textcolor{comment}{// try to save as much as possible}}
\DoxyCodeLine{01729   \textcolor{comment}{// if anything is wrong, return false}}
\DoxyCodeLine{01730   \textcolor{keywordtype}{bool} result = saveScene(flags);}
\DoxyCodeLine{01731 }
\DoxyCodeLine{01732   \mbox{\hyperlink{class_t_app}{TApp}} *app         = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01733   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{01734   \textcolor{keywordtype}{bool} untitled     = scene-\/>\mbox{\hyperlink{class_toonz_scene_a53cbaf09f551658479eb743e153ab6bc}{isUntitled}}();}
\DoxyCodeLine{01735   \mbox{\hyperlink{class_scene_resources}{SceneResources}} resources(scene, 0);}
\DoxyCodeLine{01736   resources.save(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}());}
\DoxyCodeLine{01737   resources.updatePaths();}
\DoxyCodeLine{01738 }
\DoxyCodeLine{01739   \textcolor{comment}{// for update title bar}}
\DoxyCodeLine{01740   app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>notifyLevelTitleChange();}
\DoxyCodeLine{01741   app-\/>\mbox{\hyperlink{class_t_app_a33dbcbc578915e0b69fe6927b74cf426}{getCurrentPalette}}()-\/>notifyPaletteTitleChanged();}
\DoxyCodeLine{01742   \textcolor{keywordflow}{if} (untitled) scene-\/>\mbox{\hyperlink{class_toonz_scene_ad5e0cf52431bcf95e54faa416f0fc21d}{setUntitled}}();}
\DoxyCodeLine{01743   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{01744 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a1553ac159a224b46c7ab172b048125e9}\label{namespace_io_cmd_a1553ac159a224b46c7ab172b048125e9}} 
\index{IoCmd@{IoCmd}!saveLevel@{saveLevel}}
\index{saveLevel@{saveLevel}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveLevel()}{saveLevel()}\hspace{0.1cm}{\footnotesize\ttfamily [1/4]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Level (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01621                       \{}
\DoxyCodeLine{01622   \mbox{\hyperlink{class_t_app}{TApp}} *app = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01623   \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl =}
\DoxyCodeLine{01624       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *\textcolor{keyword}{>}(app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>getLevel());}
\DoxyCodeLine{01625   \textcolor{keywordflow}{if} (!sl) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01626   \textcolor{keywordflow}{if} (sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a668293d53a70cca8811db28d87011c55}{getPath}}() == \mbox{\hyperlink{class_t_file_path}{TFilePath}}()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01627   \mbox{\hyperlink{class_t_file_path}{TFilePath}} path =}
\DoxyCodeLine{01628       app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene()-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a668293d53a70cca8811db28d87011c55}{getPath}}());}
\DoxyCodeLine{01629   \textcolor{keywordflow}{if} (path == \mbox{\hyperlink{class_t_file_path}{TFilePath}}()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01630   \textcolor{keywordflow}{if} (path.getWideString()[0] == L\textcolor{charliteral}{'+'}) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01631   \textcolor{keywordflow}{if} (!path.isAbsolute()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01632 }
\DoxyCodeLine{01633   \textcolor{keywordflow}{if} (!saveLevel(path, sl, \textcolor{keyword}{true})) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01634 }
\DoxyCodeLine{01635   sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a2d43337766628739707849f8808bf300}{setDirtyFlag}}(\textcolor{keyword}{false});}
\DoxyCodeLine{01636   \textcolor{comment}{// for update title bar}}
\DoxyCodeLine{01637   app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>notifyLevelChange();}
\DoxyCodeLine{01638   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01639 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a98582f18716776eccfc2332996cd615b}\label{namespace_io_cmd_a98582f18716776eccfc2332996cd615b}} 
\index{IoCmd@{IoCmd}!saveLevel@{saveLevel}}
\index{saveLevel@{saveLevel}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveLevel()}{saveLevel()}\hspace{0.1cm}{\footnotesize\ttfamily [2/4]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Level (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01590                                            \{}
\DoxyCodeLine{01591   assert(!path.isEmpty());}
\DoxyCodeLine{01592 }
\DoxyCodeLine{01593   \mbox{\hyperlink{class_t_app}{TApp}} *app = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01594   \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl =}
\DoxyCodeLine{01595       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *\textcolor{keyword}{>}(app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>getLevel());}
\DoxyCodeLine{01596   \textcolor{keywordflow}{if} (!sl) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01597   std::string ext    = sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a668293d53a70cca8811db28d87011c55}{getPath}}().\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}();}
\DoxyCodeLine{01598   std::string dotts  = sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a668293d53a70cca8811db28d87011c55}{getPath}}().\mbox{\hyperlink{class_t_file_path_a698bbf714436eb6923359044900cde2b}{getDots}}();}
\DoxyCodeLine{01599   \mbox{\hyperlink{class_t_file_path}{TFilePath}} realPath = path;}
\DoxyCodeLine{01600   \textcolor{keywordflow}{if} (realPath.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{01601     realPath = \mbox{\hyperlink{class_t_file_path}{TFilePath}}(realPath.getWideString() + ::to\_wstring(dotts + ext));}
\DoxyCodeLine{01602 }
\DoxyCodeLine{01603   \textcolor{keywordtype}{bool} ret = saveLevel(realPath, sl, \textcolor{keyword}{false});}
\DoxyCodeLine{01604   \textcolor{keywordflow}{if} (!ret) \{  \textcolor{comment}{// save level failed}}
\DoxyCodeLine{01605     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01606   \}}
\DoxyCodeLine{01607 }
\DoxyCodeLine{01608   RecentFiles::instance()-\/>addFilePath(toQString(realPath), RecentFiles::Level);}
\DoxyCodeLine{01609 }
\DoxyCodeLine{01610   \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()}
\DoxyCodeLine{01611       -\/>getPaletteController()}
\DoxyCodeLine{01612       -\/>getCurrentLevelPalette()}
\DoxyCodeLine{01613       -\/>notifyPaletteSwitched();}
\DoxyCodeLine{01614   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01615 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_ace7b0a1cc73ddbfc14483d3415609396}\label{namespace_io_cmd_ace7b0a1cc73ddbfc14483d3415609396}} 
\index{IoCmd@{IoCmd}!saveLevel@{saveLevel}}
\index{saveLevel@{saveLevel}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveLevel()}{saveLevel()}\hspace{0.1cm}{\footnotesize\ttfamily [3/4]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Level (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp,  }\item[{\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$}]{sl,  }\item[{bool}]{overwrite }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01646                                       \{}
\DoxyCodeLine{01647   assert(sl);}
\DoxyCodeLine{01648   \textcolor{keywordtype}{bool} fileDoesExist = TSystem::doesExistFileOrLevel(fp);}
\DoxyCodeLine{01649   \textcolor{keywordflow}{if} (!overwrite \&\& fileDoesExist) \{}
\DoxyCodeLine{01650     QString question;}
\DoxyCodeLine{01651     question = QObject::tr(}
\DoxyCodeLine{01652                    \textcolor{stringliteral}{"{}The level \%1 already exists.\(\backslash\)nDo you want to overwrite it?"{}})}
\DoxyCodeLine{01653                    .arg(toQString(fp));}
\DoxyCodeLine{01654     \textcolor{keywordtype}{int} ret = DVGui::MsgBox(question, QObject::tr(\textcolor{stringliteral}{"{}Overwrite"{}}),}
\DoxyCodeLine{01655                             QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}}), 0);}
\DoxyCodeLine{01656     \textcolor{keywordflow}{if} (ret == 2 || ret == 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01657   \}}
\DoxyCodeLine{01658 }
\DoxyCodeLine{01659   \textcolor{keywordtype}{bool} overwritePalette = \textcolor{keyword}{false};}
\DoxyCodeLine{01660   \textcolor{comment}{// Confirmation of Overwrite palette}}
\DoxyCodeLine{01661   \textcolor{comment}{// open dialog IF  1) the level is dirty, and 2) confirmation of overwrite}}
\DoxyCodeLine{01662   \textcolor{comment}{// palette haven't been asked}}
\DoxyCodeLine{01663   \textcolor{comment}{// for PLI file, do nothing}}
\DoxyCodeLine{01664   \textcolor{keywordflow}{if} (sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a9aea4f8e34caef293d5e5c7694047564}{getPalette}}() \&\& sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a9aea4f8e34caef293d5e5c7694047564}{getPalette}}()-\/>\mbox{\hyperlink{class_t_palette_acef775ca72db90dfdebb0dcad53a3af2}{getAskOverwriteFlag}}() \&\&}
\DoxyCodeLine{01665       sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a668293d53a70cca8811db28d87011c55}{getPath}}().\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() != \textcolor{stringliteral}{"{}pli"{}}) \{}
\DoxyCodeLine{01666     \textcolor{comment}{/*-\/-\/  -\/-\/*/}}
\DoxyCodeLine{01667     \textcolor{keywordflow}{if} (!fileDoesExist)}
\DoxyCodeLine{01668       overwritePalette = \textcolor{keyword}{true};}
\DoxyCodeLine{01669     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01670       QString question;}
\DoxyCodeLine{01671       question =}
\DoxyCodeLine{01672           \textcolor{stringliteral}{"{}Palette "{}} +}
\DoxyCodeLine{01673           QString::fromStdWString(sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a9aea4f8e34caef293d5e5c7694047564}{getPalette}}()-\/>\mbox{\hyperlink{class_t_palette_af0bb56df19af40d1a729482efc85f492}{getPaletteName}}()) +}
\DoxyCodeLine{01674           \textcolor{stringliteral}{"{}.tpl has been modified. Do you want to overwrite palette as well ?"{}};}
\DoxyCodeLine{01675       \textcolor{keywordtype}{int} ret =}
\DoxyCodeLine{01676           DVGui::MsgBox(question, QObject::tr(\textcolor{stringliteral}{"{}Overwrite Palette"{}}) \textcolor{comment}{/*ret = 1*/},}
\DoxyCodeLine{01677                         QObject::tr(\textcolor{stringliteral}{"{}Don't Overwrite Palette"{}}) \textcolor{comment}{/*ret = 2*/}, 0);}
\DoxyCodeLine{01678       \textcolor{keywordflow}{if} (ret == 1) overwritePalette = \textcolor{keyword}{true};}
\DoxyCodeLine{01679     \}}
\DoxyCodeLine{01680   \}}
\DoxyCodeLine{01681 }
\DoxyCodeLine{01682   QApplication::setOverrideCursor(Qt::WaitCursor);}
\DoxyCodeLine{01683   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{01684     sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a5ceff3b4f997fbe62be18948fc893404}{save}}(fp, \mbox{\hyperlink{class_t_file_path}{TFilePath}}(), overwritePalette);}
\DoxyCodeLine{01685   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_system_exception}{TSystemException}} se) \{}
\DoxyCodeLine{01686     QApplication::restoreOverrideCursor();}
\DoxyCodeLine{01687     DVGui::warning(QString::fromStdWString(se.getMessage()));}
\DoxyCodeLine{01688     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01689   \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{01690     QApplication::restoreOverrideCursor();}
\DoxyCodeLine{01691     DVGui::error(QObject::tr(\textcolor{stringliteral}{"{}Couldn't save \%1"{}}).arg(toQString(fp)));}
\DoxyCodeLine{01692     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01693   \}}
\DoxyCodeLine{01694   IconGenerator::instance()-\/>invalidate(fp);}
\DoxyCodeLine{01695   FileBrowser::refreshFolder(fp.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}());}
\DoxyCodeLine{01696   History::instance()-\/>addItem(fp);}
\DoxyCodeLine{01697 }
\DoxyCodeLine{01698   \textcolor{keywordflow}{if} (sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a9aea4f8e34caef293d5e5c7694047564}{getPalette}}()) \{}
\DoxyCodeLine{01699     \textcolor{keywordflow}{if} (overwritePalette || sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a668293d53a70cca8811db28d87011c55}{getPath}}().\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}pli"{}})}
\DoxyCodeLine{01700       sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a9aea4f8e34caef293d5e5c7694047564}{getPalette}}()-\/>\mbox{\hyperlink{class_t_palette_a382fa102abee4e69e386cb5a4d8d5184}{setDirtyFlag}}(\textcolor{keyword}{false});}
\DoxyCodeLine{01701     \textcolor{keywordflow}{else}  \textcolor{comment}{// ask only once for save palette}}
\DoxyCodeLine{01702       sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a9aea4f8e34caef293d5e5c7694047564}{getPalette}}()-\/>\mbox{\hyperlink{class_t_palette_a988c1603b1f87b4d3e26195781574658}{setAskOverwriteFlag}}(\textcolor{keyword}{false});}
\DoxyCodeLine{01703   \}}
\DoxyCodeLine{01704 }
\DoxyCodeLine{01705   RecentFiles::instance()-\/>addFilePath(toQString(fp), RecentFiles::Level);}
\DoxyCodeLine{01706   QApplication::restoreOverrideCursor();}
\DoxyCodeLine{01707   \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>notifyLevelTitleChange();}
\DoxyCodeLine{01708   \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()}
\DoxyCodeLine{01709       -\/>getPaletteController()}
\DoxyCodeLine{01710       -\/>getCurrentLevelPalette()}
\DoxyCodeLine{01711       -\/>notifyPaletteTitleChanged();}
\DoxyCodeLine{01712   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01713 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_af73b59e57b994553e045e193655d8a8c}\label{namespace_io_cmd_af73b59e57b994553e045e193655d8a8c}} 
\index{IoCmd@{IoCmd}!saveLevel@{saveLevel}}
\index{saveLevel@{saveLevel}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveLevel()}{saveLevel()}\hspace{0.1cm}{\footnotesize\ttfamily [4/4]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Level (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$}]{sl }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01719                                          \{}
\DoxyCodeLine{01720   \textcolor{keywordflow}{return} saveLevel(sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a668293d53a70cca8811db28d87011c55}{getPath}}(), sl, \textcolor{keyword}{true});}
\DoxyCodeLine{01721 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a1872b1c5260e011f557d45631eed83c5}\label{namespace_io_cmd_a1872b1c5260e011f557d45631eed83c5}} 
\index{IoCmd@{IoCmd}!saveNonSceneFiles@{saveNonSceneFiles}}
\index{saveNonSceneFiles@{saveNonSceneFiles}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveNonSceneFiles()}{saveNonSceneFiles()}}
{\footnotesize\ttfamily void Io\+Cmd\+::save\+Non\+Scene\+Files (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01750                               \{}
\DoxyCodeLine{01751   \textcolor{comment}{// try to save non scene files}}
\DoxyCodeLine{01752 }
\DoxyCodeLine{01753   \mbox{\hyperlink{class_t_app}{TApp}} *app         = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01754   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{01755   \textcolor{keywordtype}{bool} untitled     = scene-\/>\mbox{\hyperlink{class_toonz_scene_a53cbaf09f551658479eb743e153ab6bc}{isUntitled}}();}
\DoxyCodeLine{01756   \mbox{\hyperlink{class_scene_resources}{SceneResources}} resources(scene, 0);}
\DoxyCodeLine{01757   resources.save(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}());}
\DoxyCodeLine{01758   \textcolor{keywordflow}{if} (untitled) scene-\/>\mbox{\hyperlink{class_toonz_scene_ad5e0cf52431bcf95e54faa416f0fc21d}{setUntitled}}();}
\DoxyCodeLine{01759   resources.updatePaths();}
\DoxyCodeLine{01760 }
\DoxyCodeLine{01761   \textcolor{comment}{// for update title bar}}
\DoxyCodeLine{01762   app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>notifyLevelTitleChange();}
\DoxyCodeLine{01763   app-\/>\mbox{\hyperlink{class_t_app_a33dbcbc578915e0b69fe6927b74cf426}{getCurrentPalette}}()-\/>notifyPaletteTitleChanged();}
\DoxyCodeLine{01764 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a62f202786d36605ae3e1c4d3b99651a3}\label{namespace_io_cmd_a62f202786d36605ae3e1c4d3b99651a3}} 
\index{IoCmd@{IoCmd}!saveScene@{saveScene}}
\index{saveScene@{saveScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveScene()}{saveScene()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Scene (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp,  }\item[{int}]{flags }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01406                                                       \{}
\DoxyCodeLine{01407   \textcolor{keywordtype}{bool} overwrite     = (flags \& SILENTLY\_OVERWRITE) != 0;}
\DoxyCodeLine{01408   \textcolor{keywordtype}{bool} saveSubxsheet = (flags \& SAVE\_SUBXSHEET) != 0;}
\DoxyCodeLine{01409   \textcolor{keywordtype}{bool} isAutosave    = (flags \& AUTO\_SAVE) != 0;}
\DoxyCodeLine{01410   \mbox{\hyperlink{class_t_app}{TApp}} *app          = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01411 }
\DoxyCodeLine{01412   assert(!path.isEmpty());}
\DoxyCodeLine{01413   \mbox{\hyperlink{class_t_file_path}{TFilePath}} scenePath = path;}
\DoxyCodeLine{01414   \textcolor{keywordflow}{if} (scenePath.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() == \textcolor{stringliteral}{"{}"{}}) scenePath = scenePath.\mbox{\hyperlink{class_t_file_path_a1437b0e0720e9258b622f68b6858e95d}{withType}}(\textcolor{stringliteral}{"{}tnz"{}});}
\DoxyCodeLine{01415   \textcolor{keywordflow}{if} (scenePath.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() != \textcolor{stringliteral}{"{}tnz"{}}) \{}
\DoxyCodeLine{01416     error(}
\DoxyCodeLine{01417         QObject::tr(\textcolor{stringliteral}{"{}\%1 has an invalid file extension."{}}).arg(toQString(path)));}
\DoxyCodeLine{01418     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01419   \}}
\DoxyCodeLine{01420   \mbox{\hyperlink{class_t_file_status}{TFileStatus}} dirStatus(scenePath.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}());}
\DoxyCodeLine{01421   \textcolor{keywordflow}{if} (!(dirStatus.doesExist() \&\& dirStatus.isWritable())) \{}
\DoxyCodeLine{01422     error(QObject::tr(\textcolor{stringliteral}{"{}\%1 is an invalid path."{}})}
\DoxyCodeLine{01423               .arg(toQString(scenePath.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}())));}
\DoxyCodeLine{01424     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01425   \}}
\DoxyCodeLine{01426 }
\DoxyCodeLine{01427   \textcolor{comment}{// notify user if the scene will be saved including any "{}broken"{} expression}}
\DoxyCodeLine{01428   \textcolor{comment}{// reference}}
\DoxyCodeLine{01429   \textcolor{keywordflow}{if} (!ExpressionReferenceManager::instance()-\/>askIfParamIsIgnoredOnSave(}
\DoxyCodeLine{01430           saveSubxsheet))}
\DoxyCodeLine{01431     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01432 }
\DoxyCodeLine{01433   \textcolor{keywordflow}{if} (!overwrite \&\& \mbox{\hyperlink{class_t_file_status}{TFileStatus}}(scenePath).doesExist()) \{}
\DoxyCodeLine{01434     QString question;}
\DoxyCodeLine{01435     question = QObject::tr(}
\DoxyCodeLine{01436                    \textcolor{stringliteral}{"{}The scene \%1 already exists.\(\backslash\)nDo you want to overwrite it?"{}})}
\DoxyCodeLine{01437                    .arg(QString::fromStdString(scenePath.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()));}
\DoxyCodeLine{01438 }
\DoxyCodeLine{01439     \textcolor{keywordtype}{int} ret = DVGui::MsgBox(question, QObject::tr(\textcolor{stringliteral}{"{}Overwrite"{}}),}
\DoxyCodeLine{01440                             QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}}), 0);}
\DoxyCodeLine{01441     \textcolor{keywordflow}{if} (ret == 2 || ret == 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01442   \}}
\DoxyCodeLine{01443 }
\DoxyCodeLine{01444   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{01445 }
\DoxyCodeLine{01446   \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsheet = 0;}
\DoxyCodeLine{01447   \textcolor{keywordflow}{if} (saveSubxsheet) xsheet = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>getXsheet();}
\DoxyCodeLine{01448 }
\DoxyCodeLine{01449   \textcolor{comment}{// Automatically remove unused levels}}
\DoxyCodeLine{01450   \textcolor{keywordflow}{if} (!saveSubxsheet \&\& !isAutosave \&\&}
\DoxyCodeLine{01451       Preferences::instance()-\/>isAutoRemoveUnusedLevelsEnabled()) \{}
\DoxyCodeLine{01452     \textcolor{keywordflow}{if} (LevelCmd::removeUnusedLevelsFromCast(\textcolor{keyword}{false}))}
\DoxyCodeLine{01453       DVGui::info(}
\DoxyCodeLine{01454           QObject::tr(\textcolor{stringliteral}{"{}Removed unused levels from the scene cast. (This "{}}}
\DoxyCodeLine{01455                       \textcolor{stringliteral}{"{}behavior can be disabled in Preferences.)"{}}));}
\DoxyCodeLine{01456   \}}
\DoxyCodeLine{01457 }
\DoxyCodeLine{01458   \textcolor{comment}{// If the scene will be saved in the different folder, check out the scene}}
\DoxyCodeLine{01459   \textcolor{comment}{// cast.}}
\DoxyCodeLine{01460   \textcolor{comment}{// if the cast contains the level specified with \$scenefolder alias,}}
\DoxyCodeLine{01461   \textcolor{comment}{// open a warning popup notifying that such level will lose link.}}
\DoxyCodeLine{01462 }
\DoxyCodeLine{01463   \textcolor{comment}{// in case of saving subxsheet, the current scene will not be switched to the}}
\DoxyCodeLine{01464   \textcolor{comment}{// saved one}}
\DoxyCodeLine{01465   \textcolor{comment}{// so the level paths are needed to be reverted after saving}}
\DoxyCodeLine{01466   QHash<TXshLevel *, TFilePath> orgLevelPaths;}
\DoxyCodeLine{01467   \textcolor{keyword}{auto} revertOrgLevelPaths = [\&] \{}
\DoxyCodeLine{01468     QHash<TXshLevel *, TFilePath>::const\_iterator i =}
\DoxyCodeLine{01469         orgLevelPaths.constBegin();}
\DoxyCodeLine{01470     \textcolor{keywordflow}{while} (i != orgLevelPaths.constEnd()) \{}
\DoxyCodeLine{01471       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sil = i.key()-\/>getSimpleLevel())}
\DoxyCodeLine{01472         sil-\/>setPath(i.value(), \textcolor{keyword}{true});}
\DoxyCodeLine{01473       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_palette_level}{TXshPaletteLevel}} *pal = i.key()-\/>getPaletteLevel())}
\DoxyCodeLine{01474         pal-\/>setPath(i.value());}
\DoxyCodeLine{01475       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_sound_level}{TXshSoundLevel}} *sol = i.key()-\/>getSoundLevel())}
\DoxyCodeLine{01476         sol-\/>setPath(i.value());}
\DoxyCodeLine{01477       ++i;}
\DoxyCodeLine{01478     \}}
\DoxyCodeLine{01479   \};}
\DoxyCodeLine{01480 }
\DoxyCodeLine{01481   \textcolor{keywordflow}{if} (!overwrite) \{}
\DoxyCodeLine{01482     \textcolor{keywordtype}{bool} ret = takeCareSceneFolderItemsOnSaveSceneAs(scene, scenePath, xsheet,}
\DoxyCodeLine{01483                                                      orgLevelPaths);}
\DoxyCodeLine{01484     \textcolor{keywordflow}{if} (!ret) \{}
\DoxyCodeLine{01485       revertOrgLevelPaths();}
\DoxyCodeLine{01486       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01487     \}}
\DoxyCodeLine{01488   \}}
\DoxyCodeLine{01489 }
\DoxyCodeLine{01490   \mbox{\hyperlink{class_t_file_path}{TFilePath}} oldFullPath = scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}());}
\DoxyCodeLine{01491   \mbox{\hyperlink{class_t_file_path}{TFilePath}} newFullPath = scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(scenePath);}
\DoxyCodeLine{01492 }
\DoxyCodeLine{01493   QApplication::setOverrideCursor(Qt::WaitCursor);}
\DoxyCodeLine{01494   \textcolor{keywordflow}{if} (app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getDirtyFlag())}
\DoxyCodeLine{01495     scene-\/>\mbox{\hyperlink{class_toonz_scene_ae3c27b7146c62da156c5d5bffca0e9d7}{getContentHistory}}(\textcolor{keyword}{true})-\/>\mbox{\hyperlink{class_t_content_history_a2f68765ab2651c30dfbbae3f98f73403}{modifiedNow}}();}
\DoxyCodeLine{01496 }
\DoxyCodeLine{01497   \textcolor{keywordflow}{if} (oldFullPath != newFullPath) \{}
\DoxyCodeLine{01498     IconGenerator::instance()-\/>clearRequests();}
\DoxyCodeLine{01499     IconGenerator::instance()-\/>clearSceneIcons();}
\DoxyCodeLine{01500 }
\DoxyCodeLine{01501 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{01502     \textcolor{comment}{// Open the new cache resources HD pool}}
\DoxyCodeLine{01503     TCacheResourcePool::instance()-\/>\mbox{\hyperlink{class_t_cache_resource_pool_afc0d81a64dacaacdad079fb1c3edb9f8}{setPath}}(}
\DoxyCodeLine{01504         QString::fromStdWString(}
\DoxyCodeLine{01505             ToonzFolder::getCacheRootFolder().getWideString()),}
\DoxyCodeLine{01506         QString::fromStdWString(scene-\/>\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}()-\/>\mbox{\hyperlink{class_t_project_a258a4b6435978b730722a92ab104cd89}{getName}}().getWideName()),}
\DoxyCodeLine{01507         QString::fromStdWString(scene-\/>\mbox{\hyperlink{class_toonz_scene_a1fa0a1cbf9eb6360d980392acc99924b}{getSceneName}}()));}
\DoxyCodeLine{01508 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01509   \}}
\DoxyCodeLine{01510 }
\DoxyCodeLine{01511   \mbox{\hyperlink{class_cleanup_parameters}{CleanupParameters}} *cp = scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_a84e6735bb0b0ea5054b9592c9612aff9}{getCleanupParameters}}();}
\DoxyCodeLine{01512   \mbox{\hyperlink{class_cleanup_parameters}{CleanupParameters}} oldCP(*cp);}
\DoxyCodeLine{01513   cp-\/>assign(\&CleanupParameters::GlobalParameters);}
\DoxyCodeLine{01514 }
\DoxyCodeLine{01515   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{01516     scene-\/>\mbox{\hyperlink{class_toonz_scene_ac65f5b13baf094ba58e2e74c6949df61}{save}}(scenePath, xsheet);}
\DoxyCodeLine{01517   \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} \mbox{\hyperlink{class_t_system_exception}{TSystemException}} \&se) \{}
\DoxyCodeLine{01518     DVGui::warning(QString::fromStdWString(se.getMessage()));}
\DoxyCodeLine{01519   \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{01520     DVGui::error(QObject::tr(\textcolor{stringliteral}{"{}Couldn't save \%1"{}}).arg(toQString(scenePath)));}
\DoxyCodeLine{01521   \}}
\DoxyCodeLine{01522 }
\DoxyCodeLine{01523   cp-\/>assign(\&oldCP);}
\DoxyCodeLine{01524 }
\DoxyCodeLine{01525   \textcolor{comment}{// in case of saving subxsheet, revert the level paths after saving}}
\DoxyCodeLine{01526   revertOrgLevelPaths();}
\DoxyCodeLine{01527 }
\DoxyCodeLine{01528   \textcolor{keywordflow}{if} (!overwrite \&\& !saveSubxsheet)}
\DoxyCodeLine{01529     app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>notifyNameSceneChange();}
\DoxyCodeLine{01530   FileBrowser::refreshFolder(scenePath.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}());}
\DoxyCodeLine{01531   IconGenerator::instance()-\/>invalidate(scenePath);}
\DoxyCodeLine{01532 }
\DoxyCodeLine{01533   \textcolor{comment}{// Le seguenti notifiche non cambiano il dirty flag del livello o della}}
\DoxyCodeLine{01534   \textcolor{comment}{// paletta}}
\DoxyCodeLine{01535   \textcolor{comment}{// ma sono necessarie per aggiornare le titlebar dei pannelli.}}
\DoxyCodeLine{01536   app-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>notifyLevelTitleChange();}
\DoxyCodeLine{01537   app-\/>\mbox{\hyperlink{class_t_app_a33dbcbc578915e0b69fe6927b74cf426}{getCurrentPalette}}()-\/>notifyPaletteTitleChanged();}
\DoxyCodeLine{01538 }
\DoxyCodeLine{01539   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{01540 }
\DoxyCodeLine{01541   History::instance()-\/>addItem(scenePath);}
\DoxyCodeLine{01542   RecentFiles::instance()-\/>addFilePath(}
\DoxyCodeLine{01543       toQString(scenePath), RecentFiles::Scene,}
\DoxyCodeLine{01544       QString::fromStdString(app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()}
\DoxyCodeLine{01545                                  -\/>getScene()}
\DoxyCodeLine{01546                                  -\/>\mbox{\hyperlink{class_toonz_scene_afec1477d4fe0bb1e1152e80c3a0b20ab}{getProject}}()}
\DoxyCodeLine{01547                                  -\/>\mbox{\hyperlink{class_t_project_a258a4b6435978b730722a92ab104cd89}{getName}}()}
\DoxyCodeLine{01548                                  .\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()));}
\DoxyCodeLine{01549 }
\DoxyCodeLine{01550   QApplication::restoreOverrideCursor();}
\DoxyCodeLine{01551 }
\DoxyCodeLine{01552   \textcolor{keywordtype}{bool} exist = TSystem::doesExistFileOrLevel(}
\DoxyCodeLine{01553       scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}()));}
\DoxyCodeLine{01554   QAction *act = CommandManager::instance()-\/>getAction(MI\_RevertScene);}
\DoxyCodeLine{01555   \textcolor{keywordflow}{if} (act) act-\/>setEnabled(exist);}
\DoxyCodeLine{01556 }
\DoxyCodeLine{01557   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01558 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_aa7115d1d248236e7274bfe5f947f028a}\label{namespace_io_cmd_aa7115d1d248236e7274bfe5f947f028a}} 
\index{IoCmd@{IoCmd}!saveScene@{saveScene}}
\index{saveScene@{saveScene}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveScene()}{saveScene()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Scene (\begin{DoxyParamCaption}\item[{int}]{flags = {\ttfamily 0} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01564                                \{}
\DoxyCodeLine{01565   \mbox{\hyperlink{class_t_selection}{TSelection}} *oldSelection =}
\DoxyCodeLine{01566       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a6e0ee1978807a89009571ed5ce44323b}{getCurrentSelection}}()-\/>getSelection();}
\DoxyCodeLine{01567   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{01568   \textcolor{keywordflow}{if} (scene-\/>\mbox{\hyperlink{class_toonz_scene_a53cbaf09f551658479eb743e153ab6bc}{isUntitled}}()) \{}
\DoxyCodeLine{01569     \textcolor{keyword}{static} \mbox{\hyperlink{class_save_scene_as_popup}{SaveSceneAsPopup}} *popup = 0;}
\DoxyCodeLine{01570     \textcolor{keywordflow}{if} (!popup) popup = \textcolor{keyword}{new} \mbox{\hyperlink{class_save_scene_as_popup}{SaveSceneAsPopup}}();}
\DoxyCodeLine{01571     \textcolor{keywordtype}{int} ret = popup-\/>exec();}
\DoxyCodeLine{01572     \textcolor{keywordflow}{if} (ret == QDialog::Accepted) \{}
\DoxyCodeLine{01573       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{01574       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01575     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01576       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a6e0ee1978807a89009571ed5ce44323b}{getCurrentSelection}}()-\/>setSelection(oldSelection);}
\DoxyCodeLine{01577       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01578     \}}
\DoxyCodeLine{01579   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01580     \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp = scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}();}
\DoxyCodeLine{01581     \textcolor{comment}{// salva la scena con il nome fp. se fp esiste gia' lo sovrascrive}}
\DoxyCodeLine{01582     \textcolor{keywordflow}{return} saveScene(fp, SILENTLY\_OVERWRITE | flags);}
\DoxyCodeLine{01583   \}}
\DoxyCodeLine{01584 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a5e6da51135e070996c599fe16bd4bbd3}\label{namespace_io_cmd_a5e6da51135e070996c599fe16bd4bbd3}} 
\index{IoCmd@{IoCmd}!saveSceneIfNeeded@{saveSceneIfNeeded}}
\index{saveSceneIfNeeded@{saveSceneIfNeeded}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveSceneIfNeeded()}{saveSceneIfNeeded()}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Scene\+If\+Needed (\begin{DoxyParamCaption}\item[{QString}]{msg }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01230                                          \{}
\DoxyCodeLine{01231   \mbox{\hyperlink{class_t_app}{TApp}} *app = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{01232 }
\DoxyCodeLine{01233   \textcolor{keywordflow}{if} (app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getDirtyFlag()) \{}
\DoxyCodeLine{01234     QString question;}
\DoxyCodeLine{01235     question = QObject::tr(}
\DoxyCodeLine{01236                    \textcolor{stringliteral}{"{}\%1: the current scene has been modified.\(\backslash\)n"{}}}
\DoxyCodeLine{01237                    \textcolor{stringliteral}{"{}What would you like to do?"{}})}
\DoxyCodeLine{01238                    .arg(msg);}
\DoxyCodeLine{01239     \textcolor{keywordtype}{int} ret = DVGui::MsgBox(}
\DoxyCodeLine{01240         question, QObject::tr(\textcolor{stringliteral}{"{}Save All"{}}), QObject::tr(\textcolor{stringliteral}{"{}Save Scene Only"{}}),}
\DoxyCodeLine{01241         QObject::tr(\textcolor{stringliteral}{"{}Discard Changes"{}}), QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}}), 0);}
\DoxyCodeLine{01242     \textcolor{keywordflow}{if} (ret == 0 || ret == 4) \{}
\DoxyCodeLine{01243       \textcolor{comment}{// cancel (or closed message box window)}}
\DoxyCodeLine{01244       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01245     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 1) \{}
\DoxyCodeLine{01246       \textcolor{comment}{// save all}}
\DoxyCodeLine{01247       \textcolor{keywordflow}{if} (!IoCmd::saveAll()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01248     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 2) \{}
\DoxyCodeLine{01249       \textcolor{comment}{// save}}
\DoxyCodeLine{01250       \textcolor{keywordflow}{if} (!IoCmd::saveScene()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01251     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 3) \{}
\DoxyCodeLine{01252     \}}
\DoxyCodeLine{01253   \}}
\DoxyCodeLine{01254 }
\DoxyCodeLine{01255   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{01256   \textcolor{keywordflow}{if} (scene) \{}
\DoxyCodeLine{01257     QStringList dirtyResources;}
\DoxyCodeLine{01258     \{}
\DoxyCodeLine{01259       \mbox{\hyperlink{class_scene_resources}{SceneResources}} resources(scene, 0);}
\DoxyCodeLine{01260       resources.getDirtyResources(dirtyResources);}
\DoxyCodeLine{01261     \}}
\DoxyCodeLine{01262 }
\DoxyCodeLine{01263     \textcolor{keywordflow}{if} (!dirtyResources.empty()) \{}
\DoxyCodeLine{01264       \textcolor{comment}{// show up to 5 items}}
\DoxyCodeLine{01265       \textcolor{keywordtype}{int} extraCount = dirtyResources.count() -\/ 5;}
\DoxyCodeLine{01266       \textcolor{keywordflow}{if} (extraCount > 0) \{}
\DoxyCodeLine{01267         dirtyResources = dirtyResources.mid(0, 5);}
\DoxyCodeLine{01268         dirtyResources.append(}
\DoxyCodeLine{01269             QObject::tr(\textcolor{stringliteral}{"{}and \%1 more item(s)."{}}).arg(extraCount));}
\DoxyCodeLine{01270       \}}
\DoxyCodeLine{01271 }
\DoxyCodeLine{01272       QString question;}
\DoxyCodeLine{01273 }
\DoxyCodeLine{01274       question = msg + \textcolor{stringliteral}{"{}:"{}} +}
\DoxyCodeLine{01275                  QObject::tr(\textcolor{stringliteral}{"{} The following file(s) have been modified.\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{01276 }
\DoxyCodeLine{01277       question += \textcolor{stringliteral}{"{}  "{}} + dirtyResources.join(\textcolor{stringliteral}{"{}\(\backslash\)n  "{}});}
\DoxyCodeLine{01278 }
\DoxyCodeLine{01279       question += \textcolor{stringliteral}{"{}\(\backslash\)n"{}} + QObject::tr(\textcolor{stringliteral}{"{}\(\backslash\)nWhat would you like to do? "{}});}
\DoxyCodeLine{01280 }
\DoxyCodeLine{01281       \textcolor{keywordtype}{int} ret =}
\DoxyCodeLine{01282           DVGui::MsgBox(question, QObject::tr(\textcolor{stringliteral}{"{}Save Changes"{}}),}
\DoxyCodeLine{01283                         msg + QObject::tr(\textcolor{stringliteral}{"{} Anyway"{}}), QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}}), 0);}
\DoxyCodeLine{01284       \textcolor{keywordflow}{if} (ret == 0 || ret == 3) \{}
\DoxyCodeLine{01285         \textcolor{comment}{// cancel (or closed message box window)}}
\DoxyCodeLine{01286         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01287       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 1) \{}
\DoxyCodeLine{01288         \textcolor{comment}{// save non scene files}}
\DoxyCodeLine{01289         IoCmd::saveNonSceneFiles();}
\DoxyCodeLine{01290       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 2) \{}
\DoxyCodeLine{01291         \textcolor{comment}{// do nothing and continue}}
\DoxyCodeLine{01292       \}}
\DoxyCodeLine{01293     \}}
\DoxyCodeLine{01294 }
\DoxyCodeLine{01295     RenderingSuspender suspender;}
\DoxyCodeLine{01296 }
\DoxyCodeLine{01297     \mbox{\hyperlink{class_t_file_path}{TFilePath}} scenePath(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}());}
\DoxyCodeLine{01298     scene-\/>\mbox{\hyperlink{class_toonz_scene_ad63e1050bdbe8f213f5da4bc852c6f7a}{clear}}();  \textcolor{comment}{// note: this (possibly) removes the "{}untitled"{} folder}}
\DoxyCodeLine{01299     app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>notifyCastChange();}
\DoxyCodeLine{01300     \textcolor{comment}{// Si deve notificare anche il cambiamento che ha subito l'xsheet.}}
\DoxyCodeLine{01301     app-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>notifyXsheetSwitched();}
\DoxyCodeLine{01302     FileBrowser::refreshFolder(scenePath.getParentDir());}
\DoxyCodeLine{01303   \}}
\DoxyCodeLine{01304   app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{01305   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01306 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a3e9b7393f785dd784c38efe0788b45a4}\label{namespace_io_cmd_a3e9b7393f785dd784c38efe0788b45a4}} 
\index{IoCmd@{IoCmd}!saveSound@{saveSound}}
\index{saveSound@{saveSound}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveSound()}{saveSound()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Sound (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp,  }\item[{\mbox{\hyperlink{class_t_xsh_sound_level}{TXsh\+Sound\+Level}} $\ast$}]{sc,  }\item[{bool}]{overwrite }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01770                                                                              \{}
\DoxyCodeLine{01771   \textcolor{keywordflow}{if} (!overwrite \&\& TSystem::doesExistFileOrLevel(fp)) \{}
\DoxyCodeLine{01772     QString question;}
\DoxyCodeLine{01773     question =}
\DoxyCodeLine{01774         QObject::tr(}
\DoxyCodeLine{01775             \textcolor{stringliteral}{"{}The soundtrack \%1 already exists.\(\backslash\)nDo you want to overwrite it?"{}})}
\DoxyCodeLine{01776             .arg(toQString(fp));}
\DoxyCodeLine{01777     \textcolor{keywordtype}{int} ret = DVGui::MsgBox(question, QObject::tr(\textcolor{stringliteral}{"{}Overwrite"{}}),}
\DoxyCodeLine{01778                             QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}}), 0);}
\DoxyCodeLine{01779     \textcolor{keywordflow}{if} (ret == 2 || ret == 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01780   \}}
\DoxyCodeLine{01781   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{01782     sl-\/>save(fp);}
\DoxyCodeLine{01783   \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{01784     DVGui::error(QObject::tr(\textcolor{stringliteral}{"{}Couldn't save \%1"{}}).arg(toQString(fp)));}
\DoxyCodeLine{01785     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01786   \}}
\DoxyCodeLine{01787   QApplication::setOverrideCursor(Qt::WaitCursor);}
\DoxyCodeLine{01788   FileBrowser::refreshFolder(fp.\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}());}
\DoxyCodeLine{01789   History::instance()-\/>addItem(fp);}
\DoxyCodeLine{01790   QApplication::restoreOverrideCursor();}
\DoxyCodeLine{01791   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01792 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_a0d61d8a7c69ed6a011f7addd5adb1390}\label{namespace_io_cmd_a0d61d8a7c69ed6a011f7addd5adb1390}} 
\index{IoCmd@{IoCmd}!saveSound@{saveSound}}
\index{saveSound@{saveSound}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{saveSound()}{saveSound()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool Io\+Cmd\+::save\+Sound (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_xsh_sound_level}{TXsh\+Sound\+Level}} $\ast$}]{sc }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01798                                         \{}
\DoxyCodeLine{01799   \textcolor{keywordflow}{return} saveSound(sl-\/>getPath(), sl, \textcolor{keyword}{true});}
\DoxyCodeLine{01800 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_io_cmd_aa512f1a040d635719070d84e1fe4e733}\label{namespace_io_cmd_aa512f1a040d635719070d84e1fe4e733}} 
\index{IoCmd@{IoCmd}!takeCareSceneFolderItemsOnSaveSceneAs@{takeCareSceneFolderItemsOnSaveSceneAs}}
\index{takeCareSceneFolderItemsOnSaveSceneAs@{takeCareSceneFolderItemsOnSaveSceneAs}!IoCmd@{IoCmd}}
\doxysubsubsection{\texorpdfstring{takeCareSceneFolderItemsOnSaveSceneAs()}{takeCareSceneFolderItemsOnSaveSceneAs()}}
{\footnotesize\ttfamily bool Io\+Cmd\+::take\+Care\+Scene\+Folder\+Items\+On\+Save\+Scene\+As (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_toonz_scene}{Toonz\+Scene}} $\ast$}]{scene,  }\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{new\+Path,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{subxsh,  }\item[{QHash$<$ \mbox{\hyperlink{class_t_xsh_level}{TXsh\+Level}} $\ast$, \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} $>$ \&}]{org\+Level\+Paths }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02718                                                   \{}
\DoxyCodeLine{02719   \textcolor{keyword}{auto} setPathToLevel = [\&](\mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *level, \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp) \{}
\DoxyCodeLine{02720     \textcolor{comment}{// in case of saving subxsheet, the current scene will not be switched to}}
\DoxyCodeLine{02721     \textcolor{comment}{// the saved one}}
\DoxyCodeLine{02722     \textcolor{comment}{// so the level paths are needed to be reverted after saving}}
\DoxyCodeLine{02723     \textcolor{keywordflow}{if} (subxsh) orgLevelPaths.insert(level, level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}());}
\DoxyCodeLine{02724     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sil = level-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}())}
\DoxyCodeLine{02725       sil-\/>setPath(fp, \textcolor{keyword}{true});}
\DoxyCodeLine{02726     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_palette_level}{TXshPaletteLevel}} *pal = level-\/>\mbox{\hyperlink{class_t_xsh_level_afdbb7e1664b681225414f59317a32b74}{getPaletteLevel}}())}
\DoxyCodeLine{02727       pal-\/>setPath(fp);}
\DoxyCodeLine{02728     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_sound_level}{TXshSoundLevel}} *sol = level-\/>\mbox{\hyperlink{class_t_xsh_level_aa26f1638f7685304949b33befc0bfcc9}{getSoundLevel}}())}
\DoxyCodeLine{02729       sol-\/>setPath(fp);}
\DoxyCodeLine{02730   \};}
\DoxyCodeLine{02731 }
\DoxyCodeLine{02732   \mbox{\hyperlink{class_t_file_path}{TFilePath}} oldSceneFolder =}
\DoxyCodeLine{02733       scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(scene-\/>\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}()).getParentDir();}
\DoxyCodeLine{02734   \mbox{\hyperlink{class_t_file_path}{TFilePath}} newSceneFolder = scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(newPath).\mbox{\hyperlink{class_t_file_path_a1f5014e9c396bc2268820c19bc15657d}{getParentDir}}();}
\DoxyCodeLine{02735 }
\DoxyCodeLine{02736   \textcolor{comment}{// in case of saving in the same folder}}
\DoxyCodeLine{02737   \textcolor{keywordflow}{if} (oldSceneFolder == newSceneFolder) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02738 }
\DoxyCodeLine{02739   \mbox{\hyperlink{class_t_level_set}{TLevelSet}} *levelSet = scene-\/>\mbox{\hyperlink{class_toonz_scene_ac1a8bf0d2cec4f59c87b0001991264b5}{getLevelSet}}();}
\DoxyCodeLine{02740   std::vector<TXshLevel *> levels;}
\DoxyCodeLine{02741 }
\DoxyCodeLine{02742   \textcolor{comment}{// in case of saving subxsheet, checking only used levels.}}
\DoxyCodeLine{02743   \textcolor{keywordflow}{if} (subxsh) \{}
\DoxyCodeLine{02744     std::set<TXshLevel *> saveSet;}
\DoxyCodeLine{02745     subxsh-\/>\mbox{\hyperlink{class_t_xsheet_aa0e609bf07ee363201a184c3c7220348}{getUsedLevels}}(saveSet);}
\DoxyCodeLine{02746     levels = std::vector<TXshLevel *>(saveSet.begin(), saveSet.end());}
\DoxyCodeLine{02747   \}}
\DoxyCodeLine{02748   \textcolor{comment}{// in case of saving the scene (i.e. top xsheet)}}
\DoxyCodeLine{02749   \textcolor{keywordflow}{else}}
\DoxyCodeLine{02750     levelSet-\/>listLevels(levels);}
\DoxyCodeLine{02751 }
\DoxyCodeLine{02752   QList<TXshLevel *> sceneFolderLevels;}
\DoxyCodeLine{02753   QString str;}
\DoxyCodeLine{02754   \textcolor{keywordtype}{int} count = 0;}
\DoxyCodeLine{02755   \textcolor{keywordflow}{for} (\mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *level : levels) \{}
\DoxyCodeLine{02756     \textcolor{keywordflow}{if} (!level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}().isEmpty() \&\&}
\DoxyCodeLine{02757         \mbox{\hyperlink{class_t_file_path}{TFilePath}}(\textcolor{stringliteral}{"{}\$scenefolder"{}}).isAncestorOf(level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}())) \{}
\DoxyCodeLine{02758       \mbox{\hyperlink{class_t_file_path}{TFilePath}} levelFullPath = scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}());}
\DoxyCodeLine{02759       \textcolor{comment}{// check if the path can be re-\/coded with the new scene folder path}}
\DoxyCodeLine{02760       \textcolor{keywordflow}{if} (newSceneFolder.isAncestorOf(levelFullPath)) \{}
\DoxyCodeLine{02761         \textcolor{comment}{// just replace the path without warning}}
\DoxyCodeLine{02762         \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp =}
\DoxyCodeLine{02763             \mbox{\hyperlink{class_t_file_path}{TFilePath}}(\textcolor{stringliteral}{"{}\$scenefolder"{}}) + (levelFullPath -\/ newSceneFolder);}
\DoxyCodeLine{02764         setPathToLevel(level, fp);}
\DoxyCodeLine{02765       \}}
\DoxyCodeLine{02766       \textcolor{comment}{// if re-\/coding is not possible, then it needs to ask user's preference}}
\DoxyCodeLine{02767       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02768         sceneFolderLevels.append(level);}
\DoxyCodeLine{02769         \textcolor{keywordflow}{if} (count < 10) \{}
\DoxyCodeLine{02770           str.append(\textcolor{stringliteral}{"{}    "{}} + QString::fromStdWString(level-\/>\mbox{\hyperlink{class_t_xsh_level_a3a59fb1bd3261baee4e889a9edbf0ae8}{getName}}()) + \textcolor{stringliteral}{"{} ("{}} +}
\DoxyCodeLine{02771                      level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}().getQString() + \textcolor{stringliteral}{"{})\(\backslash\)n"{}});}
\DoxyCodeLine{02772         \}}
\DoxyCodeLine{02773         count++;}
\DoxyCodeLine{02774       \}}
\DoxyCodeLine{02775     \}}
\DoxyCodeLine{02776   \}}
\DoxyCodeLine{02777   \textcolor{comment}{// list maximum 10 levels}}
\DoxyCodeLine{02778   \textcolor{keywordflow}{if} (count > 10)}
\DoxyCodeLine{02779     str.append(QObject::tr(\textcolor{stringliteral}{"{}    + \%1 more level(s) \(\backslash\)n"{}}).arg(count -\/ 10));}
\DoxyCodeLine{02780 }
\DoxyCodeLine{02781   \textcolor{comment}{// in case there is no items with \$scenefolder}}
\DoxyCodeLine{02782   \textcolor{keywordflow}{if} (sceneFolderLevels.isEmpty()) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02783 }
\DoxyCodeLine{02784   str = QObject::tr(}
\DoxyCodeLine{02785             \textcolor{stringliteral}{"{}The following level(s) use path with \$scenefolder alias.\(\backslash\)n\(\backslash\)n"{}}) +}
\DoxyCodeLine{02786         str +}
\DoxyCodeLine{02787         QObject::tr(}
\DoxyCodeLine{02788             \textcolor{stringliteral}{"{}\(\backslash\)nThey will not be opened properly when you load the "{}}}
\DoxyCodeLine{02789             \textcolor{stringliteral}{"{}scene next time.\(\backslash\)nWhat do you want to do?"{}});}
\DoxyCodeLine{02790 }
\DoxyCodeLine{02791   \textcolor{keywordtype}{int} ret = DVGui::MsgBox(}
\DoxyCodeLine{02792       str, QObject::tr(\textcolor{stringliteral}{"{}Copy the levels to correspondent paths"{}}),}
\DoxyCodeLine{02793       QObject::tr(\textcolor{stringliteral}{"{}Decode all \$scenefolder aliases"{}}),}
\DoxyCodeLine{02794       QObject::tr(\textcolor{stringliteral}{"{}Save the scene only"{}}), QObject::tr(\textcolor{stringliteral}{"{}Cancel"{}}), 0);}
\DoxyCodeLine{02795   \textcolor{keywordflow}{if} (ret == 4 || ret == 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02796 }
\DoxyCodeLine{02797   \textcolor{keywordflow}{if} (ret == 1) \{  \textcolor{comment}{// copy the levels case}}
\DoxyCodeLine{02798     \textcolor{keyword}{enum} OVERWRITEPOLICY \{ ASK, YES\_FOR\_ALL, NO\_FOR\_ALL \} policy = ASK;}
\DoxyCodeLine{02799     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < sceneFolderLevels.size(); i++) \{}
\DoxyCodeLine{02800       \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *level = sceneFolderLevels.at(i);}
\DoxyCodeLine{02801       \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp     = level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}() -\/ \mbox{\hyperlink{class_t_file_path}{TFilePath}}(\textcolor{stringliteral}{"{}\$scenefolder"{}});}
\DoxyCodeLine{02802       fp               = fp.\mbox{\hyperlink{class_t_file_path_a09d12d68c4264183e0268dde6f592b2e}{withParentDir}}(newSceneFolder);}
\DoxyCodeLine{02803       \textcolor{comment}{// check the level existence}}
\DoxyCodeLine{02804       \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(fp)) \{}
\DoxyCodeLine{02805         \textcolor{keywordtype}{bool} overwrite = (policy == YES\_FOR\_ALL);}
\DoxyCodeLine{02806         \textcolor{keywordflow}{if} (policy == ASK) \{}
\DoxyCodeLine{02807           QString question =}
\DoxyCodeLine{02808               QObject::tr(}
\DoxyCodeLine{02809                   \textcolor{stringliteral}{"{}File \%1 already exists.\(\backslash\)nDo you want to overwrite it?"{}})}
\DoxyCodeLine{02810                   .arg(fp.getQString());}
\DoxyCodeLine{02811           \textcolor{keywordtype}{int} ret\_overwrite = DVGui::MsgBox(}
\DoxyCodeLine{02812               question, QObject::tr(\textcolor{stringliteral}{"{}Overwrite"{}}),}
\DoxyCodeLine{02813               QObject::tr(\textcolor{stringliteral}{"{}Overwrite for All"{}}), QObject::tr(\textcolor{stringliteral}{"{}Don't Overwrite"{}}),}
\DoxyCodeLine{02814               QObject::tr(\textcolor{stringliteral}{"{}Don't Overwrite for All"{}}), 0);}
\DoxyCodeLine{02815           \textcolor{keywordflow}{if} (ret\_overwrite == 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02816           \textcolor{keywordflow}{if} (ret\_overwrite == 1)}
\DoxyCodeLine{02817             overwrite = \textcolor{keyword}{true};}
\DoxyCodeLine{02818           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret\_overwrite == 2) \{}
\DoxyCodeLine{02819             overwrite = \textcolor{keyword}{true};}
\DoxyCodeLine{02820             policy    = YES\_FOR\_ALL;}
\DoxyCodeLine{02821           \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret\_overwrite == 4)}
\DoxyCodeLine{02822             policy = NO\_FOR\_ALL;}
\DoxyCodeLine{02823         \}}
\DoxyCodeLine{02824         \textcolor{keywordflow}{if} (!overwrite) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02825       \}}
\DoxyCodeLine{02826 }
\DoxyCodeLine{02827       \mbox{\hyperlink{class_t_file_path}{TFilePath}} srcFp = scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}());}
\DoxyCodeLine{02828       \textcolor{keywordflow}{if} (!TSystem::copyFileOrLevel(fp, srcFp))}
\DoxyCodeLine{02829         warning(QObject::tr(\textcolor{stringliteral}{"{}Failed to overwrite \%1"{}}).arg(fp.getQString()));}
\DoxyCodeLine{02830       \textcolor{comment}{// copy the palette as well}}
\DoxyCodeLine{02831       \textcolor{keywordflow}{if} (level-\/>\mbox{\hyperlink{class_t_xsh_level_a1a147f1e970a62120c0bbaf0020a8932}{getType}}() == TZP\_XSHLEVEL) \{}
\DoxyCodeLine{02832         \textcolor{keywordflow}{if} (!TSystem::copyFileOrLevel(fp.\mbox{\hyperlink{class_t_file_path_a1437b0e0720e9258b622f68b6858e95d}{withType}}(\textcolor{stringliteral}{"{}tpl"{}}),}
\DoxyCodeLine{02833                                       srcFp.\mbox{\hyperlink{class_t_file_path_a1437b0e0720e9258b622f68b6858e95d}{withType}}(\textcolor{stringliteral}{"{}tpl"{}})))}
\DoxyCodeLine{02834           warning(QObject::tr(\textcolor{stringliteral}{"{}Failed to overwrite \%1"{}})}
\DoxyCodeLine{02835                       .arg(fp.\mbox{\hyperlink{class_t_file_path_a1437b0e0720e9258b622f68b6858e95d}{withType}}(\textcolor{stringliteral}{"{}tpl"{}}).getQString()));}
\DoxyCodeLine{02836       \}}
\DoxyCodeLine{02837     \}}
\DoxyCodeLine{02838   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 2) \{  \textcolor{comment}{// decode \$scenefolder aliases case}}
\DoxyCodeLine{02839     Preferences::PathAliasPriority oldPriority =}
\DoxyCodeLine{02840         Preferences::instance()-\/>getPathAliasPriority();}
\DoxyCodeLine{02841     Preferences::instance()-\/>setValue(pathAliasPriority,}
\DoxyCodeLine{02842                                       Preferences::ProjectFolderOnly);}
\DoxyCodeLine{02843     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < sceneFolderLevels.size(); i++) \{}
\DoxyCodeLine{02844       \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *level = sceneFolderLevels.at(i);}
\DoxyCodeLine{02845 }
\DoxyCodeLine{02846       \textcolor{comment}{// decode and code again}}
\DoxyCodeLine{02847       \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp =}
\DoxyCodeLine{02848           scene-\/>\mbox{\hyperlink{class_toonz_scene_abb12422205be4336c3dee1aa5fbdc5e5}{codeFilePath}}(scene-\/>\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(level-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}()));}
\DoxyCodeLine{02849       setPathToLevel(level, fp);}
\DoxyCodeLine{02850     \}}
\DoxyCodeLine{02851     Preferences::instance()-\/>setValue(pathAliasPriority, oldPriority);}
\DoxyCodeLine{02852   \}}
\DoxyCodeLine{02853 }
\DoxyCodeLine{02854   \textcolor{comment}{// Save the scene only case (ret == 3), do nothing}}
\DoxyCodeLine{02855 }
\DoxyCodeLine{02856   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02857 \}}

\end{DoxyCode}
