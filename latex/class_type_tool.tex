\hypertarget{class_type_tool}{}\doxysection{Type\+Tool Class Reference}
\label{class_type_tool}\index{TypeTool@{TypeTool}}
Inheritance diagram for Type\+Tool\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_type_tool}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_type_tool_ac0f03fb8b3b8ae1c96a62b96f0ab725a}{update\+Translation}} () override
\item 
\mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} \mbox{\hyperlink{class_type_tool_a30b05f80f01908bd1ae7a5621dbce70d}{get\+Tool\+Type}} () const override
\item 
void \mbox{\hyperlink{class_type_tool_add6b2fd2b0496a8439cfd2918c0b1dfc}{init}} ()
\item 
void \mbox{\hyperlink{class_type_tool_ae7ebb535a5aa484de338087284f5dc49}{init\+Type\+Faces}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a84f5aa35a76c559b125f2dd60c917dde}{load\+Fonts}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a1e4f68ddb92d66bc679a1f2b887bbaf1}{set\+Font}} (std\+::wstring font\+Family)
\item 
void \mbox{\hyperlink{class_type_tool_a36107cb58d41f6f7fce55dbe0a948fa2}{set\+Typeface}} (std\+::wstring typeface)
\item 
void \mbox{\hyperlink{class_type_tool_add85e2fbfc26339b34ed4b7960a2003d}{set\+Size}} (std\+::wstring size)
\item 
void \mbox{\hyperlink{class_type_tool_a546cdbf138dada7a792035c82ea07574}{set\+Vertical}} (bool vertical)
\item 
void \mbox{\hyperlink{class_type_tool_a450218e776540a68485f6f535f11fc00}{draw}} () override
\begin{DoxyCompactList}\small\item\em Draws the tool on the viewer. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_type_tool_a4e0ffc0e1385d9e4dcfc0027178c140b}{update\+Mouse\+Cursor}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos)
\item 
void \mbox{\hyperlink{class_type_tool_a9736118616794b9d2ba56b135bdae286}{update\+Stroke\+Char}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a58eb6a89687836028abf3285eae6ad35}{update\+Char\+Positions}} (int update\+From=0)
\item 
void \mbox{\hyperlink{class_type_tool_abe47db70407a263f6c4d76f18067029f}{update\+Cursor\+Point}} ()
\item 
void \mbox{\hyperlink{class_type_tool_afa6fa7fc3e2c5d054fed986e95600fc7}{update\+Text\+Box}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a16f5734bc14edac2f1cc5e92cae8cd27}{set\+Cursor\+Index\+From\+Point}} (\mbox{\hyperlink{class_t_point_t}{TPointD}} point)
\item 
void \mbox{\hyperlink{class_type_tool_a0317c5da9dad8e8334c22ccb2512f2c4}{mouse\+Move}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
bool \mbox{\hyperlink{class_type_tool_af9b8c95ac03396fac616bb96abe535c7}{pre\+Left\+Button\+Down}} () override
\item 
void \mbox{\hyperlink{class_type_tool_a4b48f9671a88f7eb4bf287f1ed3e834f}{left\+Button\+Down}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
void \mbox{\hyperlink{class_type_tool_adf29ee5b52243c906894aaf5eb4feb80}{right\+Button\+Down}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
bool \mbox{\hyperlink{class_type_tool_a244a3359fc032f04421c7ced24a70415}{key\+Down}} (QKey\+Event $\ast$event) override
\item 
void \mbox{\hyperlink{class_type_tool_a70e3f06d5c97e0838bd0022f651dcf55}{on\+Input\+Text}} (std\+::wstring preedit, std\+::wstring commit, int replacement\+Start, int replacement\+Len) override
\item 
void \mbox{\hyperlink{class_type_tool_a96b53c2cd448d2157979929931e19b76}{replace\+Text}} (std\+::wstring text, int from, int to)
\item 
void \mbox{\hyperlink{class_type_tool_a7c850c86026c9825e0e0160fe8b2a323}{add\+Base\+Char}} (std\+::wstring text)
\item 
void \mbox{\hyperlink{class_type_tool_a2f9d1ab9b1bbcf27fc8555b50cb3c9f0}{add\+Return}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a3dbdf67c682dba22f6fa20eb68b69bfe}{cursor\+Up}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a5de2432a01d3a0e5018135e26088c5af}{cursor\+Down}} ()
\item 
void \mbox{\hyperlink{class_type_tool_af94aa9d80b217743a81fa25ba05c6b23}{cursor\+Left}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a2d7ff3deb7e6979e586071259f746a1c}{cursor\+Right}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a98bcfcc7efed416f05dc19ea3fc30240}{delete\+Key}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a01539b46a63185632f861ac2f720ee2b}{add\+Text\+To\+Image}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a0a704e9dd8eef4fd01538d7cd0baae13}{add\+Text\+To\+Vector\+Image}} (const \mbox{\hyperlink{class_t_vector_image_p}{TVector\+ImageP}} \&current\+Image, std\+::vector$<$ const \mbox{\hyperlink{class_t_vector_image}{TVector\+Image}} $\ast$ $>$ \&images)
\item 
void \mbox{\hyperlink{class_type_tool_a2b831db9c97bf4a6916156c5f34533ed}{add\+Text\+To\+Toonz\+Image}} (const \mbox{\hyperlink{class_t_toonz_image_p}{TToonz\+ImageP}} \&current\+Image)
\item 
void \mbox{\hyperlink{class_type_tool_af5a2342af561951b2d6a9e71f4f45a2b}{stop\+Editing}} ()
\item 
void \mbox{\hyperlink{class_type_tool_a2eecf8397ab238c07aea047b1fa6c146}{reset}} () override
\item 
void \mbox{\hyperlink{class_type_tool_a137705854f076124ac56fd8a109c2000}{on\+Activate}} () override
\begin{DoxyCompactList}\small\item\em Callback invoked whenever the tool activates. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_type_tool_adda740be6ec957288b8f7802deea8059}{on\+Deactivate}} () override
\begin{DoxyCompactList}\small\item\em Callback for tool deactivation, includes tool switch. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_type_tool_a67419064bd2d7fc33f110cf4799fc3ec}{on\+Image\+Changed}} () override
\begin{DoxyCompactList}\small\item\em Notifies changes in the image in use. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{class_type_tool_a2a37ceae24fed6c6fbce7b8b4e3ab951}{get\+Cursor\+Id}} () const override
\begin{DoxyCompactList}\small\item\em Returns the type of cursor used by the tool. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_type_tool_aedcc4b901393b4f61c380483d84b5f66}{on\+Property\+Changed}} (std\+::string property\+Name) override
\item 
\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ \mbox{\hyperlink{class_type_tool_afd23e1f7bb7eea33f8422321970309d0}{get\+Properties}} (int target\+Type) override
\item 
int \mbox{\hyperlink{class_type_tool_a1c7b7a854aaa5c73ecf97ae9691219c7}{get\+Color\+Class}} () const
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_type_tool_a13d8b210a6d6e443ac58b29c65e19e76}\label{class_type_tool_a13d8b210a6d6e443ac58b29c65e19e76}} 
\index{TypeTool@{TypeTool}!TypeTool@{TypeTool}}
\index{TypeTool@{TypeTool}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{TypeTool()}{TypeTool()}}
{\footnotesize\ttfamily Type\+Tool\+::\+Type\+Tool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00415     : \mbox{\hyperlink{class_t_tool_a9c63ec35f606e755d0d036bf4fed62ab}{TTool}}(\textcolor{stringliteral}{"{}T\_Type"{}})}
\DoxyCodeLine{00416     , m\_textBox(\mbox{\hyperlink{class_t_rect_t}{TRectD}}(0, 0, 0, 0))}
\DoxyCodeLine{00417     , m\_cursorPoint(\mbox{\hyperlink{class_t_point_t}{TPointD}}(0, 0))}
\DoxyCodeLine{00418     , m\_startPoint(\mbox{\hyperlink{class_t_point_t}{TPointD}}(0, 0))}
\DoxyCodeLine{00419     , m\_dimension(1)      \textcolor{comment}{// to be set the m\_size value on the first-\/click}}
\DoxyCodeLine{00420     , m\_validFonts(\textcolor{keyword}{true})  \textcolor{comment}{// false)}}
\DoxyCodeLine{00421     , m\_fontYOffset(0)}
\DoxyCodeLine{00422     , m\_cursorId(ToolCursor::CURSOR\_NO)}
\DoxyCodeLine{00423     , m\_pixelSize(1)}
\DoxyCodeLine{00424     , m\_cursorIndex(0)}
\DoxyCodeLine{00425     , m\_preeditRange(0, 0)}
\DoxyCodeLine{00426     , m\_isVertical(\textcolor{keyword}{false})}
\DoxyCodeLine{00427     , m\_initialized(\textcolor{keyword}{false})}
\DoxyCodeLine{00428     , m\_fontFamilyMenu(\textcolor{stringliteral}{"{}Font:"{}})                  \textcolor{comment}{// W\_ToolOptions\_FontName}}
\DoxyCodeLine{00429     , m\_typeFaceMenu(\textcolor{stringliteral}{"{}Style:"{}})                   \textcolor{comment}{// W\_ToolOptions\_TypeFace}}
\DoxyCodeLine{00430     , m\_vertical(\textcolor{stringliteral}{"{}Vertical Orientation"{}}, \textcolor{keyword}{false})  \textcolor{comment}{// W\_ToolOptions\_Vertical}}
\DoxyCodeLine{00431     , m\_size(\textcolor{stringliteral}{"{}Size:"{}})                            \textcolor{comment}{// W\_ToolOptions\_Size}}
\DoxyCodeLine{00432     , m\_undo(0) \{}
\DoxyCodeLine{00433   bind(\mbox{\hyperlink{class_t_tool_adf0ea3a7f9d003f761fe57638dd6eff4a6528d353c20fcbe8932de09845117046}{TTool::VectorImage}} | \mbox{\hyperlink{class_t_tool_adf0ea3a7f9d003f761fe57638dd6eff4a68b7e2c2f25d134cb0debc4548d23ce1}{TTool::ToonzImage}} | \mbox{\hyperlink{class_t_tool_adf0ea3a7f9d003f761fe57638dd6eff4a2c576a0d6f800899d7be1cfaceef4d12}{TTool::EmptyTarget}});}
\DoxyCodeLine{00434   m\_prop[0].\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_fontFamilyMenu);}
\DoxyCodeLine{00435   \textcolor{comment}{// Su mac non e' visibile il menu dello style perche' e' stato inserito nel}}
\DoxyCodeLine{00436   \textcolor{comment}{// nome}}
\DoxyCodeLine{00437   \textcolor{comment}{// della font.}}
\DoxyCodeLine{00438   \textcolor{comment}{//\#ifndef MACOSX}}
\DoxyCodeLine{00439   m\_prop[1].\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_typeFaceMenu);}
\DoxyCodeLine{00440   \textcolor{comment}{//\#endif}}
\DoxyCodeLine{00441   m\_prop[1].\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_size);}
\DoxyCodeLine{00442   m\_prop[1].\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_vertical);}
\DoxyCodeLine{00443   m\_vertical.setId(\textcolor{stringliteral}{"{}Orientation"{}});}
\DoxyCodeLine{00444   m\_fontFamilyMenu.setId(\textcolor{stringliteral}{"{}TypeFont"{}});}
\DoxyCodeLine{00445   m\_typeFaceMenu.setId(\textcolor{stringliteral}{"{}TypeStyle"{}});}
\DoxyCodeLine{00446   m\_size.setId(\textcolor{stringliteral}{"{}TypeSize"{}});}
\DoxyCodeLine{00447 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a1f1694b8bb2189693d80d1ef95ac42ab}\label{class_type_tool_a1f1694b8bb2189693d80d1ef95ac42ab}} 
\index{TypeTool@{TypeTool}!````~TypeTool@{$\sim$TypeTool}}
\index{````~TypeTool@{$\sim$TypeTool}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{$\sim$TypeTool()}{~TypeTool()}}
{\footnotesize\ttfamily Type\+Tool\+::$\sim$\+Type\+Tool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00451 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_type_tool_a7c850c86026c9825e0e0160fe8b2a323}\label{class_type_tool_a7c850c86026c9825e0e0160fe8b2a323}} 
\index{TypeTool@{TypeTool}!addBaseChar@{addBaseChar}}
\index{addBaseChar@{addBaseChar}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{addBaseChar()}{addBaseChar()}}
{\footnotesize\ttfamily void Type\+Tool\+::add\+Base\+Char (\begin{DoxyParamCaption}\item[{std\+::wstring}]{text }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01398                                           \{}
\DoxyCodeLine{01399   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{01400 }
\DoxyCodeLine{01401   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img      = \mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01402   \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti  = img;}
\DoxyCodeLine{01403   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img;}
\DoxyCodeLine{01404 }
\DoxyCodeLine{01405   \textcolor{keywordtype}{int} styleId = TTool::getApplication()-\/>getCurrentLevelStyleIndex();}
\DoxyCodeLine{01406   \mbox{\hyperlink{class_t_point_t}{TPoint}} adv;}
\DoxyCodeLine{01407   \mbox{\hyperlink{class_t_point_t}{TPointD}} d\_adv;}
\DoxyCodeLine{01408 }
\DoxyCodeLine{01409   \textcolor{keywordtype}{wchar\_t} character = text[0];}
\DoxyCodeLine{01410 }
\DoxyCodeLine{01411   \textcolor{keywordflow}{if} (vi) \{}
\DoxyCodeLine{01412     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} newVImage(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_vector_image}{TVectorImage}});}
\DoxyCodeLine{01413 }
\DoxyCodeLine{01414     \textcolor{keywordflow}{if} (instance-\/>hasKerning() \&\& (UINT)m\_cursorIndex < m\_string.size() \&\&}
\DoxyCodeLine{01415         !m\_string[m\_cursorIndex].isReturn())}
\DoxyCodeLine{01416       adv = instance-\/>drawChar(newVImage, character,}
\DoxyCodeLine{01417                                m\_string[m\_cursorIndex].m\_key);}
\DoxyCodeLine{01418     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01419       adv = instance-\/>drawChar(newVImage, character);}
\DoxyCodeLine{01420 }
\DoxyCodeLine{01421     newVImage-\/>transform(m\_scale);}
\DoxyCodeLine{01422     paintChar(newVImage, styleId);}
\DoxyCodeLine{01423     \textcolor{comment}{// if(isSketchStyle(styleId))}}
\DoxyCodeLine{01424     \textcolor{comment}{//    enableSketchStyle();}}
\DoxyCodeLine{01425 }
\DoxyCodeLine{01426     d\_adv = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}((\textcolor{keywordtype}{double})(adv.x), (\textcolor{keywordtype}{double})(adv.y));}
\DoxyCodeLine{01427 }
\DoxyCodeLine{01428     \textcolor{keywordflow}{if} ((UINT)m\_cursorIndex == m\_string.size())}
\DoxyCodeLine{01429       m\_string.push\_back(StrokeChar(newVImage, d\_adv.x, character, styleId));}
\DoxyCodeLine{01430     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01431       m\_string.insert(m\_string.begin() + m\_cursorIndex,}
\DoxyCodeLine{01432                       StrokeChar(newVImage, d\_adv.x, character, styleId));}
\DoxyCodeLine{01433   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ti) \{}
\DoxyCodeLine{01434     \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} newRasterCM;}
\DoxyCodeLine{01435     \mbox{\hyperlink{class_t_point_t}{TPoint}} p;}
\DoxyCodeLine{01436 }
\DoxyCodeLine{01437     \textcolor{keywordflow}{if} (instance-\/>hasKerning() \&\& (UINT)m\_cursorIndex < m\_string.size() \&\&}
\DoxyCodeLine{01438         !m\_string[m\_cursorIndex].isReturn())}
\DoxyCodeLine{01439       adv = instance-\/>drawChar((\mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} \&)newRasterCM, p, styleId,}
\DoxyCodeLine{01440                                (\textcolor{keywordtype}{wchar\_t})character,}
\DoxyCodeLine{01441                                (\textcolor{keywordtype}{wchar\_t})m\_string[m\_cursorIndex].m\_key);}
\DoxyCodeLine{01442     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01443       adv = instance-\/>drawChar((\mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} \&)newRasterCM, p, styleId,}
\DoxyCodeLine{01444                                (\textcolor{keywordtype}{wchar\_t})character, (\textcolor{keywordtype}{wchar\_t})0);}
\DoxyCodeLine{01445 }
\DoxyCodeLine{01446     \textcolor{comment}{// textImage-\/>transform(m\_scale);}}
\DoxyCodeLine{01447 }
\DoxyCodeLine{01448     d\_adv = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}((\textcolor{keywordtype}{double})(adv.x), (\textcolor{keywordtype}{double})(adv.y));}
\DoxyCodeLine{01449 }
\DoxyCodeLine{01450     \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} newTImage(}
\DoxyCodeLine{01451         \textcolor{keyword}{new} \mbox{\hyperlink{class_t_toonz_image}{TToonzImage}}(newRasterCM, newRasterCM-\/>getBounds()));}
\DoxyCodeLine{01452 }
\DoxyCodeLine{01453     \mbox{\hyperlink{class_t_palette}{TPalette}} *vPalette = img-\/>getPalette();}
\DoxyCodeLine{01454     assert(vPalette);}
\DoxyCodeLine{01455     newTImage-\/>setPalette(vPalette);}
\DoxyCodeLine{01456 }
\DoxyCodeLine{01457     \textcolor{comment}{// newTImage-\/>updateRGBM(newRasterCM-\/>getBounds(),vPalette);}}
\DoxyCodeLine{01458     \textcolor{comment}{// assert(0);}}
\DoxyCodeLine{01459 }
\DoxyCodeLine{01460     \textcolor{keywordflow}{if} ((UINT)m\_cursorIndex == m\_string.size())}
\DoxyCodeLine{01461       m\_string.push\_back(StrokeChar(newTImage, d\_adv.x, character, styleId));}
\DoxyCodeLine{01462     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01463       m\_string.insert(m\_string.begin() + m\_cursorIndex,}
\DoxyCodeLine{01464                       StrokeChar(newTImage, d\_adv.x, character, styleId));}
\DoxyCodeLine{01465   \}}
\DoxyCodeLine{01466 }
\DoxyCodeLine{01467   \textcolor{keywordflow}{if} (instance-\/>hasKerning() \&\& m\_cursorIndex > 0 \&\&}
\DoxyCodeLine{01468       !m\_string[m\_cursorIndex -\/ 1].isReturn()) \{}
\DoxyCodeLine{01469     adv   = instance-\/>getDistance(m\_string[m\_cursorIndex -\/ 1].m\_key, character);}
\DoxyCodeLine{01470     d\_adv = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}((\textcolor{keywordtype}{double})(adv.x), (\textcolor{keywordtype}{double})(adv.y));}
\DoxyCodeLine{01471     m\_string[m\_cursorIndex -\/ 1].m\_offset = d\_adv.x;}
\DoxyCodeLine{01472   \}}
\DoxyCodeLine{01473 }
\DoxyCodeLine{01474   m\_cursorIndex++;}
\DoxyCodeLine{01475   updateCharPositions(m\_cursorIndex -\/ 1);}
\DoxyCodeLine{01476   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01477 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a2f9d1ab9b1bbcf27fc8555b50cb3c9f0}\label{class_type_tool_a2f9d1ab9b1bbcf27fc8555b50cb3c9f0}} 
\index{TypeTool@{TypeTool}!addReturn@{addReturn}}
\index{addReturn@{addReturn}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{addReturn()}{addReturn()}}
{\footnotesize\ttfamily void Type\+Tool\+::add\+Return (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01382                          \{}
\DoxyCodeLine{01383   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_vector_image}{TVectorImage}});}
\DoxyCodeLine{01384   \textcolor{keywordflow}{if} ((UINT)m\_cursorIndex == m\_string.size())}
\DoxyCodeLine{01385     m\_string.push\_back(StrokeChar(vi, -\/1., (\textcolor{keywordtype}{int})(QChar(\textcolor{charliteral}{'\(\backslash\)r'}).unicode()), 0));}
\DoxyCodeLine{01386   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01387     m\_string.insert(m\_string.begin() + m\_cursorIndex,}
\DoxyCodeLine{01388                     StrokeChar(vi, -\/1., (\textcolor{keywordtype}{int})(QChar(\textcolor{charliteral}{'\(\backslash\)r'}).unicode()), 0));}
\DoxyCodeLine{01389 }
\DoxyCodeLine{01390   m\_cursorIndex++;}
\DoxyCodeLine{01391   m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01392   updateCharPositions(m\_cursorIndex -\/ 1);}
\DoxyCodeLine{01393   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01394 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a01539b46a63185632f861ac2f720ee2b}\label{class_type_tool_a01539b46a63185632f861ac2f720ee2b}} 
\index{TypeTool@{TypeTool}!addTextToImage@{addTextToImage}}
\index{addTextToImage@{addTextToImage}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{addTextToImage()}{addTextToImage()}}
{\footnotesize\ttfamily void Type\+Tool\+::add\+Text\+To\+Image (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01075                               \{}
\DoxyCodeLine{01076   \textcolor{keywordflow}{if} (!m\_validFonts) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01077   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{01078 }
\DoxyCodeLine{01079   UINT size = m\_string.size();}
\DoxyCodeLine{01080   \textcolor{keywordflow}{if} (size == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01081 }
\DoxyCodeLine{01082   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img      = \mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01083   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img;}
\DoxyCodeLine{01084   \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti  = img;}
\DoxyCodeLine{01085 }
\DoxyCodeLine{01086   \textcolor{keywordflow}{if} (!vi \&\& !ti) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01087 }
\DoxyCodeLine{01088   \textcolor{keywordflow}{if} (vi) \{}
\DoxyCodeLine{01089     QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{01090     std::vector<const TVectorImage *> images;}
\DoxyCodeLine{01091 }
\DoxyCodeLine{01092     UINT j;}
\DoxyCodeLine{01093     \textcolor{keywordflow}{for} (j = 0; j < size; j++) \{}
\DoxyCodeLine{01094       \textcolor{keywordflow}{if} (m\_string[j].isReturn()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01095 }
\DoxyCodeLine{01096       \mbox{\hyperlink{class_t_point_t}{TPoint}} descenderP(0, TFontManager::instance()-\/>getLineDescender());}
\DoxyCodeLine{01097       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = m\_string[j].m\_char) \{}
\DoxyCodeLine{01098         vi-\/>transform(}
\DoxyCodeLine{01099             \mbox{\hyperlink{class_t_translation}{TTranslation}}(convert(descenderP) + m\_string[j].m\_charPosition));}
\DoxyCodeLine{01100         \textcolor{keywordflow}{if} (instance-\/>hasVertical() \&\& m\_isVertical)}
\DoxyCodeLine{01101           vi-\/>transform(\mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_startPoint, -\/90));}
\DoxyCodeLine{01102         images.push\_back(vi.getPointer());}
\DoxyCodeLine{01103       \}}
\DoxyCodeLine{01104     \}}
\DoxyCodeLine{01105     addTextToVectorImage(vi, images);}
\DoxyCodeLine{01106   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ti)}
\DoxyCodeLine{01107     addTextToToonzImage(ti);}
\DoxyCodeLine{01108 }
\DoxyCodeLine{01109   \mbox{\hyperlink{class_t_tool_abd1824e9b49705c534e0a773305294c4}{notifyImageChanged}}();}
\DoxyCodeLine{01110   \textcolor{comment}{//  getApplication()-\/>notifyImageChanges();}}
\DoxyCodeLine{01111 }
\DoxyCodeLine{01112   m\_string.clear();}
\DoxyCodeLine{01113   m\_cursorIndex = 0;}
\DoxyCodeLine{01114   m\_textBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{01115 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a2b831db9c97bf4a6916156c5f34533ed}\label{class_type_tool_a2b831db9c97bf4a6916156c5f34533ed}} 
\index{TypeTool@{TypeTool}!addTextToToonzImage@{addTextToToonzImage}}
\index{addTextToToonzImage@{addTextToToonzImage}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{addTextToToonzImage()}{addTextToToonzImage()}}
{\footnotesize\ttfamily void Type\+Tool\+::add\+Text\+To\+Toonz\+Image (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_toonz_image_p}{TToonz\+ImageP}} \&}]{current\+Image }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01012                                                                    \{}
\DoxyCodeLine{01013   UINT size = m\_string.size();}
\DoxyCodeLine{01014   \textcolor{keywordflow}{if} (size == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01015 }
\DoxyCodeLine{01016   \textcolor{comment}{// TPalette *palette  = currentImage-\/>getPalette();}}
\DoxyCodeLine{01017   \textcolor{comment}{// currentImage-\/>lock();}}
\DoxyCodeLine{01018 }
\DoxyCodeLine{01019   \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} targetRaster = currentImage-\/>getRaster();}
\DoxyCodeLine{01020   \mbox{\hyperlink{class_t_rect_t}{TRect}} changedArea;}
\DoxyCodeLine{01021 }
\DoxyCodeLine{01022   UINT j;}
\DoxyCodeLine{01023   \textcolor{keywordflow}{for} (j = 0; j < size; j++) \{}
\DoxyCodeLine{01024     \textcolor{keywordflow}{if} (m\_string[j].isReturn()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01025 }
\DoxyCodeLine{01026     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti = m\_string[j].m\_char) \{}
\DoxyCodeLine{01027       \mbox{\hyperlink{class_t_rect_t}{TRectD}} srcBBox  = ti-\/>getBBox() + m\_string[j].m\_charPosition;}
\DoxyCodeLine{01028       \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}} dim = srcBBox.getSize();}
\DoxyCodeLine{01029       \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}} enlargeAmount(dim.lx * (m\_scale.a11 -\/ 1.0),}
\DoxyCodeLine{01030                                 dim.ly * (m\_scale.a22 -\/ 1.0));}
\DoxyCodeLine{01031       changedArea += ToonzImageUtils::convertWorldToRaster(}
\DoxyCodeLine{01032           srcBBox.enlarge(enlargeAmount), currentImage);}
\DoxyCodeLine{01033       \textcolor{comment}{/*}}
\DoxyCodeLine{01034 \textcolor{comment}{if( instance-\/>hasVertical() \&\& m\_isVertical)}}
\DoxyCodeLine{01035 \textcolor{comment}{vi-\/>transform( TRotation(m\_startPoint,-\/90) );}}
\DoxyCodeLine{01036 \textcolor{comment}{*/}}
\DoxyCodeLine{01037     \}}
\DoxyCodeLine{01038   \}}
\DoxyCodeLine{01039 }
\DoxyCodeLine{01040   \textcolor{keywordflow}{if} (!changedArea.\mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{isEmpty}}()) \{}
\DoxyCodeLine{01041     \mbox{\hyperlink{class_t_tile_set_c_m32}{TTileSetCM32}} *beforeTiles = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_tile_set_c_m32}{TTileSetCM32}}(targetRaster-\/>getSize());}
\DoxyCodeLine{01042     beforeTiles-\/>add(targetRaster, changedArea);}
\DoxyCodeLine{01043 }
\DoxyCodeLine{01044     \textcolor{keywordflow}{for} (j = 0; j < size; j++) \{}
\DoxyCodeLine{01045       \textcolor{keywordflow}{if} (m\_string[j].isReturn()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01046 }
\DoxyCodeLine{01047       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} srcTi = m\_string[j].m\_char) \{}
\DoxyCodeLine{01048         \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} srcRaster = srcTi-\/>getRaster();}
\DoxyCodeLine{01049         \mbox{\hyperlink{class_t_translation}{TTranslation}} transl2(m\_string[j].m\_charPosition +}
\DoxyCodeLine{01050                              convert(targetRaster-\/>getCenter()));}
\DoxyCodeLine{01051         \mbox{\hyperlink{namespace_t_rop_ae5fd1fb0c2f625e1da14fe92ae0e5122}{TRop::over}}(targetRaster, srcRaster, transl2 * m\_scale);}
\DoxyCodeLine{01052       \}}
\DoxyCodeLine{01053     \}}
\DoxyCodeLine{01054 }
\DoxyCodeLine{01055     \mbox{\hyperlink{class_t_tile_set_c_m32}{TTileSetCM32}} *afterTiles = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_tile_set_c_m32}{TTileSetCM32}}(targetRaster-\/>getSize());}
\DoxyCodeLine{01056     afterTiles-\/>add(targetRaster, changedArea);}
\DoxyCodeLine{01057 }
\DoxyCodeLine{01058     \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl =}
\DoxyCodeLine{01059         TTool::getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel();}
\DoxyCodeLine{01060     \mbox{\hyperlink{class_t_frame_id}{TFrameId}} \textcolor{keywordtype}{id} = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{01061 }
\DoxyCodeLine{01062     TUndoManager::manager()-\/>add(\textcolor{keyword}{new} RasterUndoTypeTool(}
\DoxyCodeLine{01063         beforeTiles, afterTiles, sl, \textcolor{keywordtype}{id}, \mbox{\hyperlink{class_t_tool_aabd06af7335f1ba0c96f36f1ac3e9976}{m\_isFrameCreated}}, \mbox{\hyperlink{class_t_tool_afec1db61477579b224321fd469e4ec00}{m\_isLevelCreated}}));}
\DoxyCodeLine{01064     \textcolor{keywordflow}{if} (m\_undo) \{}
\DoxyCodeLine{01065       \textcolor{keyword}{delete} m\_undo;}
\DoxyCodeLine{01066       m\_undo = 0;}
\DoxyCodeLine{01067     \}}
\DoxyCodeLine{01068 }
\DoxyCodeLine{01069     ToolUtils::updateSaveBox();}
\DoxyCodeLine{01070   \}}
\DoxyCodeLine{01071 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a0a704e9dd8eef4fd01538d7cd0baae13}\label{class_type_tool_a0a704e9dd8eef4fd01538d7cd0baae13}} 
\index{TypeTool@{TypeTool}!addTextToVectorImage@{addTextToVectorImage}}
\index{addTextToVectorImage@{addTextToVectorImage}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{addTextToVectorImage()}{addTextToVectorImage()}}
{\footnotesize\ttfamily void Type\+Tool\+::add\+Text\+To\+Vector\+Image (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_vector_image_p}{TVector\+ImageP}} \&}]{current\+Image,  }\item[{std\+::vector$<$ const \mbox{\hyperlink{class_t_vector_image}{TVector\+Image}} $\ast$ $>$ \&}]{images }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00979                                                                              \{}
\DoxyCodeLine{00980   UINT oldSize = currentImage-\/>getStrokeCount();}
\DoxyCodeLine{00981 }
\DoxyCodeLine{00982   std::vector<TFilledRegionInf> *fillInformationBefore =}
\DoxyCodeLine{00983       \textcolor{keyword}{new} std::vector<TFilledRegionInf>;}
\DoxyCodeLine{00984   ImageUtils::getFillingInformationOverlappingArea(}
\DoxyCodeLine{00985       currentImage, *fillInformationBefore, m\_textBox);}
\DoxyCodeLine{00986 }
\DoxyCodeLine{00987   currentImage-\/>mergeImage(images);}
\DoxyCodeLine{00988 }
\DoxyCodeLine{00989   std::vector<TFilledRegionInf> *fillInformationAfter =}
\DoxyCodeLine{00990       \textcolor{keyword}{new} std::vector<TFilledRegionInf>;}
\DoxyCodeLine{00991   ImageUtils::getFillingInformationOverlappingArea(}
\DoxyCodeLine{00992       currentImage, *fillInformationAfter, m\_textBox);}
\DoxyCodeLine{00993 }
\DoxyCodeLine{00994   UINT newSize = currentImage-\/>getStrokeCount();}
\DoxyCodeLine{00995 }
\DoxyCodeLine{00996   \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *level =}
\DoxyCodeLine{00997       TTool::getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel();}
\DoxyCodeLine{00998   UndoTypeTool *undo =}
\DoxyCodeLine{00999       \textcolor{keyword}{new} UndoTypeTool(fillInformationBefore, fillInformationAfter, level,}
\DoxyCodeLine{01000                        \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}(), \mbox{\hyperlink{class_t_tool_aabd06af7335f1ba0c96f36f1ac3e9976}{m\_isFrameCreated}}, \mbox{\hyperlink{class_t_tool_afec1db61477579b224321fd469e4ec00}{m\_isLevelCreated}});}
\DoxyCodeLine{01001 }
\DoxyCodeLine{01002   \textcolor{keywordflow}{for} (UINT j = oldSize; j < newSize; j++)}
\DoxyCodeLine{01003     undo-\/>addStroke(currentImage-\/>getStroke(j));}
\DoxyCodeLine{01004   TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{01005   \textcolor{keywordflow}{if} (m\_undo) \{}
\DoxyCodeLine{01006     \textcolor{keyword}{delete} m\_undo;}
\DoxyCodeLine{01007     m\_undo = 0;}
\DoxyCodeLine{01008   \}}
\DoxyCodeLine{01009 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a5de2432a01d3a0e5018135e26088c5af}\label{class_type_tool_a5de2432a01d3a0e5018135e26088c5af}} 
\index{TypeTool@{TypeTool}!cursorDown@{cursorDown}}
\index{cursorDown@{cursorDown}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{cursorDown()}{cursorDown()}}
{\footnotesize\ttfamily void Type\+Tool\+::cursor\+Down (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01487                           \{}
\DoxyCodeLine{01488   setCursorIndexFromPoint(m\_cursorPoint + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, -\/1.5 * m\_dimension));}
\DoxyCodeLine{01489 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_af94aa9d80b217743a81fa25ba05c6b23}\label{class_type_tool_af94aa9d80b217743a81fa25ba05c6b23}} 
\index{TypeTool@{TypeTool}!cursorLeft@{cursorLeft}}
\index{cursorLeft@{cursorLeft}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{cursorLeft()}{cursorLeft()}}
{\footnotesize\ttfamily void Type\+Tool\+::cursor\+Left (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01493                           \{}
\DoxyCodeLine{01494   \textcolor{keywordflow}{if} (TFontManager::instance()-\/>hasVertical()) \{}
\DoxyCodeLine{01495     m\_cursorPoint = \mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_startPoint, -\/90) * m\_cursorPoint;}
\DoxyCodeLine{01496     setCursorIndexFromPoint(m\_cursorPoint + \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/1.5 * m\_dimension, 0));}
\DoxyCodeLine{01497   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{01498     setCursorIndexFromPoint(m\_cursorPoint + \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/0.5 * m\_dimension, 0));}
\DoxyCodeLine{01499 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a2d7ff3deb7e6979e586071259f746a1c}\label{class_type_tool_a2d7ff3deb7e6979e586071259f746a1c}} 
\index{TypeTool@{TypeTool}!cursorRight@{cursorRight}}
\index{cursorRight@{cursorRight}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{cursorRight()}{cursorRight()}}
{\footnotesize\ttfamily void Type\+Tool\+::cursor\+Right (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01503                            \{}
\DoxyCodeLine{01504   \textcolor{keywordflow}{if} (TFontManager::instance()-\/>hasVertical()) \{}
\DoxyCodeLine{01505     m\_cursorPoint = \mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_startPoint, -\/90) * m\_cursorPoint;}
\DoxyCodeLine{01506     setCursorIndexFromPoint(m\_cursorPoint + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0.5 * m\_dimension, 0));}
\DoxyCodeLine{01507   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{01508     setCursorIndexFromPoint(m\_cursorPoint + \mbox{\hyperlink{class_t_point_t}{TPointD}}(1.5 * m\_dimension, 0));}
\DoxyCodeLine{01509 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a3dbdf67c682dba22f6fa20eb68b69bfe}\label{class_type_tool_a3dbdf67c682dba22f6fa20eb68b69bfe}} 
\index{TypeTool@{TypeTool}!cursorUp@{cursorUp}}
\index{cursorUp@{cursorUp}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{cursorUp()}{cursorUp()}}
{\footnotesize\ttfamily void Type\+Tool\+::cursor\+Up (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01481                         \{}
\DoxyCodeLine{01482   setCursorIndexFromPoint(m\_cursorPoint + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, 0.5 * m\_dimension));}
\DoxyCodeLine{01483 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a98bcfcc7efed416f05dc19ea3fc30240}\label{class_type_tool_a98bcfcc7efed416f05dc19ea3fc30240}} 
\index{TypeTool@{TypeTool}!deleteKey@{deleteKey}}
\index{deleteKey@{deleteKey}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{deleteKey()}{deleteKey()}}
{\footnotesize\ttfamily void Type\+Tool\+::delete\+Key (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01513                          \{}
\DoxyCodeLine{01514   \textcolor{keywordflow}{if} ((UINT)m\_cursorIndex >= m\_string.size()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01515   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{01516   m\_string.erase(m\_string.begin() + m\_cursorIndex);}
\DoxyCodeLine{01517 }
\DoxyCodeLine{01518   \textcolor{keywordflow}{if} (instance-\/>hasKerning() \&\& m\_cursorIndex > 0 \&\&}
\DoxyCodeLine{01519       !m\_string[m\_cursorIndex -\/ 1].isReturn()) \{}
\DoxyCodeLine{01520     \mbox{\hyperlink{class_t_point_t}{TPoint}} adv;}
\DoxyCodeLine{01521     \textcolor{keywordflow}{if} ((UINT)m\_cursorIndex < m\_string.size() \&\&}
\DoxyCodeLine{01522         !m\_string[m\_cursorIndex].isReturn()) \{}
\DoxyCodeLine{01523       adv = instance-\/>getDistance(m\_string[m\_cursorIndex -\/ 1].m\_key,}
\DoxyCodeLine{01524                                   m\_string[m\_cursorIndex].m\_key);}
\DoxyCodeLine{01525     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01526       adv = instance-\/>getDistance(m\_string[m\_cursorIndex -\/ 1].m\_key, 0);}
\DoxyCodeLine{01527     \}}
\DoxyCodeLine{01528     \mbox{\hyperlink{class_t_point_t}{TPointD}} d\_adv = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}((\textcolor{keywordtype}{double})(adv.x), (\textcolor{keywordtype}{double})(adv.y));}
\DoxyCodeLine{01529     m\_string[m\_cursorIndex -\/ 1].m\_offset = d\_adv.x;}
\DoxyCodeLine{01530   \}}
\DoxyCodeLine{01531   m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01532   updateCharPositions(m\_cursorIndex);}
\DoxyCodeLine{01533   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01534 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a450218e776540a68485f6f535f11fc00}\label{class_type_tool_a450218e776540a68485f6f535f11fc00}} 
\index{TypeTool@{TypeTool}!draw@{draw}}
\index{draw@{draw}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void Type\+Tool\+::draw (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Draws the tool on the viewer. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a058bf656d73bf3cd63b9826cbaaf48e0}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00887                     \{}
\DoxyCodeLine{00888   \textcolor{keywordflow}{if} (!m\_active || !\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false})) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00889 }
\DoxyCodeLine{00890   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00891 }
\DoxyCodeLine{00892   \textcolor{comment}{/*TAffine viewMatrix = getViewer()-\/>getViewMatrix();}}
\DoxyCodeLine{00893 \textcolor{comment}{glPushMatrix();}}
\DoxyCodeLine{00894 \textcolor{comment}{  tglMultMatrix(viewMatrix);*/}}
\DoxyCodeLine{00895 }
\DoxyCodeLine{00896   \textcolor{keywordflow}{if} (instance-\/>hasVertical() \&\& m\_isVertical) \{}
\DoxyCodeLine{00897     glPushMatrix();}
\DoxyCodeLine{00898     tglMultMatrix(\mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_startPoint, -\/90));}
\DoxyCodeLine{00899   \}}
\DoxyCodeLine{00900 }
\DoxyCodeLine{00901   \textcolor{comment}{// draw text}}
\DoxyCodeLine{00902   UINT size = m\_string.size();}
\DoxyCodeLine{00903 }
\DoxyCodeLine{00904   \mbox{\hyperlink{class_t_point_t}{TPoint}} descenderP(0, TFontManager::instance()-\/>getLineDescender());}
\DoxyCodeLine{00905 }
\DoxyCodeLine{00906   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < (int)size; j++) \{}
\DoxyCodeLine{00907     \textcolor{keywordflow}{if} (m\_string[j].isReturn()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00908 }
\DoxyCodeLine{00909     \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img = \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false}));}
\DoxyCodeLine{00910     assert(!!img);}
\DoxyCodeLine{00911     \textcolor{keywordflow}{if} (!img) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00912 }
\DoxyCodeLine{00913     \mbox{\hyperlink{class_t_palette}{TPalette}} *vPalette = img-\/>getPalette();}
\DoxyCodeLine{00914     assert(vPalette);}
\DoxyCodeLine{00915 }
\DoxyCodeLine{00916     \textcolor{keywordtype}{double} charWidth = 0;}
\DoxyCodeLine{00917     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = m\_string[j].m\_char) \{}
\DoxyCodeLine{00918       \mbox{\hyperlink{class_t_translation}{TTranslation}} transl(convert(descenderP) + m\_string[j].m\_charPosition);}
\DoxyCodeLine{00919       \textcolor{keyword}{const} \mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}} rd(transl, \mbox{\hyperlink{class_t_rect_t}{TRect}}(), vPalette, 0, \textcolor{keyword}{false});}
\DoxyCodeLine{00920       tglDraw(rd, vi.getPointer());}
\DoxyCodeLine{00921       charWidth = vi-\/>getBBox().getLx();}
\DoxyCodeLine{00922     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti = m\_string[j].m\_char) \{}
\DoxyCodeLine{00923       \mbox{\hyperlink{class_t_dimension_t}{TDimension}} dim = ti-\/>getSize();}
\DoxyCodeLine{00924       ti-\/>setPalette(vPalette);}
\DoxyCodeLine{00925 }
\DoxyCodeLine{00926       \mbox{\hyperlink{class_t_point_t}{TPoint}} rasterCenter(dim.lx / 2, dim.ly / 2);}
\DoxyCodeLine{00927       \mbox{\hyperlink{class_t_translation}{TTranslation}} transl1(convert(rasterCenter));}
\DoxyCodeLine{00928       \mbox{\hyperlink{class_t_translation}{TTranslation}} transl2(m\_string[j].m\_charPosition);}
\DoxyCodeLine{00929       GLRasterPainter::drawRaster(transl2 * m\_scale * transl1, ti, \textcolor{keyword}{false});}
\DoxyCodeLine{00930 }
\DoxyCodeLine{00931       \mbox{\hyperlink{class_t_point_t}{TPointD}} adjustedDim = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}(dim.lx, dim.ly);}
\DoxyCodeLine{00932       charWidth           = adjustedDim.x;}
\DoxyCodeLine{00933     \}}
\DoxyCodeLine{00934 }
\DoxyCodeLine{00935     \textcolor{comment}{// sottolineo i caratteri della preedit string}}
\DoxyCodeLine{00936     \textcolor{keywordflow}{if} (m\_preeditRange.first <= j \&\& j < m\_preeditRange.second) \{}
\DoxyCodeLine{00937       \mbox{\hyperlink{class_t_point_t}{TPointD}} a(m\_string[j].m\_charPosition);}
\DoxyCodeLine{00938       \mbox{\hyperlink{class_t_point_t}{TPointD}} b = a + \mbox{\hyperlink{class_t_point_t}{TPointD}}(charWidth, 0);}
\DoxyCodeLine{00939       glColor3d(1, 0, 0);}
\DoxyCodeLine{00940       tglDrawSegment(a, b);}
\DoxyCodeLine{00941     \}}
\DoxyCodeLine{00942   \}}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944   \textcolor{comment}{// draw textbox}}
\DoxyCodeLine{00945   \textcolor{keywordtype}{double} pixelSize = sqrt(tglGetPixelSize2());}
\DoxyCodeLine{00946   \textcolor{keywordflow}{if} (!isAlmostZero(pixelSize -\/ m\_pixelSize)) \{}
\DoxyCodeLine{00947     m\_textBox   = m\_textBox.enlarge((pixelSize -\/ m\_pixelSize) * cBorderSize);}
\DoxyCodeLine{00948     m\_pixelSize = pixelSize;}
\DoxyCodeLine{00949   \}}
\DoxyCodeLine{00950   TPixel32 boxColor = TPixel32::Black;}
\DoxyCodeLine{00951   ToolUtils::drawRect(m\_textBox, boxColor, 0x5555);}
\DoxyCodeLine{00952 }
\DoxyCodeLine{00953   \textcolor{keywordflow}{if} (m\_active) \{}
\DoxyCodeLine{00954     \textcolor{comment}{// draw cursor}}
\DoxyCodeLine{00955     tglColor(TPixel32::Black);}
\DoxyCodeLine{00956     \textcolor{keywordflow}{if} (!m\_isVertical || instance-\/>hasVertical())}
\DoxyCodeLine{00957       tglDrawSegment(m\_cursorPoint,}
\DoxyCodeLine{00958                      m\_cursorPoint + m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, -\/m\_dimension));}
\DoxyCodeLine{00959     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00960       tglDrawSegment(m\_cursorPoint,}
\DoxyCodeLine{00961                      m\_cursorPoint + m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}(m\_dimension, 0));}
\DoxyCodeLine{00962   \}}
\DoxyCodeLine{00963 }
\DoxyCodeLine{00964   \mbox{\hyperlink{class_t_point_t}{TPointD}} drawableCursor = m\_cursorPoint;}
\DoxyCodeLine{00965   \textcolor{keywordflow}{if} (instance-\/>hasVertical() \&\& m\_isVertical) \{}
\DoxyCodeLine{00966     drawableCursor = \mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_startPoint, -\/90) * drawableCursor;}
\DoxyCodeLine{00967     glPopMatrix();}
\DoxyCodeLine{00968   \}}
\DoxyCodeLine{00969 }
\DoxyCodeLine{00970   \textcolor{comment}{// glPopMatrix();}}
\DoxyCodeLine{00971 }
\DoxyCodeLine{00972   \textcolor{comment}{//  TPoint ipos = m\_viewer-\/>toolToMouse(drawableCursor);}}
\DoxyCodeLine{00973   \textcolor{comment}{//  setImePosition(ipos.x, ipos.y, (int)m\_dimension);}}
\DoxyCodeLine{00974 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00276}{TTool\+::get\+Image()}}.

\mbox{\Hypertarget{class_type_tool_a1c7b7a854aaa5c73ecf97ae9691219c7}\label{class_type_tool_a1c7b7a854aaa5c73ecf97ae9691219c7}} 
\index{TypeTool@{TypeTool}!getColorClass@{getColorClass}}
\index{getColorClass@{getColorClass}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{getColorClass()}{getColorClass()}}
{\footnotesize\ttfamily int Type\+Tool\+::get\+Color\+Class (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00404 \{ \textcolor{keywordflow}{return} 1; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a2a37ceae24fed6c6fbce7b8b4e3ab951}\label{class_type_tool_a2a37ceae24fed6c6fbce7b8b4e3ab951}} 
\index{TypeTool@{TypeTool}!getCursorId@{getCursorId}}
\index{getCursorId@{getCursorId}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{getCursorId()}{getCursorId()}}
{\footnotesize\ttfamily int Type\+Tool\+::get\+Cursor\+Id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Returns the type of cursor used by the tool. 

\begin{DoxySeeAlso}{See also}
For a list of cursor ids \mbox{\hyperlink{}{cursor.\+h}} 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{class_t_tool_a1768a57b8b6d1480618fd923fad15f1d}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00392                                    \{}
\DoxyCodeLine{00393     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}} \&\& \mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}}-\/>getGuidedStrokePickerMode())}
\DoxyCodeLine{00394       \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}}-\/>getGuidedStrokePickerCursor();}
\DoxyCodeLine{00395     \textcolor{keywordflow}{return} m\_cursorId;}
\DoxyCodeLine{00396   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00555}{TTool\+::m\+\_\+viewer}}.

\mbox{\Hypertarget{class_type_tool_afd23e1f7bb7eea33f8422321970309d0}\label{class_type_tool_afd23e1f7bb7eea33f8422321970309d0}} 
\index{TypeTool@{TypeTool}!getProperties@{getProperties}}
\index{getProperties@{getProperties}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{getProperties()}{getProperties()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ Type\+Tool\+::get\+Properties (\begin{DoxyParamCaption}\item[{int}]{target\+Type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00400                                                          \{}
\DoxyCodeLine{00401     \textcolor{keywordflow}{return} \&m\_prop[targetType];}
\DoxyCodeLine{00402   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a30b05f80f01908bd1ae7a5621dbce70d}\label{class_type_tool_a30b05f80f01908bd1ae7a5621dbce70d}} 
\index{TypeTool@{TypeTool}!getToolType@{getToolType}}
\index{getToolType@{getToolType}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{getToolType()}{getToolType()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} Type\+Tool\+::get\+Tool\+Type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00340 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296ca01ffd66b00b05a88c02ce8ceb5da3b8b}{TTool::LevelWriteTool}}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_add6b2fd2b0496a8439cfd2918c0b1dfc}\label{class_type_tool_add6b2fd2b0496a8439cfd2918c0b1dfc}} 
\index{TypeTool@{TypeTool}!init@{init}}
\index{init@{init}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily void Type\+Tool\+::init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00485                     \{}
\DoxyCodeLine{00486   \textcolor{keywordflow}{if} (m\_initialized) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00487   m\_initialized = \textcolor{keyword}{true};}
\DoxyCodeLine{00488 }
\DoxyCodeLine{00489   loadFonts();}
\DoxyCodeLine{00490   \textcolor{keywordflow}{if} (!m\_validFonts) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00491 }
\DoxyCodeLine{00492   m\_size.addValue(L\textcolor{stringliteral}{"{}36"{}});}
\DoxyCodeLine{00493   m\_size.addValue(L\textcolor{stringliteral}{"{}58"{}});}
\DoxyCodeLine{00494   m\_size.addValue(L\textcolor{stringliteral}{"{}70"{}});}
\DoxyCodeLine{00495   m\_size.addValue(L\textcolor{stringliteral}{"{}86"{}});}
\DoxyCodeLine{00496   m\_size.addValue(L\textcolor{stringliteral}{"{}100"{}});}
\DoxyCodeLine{00497   m\_size.addValue(L\textcolor{stringliteral}{"{}150"{}});}
\DoxyCodeLine{00498   m\_size.addValue(L\textcolor{stringliteral}{"{}200"{}});}
\DoxyCodeLine{00499   m\_size.setValue(L\textcolor{stringliteral}{"{}70"{}});}
\DoxyCodeLine{00500 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_ae7ebb535a5aa484de338087284f5dc49}\label{class_type_tool_ae7ebb535a5aa484de338087284f5dc49}} 
\index{TypeTool@{TypeTool}!initTypeFaces@{initTypeFaces}}
\index{initTypeFaces@{initTypeFaces}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{initTypeFaces()}{initTypeFaces()}}
{\footnotesize\ttfamily void Type\+Tool\+::init\+Type\+Faces (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00540                              \{}
\DoxyCodeLine{00541   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00542   std::vector<std::wstring> typefaces;}
\DoxyCodeLine{00543   instance-\/>getAllTypefaces(typefaces);}
\DoxyCodeLine{00544   std::wstring oldTypeface = m\_typeFaceMenu.getValue();}
\DoxyCodeLine{00545   m\_typeFaceMenu.deleteAllValues();}
\DoxyCodeLine{00546   \textcolor{keywordflow}{for} (std::vector<std::wstring>::iterator it = typefaces.begin();}
\DoxyCodeLine{00547        it != typefaces.end(); ++it)}
\DoxyCodeLine{00548     m\_typeFaceMenu.addValue(*it);}
\DoxyCodeLine{00549   \textcolor{keywordflow}{if} (m\_typeFaceMenu.isValue(oldTypeface)) m\_typeFaceMenu.setValue(oldTypeface);}
\DoxyCodeLine{00550 }
\DoxyCodeLine{00551   TTool::getApplication()-\/>getCurrentTool()-\/>notifyToolComboBoxListChanged(}
\DoxyCodeLine{00552       m\_typeFaceMenu.getName());}
\DoxyCodeLine{00553 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a244a3359fc032f04421c7ced24a70415}\label{class_type_tool_a244a3359fc032f04421c7ced24a70415}} 
\index{TypeTool@{TypeTool}!keyDown@{keyDown}}
\index{keyDown@{keyDown}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{keyDown()}{keyDown()}}
{\footnotesize\ttfamily bool Type\+Tool\+::key\+Down (\begin{DoxyParamCaption}\item[{QKey\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01538                                        \{}
\DoxyCodeLine{01539   QString text = \textcolor{keyword}{event}-\/>text();}
\DoxyCodeLine{01540   \textcolor{keywordflow}{if} ((event-\/>modifiers() \& Qt::ShiftModifier)) text = text.toUpper();}
\DoxyCodeLine{01541 }
\DoxyCodeLine{01542   \textcolor{keywordflow}{if} (QKeySequence(event-\/>key() + event-\/>modifiers()) == QKeySequence::Paste) \{}
\DoxyCodeLine{01543     QClipboard *clipboard     = QApplication::clipboard();}
\DoxyCodeLine{01544     \textcolor{keyword}{const} QMimeData *mimeData = clipboard-\/>mimeData();}
\DoxyCodeLine{01545     \textcolor{keywordflow}{if} (!mimeData-\/>hasText()) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01546     text = mimeData-\/>text().replace(\textcolor{charliteral}{'\(\backslash\)n'}, \textcolor{charliteral}{'\(\backslash\)r'});}
\DoxyCodeLine{01547   \}}
\DoxyCodeLine{01548 }
\DoxyCodeLine{01549   std::wstring unicodeChar = text.toStdWString();}
\DoxyCodeLine{01550 }
\DoxyCodeLine{01551   \textcolor{comment}{// return if only ALT, SHIFT or CTRL key is pressed}}
\DoxyCodeLine{01552   \textcolor{keywordflow}{if} (event-\/>modifiers() != Qt::NoModifier \&\& (unicodeChar.empty()))}
\DoxyCodeLine{01553     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01554 }
\DoxyCodeLine{01555   \textcolor{comment}{// per sicurezza}}
\DoxyCodeLine{01556   m\_preeditRange = std::make\_pair(0, 0);}
\DoxyCodeLine{01557 }
\DoxyCodeLine{01558   \textcolor{keywordflow}{if} (!m\_validFonts || !m\_active) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01559 }
\DoxyCodeLine{01560   \textcolor{keywordflow}{switch} (event-\/>key()) \{}
\DoxyCodeLine{01561   \textcolor{keywordflow}{case} Qt::Key\_Insert:}
\DoxyCodeLine{01562   \textcolor{keywordflow}{case} Qt::Key\_CapsLock:}
\DoxyCodeLine{01563     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01564 }
\DoxyCodeLine{01565   \textcolor{keywordflow}{case} Qt::Key\_Home:}
\DoxyCodeLine{01566   \textcolor{keywordflow}{case} Qt::Key\_PageUp:}
\DoxyCodeLine{01567     m\_cursorIndex  = 0;}
\DoxyCodeLine{01568     m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01569     updateCursorPoint();}
\DoxyCodeLine{01570     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01571     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01572 }
\DoxyCodeLine{01573   \textcolor{keywordflow}{case} Qt::Key\_End:}
\DoxyCodeLine{01574   \textcolor{keywordflow}{case} Qt::Key\_PageDown:}
\DoxyCodeLine{01575     m\_cursorIndex  = (int)m\_string.size();}
\DoxyCodeLine{01576     m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01577     updateCursorPoint();}
\DoxyCodeLine{01578     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01579     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01580 }
\DoxyCodeLine{01582   \textcolor{keywordflow}{case} Qt::Key\_Up:}
\DoxyCodeLine{01583     \textcolor{keywordflow}{if} (!m\_isVertical)}
\DoxyCodeLine{01584       cursorUp();}
\DoxyCodeLine{01585     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_cursorIndex > 0) \{}
\DoxyCodeLine{01586       m\_cursorIndex-\/-\/;}
\DoxyCodeLine{01587       m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01588     \}}
\DoxyCodeLine{01589     updateCursorPoint();}
\DoxyCodeLine{01590     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01591     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01592 }
\DoxyCodeLine{01593   \textcolor{keywordflow}{case} Qt::Key\_Down:}
\DoxyCodeLine{01594     \textcolor{keywordflow}{if} (!m\_isVertical)}
\DoxyCodeLine{01595       cursorDown();}
\DoxyCodeLine{01596     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((UINT)m\_cursorIndex < m\_string.size()) \{}
\DoxyCodeLine{01597       m\_cursorIndex++;}
\DoxyCodeLine{01598       m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01599     \}}
\DoxyCodeLine{01600     updateCursorPoint();}
\DoxyCodeLine{01601     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01602     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01603 }
\DoxyCodeLine{01604   \textcolor{keywordflow}{case} Qt::Key\_Left:}
\DoxyCodeLine{01605     \textcolor{keywordflow}{if} (m\_isVertical)}
\DoxyCodeLine{01606       cursorLeft();}
\DoxyCodeLine{01607     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_cursorIndex > 0) \{}
\DoxyCodeLine{01608       m\_cursorIndex-\/-\/;}
\DoxyCodeLine{01609       m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01610     \}}
\DoxyCodeLine{01611     updateCursorPoint();}
\DoxyCodeLine{01612     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01613     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01614 }
\DoxyCodeLine{01615   \textcolor{keywordflow}{case} Qt::Key\_Right:}
\DoxyCodeLine{01616     \textcolor{keywordflow}{if} (m\_isVertical)}
\DoxyCodeLine{01617       cursorRight();}
\DoxyCodeLine{01618     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((UINT)m\_cursorIndex < m\_string.size()) \{}
\DoxyCodeLine{01619       m\_cursorIndex++;}
\DoxyCodeLine{01620       m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01621     \}}
\DoxyCodeLine{01622     updateCursorPoint();}
\DoxyCodeLine{01623     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01624     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01625 }
\DoxyCodeLine{01627 }
\DoxyCodeLine{01628   \textcolor{keywordflow}{case} Qt::Key\_Escape:}
\DoxyCodeLine{01629     \mbox{\hyperlink{class_t_tool_a985d88ab04fc77b1ddca7ead95ab4884}{resetInputMethod}}();}
\DoxyCodeLine{01630     \textcolor{keywordflow}{if} (!m\_string.empty())}
\DoxyCodeLine{01631       addTextToImage();}
\DoxyCodeLine{01632     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01633       stopEditing();}
\DoxyCodeLine{01634     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01635 }
\DoxyCodeLine{01636   \textcolor{keywordflow}{case} Qt::Key\_Delete:}
\DoxyCodeLine{01637     deleteKey();}
\DoxyCodeLine{01638     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01639 }
\DoxyCodeLine{01640   \textcolor{keywordflow}{case} Qt::Key\_Backspace:}
\DoxyCodeLine{01641     \textcolor{keywordflow}{if} (m\_cursorIndex > 0) \{}
\DoxyCodeLine{01642       m\_cursorIndex-\/-\/;}
\DoxyCodeLine{01643       m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01644       deleteKey();}
\DoxyCodeLine{01645     \}}
\DoxyCodeLine{01646     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01647 }
\DoxyCodeLine{01648   \textcolor{keywordflow}{case} Qt::Key\_Return:}
\DoxyCodeLine{01649   \textcolor{keywordflow}{case} Qt::Key\_Enter:}
\DoxyCodeLine{01650     addReturn();}
\DoxyCodeLine{01651     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01652 }
\DoxyCodeLine{01653   \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01654     \textcolor{keywordflow}{if} (unicodeChar.empty()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01655     replaceText(unicodeChar, m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01656     \textcolor{keywordtype}{int} startIndex = m\_cursorIndex + 1;}
\DoxyCodeLine{01657     m\_cursorIndex += unicodeChar.size();}
\DoxyCodeLine{01658     m\_preeditRange = std::make\_pair(startIndex, m\_cursorIndex);}
\DoxyCodeLine{01659     updateCharPositions(startIndex -\/ 1);}
\DoxyCodeLine{01660   \}}
\DoxyCodeLine{01661 }
\DoxyCodeLine{01662   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01663   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01664 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a4b48f9671a88f7eb4bf287f1ed3e834f}\label{class_type_tool_a4b48f9671a88f7eb4bf287f1ed3e834f}} 
\index{TypeTool@{TypeTool}!leftButtonDown@{leftButtonDown}}
\index{leftButtonDown@{leftButtonDown}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDown()}{leftButtonDown()}}
{\footnotesize\ttfamily void Type\+Tool\+::left\+Button\+Down (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01214                                                                      \{}
\DoxyCodeLine{01215   TSelection::setCurrent(0);}
\DoxyCodeLine{01216 }
\DoxyCodeLine{01217   \textcolor{keywordflow}{if} (getViewer() \&\& getViewer()-\/>getGuidedStrokePickerMode()) \{}
\DoxyCodeLine{01218     getViewer()-\/>doPickGuideStroke(pos);}
\DoxyCodeLine{01219     \textcolor{keywordflow}{return};}
\DoxyCodeLine{01220   \}}
\DoxyCodeLine{01221 }
\DoxyCodeLine{01222   \textcolor{keywordflow}{if} (!m\_validFonts) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01223 }
\DoxyCodeLine{01224   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img      = \mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01225   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img;}
\DoxyCodeLine{01226   \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti  = img;}
\DoxyCodeLine{01227 }
\DoxyCodeLine{01228   \textcolor{keywordflow}{if} (!vi \&\& !ti) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01229 }
\DoxyCodeLine{01230   setSize(m\_size.getValue());}
\DoxyCodeLine{01231 }
\DoxyCodeLine{01232   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_tool_aabd06af7335f1ba0c96f36f1ac3e9976}{m\_isFrameCreated}}) \{}
\DoxyCodeLine{01233     \textcolor{keywordflow}{if} (vi)}
\DoxyCodeLine{01234       m\_undo = \textcolor{keyword}{new} UndoTypeTool(}
\DoxyCodeLine{01235           0, 0, getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel(),}
\DoxyCodeLine{01236           \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}(), \mbox{\hyperlink{class_t_tool_aabd06af7335f1ba0c96f36f1ac3e9976}{m\_isFrameCreated}}, \mbox{\hyperlink{class_t_tool_afec1db61477579b224321fd469e4ec00}{m\_isLevelCreated}});}
\DoxyCodeLine{01237     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01238       m\_undo = \textcolor{keyword}{new} RasterUndoTypeTool(}
\DoxyCodeLine{01239           0, 0, getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel(),}
\DoxyCodeLine{01240           \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}(), \mbox{\hyperlink{class_t_tool_aabd06af7335f1ba0c96f36f1ac3e9976}{m\_isFrameCreated}}, \mbox{\hyperlink{class_t_tool_afec1db61477579b224321fd469e4ec00}{m\_isLevelCreated}});}
\DoxyCodeLine{01241   \}}
\DoxyCodeLine{01242 }
\DoxyCodeLine{01243   \textcolor{comment}{//  closeImeWindow();}}
\DoxyCodeLine{01244   \textcolor{comment}{//  if(m\_viewer) m\_viewer-\/>enableIme(true);}}
\DoxyCodeLine{01245   m\_active = \textcolor{keyword}{true};}
\DoxyCodeLine{01246 }
\DoxyCodeLine{01247   \textcolor{keywordflow}{if} (!m\_string.empty()) \{}
\DoxyCodeLine{01248     \mbox{\hyperlink{class_t_point_t}{TPointD}} clickPoint =}
\DoxyCodeLine{01249         (TFontManager::instance()-\/>hasVertical() \&\& m\_isVertical)}
\DoxyCodeLine{01250             ? \mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_startPoint, 90) * pos}
\DoxyCodeLine{01251             : pos;}
\DoxyCodeLine{01252     \textcolor{keywordflow}{if} (m\_textBox.contains(clickPoint)) \{}
\DoxyCodeLine{01253       setCursorIndexFromPoint(pos);}
\DoxyCodeLine{01254       updateCursorPoint();}
\DoxyCodeLine{01255       \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01256       \textcolor{keywordflow}{return};}
\DoxyCodeLine{01257     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01258       \mbox{\hyperlink{class_t_tool_a985d88ab04fc77b1ddca7ead95ab4884}{resetInputMethod}}();}
\DoxyCodeLine{01259       addTextToImage();}
\DoxyCodeLine{01260     \}}
\DoxyCodeLine{01261   \}}
\DoxyCodeLine{01262 }
\DoxyCodeLine{01263   m\_startPoint = pos;}
\DoxyCodeLine{01264   updateTextBox();}
\DoxyCodeLine{01265   updateCursorPoint();}
\DoxyCodeLine{01266   updateMouseCursor(pos);}
\DoxyCodeLine{01267   \textcolor{comment}{//  enableShortcuts(false);}}
\DoxyCodeLine{01268   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01269 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a84f5aa35a76c559b125f2dd60c917dde}\label{class_type_tool_a84f5aa35a76c559b125f2dd60c917dde}} 
\index{TypeTool@{TypeTool}!loadFonts@{loadFonts}}
\index{loadFonts@{loadFonts}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{loadFonts()}{loadFonts()}}
{\footnotesize\ttfamily void Type\+Tool\+::load\+Fonts (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00504                          \{}
\DoxyCodeLine{00505   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00506   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00507     instance-\/>\mbox{\hyperlink{class_t_font_manager_a8533dfca2cd9f5000a677a12a0e422bf}{loadFontNames}}();}
\DoxyCodeLine{00508     m\_validFonts = \textcolor{keyword}{true};}
\DoxyCodeLine{00509   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_font_library_loading_error}{TFontLibraryLoadingError}} \&) \{}
\DoxyCodeLine{00510     m\_validFonts = \textcolor{keyword}{false};}
\DoxyCodeLine{00511     \textcolor{comment}{//    TMessage::error(toString(e.getMessage()));}}
\DoxyCodeLine{00512   \}}
\DoxyCodeLine{00513 }
\DoxyCodeLine{00514   \textcolor{keywordflow}{if} (!m\_validFonts) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00515 }
\DoxyCodeLine{00516   std::vector<std::wstring> names;}
\DoxyCodeLine{00517   instance-\/>getAllFamilies(names);}
\DoxyCodeLine{00518 }
\DoxyCodeLine{00519   \textcolor{keywordflow}{for} (std::vector<std::wstring>::iterator it = names.begin();}
\DoxyCodeLine{00520        it != names.end(); ++it)}
\DoxyCodeLine{00521     m\_fontFamilyMenu.addValue(*it);}
\DoxyCodeLine{00522 }
\DoxyCodeLine{00523   std::string favFontApp     = EnvCurrentFont;}
\DoxyCodeLine{00524   std::wstring favouriteFont = ::to\_wstring(favFontApp);}
\DoxyCodeLine{00525   \textcolor{keywordflow}{if} (m\_fontFamilyMenu.isValue(favouriteFont)) \{}
\DoxyCodeLine{00526     m\_fontFamilyMenu.setValue(favouriteFont);}
\DoxyCodeLine{00527     setFont(favouriteFont);}
\DoxyCodeLine{00528   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00529     setFont(m\_fontFamilyMenu.getValue());}
\DoxyCodeLine{00530   \}}
\DoxyCodeLine{00531 }
\DoxyCodeLine{00532   \textcolor{comment}{// not used for now}}
\DoxyCodeLine{00533   m\_scale = \mbox{\hyperlink{class_t_scale}{TScale}}();}
\DoxyCodeLine{00534   \textcolor{comment}{// m\_scale = TScale(m\_dimension /}}
\DoxyCodeLine{00535   \textcolor{comment}{// (double)(TFontManager::instance()-\/>getHeight()));}}
\DoxyCodeLine{00536 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a0317c5da9dad8e8334c22ccb2512f2c4}\label{class_type_tool_a0317c5da9dad8e8334c22ccb2512f2c4}} 
\index{TypeTool@{TypeTool}!mouseMove@{mouseMove}}
\index{mouseMove@{mouseMove}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{mouseMove()}{mouseMove()}}
{\footnotesize\ttfamily void Type\+Tool\+::mouse\+Move (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01199                                                                 \{}
\DoxyCodeLine{01200   updateMouseCursor(pos);}
\DoxyCodeLine{01201 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a137705854f076124ac56fd8a109c2000}\label{class_type_tool_a137705854f076124ac56fd8a109c2000}} 
\index{TypeTool@{TypeTool}!onActivate@{onActivate}}
\index{onActivate@{onActivate}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{onActivate()}{onActivate()}}
{\footnotesize\ttfamily void Type\+Tool\+::on\+Activate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback invoked whenever the tool activates. 



Reimplemented from \mbox{\hyperlink{class_t_tool_ac286a2681633b4db6106596b4f54e53b}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01698                           \{}
\DoxyCodeLine{01699   init();}
\DoxyCodeLine{01700   \textcolor{comment}{//  getApplication()-\/>editImage();}}
\DoxyCodeLine{01701   m\_string.clear();}
\DoxyCodeLine{01702   m\_textBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}(0, 0, 0, 0);}
\DoxyCodeLine{01703   m\_cursorIndex = 0;}
\DoxyCodeLine{01704 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_adda740be6ec957288b8f7802deea8059}\label{class_type_tool_adda740be6ec957288b8f7802deea8059}} 
\index{TypeTool@{TypeTool}!onDeactivate@{onDeactivate}}
\index{onDeactivate@{onDeactivate}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{onDeactivate()}{onDeactivate()}}
{\footnotesize\ttfamily void Type\+Tool\+::on\+Deactivate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for tool deactivation, includes tool switch. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a00fee58728c1e12fb50846f47d7e9f5e}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01708                             \{}
\DoxyCodeLine{01709   \mbox{\hyperlink{class_t_tool_a985d88ab04fc77b1ddca7ead95ab4884}{resetInputMethod}}();}
\DoxyCodeLine{01710   \textcolor{keywordflow}{if} (!m\_string.empty())}
\DoxyCodeLine{01711     addTextToImage();  \textcolor{comment}{// call internally stopEditing()}}
\DoxyCodeLine{01712   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01713     stopEditing();}
\DoxyCodeLine{01714 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00812}{TTool\+::reset\+Input\+Method()}}.

\mbox{\Hypertarget{class_type_tool_a67419064bd2d7fc33f110cf4799fc3ec}\label{class_type_tool_a67419064bd2d7fc33f110cf4799fc3ec}} 
\index{TypeTool@{TypeTool}!onImageChanged@{onImageChanged}}
\index{onImageChanged@{onImageChanged}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{onImageChanged()}{onImageChanged()}}
{\footnotesize\ttfamily void Type\+Tool\+::on\+Image\+Changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Notifies changes in the image in use. 



Reimplemented from \mbox{\hyperlink{class_t_tool_aaf1e021290e74c1b085e4b095668e1ed}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01726 \{ stopEditing(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a70e3f06d5c97e0838bd0022f651dcf55}\label{class_type_tool_a70e3f06d5c97e0838bd0022f651dcf55}} 
\index{TypeTool@{TypeTool}!onInputText@{onInputText}}
\index{onInputText@{onInputText}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{onInputText()}{onInputText()}}
{\footnotesize\ttfamily void Type\+Tool\+::on\+Input\+Text (\begin{DoxyParamCaption}\item[{std\+::wstring}]{preedit,  }\item[{std\+::wstring}]{commit,  }\item[{int}]{replacement\+Start,  }\item[{int}]{replacement\+Len }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01669                                                                      \{}
\DoxyCodeLine{01670   \textcolor{comment}{// butto la vecchia preedit string}}
\DoxyCodeLine{01671   m\_preeditRange.first  = std::max(0, m\_preeditRange.first);}
\DoxyCodeLine{01672   m\_preeditRange.second = std::min((\textcolor{keywordtype}{int})m\_string.size(), m\_preeditRange.second);}
\DoxyCodeLine{01673   \textcolor{keywordflow}{if} (m\_preeditRange.first < m\_preeditRange.second)}
\DoxyCodeLine{01674     m\_string.erase(m\_string.begin() + m\_preeditRange.first,}
\DoxyCodeLine{01675                    m\_string.begin() + m\_preeditRange.second);}
\DoxyCodeLine{01676 }
\DoxyCodeLine{01677   \textcolor{comment}{// inserisco la commit string}}
\DoxyCodeLine{01678   \textcolor{keywordtype}{int} stringLength = m\_string.size();}
\DoxyCodeLine{01679   \textcolor{keywordtype}{int} a = tcrop(m\_preeditRange.first + replacementStart, 0, stringLength);}
\DoxyCodeLine{01680   \textcolor{keywordtype}{int} b = tcrop(m\_preeditRange.first + replacementStart + replacementLen, a,}
\DoxyCodeLine{01681                 stringLength);}
\DoxyCodeLine{01682   replaceText(commit, a, b);}
\DoxyCodeLine{01683   \textcolor{keywordtype}{int} index = a + commit.length();}
\DoxyCodeLine{01684 }
\DoxyCodeLine{01685   \textcolor{comment}{// inserisco la nuova preedit string}}
\DoxyCodeLine{01686   \textcolor{keywordflow}{if} (preedit.length() > 0) replaceText(preedit, index, index);}
\DoxyCodeLine{01687   m\_preeditRange.first  = index;}
\DoxyCodeLine{01688   m\_preeditRange.second = index + preedit.length();}
\DoxyCodeLine{01689 }
\DoxyCodeLine{01690   \textcolor{comment}{// aggiorno la posizione del cursore}}
\DoxyCodeLine{01691   m\_cursorIndex = m\_preeditRange.second;}
\DoxyCodeLine{01692   updateCharPositions(a);}
\DoxyCodeLine{01693   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01694 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_aedcc4b901393b4f61c380483d84b5f66}\label{class_type_tool_aedcc4b901393b4f61c380483d84b5f66}} 
\index{TypeTool@{TypeTool}!onPropertyChanged@{onPropertyChanged}}
\index{onPropertyChanged@{onPropertyChanged}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{onPropertyChanged()}{onPropertyChanged()}}
{\footnotesize\ttfamily bool Type\+Tool\+::on\+Property\+Changed (\begin{DoxyParamCaption}\item[{std\+::string}]{property\+Name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

\begin{DoxyVerb} Does the tasks associated to changes in \p propertyName and returns \p
\end{DoxyVerb}
 true; Does the tasks associated to changes in {\ttfamily property\+Name} and returns {\ttfamily true}. 

Reimplemented from \mbox{\hyperlink{class_t_tool_a06694e0586f807c34b18e16341aa9ee2}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00464                                                        \{}
\DoxyCodeLine{00465   \textcolor{keywordflow}{if} (!m\_validFonts) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467   \textcolor{keywordflow}{if} (propertyName == m\_fontFamilyMenu.getName()) \{}
\DoxyCodeLine{00468     setFont(m\_fontFamilyMenu.getValue());}
\DoxyCodeLine{00469     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00470   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (propertyName == m\_typeFaceMenu.getName()) \{}
\DoxyCodeLine{00471     setTypeface(m\_typeFaceMenu.getValue());}
\DoxyCodeLine{00472     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00473   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (propertyName == m\_size.getName()) \{}
\DoxyCodeLine{00474     setSize(m\_size.getValue());}
\DoxyCodeLine{00475     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00476   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (propertyName == m\_vertical.getName()) \{}
\DoxyCodeLine{00477     setVertical(m\_vertical.getValue());}
\DoxyCodeLine{00478     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00479   \}}
\DoxyCodeLine{00480   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00481 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_af9b8c95ac03396fac616bb96abe535c7}\label{class_type_tool_af9b8c95ac03396fac616bb96abe535c7}} 
\index{TypeTool@{TypeTool}!preLeftButtonDown@{preLeftButtonDown}}
\index{preLeftButtonDown@{preLeftButtonDown}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{preLeftButtonDown()}{preLeftButtonDown()}}
{\footnotesize\ttfamily bool Type\+Tool\+::pre\+Left\+Button\+Down (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

This method is called before left\+Button\+Down() and can be used e.\+g. to create the image if needed. return true if the method execution can have changed the current tool 

Reimplemented from \mbox{\hyperlink{class_t_tool_a11d2c27110689caf7fa6f49519808073}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01205                                  \{}
\DoxyCodeLine{01206   \textcolor{keywordflow}{if} (getViewer() \&\& getViewer()-\/>getGuidedStrokePickerMode()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01207 }
\DoxyCodeLine{01208   \textcolor{keywordflow}{if} (m\_validFonts \&\& !m\_active) \mbox{\hyperlink{class_t_tool_a668ac4790094a864ba6e37bd902303f1}{touchImage}}();}
\DoxyCodeLine{01209   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01210 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00294}{TTool\+::touch\+Image()}}.

\mbox{\Hypertarget{class_type_tool_a96b53c2cd448d2157979929931e19b76}\label{class_type_tool_a96b53c2cd448d2157979929931e19b76}} 
\index{TypeTool@{TypeTool}!replaceText@{replaceText}}
\index{replaceText@{replaceText}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{replaceText()}{replaceText()}}
{\footnotesize\ttfamily void Type\+Tool\+::replace\+Text (\begin{DoxyParamCaption}\item[{std\+::wstring}]{text,  }\item[{int}]{from,  }\item[{int}]{to }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01289                                                             \{}
\DoxyCodeLine{01290   \textcolor{keywordtype}{int} stringLength = m\_string.size();}
\DoxyCodeLine{01291   from             = tcrop(from, 0, stringLength);}
\DoxyCodeLine{01292   to               = tcrop(to, from, stringLength);}
\DoxyCodeLine{01293 }
\DoxyCodeLine{01294   \textcolor{comment}{// cancello i vecchi caratteri}}
\DoxyCodeLine{01295   m\_string.erase(m\_string.begin() + from, m\_string.begin() + to);}
\DoxyCodeLine{01296 }
\DoxyCodeLine{01297   \textcolor{comment}{// aggiungo i nuovi}}
\DoxyCodeLine{01298   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{01299   \textcolor{keywordtype}{int} styleId            = TTool::getApplication()-\/>getCurrentLevelStyleIndex();}
\DoxyCodeLine{01300 }
\DoxyCodeLine{01301   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img      = \mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01302   \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti  = img;}
\DoxyCodeLine{01303   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img;}
\DoxyCodeLine{01304 }
\DoxyCodeLine{01305   \mbox{\hyperlink{class_t_point_t}{TPoint}} adv;}
\DoxyCodeLine{01306   \mbox{\hyperlink{class_t_point_t}{TPointD}} d\_adv;}
\DoxyCodeLine{01307 }
\DoxyCodeLine{01308   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < (\textcolor{keywordtype}{unsigned} int)text.size(); i++) \{}
\DoxyCodeLine{01309     \textcolor{keywordtype}{wchar\_t} character = text[i];}
\DoxyCodeLine{01310 }
\DoxyCodeLine{01311     \textcolor{comment}{// line break case. This can happen when pasting text including the line}}
\DoxyCodeLine{01312     \textcolor{comment}{// break}}
\DoxyCodeLine{01313     \textcolor{keywordflow}{if} (character == \textcolor{charliteral}{'\(\backslash\)r'}) \{}
\DoxyCodeLine{01314       \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_vector_image}{TVectorImage}});}
\DoxyCodeLine{01315       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = from + i;}
\DoxyCodeLine{01316       m\_string.insert(m\_string.begin() + index,}
\DoxyCodeLine{01317                       StrokeChar(vi, -\/1., (\textcolor{keywordtype}{int})(QChar(\textcolor{charliteral}{'\(\backslash\)r'}).unicode()), 0));}
\DoxyCodeLine{01318     \}}
\DoxyCodeLine{01319 }
\DoxyCodeLine{01320     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (vi) \{}
\DoxyCodeLine{01321       \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} characterImage(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_vector_image}{TVectorImage}}());}
\DoxyCodeLine{01322       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = from + i;}
\DoxyCodeLine{01323       \textcolor{comment}{// se il font ha kerning bisogna tenere conto del carattere successivo}}
\DoxyCodeLine{01324       \textcolor{comment}{// (se c'e' e non e' un CR) per calcolare correttamente la distanza adv}}
\DoxyCodeLine{01325       \mbox{\hyperlink{class_t_point_t}{TPoint}} adv;}
\DoxyCodeLine{01326       \textcolor{keywordflow}{if} (instance-\/>hasKerning() \&\& index < m\_string.size() \&\&}
\DoxyCodeLine{01327           !m\_string[index].isReturn())}
\DoxyCodeLine{01328         adv = instance-\/>drawChar(characterImage, character,}
\DoxyCodeLine{01329                                  m\_string[index].m\_key);}
\DoxyCodeLine{01330       \textcolor{keywordflow}{else}}
\DoxyCodeLine{01331         adv = instance-\/>drawChar(characterImage, character);}
\DoxyCodeLine{01332       \mbox{\hyperlink{class_t_point_t}{TPointD}} advD = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}(adv.x, adv.y);}
\DoxyCodeLine{01333 }
\DoxyCodeLine{01334       characterImage-\/>transform(m\_scale);}
\DoxyCodeLine{01335       \textcolor{comment}{// colora le aree chiuse}}
\DoxyCodeLine{01336       paintChar(characterImage, styleId);}
\DoxyCodeLine{01337 }
\DoxyCodeLine{01338       m\_string.insert(m\_string.begin() + index,}
\DoxyCodeLine{01339                       StrokeChar(characterImage, advD.x, character, styleId));}
\DoxyCodeLine{01340     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ti) \{}
\DoxyCodeLine{01341       \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} newRasterCM;}
\DoxyCodeLine{01342       \mbox{\hyperlink{class_t_point_t}{TPoint}} p;}
\DoxyCodeLine{01343       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = from + i;}
\DoxyCodeLine{01344 }
\DoxyCodeLine{01345       \textcolor{keywordflow}{if} (instance-\/>hasKerning() \&\& (UINT)m\_cursorIndex < m\_string.size() \&\&}
\DoxyCodeLine{01346           index < m\_string.size() -\/ 1 \&\& !m\_string[index].isReturn())}
\DoxyCodeLine{01347         adv = instance-\/>drawChar((\mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} \&)newRasterCM, p, styleId,}
\DoxyCodeLine{01348                                  (\textcolor{keywordtype}{wchar\_t})character,}
\DoxyCodeLine{01349                                  (\textcolor{keywordtype}{wchar\_t})m\_string[index].m\_key);}
\DoxyCodeLine{01350       \textcolor{keywordflow}{else}}
\DoxyCodeLine{01351         adv = instance-\/>drawChar((\mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} \&)newRasterCM, p, styleId,}
\DoxyCodeLine{01352                                  (\textcolor{keywordtype}{wchar\_t})character, (\textcolor{keywordtype}{wchar\_t})0);}
\DoxyCodeLine{01353 }
\DoxyCodeLine{01354       d\_adv = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}((\textcolor{keywordtype}{double})(adv.x), (\textcolor{keywordtype}{double})(adv.y));}
\DoxyCodeLine{01355 }
\DoxyCodeLine{01356       \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} newTImage(}
\DoxyCodeLine{01357           \textcolor{keyword}{new} \mbox{\hyperlink{class_t_toonz_image}{TToonzImage}}(newRasterCM, newRasterCM-\/>getBounds()));}
\DoxyCodeLine{01358 }
\DoxyCodeLine{01359       \mbox{\hyperlink{class_t_palette}{TPalette}} *vPalette = img-\/>getPalette();}
\DoxyCodeLine{01360       assert(vPalette);}
\DoxyCodeLine{01361       newTImage-\/>setPalette(vPalette);}
\DoxyCodeLine{01362 }
\DoxyCodeLine{01363       m\_string.insert(m\_string.begin() + index,}
\DoxyCodeLine{01364                       StrokeChar(newTImage, d\_adv.x, character, styleId));}
\DoxyCodeLine{01365     \}}
\DoxyCodeLine{01366   \}}
\DoxyCodeLine{01367 }
\DoxyCodeLine{01368   \textcolor{comment}{// se necessario ricalcolo il kerning del carattere precedente}}
\DoxyCodeLine{01369   \textcolor{comment}{// all'inserimento/cancellazione}}
\DoxyCodeLine{01370   \textcolor{keywordflow}{if} (instance-\/>hasKerning() \&\& from -\/ 1 >= 0 \&\&}
\DoxyCodeLine{01371       !m\_string[from -\/ 1].isReturn() \&\& from < (\textcolor{keywordtype}{int})m\_string.size() \&\&}
\DoxyCodeLine{01372       !m\_string[from].isReturn()) \{}
\DoxyCodeLine{01373     \mbox{\hyperlink{class_t_point_t}{TPoint}} adv =}
\DoxyCodeLine{01374         instance-\/>getDistance(m\_string[from -\/ 1].m\_key, m\_string[from].m\_key);}
\DoxyCodeLine{01375     \mbox{\hyperlink{class_t_point_t}{TPointD}} advD = m\_scale * \mbox{\hyperlink{class_t_point_t}{TPointD}}((\textcolor{keywordtype}{double})(adv.x), (\textcolor{keywordtype}{double})(adv.y));}
\DoxyCodeLine{01376     m\_string[from -\/ 1].m\_offset = advD.x;}
\DoxyCodeLine{01377   \}}
\DoxyCodeLine{01378 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a2eecf8397ab238c07aea047b1fa6c146}\label{class_type_tool_a2eecf8397ab238c07aea047b1fa6c146}} 
\index{TypeTool@{TypeTool}!reset@{reset}}
\index{reset@{reset}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily void Type\+Tool\+::reset (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01718                      \{}
\DoxyCodeLine{01719   m\_string.clear();}
\DoxyCodeLine{01720   m\_textBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}(0, 0, 0, 0);}
\DoxyCodeLine{01721   m\_cursorIndex = 0;}
\DoxyCodeLine{01722 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_adf29ee5b52243c906894aaf5eb4feb80}\label{class_type_tool_adf29ee5b52243c906894aaf5eb4feb80}} 
\index{TypeTool@{TypeTool}!rightButtonDown@{rightButtonDown}}
\index{rightButtonDown@{rightButtonDown}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{rightButtonDown()}{rightButtonDown()}}
{\footnotesize\ttfamily void Type\+Tool\+::right\+Button\+Down (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01273                                                                       \{}
\DoxyCodeLine{01274   \textcolor{keywordflow}{if} (!m\_validFonts) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01275 }
\DoxyCodeLine{01276   \textcolor{keywordflow}{if} (!m\_string.empty())}
\DoxyCodeLine{01277     addTextToImage();}
\DoxyCodeLine{01278   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01279     stopEditing();}
\DoxyCodeLine{01280   m\_cursorIndex = 0;}
\DoxyCodeLine{01281   updateMouseCursor(pos);}
\DoxyCodeLine{01282   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{01283 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a16f5734bc14edac2f1cc5e92cae8cd27}\label{class_type_tool_a16f5734bc14edac2f1cc5e92cae8cd27}} 
\index{TypeTool@{TypeTool}!setCursorIndexFromPoint@{setCursorIndexFromPoint}}
\index{setCursorIndexFromPoint@{setCursorIndexFromPoint}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{setCursorIndexFromPoint()}{setCursorIndexFromPoint()}}
{\footnotesize\ttfamily void Type\+Tool\+::set\+Cursor\+Index\+From\+Point (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_point_t}{TPointD}}}]{point }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01119                                                     \{}
\DoxyCodeLine{01120   UINT size = m\_string.size();}
\DoxyCodeLine{01121   \textcolor{keywordtype}{int} line  = 0;}
\DoxyCodeLine{01122   \textcolor{keywordtype}{int} retNum;}
\DoxyCodeLine{01123 }
\DoxyCodeLine{01124   \textcolor{keywordflow}{if} (!m\_isVertical)}
\DoxyCodeLine{01125     retNum =}
\DoxyCodeLine{01126         tround((m\_startPoint.y + m\_dimension -\/ point.y) / m\_dimension -\/ 0.5);}
\DoxyCodeLine{01127   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01128     retNum = tround((m\_startPoint.x -\/ point.x) / m\_dimension + 0.5);}
\DoxyCodeLine{01129 }
\DoxyCodeLine{01130   UINT j = 0;}
\DoxyCodeLine{01131 }
\DoxyCodeLine{01132   \textcolor{keywordflow}{for} (; line < retNum \&\& j < size; j++)}
\DoxyCodeLine{01133     \textcolor{keywordflow}{if} (m\_string[j].isReturn()) line++;}
\DoxyCodeLine{01134 }
\DoxyCodeLine{01135   \textcolor{keywordflow}{if} (j == size) \{}
\DoxyCodeLine{01136     m\_cursorIndex  = size;}
\DoxyCodeLine{01137     m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01138     \textcolor{keywordflow}{return};}
\DoxyCodeLine{01139   \}}
\DoxyCodeLine{01140 }
\DoxyCodeLine{01141   \textcolor{keywordtype}{double} currentDispl = !m\_isVertical ? m\_startPoint.x : m\_startPoint.y;}
\DoxyCodeLine{01142 }
\DoxyCodeLine{01143   \textcolor{keywordflow}{for} (; j < size; j++) \{}
\DoxyCodeLine{01144     \textcolor{keywordflow}{if} (m\_string[j].isReturn()) \{}
\DoxyCodeLine{01145       m\_cursorIndex  = j;}
\DoxyCodeLine{01146       m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01147       \textcolor{keywordflow}{return};}
\DoxyCodeLine{01148     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01149       \textcolor{keywordflow}{if} (!m\_isVertical) \{}
\DoxyCodeLine{01150         currentDispl += m\_string[j].m\_offset;}
\DoxyCodeLine{01151 }
\DoxyCodeLine{01152         \textcolor{keywordflow}{if} (currentDispl > point.x) \{}
\DoxyCodeLine{01153           \textcolor{keywordflow}{if} (fabs(currentDispl -\/ m\_string[j].m\_offset -\/ point.x) <}
\DoxyCodeLine{01154               fabs(currentDispl -\/ point.x))}
\DoxyCodeLine{01155             m\_cursorIndex = j;}
\DoxyCodeLine{01156           \textcolor{keywordflow}{else}}
\DoxyCodeLine{01157             m\_cursorIndex = j + 1;}
\DoxyCodeLine{01158           m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01159           \textcolor{keywordflow}{return};}
\DoxyCodeLine{01160         \}}
\DoxyCodeLine{01161       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01162         \textcolor{keywordflow}{if} (!TFontManager::instance()-\/>hasVertical()) \{}
\DoxyCodeLine{01163           currentDispl -\/= m\_dimension;}
\DoxyCodeLine{01164           \textcolor{keywordflow}{if} (currentDispl < point.y) \{}
\DoxyCodeLine{01165             \textcolor{keywordflow}{if} (fabs(currentDispl + m\_dimension -\/ point.y) <}
\DoxyCodeLine{01166                 fabs(currentDispl -\/ point.y))}
\DoxyCodeLine{01167               m\_cursorIndex = j;}
\DoxyCodeLine{01168             \textcolor{keywordflow}{else}}
\DoxyCodeLine{01169               m\_cursorIndex = j + 1;}
\DoxyCodeLine{01170             m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01171             \textcolor{keywordflow}{return};}
\DoxyCodeLine{01172           \}}
\DoxyCodeLine{01173         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01174           currentDispl -\/= m\_string[j].m\_offset;}
\DoxyCodeLine{01175 }
\DoxyCodeLine{01176           \textcolor{keywordflow}{if} (currentDispl < point.y) \{}
\DoxyCodeLine{01177             \textcolor{keywordflow}{if} (fabs(currentDispl + m\_string[j].m\_offset -\/ point.y) <}
\DoxyCodeLine{01178                 fabs(currentDispl -\/ point.y))}
\DoxyCodeLine{01179               m\_cursorIndex = j;}
\DoxyCodeLine{01180             \textcolor{keywordflow}{else}}
\DoxyCodeLine{01181               m\_cursorIndex = j + 1;}
\DoxyCodeLine{01182             m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01183             \textcolor{keywordflow}{return};}
\DoxyCodeLine{01184           \}}
\DoxyCodeLine{01185         \}}
\DoxyCodeLine{01186       \}}
\DoxyCodeLine{01187     \}}
\DoxyCodeLine{01188   \}}
\DoxyCodeLine{01189 }
\DoxyCodeLine{01190   \textcolor{keywordflow}{if} (j == size) \{}
\DoxyCodeLine{01191     m\_cursorIndex  = j;}
\DoxyCodeLine{01192     m\_preeditRange = std::make\_pair(m\_cursorIndex, m\_cursorIndex);}
\DoxyCodeLine{01193     \textcolor{keywordflow}{return};}
\DoxyCodeLine{01194   \}}
\DoxyCodeLine{01195 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a1e4f68ddb92d66bc679a1f2b887bbaf1}\label{class_type_tool_a1e4f68ddb92d66bc679a1f2b887bbaf1}} 
\index{TypeTool@{TypeTool}!setFont@{setFont}}
\index{setFont@{setFont}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{setFont()}{setFont()}}
{\footnotesize\ttfamily void Type\+Tool\+::set\+Font (\begin{DoxyParamCaption}\item[{std\+::wstring}]{font\+Family }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00557                                         \{}
\DoxyCodeLine{00558   \textcolor{keywordflow}{if} (m\_fontFamily == family) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00559   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00560   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00561     instance-\/>\mbox{\hyperlink{class_t_font_manager_ac0a472d91dbb94acbeea1c207ab0b71a}{setFamily}}(family);}
\DoxyCodeLine{00562 }
\DoxyCodeLine{00563     m\_fontFamily             = family;}
\DoxyCodeLine{00564     std::wstring oldTypeface = m\_typeFaceMenu.getValue();}
\DoxyCodeLine{00565     initTypeFaces();}
\DoxyCodeLine{00566     \textcolor{keywordflow}{if} (oldTypeface != m\_typeFaceMenu.getValue()) \{}
\DoxyCodeLine{00567       \textcolor{keywordflow}{if} (m\_typeFaceMenu.isValue(L\textcolor{stringliteral}{"{}Regular"{}})) \{}
\DoxyCodeLine{00568         m\_typeFaceMenu.setValue(L\textcolor{stringliteral}{"{}Regular"{}});}
\DoxyCodeLine{00569         m\_typeface = L\textcolor{stringliteral}{"{}Regular"{}};}
\DoxyCodeLine{00570         instance-\/>\mbox{\hyperlink{class_t_font_manager_a62823c79842c16891b8db8cd07c0c36b}{setTypeface}}(L\textcolor{stringliteral}{"{}Regular"{}});}
\DoxyCodeLine{00571       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00572         m\_typeface = m\_typeFaceMenu.getValue();}
\DoxyCodeLine{00573         instance-\/>\mbox{\hyperlink{class_t_font_manager_a62823c79842c16891b8db8cd07c0c36b}{setTypeface}}(m\_typeface);}
\DoxyCodeLine{00574       \}}
\DoxyCodeLine{00575     \}}
\DoxyCodeLine{00576 }
\DoxyCodeLine{00577     \textcolor{comment}{// assert chiaramente vero se oldTypeface!=m\_typeFaceMenu.getValue().}}
\DoxyCodeLine{00578     \textcolor{comment}{// Assume che il TFontManager quando cambia family, si ricordi}}
\DoxyCodeLine{00579     \textcolor{comment}{// il vecchio typeface e lo imposti se anche la nuova family lo ha}}
\DoxyCodeLine{00580     assert(instance-\/>getCurrentTypeface() == m\_typeFaceMenu.getValue());}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582     updateStrokeChar();}
\DoxyCodeLine{00583     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00584     EnvCurrentFont = ::to\_string(m\_fontFamily);}
\DoxyCodeLine{00585   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_font_creation_error}{TFontCreationError}} \&) \{}
\DoxyCodeLine{00586     \textcolor{comment}{//    TMessage::error(toString(e.getMessage()));}}
\DoxyCodeLine{00587     assert(m\_fontFamily == instance-\/>getCurrentFamily());}
\DoxyCodeLine{00588     m\_fontFamilyMenu.setValue(m\_fontFamily);}
\DoxyCodeLine{00589   \}}
\DoxyCodeLine{00590 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_add85e2fbfc26339b34ed4b7960a2003d}\label{class_type_tool_add85e2fbfc26339b34ed4b7960a2003d}} 
\index{TypeTool@{TypeTool}!setSize@{setSize}}
\index{setSize@{setSize}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{setSize()}{setSize()}}
{\footnotesize\ttfamily void Type\+Tool\+::set\+Size (\begin{DoxyParamCaption}\item[{std\+::wstring}]{size }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00611                                          \{}
\DoxyCodeLine{00612   \textcolor{comment}{// font e tool fields update}}
\DoxyCodeLine{00613   \textcolor{keywordtype}{double} dimension = std::stod(strSize);}
\DoxyCodeLine{00614 }
\DoxyCodeLine{00615   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img      = \mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true});}
\DoxyCodeLine{00616   \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti  = img;}
\DoxyCodeLine{00617   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img;}
\DoxyCodeLine{00618   \textcolor{comment}{// for vector levels, adjust size according to the ratio between}}
\DoxyCodeLine{00619   \textcolor{comment}{// the viewer dpi and the vector level's dpi}}
\DoxyCodeLine{00620   \textcolor{keywordflow}{if} (vi) dimension *= \mbox{\hyperlink{namespace_stage_ad3e22e31e2bb6fc1d95a572facce2d5b}{Stage::inch}} / Stage::standardDpi;}
\DoxyCodeLine{00621 }
\DoxyCodeLine{00622   \textcolor{keywordflow}{if} (m\_dimension == dimension) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00623   TFontManager::instance()-\/>setSize((\textcolor{keywordtype}{int})dimension);}
\DoxyCodeLine{00624 }
\DoxyCodeLine{00625   assert(m\_dimension != 0);}
\DoxyCodeLine{00626   \textcolor{keywordtype}{double} ratio = dimension / m\_dimension;}
\DoxyCodeLine{00627   m\_dimension  = dimension;}
\DoxyCodeLine{00628 }
\DoxyCodeLine{00629   \textcolor{comment}{// not used for now}}
\DoxyCodeLine{00630   m\_scale = \mbox{\hyperlink{class_t_scale}{TScale}}();}
\DoxyCodeLine{00631   \textcolor{comment}{// m\_scale = TScale(m\_dimension /}}
\DoxyCodeLine{00632   \textcolor{comment}{// (double)(TFontManager::instance()-\/>getHeight()));}}
\DoxyCodeLine{00633 }
\DoxyCodeLine{00634   \textcolor{comment}{// text update}}
\DoxyCodeLine{00635 }
\DoxyCodeLine{00636   \textcolor{keywordflow}{if} (m\_string.empty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00637 }
\DoxyCodeLine{00638   \textcolor{keywordflow}{for} (UINT i = 0; i < m\_string.size(); i++) \{}
\DoxyCodeLine{00639     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = m\_string[i].m\_char) vi-\/>transform(\mbox{\hyperlink{class_t_scale}{TScale}}(ratio));}
\DoxyCodeLine{00640     m\_string[i].m\_offset *= ratio;}
\DoxyCodeLine{00641   \}}
\DoxyCodeLine{00642   \textcolor{keywordflow}{if} (ti)}
\DoxyCodeLine{00643     updateStrokeChar();}
\DoxyCodeLine{00644   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00645     updateCharPositions();}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00648 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a36107cb58d41f6f7fce55dbe0a948fa2}\label{class_type_tool_a36107cb58d41f6f7fce55dbe0a948fa2}} 
\index{TypeTool@{TypeTool}!setTypeface@{setTypeface}}
\index{setTypeface@{setTypeface}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{setTypeface()}{setTypeface()}}
{\footnotesize\ttfamily void Type\+Tool\+::set\+Typeface (\begin{DoxyParamCaption}\item[{std\+::wstring}]{typeface }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00594                                               \{}
\DoxyCodeLine{00595   \textcolor{keywordflow}{if} (m\_typeface == typeface) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00596   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00597   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00598     instance-\/>\mbox{\hyperlink{class_t_font_manager_a62823c79842c16891b8db8cd07c0c36b}{setTypeface}}(typeface);}
\DoxyCodeLine{00599     m\_typeface = typeface;}
\DoxyCodeLine{00600     updateStrokeChar();}
\DoxyCodeLine{00601     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00602   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_font_creation_error}{TFontCreationError}} \&) \{}
\DoxyCodeLine{00603     \textcolor{comment}{//    TMessage::error(toString(e.getMessage()));}}
\DoxyCodeLine{00604     assert(m\_typeface == instance-\/>getCurrentTypeface());}
\DoxyCodeLine{00605     m\_typeFaceMenu.setValue(m\_typeface);}
\DoxyCodeLine{00606   \}}
\DoxyCodeLine{00607 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a546cdbf138dada7a792035c82ea07574}\label{class_type_tool_a546cdbf138dada7a792035c82ea07574}} 
\index{TypeTool@{TypeTool}!setVertical@{setVertical}}
\index{setVertical@{setVertical}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{setVertical()}{setVertical()}}
{\footnotesize\ttfamily void Type\+Tool\+::set\+Vertical (\begin{DoxyParamCaption}\item[{bool}]{vertical }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00652                                         \{}
\DoxyCodeLine{00653   \textcolor{keywordflow}{if} (vertical == m\_isVertical) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00654 }
\DoxyCodeLine{00655   m\_isVertical        = vertical;}
\DoxyCodeLine{00656   \textcolor{keywordtype}{bool} oldHasVertical = TFontManager::instance()-\/>hasVertical();}
\DoxyCodeLine{00657   TFontManager::instance()-\/>setVertical(vertical);}
\DoxyCodeLine{00658   \textcolor{keywordflow}{if} (oldHasVertical != TFontManager::instance()-\/>hasVertical())}
\DoxyCodeLine{00659     updateStrokeChar();}
\DoxyCodeLine{00660   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00661     updateCharPositions();}
\DoxyCodeLine{00662   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00663 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_af5a2342af561951b2d6a9e71f4f45a2b}\label{class_type_tool_af5a2342af561951b2d6a9e71f4f45a2b}} 
\index{TypeTool@{TypeTool}!stopEditing@{stopEditing}}
\index{stopEditing@{stopEditing}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{stopEditing()}{stopEditing()}}
{\footnotesize\ttfamily void Type\+Tool\+::stop\+Editing (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00667                            \{}
\DoxyCodeLine{00668   \textcolor{keywordflow}{if} (m\_active == \textcolor{keyword}{false}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00669   m\_active = \textcolor{keyword}{false};}
\DoxyCodeLine{00670   m\_string.clear();}
\DoxyCodeLine{00671   m\_cursorIndex = 0;}
\DoxyCodeLine{00672   m\_textBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00673   \textcolor{comment}{//  closeImeWindow();}}
\DoxyCodeLine{00674   \textcolor{comment}{//  if(m\_viewer) m\_viewer-\/>enableIme(false);}}
\DoxyCodeLine{00675   \textcolor{comment}{//  enableShortcuts(true);}}
\DoxyCodeLine{00676   m\_preeditRange = std::make\_pair(0, 0);}
\DoxyCodeLine{00677   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00678   \textcolor{keywordflow}{if} (m\_undo) \{}
\DoxyCodeLine{00679     TUndoManager::manager()-\/>add(m\_undo);}
\DoxyCodeLine{00680     m\_undo = 0;}
\DoxyCodeLine{00681   \}}
\DoxyCodeLine{00682 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a58eb6a89687836028abf3285eae6ad35}\label{class_type_tool_a58eb6a89687836028abf3285eae6ad35}} 
\index{TypeTool@{TypeTool}!updateCharPositions@{updateCharPositions}}
\index{updateCharPositions@{updateCharPositions}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{updateCharPositions()}{updateCharPositions()}}
{\footnotesize\ttfamily void Type\+Tool\+::update\+Char\+Positions (\begin{DoxyParamCaption}\item[{int}]{update\+From = {\ttfamily 0} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00706                                                  \{}
\DoxyCodeLine{00707   \textcolor{keywordflow}{if} (updateFrom < 0) updateFrom = 0;}
\DoxyCodeLine{00708   UINT size = m\_string.size();}
\DoxyCodeLine{00709   \mbox{\hyperlink{class_t_point_t}{TPointD}} currentOffset;}
\DoxyCodeLine{00710   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00711   m\_fontYOffset          = (double)(instance-\/>getLineSpacing()) * m\_scale.a11;}
\DoxyCodeLine{00712   \textcolor{keywordtype}{double} descent         = (\textcolor{keywordtype}{double})(instance-\/>getLineDescender()) * m\_scale.a11;}
\DoxyCodeLine{00713   \textcolor{keywordtype}{double} height          = (\textcolor{keywordtype}{double})(instance-\/>getHeight()) * m\_scale.a11;}
\DoxyCodeLine{00714   \textcolor{keywordtype}{double} vLineSpacing =}
\DoxyCodeLine{00715       (\textcolor{keywordtype}{double})(instance-\/>getAverageCharWidth()) * 2.0 * m\_scale.a11;}
\DoxyCodeLine{00716 }
\DoxyCodeLine{00717   \textcolor{comment}{// Update from "{}updateFrom"{}}}
\DoxyCodeLine{00718   if (updateFrom > 0) \{}
\DoxyCodeLine{00719     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{int})m\_string.size() <= updateFrom -\/ 1) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00720     currentOffset = m\_string[updateFrom -\/ 1].m\_charPosition -\/ m\_startPoint;}
\DoxyCodeLine{00721     \textcolor{comment}{// Vertical case}}
\DoxyCodeLine{00722     \textcolor{keywordflow}{if} (m\_isVertical \&\& !instance-\/>hasVertical()) \{}
\DoxyCodeLine{00723       \textcolor{keywordflow}{if} (m\_string[updateFrom -\/ 1].isReturn())}
\DoxyCodeLine{00724         currentOffset = \mbox{\hyperlink{class_t_point_t}{TPointD}}(currentOffset.x -\/ vLineSpacing, -\/height);}
\DoxyCodeLine{00725       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00726         currentOffset = currentOffset + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, -\/height);}
\DoxyCodeLine{00727     \}}
\DoxyCodeLine{00728     \textcolor{comment}{// Horizontal case}}
\DoxyCodeLine{00729     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00730       \textcolor{keywordflow}{if} (m\_string[updateFrom -\/ 1].isReturn())}
\DoxyCodeLine{00731         currentOffset = \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, currentOffset.y -\/ m\_fontYOffset);}
\DoxyCodeLine{00732       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00733         currentOffset =}
\DoxyCodeLine{00734             currentOffset + \mbox{\hyperlink{class_t_point_t}{TPointD}}(m\_string[updateFrom -\/ 1].m\_offset, 0);}
\DoxyCodeLine{00735     \}}
\DoxyCodeLine{00736   \}}
\DoxyCodeLine{00737   \textcolor{comment}{// Update whole characters}}
\DoxyCodeLine{00738   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00739     \textcolor{keywordflow}{if} (m\_isVertical \&\& !instance-\/>hasVertical())}
\DoxyCodeLine{00740       currentOffset = currentOffset + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, -\/height);}
\DoxyCodeLine{00741     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00742       currentOffset = currentOffset + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, -\/descent);}
\DoxyCodeLine{00743   \}}
\DoxyCodeLine{00744 }
\DoxyCodeLine{00745   \textcolor{keywordflow}{for} (UINT j = updateFrom; j < size; j++) \{}
\DoxyCodeLine{00746     m\_string[j].m\_charPosition = m\_startPoint + currentOffset;}
\DoxyCodeLine{00747     \textcolor{comment}{// Vertical case}}
\DoxyCodeLine{00748     \textcolor{keywordflow}{if} (m\_isVertical \&\& !instance-\/>hasVertical()) \{}
\DoxyCodeLine{00749       \textcolor{keywordflow}{if} (m\_string[j].isReturn() || m\_string[j].m\_key == \textcolor{charliteral}{' '})}
\DoxyCodeLine{00750         currentOffset = \mbox{\hyperlink{class_t_point_t}{TPointD}}(currentOffset.x -\/ vLineSpacing, -\/height);}
\DoxyCodeLine{00751       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00752         currentOffset = currentOffset + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, -\/height);}
\DoxyCodeLine{00753     \}}
\DoxyCodeLine{00754     \textcolor{comment}{// Horizontal case}}
\DoxyCodeLine{00755     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00756       \textcolor{keywordflow}{if} (m\_string[j].isReturn())}
\DoxyCodeLine{00757         currentOffset = \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, currentOffset.y -\/ m\_fontYOffset);}
\DoxyCodeLine{00758       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00759         currentOffset = currentOffset + \mbox{\hyperlink{class_t_point_t}{TPointD}}(m\_string[j].m\_offset, 0);}
\DoxyCodeLine{00760     \}}
\DoxyCodeLine{00761   \}}
\DoxyCodeLine{00762 }
\DoxyCodeLine{00763   \textcolor{comment}{// To be sure}}
\DoxyCodeLine{00764   \textcolor{keywordflow}{if} (m\_cursorIndex <= (\textcolor{keywordtype}{int})m\_string.size()) \{}
\DoxyCodeLine{00765     updateCursorPoint();}
\DoxyCodeLine{00766     updateTextBox();}
\DoxyCodeLine{00767   \}}
\DoxyCodeLine{00768 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_abe47db70407a263f6c4d76f18067029f}\label{class_type_tool_abe47db70407a263f6c4d76f18067029f}} 
\index{TypeTool@{TypeTool}!updateCursorPoint@{updateCursorPoint}}
\index{updateCursorPoint@{updateCursorPoint}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{updateCursorPoint()}{updateCursorPoint()}}
{\footnotesize\ttfamily void Type\+Tool\+::update\+Cursor\+Point (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00772                                  \{}
\DoxyCodeLine{00773   assert(0 <= m\_cursorIndex \&\& m\_cursorIndex <= (\textcolor{keywordtype}{int})m\_string.size());}
\DoxyCodeLine{00774   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00775   \textcolor{keywordtype}{double} descent         = (double)(instance-\/>getLineDescender()) * m\_scale.a11;}
\DoxyCodeLine{00776   \textcolor{keywordtype}{double} height          = (\textcolor{keywordtype}{double})(instance-\/>getHeight()) * m\_scale.a11;}
\DoxyCodeLine{00777   \textcolor{keywordtype}{double} vLineSpacing =}
\DoxyCodeLine{00778       (\textcolor{keywordtype}{double})(instance-\/>getAverageCharWidth()) * 2.0 * m\_scale.a11;}
\DoxyCodeLine{00779   m\_fontYOffset          = (\textcolor{keywordtype}{double})(instance-\/>getLineSpacing()) * m\_scale.a11;}
\DoxyCodeLine{00780   \textcolor{keywordtype}{double} scaledDimension = m\_dimension * m\_scale.a11;}
\DoxyCodeLine{00781 }
\DoxyCodeLine{00782   if (m\_string.empty()) \{}
\DoxyCodeLine{00783     \textcolor{keywordflow}{if} (!m\_isVertical || instance-\/>hasVertical())}
\DoxyCodeLine{00784       m\_cursorPoint = m\_startPoint + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, scaledDimension);}
\DoxyCodeLine{00785     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00786       m\_cursorPoint = m\_startPoint;}
\DoxyCodeLine{00787   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_cursorIndex == (\textcolor{keywordtype}{int})m\_string.size()) \{}
\DoxyCodeLine{00788     \textcolor{comment}{// Horizontal case}}
\DoxyCodeLine{00789     \textcolor{keywordflow}{if} (!m\_isVertical || instance-\/>hasVertical()) \{}
\DoxyCodeLine{00790       \textcolor{keywordflow}{if} (m\_string.back().isReturn())}
\DoxyCodeLine{00791         m\_cursorPoint = \mbox{\hyperlink{class_t_point_t}{TPointD}}(}
\DoxyCodeLine{00792             m\_startPoint.x, m\_string.back().m\_charPosition.y -\/ m\_fontYOffset +}
\DoxyCodeLine{00793                                 scaledDimension + descent);}
\DoxyCodeLine{00794       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00795         m\_cursorPoint = m\_string.back().m\_charPosition +}
\DoxyCodeLine{00796                         \mbox{\hyperlink{class_t_point_t}{TPointD}}(m\_string.back().m\_offset, 0) +}
\DoxyCodeLine{00797                         \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, scaledDimension + descent);}
\DoxyCodeLine{00798     \}}
\DoxyCodeLine{00799     \textcolor{comment}{// Vertical case}}
\DoxyCodeLine{00800     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00801       \textcolor{keywordflow}{if} (m\_string.back().isReturn())}
\DoxyCodeLine{00802         m\_cursorPoint = \mbox{\hyperlink{class_t_point_t}{TPointD}}(m\_string.back().m\_charPosition.x -\/ vLineSpacing,}
\DoxyCodeLine{00803                                 m\_startPoint.y);}
\DoxyCodeLine{00804       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00805         m\_cursorPoint = m\_string.back().m\_charPosition;}
\DoxyCodeLine{00806     \}}
\DoxyCodeLine{00807   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00808     \textcolor{keywordflow}{if} (!m\_isVertical || instance-\/>hasVertical())}
\DoxyCodeLine{00809       m\_cursorPoint = m\_string[m\_cursorIndex].m\_charPosition +}
\DoxyCodeLine{00810                       \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, scaledDimension + descent);}
\DoxyCodeLine{00811     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00812       m\_cursorPoint =}
\DoxyCodeLine{00813           m\_string[m\_cursorIndex].m\_charPosition + \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, height);}
\DoxyCodeLine{00814   \}}
\DoxyCodeLine{00815 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a4e0ffc0e1385d9e4dcfc0027178c140b}\label{class_type_tool_a4e0ffc0e1385d9e4dcfc0027178c140b}} 
\index{TypeTool@{TypeTool}!updateMouseCursor@{updateMouseCursor}}
\index{updateMouseCursor@{updateMouseCursor}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{updateMouseCursor()}{updateMouseCursor()}}
{\footnotesize\ttfamily void Type\+Tool\+::update\+Mouse\+Cursor (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00864                                                    \{}
\DoxyCodeLine{00865   \textcolor{keywordtype}{int} oldCursor = m\_cursorId;}
\DoxyCodeLine{00866 }
\DoxyCodeLine{00867   \textcolor{keywordflow}{if} (!m\_validFonts)}
\DoxyCodeLine{00868     m\_cursorId = ToolCursor::CURSOR\_NO;}
\DoxyCodeLine{00869   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00870     \mbox{\hyperlink{class_t_point_t}{TPointD}} clickPoint =}
\DoxyCodeLine{00871         (TFontManager::instance()-\/>hasVertical() \&\& m\_isVertical)}
\DoxyCodeLine{00872             ? \mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_startPoint, 90) * pos}
\DoxyCodeLine{00873             : pos;}
\DoxyCodeLine{00874     \textcolor{keywordflow}{if} (m\_textBox == \mbox{\hyperlink{class_t_rect_t}{TRectD}}(0, 0, 0, 0) || m\_string.empty() ||}
\DoxyCodeLine{00875         !m\_textBox.contains(clickPoint))}
\DoxyCodeLine{00876       m\_cursorId = ToolCursor::TypeOutCursor;}
\DoxyCodeLine{00877     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00878       m\_cursorId = ToolCursor::TypeInCursor;}
\DoxyCodeLine{00879   \}}
\DoxyCodeLine{00880 }
\DoxyCodeLine{00881   \textcolor{comment}{//  if(oldCursor != m\_cursorId)}}
\DoxyCodeLine{00882   \textcolor{comment}{//    TNotifier::instance()-\/>notify(TToolChange());}}
\DoxyCodeLine{00883 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_a9736118616794b9d2ba56b135bdae286}\label{class_type_tool_a9736118616794b9d2ba56b135bdae286}} 
\index{TypeTool@{TypeTool}!updateStrokeChar@{updateStrokeChar}}
\index{updateStrokeChar@{updateStrokeChar}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{updateStrokeChar()}{updateStrokeChar()}}
{\footnotesize\ttfamily void Type\+Tool\+::update\+Stroke\+Char (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00686                                 \{}
\DoxyCodeLine{00687   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00688 }
\DoxyCodeLine{00689   \textcolor{comment}{// not used for now}}
\DoxyCodeLine{00690   m\_scale = \mbox{\hyperlink{class_t_scale}{TScale}}();}
\DoxyCodeLine{00691   \textcolor{comment}{// m\_scale = TScale(m\_dimension / (double)(instance-\/>getHeight()));}}
\DoxyCodeLine{00692 }
\DoxyCodeLine{00693   \textcolor{keywordtype}{bool} hasKerning = instance-\/>hasKerning();}
\DoxyCodeLine{00694   \textcolor{keywordflow}{for} (UINT i = 0; i < m\_string.size(); i++) \{}
\DoxyCodeLine{00695     \textcolor{keywordflow}{if} (hasKerning \&\& i + 1 < m\_string.size() \&\& !m\_string[i + 1].isReturn())}
\DoxyCodeLine{00696       m\_string[i].update(\textcolor{comment}{/*m\_font,*/} m\_scale, m\_string[i + 1].m\_key);}
\DoxyCodeLine{00697     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00698       m\_string[i].update(\textcolor{comment}{/*m\_font,*/} m\_scale);}
\DoxyCodeLine{00699   \}}
\DoxyCodeLine{00700 }
\DoxyCodeLine{00701   updateCharPositions();}
\DoxyCodeLine{00702 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_afa6fa7fc3e2c5d054fed986e95600fc7}\label{class_type_tool_afa6fa7fc3e2c5d054fed986e95600fc7}} 
\index{TypeTool@{TypeTool}!updateTextBox@{updateTextBox}}
\index{updateTextBox@{updateTextBox}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{updateTextBox()}{updateTextBox()}}
{\footnotesize\ttfamily void Type\+Tool\+::update\+Text\+Box (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00819                              \{}
\DoxyCodeLine{00820   UINT size                = m\_string.size();}
\DoxyCodeLine{00821   UINT returnNumber        = 0;}
\DoxyCodeLine{00822   \textcolor{keywordtype}{double} currentLineLength = 0;}
\DoxyCodeLine{00823   \textcolor{keywordtype}{double} maxXLength        = 0;}
\DoxyCodeLine{00824 }
\DoxyCodeLine{00825   \mbox{\hyperlink{class_t_font_manager}{TFontManager}} *instance = TFontManager::instance();}
\DoxyCodeLine{00826   \textcolor{keywordtype}{double} descent         = (double)(instance-\/>getLineDescender()) * m\_scale.a11;}
\DoxyCodeLine{00827   \textcolor{keywordtype}{double} height          = (\textcolor{keywordtype}{double})(instance-\/>getHeight()) * m\_scale.a11;}
\DoxyCodeLine{00828   \textcolor{keywordtype}{double} vLineSpacing =}
\DoxyCodeLine{00829       (\textcolor{keywordtype}{double})(instance-\/>getAverageCharWidth()) * 2.0 * m\_scale.a11;}
\DoxyCodeLine{00830   m\_fontYOffset = (\textcolor{keywordtype}{double})(instance-\/>getLineSpacing()) * m\_scale.a11;}
\DoxyCodeLine{00831 }
\DoxyCodeLine{00832   for (UINT j = 0; j < size; j++) \{}
\DoxyCodeLine{00833     \textcolor{keywordflow}{if} (m\_string[j].isReturn()) \{}
\DoxyCodeLine{00834       \textcolor{keywordflow}{if} (currentLineLength > maxXLength) \{}
\DoxyCodeLine{00835         maxXLength = currentLineLength;}
\DoxyCodeLine{00836       \}}
\DoxyCodeLine{00837       currentLineLength = 0;}
\DoxyCodeLine{00838       returnNumber++;}
\DoxyCodeLine{00839     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00840       currentLineLength += (m\_isVertical \&\& !instance-\/>hasVertical())}
\DoxyCodeLine{00841                                ? height}
\DoxyCodeLine{00842                                : m\_string[j].m\_offset;}
\DoxyCodeLine{00843     \}}
\DoxyCodeLine{00844   \}}
\DoxyCodeLine{00845 }
\DoxyCodeLine{00846   \textcolor{keywordflow}{if} (currentLineLength > maxXLength)  \textcolor{comment}{// last line}}
\DoxyCodeLine{00847     maxXLength = currentLineLength;}
\DoxyCodeLine{00848 }
\DoxyCodeLine{00849   \textcolor{keywordflow}{if} (m\_isVertical \&\& !instance-\/>hasVertical())}
\DoxyCodeLine{00850     m\_textBox = \mbox{\hyperlink{class_t_rect_t}{TRectD}}(m\_startPoint.x -\/ vLineSpacing * returnNumber,}
\DoxyCodeLine{00851                        m\_startPoint.y -\/ maxXLength,}
\DoxyCodeLine{00852                        m\_startPoint.x + vLineSpacing, m\_startPoint.y)}
\DoxyCodeLine{00853                     .enlarge(cBorderSize * m\_pixelSize);}
\DoxyCodeLine{00854   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00855     m\_textBox =}
\DoxyCodeLine{00856         \mbox{\hyperlink{class_t_rect_t}{TRectD}}(m\_startPoint.x,}
\DoxyCodeLine{00857                m\_startPoint.y -\/ (m\_fontYOffset * returnNumber + descent),}
\DoxyCodeLine{00858                m\_startPoint.x + maxXLength, m\_startPoint.y + height)}
\DoxyCodeLine{00859             .enlarge(cBorderSize * m\_pixelSize);}
\DoxyCodeLine{00860 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_type_tool_ac0f03fb8b3b8ae1c96a62b96f0ab725a}\label{class_type_tool_ac0f03fb8b3b8ae1c96a62b96f0ab725a}} 
\index{TypeTool@{TypeTool}!updateTranslation@{updateTranslation}}
\index{updateTranslation@{updateTranslation}!TypeTool@{TypeTool}}
\doxysubsubsection{\texorpdfstring{updateTranslation()}{updateTranslation()}}
{\footnotesize\ttfamily void Type\+Tool\+::update\+Translation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00455                                  \{}
\DoxyCodeLine{00456   m\_fontFamilyMenu.setQStringName(tr(\textcolor{stringliteral}{"{}Font:"{}}));}
\DoxyCodeLine{00457   m\_typeFaceMenu.setQStringName(tr(\textcolor{stringliteral}{"{}Style:"{}}));}
\DoxyCodeLine{00458   m\_vertical.setQStringName(tr(\textcolor{stringliteral}{"{}Vertical Orientation"{}}));}
\DoxyCodeLine{00459   m\_size.setQStringName(tr(\textcolor{stringliteral}{"{}Size:"{}}));}
\DoxyCodeLine{00460 \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnztools/typetool.\+cpp\end{DoxyCompactItemize}
