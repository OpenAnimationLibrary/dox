\hypertarget{class_shading_context}{}\doxysection{Shading\+Context Class Reference}
\label{class_shading_context}\index{ShadingContext@{ShadingContext}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_shading_context_1_1_imp}{Imp}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Support} \{ {\bfseries OK}
, {\bfseries NO\+\_\+\+PIXEL\+\_\+\+BUFFER}
, {\bfseries NO\+\_\+\+SHADERS}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_shading_context_af98802004757c907086d41becebaed76}{Shading\+Context}} (QOffscreen\+Surface $\ast$)
\item 
bool \mbox{\hyperlink{class_shading_context_a21ee3d56a2da3f578096e1f953a647b5}{is\+Valid}} () const
\item 
void \mbox{\hyperlink{class_shading_context_a6c1ba9bf415d796c598d2c9c41a93be2}{make\+Current}} ()
\item 
void \mbox{\hyperlink{class_shading_context_a7ab177b70f247f75dc78512e96267963}{done\+Current}} ()
\item 
void \mbox{\hyperlink{class_shading_context_a4416f47c0257a17b094fd7c0611309ff}{resize}} (int lx, int ly, const QOpen\+GLFramebuffer\+Object\+Format \&fmt=QOpen\+GLFramebuffer\+Object\+Format())
\item 
QOpen\+GLFramebuffer\+Object\+Format \mbox{\hyperlink{class_shading_context_ab987303ce881fef9dda31d6ec6520aa9}{format}} () const
\item 
\mbox{\hyperlink{class_t_dimension_t}{TDimension}} \mbox{\hyperlink{class_shading_context_aff524d7662160e911f9ba83674c58e99}{size}} () const
\item 
void \mbox{\hyperlink{class_shading_context_a7a77b657d797bc1007e674f37610f36a}{add\+Shader\+Program}} (const QString \&shader\+Name, QOpen\+GLShader\+Program $\ast$program)
\item 
void \mbox{\hyperlink{class_shading_context_a3e64570afe1697fe3d2651ad7e23f1b1}{add\+Shader\+Program}} (const QString \&shader\+Name, QOpen\+GLShader\+Program $\ast$program, const QDate\+Time \&last\+Modified)
\item 
bool \mbox{\hyperlink{class_shading_context_ad3585debcd84c56721c2640e7b24c235}{remove\+Shader\+Program}} (const QString \&shader\+Name)
\item 
QOpen\+GLShader\+Program $\ast$ \mbox{\hyperlink{class_shading_context_a4dbe3c488b6d3afc4762566eb4f9c0a0}{shader\+Program}} (const QString \&shader\+Name) const
\item 
QDate\+Time \mbox{\hyperlink{class_shading_context_ac0b4db8f6592ce93504925989e1af0ec}{last\+Modified}} (const QString \&shader\+Name) const
\item 
std\+::pair$<$ QOpen\+GLShader\+Program $\ast$, QDate\+Time $>$ \mbox{\hyperlink{class_shading_context_a66ae54d30a2647e1b9d20d664df8b9cd}{shader\+Data}} (const QString \&shader\+Name) const
\item 
GLuint \mbox{\hyperlink{class_shading_context_a88ccfeba76ac4726ceae0d58dd3a6db4}{load\+Texture}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&src, GLuint tex\+Unit)
\item 
void \mbox{\hyperlink{class_shading_context_ac09702f0fb8b2a9857f1e385426b8fd2}{unload\+Texture}} (GLuint tex\+Id)
\begin{DoxyCompactList}\small\item\em Releases the specified texture id. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_shading_context_a91ecdbf1004866713dc0b13f0db02f94}{draw}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&dst)
\begin{DoxyCompactList}\small\item\em Renders the active shader program to the specified raster. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_shading_context_a4af32748d5ba22eb1e09d3215004fd3c}{transform\+Feedback}} (int varyings\+Count, const GLsizeiptr $\ast$varying\+Sizes, GLvoid $\ast$$\ast$bufs)
\begin{DoxyCompactList}\small\item\em Performs transform feedback with the specified varying variables. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static Support \mbox{\hyperlink{class_shading_context_ade447c645c1652ef203d6c7b85a4fec1}{support}} ()
\begin{DoxyCompactList}\small\item\em Returns the status of Open\+GL shading support. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{class_shading_context_a29f8c504abed285bda1dda2bf2e21c29}\label{class_shading_context_a29f8c504abed285bda1dda2bf2e21c29}} 
\index{ShadingContext@{ShadingContext}!Support@{Support}}
\index{Support@{Support}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{Support}{Support}}
{\footnotesize\ttfamily enum Shading\+Context\+::\+Support}


\begin{DoxyCode}{0}
\DoxyCodeLine{00042 \{ OK, NO\_PIXEL\_BUFFER, NO\_SHADERS \};}

\end{DoxyCode}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_shading_context_af98802004757c907086d41becebaed76}\label{class_shading_context_af98802004757c907086d41becebaed76}} 
\index{ShadingContext@{ShadingContext}!ShadingContext@{ShadingContext}}
\index{ShadingContext@{ShadingContext}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{ShadingContext()}{ShadingContext()}}
{\footnotesize\ttfamily Shading\+Context\+::\+Shading\+Context (\begin{DoxyParamCaption}\item[{QOffscreen\+Surface $\ast$}]{surface }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00113                                                          : m\_imp(\textcolor{keyword}{new} Imp) \{}
\DoxyCodeLine{00114   m\_imp-\/>m\_surface = surface;}
\DoxyCodeLine{00115   m\_imp-\/>m\_surface-\/>create();}
\DoxyCodeLine{00116   QSurfaceFormat format;}
\DoxyCodeLine{00117   m\_imp-\/>m\_context-\/>setFormat(format);}
\DoxyCodeLine{00118   m\_imp-\/>m\_context-\/>create();}
\DoxyCodeLine{00119   m\_imp-\/>m\_context-\/>makeCurrent(m\_imp-\/>m\_surface);}
\DoxyCodeLine{00120 }
\DoxyCodeLine{00121   \textcolor{comment}{// m\_imp-\/>m\_pixelBuffer-\/>context()-\/>create();}}
\DoxyCodeLine{00122   \textcolor{comment}{// m\_imp-\/>m\_fbo(new QOpenGLFramebufferObject(1, 1));}}
\DoxyCodeLine{00123   makeCurrent();}
\DoxyCodeLine{00124    \textcolor{keywordflow}{if}( GLEW\_VERSION\_3\_2 ) \{}
\DoxyCodeLine{00125        glewExperimental = GL\_TRUE;}
\DoxyCodeLine{00126    \}}
\DoxyCodeLine{00127   glewInit();}
\DoxyCodeLine{00128   doneCurrent();}
\DoxyCodeLine{00129 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_acd2d66064364e2587b54b3a58c47ac90}\label{class_shading_context_acd2d66064364e2587b54b3a58c47ac90}} 
\index{ShadingContext@{ShadingContext}!````~ShadingContext@{$\sim$ShadingContext}}
\index{````~ShadingContext@{$\sim$ShadingContext}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{$\sim$ShadingContext()}{~ShadingContext()}}
{\footnotesize\ttfamily Shading\+Context\+::$\sim$\+Shading\+Context (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00133                                 \{}
\DoxyCodeLine{00134   \textcolor{comment}{// Destructor of QGLPixelBuffer calls QOpenGLContext::makeCurrent()}}
\DoxyCodeLine{00135   \textcolor{comment}{// internally,}}
\DoxyCodeLine{00136   \textcolor{comment}{// so the current thread must be the owner of QGLPixelBuffer context,}}
\DoxyCodeLine{00137   \textcolor{comment}{// when the destructor of m\_imp-\/>m\_context is called.}}
\DoxyCodeLine{00138   m\_imp-\/>m\_context-\/>moveToThread(QThread::currentThread());}
\DoxyCodeLine{00139 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_shading_context_a7a77b657d797bc1007e674f37610f36a}\label{class_shading_context_a7a77b657d797bc1007e674f37610f36a}} 
\index{ShadingContext@{ShadingContext}!addShaderProgram@{addShaderProgram}}
\index{addShaderProgram@{addShaderProgram}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{addShaderProgram()}{addShaderProgram()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Shading\+Context\+::add\+Shader\+Program (\begin{DoxyParamCaption}\item[{const QString \&}]{shader\+Name,  }\item[{QOpen\+GLShader\+Program $\ast$}]{program }\end{DoxyParamCaption})}

Surrenders ownership of the supplied shader program to the shading context. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00242                                                                      \{}
\DoxyCodeLine{00243   std::map<QString, CompiledShader>::iterator st =}
\DoxyCodeLine{00244       m\_imp-\/>m\_shaderPrograms}
\DoxyCodeLine{00245           .insert(std::make\_pair(shaderName, CompiledShader()))}
\DoxyCodeLine{00246           .first;}
\DoxyCodeLine{00247 }
\DoxyCodeLine{00248   st-\/>second.m\_program.reset(program);}
\DoxyCodeLine{00249 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a3e64570afe1697fe3d2651ad7e23f1b1}\label{class_shading_context_a3e64570afe1697fe3d2651ad7e23f1b1}} 
\index{ShadingContext@{ShadingContext}!addShaderProgram@{addShaderProgram}}
\index{addShaderProgram@{addShaderProgram}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{addShaderProgram()}{addShaderProgram()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Shading\+Context\+::add\+Shader\+Program (\begin{DoxyParamCaption}\item[{const QString \&}]{shader\+Name,  }\item[{QOpen\+GLShader\+Program $\ast$}]{program,  }\item[{const QDate\+Time \&}]{last\+Modified }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00255                                                                      \{}
\DoxyCodeLine{00256   std::map<QString, CompiledShader>::iterator st =}
\DoxyCodeLine{00257       m\_imp-\/>m\_shaderPrograms}
\DoxyCodeLine{00258           .insert(std::make\_pair(shaderName, CompiledShader()))}
\DoxyCodeLine{00259           .first;}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261   st-\/>second.m\_program.reset(program);}
\DoxyCodeLine{00262   st-\/>second.m\_lastModified = lastModified;}
\DoxyCodeLine{00263 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a7ab177b70f247f75dc78512e96267963}\label{class_shading_context_a7ab177b70f247f75dc78512e96267963}} 
\index{ShadingContext@{ShadingContext}!doneCurrent@{doneCurrent}}
\index{doneCurrent@{doneCurrent}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{doneCurrent()}{doneCurrent()}}
{\footnotesize\ttfamily void Shading\+Context\+::done\+Current (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00197                                  \{}
\DoxyCodeLine{00198   m\_imp-\/>m\_context-\/>moveToThread(0);}
\DoxyCodeLine{00199   m\_imp-\/>m\_context-\/>doneCurrent();}
\DoxyCodeLine{00200 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a91ecdbf1004866713dc0b13f0db02f94}\label{class_shading_context_a91ecdbf1004866713dc0b13f0db02f94}} 
\index{ShadingContext@{ShadingContext}!draw@{draw}}
\index{draw@{draw}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void Shading\+Context\+::draw (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{dst }\end{DoxyParamCaption})}



Renders the active shader program to the specified raster. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00350                                              \{}
\DoxyCodeLine{00351   assert(\textcolor{stringliteral}{"{}ShadingContext::resize() must be invoked at least once before this"{}} \&\&}
\DoxyCodeLine{00352          m\_imp-\/>m\_fbo.get());}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354   \textcolor{keywordtype}{int} lx = dst-\/>getLx(),}
\DoxyCodeLine{00355       ly = dst-\/>getLy();  \textcolor{comment}{// NOTE: We're not using m\_imp-\/>m\_fbo's size, since}}
\DoxyCodeLine{00356                           \textcolor{comment}{// it could be possibly greater than the required}}
\DoxyCodeLine{00357                           \textcolor{comment}{// destination surface.}}
\DoxyCodeLine{00358 }
\DoxyCodeLine{00359   m\_imp-\/>initMatrix(lx, ly);  \textcolor{comment}{// This call sets the OpenGL viewport to this}}
\DoxyCodeLine{00360                               \textcolor{comment}{// size -\/ and matches (1, 1) to dst's (lx, ly)}}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362   \{}
\DoxyCodeLine{00363     glBegin(GL\_QUADS);}
\DoxyCodeLine{00364 }
\DoxyCodeLine{00365     glVertex2f(0.0, 0.0);}
\DoxyCodeLine{00366     glVertex2f(lx, 0.0);}
\DoxyCodeLine{00367     glVertex2f(lx, ly);}
\DoxyCodeLine{00368     glVertex2f(0.0, ly);}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370     glEnd();}
\DoxyCodeLine{00371   \}}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373   glPixelStorei(GL\_PACK\_ROW\_LENGTH, dst-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}());}
\DoxyCodeLine{00374 }
\DoxyCodeLine{00375   \textcolor{comment}{// Read the fbo to dst}}
\DoxyCodeLine{00376   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32 = dst)}
\DoxyCodeLine{00377     glReadPixels(0, 0, lx, ly, GL\_BGRA\_EXT, GL\_UNSIGNED\_BYTE,}
\DoxyCodeLine{00378                  dst-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}());}
\DoxyCodeLine{00379   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00380     assert(\mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}}(dst));}
\DoxyCodeLine{00381     glReadPixels(0, 0, lx, ly, GL\_BGRA\_EXT, GL\_UNSIGNED\_SHORT,}
\DoxyCodeLine{00382                  dst-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}());}
\DoxyCodeLine{00383   \}}
\DoxyCodeLine{00384 }
\DoxyCodeLine{00385   assert(glGetError() == GL\_NO\_ERROR);}
\DoxyCodeLine{00386 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00158}{TRaster\+::get\+Raw\+Data()}}, and \mbox{\hyperlink{l00121}{TRaster\+::get\+Wrap()}}.

\mbox{\Hypertarget{class_shading_context_ab987303ce881fef9dda31d6ec6520aa9}\label{class_shading_context_ab987303ce881fef9dda31d6ec6520aa9}} 
\index{ShadingContext@{ShadingContext}!format@{format}}
\index{format@{format}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{format()}{format()}}
{\footnotesize\ttfamily QOpen\+GLFramebuffer\+Object\+Format Shading\+Context\+::format (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00227                                                             \{}
\DoxyCodeLine{00228   QOpenGLFramebufferObject *fbo = m\_imp-\/>m\_fbo.get();}
\DoxyCodeLine{00229   \textcolor{keywordflow}{return} fbo ? m\_imp-\/>m\_fbo-\/>format() : QOpenGLFramebufferObjectFormat();}
\DoxyCodeLine{00230 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a21ee3d56a2da3f578096e1f953a647b5}\label{class_shading_context_a21ee3d56a2da3f578096e1f953a647b5}} 
\index{ShadingContext@{ShadingContext}!isValid@{isValid}}
\index{isValid@{isValid}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{isValid()}{isValid()}}
{\footnotesize\ttfamily bool Shading\+Context\+::is\+Valid (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00153 \{ \textcolor{keywordflow}{return} m\_imp-\/>m\_context-\/>isValid(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_ac0b4db8f6592ce93504925989e1af0ec}\label{class_shading_context_ac0b4db8f6592ce93504925989e1af0ec}} 
\index{ShadingContext@{ShadingContext}!lastModified@{lastModified}}
\index{lastModified@{lastModified}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{lastModified()}{lastModified()}}
{\footnotesize\ttfamily QDate\+Time Shading\+Context\+::last\+Modified (\begin{DoxyParamCaption}\item[{const QString \&}]{shader\+Name }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00283                                                                       \{}
\DoxyCodeLine{00284   std::map<QString, CompiledShader>::iterator st =}
\DoxyCodeLine{00285       m\_imp-\/>m\_shaderPrograms.find(shaderName);}
\DoxyCodeLine{00286 }
\DoxyCodeLine{00287   \textcolor{keywordflow}{return} (st != m\_imp-\/>m\_shaderPrograms.end()) ? st-\/>second.m\_lastModified}
\DoxyCodeLine{00288                                                : QDateTime();}
\DoxyCodeLine{00289 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a88ccfeba76ac4726ceae0d58dd3a6db4}\label{class_shading_context_a88ccfeba76ac4726ceae0d58dd3a6db4}} 
\index{ShadingContext@{ShadingContext}!loadTexture@{loadTexture}}
\index{loadTexture@{loadTexture}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{loadTexture()}{loadTexture()}}
{\footnotesize\ttfamily GLuint Shading\+Context\+::load\+Texture (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{src,  }\item[{GLuint}]{tex\+Unit }\end{DoxyParamCaption})}

Loads a texture and binds it to 
\begin{DoxyCode}{0}
\DoxyCodeLine{00306                                                                       \{}
\DoxyCodeLine{00307   glActiveTexture(GL\_TEXTURE0 + texUnit);}
\DoxyCodeLine{00308 }
\DoxyCodeLine{00309   GLuint texId;}
\DoxyCodeLine{00310   glGenTextures(1, \&texId);}
\DoxyCodeLine{00311   glBindTexture(GL\_TEXTURE\_2D, texId);}
\DoxyCodeLine{00312 }
\DoxyCodeLine{00313   glTexParameteri(GL\_TEXTURE\_2D, GL\_TEXTURE\_WRAP\_S,}
\DoxyCodeLine{00314                   GL\_CLAMP);  \textcolor{comment}{// These must be used on a bound texture,}}
\DoxyCodeLine{00315   glTexParameteri(GL\_TEXTURE\_2D, GL\_TEXTURE\_WRAP\_T,}
\DoxyCodeLine{00316                   GL\_CLAMP);  \textcolor{comment}{// and are remembered in the OpenGL context.}}
\DoxyCodeLine{00317   glTexParameteri(GL\_TEXTURE\_2D, GL\_TEXTURE\_MAG\_FILTER,}
\DoxyCodeLine{00318                   GL\_NEAREST);  \textcolor{comment}{// They can be set here, no need for}}
\DoxyCodeLine{00319   glTexParameteri(GL\_TEXTURE\_2D, GL\_TEXTURE\_MIN\_FILTER,}
\DoxyCodeLine{00320                   GL\_NEAREST);  \textcolor{comment}{// the user to do it.}}
\DoxyCodeLine{00321 }
\DoxyCodeLine{00322   glPixelStorei(GL\_UNPACK\_ROW\_LENGTH, src-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}());}
\DoxyCodeLine{00323   glPixelStorei(GL\_UNPACK\_ALIGNMENT, 1);}
\DoxyCodeLine{00324 }
\DoxyCodeLine{00325   GLenum chanType = \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}}(src) ? GL\_UNSIGNED\_BYTE : GL\_UNSIGNED\_SHORT;}
\DoxyCodeLine{00326 }
\DoxyCodeLine{00327   glTexImage2D(GL\_TEXTURE\_2D,}
\DoxyCodeLine{00328                0,             \textcolor{comment}{// one level only}}
\DoxyCodeLine{00329                GL\_RGBA,       \textcolor{comment}{// pixel channels count}}
\DoxyCodeLine{00330                src-\/>getLx(),  \textcolor{comment}{// width}}
\DoxyCodeLine{00331                src-\/>getLy(),  \textcolor{comment}{// height}}
\DoxyCodeLine{00332                0,             \textcolor{comment}{// border size}}
\DoxyCodeLine{00333                TGL\_FMT,       \textcolor{comment}{// pixel format}}
\DoxyCodeLine{00334                chanType,      \textcolor{comment}{// channel data type}}
\DoxyCodeLine{00335                (GLvoid *)src-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}());}
\DoxyCodeLine{00336 }
\DoxyCodeLine{00337   assert(glGetError() == GL\_NO\_ERROR);}
\DoxyCodeLine{00338 }
\DoxyCodeLine{00339   \textcolor{keywordflow}{return} texId;}
\DoxyCodeLine{00340 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00158}{TRaster\+::get\+Raw\+Data()}}, and \mbox{\hyperlink{l00121}{TRaster\+::get\+Wrap()}}.

\mbox{\Hypertarget{class_shading_context_a6c1ba9bf415d796c598d2c9c41a93be2}\label{class_shading_context_a6c1ba9bf415d796c598d2c9c41a93be2}} 
\index{ShadingContext@{ShadingContext}!makeCurrent@{makeCurrent}}
\index{makeCurrent@{makeCurrent}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{makeCurrent()}{makeCurrent()}}
{\footnotesize\ttfamily void Shading\+Context\+::make\+Current (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00186                                  \{}
\DoxyCodeLine{00187   m\_imp-\/>m\_context-\/>moveToThread(QThread::currentThread());}
\DoxyCodeLine{00188   m\_imp-\/>m\_context.reset(\textcolor{keyword}{new} QOpenGLContext());}
\DoxyCodeLine{00189   QSurfaceFormat format;}
\DoxyCodeLine{00190   m\_imp-\/>m\_context-\/>setFormat(format);}
\DoxyCodeLine{00191   m\_imp-\/>m\_context-\/>create();}
\DoxyCodeLine{00192   m\_imp-\/>m\_context-\/>makeCurrent(m\_imp-\/>m\_surface);}
\DoxyCodeLine{00193 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_ad3585debcd84c56721c2640e7b24c235}\label{class_shading_context_ad3585debcd84c56721c2640e7b24c235}} 
\index{ShadingContext@{ShadingContext}!removeShaderProgram@{removeShaderProgram}}
\index{removeShaderProgram@{removeShaderProgram}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{removeShaderProgram()}{removeShaderProgram()}}
{\footnotesize\ttfamily bool Shading\+Context\+::remove\+Shader\+Program (\begin{DoxyParamCaption}\item[{const QString \&}]{shader\+Name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00267                                                                   \{}
\DoxyCodeLine{00268   \textcolor{keywordflow}{return} (m\_imp-\/>m\_shaderPrograms.erase(shaderName) > 0);}
\DoxyCodeLine{00269 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a4416f47c0257a17b094fd7c0611309ff}\label{class_shading_context_a4416f47c0257a17b094fd7c0611309ff}} 
\index{ShadingContext@{ShadingContext}!resize@{resize}}
\index{resize@{resize}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{resize()}{resize()}}
{\footnotesize\ttfamily void Shading\+Context\+::resize (\begin{DoxyParamCaption}\item[{int}]{lx,  }\item[{int}]{ly,  }\item[{const QOpen\+GLFramebuffer\+Object\+Format \&}]{fmt = {\ttfamily QOpenGLFramebufferObjectFormat()} }\end{DoxyParamCaption})}

Resizes the output buffer to the specified size. Requires that the context is made current before invocation. In case lx or ly are 0, the context\textquotesingle{}s output buffer is destroyed. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00205                                                                        \{}
\DoxyCodeLine{00206   \textcolor{keywordflow}{if} (m\_imp-\/>m\_fbo.get() \&\& m\_imp-\/>m\_fbo-\/>width() == lx \&\&}
\DoxyCodeLine{00207       m\_imp-\/>m\_fbo-\/>height() == ly \&\& m\_imp-\/>m\_fbo-\/>format() == fmt)}
\DoxyCodeLine{00208     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00209 }
\DoxyCodeLine{00210   \textcolor{keywordflow}{if} (lx == 0 || ly == 0) \{}
\DoxyCodeLine{00211     m\_imp-\/>m\_fbo.reset(0);}
\DoxyCodeLine{00212   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00213     \textcolor{keywordtype}{bool} get                         = m\_imp-\/>m\_fbo.get();}
\DoxyCodeLine{00214     QOpenGLContext *currContext      = m\_imp-\/>m\_context-\/>currentContext();}
\DoxyCodeLine{00215     \textcolor{keywordtype}{bool} yes                         = \textcolor{keyword}{false};}
\DoxyCodeLine{00216     \textcolor{keywordflow}{if} (currContext) \textcolor{keywordtype}{bool} yes        = \textcolor{keyword}{true};}
\DoxyCodeLine{00217     \textcolor{keywordflow}{while} (!currContext) currContext = m\_imp-\/>m\_context-\/>currentContext();}
\DoxyCodeLine{00218     m\_imp-\/>m\_fbo.reset(\textcolor{keyword}{new} QOpenGLFramebufferObject(lx, ly, fmt));}
\DoxyCodeLine{00219     assert(m\_imp-\/>m\_fbo-\/>isValid());}
\DoxyCodeLine{00220 }
\DoxyCodeLine{00221     m\_imp-\/>m\_fbo-\/>bind();}
\DoxyCodeLine{00222   \}}
\DoxyCodeLine{00223 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a66ae54d30a2647e1b9d20d664df8b9cd}\label{class_shading_context_a66ae54d30a2647e1b9d20d664df8b9cd}} 
\index{ShadingContext@{ShadingContext}!shaderData@{shaderData}}
\index{shaderData@{shaderData}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{shaderData()}{shaderData()}}
{\footnotesize\ttfamily std\+::pair$<$ QOpen\+GLShader\+Program $\ast$, QDate\+Time $>$ Shading\+Context\+::shader\+Data (\begin{DoxyParamCaption}\item[{const QString \&}]{shader\+Name }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00294                                      \{}
\DoxyCodeLine{00295   std::map<QString, CompiledShader>::iterator st =}
\DoxyCodeLine{00296       m\_imp-\/>m\_shaderPrograms.find(shaderName);}
\DoxyCodeLine{00297 }
\DoxyCodeLine{00298   \textcolor{keywordflow}{return} (st != m\_imp-\/>m\_shaderPrograms.end())}
\DoxyCodeLine{00299              ? std::make\_pair(st-\/>second.m\_program.get(),}
\DoxyCodeLine{00300                               st-\/>second.m\_lastModified)}
\DoxyCodeLine{00301              : std::make\_pair((QOpenGLShaderProgram *)0, QDateTime());}
\DoxyCodeLine{00302 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a4dbe3c488b6d3afc4762566eb4f9c0a0}\label{class_shading_context_a4dbe3c488b6d3afc4762566eb4f9c0a0}} 
\index{ShadingContext@{ShadingContext}!shaderProgram@{shaderProgram}}
\index{shaderProgram@{shaderProgram}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{shaderProgram()}{shaderProgram()}}
{\footnotesize\ttfamily QOpen\+GLShader\+Program $\ast$ Shading\+Context\+::shader\+Program (\begin{DoxyParamCaption}\item[{const QString \&}]{shader\+Name }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00274                                      \{}
\DoxyCodeLine{00275   std::map<QString, CompiledShader>::iterator st =}
\DoxyCodeLine{00276       m\_imp-\/>m\_shaderPrograms.find(shaderName);}
\DoxyCodeLine{00277 }
\DoxyCodeLine{00278   \textcolor{keywordflow}{return} (st != m\_imp-\/>m\_shaderPrograms.end()) ? st-\/>second.m\_program.get() : 0;}
\DoxyCodeLine{00279 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_aff524d7662160e911f9ba83674c58e99}\label{class_shading_context_aff524d7662160e911f9ba83674c58e99}} 
\index{ShadingContext@{ShadingContext}!size@{size}}
\index{size@{size}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{size()}{size()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_dimension_t}{TDimension}} Shading\+Context\+::size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00234                                       \{}
\DoxyCodeLine{00235   QOpenGLFramebufferObject *fbo = m\_imp-\/>m\_fbo.get();}
\DoxyCodeLine{00236   \textcolor{keywordflow}{return} fbo ? \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(fbo-\/>width(), fbo-\/>height()) : \mbox{\hyperlink{class_t_dimension_t}{TDimension}}();}
\DoxyCodeLine{00237 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_ade447c645c1652ef203d6c7b85a4fec1}\label{class_shading_context_ade447c645c1652ef203d6c7b85a4fec1}} 
\index{ShadingContext@{ShadingContext}!support@{support}}
\index{support@{support}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{support()}{support()}}
{\footnotesize\ttfamily Shading\+Context\+::\+Support Shading\+Context\+::support (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Returns the status of Open\+GL shading support. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00143                                               \{}
\DoxyCodeLine{00144   \textcolor{comment}{// return !QGLPixelBuffer::hasOpenGLPbuffers()}}
\DoxyCodeLine{00145   \textcolor{comment}{//           ? NO\_PIXEL\_BUFFER}}
\DoxyCodeLine{00146   \textcolor{comment}{//           : !QOpenGLShaderProgram::hasOpenGLShaderPrograms() ? NO\_SHADERS :}}
\DoxyCodeLine{00147   \textcolor{comment}{//           OK;}}
\DoxyCodeLine{00148   \textcolor{keywordflow}{return} !QOpenGLShaderProgram::hasOpenGLShaderPrograms() ? NO\_SHADERS : OK;}
\DoxyCodeLine{00149 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_a4af32748d5ba22eb1e09d3215004fd3c}\label{class_shading_context_a4af32748d5ba22eb1e09d3215004fd3c}} 
\index{ShadingContext@{ShadingContext}!transformFeedback@{transformFeedback}}
\index{transformFeedback@{transformFeedback}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{transformFeedback()}{transformFeedback()}}
{\footnotesize\ttfamily void Shading\+Context\+::transform\+Feedback (\begin{DoxyParamCaption}\item[{int}]{varyings\+Count,  }\item[{const GLsizeiptr $\ast$}]{varying\+Sizes,  }\item[{GLvoid $\ast$$\ast$}]{bufs }\end{DoxyParamCaption})}



Performs transform feedback with the specified varying variables. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00392                                                       \{}
\DoxyCodeLine{00393   \textcolor{comment}{// Generate buffer objects}}
\DoxyCodeLine{00394   std::vector<GLuint> bufferObjectNames(varyingsCount, 0);}
\DoxyCodeLine{00395 }
\DoxyCodeLine{00396   glGenBuffers(varyingsCount, \&bufferObjectNames[0]);}
\DoxyCodeLine{00397 }
\DoxyCodeLine{00398   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} v = 0; v != varyingsCount; ++v) \{}
\DoxyCodeLine{00399     glBindBuffer(GL\_ARRAY\_BUFFER, bufferObjectNames[v]);}
\DoxyCodeLine{00400     glBufferData(GL\_ARRAY\_BUFFER, varyingSizes[v], bufs[v], GL\_STATIC\_READ);}
\DoxyCodeLine{00401     glBindBuffer(GL\_ARRAY\_BUFFER, 0);}
\DoxyCodeLine{00402 }
\DoxyCodeLine{00403     glBindBufferBase(GL\_TRANSFORM\_FEEDBACK\_BUFFER, v, bufferObjectNames[v]);}
\DoxyCodeLine{00404   \}}
\DoxyCodeLine{00405 }
\DoxyCodeLine{00406   \textcolor{comment}{// Draw}}
\DoxyCodeLine{00407   GLuint Query = 0;}
\DoxyCodeLine{00408 }
\DoxyCodeLine{00409   glGenQueries(1, \&Query);}
\DoxyCodeLine{00410   \{}
\DoxyCodeLine{00411     \textcolor{comment}{// Disable rasterization, vertices processing only!}}
\DoxyCodeLine{00412     glEnable(GL\_RASTERIZER\_DISCARD);}
\DoxyCodeLine{00413     glBeginQuery(GL\_TRANSFORM\_FEEDBACK\_PRIMITIVES\_WRITTEN, Query);}
\DoxyCodeLine{00414 }
\DoxyCodeLine{00415     glBeginTransformFeedback(GL\_POINTS);}
\DoxyCodeLine{00416     glBegin(GL\_POINTS);}
\DoxyCodeLine{00417     glVertex2f(0.0f, 0.0f);}
\DoxyCodeLine{00418     glEnd();}
\DoxyCodeLine{00419     glEndTransformFeedback();}
\DoxyCodeLine{00420 }
\DoxyCodeLine{00421     glEndQuery(GL\_TRANSFORM\_FEEDBACK\_PRIMITIVES\_WRITTEN);}
\DoxyCodeLine{00422     glDisable(GL\_RASTERIZER\_DISCARD);}
\DoxyCodeLine{00423   \}}
\DoxyCodeLine{00424 }
\DoxyCodeLine{00425   GLint count = 0;}
\DoxyCodeLine{00426   glGetQueryObjectiv(Query, GL\_QUERY\_RESULT, \&count);}
\DoxyCodeLine{00427 }
\DoxyCodeLine{00428   glDeleteQueries(1, \&Query);}
\DoxyCodeLine{00429 }
\DoxyCodeLine{00430   \textcolor{comment}{// Retrieve transformed data}}
\DoxyCodeLine{00431   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} v = 0; v != varyingsCount; ++v) \{}
\DoxyCodeLine{00432     glBindBuffer(GL\_ARRAY\_BUFFER, bufferObjectNames[v]);}
\DoxyCodeLine{00433     glGetBufferSubData(GL\_ARRAY\_BUFFER, 0, varyingSizes[v], bufs[v]);}
\DoxyCodeLine{00434   \}}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00436   glBindBuffer(GL\_ARRAY\_BUFFER, 0);}
\DoxyCodeLine{00437 }
\DoxyCodeLine{00438   \textcolor{comment}{// Delete buffer objects}}
\DoxyCodeLine{00439   glDeleteBuffers(varyingsCount, \&bufferObjectNames[0]);}
\DoxyCodeLine{00440 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shading_context_ac09702f0fb8b2a9857f1e385426b8fd2}\label{class_shading_context_ac09702f0fb8b2a9857f1e385426b8fd2}} 
\index{ShadingContext@{ShadingContext}!unloadTexture@{unloadTexture}}
\index{unloadTexture@{unloadTexture}!ShadingContext@{ShadingContext}}
\doxysubsubsection{\texorpdfstring{unloadTexture()}{unloadTexture()}}
{\footnotesize\ttfamily void Shading\+Context\+::unload\+Texture (\begin{DoxyParamCaption}\item[{GLuint}]{tex\+Id }\end{DoxyParamCaption})}



Releases the specified texture id. 

the specified texture unit. \begin{DoxyReturn}{Returns}
The Open\+GL texture id of the loaded texture.
\end{DoxyReturn}

\begin{DoxyParams}{Parameters}
{\em src} & Loaded texture.\\
\hline
{\em tex\+Unit} & Unit the texture will be bound to. \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{00344                                                \{}
\DoxyCodeLine{00345   glDeleteTextures(1, \&texId);}
\DoxyCodeLine{00346 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/stdfx/shadingcontext.\+h\item 
E\+:/opentoonz/toonz/sources/stdfx/shadingcontext.\+cpp\end{DoxyCompactItemize}
