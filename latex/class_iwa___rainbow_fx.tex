\hypertarget{class_iwa___rainbow_fx}{}\doxysection{Iwa\+\_\+\+Rainbow\+Fx Class Reference}
\label{class_iwa___rainbow_fx}\index{Iwa\_RainbowFx@{Iwa\_RainbowFx}}
Inheritance diagram for Iwa\+\_\+\+Rainbow\+Fx\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=6.000000cm]{class_iwa___rainbow_fx}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_iwa___rainbow_fx_af912d47cf6e72986e2c7b606dc96030d}{can\+Handle}} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame) override
\item 
bool \mbox{\hyperlink{class_iwa___rainbow_fx_ab4eed6797dc27fb44e2417eac6050201}{do\+Get\+BBox}} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&ri) override
\item 
void \mbox{\hyperlink{class_iwa___rainbow_fx_af093fd1ea9433f820dfed78317f84722}{do\+Compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&ri) override
\item 
void \mbox{\hyperlink{class_iwa___rainbow_fx_ab36d813f9eda3080af2928b7482770a6}{get\+Param\+UIs}} (\mbox{\hyperlink{class_t_param_u_i_concept}{TParam\+UIConcept}} $\ast$\&concepts, int \&length) override
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_iwa___rainbow_fx_af891eca988b268eb439403c1f3ccde7b}\label{class_iwa___rainbow_fx_af891eca988b268eb439403c1f3ccde7b}} 
\index{Iwa\_RainbowFx@{Iwa\_RainbowFx}!Iwa\_RainbowFx@{Iwa\_RainbowFx}}
\index{Iwa\_RainbowFx@{Iwa\_RainbowFx}!Iwa\_RainbowFx@{Iwa\_RainbowFx}}
\doxysubsubsection{\texorpdfstring{Iwa\_RainbowFx()}{Iwa\_RainbowFx()}}
{\footnotesize\ttfamily Iwa\+\_\+\+Rainbow\+Fx\+::\+Iwa\+\_\+\+Rainbow\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00119     : m\_center(\mbox{\hyperlink{class_t_point_t}{TPointD}}(0.0, 0.0))}
\DoxyCodeLine{00120     , m\_radius(200.0)}
\DoxyCodeLine{00121     , m\_intensity(1.0)}
\DoxyCodeLine{00122     , m\_width\_scale(1.0)}
\DoxyCodeLine{00123     , m\_inside(1.0)}
\DoxyCodeLine{00124     , m\_secondary\_rainbow(1.0)}
\DoxyCodeLine{00125     , m\_alpha\_rendering(\textcolor{keyword}{false}) \{}
\DoxyCodeLine{00126   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}center"{}}, m\_center);}
\DoxyCodeLine{00127   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}radius"{}}, m\_radius);}
\DoxyCodeLine{00128   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}intensity"{}}, m\_intensity);}
\DoxyCodeLine{00129   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}width\_scale"{}}, m\_width\_scale);}
\DoxyCodeLine{00130   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}inside"{}}, m\_inside);}
\DoxyCodeLine{00131   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}secondary\_rainbow"{}}, m\_secondary\_rainbow);}
\DoxyCodeLine{00132   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}alpha\_rendering"{}}, m\_alpha\_rendering);}
\DoxyCodeLine{00133 }
\DoxyCodeLine{00134   m\_radius-\/>setValueRange(0.0, std::numeric\_limits<double>::max());}
\DoxyCodeLine{00135   m\_intensity-\/>setValueRange(0.1, 10.0);}
\DoxyCodeLine{00136   m\_inside-\/>setValueRange(0.0, 1.0);}
\DoxyCodeLine{00137   m\_secondary\_rainbow-\/>setValueRange(0.0, 10.0);}
\DoxyCodeLine{00138   m\_width\_scale-\/>setValueRange(0.1, 50.0);}
\DoxyCodeLine{00139 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_iwa___rainbow_fx_af912d47cf6e72986e2c7b606dc96030d}\label{class_iwa___rainbow_fx_af912d47cf6e72986e2c7b606dc96030d}} 
\index{Iwa\_RainbowFx@{Iwa\_RainbowFx}!canHandle@{canHandle}}
\index{canHandle@{canHandle}!Iwa\_RainbowFx@{Iwa\_RainbowFx}}
\doxysubsubsection{\texorpdfstring{canHandle()}{canHandle()}}
{\footnotesize\ttfamily bool Iwa\+\_\+\+Rainbow\+Fx\+::can\+Handle (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00036                                                                      \{}
\DoxyCodeLine{00037     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00038   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___rainbow_fx_af093fd1ea9433f820dfed78317f84722}\label{class_iwa___rainbow_fx_af093fd1ea9433f820dfed78317f84722}} 
\index{Iwa\_RainbowFx@{Iwa\_RainbowFx}!doCompute@{doCompute}}
\index{doCompute@{doCompute}!Iwa\_RainbowFx@{Iwa\_RainbowFx}}
\doxysubsubsection{\texorpdfstring{doCompute()}{doCompute()}}
{\footnotesize\ttfamily void Iwa\+\_\+\+Rainbow\+Fx\+::do\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{ri }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00180                                                          \{}
\DoxyCodeLine{00181   \textcolor{comment}{// build raibow color map}}
\DoxyCodeLine{00182   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} rainbowColorCore\_ras(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structdouble3}{double3}}) * 301, 1);}
\DoxyCodeLine{00183   rainbowColorCore\_ras-\/>lock();}
\DoxyCodeLine{00184   \mbox{\hyperlink{structdouble3}{double3}}* rainbowColorCore\_p = (\mbox{\hyperlink{structdouble3}{double3}}*)rainbowColorCore\_ras-\/>getRawData();}
\DoxyCodeLine{00185 }
\DoxyCodeLine{00186   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} rainbowColorWide\_ras(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structdouble3}{double3}}) * 91, 1);}
\DoxyCodeLine{00187   rainbowColorWide\_ras-\/>lock();}
\DoxyCodeLine{00188   \mbox{\hyperlink{structdouble3}{double3}}* rainbowColorWide\_p = (\mbox{\hyperlink{structdouble3}{double3}}*)rainbowColorWide\_ras-\/>getRawData();}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190   \textcolor{keywordtype}{double} intensity = m\_intensity-\/>getValue(frame);}
\DoxyCodeLine{00191   \textcolor{keywordtype}{double} inside    = m\_inside-\/>getValue(frame);}
\DoxyCodeLine{00192   \textcolor{keywordtype}{double} secondary = m\_secondary\_rainbow-\/>getValue(frame);}
\DoxyCodeLine{00193   buildRanbowColorMap(rainbowColorCore\_p, rainbowColorWide\_p, intensity, inside,}
\DoxyCodeLine{00194                       secondary);}
\DoxyCodeLine{00195 }
\DoxyCodeLine{00196   \textcolor{comment}{// convert center position to render region coordinate}}
\DoxyCodeLine{00197   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}};}
\DoxyCodeLine{00198   \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dimOut(tile.getRaster()-\/>getLx(), tile.getRaster()-\/>getLy());}
\DoxyCodeLine{00199   \mbox{\hyperlink{class_t_point_t}{TPointD}} dimOffset((\textcolor{keywordtype}{float})dimOut.lx / 2.0f, (\textcolor{keywordtype}{float})dimOut.ly / 2.0f);}
\DoxyCodeLine{00200   \mbox{\hyperlink{class_t_point_t}{TPointD}} centerPos = m\_center-\/>getValue(frame);}
\DoxyCodeLine{00201   centerPos = aff * centerPos -\/ (tile.m\_pos + tile.getRaster()-\/>getCenterD()) +}
\DoxyCodeLine{00202               dimOffset;}
\DoxyCodeLine{00203 }
\DoxyCodeLine{00204   \textcolor{comment}{// result image buffer}}
\DoxyCodeLine{00205   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} outBuf\_ras(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structdouble3}{double3}}) * dimOut.lx * dimOut.ly, 1);}
\DoxyCodeLine{00206   outBuf\_ras-\/>lock();}
\DoxyCodeLine{00207   \mbox{\hyperlink{structdouble3}{double3}}* outBuf\_p = (\mbox{\hyperlink{structdouble3}{double3}}*)outBuf\_ras-\/>getRawData();}
\DoxyCodeLine{00208 }
\DoxyCodeLine{00209   \textcolor{keywordtype}{double} theta\_peak = 41.3;}
\DoxyCodeLine{00210   \textcolor{keywordtype}{double} peakRadius =}
\DoxyCodeLine{00211       getSizePixelAmount(m\_radius-\/>getValue(frame), ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}});}
\DoxyCodeLine{00212   \textcolor{keywordtype}{double} anglePerPixel = theta\_peak / peakRadius;}
\DoxyCodeLine{00213   \textcolor{keywordtype}{double} widthScale    = m\_width\_scale-\/>getValue(frame);}
\DoxyCodeLine{00214   \mbox{\hyperlink{structdouble3}{double3}}* out\_p       = outBuf\_p;}
\DoxyCodeLine{00215   \textcolor{comment}{// loop for all pixels}}
\DoxyCodeLine{00216   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y = 0; y < dimOut.ly; y++) \{}
\DoxyCodeLine{00217     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} x = 0; x < dimOut.lx; x++, out\_p++) \{}
\DoxyCodeLine{00218       \textcolor{comment}{// convert pixel distance from the center to scattering angle (degrees)}}
\DoxyCodeLine{00219       \textcolor{keywordtype}{double} s     = x -\/ centerPos.x;}
\DoxyCodeLine{00220       \textcolor{keywordtype}{double} t     = y -\/ centerPos.y;}
\DoxyCodeLine{00221       \textcolor{keywordtype}{double} theta = std::sqrt(s * s + t * t) * anglePerPixel;}
\DoxyCodeLine{00222       \textcolor{keywordtype}{double} phi   = 180.0 -\/ theta\_peak + (theta\_peak -\/ theta) / widthScale;}
\DoxyCodeLine{00223 }
\DoxyCodeLine{00224       *out\_p = angleToColor(phi, rainbowColorCore\_p, rainbowColorWide\_p);}
\DoxyCodeLine{00225     \}}
\DoxyCodeLine{00226   \}}
\DoxyCodeLine{00227 }
\DoxyCodeLine{00228   rainbowColorCore\_ras-\/>unlock();}
\DoxyCodeLine{00229   rainbowColorWide\_ras-\/>unlock();}
\DoxyCodeLine{00230 }
\DoxyCodeLine{00231   \textcolor{comment}{// convert to channel values}}
\DoxyCodeLine{00232   tile.getRaster()-\/>clear();}
\DoxyCodeLine{00233   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} outRas32 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}})tile.getRaster();}
\DoxyCodeLine{00234   \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} outRas64 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}})tile.getRaster();}
\DoxyCodeLine{00235   \textcolor{keywordflow}{if} (outRas32)}
\DoxyCodeLine{00236     setOutputRaster<TRaster32P, TPixel32>(outRas32, dimOut, outBuf\_p);}
\DoxyCodeLine{00237   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (outRas64)}
\DoxyCodeLine{00238     setOutputRaster<TRaster64P, TPixel64>(outRas64, dimOut, outBuf\_p);}
\DoxyCodeLine{00239 }
\DoxyCodeLine{00240   outBuf\_ras-\/>unlock();}
\DoxyCodeLine{00241 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___rainbow_fx_ab4eed6797dc27fb44e2417eac6050201}\label{class_iwa___rainbow_fx_ab4eed6797dc27fb44e2417eac6050201}} 
\index{Iwa\_RainbowFx@{Iwa\_RainbowFx}!doGetBBox@{doGetBBox}}
\index{doGetBBox@{doGetBBox}!Iwa\_RainbowFx@{Iwa\_RainbowFx}}
\doxysubsubsection{\texorpdfstring{doGetBBox()}{doGetBBox()}}
{\footnotesize\ttfamily bool Iwa\+\_\+\+Rainbow\+Fx\+::do\+Get\+BBox (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{b\+Box,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{ri }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00144                                                          \{}
\DoxyCodeLine{00145   bBox = TConsts::infiniteRectD;}
\DoxyCodeLine{00146   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00147 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___rainbow_fx_ab36d813f9eda3080af2928b7482770a6}\label{class_iwa___rainbow_fx_ab36d813f9eda3080af2928b7482770a6}} 
\index{Iwa\_RainbowFx@{Iwa\_RainbowFx}!getParamUIs@{getParamUIs}}
\index{getParamUIs@{getParamUIs}!Iwa\_RainbowFx@{Iwa\_RainbowFx}}
\doxysubsubsection{\texorpdfstring{getParamUIs()}{getParamUIs()}}
{\footnotesize\ttfamily void Iwa\+\_\+\+Rainbow\+Fx\+::get\+Param\+UIs (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_param_u_i_concept}{TParam\+UIConcept}} $\ast$\&}]{params,  }\item[{int \&}]{length }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Returns a list of User Interface Concepts to be displayed when editing the fx parameters. \begin{DoxyNote}{Note}
Ownership of the returned array allocated with new\mbox{[}\mbox{]} is passed to callers. 
\end{DoxyNote}


Reimplemented from \mbox{\hyperlink{class_t_fx_a18766b107b77772d67c5678e7d832b18}{TFx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00245                                                                        \{}
\DoxyCodeLine{00246   concepts = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_param_u_i_concept}{TParamUIConcept}}[length = 3];}
\DoxyCodeLine{00247 }
\DoxyCodeLine{00248   concepts[0].\mbox{\hyperlink{class_t_param_u_i_concept_a2dbb7c954ca5f2441a6931945cf004a5}{m\_type}}  = TParamUIConcept::POINT;}
\DoxyCodeLine{00249   concepts[0].m\_label = \textcolor{stringliteral}{"{}Center"{}};}
\DoxyCodeLine{00250   concepts[0].m\_params.push\_back(m\_center);}
\DoxyCodeLine{00251 }
\DoxyCodeLine{00252   concepts[1].m\_type  = TParamUIConcept::RADIUS;}
\DoxyCodeLine{00253   concepts[1].m\_label = \textcolor{stringliteral}{"{}Radius"{}};}
\DoxyCodeLine{00254   concepts[1].m\_params.push\_back(m\_radius);}
\DoxyCodeLine{00255   concepts[1].m\_params.push\_back(m\_center);}
\DoxyCodeLine{00256 }
\DoxyCodeLine{00257   concepts[2].m\_type  = TParamUIConcept::RAINBOW\_WIDTH;}
\DoxyCodeLine{00258   concepts[2].m\_label = \textcolor{stringliteral}{"{}Width"{}};}
\DoxyCodeLine{00259   concepts[2].m\_params.push\_back(m\_width\_scale);}
\DoxyCodeLine{00260   concepts[2].m\_params.push\_back(m\_radius);}
\DoxyCodeLine{00261   concepts[2].m\_params.push\_back(m\_center);}
\DoxyCodeLine{00262 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00078}{TParam\+UIConcept\+::m\+\_\+label}}, \mbox{\hyperlink{l00079}{TParam\+UIConcept\+::m\+\_\+params}}, and \mbox{\hyperlink{l00077}{TParam\+UIConcept\+::m\+\_\+type}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+rainbowfx.\+h\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+rainbowfx.\+cpp\end{DoxyCompactItemize}
