\hypertarget{class_iwa___bokeh_ref_fx}{}\doxysection{Iwa\+\_\+\+Bokeh\+Ref\+Fx Class Reference}
\label{class_iwa___bokeh_ref_fx}\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
Inheritance diagram for Iwa\+\_\+\+Bokeh\+Ref\+Fx\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=6.000000cm]{class_iwa___bokeh_ref_fx}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_iwa___bokeh_ref_fx_a9da005812741d24155f6f975b3934817}{do\+Compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&settings) override
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ }\\void \mbox{\hyperlink{class_iwa___bokeh_ref_fx_a5c717c82847efd281b601f238da02ed8}{set\+Depth\+Raster}} (const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} src\+Ras, unsigned char $\ast$dst\+Mem, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dim)
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ }\\void \mbox{\hyperlink{class_iwa___bokeh_ref_fx_a150f8ebbd11f8756947847e3203553c3}{set\+Depth\+Raster\+Gray}} (const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} src\+Ras, unsigned char $\ast$dst\+Mem, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dim)
\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} \mbox{\hyperlink{class_iwa___bokeh_ref_fx_ab7d5e3f6e17b4daf7c825c6ccb1a0e66}{m\+\_\+source}}
\item 
\mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} \mbox{\hyperlink{class_iwa___bokeh_ref_fx_a254bdfdd55bef69e1678335c6bdde194}{m\+\_\+depth}}
\item 
TInt\+ParamP \mbox{\hyperlink{class_iwa___bokeh_ref_fx_aa43ea5ac135a77cef459ff5a5451782e}{m\+\_\+distance\+Precision}}
\item 
TBool\+ParamP \mbox{\hyperlink{class_iwa___bokeh_ref_fx_a58a9971bce04c3b72994acf1134bf80e}{m\+\_\+fill\+Gap}}
\item 
TBool\+ParamP \mbox{\hyperlink{class_iwa___bokeh_ref_fx_a33acf8d6066f3c12577502c80a65f051}{m\+\_\+do\+Median}}
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_ad428956fe995b2624703654177ca02cc}\label{class_iwa___bokeh_ref_fx_ad428956fe995b2624703654177ca02cc}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{Iwa\_BokehRefFx()}{Iwa\_BokehRefFx()}}
{\footnotesize\ttfamily Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::\+Iwa\+\_\+\+Bokeh\+Ref\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00077     : m\_distancePrecision(10), m\_fillGap(\textcolor{keyword}{true}), m\_doMedian(\textcolor{keyword}{true}) \{}
\DoxyCodeLine{00078   \textcolor{comment}{// Bind parameters}}
\DoxyCodeLine{00079   \mbox{\hyperlink{class_t_fx_af0ccf8d65934ed9f7a62d3b45ee5f2b6}{addInputPort}}(\textcolor{stringliteral}{"{}Source"{}}, m\_source);}
\DoxyCodeLine{00080   \mbox{\hyperlink{class_t_fx_af0ccf8d65934ed9f7a62d3b45ee5f2b6}{addInputPort}}(\textcolor{stringliteral}{"{}Depth"{}}, m\_depth);}
\DoxyCodeLine{00081 }
\DoxyCodeLine{00082   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}on\_focus\_distance"{}}, m\_onFocusDistance, \textcolor{keyword}{false});}
\DoxyCodeLine{00083   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}bokeh\_amount"{}}, m\_bokehAmount, \textcolor{keyword}{false});}
\DoxyCodeLine{00084   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}hardness"{}}, m\_hardness, \textcolor{keyword}{false});}
\DoxyCodeLine{00085   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}distance\_precision"{}}, m\_distancePrecision, \textcolor{keyword}{false});}
\DoxyCodeLine{00086   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}fill\_gap"{}}, m\_fillGap, \textcolor{keyword}{false});}
\DoxyCodeLine{00087   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}fill\_gap\_with\_median\_filter"{}}, m\_doMedian, \textcolor{keyword}{false});}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089   m\_distancePrecision-\/>setValueRange(3, 128);}
\DoxyCodeLine{00090 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_a9da005812741d24155f6f975b3934817}\label{class_iwa___bokeh_ref_fx_a9da005812741d24155f6f975b3934817}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!doCompute@{doCompute}}
\index{doCompute@{doCompute}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{doCompute()}{doCompute()}}
{\footnotesize\ttfamily void Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::do\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{settings }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_iwa___bokeh_common_fx}{Iwa\+\_\+\+Bokeh\+Common\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00095                                                                 \{}
\DoxyCodeLine{00096   \textcolor{comment}{// If any of input is not connected, then do nothing}}
\DoxyCodeLine{00097   \textcolor{keywordflow}{if} (!m\_iris.isConnected() || !m\_source.isConnected() ||}
\DoxyCodeLine{00098       !m\_depth.isConnected()) \{}
\DoxyCodeLine{00099     tile.getRaster()-\/>clear();}
\DoxyCodeLine{00100     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00101   \}}
\DoxyCodeLine{00102 }
\DoxyCodeLine{00103   QList<TRasterGR8P> rasterList;}
\DoxyCodeLine{00104 }
\DoxyCodeLine{00105   \textcolor{comment}{// Get the pixel size of bokehAmount ( referenced ino\_blur.cpp )}}
\DoxyCodeLine{00106   \textcolor{keywordtype}{double} bokehPixelAmount = BokehUtils::getBokehPixelAmount(}
\DoxyCodeLine{00107       m\_bokehAmount-\/>getValue(frame), settings.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}});}
\DoxyCodeLine{00108 }
\DoxyCodeLine{00109   \textcolor{comment}{// Obtain the larger size of bokeh between the nearest (black) point and}}
\DoxyCodeLine{00110   \textcolor{comment}{// the farthest (white) point, based on the focus distance.}}
\DoxyCodeLine{00111   \textcolor{keywordtype}{double} onFocusDistance = m\_onFocusDistance-\/>getValue(frame);}
\DoxyCodeLine{00112   \textcolor{keywordtype}{double} maxIrisSize =}
\DoxyCodeLine{00113       bokehPixelAmount * std::max((1.0 -\/ onFocusDistance), onFocusDistance);}
\DoxyCodeLine{00114 }
\DoxyCodeLine{00115   \textcolor{keywordtype}{int} margin =}
\DoxyCodeLine{00116       (maxIrisSize > 1.0f) ? (\textcolor{keywordtype}{int})(std::ceil((maxIrisSize -\/ 1.0) / 2.0)) : 0;}
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118   \textcolor{comment}{// Range of computation}}
\DoxyCodeLine{00119   \mbox{\hyperlink{class_t_rect_t}{TRectD}} rectOut(tile.m\_pos, \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}}(tile.getRaster()-\/>getLx(),}
\DoxyCodeLine{00120                                          tile.getRaster()-\/>getLy()));}
\DoxyCodeLine{00121   rectOut = rectOut.enlarge(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(margin));}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123   \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dimOut(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(rectOut.getLx() + 0.5),}
\DoxyCodeLine{00124                      \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(rectOut.getLy() + 0.5));}
\DoxyCodeLine{00125 }
\DoxyCodeLine{00126   \textcolor{comment}{// Enlarge the size to the "{}fast size"{} for kissfft which has no factors other}}
\DoxyCodeLine{00127   \textcolor{comment}{// than 2,3, or 5.}}
\DoxyCodeLine{00128   \textcolor{keywordflow}{if} (dimOut.lx < 10000 \&\& dimOut.ly < 10000) \{}
\DoxyCodeLine{00129     \textcolor{keywordtype}{int} new\_x = kiss\_fft\_next\_fast\_size(dimOut.lx);}
\DoxyCodeLine{00130     \textcolor{keywordtype}{int} new\_y = kiss\_fft\_next\_fast\_size(dimOut.ly);}
\DoxyCodeLine{00131     \textcolor{comment}{// margin should be integer}}
\DoxyCodeLine{00132     \textcolor{keywordflow}{while} ((new\_x -\/ dimOut.lx) \% 2 != 0)}
\DoxyCodeLine{00133       new\_x = kiss\_fft\_next\_fast\_size(new\_x + 1);}
\DoxyCodeLine{00134     \textcolor{keywordflow}{while} ((new\_y -\/ dimOut.ly) \% 2 != 0)}
\DoxyCodeLine{00135       new\_y = kiss\_fft\_next\_fast\_size(new\_y + 1);}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137     rectOut = rectOut.enlarge(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(new\_x -\/ dimOut.lx) / 2.0,}
\DoxyCodeLine{00138                               \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(new\_y -\/ dimOut.ly) / 2.0);}
\DoxyCodeLine{00139 }
\DoxyCodeLine{00140     dimOut.lx = new\_x;}
\DoxyCodeLine{00141     dimOut.ly = new\_y;}
\DoxyCodeLine{00142   \}}
\DoxyCodeLine{00143 }
\DoxyCodeLine{00144   \textcolor{comment}{// -\/ -\/ -\/ Compute the input tiles -\/ -\/ -\/}}
\DoxyCodeLine{00145 }
\DoxyCodeLine{00146   \textcolor{comment}{// source image buffer}}
\DoxyCodeLine{00147   \textcolor{comment}{// double4* source\_buff;}}
\DoxyCodeLine{00148   \textcolor{comment}{// rasterList.append(allocateRasterAndLock<double4>(\&source\_buff, dimOut));}}
\DoxyCodeLine{00149 }
\DoxyCodeLine{00150   LayerValue layerValue;}
\DoxyCodeLine{00151   \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} infoOnInput(settings);}
\DoxyCodeLine{00152   infoOnInput.m\_bpp = 64;}
\DoxyCodeLine{00153   \textcolor{comment}{// source tile is used only in this focus.}}
\DoxyCodeLine{00154   \textcolor{comment}{// normalized source image data is stored in source\_buff.}}
\DoxyCodeLine{00155   layerValue.sourceTile = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_tile}{TTile}}();}
\DoxyCodeLine{00156   m\_source-\/>allocateAndCompute(*layerValue.sourceTile, rectOut.getP00(), dimOut,}
\DoxyCodeLine{00157                                0, frame, infoOnInput);}
\DoxyCodeLine{00158 }
\DoxyCodeLine{00159   \textcolor{comment}{// -\/ -\/ -\/ iris image -\/ -\/ -\/}}
\DoxyCodeLine{00160   \textcolor{comment}{// Get the original size of Iris image}}
\DoxyCodeLine{00161   \mbox{\hyperlink{class_t_rect_t}{TRectD}} irisBBox;}
\DoxyCodeLine{00162   m\_iris-\/>getBBox(frame, irisBBox, settings);}
\DoxyCodeLine{00163   \textcolor{comment}{// Compute the iris tile.}}
\DoxyCodeLine{00164   \mbox{\hyperlink{class_t_tile}{TTile}} irisTile;}
\DoxyCodeLine{00165   m\_iris-\/>allocateAndCompute(}
\DoxyCodeLine{00166       irisTile, irisBBox.getP00(),}
\DoxyCodeLine{00167       \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(irisBBox.getLx() + 0.5),}
\DoxyCodeLine{00168                  \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(irisBBox.getLy() + 0.5)),}
\DoxyCodeLine{00169       tile.getRaster(), frame, settings);}
\DoxyCodeLine{00170 }
\DoxyCodeLine{00171   \textcolor{comment}{// cancel check}}
\DoxyCodeLine{00172   \textcolor{keywordflow}{if} (settings.m\_isCanceled \&\& *settings.m\_isCanceled) \{}
\DoxyCodeLine{00173     releaseAllRasters(rasterList);}
\DoxyCodeLine{00174     tile.getRaster()-\/>clear();}
\DoxyCodeLine{00175     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00176   \}}
\DoxyCodeLine{00177 }
\DoxyCodeLine{00178   \textcolor{comment}{// compute the reference image}}
\DoxyCodeLine{00179   std::vector<TRasterGR8P> ctrl\_rasters;  \textcolor{comment}{// to be stored in uchar}}
\DoxyCodeLine{00180   QMap<int, unsigned char*>}
\DoxyCodeLine{00181       ctrls;  \textcolor{comment}{// container of [port number, reference image buffer in uchar]}}
\DoxyCodeLine{00182   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* depth\_buff;}
\DoxyCodeLine{00183   rasterList.append(allocateRasterAndLock<unsigned char>(\&depth\_buff, dimOut));}
\DoxyCodeLine{00184   \{}
\DoxyCodeLine{00185     \mbox{\hyperlink{class_t_tile}{TTile}} depthTile;}
\DoxyCodeLine{00186     m\_depth-\/>allocateAndCompute(depthTile, rectOut.getP00(), dimOut,}
\DoxyCodeLine{00187                                 tile.getRaster(), frame, settings);}
\DoxyCodeLine{00188 }
\DoxyCodeLine{00189     \textcolor{comment}{// cancel check}}
\DoxyCodeLine{00190     \textcolor{keywordflow}{if} (settings.m\_isCanceled \&\& *settings.m\_isCanceled) \{}
\DoxyCodeLine{00191       releaseAllRasters(rasterList);}
\DoxyCodeLine{00192       tile.getRaster()-\/>clear();}
\DoxyCodeLine{00193       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00194     \}}
\DoxyCodeLine{00195 }
\DoxyCodeLine{00196     \textcolor{comment}{// normalize brightness of the depth reference image to unsigned char}}
\DoxyCodeLine{00197     \textcolor{comment}{// and store into depth\_buff}}
\DoxyCodeLine{00198     \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} rasGR8   = (\mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}})depthTile.getRaster();}
\DoxyCodeLine{00199     \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR16P}} rasGR16 = (\mbox{\hyperlink{class_t_raster_p_t}{TRasterGR16P}})depthTile.getRaster();}
\DoxyCodeLine{00200     \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32     = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}})depthTile.getRaster();}
\DoxyCodeLine{00201     \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} ras64     = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}})depthTile.getRaster();}
\DoxyCodeLine{00202     lock.lockForRead();}
\DoxyCodeLine{00203     \textcolor{keywordflow}{if} (rasGR8)}
\DoxyCodeLine{00204       setDepthRasterGray<TRasterGR8P, TPixelGR8>(rasGR8, depth\_buff, dimOut);}
\DoxyCodeLine{00205     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rasGR16)}
\DoxyCodeLine{00206       setDepthRasterGray<TRasterGR16P, TPixelGR16>(rasGR16, depth\_buff, dimOut);}
\DoxyCodeLine{00207     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ras32)}
\DoxyCodeLine{00208       BokehUtils::setDepthRaster<TRaster32P, TPixel32>(ras32, depth\_buff,}
\DoxyCodeLine{00209                                                        dimOut);}
\DoxyCodeLine{00210     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ras64)}
\DoxyCodeLine{00211       BokehUtils::setDepthRaster<TRaster64P, TPixel64>(ras64, depth\_buff,}
\DoxyCodeLine{00212                                                        dimOut);}
\DoxyCodeLine{00213     lock.unlock();}
\DoxyCodeLine{00214   \}}
\DoxyCodeLine{00215   ctrls[1] = depth\_buff;}
\DoxyCodeLine{00216 }
\DoxyCodeLine{00217   layerValue.premultiply       = 2;  \textcolor{comment}{// auto}}
\DoxyCodeLine{00218   layerValue.layerHardness     = m\_hardness-\/>getValue(frame);}
\DoxyCodeLine{00219   layerValue.depth\_ref         = 1;}
\DoxyCodeLine{00220   layerValue.distance          = 0.5;}
\DoxyCodeLine{00221   layerValue.bokehAdjustment   = 1.0;}
\DoxyCodeLine{00222   layerValue.depthRange        = 1.0;}
\DoxyCodeLine{00223   layerValue.distancePrecision = m\_distancePrecision-\/>getValue();}
\DoxyCodeLine{00224   layerValue.fillGap           = m\_fillGap-\/>getValue();}
\DoxyCodeLine{00225   layerValue.doMedian          = m\_doMedian-\/>getValue();}
\DoxyCodeLine{00226   QList<LayerValue> layerValues;}
\DoxyCodeLine{00227   layerValues.append(layerValue);}
\DoxyCodeLine{00228 }
\DoxyCodeLine{00229   Iwa\_BokehCommonFx::doFx(tile, frame, settings, bokehPixelAmount, margin,}
\DoxyCodeLine{00230                           dimOut, irisBBox, irisTile, layerValues, ctrls);}
\DoxyCodeLine{00231 }
\DoxyCodeLine{00232   releaseAllRasters(rasterList);}
\DoxyCodeLine{00233   \textcolor{keyword}{delete} layerValue.sourceTile;}
\DoxyCodeLine{00234 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_a5c717c82847efd281b601f238da02ed8}\label{class_iwa___bokeh_ref_fx_a5c717c82847efd281b601f238da02ed8}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!setDepthRaster@{setDepthRaster}}
\index{setDepthRaster@{setDepthRaster}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{setDepthRaster()}{setDepthRaster()}}
{\footnotesize\ttfamily template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ \\
void Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::set\+Depth\+Raster (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}}}]{src\+Ras,  }\item[{unsigned char $\ast$}]{dst\+Mem,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}}}]{dim }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00043                                                      \{}
\DoxyCodeLine{00044   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* depth\_p = dstMem;}
\DoxyCodeLine{00045   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim.ly; j++) \{}
\DoxyCodeLine{00046     PIXEL* pix = srcRas-\/>pixels(j);}
\DoxyCodeLine{00047     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim.lx; i++, pix++, depth\_p++) \{}
\DoxyCodeLine{00048       \textcolor{comment}{// normalize brightness to 0-\/1}}
\DoxyCodeLine{00049       \textcolor{keywordtype}{double} val = ((double)pix-\/>r * 0.3 + (\textcolor{keywordtype}{double})pix-\/>g * 0.59 +}
\DoxyCodeLine{00050                     (double)pix-\/>b * 0.11) /}
\DoxyCodeLine{00051                    (double)PIXEL::maxChannelValue;}
\DoxyCodeLine{00052       \textcolor{comment}{// convert to unsigned char}}
\DoxyCodeLine{00053       (*depth\_p) = (\textcolor{keywordtype}{unsigned} char)(val * (\textcolor{keywordtype}{double})UCHAR\_MAX + 0.5);}
\DoxyCodeLine{00054     \}}
\DoxyCodeLine{00055   \}}
\DoxyCodeLine{00056 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_a150f8ebbd11f8756947847e3203553c3}\label{class_iwa___bokeh_ref_fx_a150f8ebbd11f8756947847e3203553c3}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!setDepthRasterGray@{setDepthRasterGray}}
\index{setDepthRasterGray@{setDepthRasterGray}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{setDepthRasterGray()}{setDepthRasterGray()}}
{\footnotesize\ttfamily template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ \\
void Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::set\+Depth\+Raster\+Gray (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}}}]{src\+Ras,  }\item[{unsigned char $\ast$}]{dst\+Mem,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}}}]{dim }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00061                                                          \{}
\DoxyCodeLine{00062   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* depth\_p = dstMem;}
\DoxyCodeLine{00063   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim.ly; j++) \{}
\DoxyCodeLine{00064     PIXEL* pix = srcRas-\/>pixels(j);}
\DoxyCodeLine{00065     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim.lx; i++, pix++, depth\_p++) \{}
\DoxyCodeLine{00066       \textcolor{comment}{// normalize brightness to 0-\/1}}
\DoxyCodeLine{00067       \textcolor{keywordtype}{double} val = (double)pix-\/>value / (\textcolor{keywordtype}{double})PIXEL::maxChannelValue;}
\DoxyCodeLine{00068       \textcolor{comment}{// convert to unsigned char}}
\DoxyCodeLine{00069       (*depth\_p) = (\textcolor{keywordtype}{unsigned} char)(val * (\textcolor{keywordtype}{double})UCHAR\_MAX + 0.5);}
\DoxyCodeLine{00070     \}}
\DoxyCodeLine{00071   \}}
\DoxyCodeLine{00072 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_a254bdfdd55bef69e1678335c6bdde194}\label{class_iwa___bokeh_ref_fx_a254bdfdd55bef69e1678335c6bdde194}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!m\_depth@{m\_depth}}
\index{m\_depth@{m\_depth}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{m\_depth}{m\_depth}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::m\+\_\+depth\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_aa43ea5ac135a77cef459ff5a5451782e}\label{class_iwa___bokeh_ref_fx_aa43ea5ac135a77cef459ff5a5451782e}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!m\_distancePrecision@{m\_distancePrecision}}
\index{m\_distancePrecision@{m\_distancePrecision}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{m\_distancePrecision}{m\_distancePrecision}}
{\footnotesize\ttfamily TInt\+ParamP Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::m\+\_\+distance\+Precision\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_a33acf8d6066f3c12577502c80a65f051}\label{class_iwa___bokeh_ref_fx_a33acf8d6066f3c12577502c80a65f051}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!m\_doMedian@{m\_doMedian}}
\index{m\_doMedian@{m\_doMedian}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{m\_doMedian}{m\_doMedian}}
{\footnotesize\ttfamily TBool\+ParamP Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::m\+\_\+do\+Median\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_a58a9971bce04c3b72994acf1134bf80e}\label{class_iwa___bokeh_ref_fx_a58a9971bce04c3b72994acf1134bf80e}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!m\_fillGap@{m\_fillGap}}
\index{m\_fillGap@{m\_fillGap}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{m\_fillGap}{m\_fillGap}}
{\footnotesize\ttfamily TBool\+ParamP Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::m\+\_\+fill\+Gap\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_iwa___bokeh_ref_fx_ab7d5e3f6e17b4daf7c825c6ccb1a0e66}\label{class_iwa___bokeh_ref_fx_ab7d5e3f6e17b4daf7c825c6ccb1a0e66}} 
\index{Iwa\_BokehRefFx@{Iwa\_BokehRefFx}!m\_source@{m\_source}}
\index{m\_source@{m\_source}!Iwa\_BokehRefFx@{Iwa\_BokehRefFx}}
\doxysubsubsection{\texorpdfstring{m\_source}{m\_source}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} Iwa\+\_\+\+Bokeh\+Ref\+Fx\+::m\+\_\+source\hspace{0.3cm}{\ttfamily [protected]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+bokehreffx.\+h\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+bokehreffx.\+cpp\end{DoxyCompactItemize}
