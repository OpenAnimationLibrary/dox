\hypertarget{class_stage_1_1_open_gl_painter}{}\doxysection{Stage\+::Open\+Gl\+Painter Class Reference}
\label{class_stage_1_1_open_gl_painter}\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}}


The derived \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}} responsible for camera-\/stand rendering in 3D mode.  




{\ttfamily \#include $<$stagevisitor.\+h$>$}

Inheritance diagram for Stage\+::Open\+Gl\+Painter\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_stage_1_1_open_gl_painter}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_stage_1_1_open_gl_painter_a968958fab6f9d91b0934b879208deecf}{Open\+Gl\+Painter}} (const \mbox{\hyperlink{class_t_affine}{TAffine}} \&view\+Aff, const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&rect, const \mbox{\hyperlink{class_image_painter_1_1_visual_settings}{Image\+Painter\+::\+Visual\+Settings}} \&vs, bool is\+Viewer, bool is\+Alpha\+Enabled)
\item 
bool \mbox{\hyperlink{class_stage_1_1_open_gl_painter_ab13cdec3d430e52618b5d34e663eca7d}{is\+Viewer}} () const
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_ad78233d6c3ed38ebee9d779c6013d951}{enable\+Camera3D}} (bool on)
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_af715366d37c7265dcdb4a54a842b6890}{set\+Phi}} (double phi)
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_adb45517f7bb2ade14744340154636550}{set\+Palette\+Has\+Changed}} (bool on)
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_aa272d21e8778083baba388d3a505eada}{on\+Image}} (const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data) override
\begin{DoxyCompactList}\small\item\em The {\itshape visitation} function. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_a17b83ff9db771f57c7f2bdf884c070a3}{on\+Vector\+Image}} (\mbox{\hyperlink{class_t_vector_image}{TVector\+Image}} $\ast$vi, const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data)
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_a11c70b39dcaf6a842545f4aac5764c3c}{on\+Raster\+Image}} (\mbox{\hyperlink{class_t_raster_image}{TRaster\+Image}} $\ast$ri, const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data)
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_a0a925f979066694a123635e46ca789fb}{on\+Toonz\+Image}} (\mbox{\hyperlink{class_t_toonz_image}{TToonz\+Image}} $\ast$ti, const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data)
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_a84c5e66552073a6c99622ab421d18692}{begin\+Mask}} () override
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_a1b0b641126e4b2baf5c4dc91521fbce3}{end\+Mask}} () override
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_a29a098a487c0539d8f2bf297a48b234f}{enable\+Mask}} () override
\item 
void \mbox{\hyperlink{class_stage_1_1_open_gl_painter_ac8386a86c309fe0c50ce7ca0f2b80cda}{disable\+Mask}} () override
\item 
double \mbox{\hyperlink{class_stage_1_1_open_gl_painter_a982c928d67476d76cbcc3257ddb047ec}{get\+MinZ}} () const
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
The derived \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}} responsible for camera-\/stand rendering in 3D mode. 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a968958fab6f9d91b0934b879208deecf}\label{class_stage_1_1_open_gl_painter_a968958fab6f9d91b0934b879208deecf}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!OpenGlPainter@{OpenGlPainter}}
\index{OpenGlPainter@{OpenGlPainter}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{OpenGlPainter()}{OpenGlPainter()}}
{\footnotesize\ttfamily Open\+Gl\+Painter\+::\+Open\+Gl\+Painter (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_affine}{TAffine}} \&}]{view\+Aff,  }\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{rect,  }\item[{const \mbox{\hyperlink{class_image_painter_1_1_visual_settings}{Image\+Painter\+::\+Visual\+Settings}} \&}]{vs,  }\item[{bool}]{is\+Viewer,  }\item[{bool}]{is\+Alpha\+Enabled }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01111     : \mbox{\hyperlink{class_stage_1_1_visitor}{Visitor}}(vs)}
\DoxyCodeLine{01112     , m\_viewAff(viewAff)}
\DoxyCodeLine{01113     , m\_clipRect(rect)}
\DoxyCodeLine{01114     , m\_camera3d(\textcolor{keyword}{false})}
\DoxyCodeLine{01115     , m\_phi(0)}
\DoxyCodeLine{01116     , m\_maskLevel(0)}
\DoxyCodeLine{01117     , m\_isViewer(isViewer)}
\DoxyCodeLine{01118     , m\_alphaEnabled(alphaEnabled)}
\DoxyCodeLine{01119     , m\_paletteHasChanged(\textcolor{keyword}{false})}
\DoxyCodeLine{01120     , m\_minZ(0) \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a84c5e66552073a6c99622ab421d18692}\label{class_stage_1_1_open_gl_painter_a84c5e66552073a6c99622ab421d18692}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!beginMask@{beginMask}}
\index{beginMask@{beginMask}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{beginMask()}{beginMask()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::begin\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01301                               \{}
\DoxyCodeLine{01302   ++m\_maskLevel;}
\DoxyCodeLine{01303   TStencilControl::instance()-\/>beginMask();}
\DoxyCodeLine{01304 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_ac8386a86c309fe0c50ce7ca0f2b80cda}\label{class_stage_1_1_open_gl_painter_ac8386a86c309fe0c50ce7ca0f2b80cda}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!disableMask@{disableMask}}
\index{disableMask@{disableMask}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{disableMask()}{disableMask()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::disable\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01312                                 \{}
\DoxyCodeLine{01313   TStencilControl::instance()-\/>disableMask();}
\DoxyCodeLine{01314 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_ad78233d6c3ed38ebee9d779c6013d951}\label{class_stage_1_1_open_gl_painter_ad78233d6c3ed38ebee9d779c6013d951}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!enableCamera3D@{enableCamera3D}}
\index{enableCamera3D@{enableCamera3D}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{enableCamera3D()}{enableCamera3D()}}
{\footnotesize\ttfamily void Stage\+::\+Open\+Gl\+Painter\+::enable\+Camera3D (\begin{DoxyParamCaption}\item[{bool}]{on }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00352 \{ m\_camera3d = on; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a29a098a487c0539d8f2bf297a48b234f}\label{class_stage_1_1_open_gl_painter_a29a098a487c0539d8f2bf297a48b234f}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!enableMask@{enableMask}}
\index{enableMask@{enableMask}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{enableMask()}{enableMask()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::enable\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01309                                \{}
\DoxyCodeLine{01310   TStencilControl::instance()-\/>enableMask(TStencilControl::SHOW\_INSIDE);}
\DoxyCodeLine{01311 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a1b0b641126e4b2baf5c4dc91521fbce3}\label{class_stage_1_1_open_gl_painter_a1b0b641126e4b2baf5c4dc91521fbce3}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!endMask@{endMask}}
\index{endMask@{endMask}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{endMask()}{endMask()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::end\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01305                             \{}
\DoxyCodeLine{01306   -\/-\/m\_maskLevel;}
\DoxyCodeLine{01307   TStencilControl::instance()-\/>endMask();}
\DoxyCodeLine{01308 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a982c928d67476d76cbcc3257ddb047ec}\label{class_stage_1_1_open_gl_painter_a982c928d67476d76cbcc3257ddb047ec}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!getMinZ@{getMinZ}}
\index{getMinZ@{getMinZ}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{getMinZ()}{getMinZ()}}
{\footnotesize\ttfamily double Stage\+::\+Open\+Gl\+Painter\+::get\+MinZ (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00366 \{ \textcolor{keywordflow}{return} m\_minZ; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_ab13cdec3d430e52618b5d34e663eca7d}\label{class_stage_1_1_open_gl_painter_ab13cdec3d430e52618b5d34e663eca7d}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!isViewer@{isViewer}}
\index{isViewer@{isViewer}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{isViewer()}{isViewer()}}
{\footnotesize\ttfamily bool Stage\+::\+Open\+Gl\+Painter\+::is\+Viewer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00351 \{ \textcolor{keywordflow}{return} m\_isViewer; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_aa272d21e8778083baba388d3a505eada}\label{class_stage_1_1_open_gl_painter_aa272d21e8778083baba388d3a505eada}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!onImage@{onImage}}
\index{onImage@{onImage}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{onImage()}{onImage()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::on\+Image (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{player }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



The {\itshape visitation} function. 



Implements \mbox{\hyperlink{class_stage_1_1_visitor_a4f6fa9bc6e68aaf2d1a2f5a69a0f8c53}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01124                                                      \{}
\DoxyCodeLine{01125   \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_a547b8839d602f6998a4b61a819478e6a}{m\_z}} < m\_minZ) m\_minZ = player.\mbox{\hyperlink{class_stage_1_1_player_a547b8839d602f6998a4b61a819478e6a}{m\_z}};}
\DoxyCodeLine{01126 }
\DoxyCodeLine{01127   glPushAttrib(GL\_ALL\_ATTRIB\_BITS);}
\DoxyCodeLine{01128   glPushMatrix();}
\DoxyCodeLine{01129 }
\DoxyCodeLine{01130   \textcolor{keywordflow}{if} (m\_camera3d)}
\DoxyCodeLine{01131     glTranslated(}
\DoxyCodeLine{01132         0, 0,}
\DoxyCodeLine{01133         player.\mbox{\hyperlink{class_stage_1_1_player_a547b8839d602f6998a4b61a819478e6a}{m\_z}});  \textcolor{comment}{// Ok, move object along z as specified in the player}}
\DoxyCodeLine{01134 }
\DoxyCodeLine{01135   \textcolor{comment}{// Attempt Plastic-\/deformed drawing}}
\DoxyCodeLine{01136   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj =}
\DoxyCodeLine{01137           ::plasticDeformedObj(player, \mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_aafe14ec520424843ecd9aca4abf02bf0}{m\_plasticVisualSettings}}))}
\DoxyCodeLine{01138     ::onPlasticDeformedImage(obj, player, \mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}, m\_viewAff);}
\DoxyCodeLine{01139   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\textcolor{keyword}{const} \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&image = player.\mbox{\hyperlink{class_stage_1_1_player_ae4853278eaaf00c28dd939dbb0de3647}{image}}()) \{}
\DoxyCodeLine{01140     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = image)}
\DoxyCodeLine{01141       onVectorImage(vi.getPointer(), player);}
\DoxyCodeLine{01142     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri = image)}
\DoxyCodeLine{01143       onRasterImage(ri.getPointer(), player);}
\DoxyCodeLine{01144     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti = image)}
\DoxyCodeLine{01145       onToonzImage(ti.getPointer(), player);}
\DoxyCodeLine{01146     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_mesh_image_p}{TMeshImageP}} mi = image)}
\DoxyCodeLine{01147       onMeshImage(mi.getPointer(), player, \mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}, m\_viewAff);}
\DoxyCodeLine{01148   \}}
\DoxyCodeLine{01149 }
\DoxyCodeLine{01150   glPopMatrix();}
\DoxyCodeLine{01151   glPopAttrib();}
\DoxyCodeLine{01152 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00051}{Stage\+::\+Player\+::image()}}, \mbox{\hyperlink{l00053}{Image\+Painter\+::\+Visual\+Settings\+::m\+\_\+plastic\+Visual\+Settings}}, \mbox{\hyperlink{l00093}{Stage\+::\+Visitor\+::m\+\_\+vs}}, and \mbox{\hyperlink{l00074}{Stage\+::\+Player\+::m\+\_\+z}}.

\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a11c70b39dcaf6a842545f4aac5764c3c}\label{class_stage_1_1_open_gl_painter_a11c70b39dcaf6a842545f4aac5764c3c}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!onRasterImage@{onRasterImage}}
\index{onRasterImage@{onRasterImage}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{onRasterImage()}{onRasterImage()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::on\+Raster\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_raster_image}{TRaster\+Image}} $\ast$}]{ri,  }\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01201                                                              \{}
\DoxyCodeLine{01202   \textcolor{keywordflow}{if} (m\_camera3d \&\& (player.m\_onionSkinDistance == c\_noOnionSkin ||}
\DoxyCodeLine{01203                      player.m\_onionSkinDistance == 0)) \{}
\DoxyCodeLine{01204     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox(ri-\/>\mbox{\hyperlink{class_t_raster_image_a2b267feb5611d2c21ff87d55528dd60f}{getBBox}}());}
\DoxyCodeLine{01205 }
\DoxyCodeLine{01206     \textcolor{comment}{// Since bbox is in image coordinates, adjust to level coordinates first}}
\DoxyCodeLine{01207     bbox -\/= ri-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>getCenterD() -\/ convert(ri-\/>\mbox{\hyperlink{class_t_raster_image_ae604776f6c4c9be2bd76d3ffb0543025}{getOffset}}());}
\DoxyCodeLine{01208 }
\DoxyCodeLine{01209     \textcolor{comment}{// Then, to world coordinates}}
\DoxyCodeLine{01210     bbox = player.m\_placement * player.m\_dpiAff * bbox;}
\DoxyCodeLine{01211 }
\DoxyCodeLine{01212     draw3DShadow(bbox, player.m\_z, m\_phi);}
\DoxyCodeLine{01213   \}}
\DoxyCodeLine{01214 }
\DoxyCodeLine{01215   \textcolor{keywordtype}{bool} tlvFlag = player.m\_sl \&\& player.m\_sl-\/>getType() == TZP\_XSHLEVEL;}
\DoxyCodeLine{01216 }
\DoxyCodeLine{01217   \textcolor{keywordflow}{if} (tlvFlag \&\&}
\DoxyCodeLine{01218       m\_paletteHasChanged)  \textcolor{comment}{// o.o! Raster images here -\/ should never be}}
\DoxyCodeLine{01219     assert(\textcolor{keyword}{false});          \textcolor{comment}{// dealing with tlv stuff!}}
\DoxyCodeLine{01220 }
\DoxyCodeLine{01221   \textcolor{keywordtype}{bool} premultiplied = tlvFlag;  \textcolor{comment}{// xD}}
\DoxyCodeLine{01222   \textcolor{keyword}{static} std::vector<char>}
\DoxyCodeLine{01223       matteChan;  \textcolor{comment}{// Wtf this is criminal. Although probably this}}
\DoxyCodeLine{01224                   \textcolor{comment}{// stuff is used only in the main thread... hmmm....}}
\DoxyCodeLine{01225   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} r = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}})ri-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}();}
\DoxyCodeLine{01226   r-\/>lock();}
\DoxyCodeLine{01227 }
\DoxyCodeLine{01228   \textcolor{keywordflow}{if} (c\_noOnionSkin != player.m\_onionSkinDistance) \{}
\DoxyCodeLine{01229     \textcolor{keywordtype}{double} fade =}
\DoxyCodeLine{01230         0.5 -\/ 0.45 * (1 -\/ 1 / (1 + 0.15 * abs(player.m\_onionSkinDistance)));}
\DoxyCodeLine{01231     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{int})matteChan.size() < r-\/>getLx() * r-\/>getLy())}
\DoxyCodeLine{01232       matteChan.resize(r-\/>getLx() * r-\/>getLy());}
\DoxyCodeLine{01233 }
\DoxyCodeLine{01234     \textcolor{keywordtype}{int} k = 0;}
\DoxyCodeLine{01235     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y = 0; y < r-\/>getLy(); ++y) \{}
\DoxyCodeLine{01236       TPixel32 *pix    = r-\/>pixels(y);}
\DoxyCodeLine{01237       TPixel32 *endPix = pix + r-\/>getLx();}
\DoxyCodeLine{01238 }
\DoxyCodeLine{01239       \textcolor{keywordflow}{while} (pix < endPix) \{}
\DoxyCodeLine{01240         matteChan[k++] = pix-\/>m;}
\DoxyCodeLine{01241         pix-\/>m         = (int)(pix-\/>m * fade);}
\DoxyCodeLine{01242         pix++;}
\DoxyCodeLine{01243       \}}
\DoxyCodeLine{01244     \}}
\DoxyCodeLine{01245 }
\DoxyCodeLine{01246     premultiplied = \textcolor{keyword}{false};  \textcolor{comment}{// pfff}}
\DoxyCodeLine{01247   \}}
\DoxyCodeLine{01248 }
\DoxyCodeLine{01249   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = player.m\_dpiAff;}
\DoxyCodeLine{01250 }
\DoxyCodeLine{01251   glPushAttrib(GL\_ALL\_ATTRIB\_BITS);}
\DoxyCodeLine{01252   tglEnableBlending(GL\_ONE, GL\_ONE\_MINUS\_SRC\_ALPHA);}
\DoxyCodeLine{01253 }
\DoxyCodeLine{01254   GLRasterPainter::drawRaster(m\_viewAff * player.m\_placement * aff *}
\DoxyCodeLine{01255                                   \mbox{\hyperlink{class_t_translation}{TTranslation}}(convert(ri-\/>\mbox{\hyperlink{class_t_raster_image_ae604776f6c4c9be2bd76d3ffb0543025}{getOffset}}())),}
\DoxyCodeLine{01256                               ri, premultiplied);}
\DoxyCodeLine{01257 }
\DoxyCodeLine{01258   glPopAttrib();}
\DoxyCodeLine{01259 }
\DoxyCodeLine{01260   \textcolor{keywordflow}{if} (c\_noOnionSkin != player.m\_onionSkinDistance) \{}
\DoxyCodeLine{01261     \textcolor{keywordtype}{int} k = 0;}
\DoxyCodeLine{01262     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y = 0; y < r-\/>getLy(); ++y) \{}
\DoxyCodeLine{01263       TPixel32 *pix    = r-\/>pixels(y);}
\DoxyCodeLine{01264       TPixel32 *endPix = pix + r-\/>getLx();}
\DoxyCodeLine{01265 }
\DoxyCodeLine{01266       \textcolor{keywordflow}{while} (pix < endPix) pix++-\/>m = matteChan[k++];}
\DoxyCodeLine{01267     \}}
\DoxyCodeLine{01268   \}}
\DoxyCodeLine{01269 }
\DoxyCodeLine{01270   r-\/>unlock();}
\DoxyCodeLine{01271 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a0a925f979066694a123635e46ca789fb}\label{class_stage_1_1_open_gl_painter_a0a925f979066694a123635e46ca789fb}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!onToonzImage@{onToonzImage}}
\index{onToonzImage@{onToonzImage}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{onToonzImage()}{onToonzImage()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::on\+Toonz\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_toonz_image}{TToonz\+Image}} $\ast$}]{ti,  }\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01275                                                                            \{}
\DoxyCodeLine{01276   \textcolor{keywordflow}{if} (m\_camera3d \&\& (player.m\_onionSkinDistance == c\_noOnionSkin ||}
\DoxyCodeLine{01277                      player.m\_onionSkinDistance == 0)) \{}
\DoxyCodeLine{01278     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox(ti-\/>\mbox{\hyperlink{class_t_toonz_image_ad53079df19255b853027235124fee4e0}{getBBox}}());}
\DoxyCodeLine{01279 }
\DoxyCodeLine{01280     bbox -\/= ti-\/>\mbox{\hyperlink{class_t_toonz_image_ae04ea13c3803157ac69b01a83ad65865}{getRaster}}()-\/>getCenterD();}
\DoxyCodeLine{01281     bbox = player.m\_placement * player.m\_dpiAff * bbox;}
\DoxyCodeLine{01282 }
\DoxyCodeLine{01283     draw3DShadow(bbox, player.m\_z, m\_phi);}
\DoxyCodeLine{01284   \}}
\DoxyCodeLine{01285 }
\DoxyCodeLine{01286   \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} ras = ti-\/>\mbox{\hyperlink{class_t_toonz_image_ae04ea13c3803157ac69b01a83ad65865}{getRaster}}();}
\DoxyCodeLine{01287   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32(ras-\/>getSize());}
\DoxyCodeLine{01288   ras32-\/>fill(TPixel32(0, 0, 0, 0));}
\DoxyCodeLine{01289 }
\DoxyCodeLine{01290   \textcolor{comment}{// onionSkin}}
\DoxyCodeLine{01291   \mbox{\hyperlink{namespace_t_rop_a1f6b04b4725e957a0d554e198e26a117}{TRop::quickPut}}(ras32, ras, ti-\/>getPalette(), \mbox{\hyperlink{class_t_affine}{TAffine}}());}
\DoxyCodeLine{01292   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = player.m\_dpiAff;}
\DoxyCodeLine{01293 }
\DoxyCodeLine{01294   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri(ras32);}
\DoxyCodeLine{01295 }
\DoxyCodeLine{01296   GLRasterPainter::drawRaster(m\_viewAff * player.m\_placement * aff, ri, \textcolor{keyword}{true});}
\DoxyCodeLine{01297 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_a17b83ff9db771f57c7f2bdf884c070a3}\label{class_stage_1_1_open_gl_painter_a17b83ff9db771f57c7f2bdf884c070a3}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!onVectorImage@{onVectorImage}}
\index{onVectorImage@{onVectorImage}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{onVectorImage()}{onVectorImage()}}
{\footnotesize\ttfamily void Open\+Gl\+Painter\+::on\+Vector\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_vector_image}{TVector\+Image}} $\ast$}]{vi,  }\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01157                                                              \{}
\DoxyCodeLine{01158   \textcolor{keywordflow}{if} (m\_camera3d \&\& (player.m\_onionSkinDistance == c\_noOnionSkin ||}
\DoxyCodeLine{01159                      player.m\_onionSkinDistance == 0)) \{}
\DoxyCodeLine{01160     \textcolor{keyword}{const} \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&bbox = player.m\_placement * player.m\_dpiAff * vi-\/>\mbox{\hyperlink{class_t_vector_image_a86205b8e894a807fe76937c923f6abc0}{getBBox}}();}
\DoxyCodeLine{01161     draw3DShadow(bbox, player.m\_z, m\_phi);}
\DoxyCodeLine{01162   \}}
\DoxyCodeLine{01163 }
\DoxyCodeLine{01164   \mbox{\hyperlink{class_t_color_function}{TColorFunction}} *cf = 0;}
\DoxyCodeLine{01165   \mbox{\hyperlink{class_t_onion_fader}{TOnionFader}} fader;}
\DoxyCodeLine{01166 }
\DoxyCodeLine{01167   \mbox{\hyperlink{class_t_palette}{TPalette}} *vPalette = vi-\/>getPalette();}
\DoxyCodeLine{01168 }
\DoxyCodeLine{01169   \textcolor{keywordtype}{int} oldFrame = vPalette-\/>\mbox{\hyperlink{class_t_palette_a7fd9f134eeffe1fa9ca39ee3fb6ad1b4}{getFrame}}();}
\DoxyCodeLine{01170   vPalette-\/>\mbox{\hyperlink{class_t_palette_aca7d99a4af59ffaed0ead1f8700c2edc}{setFrame}}(player.m\_frame);  \textcolor{comment}{// Hehe. Should be locking}}
\DoxyCodeLine{01171                                        \textcolor{comment}{// vPalette's mutex here...}}
\DoxyCodeLine{01172   \textcolor{keywordflow}{if} (player.m\_onionSkinDistance != c\_noOnionSkin) \{}
\DoxyCodeLine{01173     TPixel32 bgColor = TPixel32::White;}
\DoxyCodeLine{01174     fader            = \mbox{\hyperlink{class_t_onion_fader}{TOnionFader}}(}
\DoxyCodeLine{01175         bgColor, \mbox{\hyperlink{class_onion_skin_mask_a6a4c72b75d213e6a3fca82092a520824}{OnionSkinMask::getOnionSkinFade}}(player.m\_onionSkinDistance));}
\DoxyCodeLine{01176     cf = \&fader;}
\DoxyCodeLine{01177   \}}
\DoxyCodeLine{01178 }
\DoxyCodeLine{01179   \mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}} rd =}
\DoxyCodeLine{01180       isViewer() ? \mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}}(\mbox{\hyperlink{struct_t_vector_render_data_1_1_viewer_settings}{TVectorRenderData::ViewerSettings}}(),}
\DoxyCodeLine{01181                                      m\_viewAff * player.m\_placement, m\_clipRect,}
\DoxyCodeLine{01182                                      vPalette)}
\DoxyCodeLine{01183                  : \mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}}(\mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}}::ProductionSettings(),}
\DoxyCodeLine{01184                                      m\_viewAff * player.m\_placement, m\_clipRect,}
\DoxyCodeLine{01185                                      vPalette);}
\DoxyCodeLine{01186 }
\DoxyCodeLine{01187   rd.\mbox{\hyperlink{class_t_vector_render_data_a75d54ed25ecf340d2b4be400653fbc43}{m\_alphaChannel}} = m\_alphaEnabled;}
\DoxyCodeLine{01188   rd.\mbox{\hyperlink{class_t_vector_render_data_a5cd0b8011bb3ee5da80d5ac6ca0425a3}{m\_is3dView}}     = m\_camera3d;}
\DoxyCodeLine{01189 }
\DoxyCodeLine{01190   \textcolor{keywordflow}{if} (m\_maskLevel > 0)}
\DoxyCodeLine{01191     tglDrawMask(rd, vi);}
\DoxyCodeLine{01192   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01193     tglDraw(rd, vi);}
\DoxyCodeLine{01194 }
\DoxyCodeLine{01195   vPalette-\/>\mbox{\hyperlink{class_t_palette_aca7d99a4af59ffaed0ead1f8700c2edc}{setFrame}}(oldFrame);}
\DoxyCodeLine{01196 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_adb45517f7bb2ade14744340154636550}\label{class_stage_1_1_open_gl_painter_adb45517f7bb2ade14744340154636550}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!setPaletteHasChanged@{setPaletteHasChanged}}
\index{setPaletteHasChanged@{setPaletteHasChanged}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{setPaletteHasChanged()}{setPaletteHasChanged()}}
{\footnotesize\ttfamily void Stage\+::\+Open\+Gl\+Painter\+::set\+Palette\+Has\+Changed (\begin{DoxyParamCaption}\item[{bool}]{on }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00354 \{ m\_paletteHasChanged = on; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_open_gl_painter_af715366d37c7265dcdb4a54a842b6890}\label{class_stage_1_1_open_gl_painter_af715366d37c7265dcdb4a54a842b6890}} 
\index{Stage::OpenGlPainter@{Stage::OpenGlPainter}!setPhi@{setPhi}}
\index{setPhi@{setPhi}!Stage::OpenGlPainter@{Stage::OpenGlPainter}}
\doxysubsubsection{\texorpdfstring{setPhi()}{setPhi()}}
{\footnotesize\ttfamily void Stage\+::\+Open\+Gl\+Painter\+::set\+Phi (\begin{DoxyParamCaption}\item[{double}]{phi }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00353 \{ m\_phi = phi; \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/toonz/stagevisitor.\+h\item 
E\+:/opentoonz/toonz/sources/toonzlib/stagevisitor.\+cpp\end{DoxyCompactItemize}
