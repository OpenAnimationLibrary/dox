\hypertarget{class_vectorization_swatch_task}{}\doxysection{Vectorization\+Swatch\+Task Class Reference}
\label{class_vectorization_swatch_task}\index{VectorizationSwatchTask@{VectorizationSwatchTask}}
Inheritance diagram for Vectorization\+Swatch\+Task\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_vectorization_swatch_task}
\end{center}
\end{figure}
\doxysubsection*{Signals}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_vectorization_swatch_task_a471b3b905099286f2a6a82af858cd398}\label{class_vectorization_swatch_task_a471b3b905099286f2a6a82af858cd398}} 
void {\bfseries my\+Started} (\mbox{\hyperlink{class_t_smart_pointer_t}{TThread\+::\+RunnableP}} task)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_vectorization_swatch_task_a9a572ce949d27efcdcc594c916dfede5}{Vectorization\+Swatch\+Task}} (int row, int col, \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} substitute\+Palette=\mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}}())
\item 
void \mbox{\hyperlink{class_vectorization_swatch_task_a5860ad48ba39f5e71b0486b65bd44246}{run}} () override
\begin{DoxyCompactList}\small\item\em The central code of the task that is executed by a worker thread. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_vectorization_swatch_task_a0d12be0521240b78940f782f279a3ea5}{on\+Started}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TThread\+::\+RunnableP}} task) override
\item 
void \mbox{\hyperlink{class_vectorization_swatch_task_aa4d5f1bc292d9970aa26ebdbb0d62256}{on\+Finished}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TThread\+::\+RunnableP}} task) override
\begin{DoxyCompactList}\small\item\em The analogous of \mbox{\hyperlink{class_vectorization_swatch_task_a0d12be0521240b78940f782f279a3ea5}{on\+Started()}} for the \mbox{\hyperlink{class_t_thread_1_1_runnable_a77da4aa600bdb892b55312efcd6e3a21}{finished()}} signal. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_vectorization_swatch_task_a9a572ce949d27efcdcc594c916dfede5}\label{class_vectorization_swatch_task_a9a572ce949d27efcdcc594c916dfede5}} 
\index{VectorizationSwatchTask@{VectorizationSwatchTask}!VectorizationSwatchTask@{VectorizationSwatchTask}}
\index{VectorizationSwatchTask@{VectorizationSwatchTask}!VectorizationSwatchTask@{VectorizationSwatchTask}}
\doxysubsubsection{\texorpdfstring{VectorizationSwatchTask()}{VectorizationSwatchTask()}}
{\footnotesize\ttfamily Vectorization\+Swatch\+Task\+::\+Vectorization\+Swatch\+Task (\begin{DoxyParamCaption}\item[{int}]{row,  }\item[{int}]{col,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}}}]{substitute\+Palette = {\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}}()} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00225     : m\_row(row), m\_col(col), m\_substitutePalette(substitutePalette) \{}
\DoxyCodeLine{00226   \textcolor{comment}{// Establish connections to default slots; the started one must be blocking,}}
\DoxyCodeLine{00227   \textcolor{comment}{// so that run() awaits until it has been performed.}}
\DoxyCodeLine{00228 }
\DoxyCodeLine{00229   connect(\textcolor{keyword}{this}, SIGNAL(myStarted(\mbox{\hyperlink{class_t_smart_pointer_t}{TThread::RunnableP}})),}
\DoxyCodeLine{00230           SLOT(\mbox{\hyperlink{class_vectorization_swatch_task_a0d12be0521240b78940f782f279a3ea5}{onStarted}}(\mbox{\hyperlink{class_t_smart_pointer_t}{TThread::RunnableP}})), Qt::BlockingQueuedConnection);}
\DoxyCodeLine{00231   connect(\textcolor{keyword}{this}, SIGNAL(\mbox{\hyperlink{class_t_thread_1_1_runnable_a77da4aa600bdb892b55312efcd6e3a21}{finished}}(\mbox{\hyperlink{class_t_smart_pointer_t}{TThread::RunnableP}})),}
\DoxyCodeLine{00232           SLOT(\mbox{\hyperlink{class_vectorization_swatch_task_aa4d5f1bc292d9970aa26ebdbb0d62256}{onFinished}}(\mbox{\hyperlink{class_t_smart_pointer_t}{TThread::RunnableP}})));}
\DoxyCodeLine{00233 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_vectorization_swatch_task_aa4d5f1bc292d9970aa26ebdbb0d62256}\label{class_vectorization_swatch_task_aa4d5f1bc292d9970aa26ebdbb0d62256}} 
\index{VectorizationSwatchTask@{VectorizationSwatchTask}!onFinished@{onFinished}}
\index{onFinished@{onFinished}!VectorizationSwatchTask@{VectorizationSwatchTask}}
\doxysubsubsection{\texorpdfstring{onFinished()}{onFinished()}}
{\footnotesize\ttfamily void Vectorization\+Swatch\+Task\+::on\+Finished (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TThread\+::\+RunnableP}}}]{sender }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



The analogous of \mbox{\hyperlink{class_vectorization_swatch_task_a0d12be0521240b78940f782f279a3ea5}{on\+Started()}} for the \mbox{\hyperlink{class_t_thread_1_1_runnable_a77da4aa600bdb892b55312efcd6e3a21}{finished()}} signal. 



Reimplemented from \mbox{\hyperlink{class_t_thread_1_1_runnable_ae08796496a74b40c4e1940e386f7926f}{TThread\+::\+Runnable}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00304                                                               \{}
\DoxyCodeLine{00305   \textcolor{keywordflow}{if} (m\_image) \{}
\DoxyCodeLine{00306     VectorizationBuilder *builder = VectorizationBuilder::instance();}
\DoxyCodeLine{00307 }
\DoxyCodeLine{00308     \textcolor{keywordflow}{if} (builder-\/>m\_row == m\_row \&\& builder-\/>m\_col == m\_col) \{}
\DoxyCodeLine{00309       builder-\/>m\_done = \textcolor{keyword}{true};}
\DoxyCodeLine{00310       builder-\/>notifyDone(m\_image);}
\DoxyCodeLine{00311     \}}
\DoxyCodeLine{00312   \}}
\DoxyCodeLine{00313 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_vectorization_swatch_task_a0d12be0521240b78940f782f279a3ea5}\label{class_vectorization_swatch_task_a0d12be0521240b78940f782f279a3ea5}} 
\index{VectorizationSwatchTask@{VectorizationSwatchTask}!onStarted@{onStarted}}
\index{onStarted@{onStarted}!VectorizationSwatchTask@{VectorizationSwatchTask}}
\doxysubsubsection{\texorpdfstring{onStarted()}{onStarted()}}
{\footnotesize\ttfamily void Vectorization\+Swatch\+Task\+::on\+Started (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TThread\+::\+RunnableP}}}]{sender }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Convenience slot for the \mbox{\hyperlink{class_t_thread_1_1_runnable_a4603628ddbc41e9e73e027e8f817bff1}{started()}} signal -\/ so it\textquotesingle{}s not necessary to declare the task in a header file for moc\textquotesingle{}ing each time. You must both reimplement {\bfseries{and}} connect it to the \mbox{\hyperlink{class_t_thread_1_1_runnable_a4603628ddbc41e9e73e027e8f817bff1}{started()}} signal to make it work. 

Reimplemented from \mbox{\hyperlink{class_t_thread_1_1_runnable_a0857d4a039557f2853a12203ea854f01}{TThread\+::\+Runnable}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00237                                                              \{}
\DoxyCodeLine{00238   VectorizationBuilder *builder = VectorizationBuilder::instance();}
\DoxyCodeLine{00239 }
\DoxyCodeLine{00240   \textcolor{keywordflow}{if} (builder-\/>m\_done || builder-\/>m\_row != m\_row || builder-\/>m\_col != m\_col)}
\DoxyCodeLine{00241     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00242 }
\DoxyCodeLine{00243   \textcolor{comment}{// Retrieve the image to be vectorized}}
\DoxyCodeLine{00244   m\_image = getXsheetImage(m\_row, m\_col);}
\DoxyCodeLine{00245 }
\DoxyCodeLine{00246   \textcolor{comment}{// Build the vectorization configuration}}
\DoxyCodeLine{00247   m\_config = getCurrentVectorizerConfiguration(m\_row, m\_col);}
\DoxyCodeLine{00248 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_vectorization_swatch_task_a5860ad48ba39f5e71b0486b65bd44246}\label{class_vectorization_swatch_task_a5860ad48ba39f5e71b0486b65bd44246}} 
\index{VectorizationSwatchTask@{VectorizationSwatchTask}!run@{run}}
\index{run@{run}!VectorizationSwatchTask@{VectorizationSwatchTask}}
\doxysubsubsection{\texorpdfstring{run()}{run()}}
{\footnotesize\ttfamily void Vectorization\+Swatch\+Task\+::run (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



The central code of the task that is executed by a worker thread. 



Implements \mbox{\hyperlink{class_t_thread_1_1_runnable_ad3b8ee5e7b375bd169f7382fa26b00ef}{TThread\+::\+Runnable}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00252                                   \{}
\DoxyCodeLine{00253   emit myStarted(\textcolor{keyword}{this});}
\DoxyCodeLine{00254 }
\DoxyCodeLine{00255   \textcolor{keywordflow}{if} (!m\_image || !m\_config.get()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00256 }
\DoxyCodeLine{00257   \textcolor{comment}{// The task must be performed -\/ retrieve and prepare configuration data}}
\DoxyCodeLine{00258   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{00259 }
\DoxyCodeLine{00260   \mbox{\hyperlink{class_vectorizer_configuration}{VectorizerConfiguration}} *c = m\_config.get();}
\DoxyCodeLine{00261 }
\DoxyCodeLine{00262   \textcolor{comment}{// Build additional configuration data}}
\DoxyCodeLine{00263   \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} palette;}
\DoxyCodeLine{00264   \mbox{\hyperlink{class_t_point_t}{TPointD}} center, dpi;}
\DoxyCodeLine{00265 }
\DoxyCodeLine{00266   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti = m\_image) \{}
\DoxyCodeLine{00267     palette = (m\_substitutePalette) ? m\_substitutePalette : ti-\/>getPalette();}
\DoxyCodeLine{00268     center  = ti-\/>getRaster()-\/>getCenterD();}
\DoxyCodeLine{00269     ti-\/>getDpi(dpi.x, dpi.y);}
\DoxyCodeLine{00270   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri = m\_image) \{}
\DoxyCodeLine{00271     palette = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_palette}{TPalette}};}
\DoxyCodeLine{00272     center  = ri-\/>getRaster()-\/>getCenterD();}
\DoxyCodeLine{00273     ri-\/>getDpi(dpi.x, dpi.y);}
\DoxyCodeLine{00274   \}}
\DoxyCodeLine{00275 }
\DoxyCodeLine{00276   \textcolor{comment}{// In case the image has no dpi, use the standard dpi (same one the}}
\DoxyCodeLine{00277   \textcolor{comment}{// PlaneViewer will show}}
\DoxyCodeLine{00278   \textcolor{comment}{// the raster image with)}}
\DoxyCodeLine{00279   \textcolor{keywordflow}{if} (dpi.x == 0.0 || dpi.y == 0.0) dpi.x = dpi.y = \mbox{\hyperlink{namespace_stage_ad3e22e31e2bb6fc1d95a572facce2d5b}{Stage::inch}};}
\DoxyCodeLine{00280 }
\DoxyCodeLine{00281   \textcolor{comment}{// The vectorized image must feel the same visualization transform as m\_image.}}
\DoxyCodeLine{00282   \textcolor{comment}{// We're transforming the image itself, rather than having it transformed at}}
\DoxyCodeLine{00283   \textcolor{comment}{// every paint event.}}
\DoxyCodeLine{00284 }
\DoxyCodeLine{00285   \textcolor{comment}{// NOTE: It would be best if the transform was the same found from the}}
\DoxyCodeLine{00286   \textcolor{comment}{// VectorizerPopup...}}
\DoxyCodeLine{00287   \textcolor{comment}{// Unfortunately, this would mean accessing the level's dpi value, thus having}}
\DoxyCodeLine{00288   \textcolor{comment}{// to rewrite quite}}
\DoxyCodeLine{00289   \textcolor{comment}{// some code around here...}}
\DoxyCodeLine{00290   c-\/>\mbox{\hyperlink{class_vectorizer_configuration_a35f1f35835fee0dfe6aaf83fa9ea1489}{m\_affine}} =}
\DoxyCodeLine{00291       \mbox{\hyperlink{class_t_scale}{TScale}}(\mbox{\hyperlink{namespace_stage_ad3e22e31e2bb6fc1d95a572facce2d5b}{Stage::inch}} / dpi.x, \mbox{\hyperlink{namespace_stage_ad3e22e31e2bb6fc1d95a572facce2d5b}{Stage::inch}} / dpi.y) * \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/center);}
\DoxyCodeLine{00292   c-\/>\mbox{\hyperlink{class_vectorizer_configuration_a3af044b6f16e74b4b03ce0dccf76b9bc}{m\_thickScale}} = \mbox{\hyperlink{namespace_stage_ad3e22e31e2bb6fc1d95a572facce2d5b}{Stage::inch}} / dpi.x;}
\DoxyCodeLine{00293 }
\DoxyCodeLine{00294   \textcolor{comment}{// Vectorize the image}}
\DoxyCodeLine{00295   \mbox{\hyperlink{class_vectorizer_core}{VectorizerCore}} vectorizer;}
\DoxyCodeLine{00296   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = vectorizer.\mbox{\hyperlink{class_vectorizer_core_ac12b78770400b604498680eff445f244}{vectorize}}(m\_image, *c, palette.getPointer());}
\DoxyCodeLine{00297   vi-\/>setPalette(palette.getPointer());}
\DoxyCodeLine{00298 }
\DoxyCodeLine{00299   m\_image = vi;}
\DoxyCodeLine{00300 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00106}{TApp\+::get\+Current\+Scene()}}, \mbox{\hyperlink{l00037}{Stage\+::inch}}, \mbox{\hyperlink{l00215}{TApp\+::instance()}}, \mbox{\hyperlink{l00061}{Vectorizer\+Configuration\+::m\+\_\+affine}}, \mbox{\hyperlink{l00062}{Vectorizer\+Configuration\+::m\+\_\+thick\+Scale}}, and \mbox{\hyperlink{l01612}{Vectorizer\+Core\+::vectorize()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonz/vectorizerswatch.\+h\item 
E\+:/opentoonz/toonz/sources/toonz/vectorizerswatch.\+cpp\end{DoxyCompactItemize}
