\hypertarget{class_bokeh_utils_1_1_my_thread}{}\doxysection{Bokeh\+Utils\+::My\+Thread Class Reference}
\label{class_bokeh_utils_1_1_my_thread}\index{BokehUtils::MyThread@{BokehUtils::MyThread}}
Inheritance diagram for Bokeh\+Utils\+::My\+Thread\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_bokeh_utils_1_1_my_thread}
\end{center}
\end{figure}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Channel} \{ {\bfseries Red} = 0
, {\bfseries Green}
, {\bfseries Blue}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_bokeh_utils_1_1_my_thread_aee54f9ad01f49a7f33f93b8b2979aba5}{My\+Thread}} (Channel channel, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} layer\+Tile\+Ras, \mbox{\hyperlink{structdouble4}{double4}} $\ast$result, double $\ast$alpha\+\_\+bokeh, kiss\+\_\+fft\+\_\+cpx $\ast$kissfft\+\_\+comp\+\_\+iris, double layer\+Hardness, double master\+Hardness=0.\+0, bool do\+Lighten\+Comp=false)
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ }\\void \mbox{\hyperlink{class_bokeh_utils_1_1_my_thread_a45a23e954e2512e197fb671d416161f9}{set\+Layer\+Raster}} (const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} src\+Ras, kiss\+\_\+fft\+\_\+cpx $\ast$dst\+Mem, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dim)
\item 
void \mbox{\hyperlink{class_bokeh_utils_1_1_my_thread_a48f2e366e852087c53705f64e1ee65c2}{run}} ()
\item 
bool \mbox{\hyperlink{class_bokeh_utils_1_1_my_thread_a8da4b3f334b4fa9b4290f4515678095b}{is\+Finished}} ()
\item 
bool \mbox{\hyperlink{class_bokeh_utils_1_1_my_thread_a0973bb45efbd42d51be0018756dbaed7}{init}} ()
\item 
void \mbox{\hyperlink{class_bokeh_utils_1_1_my_thread_a813a5d69cf6dd4678a40008040813ab9}{terminate\+Thread}} ()
\item 
bool \mbox{\hyperlink{class_bokeh_utils_1_1_my_thread_a1a8d72a054be47cf70f6e51b0dffd3ff}{check\+Termination\+And\+Cleanup\+Thread}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_a86c2d4e91bafd70a546018c161c43a15}\label{class_bokeh_utils_1_1_my_thread_a86c2d4e91bafd70a546018c161c43a15}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!Channel@{Channel}}
\index{Channel@{Channel}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{Channel}{Channel}}
{\footnotesize\ttfamily enum Bokeh\+Utils\+::\+My\+Thread\+::\+Channel}


\begin{DoxyCode}{0}
\DoxyCodeLine{00035 \{ Red = 0, Green, Blue \};}

\end{DoxyCode}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_aee54f9ad01f49a7f33f93b8b2979aba5}\label{class_bokeh_utils_1_1_my_thread_aee54f9ad01f49a7f33f93b8b2979aba5}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!MyThread@{MyThread}}
\index{MyThread@{MyThread}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{MyThread()}{MyThread()}}
{\footnotesize\ttfamily My\+Thread\+::\+My\+Thread (\begin{DoxyParamCaption}\item[{Channel}]{channel,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}}]{layer\+Tile\+Ras,  }\item[{\mbox{\hyperlink{structdouble4}{double4}} $\ast$}]{result,  }\item[{double $\ast$}]{alpha\+\_\+bokeh,  }\item[{kiss\+\_\+fft\+\_\+cpx $\ast$}]{kissfft\+\_\+comp\+\_\+iris,  }\item[{double}]{layer\+Hardness,  }\item[{double}]{master\+Hardness = {\ttfamily 0.0},  }\item[{bool}]{do\+Lighten\+Comp = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00067     : m\_channel(channel)}
\DoxyCodeLine{00068     , m\_layerTileRas(layerTileRas)}
\DoxyCodeLine{00069     , m\_result(result)}
\DoxyCodeLine{00070     , m\_alpha\_bokeh(alpha\_bokeh)}
\DoxyCodeLine{00071     , m\_kissfft\_comp\_iris(kissfft\_comp\_iris)}
\DoxyCodeLine{00072     , m\_layerHardness(layerHardness)}
\DoxyCodeLine{00073     , m\_masterHardness(masterHardness)}
\DoxyCodeLine{00074     , m\_finished(\textcolor{keyword}{false})}
\DoxyCodeLine{00075     , m\_kissfft\_comp\_in(0)}
\DoxyCodeLine{00076     , m\_kissfft\_comp\_out(0)}
\DoxyCodeLine{00077     , m\_isTerminated(\textcolor{keyword}{false})}
\DoxyCodeLine{00078     , m\_doLightenComp(doLightenComp) \{}
\DoxyCodeLine{00079   \textcolor{keywordflow}{if} (m\_masterHardness == 0.0) m\_masterHardness = m\_layerHardness;}
\DoxyCodeLine{00080 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_a1a8d72a054be47cf70f6e51b0dffd3ff}\label{class_bokeh_utils_1_1_my_thread_a1a8d72a054be47cf70f6e51b0dffd3ff}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!checkTerminationAndCleanupThread@{checkTerminationAndCleanupThread}}
\index{checkTerminationAndCleanupThread@{checkTerminationAndCleanupThread}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{checkTerminationAndCleanupThread()}{checkTerminationAndCleanupThread()}}
{\footnotesize\ttfamily bool My\+Thread\+::check\+Termination\+And\+Cleanup\+Thread (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00298                                                           \{}
\DoxyCodeLine{00299   \textcolor{keywordflow}{if} (!m\_isTerminated) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00300 }
\DoxyCodeLine{00301   \textcolor{keywordflow}{if} (m\_kissfft\_comp\_in) m\_kissfft\_comp\_in\_ras-\/>unlock();}
\DoxyCodeLine{00302   \textcolor{keywordflow}{if} (m\_kissfft\_comp\_out) m\_kissfft\_comp\_out\_ras-\/>unlock();}
\DoxyCodeLine{00303 }
\DoxyCodeLine{00304   \textcolor{keywordflow}{if} (m\_kissfft\_plan\_fwd) kiss\_fft\_free(m\_kissfft\_plan\_fwd);}
\DoxyCodeLine{00305   \textcolor{keywordflow}{if} (m\_kissfft\_plan\_bkwd) kiss\_fft\_free(m\_kissfft\_plan\_bkwd);}
\DoxyCodeLine{00306 }
\DoxyCodeLine{00307   m\_finished = \textcolor{keyword}{true};}
\DoxyCodeLine{00308   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00309 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_a0973bb45efbd42d51be0018756dbaed7}\label{class_bokeh_utils_1_1_my_thread_a0973bb45efbd42d51be0018756dbaed7}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!init@{init}}
\index{init@{init}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily bool My\+Thread\+::init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00082                               \{}
\DoxyCodeLine{00083   \textcolor{comment}{// obtain the input image size}}
\DoxyCodeLine{00084   \textcolor{keywordtype}{int} lx, ly;}
\DoxyCodeLine{00085   lx = m\_layerTileRas-\/>getSize().lx;}
\DoxyCodeLine{00086   ly = m\_layerTileRas-\/>getSize().ly;}
\DoxyCodeLine{00087 }
\DoxyCodeLine{00088   \textcolor{comment}{// memory allocation for input}}
\DoxyCodeLine{00089   m\_kissfft\_comp\_in\_ras = \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}}(lx * \textcolor{keyword}{sizeof}(kiss\_fft\_cpx), ly);}
\DoxyCodeLine{00090   m\_kissfft\_comp\_in\_ras-\/>lock();}
\DoxyCodeLine{00091   m\_kissfft\_comp\_in = (kiss\_fft\_cpx*)m\_kissfft\_comp\_in\_ras-\/>getRawData();}
\DoxyCodeLine{00092 }
\DoxyCodeLine{00093   \textcolor{comment}{// allocation check}}
\DoxyCodeLine{00094   \textcolor{keywordflow}{if} (m\_kissfft\_comp\_in == 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096   \textcolor{comment}{// cancel check}}
\DoxyCodeLine{00097   \textcolor{keywordflow}{if} (m\_isTerminated) \{}
\DoxyCodeLine{00098     m\_kissfft\_comp\_in\_ras-\/>unlock();}
\DoxyCodeLine{00099     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00100   \}}
\DoxyCodeLine{00101 }
\DoxyCodeLine{00102   \textcolor{comment}{// memory allocation for output}}
\DoxyCodeLine{00103   m\_kissfft\_comp\_out\_ras = \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}}(lx * \textcolor{keyword}{sizeof}(kiss\_fft\_cpx), ly);}
\DoxyCodeLine{00104   m\_kissfft\_comp\_out\_ras-\/>lock();}
\DoxyCodeLine{00105   m\_kissfft\_comp\_out = (kiss\_fft\_cpx*)m\_kissfft\_comp\_out\_ras-\/>getRawData();}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107   \textcolor{comment}{// allocation check}}
\DoxyCodeLine{00108   \textcolor{keywordflow}{if} (m\_kissfft\_comp\_out == 0) \{}
\DoxyCodeLine{00109     m\_kissfft\_comp\_in\_ras-\/>unlock();}
\DoxyCodeLine{00110     m\_kissfft\_comp\_in = 0;}
\DoxyCodeLine{00111     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00112   \}}
\DoxyCodeLine{00113 }
\DoxyCodeLine{00114   \textcolor{comment}{// cancel check}}
\DoxyCodeLine{00115   \textcolor{keywordflow}{if} (m\_isTerminated) \{}
\DoxyCodeLine{00116     m\_kissfft\_comp\_in\_ras-\/>unlock();}
\DoxyCodeLine{00117     m\_kissfft\_comp\_in = 0;}
\DoxyCodeLine{00118     m\_kissfft\_comp\_out\_ras-\/>unlock();}
\DoxyCodeLine{00119     m\_kissfft\_comp\_out = 0;}
\DoxyCodeLine{00120     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00121   \}}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123   \textcolor{comment}{// create the forward FFT plan}}
\DoxyCodeLine{00124   \textcolor{keywordtype}{int} dims[2]        = \{ly, lx\};}
\DoxyCodeLine{00125   \textcolor{keywordtype}{int} ndims          = 2;}
\DoxyCodeLine{00126   m\_kissfft\_plan\_fwd = kiss\_fftnd\_alloc(dims, ndims, \textcolor{keyword}{false}, 0, 0);}
\DoxyCodeLine{00127   \textcolor{comment}{// allocation and cancel check}}
\DoxyCodeLine{00128   \textcolor{keywordflow}{if} (m\_kissfft\_plan\_fwd == NULL || m\_isTerminated) \{}
\DoxyCodeLine{00129     m\_kissfft\_comp\_in\_ras-\/>unlock();}
\DoxyCodeLine{00130     m\_kissfft\_comp\_in = 0;}
\DoxyCodeLine{00131     m\_kissfft\_comp\_out\_ras-\/>unlock();}
\DoxyCodeLine{00132     m\_kissfft\_comp\_out = 0;}
\DoxyCodeLine{00133     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00134   \}}
\DoxyCodeLine{00135 }
\DoxyCodeLine{00136   \textcolor{comment}{// create the backward FFT plan}}
\DoxyCodeLine{00137   m\_kissfft\_plan\_bkwd = kiss\_fftnd\_alloc(dims, ndims, \textcolor{keyword}{true}, 0, 0);}
\DoxyCodeLine{00138   \textcolor{comment}{// allocation and cancel check}}
\DoxyCodeLine{00139   \textcolor{keywordflow}{if} (m\_kissfft\_plan\_bkwd == NULL || m\_isTerminated) \{}
\DoxyCodeLine{00140     m\_kissfft\_comp\_in\_ras-\/>unlock();}
\DoxyCodeLine{00141     m\_kissfft\_comp\_in = 0;}
\DoxyCodeLine{00142     m\_kissfft\_comp\_out\_ras-\/>unlock();}
\DoxyCodeLine{00143     m\_kissfft\_comp\_out = 0;}
\DoxyCodeLine{00144     kiss\_fft\_free(m\_kissfft\_plan\_fwd);}
\DoxyCodeLine{00145     m\_kissfft\_plan\_fwd = NULL;}
\DoxyCodeLine{00146     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00147   \}}
\DoxyCodeLine{00148 }
\DoxyCodeLine{00149   \textcolor{comment}{// return true if all the initializations are done}}
\DoxyCodeLine{00150   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00151 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_a8da4b3f334b4fa9b4290f4515678095b}\label{class_bokeh_utils_1_1_my_thread_a8da4b3f334b4fa9b4290f4515678095b}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!isFinished@{isFinished}}
\index{isFinished@{isFinished}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{isFinished()}{isFinished()}}
{\footnotesize\ttfamily bool Bokeh\+Utils\+::\+My\+Thread\+::is\+Finished (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00075 \{ \textcolor{keywordflow}{return} m\_finished; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_a48f2e366e852087c53705f64e1ee65c2}\label{class_bokeh_utils_1_1_my_thread_a48f2e366e852087c53705f64e1ee65c2}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!run@{run}}
\index{run@{run}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{run()}{run()}}
{\footnotesize\ttfamily void My\+Thread\+::run (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00181                              \{}
\DoxyCodeLine{00182   \textcolor{comment}{// get the source image size}}
\DoxyCodeLine{00183   \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dim = m\_layerTileRas-\/>getSize();}
\DoxyCodeLine{00184   \textcolor{comment}{// int lx,ly;}}
\DoxyCodeLine{00185   \textcolor{keywordtype}{int} lx = m\_layerTileRas-\/>getSize().lx;}
\DoxyCodeLine{00186   \textcolor{keywordtype}{int} ly = m\_layerTileRas-\/>getSize().ly;}
\DoxyCodeLine{00187 }
\DoxyCodeLine{00188   \textcolor{comment}{// initialize}}
\DoxyCodeLine{00189   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim.lx * dim.ly; i++) \{}
\DoxyCodeLine{00190     m\_kissfft\_comp\_in[i].r = 0.0;  \textcolor{comment}{// real part}}
\DoxyCodeLine{00191     m\_kissfft\_comp\_in[i].i = 0.0;  \textcolor{comment}{// imaginary part}}
\DoxyCodeLine{00192   \}}
\DoxyCodeLine{00193 }
\DoxyCodeLine{00194   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}})m\_layerTileRas;}
\DoxyCodeLine{00195   \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} ras64 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}})m\_layerTileRas;}
\DoxyCodeLine{00196   \textcolor{comment}{// Prepare data for FFT.}}
\DoxyCodeLine{00197   \textcolor{comment}{// Convert the RGB values to the exposure, then multiply it by the alpha}}
\DoxyCodeLine{00198   \textcolor{comment}{// channel value}}
\DoxyCodeLine{00199   \{}
\DoxyCodeLine{00200     lock.lockForRead();}
\DoxyCodeLine{00201     \textcolor{keywordflow}{if} (ras32)}
\DoxyCodeLine{00202       setLayerRaster<TRaster32P, TPixel32>(ras32, m\_kissfft\_comp\_in, dim);}
\DoxyCodeLine{00203     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ras64)}
\DoxyCodeLine{00204       setLayerRaster<TRaster64P, TPixel64>(ras64, m\_kissfft\_comp\_in, dim);}
\DoxyCodeLine{00205     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00206       lock.unlock();}
\DoxyCodeLine{00207       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00208     \}}
\DoxyCodeLine{00209 }
\DoxyCodeLine{00210     lock.unlock();}
\DoxyCodeLine{00211   \}}
\DoxyCodeLine{00212 }
\DoxyCodeLine{00213   \textcolor{keywordflow}{if} (checkTerminationAndCleanupThread()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00214 }
\DoxyCodeLine{00215   kiss\_fftnd(m\_kissfft\_plan\_fwd, m\_kissfft\_comp\_in, m\_kissfft\_comp\_out);}
\DoxyCodeLine{00216   kiss\_fft\_free(m\_kissfft\_plan\_fwd);  \textcolor{comment}{// we don't need this plan anymore}}
\DoxyCodeLine{00217   m\_kissfft\_plan\_fwd = NULL;}
\DoxyCodeLine{00218 }
\DoxyCodeLine{00219   \textcolor{keywordflow}{if} (checkTerminationAndCleanupThread()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00220 }
\DoxyCodeLine{00221   \textcolor{comment}{// Filtering. Multiply by the iris FFT data}}
\DoxyCodeLine{00222   \{}
\DoxyCodeLine{00223     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < lx * ly; i++) \{}
\DoxyCodeLine{00224       \textcolor{keywordtype}{float} re, im;}
\DoxyCodeLine{00225       re = m\_kissfft\_comp\_out[i].r * m\_kissfft\_comp\_iris[i].r -\/}
\DoxyCodeLine{00226            m\_kissfft\_comp\_out[i].i * m\_kissfft\_comp\_iris[i].i;}
\DoxyCodeLine{00227       im = m\_kissfft\_comp\_out[i].r * m\_kissfft\_comp\_iris[i].i +}
\DoxyCodeLine{00228            m\_kissfft\_comp\_iris[i].r * m\_kissfft\_comp\_out[i].i;}
\DoxyCodeLine{00229       m\_kissfft\_comp\_out[i].r = re;}
\DoxyCodeLine{00230       m\_kissfft\_comp\_out[i].i = im;}
\DoxyCodeLine{00231     \}}
\DoxyCodeLine{00232   \}}
\DoxyCodeLine{00233 }
\DoxyCodeLine{00234   \textcolor{keywordflow}{if} (checkTerminationAndCleanupThread()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00235 }
\DoxyCodeLine{00236   kiss\_fftnd(m\_kissfft\_plan\_bkwd, m\_kissfft\_comp\_out,}
\DoxyCodeLine{00237              m\_kissfft\_comp\_in);       \textcolor{comment}{// Backward FFT}}
\DoxyCodeLine{00238   kiss\_fft\_free(m\_kissfft\_plan\_bkwd);  \textcolor{comment}{// we don't need this plan anymore}}
\DoxyCodeLine{00239   m\_kissfft\_plan\_bkwd = NULL;}
\DoxyCodeLine{00240 }
\DoxyCodeLine{00241   \textcolor{comment}{// In the backward FFT above, "{}m\_kissfft\_comp\_out"{} is used as input and}}
\DoxyCodeLine{00242   \textcolor{comment}{// "{}m\_kissfft\_comp\_in"{} as output.}}
\DoxyCodeLine{00243   \textcolor{comment}{// So we don't need "{}m\_kissfft\_comp\_out"{} anymore.}}
\DoxyCodeLine{00244   m\_kissfft\_comp\_out\_ras-\/>unlock();}
\DoxyCodeLine{00245   m\_kissfft\_comp\_out = 0;}
\DoxyCodeLine{00246 }
\DoxyCodeLine{00247   \textcolor{keywordflow}{if} (checkTerminationAndCleanupThread()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00248 }
\DoxyCodeLine{00249   \{}
\DoxyCodeLine{00250     QMutexLocker locker(\&mutex);}
\DoxyCodeLine{00251 }
\DoxyCodeLine{00252     \textcolor{keywordtype}{double}* alp\_p  = m\_alpha\_bokeh;}
\DoxyCodeLine{00253     \mbox{\hyperlink{structdouble4}{double4}}* res\_p = m\_result;}
\DoxyCodeLine{00254     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim.lx * dim.ly; i++, alp\_p++, res\_p++) \{}
\DoxyCodeLine{00255       \textcolor{keywordflow}{if} ((*alp\_p) < 0.00001) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00256 }
\DoxyCodeLine{00257       \textcolor{keywordtype}{double} exposure =}
\DoxyCodeLine{00258           (double)m\_kissfft\_comp\_in[getCoord(i, dim.lx, dim.ly)].r /}
\DoxyCodeLine{00259           (double)(dim.lx * dim.ly);}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261       \textcolor{comment}{// convert to layer hardness}}
\DoxyCodeLine{00262       \textcolor{keywordflow}{if} (m\_masterHardness != m\_layerHardness)}
\DoxyCodeLine{00263         exposure =}
\DoxyCodeLine{00264             std::pow(exposure / (*alp\_p), m\_layerHardness / m\_masterHardness) *}
\DoxyCodeLine{00265             (*alp\_p);}
\DoxyCodeLine{00266 }
\DoxyCodeLine{00267       \textcolor{keywordtype}{double}* res = (m\_channel == Red) ? (\&((*res\_p).x))}
\DoxyCodeLine{00268                                        : (m\_channel == Green) ? (\&((*res\_p).y))}
\DoxyCodeLine{00269                                                               : (\&((*res\_p).z));}
\DoxyCodeLine{00270 }
\DoxyCodeLine{00271       \textcolor{comment}{// composite exposure}}
\DoxyCodeLine{00272       \textcolor{keywordflow}{if} ((*alp\_p) >= 1.0 || (*res) == 0.0)}
\DoxyCodeLine{00273         (*res) = exposure;}
\DoxyCodeLine{00274       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00275         (*res) *= 1.0 -\/ (*alp\_p);}
\DoxyCodeLine{00276         (*res) += exposure;}
\DoxyCodeLine{00277       \}}
\DoxyCodeLine{00278 }
\DoxyCodeLine{00279       \textcolor{comment}{// over compoite alpha}}
\DoxyCodeLine{00280       \textcolor{keywordflow}{if} (m\_channel == Red) \{}
\DoxyCodeLine{00281         \textcolor{keywordflow}{if} ((*res\_p).w < 1.0) \{}
\DoxyCodeLine{00282           \textcolor{keywordflow}{if} ((*alp\_p) > 1.0)}
\DoxyCodeLine{00283             (*res\_p).w = 1.0;}
\DoxyCodeLine{00284           else}
\DoxyCodeLine{00285             (*res\_p).w = (*alp\_p) + (*res\_p).w * (1.0 -\/ (*alp\_p));}
\DoxyCodeLine{00286         \}}
\DoxyCodeLine{00287       \}}
\DoxyCodeLine{00288       \textcolor{comment}{//-\/-\/-\/}}
\DoxyCodeLine{00289     \}}
\DoxyCodeLine{00290   \}}
\DoxyCodeLine{00291 }
\DoxyCodeLine{00292   m\_kissfft\_comp\_in\_ras-\/>unlock();}
\DoxyCodeLine{00293   m\_kissfft\_comp\_in = 0;}
\DoxyCodeLine{00294 }
\DoxyCodeLine{00295   m\_finished = \textcolor{keyword}{true};}
\DoxyCodeLine{00296 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_a45a23e954e2512e197fb671d416161f9}\label{class_bokeh_utils_1_1_my_thread_a45a23e954e2512e197fb671d416161f9}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!setLayerRaster@{setLayerRaster}}
\index{setLayerRaster@{setLayerRaster}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{setLayerRaster()}{setLayerRaster()}}
{\footnotesize\ttfamily template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ \\
void My\+Thread\+::set\+Layer\+Raster (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}}}]{src\+Ras,  }\item[{kiss\+\_\+fft\+\_\+cpx $\ast$}]{dst\+Mem,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}}}]{dim }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00161                                                            \{}
\DoxyCodeLine{00162   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim.ly; j++) \{}
\DoxyCodeLine{00163     PIXEL* pix = srcRas-\/>pixels(j);}
\DoxyCodeLine{00164     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim.lx; i++, pix++) \{}
\DoxyCodeLine{00165       \textcolor{keywordflow}{if} (pix-\/>m != 0) \{}
\DoxyCodeLine{00166         \textcolor{keywordtype}{double} val = (m\_channel == Red) ? (\textcolor{keywordtype}{double})pix-\/>r}
\DoxyCodeLine{00167                                         : (m\_channel == Green) ? (\textcolor{keywordtype}{double})pix-\/>g}
\DoxyCodeLine{00168                                                                : (double)pix-\/>b;}
\DoxyCodeLine{00169         \textcolor{comment}{// multiply the exposure by alpha channel value}}
\DoxyCodeLine{00170         dstMem[j * dim.lx + i].r =}
\DoxyCodeLine{00171             valueToExposure(val / (\textcolor{keywordtype}{double})PIXEL::maxChannelValue,}
\DoxyCodeLine{00172                             m\_layerHardness) *}
\DoxyCodeLine{00173             ((\textcolor{keywordtype}{double})pix-\/>m / (double)PIXEL::maxChannelValue);}
\DoxyCodeLine{00174       \}}
\DoxyCodeLine{00175     \}}
\DoxyCodeLine{00176   \}}
\DoxyCodeLine{00177 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bokeh_utils_1_1_my_thread_a813a5d69cf6dd4678a40008040813ab9}\label{class_bokeh_utils_1_1_my_thread_a813a5d69cf6dd4678a40008040813ab9}} 
\index{BokehUtils::MyThread@{BokehUtils::MyThread}!terminateThread@{terminateThread}}
\index{terminateThread@{terminateThread}!BokehUtils::MyThread@{BokehUtils::MyThread}}
\doxysubsubsection{\texorpdfstring{terminateThread()}{terminateThread()}}
{\footnotesize\ttfamily void Bokeh\+Utils\+::\+My\+Thread\+::terminate\+Thread (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00080 \{ m\_isTerminated = \textcolor{keyword}{true}; \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+bokeh\+\_\+util.\+h\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+bokeh\+\_\+util.\+cpp\end{DoxyCompactItemize}
