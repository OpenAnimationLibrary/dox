\hypertarget{class_stage_1_1_raster_painter}{}\doxysection{Stage\+::Raster\+Painter Class Reference}
\label{class_stage_1_1_raster_painter}\index{Stage::RasterPainter@{Stage::RasterPainter}}


{\ttfamily \#include $<$stagevisitor.\+h$>$}

Inheritance diagram for Stage\+::Raster\+Painter\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_stage_1_1_raster_painter}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_stage_1_1_raster_painter_a4633b19f10527ad89ce79cee6e65076f}{Raster\+Painter}} (const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&dim, const \mbox{\hyperlink{class_t_affine}{TAffine}} \&view\+Aff, const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&rect, const \mbox{\hyperlink{class_image_painter_1_1_visual_settings}{Image\+Painter\+::\+Visual\+Settings}} \&vs, bool check\+Flags)
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_a5fba2ff04bd6cf383e9cc9283d07a78e}{on\+Image}} (const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data) override
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_af0e6e5a351f5dd2ec900fbfe5affa963}{on\+Vector\+Image}} (\mbox{\hyperlink{class_t_vector_image}{TVector\+Image}} $\ast$vi, const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data)
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_a1c777e769eb55ad5b7ce562ff7d4edff}{on\+Raster\+Image}} (\mbox{\hyperlink{class_t_raster_image}{TRaster\+Image}} $\ast$ri, const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data) override
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_a1a126ab3e4e2161d727a82cab736098f}{on\+Toonz\+Image}} (\mbox{\hyperlink{class_t_toonz_image}{TToonz\+Image}} $\ast$ri, const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&data)
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_a40ea79e45143b83405a2b99eeb78847b}{begin\+Mask}} () override
\begin{DoxyCompactList}\small\item\em Utilizzato solo per TAB Pro. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_ac575f9c690058fc0399bf87f56be1df8}{end\+Mask}} () override
\begin{DoxyCompactList}\small\item\em Utilizzato solo per TAB Pro. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_a1831943f7e23a899d56fecd3e9593fbb}{enable\+Mask}} () override
\begin{DoxyCompactList}\small\item\em Utilizzato solo per TAB Pro. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_afadbc70d6f9fa11c741e7ed1c1b4e759}{disable\+Mask}} () override
\begin{DoxyCompactList}\small\item\em Utilizzato solo per TAB Pro. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{class_stage_1_1_raster_painter_a8b086d6f875e7caffdbd9e5d34321977}{get\+Nodes\+Count}} ()
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_abd82386243266725f5d5d938419100f0}{clear\+Nodes}} ()
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \mbox{\hyperlink{class_stage_1_1_raster_painter_ade762a1f18f6cba0cbb9fcb7b9000d8c}{get\+Raster}} (int index, QMatrix \&matrix)
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_a719a06a3b74d4d919f1d9eaa8bd83172}{flush\+Raster\+Images}} ()
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_acfdf9e4f66608a89dd13965818d0cf0f}{draw\+Raster\+Images}} (QPainter \&p, QPolygon camera\+Rect)
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_a3cd6a61a5f1730b54aefab1ab5fe9168}{enable\+Single\+Column}} (bool on)
\item 
bool \mbox{\hyperlink{class_stage_1_1_raster_painter_a831901a1cf12a33df7934952f07d993a}{is\+Single\+Column\+Enabled}} () const
\item 
void \mbox{\hyperlink{class_stage_1_1_raster_painter_ae83db2a77bc4cf66f13b9f486c98d977}{set\+Raster\+Darken\+Blended\+View}} (bool on)
\item 
std\+::vector$<$ \mbox{\hyperlink{class_t_stroke}{TStroke}} $\ast$ $>$ \& \mbox{\hyperlink{class_stage_1_1_raster_painter_a326abf630b9fe74166fc9586ed87091a}{get\+Guided\+Strokes}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
\mbox{\hyperlink{class_stage_1_1_raster_painter}{Stage\+::\+Raster\+Painter}} is the object responsible for drawing scene contents on a standard Toonz \mbox{\hyperlink{class_scene_viewer}{Scene\+Viewer}} panel.

This class performs standard {\itshape  camera-\/stand \texorpdfstring{$<$}{<}\textbackslash{}I\texorpdfstring{$>$}{>} scene renderization. It renders every supported Toonz image type (including Plastic\textquotesingle{}s texturized mesh-\/based image deformation), deals with onion-\/skin, and other stuff.}

{\itshape \begin{DoxyWarning}{Warning}
The \mbox{\hyperlink{class_stage_1_1_raster_painter}{Raster\+Painter}} visitor expects an active Open\+GL context. 
\end{DoxyWarning}
}

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a4633b19f10527ad89ce79cee6e65076f}\label{class_stage_1_1_raster_painter_a4633b19f10527ad89ce79cee6e65076f}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!RasterPainter@{RasterPainter}}
\index{RasterPainter@{RasterPainter}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{RasterPainter()}{RasterPainter()}}
{\footnotesize\ttfamily Raster\+Painter\+::\+Raster\+Painter (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&}]{dim,  }\item[{const \mbox{\hyperlink{class_t_affine}{TAffine}} \&}]{view\+Aff,  }\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{rect,  }\item[{const \mbox{\hyperlink{class_image_painter_1_1_visual_settings}{Image\+Painter\+::\+Visual\+Settings}} \&}]{vs,  }\item[{bool}]{check\+Flags }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00365     : \mbox{\hyperlink{class_stage_1_1_visitor}{Visitor}}(vs)}
\DoxyCodeLine{00366     , m\_dim(dim)}
\DoxyCodeLine{00367     , m\_viewAff(viewAff)}
\DoxyCodeLine{00368     , m\_clipRect(rect)}
\DoxyCodeLine{00369     , m\_maskLevel(0)}
\DoxyCodeLine{00370     , m\_singleColumnEnabled(\textcolor{keyword}{false})}
\DoxyCodeLine{00371     , m\_checkFlags(checkFlags)}
\DoxyCodeLine{00372     , m\_doRasterDarkenBlendedView(\textcolor{keyword}{false}) \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a40ea79e45143b83405a2b99eeb78847b}\label{class_stage_1_1_raster_painter_a40ea79e45143b83405a2b99eeb78847b}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!beginMask@{beginMask}}
\index{beginMask@{beginMask}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{beginMask()}{beginMask()}}
{\footnotesize\ttfamily void Raster\+Painter\+::begin\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Utilizzato solo per TAB Pro. 



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00377                               \{}
\DoxyCodeLine{00378   flushRasterImages();  \textcolor{comment}{// per evitare che venga fatto dopo il beginMask}}
\DoxyCodeLine{00379   ++m\_maskLevel;}
\DoxyCodeLine{00380   TStencilControl::instance()-\/>beginMask();}
\DoxyCodeLine{00381 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_abd82386243266725f5d5d938419100f0}\label{class_stage_1_1_raster_painter_abd82386243266725f5d5d938419100f0}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!clearNodes@{clearNodes}}
\index{clearNodes@{clearNodes}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{clearNodes()}{clearNodes()}}
{\footnotesize\ttfamily void Raster\+Painter\+::clear\+Nodes (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00415 \{ m\_nodes.clear(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_afadbc70d6f9fa11c741e7ed1c1b4e759}\label{class_stage_1_1_raster_painter_afadbc70d6f9fa11c741e7ed1c1b4e759}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!disableMask@{disableMask}}
\index{disableMask@{disableMask}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{disableMask()}{disableMask()}}
{\footnotesize\ttfamily void Raster\+Painter\+::disable\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Utilizzato solo per TAB Pro. 



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00394                                 \{}
\DoxyCodeLine{00395   flushRasterImages();  \textcolor{comment}{// se ci sono delle immagini raster mascherate devono}}
\DoxyCodeLine{00396                         \textcolor{comment}{// uscire ora}}
\DoxyCodeLine{00397   TStencilControl::instance()-\/>disableMask();}
\DoxyCodeLine{00398 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_acfdf9e4f66608a89dd13965818d0cf0f}\label{class_stage_1_1_raster_painter_acfdf9e4f66608a89dd13965818d0cf0f}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!drawRasterImages@{drawRasterImages}}
\index{drawRasterImages@{drawRasterImages}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{drawRasterImages()}{drawRasterImages()}}
{\footnotesize\ttfamily void Raster\+Painter\+::draw\+Raster\+Images (\begin{DoxyParamCaption}\item[{QPainter \&}]{p,  }\item[{QPolygon}]{camera\+Pol }\end{DoxyParamCaption})}

Make frame visualization in QPainter. ~\newline
 Draw in painter mode just raster image in m\+\_\+nodes. ~\newline
 Onon-\/skin or channel mode are not considered. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00697                                                                     \{}
\DoxyCodeLine{00698   \textcolor{keywordflow}{if} (m\_nodes.empty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00699 }
\DoxyCodeLine{00700   \textcolor{keywordtype}{double} delta = sqrt(fabs(m\_nodes[0].m\_aff.det()));}
\DoxyCodeLine{00701   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox  = m\_nodes[0].m\_bbox.enlarge(delta);}
\DoxyCodeLine{00702 }
\DoxyCodeLine{00703   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00704   \textcolor{keywordflow}{for} (i = 1; i < (int)m\_nodes.size(); i++) \{}
\DoxyCodeLine{00705     delta = sqrt(fabs(m\_nodes[i].m\_aff.det()));}
\DoxyCodeLine{00706     bbox += m\_nodes[i].m\_bbox.enlarge(delta);}
\DoxyCodeLine{00707   \}}
\DoxyCodeLine{00708   \mbox{\hyperlink{class_t_rect_t}{TRect}} rect(tfloor(bbox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}), tfloor(bbox.y0), tceil(bbox.x1), tceil(bbox.y1));}
\DoxyCodeLine{00709   rect = rect * \mbox{\hyperlink{class_t_rect_t}{TRect}}(0, 0, m\_dim.lx -\/ 1, m\_dim.ly -\/ 1);}
\DoxyCodeLine{00710 }
\DoxyCodeLine{00711   \mbox{\hyperlink{class_t_rect_t}{TRect}} r = rect -\/ rect.getP00();}
\DoxyCodeLine{00712   \mbox{\hyperlink{class_t_affine}{TAffine}} flipY(1, 0, 0, 0, -\/1, m\_dim.ly);}
\DoxyCodeLine{00713   p.setClipRegion(QRegion(cameraPol));}
\DoxyCodeLine{00714   \textcolor{keywordflow}{for} (i = 0; i < (int)m\_nodes.size(); i++) \{}
\DoxyCodeLine{00715     \textcolor{keywordflow}{if} (m\_nodes[i].m\_onionMode != Node::eOnionSkinNone) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00716     p.resetTransform();}
\DoxyCodeLine{00717     \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras = m\_nodes[i].m\_raster;}
\DoxyCodeLine{00718     \mbox{\hyperlink{class_t_affine}{TAffine}} aff  = \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/rect.x0, -\/rect.y0) * flipY * m\_nodes[i].m\_aff;}
\DoxyCodeLine{00719     QMatrix matrix(aff.a11, aff.a21, aff.a12, aff.a22, aff.a13, aff.a23);}
\DoxyCodeLine{00720     QImage image = rasterToQImage(ras);}
\DoxyCodeLine{00721     \textcolor{keywordflow}{if} (image.isNull()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00722     p.setMatrix(matrix);}
\DoxyCodeLine{00723     p.drawImage(rect.getP00().x, rect.getP00().y, image);}
\DoxyCodeLine{00724   \}}
\DoxyCodeLine{00725 }
\DoxyCodeLine{00726   p.resetTransform();}
\DoxyCodeLine{00727   m\_nodes.clear();}
\DoxyCodeLine{00728 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_stage_1_1_raster_painter_a1831943f7e23a899d56fecd3e9593fbb}\label{class_stage_1_1_raster_painter_a1831943f7e23a899d56fecd3e9593fbb}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!enableMask@{enableMask}}
\index{enableMask@{enableMask}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{enableMask()}{enableMask()}}
{\footnotesize\ttfamily void Raster\+Painter\+::enable\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Utilizzato solo per TAB Pro. 



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00390                                \{}
\DoxyCodeLine{00391   TStencilControl::instance()-\/>enableMask(TStencilControl::SHOW\_INSIDE);}
\DoxyCodeLine{00392 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a3cd6a61a5f1730b54aefab1ab5fe9168}\label{class_stage_1_1_raster_painter_a3cd6a61a5f1730b54aefab1ab5fe9168}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!enableSingleColumn@{enableSingleColumn}}
\index{enableSingleColumn@{enableSingleColumn}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{enableSingleColumn()}{enableSingleColumn()}}
{\footnotesize\ttfamily void Stage\+::\+Raster\+Painter\+::enable\+Single\+Column (\begin{DoxyParamCaption}\item[{bool}]{on }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00292 \{ m\_singleColumnEnabled = on; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_ac575f9c690058fc0399bf87f56be1df8}\label{class_stage_1_1_raster_painter_ac575f9c690058fc0399bf87f56be1df8}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!endMask@{endMask}}
\index{endMask@{endMask}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{endMask()}{endMask()}}
{\footnotesize\ttfamily void Raster\+Painter\+::end\+Mask (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Utilizzato solo per TAB Pro. 



Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00383                             \{}
\DoxyCodeLine{00384   flushRasterImages();  \textcolor{comment}{// se ci sono delle immagini raster nella maschera}}
\DoxyCodeLine{00385                         \textcolor{comment}{// devono uscire ora}}
\DoxyCodeLine{00386   -\/-\/m\_maskLevel;}
\DoxyCodeLine{00387   TStencilControl::instance()-\/>endMask();}
\DoxyCodeLine{00388 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a719a06a3b74d4d919f1d9eaa8bd83172}\label{class_stage_1_1_raster_painter_a719a06a3b74d4d919f1d9eaa8bd83172}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!flushRasterImages@{flushRasterImages}}
\index{flushRasterImages@{flushRasterImages}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{flushRasterImages()}{flushRasterImages()}}
{\footnotesize\ttfamily void Raster\+Painter\+::flush\+Raster\+Images (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00459                                       \{}
\DoxyCodeLine{00460   \textcolor{keywordflow}{if} (m\_nodes.empty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462   \textcolor{comment}{// Build nodes bbox union}}
\DoxyCodeLine{00463   \textcolor{keywordtype}{double} delta = sqrt(fabs(m\_nodes[0].m\_aff.det()));}
\DoxyCodeLine{00464   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox  = m\_nodes[0].m\_bbox.enlarge(delta);}
\DoxyCodeLine{00465 }
\DoxyCodeLine{00466   \textcolor{keywordtype}{int} i, nodesCount = m\_nodes.size();}
\DoxyCodeLine{00467   \textcolor{keywordflow}{for} (i = 1; i < nodesCount; ++i) \{}
\DoxyCodeLine{00468     delta = sqrt(fabs(m\_nodes[i].m\_aff.det()));}
\DoxyCodeLine{00469     bbox += m\_nodes[i].m\_bbox.enlarge(delta);}
\DoxyCodeLine{00470   \}}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472   \mbox{\hyperlink{class_t_rect_t}{TRect}} rect(tfloor(bbox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}), tfloor(bbox.y0), tceil(bbox.x1), tceil(bbox.y1));}
\DoxyCodeLine{00473   rect = rect * \mbox{\hyperlink{class_t_rect_t}{TRect}}(0, 0, m\_dim.lx -\/ 1, m\_dim.ly -\/ 1);}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475   \textcolor{keywordtype}{int} lx = rect.getLx(), ly = rect.getLy();}
\DoxyCodeLine{00476   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} dim(lx, ly);}
\DoxyCodeLine{00477 }
\DoxyCodeLine{00478   \textcolor{comment}{// this is needed since a stop motion live view}}
\DoxyCodeLine{00479   \textcolor{comment}{// doesn't register as a node correctly}}
\DoxyCodeLine{00480   \textcolor{comment}{// there is probably a better way to do this.}}
\DoxyCodeLine{00481   \textcolor{keywordflow}{if} (rect.getLx() == 0 \&\& lx == 0) \{}
\DoxyCodeLine{00482     rect = m\_clipRect;}
\DoxyCodeLine{00483     dim  = m\_dim;}
\DoxyCodeLine{00484   \}}
\DoxyCodeLine{00485 }
\DoxyCodeLine{00486   \textcolor{comment}{// Build a raster buffer of sufficient size to hold said union.}}
\DoxyCodeLine{00487   \textcolor{comment}{// The buffer is per-\/thread cached in order to improve the rendering speed.}}
\DoxyCodeLine{00488   \textcolor{keywordflow}{if} (!threadBuffers.hasLocalData())}
\DoxyCodeLine{00489     threadBuffers.setLocalData(\textcolor{keyword}{new} std::vector<char>());}
\DoxyCodeLine{00490 }
\DoxyCodeLine{00491   \textcolor{keywordtype}{int} size = dim.lx * dim.ly * \textcolor{keyword}{sizeof}(TPixel32);}
\DoxyCodeLine{00492 }
\DoxyCodeLine{00493   std::vector<char> *vbuff = (std::vector<char> *)threadBuffers.localData();}
\DoxyCodeLine{00494   \textcolor{keywordflow}{if} (size > (\textcolor{keywordtype}{int})vbuff-\/>size()) vbuff-\/>resize(size);}
\DoxyCodeLine{00495 }
\DoxyCodeLine{00496   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras(dim.lx, dim.ly, dim.lx, (TPixel32 *)\&(*vbuff)[0]);}
\DoxyCodeLine{00497   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras2;}
\DoxyCodeLine{00498 }
\DoxyCodeLine{00499   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a84bb519ec0ab16029cba33ff0f3f794f}{m\_colorMask}} != 0) \{}
\DoxyCodeLine{00500     ras2 = \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}}(ras-\/>getSize());}
\DoxyCodeLine{00501     ras-\/>clear();}
\DoxyCodeLine{00502   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00503     ras2 = ras;}
\DoxyCodeLine{00504 }
\DoxyCodeLine{00505   \textcolor{comment}{// Clear the buffer -\/ it will hold all the stacked nodes content to be overed}}
\DoxyCodeLine{00506   \textcolor{comment}{// on top of the OpenGL buffer through a glDrawPixel()}}
\DoxyCodeLine{00507   ras-\/>lock();}
\DoxyCodeLine{00508 }
\DoxyCodeLine{00509   ras-\/>clear();  \textcolor{comment}{// ras is typically reused -\/ and we need it transparent first}}
\DoxyCodeLine{00510 }
\DoxyCodeLine{00511   \mbox{\hyperlink{class_t_rect_t}{TRect}} r                 = rect -\/ rect.getP00();}
\DoxyCodeLine{00512   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} viewedRaster = ras-\/>extract(r);}
\DoxyCodeLine{00513 }
\DoxyCodeLine{00514   \textcolor{keywordtype}{int} current = -\/1;}
\DoxyCodeLine{00515 }
\DoxyCodeLine{00516   \textcolor{comment}{// Retrieve preferences-\/related data}}
\DoxyCodeLine{00517   \textcolor{keywordtype}{int} tc    = m\_checkFlags ? ToonzCheck::instance()-\/>getChecks() : 0;}
\DoxyCodeLine{00518   \textcolor{keywordtype}{int} index = ToonzCheck::instance()-\/>\mbox{\hyperlink{class_toonz_check_a7bea28e4a4ede90c7f52a4e9e2e1c328}{getColorIndex}}();}
\DoxyCodeLine{00519 }
\DoxyCodeLine{00520   TPixel32 frontOnionColor, backOnionColor;}
\DoxyCodeLine{00521   \textcolor{keywordtype}{bool} onionInksOnly;}
\DoxyCodeLine{00522 }
\DoxyCodeLine{00523   Preferences::instance()-\/>getOnionData(frontOnionColor, backOnionColor,}
\DoxyCodeLine{00524                                         onionInksOnly);}
\DoxyCodeLine{00525 }
\DoxyCodeLine{00526   \textcolor{comment}{// Stack every node on top of the raster buffer}}
\DoxyCodeLine{00527   \textcolor{keywordflow}{for} (i = 0; i < nodesCount; ++i) \{}
\DoxyCodeLine{00528     \textcolor{keywordflow}{if} (m\_nodes[i].m\_isCurrentColumn) current = i;}
\DoxyCodeLine{00529 }
\DoxyCodeLine{00530     \mbox{\hyperlink{class_t_affine}{TAffine}} aff         = \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/rect.x0, -\/rect.y0) * m\_nodes[i].m\_aff;}
\DoxyCodeLine{00531     \mbox{\hyperlink{class_t_dimension_t}{TDimension}} imageDim = m\_nodes[i].m\_raster-\/>getSize();}
\DoxyCodeLine{00532     \mbox{\hyperlink{class_t_point_t}{TPointD}} offset(0.5, 0.5);}
\DoxyCodeLine{00533     aff *= \mbox{\hyperlink{class_t_translation}{TTranslation}}(offset);  \textcolor{comment}{// very quick and very dirty fix: in}}
\DoxyCodeLine{00534                                   \textcolor{comment}{// camerastand the images seems shifted of an}}
\DoxyCodeLine{00535                                   \textcolor{comment}{// half pixel...it's a quickput approximation?}}
\DoxyCodeLine{00536 }
\DoxyCodeLine{00537     TPixel32 colorscale = TPixel32(0, 0, 0, m\_nodes[i].m\_alpha);}
\DoxyCodeLine{00538     \textcolor{keywordtype}{int} inksOnly;}
\DoxyCodeLine{00539 }
\DoxyCodeLine{00540     \textcolor{keywordflow}{if} (m\_nodes[i].m\_onionMode != Node::eOnionSkinNone) \{}
\DoxyCodeLine{00541       inksOnly = onionInksOnly;}
\DoxyCodeLine{00542 }
\DoxyCodeLine{00543       \textcolor{keywordflow}{if} (m\_nodes[i].m\_onionMode == Node::eOnionSkinFront)}
\DoxyCodeLine{00544         colorscale = TPixel32(frontOnionColor.r, frontOnionColor.g,}
\DoxyCodeLine{00545                               frontOnionColor.b, m\_nodes[i].m\_alpha);}
\DoxyCodeLine{00546       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_nodes[i].m\_onionMode == Node::eOnionSkinBack)}
\DoxyCodeLine{00547         colorscale = TPixel32(backOnionColor.r, backOnionColor.g,}
\DoxyCodeLine{00548                               backOnionColor.b, m\_nodes[i].m\_alpha);}
\DoxyCodeLine{00549     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00550       \textcolor{keywordflow}{if} (m\_nodes[i].m\_filterColor != TPixel32::Black) \{}
\DoxyCodeLine{00551         colorscale   = m\_nodes[i].m\_filterColor;}
\DoxyCodeLine{00552         colorscale.m = m\_nodes[i].m\_alpha;}
\DoxyCodeLine{00553       \}}
\DoxyCodeLine{00554       inksOnly = tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876ace675a780bd6cc41302c9b566409149b}{ToonzCheck::eInksOnly}};}
\DoxyCodeLine{00555     \}}
\DoxyCodeLine{00556 }
\DoxyCodeLine{00557     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} src32 = m\_nodes[i].m\_raster)}
\DoxyCodeLine{00558       \mbox{\hyperlink{namespace_t_rop_a1f6b04b4725e957a0d554e198e26a117}{TRop::quickPut}}(viewedRaster, src32, aff, colorscale,}
\DoxyCodeLine{00559                      m\_nodes[i].m\_doPremultiply, m\_nodes[i].m\_whiteTransp,}
\DoxyCodeLine{00560                      m\_nodes[i].m\_isFirstColumn, m\_doRasterDarkenBlendedView);}
\DoxyCodeLine{00561     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} srcGr8 = m\_nodes[i].m\_raster)}
\DoxyCodeLine{00562       \mbox{\hyperlink{namespace_t_rop_a1f6b04b4725e957a0d554e198e26a117}{TRop::quickPut}}(viewedRaster, srcGr8, aff, colorscale);}
\DoxyCodeLine{00563     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} srcCm = m\_nodes[i].m\_raster) \{}
\DoxyCodeLine{00564       assert(m\_nodes[i].m\_palette);}
\DoxyCodeLine{00565       \textcolor{keywordtype}{int} oldframe = m\_nodes[i].m\_palette-\/>getFrame();}
\DoxyCodeLine{00566       m\_nodes[i].m\_palette-\/>setFrame(m\_nodes[i].m\_frame);}
\DoxyCodeLine{00567 }
\DoxyCodeLine{00568       \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} plt;}
\DoxyCodeLine{00569       \textcolor{keywordtype}{int} styleIndex = -\/1;}
\DoxyCodeLine{00570       \textcolor{keywordflow}{if} ((tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a7fbcfdc87f510c2d2e271d3629db24fe}{ToonzCheck::eGap}} || tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a780c15982eceeb7f1e912a5d55029cef}{ToonzCheck::eAutoclose}}) \&\&}
\DoxyCodeLine{00571           m\_nodes[i].m\_isCurrentColumn) \{}
\DoxyCodeLine{00572         srcCm      = srcCm-\/>\mbox{\hyperlink{class_t_palette_abc3ef5824d89e65687b32c530cf25325}{clone}}();}
\DoxyCodeLine{00573         plt        = m\_nodes[i].m\_palette-\/>clone();}
\DoxyCodeLine{00574         styleIndex = plt-\/>\mbox{\hyperlink{class_t_palette_a43a27667c3b3583b2b3e1a9f307e7b42}{addStyle}}(TPixel::Magenta);}
\DoxyCodeLine{00575         \textcolor{keywordflow}{if} (tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a780c15982eceeb7f1e912a5d55029cef}{ToonzCheck::eAutoclose}})}
\DoxyCodeLine{00576           \mbox{\hyperlink{class_t_autocloser}{TAutocloser}}(srcCm, AutocloseDistance, AutocloseAngle, styleIndex,}
\DoxyCodeLine{00577                       AutocloseOpacity)}
\DoxyCodeLine{00578               .exec();}
\DoxyCodeLine{00579         \textcolor{keywordflow}{if} (tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a7fbcfdc87f510c2d2e271d3629db24fe}{ToonzCheck::eGap}})}
\DoxyCodeLine{00580           \mbox{\hyperlink{class_area_filler}{AreaFiller}}(srcCm).\mbox{\hyperlink{class_area_filler_a1983efa1aa8d315119e0e62924bcf471}{rectFill}}(m\_nodes[i].m\_savebox, 1, \textcolor{keyword}{true}, \textcolor{keyword}{true},}
\DoxyCodeLine{00581                                      \textcolor{keyword}{false});}
\DoxyCodeLine{00582       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00583         plt = m\_nodes[i].m\_palette;}
\DoxyCodeLine{00584 }
\DoxyCodeLine{00585       \textcolor{keywordflow}{if} (tc == 0 || tc == \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876ab6d35869ac2f7cfc956d498b2089a1ff}{ToonzCheck::eBlackBg}} ||}
\DoxyCodeLine{00586           !m\_nodes[i].m\_isCurrentColumn)}
\DoxyCodeLine{00587         \mbox{\hyperlink{namespace_t_rop_a1f6b04b4725e957a0d554e198e26a117}{TRop::quickPut}}(viewedRaster, srcCm, plt, aff, colorscale, inksOnly);}
\DoxyCodeLine{00588       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00589         \mbox{\hyperlink{class_t_rop_1_1_cmapped_quickput_settings}{TRop::CmappedQuickputSettings}} settings;}
\DoxyCodeLine{00590 }
\DoxyCodeLine{00591         settings.m\_globalColorScale = colorscale;}
\DoxyCodeLine{00592         settings.m\_inksOnly         = inksOnly;}
\DoxyCodeLine{00593         settings.m\_transparencyCheck =}
\DoxyCodeLine{00594             tc \& (\mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876af72e27092872414c3774938597209285}{ToonzCheck::eTransparency}} | \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a7fbcfdc87f510c2d2e271d3629db24fe}{ToonzCheck::eGap}});}
\DoxyCodeLine{00595         settings.m\_blackBgCheck = tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876ab6d35869ac2f7cfc956d498b2089a1ff}{ToonzCheck::eBlackBg}};}
\DoxyCodeLine{00596         \textcolor{comment}{/*-\/-\/ InkCheck, Ink\#1Check, PaintCheckはカレントカラムにのみ有効 -\/-\/*/}}
\DoxyCodeLine{00597         settings.m\_inkIndex =}
\DoxyCodeLine{00598             m\_nodes[i].m\_isCurrentColumn}
\DoxyCodeLine{00599                 ? (tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a7ad1deef6a508e60252b818c61ce83e9}{ToonzCheck::eInk}} ? index}
\DoxyCodeLine{00600                                          : (tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a3137d7221943909520731bd1977219eb}{ToonzCheck::eInk1}} ? 1 : -\/1))}
\DoxyCodeLine{00601                 : -\/1;}
\DoxyCodeLine{00602         settings.m\_paintIndex = m\_nodes[i].m\_isCurrentColumn}
\DoxyCodeLine{00603                                     ? (tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a5a4df203cdba2a5eb6f7eba19f9ab62e}{ToonzCheck::ePaint}} ? index : -\/1)}
\DoxyCodeLine{00604                                     : -\/1;}
\DoxyCodeLine{00605 }
\DoxyCodeLine{00606         Preferences::instance()-\/>getTranspCheckData(}
\DoxyCodeLine{00607             settings.m\_transpCheckBg, settings.m\_transpCheckInk,}
\DoxyCodeLine{00608             settings.m\_transpCheckPaint);}
\DoxyCodeLine{00609 }
\DoxyCodeLine{00610         settings.m\_isOnionSkin = m\_nodes[i].m\_onionMode != Node::eOnionSkinNone;}
\DoxyCodeLine{00611         settings.m\_gapCheckIndex = styleIndex;}
\DoxyCodeLine{00612 }
\DoxyCodeLine{00613         \mbox{\hyperlink{namespace_t_rop_a1f6b04b4725e957a0d554e198e26a117}{TRop::quickPut}}(viewedRaster, srcCm, plt, aff, settings);}
\DoxyCodeLine{00614       \}}
\DoxyCodeLine{00615 }
\DoxyCodeLine{00616       srcCm = \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}}();}
\DoxyCodeLine{00617       plt   = \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}}();}
\DoxyCodeLine{00618 }
\DoxyCodeLine{00619       m\_nodes[i].m\_palette-\/>setFrame(oldframe);}
\DoxyCodeLine{00620     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00621       assert(!\textcolor{stringliteral}{"{}Cannot use quickput with this raster combination!"{}});}
\DoxyCodeLine{00622   \}}
\DoxyCodeLine{00623 }
\DoxyCodeLine{00624   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a84bb519ec0ab16029cba33ff0f3f794f}{m\_colorMask}} != 0) \{}
\DoxyCodeLine{00625     TRop::setChannel(ras, ras, \mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a84bb519ec0ab16029cba33ff0f3f794f}{m\_colorMask}}, \textcolor{keyword}{false});}
\DoxyCodeLine{00626     \mbox{\hyperlink{namespace_t_rop_a1f6b04b4725e957a0d554e198e26a117}{TRop::quickPut}}(ras2, ras, \mbox{\hyperlink{class_t_affine}{TAffine}}());}
\DoxyCodeLine{00627   \}}
\DoxyCodeLine{00628 }
\DoxyCodeLine{00629   \textcolor{comment}{// Now, output the raster buffer on top of the OpenGL buffer}}
\DoxyCodeLine{00630   glPushAttrib(GL\_COLOR\_BUFFER\_BIT);  \textcolor{comment}{// Preserve blending and stuff}}
\DoxyCodeLine{00631 }
\DoxyCodeLine{00632   glEnable(GL\_BLEND);}
\DoxyCodeLine{00633   glBlendFunc(GL\_ONE,}
\DoxyCodeLine{00634               GL\_ONE\_MINUS\_SRC\_ALPHA);  \textcolor{comment}{// The raster buffer is intended in}}
\DoxyCodeLine{00635   \textcolor{comment}{// premultiplied form -\/ thus the GL\_ONE on src}}
\DoxyCodeLine{00636   glDisable(GL\_DEPTH\_TEST);}
\DoxyCodeLine{00637   glDisable(GL\_DITHER);}
\DoxyCodeLine{00638   glDisable(GL\_LOGIC\_OP);}
\DoxyCodeLine{00639 }
\DoxyCodeLine{00640 \textcolor{comment}{/* disable, since these features are never enabled, and cause OpenGL to assert}}
\DoxyCodeLine{00641 \textcolor{comment}{ * on systems that don't support them: see \#591 */}}
\DoxyCodeLine{00642 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{00643 \textcolor{preprocessor}{\#ifdef GL\_EXT\_convolution}}
\DoxyCodeLine{00644   \textcolor{keywordflow}{if}( GLEW\_EXT\_convolution ) \{}
\DoxyCodeLine{00645     glDisable(GL\_CONVOLUTION\_1D\_EXT);}
\DoxyCodeLine{00646     glDisable(GL\_CONVOLUTION\_2D\_EXT);}
\DoxyCodeLine{00647     glDisable(GL\_SEPARABLE\_2D\_EXT);}
\DoxyCodeLine{00648   \}}
\DoxyCodeLine{00649 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00650 }
\DoxyCodeLine{00651 \textcolor{preprocessor}{\#ifdef GL\_EXT\_histogram}}
\DoxyCodeLine{00652   \textcolor{keywordflow}{if}( GLEW\_EXT\_histogram ) \{}
\DoxyCodeLine{00653     glDisable(GL\_HISTOGRAM\_EXT);}
\DoxyCodeLine{00654     glDisable(GL\_MINMAX\_EXT);}
\DoxyCodeLine{00655   \}}
\DoxyCodeLine{00656 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00657 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00658 }
\DoxyCodeLine{00659 \textcolor{preprocessor}{\#ifdef GL\_EXT\_texture3D}}
\DoxyCodeLine{00660   \textcolor{keywordflow}{if} (GL\_EXT\_texture3D) \{}
\DoxyCodeLine{00661     glDisable(GL\_TEXTURE\_3D\_EXT);}
\DoxyCodeLine{00662   \}}
\DoxyCodeLine{00663 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00664 }
\DoxyCodeLine{00665   glPushMatrix();}
\DoxyCodeLine{00666   glLoadIdentity();}
\DoxyCodeLine{00667 }
\DoxyCodeLine{00668   glRasterPos2d(rect.x0, rect.y0);}
\DoxyCodeLine{00669   glPixelStorei(GL\_UNPACK\_ROW\_LENGTH, 0);}
\DoxyCodeLine{00670   glPixelStorei(GL\_UNPACK\_ALIGNMENT, 1);}
\DoxyCodeLine{00671 }
\DoxyCodeLine{00672   glDrawPixels(ras2-\/>getLx(), ras2-\/>getLy(),            \textcolor{comment}{// Perform the over}}
\DoxyCodeLine{00673                TGL\_FMT, TGL\_TYPE, ras2-\/>getRawData());  \textcolor{comment}{//}}
\DoxyCodeLine{00674 }
\DoxyCodeLine{00675   ras-\/>unlock();}
\DoxyCodeLine{00676   glPopMatrix();}
\DoxyCodeLine{00677 }
\DoxyCodeLine{00678   glPopAttrib();  \textcolor{comment}{// Restore blending status}}
\DoxyCodeLine{00679 }
\DoxyCodeLine{00680   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a354c3bf432a933b627c3f3c5ea0ab9bf}{m\_showBBox}} \&\& current > -\/1) \{}
\DoxyCodeLine{00681     glPushMatrix();}
\DoxyCodeLine{00682     glLoadIdentity();}
\DoxyCodeLine{00683     tglColor(TPixel(200, 200, 200));}
\DoxyCodeLine{00684     tglMultMatrix(m\_nodes[current].m\_aff);}
\DoxyCodeLine{00685     tglDrawRect(m\_nodes[current].m\_raster-\/>getBounds());}
\DoxyCodeLine{00686     glPopMatrix();}
\DoxyCodeLine{00687   \}}
\DoxyCodeLine{00688 }
\DoxyCodeLine{00689   m\_nodes.clear();}
\DoxyCodeLine{00690 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a326abf630b9fe74166fc9586ed87091a}\label{class_stage_1_1_raster_painter_a326abf630b9fe74166fc9586ed87091a}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!getGuidedStrokes@{getGuidedStrokes}}
\index{getGuidedStrokes@{getGuidedStrokes}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{getGuidedStrokes()}{getGuidedStrokes()}}
{\footnotesize\ttfamily std\+::vector$<$ \mbox{\hyperlink{class_t_stroke}{TStroke}} $\ast$ $>$ \& Stage\+::\+Raster\+Painter\+::get\+Guided\+Strokes (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00297 \{ \textcolor{keywordflow}{return} m\_guidedStrokes; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a8b086d6f875e7caffdbd9e5d34321977}\label{class_stage_1_1_raster_painter_a8b086d6f875e7caffdbd9e5d34321977}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!getNodesCount@{getNodesCount}}
\index{getNodesCount@{getNodesCount}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{getNodesCount()}{getNodesCount()}}
{\footnotesize\ttfamily int Raster\+Painter\+::get\+Nodes\+Count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00411 \{ \textcolor{keywordflow}{return} m\_nodes.size(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_ade762a1f18f6cba0cbb9fcb7b9000d8c}\label{class_stage_1_1_raster_painter_ade762a1f18f6cba0cbb9fcb7b9000d8c}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!getRaster@{getRaster}}
\index{getRaster@{getRaster}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{getRaster()}{getRaster()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} Raster\+Painter\+::get\+Raster (\begin{DoxyParamCaption}\item[{int}]{index,  }\item[{QMatrix \&}]{matrix }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00419                                                             \{}
\DoxyCodeLine{00420   \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{int})m\_nodes.size() <= index) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00421 }
\DoxyCodeLine{00422   \textcolor{keywordflow}{if} (m\_nodes[index].m\_onionMode != Node::eOnionSkinNone) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00423 }
\DoxyCodeLine{00424   \textcolor{keywordflow}{if} (m\_nodes.empty()) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00425 }
\DoxyCodeLine{00426   \textcolor{keywordtype}{double} delta = sqrt(fabs(m\_nodes[0].m\_aff.det()));}
\DoxyCodeLine{00427   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox  = m\_nodes[0].m\_bbox.enlarge(delta);}
\DoxyCodeLine{00428 }
\DoxyCodeLine{00429   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00430   \textcolor{keywordflow}{for} (i = 1; i < (int)m\_nodes.size(); i++) \{}
\DoxyCodeLine{00431     delta = sqrt(fabs(m\_nodes[i].m\_aff.det()));}
\DoxyCodeLine{00432     bbox += m\_nodes[i].m\_bbox.enlarge(delta);}
\DoxyCodeLine{00433   \}}
\DoxyCodeLine{00434   \mbox{\hyperlink{class_t_rect_t}{TRect}} rect(tfloor(bbox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}), tfloor(bbox.y0), tceil(bbox.x1), tceil(bbox.y1));}
\DoxyCodeLine{00435   rect = rect * \mbox{\hyperlink{class_t_rect_t}{TRect}}(0, 0, m\_dim.lx -\/ 1, m\_dim.ly -\/ 1);}
\DoxyCodeLine{00436 }
\DoxyCodeLine{00437   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/rect.x0, -\/rect.y0) * m\_nodes[index].m\_aff;}
\DoxyCodeLine{00438   matrix      = QMatrix(aff.a11, aff.a21, aff.a12, aff.a22, aff.a13, aff.a23);}
\DoxyCodeLine{00439 }
\DoxyCodeLine{00440   \textcolor{keywordflow}{return} m\_nodes[index].m\_raster;}
\DoxyCodeLine{00441 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a831901a1cf12a33df7934952f07d993a}\label{class_stage_1_1_raster_painter_a831901a1cf12a33df7934952f07d993a}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!isSingleColumnEnabled@{isSingleColumnEnabled}}
\index{isSingleColumnEnabled@{isSingleColumnEnabled}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{isSingleColumnEnabled()}{isSingleColumnEnabled()}}
{\footnotesize\ttfamily bool Stage\+::\+Raster\+Painter\+::is\+Single\+Column\+Enabled (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00293 \{ \textcolor{keywordflow}{return} m\_singleColumnEnabled; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_1_1_raster_painter_a5fba2ff04bd6cf383e9cc9283d07a78e}\label{class_stage_1_1_raster_painter_a5fba2ff04bd6cf383e9cc9283d07a78e}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!onImage@{onImage}}
\index{onImage@{onImage}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{onImage()}{onImage()}}
{\footnotesize\ttfamily void Raster\+Painter\+::on\+Image (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{player }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Take image from {\bfseries{\mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}}}} {\bfseries{data}} and recall the right method for this kind of image, for vector image recall {\bfseries{\mbox{\hyperlink{class_stage_1_1_raster_painter_af0e6e5a351f5dd2ec900fbfe5affa963}{on\+Vector\+Image()}}}}, for raster image recall {\bfseries{\mbox{\hyperlink{class_stage_1_1_raster_painter_a1c777e769eb55ad5b7ce562ff7d4edff}{on\+Raster\+Image()}}}} for toonz image recall {\bfseries{\mbox{\hyperlink{class_stage_1_1_raster_painter_a1a126ab3e4e2161d727a82cab736098f}{on\+Toonz\+Image()}}}}. 

Implements \mbox{\hyperlink{class_stage_1_1_visitor_a4f6fa9bc6e68aaf2d1a2f5a69a0f8c53}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00783                                                      \{}
\DoxyCodeLine{00784   \textcolor{keywordflow}{if} (m\_singleColumnEnabled \&\& !player.\mbox{\hyperlink{class_stage_1_1_player_aba32c099fd49a4343580c28ade32e144}{m\_isCurrentColumn}}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00785 }
\DoxyCodeLine{00786   \textcolor{comment}{// Attempt Plastic-\/deformed drawing}}
\DoxyCodeLine{00787   \textcolor{comment}{// For now generating icons of plastic-\/deformed image causes crash as}}
\DoxyCodeLine{00788   \textcolor{comment}{// QOffscreenSurface is created outside the gui thread.}}
\DoxyCodeLine{00789   \textcolor{comment}{// As a quick workaround, ignore the deformation if this is called from}}
\DoxyCodeLine{00790   \textcolor{comment}{// non-\/gui thread (i.e. icon generator thread)}}
\DoxyCodeLine{00791   \textcolor{comment}{// 12/1/2018 Now the scene icon is rendered without deformation either}}
\DoxyCodeLine{00792   \textcolor{comment}{// since it causes unknown error with opengl contexts..}}
\DoxyCodeLine{00793   \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj =}
\DoxyCodeLine{00794       ::plasticDeformedObj(player, \mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_aafe14ec520424843ecd9aca4abf02bf0}{m\_plasticVisualSettings}});}
\DoxyCodeLine{00795   \textcolor{keywordflow}{if} (obj \&\& QThread::currentThread() == qGuiApp-\/>thread() \&\&}
\DoxyCodeLine{00796       !\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.m\_forSceneIcon) \{}
\DoxyCodeLine{00797     flushRasterImages();}
\DoxyCodeLine{00798     ::onPlasticDeformedImage(obj, player, \mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}, m\_viewAff);}
\DoxyCodeLine{00799   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00800     \textcolor{comment}{// Common image draw}}
\DoxyCodeLine{00801     \textcolor{keyword}{const} \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&img = player.\mbox{\hyperlink{class_stage_1_1_player_ae4853278eaaf00c28dd939dbb0de3647}{image}}();}
\DoxyCodeLine{00802 }
\DoxyCodeLine{00803     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img)}
\DoxyCodeLine{00804       \mbox{\hyperlink{class_stage_1_1_raster_painter_af0e6e5a351f5dd2ec900fbfe5affa963}{onVectorImage}}(vi.getPointer(), player);}
\DoxyCodeLine{00805     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri = img)}
\DoxyCodeLine{00806       \mbox{\hyperlink{class_stage_1_1_raster_painter_a1c777e769eb55ad5b7ce562ff7d4edff}{onRasterImage}}(ri.getPointer(), player);}
\DoxyCodeLine{00807     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti = img)}
\DoxyCodeLine{00808       \mbox{\hyperlink{class_stage_1_1_raster_painter_a1a126ab3e4e2161d727a82cab736098f}{onToonzImage}}(ti.getPointer(), player);}
\DoxyCodeLine{00809     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_mesh_image_p}{TMeshImageP}} mi = img) \{}
\DoxyCodeLine{00810       flushRasterImages();}
\DoxyCodeLine{00811       ::onMeshImage(mi.getPointer(), player, \mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}, m\_viewAff);}
\DoxyCodeLine{00812     \}}
\DoxyCodeLine{00813   \}}
\DoxyCodeLine{00814 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00051}{Stage\+::\+Player\+::image()}}, \mbox{\hyperlink{l00082}{Stage\+::\+Player\+::m\+\_\+is\+Current\+Column}}, \mbox{\hyperlink{l00053}{Image\+Painter\+::\+Visual\+Settings\+::m\+\_\+plastic\+Visual\+Settings}}, \mbox{\hyperlink{l00093}{Stage\+::\+Visitor\+::m\+\_\+vs}}, \mbox{\hyperlink{l00993}{on\+Raster\+Image()}}, \mbox{\hyperlink{l01059}{on\+Toonz\+Image()}}, and \mbox{\hyperlink{l00821}{on\+Vector\+Image()}}.

\mbox{\Hypertarget{class_stage_1_1_raster_painter_a1c777e769eb55ad5b7ce562ff7d4edff}\label{class_stage_1_1_raster_painter_a1c777e769eb55ad5b7ce562ff7d4edff}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!onRasterImage@{onRasterImage}}
\index{onRasterImage@{onRasterImage}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{onRasterImage()}{onRasterImage()}}
{\footnotesize\ttfamily void Raster\+Painter\+::on\+Raster\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_raster_image}{TRaster\+Image}} $\ast$}]{ri,  }\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{player }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Create a {\bfseries{\mbox{\hyperlink{class_node}{Node}}}} and put it in {\bfseries{m\+\_\+nodes}}. 

Implements \mbox{\hyperlink{class_stage_1_1_visitor}{Stage\+::\+Visitor}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00994                                                              \{}
\DoxyCodeLine{00995   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} r = ri-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}();}
\DoxyCodeLine{00996 }
\DoxyCodeLine{00997   \mbox{\hyperlink{class_t_affine}{TAffine}} aff;}
\DoxyCodeLine{00998   aff = m\_viewAff * player.\mbox{\hyperlink{class_stage_1_1_player_a99c9004772f5575fb627dcfb29137459}{m\_placement}} * player.\mbox{\hyperlink{class_stage_1_1_player_a0495491ce47344daba1cd55e1b64905a}{m\_dpiAff}};}
\DoxyCodeLine{00999   aff = \mbox{\hyperlink{class_t_translation}{TTranslation}}(m\_dim.lx * 0.5, m\_dim.ly * 0.5) * aff *}
\DoxyCodeLine{01000         \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/r-\/>getCenterD() +}
\DoxyCodeLine{01001                      convert(ri-\/>\mbox{\hyperlink{class_t_raster_image_ae604776f6c4c9be2bd76d3ffb0543025}{getOffset}}()));  \textcolor{comment}{// this offset is !=0 only if}}
\DoxyCodeLine{01002                                                  \textcolor{comment}{// in cleanup camera test mode}}
\DoxyCodeLine{01003 }
\DoxyCodeLine{01004   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox = \mbox{\hyperlink{class_t_rect_t}{TRectD}}(0, 0, m\_dim.lx, m\_dim.ly);}
\DoxyCodeLine{01005   bbox *= convert(m\_clipRect);}
\DoxyCodeLine{01006   \textcolor{keywordflow}{if} (bbox.\mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{isEmpty}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01007 }
\DoxyCodeLine{01008   \textcolor{keywordtype}{int} alpha                 = 255;}
\DoxyCodeLine{01009   Node::OnionMode onionMode = Node::eOnionSkinNone;}
\DoxyCodeLine{01010   \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} != c\_noOnionSkin) \{}
\DoxyCodeLine{01011     \textcolor{comment}{// GetOnionSkinFade va bene per il vettoriale mentre il raster funziona al}}
\DoxyCodeLine{01012     \textcolor{comment}{// contrario}}
\DoxyCodeLine{01013     \textcolor{comment}{// 1 opaco -\/> 0 completamente trasparente}}
\DoxyCodeLine{01014     \textcolor{comment}{// inverto quindi il risultato della funzione stando attento al caso 0}}
\DoxyCodeLine{01015     \textcolor{comment}{// (in cui era scolpito il valore 0.9)}}
\DoxyCodeLine{01016     \textcolor{keywordtype}{double} onionSkiFade = player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == 0}
\DoxyCodeLine{01017                               ? 0.9}
\DoxyCodeLine{01018                               : (1.0 -\/ \mbox{\hyperlink{class_onion_skin_mask_a6a4c72b75d213e6a3fca82092a520824}{OnionSkinMask::getOnionSkinFade}}(}
\DoxyCodeLine{01019                                            player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}}));}
\DoxyCodeLine{01020     alpha = tcrop(tround(onionSkiFade * 255.0), 0, 255);}
\DoxyCodeLine{01021     \textcolor{keywordflow}{if} (player.m\_isShiftAndTraceEnabled \&\&}
\DoxyCodeLine{01022         !Preferences::instance()-\/>areOnionColorsUsedForShiftAndTraceGhosts())}
\DoxyCodeLine{01023       onionMode = Node::eOnionSkinNone;}
\DoxyCodeLine{01024     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01025       onionMode =}
\DoxyCodeLine{01026           (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} > 0)}
\DoxyCodeLine{01027               ? Node::eOnionSkinFront}
\DoxyCodeLine{01028               : ((player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} < 0) ? Node::eOnionSkinBack}
\DoxyCodeLine{01029                                                   : Node::eOnionSkinNone);}
\DoxyCodeLine{01030     \}}
\DoxyCodeLine{01031   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_a2b05fa8fdc95ac04a532fc2d227a3a81}{m\_opacity}} < 255)}
\DoxyCodeLine{01032     alpha = player.\mbox{\hyperlink{class_stage_1_1_player_a2b05fa8fdc95ac04a532fc2d227a3a81}{m\_opacity}};}
\DoxyCodeLine{01033   \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl = player.\mbox{\hyperlink{class_stage_1_1_player_a6230d77933caf93b9699bd5e2de0d2b0}{m\_sl}};}
\DoxyCodeLine{01034   \textcolor{keywordtype}{bool} doPremultiply  = \textcolor{keyword}{false};}
\DoxyCodeLine{01035   \textcolor{keywordtype}{bool} \mbox{\hyperlink{namespace_t_rop_a35fb11523175f84027df48cc51d45d28}{whiteTransp}}    = \textcolor{keyword}{false};}
\DoxyCodeLine{01036   \textcolor{keywordflow}{if} (sl) \{}
\DoxyCodeLine{01037     \mbox{\hyperlink{class_level_properties}{LevelProperties}} *levelProp = sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_ad412dd5c3a6ae3ff20a480dc728b26d2}{getProperties}}();}
\DoxyCodeLine{01038     \textcolor{keywordflow}{if} (levelProp-\/>\mbox{\hyperlink{class_level_properties_a5a253da40e456de66dca76526f2e9453}{doPremultiply}}())}
\DoxyCodeLine{01039       doPremultiply = \textcolor{keyword}{true};}
\DoxyCodeLine{01040     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (levelProp-\/>whiteTransp())}
\DoxyCodeLine{01041       whiteTransp = \textcolor{keyword}{true};}
\DoxyCodeLine{01042   \}}
\DoxyCodeLine{01043 }
\DoxyCodeLine{01044   \textcolor{keywordtype}{bool} ignoreAlpha =}
\DoxyCodeLine{01045       (Preferences::instance()-\/>isIgnoreAlphaonColumn1Enabled() \&\&}
\DoxyCodeLine{01046        player.\mbox{\hyperlink{class_stage_1_1_player_ac79a243d283085682ddcdb75f8a6e185}{m\_column}} == 0 \&\&}
\DoxyCodeLine{01047        isSubsheetChainOnColumn0(sl-\/>\mbox{\hyperlink{class_t_xsh_level_a06176566e80858dbb206112db08a92b9}{getScene}}()-\/>\mbox{\hyperlink{class_toonz_scene_aaffd562eebbd8faba4caeaed69bfcc18}{getTopXsheet}}(), player.\mbox{\hyperlink{class_stage_1_1_player_a7c4c0ed3570aba38a036023360724606}{m\_xsh}},}
\DoxyCodeLine{01048                                 player.\mbox{\hyperlink{class_stage_1_1_player_af88189b51ebf5b86f87f77281aba0ce1}{m\_frame}}));}
\DoxyCodeLine{01049 }
\DoxyCodeLine{01050   m\_nodes.push\_back(\mbox{\hyperlink{class_node}{Node}}(r, 0, alpha, aff, ri-\/>\mbox{\hyperlink{class_t_raster_image_a82ed0d4ee941a6366c5a66e61b3008c5}{getSavebox}}(), bbox,}
\DoxyCodeLine{01051                          player.\mbox{\hyperlink{class_stage_1_1_player_af88189b51ebf5b86f87f77281aba0ce1}{m\_frame}}, player.\mbox{\hyperlink{class_stage_1_1_player_aba32c099fd49a4343580c28ade32e144}{m\_isCurrentColumn}}, onionMode,}
\DoxyCodeLine{01052                          doPremultiply, whiteTransp, ignoreAlpha,}
\DoxyCodeLine{01053                          player.m\_filterColor));}
\DoxyCodeLine{01054 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00189}{Level\+Properties\+::do\+Premultiply()}}, \mbox{\hyperlink{l00095}{TRaster\+Image\+::get\+Offset()}}, \mbox{\hyperlink{l00158}{Onion\+Skin\+Mask\+::get\+Onion\+Skin\+Fade()}}, \mbox{\hyperlink{l00109}{TXsh\+Simple\+Level\+::get\+Properties()}}, \mbox{\hyperlink{l00108}{TRaster\+Image\+::get\+Raster()}}, \mbox{\hyperlink{l00087}{TRaster\+Image\+::get\+Savebox()}}, \mbox{\hyperlink{l00087}{TXsh\+Level\+::get\+Scene()}}, \mbox{\hyperlink{l00961}{Toonz\+Scene\+::get\+Top\+Xsheet()}}, \mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{TRect\+T$<$ T $>$\+::is\+Empty()}}, \mbox{\hyperlink{l00096}{Stage\+::\+Player\+::m\+\_\+column}}, \mbox{\hyperlink{l00072}{Stage\+::\+Player\+::m\+\_\+dpi\+Aff}}, \mbox{\hyperlink{l00097}{Stage\+::\+Player\+::m\+\_\+frame}}, \mbox{\hyperlink{l00082}{Stage\+::\+Player\+::m\+\_\+is\+Current\+Column}}, \mbox{\hyperlink{l00077}{Stage\+::\+Player\+::m\+\_\+onion\+Skin\+Distance}}, \mbox{\hyperlink{l00104}{Stage\+::\+Player\+::m\+\_\+opacity}}, \mbox{\hyperlink{l00071}{Stage\+::\+Player\+::m\+\_\+placement}}, \mbox{\hyperlink{l00091}{Stage\+::\+Player\+::m\+\_\+sl}}, and \mbox{\hyperlink{l00095}{Stage\+::\+Player\+::m\+\_\+xsh}}.



Referenced by \mbox{\hyperlink{l00783}{on\+Image()}}.

\mbox{\Hypertarget{class_stage_1_1_raster_painter_a1a126ab3e4e2161d727a82cab736098f}\label{class_stage_1_1_raster_painter_a1a126ab3e4e2161d727a82cab736098f}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!onToonzImage@{onToonzImage}}
\index{onToonzImage@{onToonzImage}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{onToonzImage()}{onToonzImage()}}
{\footnotesize\ttfamily void Raster\+Painter\+::on\+Toonz\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_toonz_image}{TToonz\+Image}} $\ast$}]{ti,  }\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{player }\end{DoxyParamCaption})}

Create a {\bfseries{\mbox{\hyperlink{class_node}{Node}}}} and put it in {\bfseries{m\+\_\+nodes}}. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01059                                                                            \{}
\DoxyCodeLine{01060   \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} r = ti-\/>\mbox{\hyperlink{class_t_toonz_image_ae04ea13c3803157ac69b01a83ad65865}{getRaster}}();}
\DoxyCodeLine{01061   \textcolor{keywordflow}{if} (!ti-\/>getPalette()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01062 }
\DoxyCodeLine{01063   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = m\_viewAff * player.\mbox{\hyperlink{class_stage_1_1_player_a99c9004772f5575fb627dcfb29137459}{m\_placement}} * player.\mbox{\hyperlink{class_stage_1_1_player_a0495491ce47344daba1cd55e1b64905a}{m\_dpiAff}};}
\DoxyCodeLine{01064   aff         = \mbox{\hyperlink{class_t_translation}{TTranslation}}(m\_dim.lx / 2.0, m\_dim.ly / 2.0) * aff *}
\DoxyCodeLine{01065         \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/r-\/>getCenterD());}
\DoxyCodeLine{01066 }
\DoxyCodeLine{01067   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox = \mbox{\hyperlink{class_t_rect_t}{TRectD}}(0, 0, m\_dim.lx, m\_dim.ly);}
\DoxyCodeLine{01068   bbox *= convert(m\_clipRect);}
\DoxyCodeLine{01069   \textcolor{keywordflow}{if} (bbox.\mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{isEmpty}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01070 }
\DoxyCodeLine{01071   \textcolor{keywordtype}{int} alpha                 = 255;}
\DoxyCodeLine{01072   Node::OnionMode onionMode = Node::eOnionSkinNone;}
\DoxyCodeLine{01073   \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} != c\_noOnionSkin) \{}
\DoxyCodeLine{01074     \textcolor{comment}{// GetOnionSkinFade is good for the vector while the raster works at the}}
\DoxyCodeLine{01075     \textcolor{comment}{//    Opposite 1 opaque -\/> 0 completely transparent}}
\DoxyCodeLine{01076     \textcolor{comment}{//    I therefore reverse the result of the function by being attentive to}}
\DoxyCodeLine{01077     \textcolor{comment}{//    case 0}}
\DoxyCodeLine{01078     \textcolor{comment}{//    (where the value 0.9 was carved)}}
\DoxyCodeLine{01079     \textcolor{keywordtype}{double} onionSkiFade = player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == 0}
\DoxyCodeLine{01080                               ? 0.9}
\DoxyCodeLine{01081                               : (1.0 -\/ \mbox{\hyperlink{class_onion_skin_mask_a6a4c72b75d213e6a3fca82092a520824}{OnionSkinMask::getOnionSkinFade}}(}
\DoxyCodeLine{01082                                            player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}}));}
\DoxyCodeLine{01083     alpha = tcrop(tround(onionSkiFade * 255.0), 0, 255);}
\DoxyCodeLine{01084 }
\DoxyCodeLine{01085     \textcolor{keywordflow}{if} (player.m\_isShiftAndTraceEnabled \&\&}
\DoxyCodeLine{01086         !Preferences::instance()-\/>areOnionColorsUsedForShiftAndTraceGhosts())}
\DoxyCodeLine{01087       onionMode = Node::eOnionSkinNone;}
\DoxyCodeLine{01088     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01089       onionMode =}
\DoxyCodeLine{01090           (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} > 0)}
\DoxyCodeLine{01091               ? Node::eOnionSkinFront}
\DoxyCodeLine{01092               : ((player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} < 0) ? Node::eOnionSkinBack}
\DoxyCodeLine{01093                                                   : Node::eOnionSkinNone);}
\DoxyCodeLine{01094     \}}
\DoxyCodeLine{01095 }
\DoxyCodeLine{01096   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_a2b05fa8fdc95ac04a532fc2d227a3a81}{m\_opacity}} < 255)}
\DoxyCodeLine{01097     alpha = player.\mbox{\hyperlink{class_stage_1_1_player_a2b05fa8fdc95ac04a532fc2d227a3a81}{m\_opacity}};}
\DoxyCodeLine{01098 }
\DoxyCodeLine{01099   m\_nodes.push\_back(\mbox{\hyperlink{class_node}{Node}}(r, ti-\/>getPalette(), alpha, aff, ti-\/>\mbox{\hyperlink{class_t_toonz_image_a11ca395e82657ec209131bf36de8eace}{getSavebox}}(),}
\DoxyCodeLine{01100                          bbox, player.\mbox{\hyperlink{class_stage_1_1_player_af88189b51ebf5b86f87f77281aba0ce1}{m\_frame}}, player.\mbox{\hyperlink{class_stage_1_1_player_aba32c099fd49a4343580c28ade32e144}{m\_isCurrentColumn}},}
\DoxyCodeLine{01101                          onionMode, \textcolor{keyword}{false}, \textcolor{keyword}{false}, \textcolor{keyword}{false}, player.m\_filterColor));}
\DoxyCodeLine{01102 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00158}{Onion\+Skin\+Mask\+::get\+Onion\+Skin\+Fade()}}, \mbox{\hyperlink{l00106}{TToonz\+Image\+::get\+Raster()}}, \mbox{\hyperlink{l00075}{TToonz\+Image\+::get\+Savebox()}}, \mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{TRect\+T$<$ T $>$\+::is\+Empty()}}, \mbox{\hyperlink{l00072}{Stage\+::\+Player\+::m\+\_\+dpi\+Aff}}, \mbox{\hyperlink{l00097}{Stage\+::\+Player\+::m\+\_\+frame}}, \mbox{\hyperlink{l00082}{Stage\+::\+Player\+::m\+\_\+is\+Current\+Column}}, \mbox{\hyperlink{l00077}{Stage\+::\+Player\+::m\+\_\+onion\+Skin\+Distance}}, \mbox{\hyperlink{l00104}{Stage\+::\+Player\+::m\+\_\+opacity}}, and \mbox{\hyperlink{l00071}{Stage\+::\+Player\+::m\+\_\+placement}}.



Referenced by \mbox{\hyperlink{l00783}{on\+Image()}}.

\mbox{\Hypertarget{class_stage_1_1_raster_painter_af0e6e5a351f5dd2ec900fbfe5affa963}\label{class_stage_1_1_raster_painter_af0e6e5a351f5dd2ec900fbfe5affa963}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!onVectorImage@{onVectorImage}}
\index{onVectorImage@{onVectorImage}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{onVectorImage()}{onVectorImage()}}
{\footnotesize\ttfamily void Raster\+Painter\+::on\+Vector\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_vector_image}{TVector\+Image}} $\ast$}]{vi,  }\item[{const \mbox{\hyperlink{class_stage_1_1_player}{Stage\+::\+Player}} \&}]{player }\end{DoxyParamCaption})}

View a vector cell images. ~\newline
 If onion-\/skin is active compute {\bfseries{\mbox{\hyperlink{class_t_onion_fader}{TOnion\+Fader}}}} value. Create and boot a {\bfseries{\mbox{\hyperlink{class_t_vector_render_data}{TVector\+Render\+Data}}}} and recall {\bfseries{tgl\+Draw()}}. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00822                                                              \{}
\DoxyCodeLine{00823   flushRasterImages();}
\DoxyCodeLine{00824 }
\DoxyCodeLine{00825   \textcolor{comment}{// When loaded, vectorimages needs to have regions recomputed, but doing that}}
\DoxyCodeLine{00826   \textcolor{comment}{// while loading them}}
\DoxyCodeLine{00827   \textcolor{comment}{// is quite slow (think about loading whole scenes!..). They are recomputed}}
\DoxyCodeLine{00828   \textcolor{comment}{// the first time they}}
\DoxyCodeLine{00829   \textcolor{comment}{// are selected and shown on screen...except when playing back, to avoid}}
\DoxyCodeLine{00830   \textcolor{comment}{// slowness!}}
\DoxyCodeLine{00831 }
\DoxyCodeLine{00832   \textcolor{comment}{// (Daniele) This function should *NOT* be responsible of that.}}
\DoxyCodeLine{00833   \textcolor{comment}{//           It's the *image itself* that should recalculate or initialize}}
\DoxyCodeLine{00834   \textcolor{comment}{//           said data}}
\DoxyCodeLine{00835   \textcolor{comment}{//           if queried about it and turns out it's not available...}}
\DoxyCodeLine{00836 }
\DoxyCodeLine{00837   \textcolor{keywordflow}{if} (!player.\mbox{\hyperlink{class_stage_1_1_player_a2a22d160f4fa74226fbbbf7e677da4b3}{m\_isPlaying}} \&\& player.\mbox{\hyperlink{class_stage_1_1_player_aba32c099fd49a4343580c28ade32e144}{m\_isCurrentColumn}})}
\DoxyCodeLine{00838     vi-\/>\mbox{\hyperlink{class_t_vector_image_a193a77942595f079e999749a6066c4b8}{recomputeRegionsIfNeeded}}();}
\DoxyCodeLine{00839 }
\DoxyCodeLine{00840   \textcolor{keyword}{const} \mbox{\hyperlink{class_preferences}{Preferences}} \&prefs = *Preferences::instance();}
\DoxyCodeLine{00841 }
\DoxyCodeLine{00842   \mbox{\hyperlink{class_t_color_function}{TColorFunction}} *cf = 0, *guidedCf = 0;}
\DoxyCodeLine{00843   \mbox{\hyperlink{class_t_palette}{TPalette}} *vPalette = vi-\/>getPalette();}
\DoxyCodeLine{00844   TPixel32 bgColor   = TPixel32::White;}
\DoxyCodeLine{00845 }
\DoxyCodeLine{00846   \textcolor{keywordtype}{int} tc = (m\_checkFlags \&\& player.\mbox{\hyperlink{class_stage_1_1_player_aba32c099fd49a4343580c28ade32e144}{m\_isCurrentColumn}})}
\DoxyCodeLine{00847                ? ToonzCheck::instance()-\/>getChecks()}
\DoxyCodeLine{00848                : 0;}
\DoxyCodeLine{00849   \textcolor{keywordtype}{bool} inksOnly = tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876ace675a780bd6cc41302c9b566409149b}{ToonzCheck::eInksOnly}};}
\DoxyCodeLine{00850 }
\DoxyCodeLine{00851   \textcolor{keywordtype}{int} oldFrame = vPalette-\/>\mbox{\hyperlink{class_t_palette_a7fd9f134eeffe1fa9ca39ee3fb6ad1b4}{getFrame}}();}
\DoxyCodeLine{00852   vPalette-\/>\mbox{\hyperlink{class_t_palette_aca7d99a4af59ffaed0ead1f8700c2edc}{setFrame}}(player.\mbox{\hyperlink{class_stage_1_1_player_af88189b51ebf5b86f87f77281aba0ce1}{m\_frame}});}
\DoxyCodeLine{00853 }
\DoxyCodeLine{00854   \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} != c\_noOnionSkin) \{}
\DoxyCodeLine{00855     TPixel32 frontOnionColor, backOnionColor;}
\DoxyCodeLine{00856 }
\DoxyCodeLine{00857     \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} != 0 \&\&}
\DoxyCodeLine{00858         (!player.m\_isShiftAndTraceEnabled ||}
\DoxyCodeLine{00859          Preferences::instance()-\/>areOnionColorsUsedForShiftAndTraceGhosts())) \{}
\DoxyCodeLine{00860       prefs.getOnionData(frontOnionColor, backOnionColor, inksOnly);}
\DoxyCodeLine{00861       bgColor =}
\DoxyCodeLine{00862           (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} < 0) ? backOnionColor : frontOnionColor;}
\DoxyCodeLine{00863     \}}
\DoxyCodeLine{00864 }
\DoxyCodeLine{00865     \textcolor{keywordtype}{double} m[4] = \{1.0, 1.0, 1.0, 1.0\}, c[4];}
\DoxyCodeLine{00866 }
\DoxyCodeLine{00867     \textcolor{comment}{// Weighted addition to RGB and matte multiplication}}
\DoxyCodeLine{00868     m[3] = 1.0 -\/}
\DoxyCodeLine{00869            ((player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == 0)}
\DoxyCodeLine{00870                 ? 0.1}
\DoxyCodeLine{00871                 : \mbox{\hyperlink{class_onion_skin_mask_a6a4c72b75d213e6a3fca82092a520824}{OnionSkinMask::getOnionSkinFade}}(player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}}));}
\DoxyCodeLine{00872     c[0] = (1.0 -\/ m[3]) * bgColor.r, c[1] = (1.0 -\/ m[3]) * bgColor.g,}
\DoxyCodeLine{00873     c[2] = (1.0 -\/ m[3]) * bgColor.b;}
\DoxyCodeLine{00874     c[3] = 0.0;}
\DoxyCodeLine{00875 }
\DoxyCodeLine{00876     cf = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_generic_color_function}{TGenericColorFunction}}(m, c);}
\DoxyCodeLine{00877   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (player.m\_filterColor != TPixel::Black) \{}
\DoxyCodeLine{00878     TPixel32 colorScale = player.m\_filterColor;}
\DoxyCodeLine{00879     colorScale.m        = player.\mbox{\hyperlink{class_stage_1_1_player_a2b05fa8fdc95ac04a532fc2d227a3a81}{m\_opacity}};}
\DoxyCodeLine{00880     cf                  = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_column_color_filter_function}{TColumnColorFilterFunction}}(colorScale);}
\DoxyCodeLine{00881   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_a2b05fa8fdc95ac04a532fc2d227a3a81}{m\_opacity}} < 255)}
\DoxyCodeLine{00882     cf = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_transp_fader}{TTranspFader}}(player.\mbox{\hyperlink{class_stage_1_1_player_a2b05fa8fdc95ac04a532fc2d227a3a81}{m\_opacity}} / 255.0);}
\DoxyCodeLine{00883 }
\DoxyCodeLine{00884   \mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}} rd(m\_viewAff * player.\mbox{\hyperlink{class_stage_1_1_player_a99c9004772f5575fb627dcfb29137459}{m\_placement}}, \mbox{\hyperlink{class_t_rect_t}{TRect}}(), vPalette, cf,}
\DoxyCodeLine{00885                        \textcolor{keyword}{true}  \textcolor{comment}{// alpha enabled}}
\DoxyCodeLine{00886   );}
\DoxyCodeLine{00887 }
\DoxyCodeLine{00888   rd.m\_drawRegions           = !inksOnly;}
\DoxyCodeLine{00889   rd.m\_inkCheckEnabled       = tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a7ad1deef6a508e60252b818c61ce83e9}{ToonzCheck::eInk}};}
\DoxyCodeLine{00890   rd.m\_ink1CheckEnabled      = tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a3137d7221943909520731bd1977219eb}{ToonzCheck::eInk1}};}
\DoxyCodeLine{00891   rd.m\_paintCheckEnabled     = tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a5a4df203cdba2a5eb6f7eba19f9ab62e}{ToonzCheck::ePaint}};}
\DoxyCodeLine{00892   rd.m\_blackBgEnabled        = tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876ab6d35869ac2f7cfc956d498b2089a1ff}{ToonzCheck::eBlackBg}};}
\DoxyCodeLine{00893   rd.m\_colorCheckIndex       = ToonzCheck::instance()-\/>\mbox{\hyperlink{class_toonz_check_a7bea28e4a4ede90c7f52a4e9e2e1c328}{getColorIndex}}();}
\DoxyCodeLine{00894   rd.m\_show0ThickStrokes     = prefs.getShow0ThickLines();}
\DoxyCodeLine{00895   rd.m\_regionAntialias       = prefs.getRegionAntialias();}
\DoxyCodeLine{00896   rd.m\_animatedGuidedDrawing = prefs.getAnimatedGuidedDrawing();}
\DoxyCodeLine{00897   \textcolor{keywordflow}{if} (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} != 0 \&\&}
\DoxyCodeLine{00898       (player.\mbox{\hyperlink{class_stage_1_1_player_aba32c099fd49a4343580c28ade32e144}{m\_isCurrentColumn}} || player.\mbox{\hyperlink{class_stage_1_1_player_af5564bb7e4d82fec3c47554161bf2c91}{m\_isCurrentXsheetLevel}})) \{}
\DoxyCodeLine{00899     \textcolor{keywordflow}{if} (player.m\_isGuidedDrawingEnabled == 3         \textcolor{comment}{// show guides on all}}
\DoxyCodeLine{00900         || (player.m\_isGuidedDrawingEnabled == 1 \&\&  \textcolor{comment}{// show guides on closest}}
\DoxyCodeLine{00901             (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_firstBackOnionSkin ||}
\DoxyCodeLine{00902              player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_firstFrontOnionSkin)) ||}
\DoxyCodeLine{00903         (player.m\_isGuidedDrawingEnabled == 2 \&\&  \textcolor{comment}{// show guides on farthest}}
\DoxyCodeLine{00904          (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_onionSkinBackSize ||}
\DoxyCodeLine{00905           player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_onionSkinFrontSize)) ||}
\DoxyCodeLine{00906         (player.m\_isEditingLevel \&\&  \textcolor{comment}{// fix for level editing mode sending extra}}
\DoxyCodeLine{00907                                      \textcolor{comment}{// players}}
\DoxyCodeLine{00908          player.m\_isGuidedDrawingEnabled == 2 \&\&}
\DoxyCodeLine{00909          player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_lastBackVisibleSkin)) \{}
\DoxyCodeLine{00910       rd.m\_showGuidedDrawing = player.m\_isGuidedDrawingEnabled > 0;}
\DoxyCodeLine{00911       \textcolor{keywordtype}{int} currentStrokeCount = 0;}
\DoxyCodeLine{00912       \textcolor{keywordtype}{int} totalStrokes       = vi-\/>\mbox{\hyperlink{class_t_vector_image_add44e109ce62ba075799c0602724a841}{getStrokeCount}}();}
\DoxyCodeLine{00913       \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl    = player.\mbox{\hyperlink{class_stage_1_1_player_a6230d77933caf93b9699bd5e2de0d2b0}{m\_sl}};}
\DoxyCodeLine{00914 }
\DoxyCodeLine{00915       \textcolor{keywordflow}{if} (sl) \{}
\DoxyCodeLine{00916         \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} image          = sl-\/>getFrame(player.m\_currentFrameId, \textcolor{keyword}{false});}
\DoxyCodeLine{00917         \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vecImage = image;}
\DoxyCodeLine{00918         \textcolor{keywordflow}{if} (vecImage) currentStrokeCount = vecImage-\/>getStrokeCount();}
\DoxyCodeLine{00919         \textcolor{keywordflow}{if} (currentStrokeCount < 0) currentStrokeCount = 0;}
\DoxyCodeLine{00920         \textcolor{keywordflow}{if} (player.m\_guidedFrontStroke != -\/1 \&\&}
\DoxyCodeLine{00921             (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_onionSkinFrontSize ||}
\DoxyCodeLine{00922              player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_firstFrontOnionSkin))}
\DoxyCodeLine{00923           rd.m\_indexToHighlight = player.m\_guidedFrontStroke;}
\DoxyCodeLine{00924         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (player.m\_guidedBackStroke != -\/1 \&\&}
\DoxyCodeLine{00925                  (player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_onionSkinBackSize ||}
\DoxyCodeLine{00926                   player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == player.m\_firstBackOnionSkin))}
\DoxyCodeLine{00927           rd.m\_indexToHighlight = player.m\_guidedBackStroke;}
\DoxyCodeLine{00928         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (currentStrokeCount < totalStrokes)}
\DoxyCodeLine{00929           rd.m\_indexToHighlight = currentStrokeCount;}
\DoxyCodeLine{00930 }
\DoxyCodeLine{00931         \textcolor{keywordtype}{double} guidedM[4] = \{1.0, 1.0, 1.0, 1.0\}, guidedC[4];}
\DoxyCodeLine{00932         TPixel32 bgColor  = TPixel32::Blue;}
\DoxyCodeLine{00933         guidedM[3] =}
\DoxyCodeLine{00934             1.0 -\/}
\DoxyCodeLine{00935             ((player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}} == 0)}
\DoxyCodeLine{00936                  ? 0.1}
\DoxyCodeLine{00937                  : \mbox{\hyperlink{class_onion_skin_mask_a6a4c72b75d213e6a3fca82092a520824}{OnionSkinMask::getOnionSkinFade}}(player.\mbox{\hyperlink{class_stage_1_1_player_ae9146f2fdcb1837482abf535fc5622ef}{m\_onionSkinDistance}}));}
\DoxyCodeLine{00938 }
\DoxyCodeLine{00939         guidedC[0] = (1.0 -\/ guidedM[3]) * bgColor.r,}
\DoxyCodeLine{00940         guidedC[1] = (1.0 -\/ guidedM[3]) * bgColor.g,}
\DoxyCodeLine{00941         guidedC[2] = (1.0 -\/ guidedM[3]) * bgColor.b;}
\DoxyCodeLine{00942         guidedC[3] = 0.0;}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944         guidedCf      = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_generic_color_function}{TGenericColorFunction}}(guidedM, guidedC);}
\DoxyCodeLine{00945         rd.m\_guidedCf = guidedCf;}
\DoxyCodeLine{00946       \}}
\DoxyCodeLine{00947     \}}
\DoxyCodeLine{00948   \}}
\DoxyCodeLine{00949 }
\DoxyCodeLine{00950   \textcolor{keywordflow}{if} (tc \& (\mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876af72e27092872414c3774938597209285}{ToonzCheck::eTransparency}} | \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a7fbcfdc87f510c2d2e271d3629db24fe}{ToonzCheck::eGap}})) \{}
\DoxyCodeLine{00951     TPixel dummy;}
\DoxyCodeLine{00952     rd.m\_tcheckEnabled = \textcolor{keyword}{true};}
\DoxyCodeLine{00953 }
\DoxyCodeLine{00954     \textcolor{keywordflow}{if} (rd.m\_blackBgEnabled)}
\DoxyCodeLine{00955       prefs.getTranspCheckData(rd.m\_tCheckInk, dummy, rd.m\_tCheckPaint);}
\DoxyCodeLine{00956     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00957       prefs.getTranspCheckData(dummy, rd.m\_tCheckInk, rd.m\_tCheckPaint);}
\DoxyCodeLine{00958   \}}
\DoxyCodeLine{00959 }
\DoxyCodeLine{00960   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a84bb519ec0ab16029cba33ff0f3f794f}{m\_colorMask}} != 0) \{}
\DoxyCodeLine{00961     glColorMask((\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a84bb519ec0ab16029cba33ff0f3f794f}{m\_colorMask}} \& TRop::RChan) ? GL\_TRUE : GL\_FALSE,}
\DoxyCodeLine{00962                 (\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a84bb519ec0ab16029cba33ff0f3f794f}{m\_colorMask}} \& TRop::GChan) ? GL\_TRUE : GL\_FALSE,}
\DoxyCodeLine{00963                 (\mbox{\hyperlink{class_stage_1_1_visitor_a4e0d4d1127a689eee8ae947ef5447f1a}{m\_vs}}.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a84bb519ec0ab16029cba33ff0f3f794f}{m\_colorMask}} \& TRop::BChan) ? GL\_TRUE : GL\_FALSE, GL\_TRUE);}
\DoxyCodeLine{00964   \}}
\DoxyCodeLine{00965   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} viDelete;}
\DoxyCodeLine{00966   \textcolor{keywordflow}{if} (tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a7fbcfdc87f510c2d2e271d3629db24fe}{ToonzCheck::eGap}}) \{}
\DoxyCodeLine{00967     viDelete = vi-\/>\mbox{\hyperlink{class_t_vector_image_a0aeac8f2cab4178fa732a237a9b3dbd9}{clone}}();}
\DoxyCodeLine{00968     vi       = viDelete.getPointer();}
\DoxyCodeLine{00969     vi-\/>\mbox{\hyperlink{class_t_vector_image_a21a45dbb1a37fa54736d23d546fe2588}{selectFill}}(vi-\/>\mbox{\hyperlink{class_t_vector_image_a86205b8e894a807fe76937c923f6abc0}{getBBox}}(), 0, 1, \textcolor{keyword}{true}, \textcolor{keyword}{true}, \textcolor{keyword}{false});}
\DoxyCodeLine{00970   \}}
\DoxyCodeLine{00971 }
\DoxyCodeLine{00972   \mbox{\hyperlink{class_t_stroke}{TStroke}} *guidedStroke = 0;}
\DoxyCodeLine{00973   \textcolor{keywordflow}{if} (m\_maskLevel > 0)}
\DoxyCodeLine{00974     tglDrawMask(rd, vi);}
\DoxyCodeLine{00975   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00976     tglDraw(rd, vi, \&guidedStroke);}
\DoxyCodeLine{00977 }
\DoxyCodeLine{00978   \textcolor{keywordflow}{if} (tc \& \mbox{\hyperlink{class_toonz_check_add5b28b42f552cf90e3cfcde9e737876a780c15982eceeb7f1e912a5d55029cef}{ToonzCheck::eAutoclose}}) drawAutocloses(vi, rd);}
\DoxyCodeLine{00979 }
\DoxyCodeLine{00980   glColorMask(GL\_TRUE, GL\_TRUE, GL\_TRUE, GL\_TRUE);}
\DoxyCodeLine{00981   vPalette-\/>\mbox{\hyperlink{class_t_palette_aca7d99a4af59ffaed0ead1f8700c2edc}{setFrame}}(oldFrame);}
\DoxyCodeLine{00982 }
\DoxyCodeLine{00983   \textcolor{keyword}{delete} cf;}
\DoxyCodeLine{00984   \textcolor{keyword}{delete} guidedCf;}
\DoxyCodeLine{00985 }
\DoxyCodeLine{00986   \textcolor{keywordflow}{if} (guidedStroke) m\_guidedStrokes.push\_back(guidedStroke);}
\DoxyCodeLine{00987 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01151}{TVector\+Image\+::clone()}}, \mbox{\hyperlink{l00048}{Toonz\+Check\+::e\+Autoclose}}, \mbox{\hyperlink{l00044}{Toonz\+Check\+::e\+Black\+Bg}}, \mbox{\hyperlink{l00047}{Toonz\+Check\+::e\+Gap}}, \mbox{\hyperlink{l00045}{Toonz\+Check\+::e\+Ink}}, \mbox{\hyperlink{l00050}{Toonz\+Check\+::e\+Ink1}}, \mbox{\hyperlink{l00049}{Toonz\+Check\+::e\+Inks\+Only}}, \mbox{\hyperlink{l00046}{Toonz\+Check\+::e\+Paint}}, \mbox{\hyperlink{l00043}{Toonz\+Check\+::e\+Transparency}}, \mbox{\hyperlink{l00567}{TVector\+Image\+::get\+BBox()}}, \mbox{\hyperlink{l00067}{Toonz\+Check\+::get\+Color\+Index()}}, \mbox{\hyperlink{l01050}{TPalette\+::get\+Frame()}}, \mbox{\hyperlink{l00158}{Onion\+Skin\+Mask\+::get\+Onion\+Skin\+Fade()}}, \mbox{\hyperlink{l00388}{TVector\+Image\+::get\+Stroke\+Count()}}, \mbox{\hyperlink{l00078}{TVector\+Render\+Data\+::m\+\_\+black\+Bg\+Enabled}}, \mbox{\hyperlink{l00065}{TVector\+Render\+Data\+::m\+\_\+color\+Check\+Index}}, \mbox{\hyperlink{l00043}{Image\+Painter\+::\+Visual\+Settings\+::m\+\_\+color\+Mask}}, \mbox{\hyperlink{l00073}{TVector\+Render\+Data\+::m\+\_\+draw\+Regions}}, \mbox{\hyperlink{l00097}{Stage\+::\+Player\+::m\+\_\+frame}}, \mbox{\hyperlink{l00076}{TVector\+Render\+Data\+::m\+\_\+ink1\+Check\+Enabled}}, \mbox{\hyperlink{l00075}{TVector\+Render\+Data\+::m\+\_\+ink\+Check\+Enabled}}, \mbox{\hyperlink{l00082}{Stage\+::\+Player\+::m\+\_\+is\+Current\+Column}}, \mbox{\hyperlink{l00084}{Stage\+::\+Player\+::m\+\_\+is\+Current\+Xsheet\+Level}}, \mbox{\hyperlink{l00100}{Stage\+::\+Player\+::m\+\_\+is\+Playing}}, \mbox{\hyperlink{l00077}{Stage\+::\+Player\+::m\+\_\+onion\+Skin\+Distance}}, \mbox{\hyperlink{l00104}{Stage\+::\+Player\+::m\+\_\+opacity}}, \mbox{\hyperlink{l00077}{TVector\+Render\+Data\+::m\+\_\+paint\+Check\+Enabled}}, \mbox{\hyperlink{l00071}{Stage\+::\+Player\+::m\+\_\+placement}}, \mbox{\hyperlink{l00084}{TVector\+Render\+Data\+::m\+\_\+region\+Antialias}}, \mbox{\hyperlink{l00082}{TVector\+Render\+Data\+::m\+\_\+show0\+Thick\+Strokes}}, \mbox{\hyperlink{l00091}{Stage\+::\+Player\+::m\+\_\+sl}}, \mbox{\hyperlink{l00074}{TVector\+Render\+Data\+::m\+\_\+tcheck\+Enabled}}, \mbox{\hyperlink{l00062}{TVector\+Render\+Data\+::m\+\_\+t\+Check\+Ink}}, \mbox{\hyperlink{l00063}{TVector\+Render\+Data\+::m\+\_\+t\+Check\+Paint}}, \mbox{\hyperlink{l00093}{Stage\+::\+Visitor\+::m\+\_\+vs}}, \mbox{\hyperlink{l01444}{TVector\+Image\+::recompute\+Regions\+If\+Needed()}}, \mbox{\hyperlink{l00772}{TVector\+Image\+::select\+Fill()}}, and \mbox{\hyperlink{l01054}{TPalette\+::set\+Frame()}}.



Referenced by \mbox{\hyperlink{l00783}{on\+Image()}}.

\mbox{\Hypertarget{class_stage_1_1_raster_painter_ae83db2a77bc4cf66f13b9f486c98d977}\label{class_stage_1_1_raster_painter_ae83db2a77bc4cf66f13b9f486c98d977}} 
\index{Stage::RasterPainter@{Stage::RasterPainter}!setRasterDarkenBlendedView@{setRasterDarkenBlendedView}}
\index{setRasterDarkenBlendedView@{setRasterDarkenBlendedView}!Stage::RasterPainter@{Stage::RasterPainter}}
\doxysubsubsection{\texorpdfstring{setRasterDarkenBlendedView()}{setRasterDarkenBlendedView()}}
{\footnotesize\ttfamily void Stage\+::\+Raster\+Painter\+::set\+Raster\+Darken\+Blended\+View (\begin{DoxyParamCaption}\item[{bool}]{on }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00295 \{ m\_doRasterDarkenBlendedView = on; \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/toonz/stagevisitor.\+h\item 
E\+:/opentoonz/toonz/sources/toonzlib/stagevisitor.\+cpp\end{DoxyCompactItemize}
