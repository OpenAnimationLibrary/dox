\hypertarget{class_hook_tool}{}\doxysection{Hook\+Tool Class Reference}
\label{class_hook_tool}\index{HookTool@{HookTool}}
Inheritance diagram for Hook\+Tool\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_hook_tool}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} \mbox{\hyperlink{class_hook_tool_a3cf9eb3d956531959df811b16b83dfd2}{get\+Tool\+Type}} () const override
\item 
\mbox{\hyperlink{class_hook_set}{Hook\+Set}} $\ast$ \mbox{\hyperlink{class_hook_tool_ab9b67ed61092d9af15124a01d038f4a6}{get\+Hook\+Set}} () const
\item 
void \mbox{\hyperlink{class_hook_tool_aae775da44e2e2eaf392eb434b441608f}{update\+Translation}} () override
\item 
void \mbox{\hyperlink{class_hook_tool_a343b508b009569fd1ec11a7fa1d02183}{draw}} () override
\begin{DoxyCompactList}\small\item\em Draws the tool on the viewer. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_hook_tool_a7286399b3991185fb0566374edafe048}{left\+Button\+Down}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_hook_tool_a76d5314be489a54720d7c50e143bf3ee}{left\+Button\+Drag}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_hook_tool_a8fade5844d4c977d22541661290bab17}{left\+Button\+Up}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
void \mbox{\hyperlink{class_hook_tool_a35118a41e4bf4e16c388c7f7253916e6}{mouse\+Move}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_hook_tool_a0b0519ff6819053ec13cf3553d8a4b04}{on\+Activate}} () override
\begin{DoxyCompactList}\small\item\em Callback invoked whenever the tool activates. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_hook_tool_a726c365403f1ecbd00561bd04194ef73}{on\+Deactivate}} () override
\begin{DoxyCompactList}\small\item\em Callback for tool deactivation, includes tool switch. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_hook_tool_adb546c57196dc20dc21157823683b9ff}{on\+Enter}} () override
\begin{DoxyCompactList}\small\item\em Callback for the mouse entering the viewer area. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_hook_tool_ab13910dfcb9af20fde2959033895ddac}{on\+Image\+Changed}} () override
\begin{DoxyCompactList}\small\item\em Notifies changes in the image in use. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ \mbox{\hyperlink{class_hook_tool_ae2b8a6878fca392b88a6698d98296e9c}{get\+Properties}} (int target\+Type) override
\item 
int \mbox{\hyperlink{class_hook_tool_a9879a3067b86d59380e89bbda3670bdd}{get\+Cursor\+Id}} () const override
\begin{DoxyCompactList}\small\item\em Returns the type of cursor used by the tool. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_hook_tool_ac8ac89bc1cab8a8378c075fae14b83cd}{on\+Selection\+Changed}} ()
\item 
bool \mbox{\hyperlink{class_hook_tool_ae3810e73cb778b9b4181e5a734d71bd7}{select}} (const \mbox{\hyperlink{class_t_selection}{TSelection}} $\ast$)
\item 
bool \mbox{\hyperlink{class_hook_tool_a3ac7ca5acf997a4cf9c488daec5d7dc5}{pick}} (int \&hook\+Id, int \&side, const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos)
\item 
bool \mbox{\hyperlink{class_hook_tool_adc4df6721ca252a58e947f2ecfc67eba}{snap}} (\mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, double \&range2)
\item 
bool \mbox{\hyperlink{class_hook_tool_a183b6cd7a17c3589c4256f9712c3f5db}{is\+Snapped\+Active}} () const
\item 
bool \mbox{\hyperlink{class_hook_tool_acacab6d26ed4e8c6c5d652d0975bbfa8}{is\+Editing\+Scene}} () const
\item 
int \mbox{\hyperlink{class_hook_tool_af19167bbf9b5f24580810867378ff7d5}{get\+Pivot\+Index}} ()
\item 
void \mbox{\hyperlink{class_hook_tool_a260170a7794613faf5e8613e73093857}{draw\+Hooks}} (\mbox{\hyperlink{class_hook_set}{Hook\+Set}} $\ast$hook\+Set, const \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} \&fid, bool is\+Onion)
\item 
void \mbox{\hyperlink{class_hook_tool_ab13e00509be85e6ab57c8acaf51f3606}{update\+Matrix}} () override
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_hook_tool_a406e468c10a3ce23768181e1a976ae26}\label{class_hook_tool_a406e468c10a3ce23768181e1a976ae26}} 
\index{HookTool@{HookTool}!HookTool@{HookTool}}
\index{HookTool@{HookTool}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{HookTool()}{HookTool()}}
{\footnotesize\ttfamily Hook\+Tool\+::\+Hook\+Tool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00163     : \mbox{\hyperlink{class_t_tool_a9c63ec35f606e755d0d036bf4fed62ab}{TTool}}(\textcolor{stringliteral}{"{}T\_Hook"{}})}
\DoxyCodeLine{00164     , m\_hookId(-\/1)}
\DoxyCodeLine{00165     , m\_hookSide(0)}
\DoxyCodeLine{00166     , m\_deselectArmed(\textcolor{keyword}{false})}
\DoxyCodeLine{00167     , m\_undo(0)}
\DoxyCodeLine{00168     , m\_snappedActive(\textcolor{stringliteral}{"{}Snap"{}}, \textcolor{keyword}{true})  \textcolor{comment}{// W\_ToolOptions\_Snapped}}
\DoxyCodeLine{00169     , m\_snappedPos()}
\DoxyCodeLine{00170     , m\_snappedReason(\textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00171     , m\_shapeBBox()}
\DoxyCodeLine{00172     , m\_snapped(\textcolor{keyword}{false})}
\DoxyCodeLine{00173     , m\_hookSetChanged(\textcolor{keyword}{false})}
\DoxyCodeLine{00174     , m\_buttonDown(\textcolor{keyword}{false})}
\DoxyCodeLine{00175     , m\_pivotOffset() \{}
\DoxyCodeLine{00176   bind(TTool::CommonLevels);}
\DoxyCodeLine{00177   m\_prop.\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_snappedActive);}
\DoxyCodeLine{00178 }
\DoxyCodeLine{00179   m\_snappedActive.setId(\textcolor{stringliteral}{"{}Snap"{}});}
\DoxyCodeLine{00180 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_hook_tool_a343b508b009569fd1ec11a7fa1d02183}\label{class_hook_tool_a343b508b009569fd1ec11a7fa1d02183}} 
\index{HookTool@{HookTool}!draw@{draw}}
\index{draw@{draw}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void Hook\+Tool\+::draw (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Draws the tool on the viewer. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a058bf656d73bf3cd63b9826cbaaf48e0}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00259                     \{}
\DoxyCodeLine{00260   \textcolor{comment}{// ToolUtils::drawRect(TRectD(10,10,110,110), TPixel32(255,200,200), 0xFFF0);}}
\DoxyCodeLine{00261 }
\DoxyCodeLine{00262   \textcolor{comment}{// draw the current image bounding box}}
\DoxyCodeLine{00263   \textcolor{keyword}{const} \textcolor{keywordtype}{double} v200 = 200.0 / 255.0;}
\DoxyCodeLine{00264   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} image     = \mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00265   \textcolor{keywordflow}{if} (!image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00266 }
\DoxyCodeLine{00267   \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti  = image;}
\DoxyCodeLine{00268   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = image;}
\DoxyCodeLine{00269   \textcolor{keywordflow}{if} (ti) \{}
\DoxyCodeLine{00270     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox =}
\DoxyCodeLine{00271         ToonzImageUtils::convertRasterToWorld(convert(ti-\/>getBBox()), ti);}
\DoxyCodeLine{00272     ToolUtils::drawRect(bbox * ti-\/>getSubsampling(), TPixel32(200, 200, 200),}
\DoxyCodeLine{00273                         0x5555);}
\DoxyCodeLine{00274   \}}
\DoxyCodeLine{00275   \textcolor{keywordflow}{if} (vi) \{}
\DoxyCodeLine{00276     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox = vi-\/>getBBox();}
\DoxyCodeLine{00277     ToolUtils::drawRect(bbox, TPixel32(200, 200, 200), 0x5555);}
\DoxyCodeLine{00278   \}}
\DoxyCodeLine{00279 }
\DoxyCodeLine{00280   \textcolor{comment}{// draw hooks}}
\DoxyCodeLine{00281   \mbox{\hyperlink{class_hook_set}{HookSet}} *hookSet = getHookSet();}
\DoxyCodeLine{00282   \textcolor{keywordflow}{if} (!hookSet) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00283 }
\DoxyCodeLine{00284   \mbox{\hyperlink{class_t_application}{TTool::Application}} *app = TTool::getApplication();}
\DoxyCodeLine{00285   \mbox{\hyperlink{class_t_frame_handle}{TFrameHandle}} *fh        = app-\/>getCurrentFrame();}
\DoxyCodeLine{00286   \mbox{\hyperlink{class_t_frame_id}{TFrameId}} fid            = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{00287   \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *level  = 0;}
\DoxyCodeLine{00288 }
\DoxyCodeLine{00289   \mbox{\hyperlink{class_onion_skin_mask}{OnionSkinMask}} osm = app-\/>getCurrentOnionSkin()-\/>getOnionSkinMask();}
\DoxyCodeLine{00290   std::vector<int> os;}
\DoxyCodeLine{00291 }
\DoxyCodeLine{00292   \textcolor{keywordflow}{if} (isEditingScene())}
\DoxyCodeLine{00293     osm.\mbox{\hyperlink{class_onion_skin_mask_a9e64f221d9750268f449668afb614c11}{getAll}}(\mbox{\hyperlink{class_t_tool_a85025fe6544609814a1672ded5847874}{getFrame}}(), os);}
\DoxyCodeLine{00294   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00295     level = app-\/>getCurrentLevel()-\/>getSimpleLevel();}
\DoxyCodeLine{00296     assert(level);}
\DoxyCodeLine{00297     osm.\mbox{\hyperlink{class_onion_skin_mask_a9e64f221d9750268f449668afb614c11}{getAll}}(level-\/>\mbox{\hyperlink{class_t_xsh_simple_level_af30a02239ef0900c095a0af366dea26a}{guessIndex}}(fid), os);}
\DoxyCodeLine{00298   \}}
\DoxyCodeLine{00299 }
\DoxyCodeLine{00300   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00301   \textcolor{keywordflow}{if} (osm.isEnabled())}
\DoxyCodeLine{00302     \textcolor{keywordflow}{for} (i = 0; i < (int)os.size(); i++) \{}
\DoxyCodeLine{00303       \textcolor{keywordflow}{if} (isEditingScene()) \{}
\DoxyCodeLine{00304         \textcolor{keyword}{const} \mbox{\hyperlink{class_t_xsh_cell}{TXshCell}} \&cell = \mbox{\hyperlink{class_t_tool_a8716e1462da359f4902c044a79f2d40d}{getXsheet}}()-\/>\mbox{\hyperlink{class_t_xsheet_a1ae81edf03bc7527176c84478c350f57}{getCell}}(}
\DoxyCodeLine{00305             os[i], app-\/>getCurrentColumn()-\/>getColumnIndex());}
\DoxyCodeLine{00306         drawHooks(hookSet, cell.\mbox{\hyperlink{class_t_xsh_cell_a5a1965b96c2c698d6f0fb42a80c03406}{getFrameId}}(), \textcolor{keyword}{true});}
\DoxyCodeLine{00307       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00308         \textcolor{keyword}{const} \mbox{\hyperlink{class_t_frame_id}{TFrameId}} \&fid2 = level-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a07279a40ffad2c6ccc597c0a418f78fb}{index2fid}}(os[i]);}
\DoxyCodeLine{00309         drawHooks(hookSet, fid2, \textcolor{keyword}{true});}
\DoxyCodeLine{00310       \}}
\DoxyCodeLine{00311     \}}
\DoxyCodeLine{00312 }
\DoxyCodeLine{00313   drawHooks(hookSet, fid, \textcolor{keyword}{false});}
\DoxyCodeLine{00314 }
\DoxyCodeLine{00315   \textcolor{comment}{// TXshCell cell = xsh-\/>getCell(row, i);}}
\DoxyCodeLine{00316   \textcolor{comment}{// draw other level hooks}}
\DoxyCodeLine{00317   \textcolor{keywordflow}{if} (isSnappedActive() \&\& isEditingScene()) \{}
\DoxyCodeLine{00318     \textcolor{keywordflow}{for} (i = 0; i < (int)m\_otherHooks.size(); i++) \{}
\DoxyCodeLine{00319       drawHook(m\_otherHooks[i].m\_hookPos, OtherLevelHook, \textcolor{keyword}{false});}
\DoxyCodeLine{00320     \}}
\DoxyCodeLine{00321   \}}
\DoxyCodeLine{00322 }
\DoxyCodeLine{00323   \textcolor{comment}{// draw hooks balloons}}
\DoxyCodeLine{00324   std::vector<TRectD> balloons;  \textcolor{comment}{// this is used to avoid balloons overlapping}}
\DoxyCodeLine{00325   \textcolor{keywordtype}{int} pivotIndex = getPivotIndex();}
\DoxyCodeLine{00326   \textcolor{keywordflow}{for} (i = 0; i < hookSet-\/>getHookCount(); i++) \{}
\DoxyCodeLine{00327     \mbox{\hyperlink{class_hook}{Hook}} *hook = hookSet-\/>getHook(i);}
\DoxyCodeLine{00328     \textcolor{keywordflow}{if} (!hook || hook-\/>isEmpty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00329     assert(hook);}
\DoxyCodeLine{00330     \mbox{\hyperlink{class_t_point_t}{TPointD}} p0  = hook-\/>getAPos(fid);}
\DoxyCodeLine{00331     \mbox{\hyperlink{class_t_point_t}{TPointD}} p1  = hook-\/>getBPos(fid);}
\DoxyCodeLine{00332     \textcolor{keywordtype}{bool} linked = p0 == p1;}
\DoxyCodeLine{00333     \textcolor{keywordflow}{if} (i == pivotIndex) \{}
\DoxyCodeLine{00334       p0 += m\_pivotOffset;}
\DoxyCodeLine{00335       p1 += m\_pivotOffset;}
\DoxyCodeLine{00336     \}}
\DoxyCodeLine{00337     TPixel32 balloonColor(200, 220, 205, 200);}
\DoxyCodeLine{00338     \mbox{\hyperlink{class_t_point_t}{TPoint}} balloonOffset(20, 20);}
\DoxyCodeLine{00339     std::string hookName = std::to\_string(i + 1);}
\DoxyCodeLine{00340     drawBalloon(p0, hookName, balloonColor, balloonOffset, getPixelSize(),}
\DoxyCodeLine{00341                 \textcolor{keyword}{false}, \&balloons);}
\DoxyCodeLine{00342     \textcolor{keywordflow}{if} (!linked)}
\DoxyCodeLine{00343       drawBalloon(p1, hookName, balloonColor, balloonOffset, getPixelSize(),}
\DoxyCodeLine{00344                   \textcolor{keyword}{false}, \&balloons);}
\DoxyCodeLine{00345   \}}
\DoxyCodeLine{00346   \textcolor{comment}{// draw snapped hook balloon}}
\DoxyCodeLine{00347   \textcolor{keywordflow}{if} (m\_snappedReason != \textcolor{stringliteral}{"{}"{}}) \{}
\DoxyCodeLine{00348     \mbox{\hyperlink{class_t_point_t}{TPointD}} pos = m\_snappedPos;}
\DoxyCodeLine{00349     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox = m\_shapeBBox;}
\DoxyCodeLine{00350     \textcolor{keywordflow}{if} (bbox.getLx() > 0 \&\& bbox.getLy() > 0) \{}
\DoxyCodeLine{00351       glColor3d(v200, v200, v200);}
\DoxyCodeLine{00352       glEnable(GL\_LINE\_STIPPLE);}
\DoxyCodeLine{00353       glLineStipple(5, 0xAAAA);}
\DoxyCodeLine{00354       tglDrawRect(bbox);}
\DoxyCodeLine{00355       glDisable(GL\_LINE\_STIPPLE);}
\DoxyCodeLine{00356 }
\DoxyCodeLine{00357       glBegin(GL\_LINES);}
\DoxyCodeLine{00358       glVertex2d(pos.x, bbox.y0);}
\DoxyCodeLine{00359       glVertex2d(pos.x, bbox.y1);}
\DoxyCodeLine{00360       glVertex2d(bbox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, pos.y);}
\DoxyCodeLine{00361       glVertex2d(bbox.x1, pos.y);}
\DoxyCodeLine{00362       glEnd();}
\DoxyCodeLine{00363       glDisable(GL\_LINE\_STIPPLE);}
\DoxyCodeLine{00364     \}}
\DoxyCodeLine{00365     drawBalloon(pos, m\_snappedReason, TPixel32(200, 250, 180, 200),}
\DoxyCodeLine{00366                 \mbox{\hyperlink{class_t_point_t}{TPoint}}(20, 20), getPixelSize(), \textcolor{keyword}{false}, \&balloons);}
\DoxyCodeLine{00367   \}}
\DoxyCodeLine{00368 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00073}{Onion\+Skin\+Mask\+::get\+All()}}, \mbox{\hyperlink{l00233}{TXsheet\+::get\+Cell()}}, \mbox{\hyperlink{l00688}{TTool\+::get\+Current\+Fid()}}, \mbox{\hyperlink{l00576}{TTool\+::get\+Frame()}}, \mbox{\hyperlink{l00120}{TXsh\+Cell\+::get\+Frame\+Id()}}, \mbox{\hyperlink{l00276}{TTool\+::get\+Image()}}, \mbox{\hyperlink{l00569}{TTool\+::get\+Xsheet()}}, \mbox{\hyperlink{l00524}{TXsh\+Simple\+Level\+::guess\+Index()}}, \mbox{\hyperlink{l00544}{TXsh\+Simple\+Level\+::index2fid()}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_hook_tool_a260170a7794613faf5e8613e73093857}\label{class_hook_tool_a260170a7794613faf5e8613e73093857}} 
\index{HookTool@{HookTool}!drawHooks@{drawHooks}}
\index{drawHooks@{drawHooks}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{drawHooks()}{drawHooks()}}
{\footnotesize\ttfamily void Hook\+Tool\+::draw\+Hooks (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_hook_set}{Hook\+Set}} $\ast$}]{hook\+Set,  }\item[{const \mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} \&}]{fid,  }\item[{bool}]{is\+Onion }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00234                                                                             \{}
\DoxyCodeLine{00235   \textcolor{keywordtype}{int} pivotIndex = getPivotIndex();}
\DoxyCodeLine{00236   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00237   \textcolor{keywordflow}{for} (i = 0; i < hookSet-\/>getHookCount(); i++) \{}
\DoxyCodeLine{00238     \mbox{\hyperlink{class_hook}{Hook}} *hook = hookSet-\/>getHook(i);}
\DoxyCodeLine{00239     \textcolor{keywordflow}{if} (!hook || hook-\/>isEmpty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00240     assert(hook);}
\DoxyCodeLine{00241     \mbox{\hyperlink{class_t_point_t}{TPointD}} p0 = hook-\/>getAPos(fid);}
\DoxyCodeLine{00242     \mbox{\hyperlink{class_t_point_t}{TPointD}} p1 = hook-\/>getBPos(fid);}
\DoxyCodeLine{00243     \textcolor{keywordflow}{if} (pivotIndex == i) \{}
\DoxyCodeLine{00244       \textcolor{comment}{// translating the pivot doesn't change its actual position, but just the}}
\DoxyCodeLine{00245       \textcolor{comment}{// m\_pivotOffset}}
\DoxyCodeLine{00246       \textcolor{comment}{// the actual pivot position is changed in the mouseUp event}}
\DoxyCodeLine{00247       p0 += m\_pivotOffset;}
\DoxyCodeLine{00248       p1 += m\_pivotOffset;}
\DoxyCodeLine{00249     \}}
\DoxyCodeLine{00250     \textcolor{keywordtype}{bool} linked = p0 == p1;}
\DoxyCodeLine{00251     drawHook(p0, linked ? NormalHook : PassHookA, m\_selection.isSelected(i, 1),}
\DoxyCodeLine{00252              isOnion);}
\DoxyCodeLine{00253     \textcolor{keywordflow}{if} (!linked) drawHook(p1, PassHookB, m\_selection.isSelected(i, 2), isOnion);}
\DoxyCodeLine{00254   \}}
\DoxyCodeLine{00255 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a9879a3067b86d59380e89bbda3670bdd}\label{class_hook_tool_a9879a3067b86d59380e89bbda3670bdd}} 
\index{HookTool@{HookTool}!getCursorId@{getCursorId}}
\index{getCursorId@{getCursorId}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{getCursorId()}{getCursorId()}}
{\footnotesize\ttfamily int Hook\+Tool\+::get\+Cursor\+Id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Returns the type of cursor used by the tool. 

\begin{DoxySeeAlso}{See also}
For a list of cursor ids \mbox{\hyperlink{}{cursor.\+h}} 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{class_t_tool_a1768a57b8b6d1480618fd923fad15f1d}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00122 \{ \textcolor{keywordflow}{return} ToolCursor::MoveCursor; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_ab9b67ed61092d9af15124a01d038f4a6}\label{class_hook_tool_ab9b67ed61092d9af15124a01d038f4a6}} 
\index{HookTool@{HookTool}!getHookSet@{getHookSet}}
\index{getHookSet@{getHookSet}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{getHookSet()}{getHookSet()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_hook_set}{Hook\+Set}} $\ast$ Hook\+Tool\+::get\+Hook\+Set (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00190                                     \{}
\DoxyCodeLine{00191   \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *xl = TTool::getApplication()-\/>getCurrentLevel()-\/>getLevel();}
\DoxyCodeLine{00192   \textcolor{keywordflow}{if} (!xl) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00193   \textcolor{keywordflow}{return} xl-\/>\mbox{\hyperlink{class_t_xsh_level_a6e1f2998c39699adbe9133f87109a104}{getHookSet}}();}
\DoxyCodeLine{00194 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_af19167bbf9b5f24580810867378ff7d5}\label{class_hook_tool_af19167bbf9b5f24580810867378ff7d5}} 
\index{HookTool@{HookTool}!getPivotIndex@{getPivotIndex}}
\index{getPivotIndex@{getPivotIndex}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{getPivotIndex()}{getPivotIndex()}}
{\footnotesize\ttfamily int Hook\+Tool\+::get\+Pivot\+Index (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00139                       \{}
\DoxyCodeLine{00140     \textcolor{keywordflow}{if} (!isEditingScene())}
\DoxyCodeLine{00141       \textcolor{keywordflow}{return} -\/1;  \textcolor{comment}{// a pivot can be defined only when editing a scene}}
\DoxyCodeLine{00142     std::string handle =}
\DoxyCodeLine{00143         \mbox{\hyperlink{class_t_tool_a8716e1462da359f4902c044a79f2d40d}{getXsheet}}()-\/>\mbox{\hyperlink{class_t_xsheet_a13d9b9c08ca8dde39769f5644e046ee5}{getStageObject}}(\mbox{\hyperlink{class_t_tool_a25b57b82dfac131d9d6405e07fbd98b4}{getObjectId}}())-\/>\mbox{\hyperlink{class_t_stage_object_aebee1ac99c0341fe053f272b93586ef2}{getHandle}}();}
\DoxyCodeLine{00144     \textcolor{keywordflow}{if} (handle.find(\textcolor{stringliteral}{"{}H"{}}) != 0) \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00145     \textcolor{keywordflow}{return} std::stoi(handle.substr(1)) -\/ 1;}
\DoxyCodeLine{00146   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_ae2b8a6878fca392b88a6698d98296e9c}\label{class_hook_tool_ae2b8a6878fca392b88a6698d98296e9c}} 
\index{HookTool@{HookTool}!getProperties@{getProperties}}
\index{getProperties@{getProperties}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{getProperties()}{getProperties()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ Hook\+Tool\+::get\+Properties (\begin{DoxyParamCaption}\item[{int}]{target\+Type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00120 \{ \textcolor{keywordflow}{return} \&m\_prop; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a3cf9eb3d956531959df811b16b83dfd2}\label{class_hook_tool_a3cf9eb3d956531959df811b16b83dfd2}} 
\index{HookTool@{HookTool}!getToolType@{getToolType}}
\index{getToolType@{getToolType}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{getToolType()}{getToolType()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} Hook\+Tool\+::get\+Tool\+Type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00096 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296ca18d911ba387409847ad5ae6a731031f8}{TTool::LevelReadTool}}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_acacab6d26ed4e8c6c5d652d0975bbfa8}\label{class_hook_tool_acacab6d26ed4e8c6c5d652d0975bbfa8}} 
\index{HookTool@{HookTool}!isEditingScene@{isEditingScene}}
\index{isEditingScene@{isEditingScene}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{isEditingScene()}{isEditingScene()}}
{\footnotesize\ttfamily bool Hook\+Tool\+::is\+Editing\+Scene (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00132                               \{}
\DoxyCodeLine{00133     \textcolor{keywordflow}{return} getApplication()-\/>getCurrentFrame()-\/>isEditingScene();}
\DoxyCodeLine{00134   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a183b6cd7a17c3589c4256f9712c3f5db}\label{class_hook_tool_a183b6cd7a17c3589c4256f9712c3f5db}} 
\index{HookTool@{HookTool}!isSnappedActive@{isSnappedActive}}
\index{isSnappedActive@{isSnappedActive}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{isSnappedActive()}{isSnappedActive()}}
{\footnotesize\ttfamily bool Hook\+Tool\+::is\+Snapped\+Active (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00131 \{ \textcolor{keywordflow}{return} m\_snappedActive.getValue(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a7286399b3991185fb0566374edafe048}\label{class_hook_tool_a7286399b3991185fb0566374edafe048}} 
\index{HookTool@{HookTool}!leftButtonDown@{leftButtonDown}}
\index{leftButtonDown@{leftButtonDown}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDown()}{leftButtonDown()}}
{\footnotesize\ttfamily void Hook\+Tool\+::left\+Button\+Down (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00414                                                                       \{}
\DoxyCodeLine{00415   \mbox{\hyperlink{class_t_application}{TTool::Application}} *app = TTool::getApplication();}
\DoxyCodeLine{00416   \textcolor{keywordflow}{if} (!app) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00417 }
\DoxyCodeLine{00418   m\_buttonDown = \textcolor{keyword}{true};}
\DoxyCodeLine{00419   m\_snapped    = \textcolor{keyword}{false};}
\DoxyCodeLine{00420 }
\DoxyCodeLine{00421   \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *xl                          = app-\/>getCurrentLevel()-\/>getLevel();}
\DoxyCodeLine{00422   \textcolor{keywordflow}{if} (xl \&\& xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}()) m\_undo = \textcolor{keyword}{new} \mbox{\hyperlink{class_hook_undo}{HookUndo}}(xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}());}
\DoxyCodeLine{00423   m\_selection.setLevel(xl);}
\DoxyCodeLine{00424   m\_firstPos = m\_lastPos = pos;}
\DoxyCodeLine{00425   m\_hookId = -\/1, m\_hookSide = 0;}
\DoxyCodeLine{00426   m\_deselectArmed = \textcolor{keyword}{false};}
\DoxyCodeLine{00427   \textcolor{keywordflow}{if} (pick(m\_hookId, m\_hookSide, pos)) \{}
\DoxyCodeLine{00428     \textcolor{keywordflow}{if} (m\_hookSide == 3)  \textcolor{comment}{// ho cliccato su un cerchio-\/croce}}
\DoxyCodeLine{00429     \{}
\DoxyCodeLine{00430       \textcolor{keywordflow}{if} (e.isAltPressed())  \textcolor{comment}{// con l'alt voglio dividere}}
\DoxyCodeLine{00431       \{}
\DoxyCodeLine{00432         m\_selection.selectNone();}
\DoxyCodeLine{00433         m\_selection.select(m\_hookId, 2);}
\DoxyCodeLine{00434       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e.isCtrlPressed()) \{}
\DoxyCodeLine{00435         \textcolor{comment}{// se sono tutti e due selezionati li deseleziono}}
\DoxyCodeLine{00436         \textcolor{keywordflow}{if} (m\_selection.isSelected(m\_hookId, 1) \&\&}
\DoxyCodeLine{00437             m\_selection.isSelected(m\_hookId, 2)) \{}
\DoxyCodeLine{00438           m\_selection.unselect(m\_hookId, 1);}
\DoxyCodeLine{00439           m\_selection.unselect(m\_hookId, 2);}
\DoxyCodeLine{00440         \} \textcolor{keywordflow}{else}  \textcolor{comment}{// altrimenti li seleziono tutti e due}}
\DoxyCodeLine{00441         \{}
\DoxyCodeLine{00442           m\_selection.select(m\_hookId, 1);}
\DoxyCodeLine{00443           m\_selection.select(m\_hookId, 2);}
\DoxyCodeLine{00444         \}}
\DoxyCodeLine{00445       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00446         \textcolor{comment}{// senza control ne' shift ne' alt: se ho cliccato su un hook non}}
\DoxyCodeLine{00447         \textcolor{comment}{// selezionato}}
\DoxyCodeLine{00448         \textcolor{comment}{// deseleziono tutti gli altri e lo seleziono, altrimenti lascio tutto}}
\DoxyCodeLine{00449         \textcolor{comment}{// com'e' e al buttonup se non c'e' stato movimento deseleziono gli}}
\DoxyCodeLine{00450         \textcolor{comment}{// altri}}
\DoxyCodeLine{00451         \textcolor{keywordflow}{if} (m\_selection.isSelected(m\_hookId, 1) ||}
\DoxyCodeLine{00452             m\_selection.isSelected(m\_hookId, 2))}
\DoxyCodeLine{00453           m\_deselectArmed = \textcolor{keyword}{true};}
\DoxyCodeLine{00454         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00455           m\_selection.selectNone();}
\DoxyCodeLine{00456           m\_selection.select(m\_hookId, 1);}
\DoxyCodeLine{00457           m\_selection.select(m\_hookId, 2);}
\DoxyCodeLine{00458         \}}
\DoxyCodeLine{00459       \}}
\DoxyCodeLine{00460     \} \textcolor{keywordflow}{else}  \textcolor{comment}{// ho cliccato o su un cerchio o su una croce}}
\DoxyCodeLine{00461     \{}
\DoxyCodeLine{00462       \textcolor{keywordflow}{if} (e.isCtrlPressed())}
\DoxyCodeLine{00463         m\_selection.invertSelection(m\_hookId, m\_hookSide);}
\DoxyCodeLine{00464       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00465         m\_selection.selectNone();}
\DoxyCodeLine{00466         m\_selection.select(m\_hookId, m\_hookSide);}
\DoxyCodeLine{00467       \}}
\DoxyCodeLine{00468     \}}
\DoxyCodeLine{00469   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00470     \textcolor{comment}{// non ho cliccato su nulla: con ctrl non faccio nulla, senza creo un nuovo}}
\DoxyCodeLine{00471     \textcolor{comment}{// hook}}
\DoxyCodeLine{00472     \textcolor{keywordflow}{if} (!e.isCtrlPressed()) \{}
\DoxyCodeLine{00473       m\_selection.selectNone();}
\DoxyCodeLine{00474       \mbox{\hyperlink{class_t_frame_id}{TFrameId}} fid     = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{00475       \mbox{\hyperlink{class_hook_set}{HookSet}} *hookSet = getHookSet();}
\DoxyCodeLine{00476       \textcolor{keywordflow}{if} (hookSet \&\& xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}() \&\&}
\DoxyCodeLine{00477           !xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}()-\/>isReadOnly()) \{}
\DoxyCodeLine{00478         \mbox{\hyperlink{class_hook}{Hook}} *hook       = hookSet-\/>\mbox{\hyperlink{class_hook_set_aa1e6762564a3de08d0b70e178b7c5df7}{addHook}}();}
\DoxyCodeLine{00479         m\_hookSetChanged = \textcolor{keyword}{true};}
\DoxyCodeLine{00480         \textcolor{keywordflow}{if} (hook) \{}
\DoxyCodeLine{00481           \mbox{\hyperlink{class_t_point_t}{TPointD}} ppos(pos);}
\DoxyCodeLine{00482           \textcolor{keywordflow}{if} (m\_snappedReason != \textcolor{stringliteral}{"{}"{}}) \{}
\DoxyCodeLine{00483             m\_snapped = \textcolor{keyword}{true};}
\DoxyCodeLine{00484             ppos      = m\_snappedPos;}
\DoxyCodeLine{00485           \}}
\DoxyCodeLine{00486           m\_snappedReason = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00487           hook-\/>setAPos(fid, ppos);}
\DoxyCodeLine{00488           ppos = hook-\/>getAPos(fid);}
\DoxyCodeLine{00489           m\_selection.select(hook-\/>getId(), 1);}
\DoxyCodeLine{00490           m\_selection.select(hook-\/>getId(), 2);}
\DoxyCodeLine{00491         \}}
\DoxyCodeLine{00492       \}}
\DoxyCodeLine{00493     \}}
\DoxyCodeLine{00494   \}}
\DoxyCodeLine{00495   m\_pivotOffset = \mbox{\hyperlink{class_t_point_t}{TPointD}}();}
\DoxyCodeLine{00496   m\_selection.makeCurrent();}
\DoxyCodeLine{00497   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00498 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a76d5314be489a54720d7c50e143bf3ee}\label{class_hook_tool_a76d5314be489a54720d7c50e143bf3ee}} 
\index{HookTool@{HookTool}!leftButtonDrag@{leftButtonDrag}}
\index{leftButtonDrag@{leftButtonDrag}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDrag()}{leftButtonDrag()}}
{\footnotesize\ttfamily void Hook\+Tool\+::left\+Button\+Drag (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00502                                                                      \{}
\DoxyCodeLine{00503   \mbox{\hyperlink{class_t_application}{TTool::Application}} *app = TTool::getApplication();}
\DoxyCodeLine{00504   \textcolor{keywordflow}{if} (!app) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00505 }
\DoxyCodeLine{00506   \textcolor{keywordflow}{if} (m\_snapped) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00507 }
\DoxyCodeLine{00508   \mbox{\hyperlink{class_t_frame_id}{TFrameId}} fid = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{00509 }
\DoxyCodeLine{00510   \textcolor{comment}{// cerco di capire se sto muovendo un unico hook "{}unito"{}}}
\DoxyCodeLine{00511   \mbox{\hyperlink{class_t_point_t}{TPointD}} hookPos;}
\DoxyCodeLine{00512   \mbox{\hyperlink{class_hook_set}{HookSet}} *hookSet = getHookSet();}
\DoxyCodeLine{00513   \textcolor{keywordflow}{if} (!hookSet) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00514 }
\DoxyCodeLine{00515   \textcolor{keywordtype}{bool} draggingPivot = \textcolor{keyword}{false};}
\DoxyCodeLine{00516   \textcolor{keywordtype}{int} pivotIndex     = getPivotIndex();}
\DoxyCodeLine{00517   \textcolor{keywordtype}{int} i, count = 0;}
\DoxyCodeLine{00518   \textcolor{keywordflow}{for} (i = 0; i < hookSet-\/>getHookCount(); i++) \{}
\DoxyCodeLine{00519     \mbox{\hyperlink{class_hook}{Hook}} *hook = hookSet-\/>getHook(i);}
\DoxyCodeLine{00520     \textcolor{keywordflow}{if} (!hook || hook-\/>isEmpty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00521     \mbox{\hyperlink{class_t_point_t}{TPointD}} aPos = hook-\/>getAPos(fid);}
\DoxyCodeLine{00522     \mbox{\hyperlink{class_t_point_t}{TPointD}} bPos = hook-\/>getBPos(fid);}
\DoxyCodeLine{00523     \textcolor{keywordflow}{if} (m\_selection.isSelected(i, 1) \&\& m\_selection.isSelected(i, 2) \&\&}
\DoxyCodeLine{00524         aPos == bPos) \{}
\DoxyCodeLine{00525       count++;}
\DoxyCodeLine{00526       hookPos = aPos;}
\DoxyCodeLine{00527     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_selection.isSelected(i, 1) || m\_selection.isSelected(i, 2)) \{}
\DoxyCodeLine{00528       count = 0;}
\DoxyCodeLine{00529       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00530     \}}
\DoxyCodeLine{00531     \textcolor{keywordflow}{if} (i == pivotIndex \&\& m\_selection.isSelected(i, 1)) draggingPivot = \textcolor{keyword}{true};}
\DoxyCodeLine{00532   \}}
\DoxyCodeLine{00533 }
\DoxyCodeLine{00534   \mbox{\hyperlink{class_t_point_t}{TPointD}} pos(pp);}
\DoxyCodeLine{00535   \mbox{\hyperlink{class_t_point_t}{TPointD}} delta = pos -\/ m\_lastPos;}
\DoxyCodeLine{00536   \textcolor{keywordflow}{if} (e.isShiftPressed()) \{}
\DoxyCodeLine{00537     \textcolor{comment}{// se e' pigiato lo shift non snappa e si muove solo in}}
\DoxyCodeLine{00538     \textcolor{comment}{// orizzontale/verticale}}
\DoxyCodeLine{00539     \mbox{\hyperlink{class_t_point_t}{TPointD}} d = pos -\/ m\_firstPos;}
\DoxyCodeLine{00540     \textcolor{keywordflow}{if} (d.x * d.x > d.y * d.y)}
\DoxyCodeLine{00541       pos.y = m\_firstPos.y;}
\DoxyCodeLine{00542     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00543       pos.x = m\_firstPos.x;}
\DoxyCodeLine{00544     delta   = pos -\/ m\_lastPos;}
\DoxyCodeLine{00545   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (count == 1 \&\& isSnappedActive() \&\& !draggingPivot) \{}
\DoxyCodeLine{00546     \textcolor{comment}{// snappa}}
\DoxyCodeLine{00547     \mbox{\hyperlink{class_t_point_t}{TPointD}} oldHookPos = hookPos;}
\DoxyCodeLine{00548     hookPos += pos -\/ m\_lastPos;}
\DoxyCodeLine{00549     \textcolor{keywordtype}{double} range2 = getPixelSize() * 20;}
\DoxyCodeLine{00550     range2 *= range2;}
\DoxyCodeLine{00551     m\_snappedReason = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00552     m\_shapeBBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00553     \textcolor{keywordflow}{if} (snap(hookPos, range2)) \{}
\DoxyCodeLine{00554       delta = hookPos -\/ oldHookPos;}
\DoxyCodeLine{00555       pos   = delta + m\_lastPos;}
\DoxyCodeLine{00556     \}}
\DoxyCodeLine{00557   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (count > 1 \&\& isSnappedActive() \&\& !draggingPivot) \{}
\DoxyCodeLine{00558     \mbox{\hyperlink{class_t_point_t}{TPointD}} oldHookPos = hookPos;}
\DoxyCodeLine{00559     \textcolor{comment}{// delta = pos -\/ m\_lastPos;}}
\DoxyCodeLine{00560     \mbox{\hyperlink{class_t_point_t}{TPointD}} snappedDelta = delta;}
\DoxyCodeLine{00561     \textcolor{keywordtype}{double} range2        = getPixelSize() * 20;}
\DoxyCodeLine{00562     range2 *= range2;}
\DoxyCodeLine{00563     m\_snappedReason = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00564     m\_shapeBBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00565 }
\DoxyCodeLine{00566     \textcolor{keywordflow}{for} (i = 0; i < hookSet-\/>getHookCount(); i++) \{}
\DoxyCodeLine{00567       \mbox{\hyperlink{class_hook}{Hook}} *hook = hookSet-\/>getHook(i);}
\DoxyCodeLine{00568       \textcolor{keywordflow}{if} (hook \&\& !hook-\/>isEmpty()) \{}
\DoxyCodeLine{00569         \textcolor{keywordflow}{if} (m\_selection.isSelected(i, 1)) \{}
\DoxyCodeLine{00570           \mbox{\hyperlink{class_t_point_t}{TPointD}} p0 = hook-\/>getAPos(fid);}
\DoxyCodeLine{00571           \mbox{\hyperlink{class_t_point_t}{TPointD}} p1 = p0 + delta;}
\DoxyCodeLine{00572           \textcolor{keywordflow}{if} (snap(p1, range2)) snappedDelta = p1 -\/ p0;}
\DoxyCodeLine{00573         \}}
\DoxyCodeLine{00574         \textcolor{keywordflow}{if} (m\_selection.isSelected(i, 1)) \{}
\DoxyCodeLine{00575           \mbox{\hyperlink{class_t_point_t}{TPointD}} p0 = hook-\/>getBPos(fid);}
\DoxyCodeLine{00576           \mbox{\hyperlink{class_t_point_t}{TPointD}} p1 = p0 + delta;}
\DoxyCodeLine{00577           \textcolor{keywordflow}{if} (snap(p1, range2)) snappedDelta = p1 -\/ p0;}
\DoxyCodeLine{00578         \}}
\DoxyCodeLine{00579       \}}
\DoxyCodeLine{00580     \}}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582     pos   = m\_lastPos + snappedDelta;}
\DoxyCodeLine{00583     delta = snappedDelta;}
\DoxyCodeLine{00584   \}}
\DoxyCodeLine{00585 }
\DoxyCodeLine{00586   m\_lastPos = pos;}
\DoxyCodeLine{00587 }
\DoxyCodeLine{00588   \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh = \mbox{\hyperlink{class_t_tool_a8716e1462da359f4902c044a79f2d40d}{getXsheet}}();}
\DoxyCodeLine{00589   \textcolor{comment}{//  std::string handle =}}
\DoxyCodeLine{00590   \textcolor{comment}{//  getXsheet()-\/>getStageObject(TStageObjectId::ColumnId())-\/>getHandle();}}
\DoxyCodeLine{00591 }
\DoxyCodeLine{00592   \textcolor{comment}{// actual movement}}
\DoxyCodeLine{00593   \textcolor{keywordflow}{for} (i = 0; i < hookSet-\/>getHookCount(); i++) \{}
\DoxyCodeLine{00594     \mbox{\hyperlink{class_hook}{Hook}} *hook = hookSet-\/>getHook(i);}
\DoxyCodeLine{00595     \textcolor{keywordflow}{if} (!hook || hook-\/>isEmpty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00596 }
\DoxyCodeLine{00597     \mbox{\hyperlink{class_t_point_t}{TPointD}} aPos   = hook-\/>getAPos(fid);}
\DoxyCodeLine{00598     \mbox{\hyperlink{class_t_point_t}{TPointD}} bPos   = hook-\/>getBPos(fid);}
\DoxyCodeLine{00599     \textcolor{keywordtype}{bool} aSelected = m\_selection.isSelected(i, 1);}
\DoxyCodeLine{00600     \textcolor{keywordtype}{bool} bSelected = m\_selection.isSelected(i, 2);}
\DoxyCodeLine{00601     \textcolor{keywordflow}{if} (pivotIndex == i) \{}
\DoxyCodeLine{00602       \textcolor{keywordflow}{if} (aSelected) \{}
\DoxyCodeLine{00603         m\_pivotOffset += delta;}
\DoxyCodeLine{00604         \textcolor{keywordflow}{if} (!bSelected) hook-\/>setBPos(fid, bPos -\/ delta);}
\DoxyCodeLine{00605       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (bSelected)}
\DoxyCodeLine{00606         hook-\/>setBPos(fid, bPos + delta);}
\DoxyCodeLine{00607     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00608       \textcolor{keywordflow}{if} (aSelected) hook-\/>setAPos(fid, aPos + delta);}
\DoxyCodeLine{00609       \textcolor{keywordflow}{if} (bSelected) hook-\/>setBPos(fid, bPos + delta);}
\DoxyCodeLine{00610     \}}
\DoxyCodeLine{00611     m\_hookSetChanged = \textcolor{keyword}{true};}
\DoxyCodeLine{00612   \}}
\DoxyCodeLine{00613   \mbox{\hyperlink{class_t_tool_a8716e1462da359f4902c044a79f2d40d}{getXsheet}}()-\/>\mbox{\hyperlink{class_t_xsheet_a5dc925584e35e1678f5678b79c470959}{getStageObjectTree}}()-\/>\mbox{\hyperlink{class_t_stage_object_tree_aa88239ff5581af5d748d822d1f01cd9d}{invalidateAll}}();}
\DoxyCodeLine{00614   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00615 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a8fade5844d4c977d22541661290bab17}\label{class_hook_tool_a8fade5844d4c977d22541661290bab17}} 
\index{HookTool@{HookTool}!leftButtonUp@{leftButtonUp}}
\index{leftButtonUp@{leftButtonUp}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{leftButtonUp()}{leftButtonUp()}}
{\footnotesize\ttfamily void Hook\+Tool\+::left\+Button\+Up (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00619                                                                    \{}
\DoxyCodeLine{00620   \mbox{\hyperlink{class_t_application}{TTool::Application}} *app = TTool::getApplication();}
\DoxyCodeLine{00621   \textcolor{keywordflow}{if} (!app) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00622 }
\DoxyCodeLine{00623   \textcolor{comment}{// note: apparently sometimes (when the user triple-\/clicks) we receive this}}
\DoxyCodeLine{00624   \textcolor{comment}{// event twice}}
\DoxyCodeLine{00625   \textcolor{keywordflow}{if} (!m\_buttonDown) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00626   m\_buttonDown = \textcolor{keyword}{false};}
\DoxyCodeLine{00627 }
\DoxyCodeLine{00628   \textcolor{comment}{// if I've moved the pivot hook I have to perform the actual movement in the}}
\DoxyCodeLine{00629   \textcolor{comment}{// mouse up event}}
\DoxyCodeLine{00630   \textcolor{keywordtype}{int} pivotIndex = getPivotIndex();}
\DoxyCodeLine{00631   \textcolor{keywordflow}{if} (m\_selection.isSelected(pivotIndex, 1) \&\& m\_pivotOffset != \mbox{\hyperlink{class_t_point_t}{TPointD}}()) \{}
\DoxyCodeLine{00632     \mbox{\hyperlink{class_hook_set}{HookSet}} *hookSet = getHookSet();}
\DoxyCodeLine{00633     \textcolor{keywordflow}{if} (hookSet) \{}
\DoxyCodeLine{00634       \mbox{\hyperlink{class_hook}{Hook}} *hook = hookSet-\/>getHook(pivotIndex);}
\DoxyCodeLine{00635       \textcolor{keywordflow}{if} (hook \&\& !hook-\/>isEmpty()) \{}
\DoxyCodeLine{00636         \mbox{\hyperlink{class_t_frame_id}{TFrameId}} fid = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{00637         \mbox{\hyperlink{class_t_point_t}{TPointD}} aPos = hook-\/>getAPos(fid);}
\DoxyCodeLine{00638         \mbox{\hyperlink{class_t_point_t}{TPointD}} bPos = hook-\/>getBPos(fid);}
\DoxyCodeLine{00639         hook-\/>setAPos(fid, aPos + m\_pivotOffset);}
\DoxyCodeLine{00640         hook-\/>setBPos(fid, bPos + m\_pivotOffset);}
\DoxyCodeLine{00641         \mbox{\hyperlink{class_t_tool_a8716e1462da359f4902c044a79f2d40d}{getXsheet}}()-\/>\mbox{\hyperlink{class_t_xsheet_a5dc925584e35e1678f5678b79c470959}{getStageObjectTree}}()-\/>\mbox{\hyperlink{class_t_stage_object_tree_aa88239ff5581af5d748d822d1f01cd9d}{invalidateAll}}();}
\DoxyCodeLine{00642         \mbox{\hyperlink{class_hook_tool_ab13e00509be85e6ab57c8acaf51f3606}{updateMatrix}}();}
\DoxyCodeLine{00643       \}}
\DoxyCodeLine{00644     \}}
\DoxyCodeLine{00645   \}}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647   m\_snapped = \textcolor{keyword}{false};}
\DoxyCodeLine{00648   \textcolor{comment}{// m\_selection.selectNone();}}
\DoxyCodeLine{00649   \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *xl = app-\/>getCurrentLevel()-\/>getLevel();}
\DoxyCodeLine{00650   \textcolor{keywordflow}{if} (!xl || !xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00651   xl-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}()-\/>\mbox{\hyperlink{class_t_xsh_simple_level_ad412dd5c3a6ae3ff20a480dc728b26d2}{getProperties}}()-\/>\mbox{\hyperlink{class_level_properties_a61fc160a558f50d75be87c6fae066d57}{setDirtyFlag}}(\textcolor{keyword}{true});}
\DoxyCodeLine{00652   \mbox{\hyperlink{class_t_point_t}{TPointD}} delta = m\_lastPos -\/ m\_firstPos;}
\DoxyCodeLine{00653   \textcolor{keywordflow}{if} (m\_deselectArmed \&\& norm2(delta) < 10) \{}
\DoxyCodeLine{00654     m\_selection.selectNone();}
\DoxyCodeLine{00655     m\_selection.unselect(m\_hookId, 1);}
\DoxyCodeLine{00656     m\_selection.unselect(m\_hookId, 2);}
\DoxyCodeLine{00657   \}}
\DoxyCodeLine{00658   m\_deselectArmed = \textcolor{keyword}{false};}
\DoxyCodeLine{00659   \textcolor{keywordflow}{if} (m\_undo \&\& m\_hookSetChanged)}
\DoxyCodeLine{00660     TUndoManager::manager()-\/>add(m\_undo);}
\DoxyCodeLine{00661   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00662     \textcolor{keyword}{delete} m\_undo;}
\DoxyCodeLine{00663     m\_undo = 0;}
\DoxyCodeLine{00664   \}}
\DoxyCodeLine{00665   m\_hookSetChanged = \textcolor{keyword}{false};}
\DoxyCodeLine{00666   m\_pivotOffset    = \mbox{\hyperlink{class_t_point_t}{TPointD}}();}
\DoxyCodeLine{00667 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a35118a41e4bf4e16c388c7f7253916e6}\label{class_hook_tool_a35118a41e4bf4e16c388c7f7253916e6}} 
\index{HookTool@{HookTool}!mouseMove@{mouseMove}}
\index{mouseMove@{mouseMove}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{mouseMove()}{mouseMove()}}
{\footnotesize\ttfamily void Hook\+Tool\+::mouse\+Move (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00733                                                                  \{}
\DoxyCodeLine{00734   std::string oldReason = m\_snappedReason;}
\DoxyCodeLine{00735   \mbox{\hyperlink{class_t_point_t}{TPointD}} oldPos        = m\_snappedPos;}
\DoxyCodeLine{00736 }
\DoxyCodeLine{00737   m\_snappedPos    = \mbox{\hyperlink{class_t_point_t}{TPointD}}();}
\DoxyCodeLine{00738   m\_snappedReason = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00739   m\_shapeBBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00740 }
\DoxyCodeLine{00741   m\_otherHooks.clear();}
\DoxyCodeLine{00742   getOtherHooks(m\_otherHooks);}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00744   \textcolor{keywordtype}{int} hookId, side;}
\DoxyCodeLine{00745   \textcolor{keywordflow}{if} (pick(hookId, side, pos)) \{}
\DoxyCodeLine{00746     \textcolor{keywordflow}{if} (oldReason != \textcolor{stringliteral}{"{}"{}}) \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00747     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00748   \}}
\DoxyCodeLine{00749 }
\DoxyCodeLine{00750   \textcolor{keywordflow}{if} (isSnappedActive()) \{}
\DoxyCodeLine{00751     \textcolor{keywordtype}{double} range2 = getPixelSize() * 20.0;}
\DoxyCodeLine{00752     range2 *= range2;}
\DoxyCodeLine{00753     \mbox{\hyperlink{class_t_point_t}{TPointD}} snappedPos = pos;}
\DoxyCodeLine{00754     snap(snappedPos, range2);}
\DoxyCodeLine{00755   \}}
\DoxyCodeLine{00756 }
\DoxyCodeLine{00757   \textcolor{keywordflow}{if} (m\_snappedReason != oldReason || m\_snappedPos != oldPos) \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00758 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a0b0519ff6819053ec13cf3553d8a4b04}\label{class_hook_tool_a0b0519ff6819053ec13cf3553d8a4b04}} 
\index{HookTool@{HookTool}!onActivate@{onActivate}}
\index{onActivate@{onActivate}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{onActivate()}{onActivate()}}
{\footnotesize\ttfamily void Hook\+Tool\+::on\+Activate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback invoked whenever the tool activates. 



Reimplemented from \mbox{\hyperlink{class_t_tool_ac286a2681633b4db6106596b4f54e53b}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00762                           \{}
\DoxyCodeLine{00763   \textcolor{comment}{// TODO: getApplication()-\/>editImageOrSpline();}}
\DoxyCodeLine{00764   m\_otherHooks.clear();}
\DoxyCodeLine{00765   getOtherHooks(m\_otherHooks);}
\DoxyCodeLine{00766   m\_selection.makeCurrent();}
\DoxyCodeLine{00767 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a726c365403f1ecbd00561bd04194ef73}\label{class_hook_tool_a726c365403f1ecbd00561bd04194ef73}} 
\index{HookTool@{HookTool}!onDeactivate@{onDeactivate}}
\index{onDeactivate@{onDeactivate}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{onDeactivate()}{onDeactivate()}}
{\footnotesize\ttfamily void Hook\+Tool\+::on\+Deactivate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for tool deactivation, includes tool switch. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a00fee58728c1e12fb50846f47d7e9f5e}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00771                             \{}
\DoxyCodeLine{00772   m\_selection.selectNone();}
\DoxyCodeLine{00773   TSelection::setCurrent(0);}
\DoxyCodeLine{00774 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_adb546c57196dc20dc21157823683b9ff}\label{class_hook_tool_adb546c57196dc20dc21157823683b9ff}} 
\index{HookTool@{HookTool}!onEnter@{onEnter}}
\index{onEnter@{onEnter}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{onEnter()}{onEnter()}}
{\footnotesize\ttfamily void Hook\+Tool\+::on\+Enter (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for the mouse entering the viewer area. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a3e775cfcd05aa3c35048b11fa40ab3e4}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00778 \{ m\_selection.makeCurrent(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_ab13910dfcb9af20fde2959033895ddac}\label{class_hook_tool_ab13910dfcb9af20fde2959033895ddac}} 
\index{HookTool@{HookTool}!onImageChanged@{onImageChanged}}
\index{onImageChanged@{onImageChanged}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{onImageChanged()}{onImageChanged()}}
{\footnotesize\ttfamily void Hook\+Tool\+::on\+Image\+Changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Notifies changes in the image in use. 



Reimplemented from \mbox{\hyperlink{class_t_tool_aaf1e021290e74c1b085e4b095668e1ed}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00112                                  \{}
\DoxyCodeLine{00113     m\_selection.selectNone();}
\DoxyCodeLine{00114     m\_hookId = -\/1;}
\DoxyCodeLine{00115     m\_otherHooks.clear();}
\DoxyCodeLine{00116     getOtherHooks(m\_otherHooks);}
\DoxyCodeLine{00117     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00118   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00540}{TTool\+::invalidate()}}.

\mbox{\Hypertarget{class_hook_tool_ac8ac89bc1cab8a8378c075fae14b83cd}\label{class_hook_tool_ac8ac89bc1cab8a8378c075fae14b83cd}} 
\index{HookTool@{HookTool}!onSelectionChanged@{onSelectionChanged}}
\index{onSelectionChanged@{onSelectionChanged}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{onSelectionChanged()}{onSelectionChanged()}}
{\footnotesize\ttfamily void Hook\+Tool\+::on\+Selection\+Changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00124 \{ \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_a3ac7ca5acf997a4cf9c488daec5d7dc5}\label{class_hook_tool_a3ac7ca5acf997a4cf9c488daec5d7dc5}} 
\index{HookTool@{HookTool}!pick@{pick}}
\index{pick@{pick}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{pick()}{pick()}}
{\footnotesize\ttfamily bool Hook\+Tool\+::pick (\begin{DoxyParamCaption}\item[{int \&}]{hook\+Id,  }\item[{int \&}]{side,  }\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00373                                                               \{}
\DoxyCodeLine{00374   \mbox{\hyperlink{class_hook_set}{HookSet}} *hookSet = getHookSet();}
\DoxyCodeLine{00375   \textcolor{keywordflow}{if} (!hookSet) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00376 }
\DoxyCodeLine{00377   \mbox{\hyperlink{class_t_frame_id}{TFrameId}} fid    = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{00378   \textcolor{keywordtype}{double} minDist2 = 1e8;}
\DoxyCodeLine{00379   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < hookSet-\/>getHookCount(); i++) \{}
\DoxyCodeLine{00380     \mbox{\hyperlink{class_hook}{Hook}} *hook = hookSet-\/>getHook(i);}
\DoxyCodeLine{00381     \textcolor{keywordflow}{if} (!hook || hook-\/>isEmpty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00382     \mbox{\hyperlink{class_t_point_t}{TPointD}} aPos = hook-\/>getAPos(fid);}
\DoxyCodeLine{00383     \mbox{\hyperlink{class_t_point_t}{TPointD}} bPos = hook-\/>getBPos(fid);}
\DoxyCodeLine{00384     \textcolor{keywordtype}{bool} linked  = aPos == bPos;}
\DoxyCodeLine{00385     \textcolor{keywordflow}{if} (linked) \{}
\DoxyCodeLine{00386       \textcolor{keywordtype}{double} dist2 = tdistance2(pos, aPos);}
\DoxyCodeLine{00387       \textcolor{keywordflow}{if} (dist2 < minDist2) \{}
\DoxyCodeLine{00388         minDist2 = dist2;}
\DoxyCodeLine{00389         hookId   = hook-\/>getId();}
\DoxyCodeLine{00390         side     = 3;}
\DoxyCodeLine{00391       \}}
\DoxyCodeLine{00392     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00393       \textcolor{keywordtype}{double} aDist2 = tdistance2(pos, aPos);}
\DoxyCodeLine{00394       \textcolor{keywordtype}{double} bDist2 = tdistance2(pos, bPos);}
\DoxyCodeLine{00395       \textcolor{keywordtype}{double} dist2  = aDist2;}
\DoxyCodeLine{00396       \textcolor{keywordtype}{int} s         = 1;}
\DoxyCodeLine{00397       \textcolor{keywordflow}{if} (bDist2 < dist2) \{}
\DoxyCodeLine{00398         dist2 = bDist2;}
\DoxyCodeLine{00399         s     = 2;}
\DoxyCodeLine{00400       \}}
\DoxyCodeLine{00401       \textcolor{keywordflow}{if} (dist2 < minDist2) \{}
\DoxyCodeLine{00402         minDist2 = dist2;}
\DoxyCodeLine{00403         hookId   = hook-\/>getId();}
\DoxyCodeLine{00404         side     = s;}
\DoxyCodeLine{00405       \}}
\DoxyCodeLine{00406     \}}
\DoxyCodeLine{00407   \}}
\DoxyCodeLine{00408   \textcolor{keywordtype}{double} pixelSize = getPixelSize();}
\DoxyCodeLine{00409   \textcolor{keywordflow}{return} minDist2 < 100 * pixelSize * pixelSize;}
\DoxyCodeLine{00410 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_ae3810e73cb778b9b4181e5a734d71bd7}\label{class_hook_tool_ae3810e73cb778b9b4181e5a734d71bd7}} 
\index{HookTool@{HookTool}!select@{select}}
\index{select@{select}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{select()}{select()}}
{\footnotesize\ttfamily bool Hook\+Tool\+::select (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_selection}{TSelection}} $\ast$}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00125 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_adc4df6721ca252a58e947f2ecfc67eba}\label{class_hook_tool_adc4df6721ca252a58e947f2ecfc67eba}} 
\index{HookTool@{HookTool}!snap@{snap}}
\index{snap@{snap}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{snap()}{snap()}}
{\footnotesize\ttfamily bool Hook\+Tool\+::snap (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{double \&}]{range2 }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00671                                                 \{}
\DoxyCodeLine{00672   \textcolor{keywordtype}{bool} ret               = \textcolor{keyword}{false};}
\DoxyCodeLine{00673   \mbox{\hyperlink{class_t_point_t}{TPointD}} snappedPos     = pos;}
\DoxyCodeLine{00674   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi       = \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false}));}
\DoxyCodeLine{00675   \mbox{\hyperlink{class_t_stroke}{TStroke}} *selectedShape = 0;}
\DoxyCodeLine{00676   \mbox{\hyperlink{class_t_rect_t}{TRectD}} selectedShapeBBox;}
\DoxyCodeLine{00677   \textcolor{keywordtype}{double} selectedShapeBBoxArea = 0;}
\DoxyCodeLine{00678   \textcolor{keywordtype}{int} i, n;}
\DoxyCodeLine{00679   n = vi ? (int)vi-\/>getStrokeCount() : 0;}
\DoxyCodeLine{00680   \textcolor{keywordflow}{for} (i = 0; i < n; i++) \{}
\DoxyCodeLine{00681     \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke = vi-\/>getStroke(i);}
\DoxyCodeLine{00682     \textcolor{keywordflow}{if} (!stroke-\/>\mbox{\hyperlink{class_t_stroke_a3565d6c34d3eb02fb1a6993ca626425c}{isSelfLoop}}()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00683     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox          = stroke-\/>\mbox{\hyperlink{class_t_stroke_a456bedcae5e8af3a84823cb251584957}{getBBox}}();}
\DoxyCodeLine{00684     \mbox{\hyperlink{class_t_point_t}{TPointD}} strokeCenter = 0.5 * (bbox.getP00() + bbox.getP11());}
\DoxyCodeLine{00685     \textcolor{keywordflow}{if} (bbox.contains(pos)) \{}
\DoxyCodeLine{00686       \textcolor{keywordtype}{double} dist2 = norm2(pos -\/ strokeCenter);}
\DoxyCodeLine{00687       \textcolor{keywordflow}{if} (dist2 < range2) \{}
\DoxyCodeLine{00688         \textcolor{keywordtype}{double} bboxArea = bbox.getLx() * bbox.getLy();}
\DoxyCodeLine{00689         \textcolor{keywordflow}{if} (selectedShape == 0 || selectedShapeBBoxArea > bboxArea) \{}
\DoxyCodeLine{00690           range2                = dist2;}
\DoxyCodeLine{00691           selectedShape         = stroke;}
\DoxyCodeLine{00692           selectedShapeBBox     = bbox;}
\DoxyCodeLine{00693           selectedShapeBBoxArea = bboxArea;}
\DoxyCodeLine{00694         \}}
\DoxyCodeLine{00695       \}}
\DoxyCodeLine{00696     \}}
\DoxyCodeLine{00697   \}}
\DoxyCodeLine{00698 }
\DoxyCodeLine{00699   \textcolor{keywordflow}{if} (selectedShape) \{}
\DoxyCodeLine{00700     m\_shapeBBox = selectedShapeBBox;}
\DoxyCodeLine{00701     snappedPos =}
\DoxyCodeLine{00702         0.5 * (selectedShapeBBox.getP00() + selectedShapeBBox.getP11());}
\DoxyCodeLine{00703     m\_snappedPos    = snappedPos;}
\DoxyCodeLine{00704     m\_snappedReason = \textcolor{stringliteral}{"{}shape center"{}};}
\DoxyCodeLine{00705     ret             = \textcolor{keyword}{true};}
\DoxyCodeLine{00706   \}}
\DoxyCodeLine{00707 }
\DoxyCodeLine{00708   \textcolor{keywordtype}{int} k = -\/1;}
\DoxyCodeLine{00709   \textcolor{keywordflow}{if} (isEditingScene()) \{}
\DoxyCodeLine{00710     \textcolor{keywordflow}{for} (i = 0; i < (int)m\_otherHooks.size(); i++) \{}
\DoxyCodeLine{00711       \textcolor{keywordtype}{double} dist2 = norm2(pos -\/ m\_otherHooks[i].m\_hookPos);}
\DoxyCodeLine{00712       \textcolor{keywordflow}{if} (dist2 < range2) \{}
\DoxyCodeLine{00713         range2 = dist2;}
\DoxyCodeLine{00714         k      = i;}
\DoxyCodeLine{00715       \}}
\DoxyCodeLine{00716     \}}
\DoxyCodeLine{00717   \}}
\DoxyCodeLine{00718   \textcolor{keywordflow}{if} (k >= 0) \{}
\DoxyCodeLine{00719     m\_shapeBBox     = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00720     snappedPos      = m\_otherHooks[k].m\_hookPos;}
\DoxyCodeLine{00721     m\_snappedPos    = snappedPos;}
\DoxyCodeLine{00722     m\_snappedReason = \textcolor{stringliteral}{"{}Col"{}} +}
\DoxyCodeLine{00723                       std::to\_string(m\_otherHooks[k].m\_columnIndex + 1) + \textcolor{stringliteral}{"{}/"{}} +}
\DoxyCodeLine{00724                       std::to\_string(m\_otherHooks[k].m\_hookIndex + 1);}
\DoxyCodeLine{00725     ret = \textcolor{keyword}{true};}
\DoxyCodeLine{00726   \}}
\DoxyCodeLine{00727   pos = snappedPos;}
\DoxyCodeLine{00728   \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{00729 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_hook_tool_ab13e00509be85e6ab57c8acaf51f3606}\label{class_hook_tool_ab13e00509be85e6ab57c8acaf51f3606}} 
\index{HookTool@{HookTool}!updateMatrix@{updateMatrix}}
\index{updateMatrix@{updateMatrix}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{updateMatrix()}{updateMatrix()}}
{\footnotesize\ttfamily void Hook\+Tool\+::update\+Matrix (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Updates the current matrix transformation with the actual column matrix transformation. \begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{class_t_tool_a73c1b7f13eaea33e1d305636f44c4a64}{get\+Current\+Column\+Matrix()}}. 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{class_t_tool_a1a5f380464a6b36947212e2f8d5b314c}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00152                                \{}
\DoxyCodeLine{00153     \mbox{\hyperlink{class_t_tool_a1a5f380464a6b36947212e2f8d5b314c}{TTool::updateMatrix}}();}
\DoxyCodeLine{00154     m\_otherHooks.clear();}
\DoxyCodeLine{00155     getOtherHooks(m\_otherHooks);}
\DoxyCodeLine{00156   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00801}{TTool\+::update\+Matrix()}}.

\mbox{\Hypertarget{class_hook_tool_aae775da44e2e2eaf392eb434b441608f}\label{class_hook_tool_aae775da44e2e2eaf392eb434b441608f}} 
\index{HookTool@{HookTool}!updateTranslation@{updateTranslation}}
\index{updateTranslation@{updateTranslation}!HookTool@{HookTool}}
\doxysubsubsection{\texorpdfstring{updateTranslation()}{updateTranslation()}}
{\footnotesize\ttfamily void Hook\+Tool\+::update\+Translation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00184                                  \{}
\DoxyCodeLine{00185   m\_snappedActive.setQStringName(tr(\textcolor{stringliteral}{"{}Snap"{}}));}
\DoxyCodeLine{00186 \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnztools/hooktool.\+cpp\end{DoxyCompactItemize}
