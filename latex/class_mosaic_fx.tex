\hypertarget{class_mosaic_fx}{}\doxysection{Mosaic\+Fx Class Reference}
\label{class_mosaic_fx}\index{MosaicFx@{MosaicFx}}
Inheritance diagram for Mosaic\+Fx\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=5.000000cm]{class_mosaic_fx}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_mosaic_fx_a4f709e3985adb85e0612c270e044d56a}{do\+Get\+BBox}} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
void \mbox{\hyperlink{class_mosaic_fx_aad60e0d90a897f8fdadced230021e328}{do\+Dry\+Compute}} (\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&ri) override
\item 
void \mbox{\hyperlink{class_mosaic_fx_a32eb4620ef939a43d07d2fe09312b70c}{do\+Compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&ri) override
\item 
int \mbox{\hyperlink{class_mosaic_fx_aa972785e248c0a1a39ddb1a379679050}{get\+Memory\+Requirement}} (const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
bool \mbox{\hyperlink{class_mosaic_fx_a6cc1052f9a7fe595a7b74c0567da4c80}{can\+Handle}} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame) override
\item 
\mbox{\hyperlink{class_t_affine}{TAffine}} \mbox{\hyperlink{class_mosaic_fx_a32bd798e50ce0a0905dc7f76f889ec69}{handled\+Affine}} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame) override
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_mosaic_fx_a65ae0cdce50d7142a7cbe66f4eb45007}\label{class_mosaic_fx_a65ae0cdce50d7142a7cbe66f4eb45007}} 
\index{MosaicFx@{MosaicFx}!MosaicFx@{MosaicFx}}
\index{MosaicFx@{MosaicFx}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{MosaicFx()}{MosaicFx()}}
{\footnotesize\ttfamily Mosaic\+Fx\+::\+Mosaic\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00186       : m\_size(10.0)}
\DoxyCodeLine{00187       , m\_distance(10.0)}
\DoxyCodeLine{00188       , m\_bgcolor(TPixel32::Transparent)}
\DoxyCodeLine{00189       , m\_shape(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_enum_param}{TIntEnumParam}}(0, \textcolor{stringliteral}{"{}Square"{}})) \{}
\DoxyCodeLine{00190     m\_size-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00191     m\_distance-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00192     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}size"{}}, m\_size);}
\DoxyCodeLine{00193     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}distance"{}}, m\_distance);}
\DoxyCodeLine{00194     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}bg\_color"{}}, m\_bgcolor);}
\DoxyCodeLine{00195     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}shape"{}}, m\_shape);}
\DoxyCodeLine{00196     \mbox{\hyperlink{class_t_fx_af0ccf8d65934ed9f7a62d3b45ee5f2b6}{addInputPort}}(\textcolor{stringliteral}{"{}Source"{}}, m\_input);}
\DoxyCodeLine{00197     m\_size-\/>setValueRange(0.0, (std::numeric\_limits<double>::max)());}
\DoxyCodeLine{00198     m\_distance-\/>setValueRange(0.0, (std::numeric\_limits<double>::max)());}
\DoxyCodeLine{00199     m\_shape-\/>addItem(1, \textcolor{stringliteral}{"{}Round"{}});}
\DoxyCodeLine{00200   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_mosaic_fx_a641073807a0ef40adf1989b9890d0c2c}\label{class_mosaic_fx_a641073807a0ef40adf1989b9890d0c2c}} 
\index{MosaicFx@{MosaicFx}!````~MosaicFx@{$\sim$MosaicFx}}
\index{````~MosaicFx@{$\sim$MosaicFx}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{$\sim$MosaicFx()}{~MosaicFx()}}
{\footnotesize\ttfamily Mosaic\+Fx\+::$\sim$\+Mosaic\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00202 \{\};}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_mosaic_fx_a6cc1052f9a7fe595a7b74c0567da4c80}\label{class_mosaic_fx_a6cc1052f9a7fe595a7b74c0567da4c80}} 
\index{MosaicFx@{MosaicFx}!canHandle@{canHandle}}
\index{canHandle@{canHandle}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{canHandle()}{canHandle()}}
{\footnotesize\ttfamily bool Mosaic\+Fx\+::can\+Handle (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00213                                                                      \{}
\DoxyCodeLine{00214     \textcolor{comment}{// We'll return the handled affine only through handledAffine().}}
\DoxyCodeLine{00215     \textcolor{keywordflow}{if} ((m\_size-\/>getValue(frame) + m\_distance-\/>getValue(frame)) == 0.0)}
\DoxyCodeLine{00216       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00217     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00218   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_mosaic_fx_a32eb4620ef939a43d07d2fe09312b70c}\label{class_mosaic_fx_a32eb4620ef939a43d07d2fe09312b70c}} 
\index{MosaicFx@{MosaicFx}!doCompute@{doCompute}}
\index{doCompute@{doCompute}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{doCompute()}{doCompute()}}
{\footnotesize\ttfamily void Mosaic\+Fx\+::do\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{ri }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00352                                                                              \{}
\DoxyCodeLine{00353   \textcolor{keywordflow}{if} (!m\_input.isConnected()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00354 }
\DoxyCodeLine{00355   \textcolor{comment}{// ri's affine is the one that has already been carried due to upstream geom}}
\DoxyCodeLine{00356   \textcolor{comment}{// fxs.}}
\DoxyCodeLine{00357   \textcolor{comment}{// It is handled; so, we can transfer geometrical data directly.}}
\DoxyCodeLine{00358 }
\DoxyCodeLine{00359   \textcolor{keywordtype}{double} scale =}
\DoxyCodeLine{00360       ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}}.a11;  \textcolor{comment}{// Legitimate due to handledAffine's implementation}}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362   \textcolor{keywordtype}{double} stepD =}
\DoxyCodeLine{00363       (m\_size-\/>getValue(frame) + m\_distance-\/>getValue(frame)) * scale;}
\DoxyCodeLine{00364   \textcolor{keywordtype}{int} step = stepD = tround(stepD);}
\DoxyCodeLine{00365   \textcolor{keywordflow}{if} (step <= 0) \{}
\DoxyCodeLine{00366     \textcolor{comment}{// No blur will be done. The underlying fx may pass by.}}
\DoxyCodeLine{00367     m\_input-\/>compute(tile, frame, ri);}
\DoxyCodeLine{00368     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00369   \}}
\DoxyCodeLine{00370 }
\DoxyCodeLine{00371   \textcolor{keywordtype}{double} radius = 0.5 * tcrop(m\_size-\/>getValue(frame) * scale, 0.0, stepD);}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373   TPixel32 bgcolor = m\_bgcolor-\/>getPremultipliedValue(frame);}
\DoxyCodeLine{00374 }
\DoxyCodeLine{00375   \textcolor{comment}{// Build the tile rect.}}
\DoxyCodeLine{00376   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} tileSize(tile.getRaster()-\/>getSize());}
\DoxyCodeLine{00377   \mbox{\hyperlink{class_t_rect_t}{TRectD}} tileRectD(tile.m\_pos, \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}}(tileSize.lx, tileSize.ly));}
\DoxyCodeLine{00378 }
\DoxyCodeLine{00379   \textcolor{comment}{// Observe that TRasterFx's documentation ensures}}
\DoxyCodeLine{00380   \textcolor{comment}{// that passed tile's position is always integer, even if it's double-\/defined.}}
\DoxyCodeLine{00381 }
\DoxyCodeLine{00382   \textcolor{comment}{// Retrieve the input bbox}}
\DoxyCodeLine{00383   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bboxD;}
\DoxyCodeLine{00384   m\_input-\/>getBBox(frame, bboxD, ri);}
\DoxyCodeLine{00385 }
\DoxyCodeLine{00386   \textcolor{comment}{// Build the grid geometry. We require that the source tile is enlarged to}}
\DoxyCodeLine{00387   \textcolor{comment}{// cover}}
\DoxyCodeLine{00388   \textcolor{comment}{// a full grid step.}}
\DoxyCodeLine{00389   \mbox{\hyperlink{class_t_rect_t}{TRectD}} tileBoxD(::gridAlign(tileRectD * bboxD, \mbox{\hyperlink{class_t_point_t}{TPointD}}(), stepD));}
\DoxyCodeLine{00390 }
\DoxyCodeLine{00391   \textcolor{comment}{// Now, we'll extract cell colors by computing tileBox with a res-\/reducing}}
\DoxyCodeLine{00392   \textcolor{comment}{// affine.}}
\DoxyCodeLine{00393   \textcolor{comment}{// So, the source tile will be}}
\DoxyCodeLine{00394   \mbox{\hyperlink{class_t_rect_t}{TRect}} srcRect(tround(tileBoxD.x0 / stepD), tround(tileBoxD.y0 / stepD),}
\DoxyCodeLine{00395                 tround(tileBoxD.x1 / stepD) -\/ 1,}
\DoxyCodeLine{00396                 tround(tileBoxD.y1 / stepD) -\/ 1);}
\DoxyCodeLine{00397 }
\DoxyCodeLine{00398   \textcolor{comment}{// The calculated source rect must be enlarged by a small amount, since the}}
\DoxyCodeLine{00399   \textcolor{comment}{// resample algrotihms add some transparency to the edges.}}
\DoxyCodeLine{00400   \textcolor{keywordtype}{int} enlargement =}
\DoxyCodeLine{00401       (ri.\mbox{\hyperlink{class_t_render_settings_a846348b5544a1df38f85788b1fc624af}{m\_quality}} == \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0a6f0e34f8c8c4543c5da7179c62ab0b88}{TRenderSettings::StandardResampleQuality}})}
\DoxyCodeLine{00402           ? 1}
\DoxyCodeLine{00403           : (ri.\mbox{\hyperlink{class_t_render_settings_a846348b5544a1df38f85788b1fc624af}{m\_quality}} == \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0a6952c5da808e112dd5eaa9eac54a885d}{TRenderSettings::ImprovedResampleQuality}})}
\DoxyCodeLine{00404                 ? 2}
\DoxyCodeLine{00405                 : (ri.\mbox{\hyperlink{class_t_render_settings_a846348b5544a1df38f85788b1fc624af}{m\_quality}} == \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0ae5f4cd9e884f5249d73c37edbc4d3c6d}{TRenderSettings::HighResampleQuality}}) ? 3}
\DoxyCodeLine{00406                                                                          : 0;}
\DoxyCodeLine{00407   assert(enlargement > 0);}
\DoxyCodeLine{00408 }
\DoxyCodeLine{00409   srcRect = srcRect.enlarge(enlargement);}
\DoxyCodeLine{00410 }
\DoxyCodeLine{00411   \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} riLow(ri);}
\DoxyCodeLine{00412   riLow.m\_affine = \mbox{\hyperlink{class_t_scale}{TScale}}(1.0 / stepD) * ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}};}
\DoxyCodeLine{00413 }
\DoxyCodeLine{00414   \textcolor{comment}{// Compute the input tile.}}
\DoxyCodeLine{00415   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} srcRas(tile.getRaster()-\/>create(srcRect.getLx(), srcRect.getLy()));}
\DoxyCodeLine{00416   \mbox{\hyperlink{class_t_tile}{TTile}} inTile(srcRas, \mbox{\hyperlink{class_t_point_t}{TPointD}}(srcRect.x0, srcRect.y0));}
\DoxyCodeLine{00417 }
\DoxyCodeLine{00418   m\_input-\/>compute(inTile, frame, riLow);}
\DoxyCodeLine{00419 }
\DoxyCodeLine{00420   \textcolor{comment}{// Eliminate the enlargement performed above}}
\DoxyCodeLine{00421   \mbox{\hyperlink{class_t_rect_t}{TRect}} r(enlargement, enlargement, srcRas-\/>getLx() -\/ 1 -\/ enlargement,}
\DoxyCodeLine{00422           srcRas-\/>getLy() -\/ 1 -\/ enlargement);}
\DoxyCodeLine{00423   srcRas = srcRas-\/>extract(r);}
\DoxyCodeLine{00424 }
\DoxyCodeLine{00425   \textcolor{comment}{// Now, discriminate the tile's pixel size}}
\DoxyCodeLine{00426   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} srcRas32(srcRas);}
\DoxyCodeLine{00427   \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} srcRas64(srcRas);}
\DoxyCodeLine{00428 }
\DoxyCodeLine{00429   \mbox{\hyperlink{class_t_point_t}{TPoint}} pos(tround(tileBoxD.x0 -\/ tileRectD.x0),}
\DoxyCodeLine{00430              tround(tileBoxD.y0 -\/ tileRectD.y0));}
\DoxyCodeLine{00431   \textcolor{keywordflow}{if} (srcRas32) \{}
\DoxyCodeLine{00432     \textcolor{keyword}{typedef} \mbox{\hyperlink{classmosaic_1_1_cell_builder}{mosaic::CellBuilder<TPixel32>}} cb;}
\DoxyCodeLine{00433     cb *cellsBuilder =}
\DoxyCodeLine{00434         (m\_shape-\/>getValue() == 0)}
\DoxyCodeLine{00435             ? (cb *)\textcolor{keyword}{new} \mbox{\hyperlink{classmosaic_1_1_square_builder}{mosaic::SquareBuilder<TPixel32, TPixelGR8>}}(}
\DoxyCodeLine{00436                   step, step, radius, tile.getRaster()-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}())}
\DoxyCodeLine{00437             : (cb *)new mosaic::CircleBuilder<TPixel32, \mbox{\hyperlink{class_t_pixel_g_r8}{TPixelGR8}}>(}
\DoxyCodeLine{00438                   step, step, radius, tile.getRaster()-\/>getWrap());}
\DoxyCodeLine{00439 }
\DoxyCodeLine{00440     doMosaic<TPixel32>(tile.getRaster(), srcRas32, step, pos, bgcolor,}
\DoxyCodeLine{00441                        *cellsBuilder);}
\DoxyCodeLine{00442 }
\DoxyCodeLine{00443     \textcolor{keyword}{delete} cellsBuilder;}
\DoxyCodeLine{00444   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (srcRas64) \{}
\DoxyCodeLine{00445     \textcolor{keyword}{typedef} \mbox{\hyperlink{classmosaic_1_1_cell_builder}{mosaic::CellBuilder<TPixel64>}} cb;}
\DoxyCodeLine{00446     cb *cellsBuilder =}
\DoxyCodeLine{00447         (m\_shape-\/>getValue() == 0)}
\DoxyCodeLine{00448             ? (cb *)\textcolor{keyword}{new} \mbox{\hyperlink{classmosaic_1_1_square_builder}{mosaic::SquareBuilder<TPixel64, TPixelGR16>}}(}
\DoxyCodeLine{00449                   step, step, radius, tile.getRaster()-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}())}
\DoxyCodeLine{00450             : (cb *)new mosaic::CircleBuilder<TPixel64, \mbox{\hyperlink{class_t_pixel_g_r16}{TPixelGR16}}>(}
\DoxyCodeLine{00451                   step, step, radius, tile.getRaster()-\/>getWrap());}
\DoxyCodeLine{00452 }
\DoxyCodeLine{00453     doMosaic<TPixel64>(tile.getRaster(), srcRas64, step, pos, bgcolor,}
\DoxyCodeLine{00454                        *cellsBuilder);}
\DoxyCodeLine{00455 }
\DoxyCodeLine{00456     \textcolor{keyword}{delete} cellsBuilder;}
\DoxyCodeLine{00457   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00458     assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00459 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_mosaic_fx_aad60e0d90a897f8fdadced230021e328}\label{class_mosaic_fx_aad60e0d90a897f8fdadced230021e328}} 
\index{MosaicFx@{MosaicFx}!doDryCompute@{doDryCompute}}
\index{doDryCompute@{doDryCompute}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{doDryCompute()}{doDryCompute()}}
{\footnotesize\ttfamily void Mosaic\+Fx\+::do\+Dry\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Declares the computation scheme of this fx for rendering optimization purposes. This is an important function of the Toonz rendering API, and should be reimplemented with the necessary care. The Toonz rendering process makes use of this function to enact most of the optimization steps about the fx computation, in particular fx caching. A correct implementation of this method should follow these rules\+:  The invocation of child node computations should be faithfully reproduced.  TRaster\+Fx\+::compute and TRaster\+Fx\+::allocate\+And\+Compute calls have to be translated to TRaster\+Fx\+::dry\+Compute calls.  This fx is intended for precomputation stage, so the hard rendering code should be skipped here. By default, this method raises a dry\+Compute call to each input port in increasing order, using the TRaster\+Fx\+::transform method to identify the tiles to be passed on input precomputation. 

Reimplemented from \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00315                                                        \{}
\DoxyCodeLine{00316   \textcolor{keywordflow}{if} (!m\_input.isConnected()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00317 }
\DoxyCodeLine{00318   \textcolor{keywordtype}{double} scale =}
\DoxyCodeLine{00319       ri.m\_affine.a11;  \textcolor{comment}{// Legitimate due to handledAffine's implementation}}
\DoxyCodeLine{00320 }
\DoxyCodeLine{00321   \textcolor{keywordtype}{double} stepD =}
\DoxyCodeLine{00322       (m\_size-\/>getValue(frame) + m\_distance-\/>getValue(frame)) * scale;}
\DoxyCodeLine{00323   \textcolor{keywordtype}{int} step = tround(stepD);}
\DoxyCodeLine{00324   \textcolor{keywordflow}{if} (step <= 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00325 }
\DoxyCodeLine{00326   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bboxD;}
\DoxyCodeLine{00327   m\_input-\/>getBBox(frame, bboxD, ri);}
\DoxyCodeLine{00328 }
\DoxyCodeLine{00329   \mbox{\hyperlink{class_t_rect_t}{TRectD}} tileBoxD(::gridAlign(rect * bboxD, \mbox{\hyperlink{class_t_point_t}{TPointD}}(), stepD));}
\DoxyCodeLine{00330 }
\DoxyCodeLine{00331   \mbox{\hyperlink{class_t_rect_t}{TRectD}} srcRectD(tround(tileBoxD.x0 / stepD), tround(tileBoxD.y0 / stepD),}
\DoxyCodeLine{00332                   tround(tileBoxD.x1 / stepD), tround(tileBoxD.y1 / stepD));}
\DoxyCodeLine{00333 }
\DoxyCodeLine{00334   \textcolor{keywordtype}{int} enlargement =}
\DoxyCodeLine{00335       (ri.m\_quality == \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0a6f0e34f8c8c4543c5da7179c62ab0b88}{TRenderSettings::StandardResampleQuality}})}
\DoxyCodeLine{00336           ? 1.0}
\DoxyCodeLine{00337           : (ri.m\_quality == \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0a6952c5da808e112dd5eaa9eac54a885d}{TRenderSettings::ImprovedResampleQuality}})}
\DoxyCodeLine{00338                 ? 2.0}
\DoxyCodeLine{00339                 : (ri.m\_quality == \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0ae5f4cd9e884f5249d73c37edbc4d3c6d}{TRenderSettings::HighResampleQuality}}) ? 3.0}
\DoxyCodeLine{00340                                                                          : 0.0;}
\DoxyCodeLine{00341 }
\DoxyCodeLine{00342   srcRectD = srcRectD.enlarge(enlargement);}
\DoxyCodeLine{00343 }
\DoxyCodeLine{00344   \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} riLow(ri);}
\DoxyCodeLine{00345   riLow.m\_affine = \mbox{\hyperlink{class_t_scale}{TScale}}(1.0 / stepD) * ri.m\_affine;}
\DoxyCodeLine{00346 }
\DoxyCodeLine{00347   m\_input-\/>dryCompute(srcRectD, frame, riLow);}
\DoxyCodeLine{00348 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00065}{TRender\+Settings\+::\+High\+Resample\+Quality}}, \mbox{\hyperlink{l00067}{TRender\+Settings\+::\+Improved\+Resample\+Quality}}, \mbox{\hyperlink{l00097}{TRender\+Settings\+::m\+\_\+affine}}, \mbox{\hyperlink{l00129}{TRender\+Settings\+::m\+\_\+quality}}, \mbox{\hyperlink{l00069}{TRender\+Settings\+::\+Standard\+Resample\+Quality}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_mosaic_fx_a4f709e3985adb85e0612c270e044d56a}\label{class_mosaic_fx_a4f709e3985adb85e0612c270e044d56a}} 
\index{MosaicFx@{MosaicFx}!doGetBBox@{doGetBBox}}
\index{doGetBBox@{doGetBBox}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{doGetBBox()}{doGetBBox()}}
{\footnotesize\ttfamily bool Mosaic\+Fx\+::do\+Get\+BBox (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{b\+Box,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00295                                                       \{}
\DoxyCodeLine{00296   \textcolor{comment}{// Remember: info.m\_affine MUST NOT BE CONSIDERED in doGetBBox's}}
\DoxyCodeLine{00297   \textcolor{comment}{// implementation}}
\DoxyCodeLine{00298 }
\DoxyCodeLine{00299   \textcolor{comment}{// Retrieve the input bbox without applied affines.}}
\DoxyCodeLine{00300 }
\DoxyCodeLine{00301   \textcolor{keywordflow}{if} (!(m\_input.getFx() \&\& m\_input-\/>doGetBBox(frame, bBox, info))) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00302 }
\DoxyCodeLine{00303   \textcolor{comment}{// Now, the grid has a given step size; the fx result is almost the same,}}
\DoxyCodeLine{00304   \textcolor{comment}{// except that it must be ceiled to the grid step.}}
\DoxyCodeLine{00305   \textcolor{keywordtype}{double} step = m\_size-\/>getValue(frame) + m\_distance-\/>getValue(frame);}
\DoxyCodeLine{00306   \textcolor{keywordflow}{if} (!step) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00307   bBox = ::gridAlign(bBox, \mbox{\hyperlink{class_t_point_t}{TPointD}}(), step);}
\DoxyCodeLine{00308 }
\DoxyCodeLine{00309   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00310 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_mosaic_fx_aa972785e248c0a1a39ddb1a379679050}\label{class_mosaic_fx_aa972785e248c0a1a39ddb1a379679050}} 
\index{MosaicFx@{MosaicFx}!getMemoryRequirement@{getMemoryRequirement}}
\index{getMemoryRequirement@{getMemoryRequirement}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{getMemoryRequirement()}{getMemoryRequirement()}}
{\footnotesize\ttfamily int Mosaic\+Fx\+::get\+Memory\+Requirement (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Specifies the approximate size (in Mega\+Bytes) of the maximum allocation instance that this fx will need to perform in order to render the passed input. This method should be reimplemented in order to make the Toonz rendering process aware of the use of big raster memory chunks, at least. Observe that the passed tile geometry is implicitly {\itshape  already allocated \texorpdfstring{$<$}{<}\textbackslash{}i\texorpdfstring{$>$}{>} for the fx output. ~\newline
The default implementation returns 0, assuming that the passed implicit memory size is passed below in node computation without further allocation of resources. Fxs can reimplement this to -\/1 to explicitly disable the Toonz\textquotesingle{}s smart memory handling. ~\newline
 ~\newline
\begin{DoxyNote}{Note}
The rendering process ensures that the passed render settings are {\itshape handled} by the fx before this function is invoked -\/ do not waste code for it. 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRaster\+Fx\+::memory\+Size}} and TRaster\+Fx\+::can\+Handle methods. 
\end{DoxySeeAlso}
}

Reimplemented from \mbox{\hyperlink{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00464                                                                 \{}
\DoxyCodeLine{00465   \textcolor{keywordtype}{double} scale = info.m\_affine.a11;}
\DoxyCodeLine{00466   \textcolor{keywordtype}{double} stepD =}
\DoxyCodeLine{00467       (m\_size-\/>getValue(frame) + m\_distance-\/>getValue(frame)) * scale;}
\DoxyCodeLine{00468 }
\DoxyCodeLine{00469   \mbox{\hyperlink{class_t_rect_t}{TRectD}} srcRect(rect.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} / stepD, rect.y0 / stepD, rect.x1 / stepD,}
\DoxyCodeLine{00470                  rect.y1 / stepD);}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRasterFx::memorySize}}(srcRect, info.m\_bpp);}
\DoxyCodeLine{00473 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00560}{TRaster\+Fx\+::memory\+Size()}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_mosaic_fx_a32bd798e50ce0a0905dc7f76f889ec69}\label{class_mosaic_fx_a32bd798e50ce0a0905dc7f76f889ec69}} 
\index{MosaicFx@{MosaicFx}!handledAffine@{handledAffine}}
\index{handledAffine@{handledAffine}!MosaicFx@{MosaicFx}}
\doxysubsubsection{\texorpdfstring{handledAffine()}{handledAffine()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_affine}{TAffine}} Mosaic\+Fx\+::handled\+Affine (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00220                                                                             \{}
\DoxyCodeLine{00221     \textcolor{comment}{// Return the default implementation: only the scale part of the affine}}
\DoxyCodeLine{00222     \textcolor{comment}{// can be handled. Rotations and other distortions would need us have to}}
\DoxyCodeLine{00223     \textcolor{comment}{// implement diagonal grid lines -\/ and we don't want to!}}
\DoxyCodeLine{00224     \textcolor{comment}{// Also, no translational component will be dealt for the same reason.}}
\DoxyCodeLine{00225     \mbox{\hyperlink{class_t_affine}{TAffine}} scalePart(TRasterFx::handledAffine(info, frame));}
\DoxyCodeLine{00226 }
\DoxyCodeLine{00227     \textcolor{comment}{// Plus, we want to avoid dealing with antialiases even on plain orthogonal}}
\DoxyCodeLine{00228     \textcolor{comment}{// lines! So, we ensure that the step size will be flattened to integer.}}
\DoxyCodeLine{00229     \textcolor{keywordtype}{double} stepSize = m\_size-\/>getValue(frame) + m\_distance-\/>getValue(frame);}
\DoxyCodeLine{00230     \textcolor{keywordtype}{double} scale    = tceil(stepSize * scalePart.a11) / stepSize;}
\DoxyCodeLine{00231 }
\DoxyCodeLine{00232     \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_scale}{TScale}}(scale, scale);}
\DoxyCodeLine{00233   \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/mosaicfx.\+cpp\end{DoxyCompactItemize}
