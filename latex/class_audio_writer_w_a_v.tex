\hypertarget{class_audio_writer_w_a_v}{}\doxysection{Audio\+Writer\+WAV Class Reference}
\label{class_audio_writer_w_a_v}\index{AudioWriterWAV@{AudioWriterWAV}}
Inheritance diagram for Audio\+Writer\+WAV\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_audio_writer_w_a_v}
\end{center}
\end{figure}
\doxysubsection*{Signals}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_audio_writer_w_a_v_a69af8f120314432d732b078dff044ccf}\label{class_audio_writer_w_a_v_a69af8f120314432d732b078dff044ccf}} 
void {\bfseries update} (qint64 duration)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_audio_writer_w_a_v_a73b156490275a3526043a7dfa36431c5}{Audio\+Writer\+WAV}} (const QAudio\+Format \&format)
\item 
bool \mbox{\hyperlink{class_audio_writer_w_a_v_afe6c586e6bb069e941eeefc8d908c741}{restart}} (const QAudio\+Format \&format)
\item 
bool \mbox{\hyperlink{class_audio_writer_w_a_v_aa35700ee06588a7e7bd5343fa09f2ac4}{start}} (const QString \&filename, bool use\+Mem)
\item 
bool \mbox{\hyperlink{class_audio_writer_w_a_v_ac88de7b0a9e82657fae7aff6d0ce6635}{stop}} ()
\item 
qint64 \mbox{\hyperlink{class_audio_writer_w_a_v_a9588375e14dbde81ec548b06b3cf5650}{read\+Data}} (char $\ast$data, qint64 maxlen) override
\item 
qint64 \mbox{\hyperlink{class_audio_writer_w_a_v_ad80d76f3ac0605ac3b0e7f9f8e7916a3}{write\+Data}} (const char $\ast$data, qint64 len) override
\item 
qreal \mbox{\hyperlink{class_audio_writer_w_a_v_aa4c3b821d913e46522520725b92cd58b}{level}} () const
\item 
qreal \mbox{\hyperlink{class_audio_writer_w_a_v_a56bb5e2b1c4ec60cdd870e1a540d5507}{peak\+Level}} () const
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_audio_writer_w_a_v_a73b156490275a3526043a7dfa36431c5}\label{class_audio_writer_w_a_v_a73b156490275a3526043a7dfa36431c5}} 
\index{AudioWriterWAV@{AudioWriterWAV}!AudioWriterWAV@{AudioWriterWAV}}
\index{AudioWriterWAV@{AudioWriterWAV}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{AudioWriterWAV()}{AudioWriterWAV()}}
{\footnotesize\ttfamily Audio\+Writer\+WAV\+::\+Audio\+Writer\+WAV (\begin{DoxyParamCaption}\item[{const QAudio\+Format \&}]{format }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00706     : m\_level(0.0)}
\DoxyCodeLine{00707     , m\_peakL(0.0)}
\DoxyCodeLine{00708     , m\_maxAmp(0.0)}
\DoxyCodeLine{00709     , m\_wrRawB(0)}
\DoxyCodeLine{00710     , m\_wavFile(NULL)}
\DoxyCodeLine{00711     , m\_wavBuff(NULL) \{}
\DoxyCodeLine{00712   restart(format);}
\DoxyCodeLine{00713 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_audio_writer_w_a_v_aa4c3b821d913e46522520725b92cd58b}\label{class_audio_writer_w_a_v_aa4c3b821d913e46522520725b92cd58b}} 
\index{AudioWriterWAV@{AudioWriterWAV}!level@{level}}
\index{level@{level}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{level()}{level()}}
{\footnotesize\ttfamily qreal Audio\+Writer\+WAV\+::level (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00106 \{ \textcolor{keywordflow}{return} m\_level; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_audio_writer_w_a_v_a56bb5e2b1c4ec60cdd870e1a540d5507}\label{class_audio_writer_w_a_v_a56bb5e2b1c4ec60cdd870e1a540d5507}} 
\index{AudioWriterWAV@{AudioWriterWAV}!peakLevel@{peakLevel}}
\index{peakLevel@{peakLevel}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{peakLevel()}{peakLevel()}}
{\footnotesize\ttfamily qreal Audio\+Writer\+WAV\+::peak\+Level (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00107 \{ \textcolor{keywordflow}{return} m\_peakL; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_audio_writer_w_a_v_a9588375e14dbde81ec548b06b3cf5650}\label{class_audio_writer_w_a_v_a9588375e14dbde81ec548b06b3cf5650}} 
\index{AudioWriterWAV@{AudioWriterWAV}!readData@{readData}}
\index{readData@{readData}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{readData()}{readData()}}
{\footnotesize\ttfamily qint64 Audio\+Writer\+WAV\+::read\+Data (\begin{DoxyParamCaption}\item[{char $\ast$}]{data,  }\item[{qint64}]{maxlen }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00803                                                          \{}
\DoxyCodeLine{00804   Q\_UNUSED(data)}
\DoxyCodeLine{00805   Q\_UNUSED(maxlen)}
\DoxyCodeLine{00806   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00807 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_audio_writer_w_a_v_afe6c586e6bb069e941eeefc8d908c741}\label{class_audio_writer_w_a_v_afe6c586e6bb069e941eeefc8d908c741}} 
\index{AudioWriterWAV@{AudioWriterWAV}!restart@{restart}}
\index{restart@{restart}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{restart()}{restart()}}
{\footnotesize\ttfamily bool Audio\+Writer\+WAV\+::restart (\begin{DoxyParamCaption}\item[{const QAudio\+Format \&}]{format }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00715                                                        \{}
\DoxyCodeLine{00716   m\_format = format;}
\DoxyCodeLine{00717   \textcolor{keywordflow}{if} (m\_format.sampleSize() == 8) \{}
\DoxyCodeLine{00718     m\_rbytesms = 1000.0 / (m\_format.sampleRate() * m\_format.channelCount());}
\DoxyCodeLine{00719     m\_maxAmp   = 127.0;}
\DoxyCodeLine{00720   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_format.sampleSize() == 16) \{}
\DoxyCodeLine{00721     m\_rbytesms = 500.0 / (m\_format.sampleRate() * m\_format.channelCount());}
\DoxyCodeLine{00722     m\_maxAmp   = 32767.0;}
\DoxyCodeLine{00723   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00724     \textcolor{comment}{// 32-\/bits isn't supported}}
\DoxyCodeLine{00725     m\_rbytesms = 250.0 / (m\_format.sampleRate() * m\_format.channelCount());}
\DoxyCodeLine{00726     m\_maxAmp   = 1.0;}
\DoxyCodeLine{00727   \}}
\DoxyCodeLine{00728   m\_wrRawB = 0;}
\DoxyCodeLine{00729   m\_peakL  = 0.0;}
\DoxyCodeLine{00730   \textcolor{keywordflow}{if} (m\_wavBuff) m\_wavBuff-\/>clear();}
\DoxyCodeLine{00731   \textcolor{keywordflow}{return} this-\/>reset();}
\DoxyCodeLine{00732 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_audio_writer_w_a_v_aa35700ee06588a7e7bd5343fa09f2ac4}\label{class_audio_writer_w_a_v_aa35700ee06588a7e7bd5343fa09f2ac4}} 
\index{AudioWriterWAV@{AudioWriterWAV}!start@{start}}
\index{start@{start}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{start()}{start()}}
{\footnotesize\ttfamily bool Audio\+Writer\+WAV\+::start (\begin{DoxyParamCaption}\item[{const QString \&}]{filename,  }\item[{bool}]{use\+Mem }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00738                                                                \{}
\DoxyCodeLine{00739   open(QIODevice::WriteOnly);}
\DoxyCodeLine{00740   m\_filename = filename;}
\DoxyCodeLine{00741 }
\DoxyCodeLine{00742   \textcolor{keywordflow}{if} (useMem) \{}
\DoxyCodeLine{00743     m\_wavBuff = \textcolor{keyword}{new} QByteArray();}
\DoxyCodeLine{00744   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00745     m\_wavFile = \textcolor{keyword}{new} QFile(m\_filename);}
\DoxyCodeLine{00746     \textcolor{keywordflow}{if} (!m\_wavFile-\/>open(QIODevice::WriteOnly | QIODevice::Truncate))}
\DoxyCodeLine{00747       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00748     m\_wavFile-\/>seek(AWWAV\_HEADER\_SIZE); \textcolor{comment}{// skip header}}
\DoxyCodeLine{00749   \}}
\DoxyCodeLine{00750 }
\DoxyCodeLine{00751   m\_wrRawB = 0;}
\DoxyCodeLine{00752   m\_peakL  = 0.0;}
\DoxyCodeLine{00753   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00754 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_audio_writer_w_a_v_ac88de7b0a9e82657fae7aff6d0ce6635}\label{class_audio_writer_w_a_v_ac88de7b0a9e82657fae7aff6d0ce6635}} 
\index{AudioWriterWAV@{AudioWriterWAV}!stop@{stop}}
\index{stop@{stop}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily bool Audio\+Writer\+WAV\+::stop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00756                           \{}
\DoxyCodeLine{00757   close();}
\DoxyCodeLine{00758 }
\DoxyCodeLine{00759   \textcolor{keywordflow}{if} (m\_wavBuff) \{}
\DoxyCodeLine{00760     \textcolor{comment}{// Using memory}}
\DoxyCodeLine{00761     QFile file;}
\DoxyCodeLine{00762     file.setFileName(m\_filename);}
\DoxyCodeLine{00763     \textcolor{keywordflow}{if} (!file.open(QIODevice::WriteOnly | QIODevice::Truncate)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00764     writeWAVHeader(file);}
\DoxyCodeLine{00765     file.write(m\_wavBuff-\/>constData(), m\_wavBuff-\/>size());}
\DoxyCodeLine{00766     \textcolor{keyword}{delete} m\_wavBuff;}
\DoxyCodeLine{00767     m\_wavBuff = NULL;}
\DoxyCodeLine{00768   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00769     \textcolor{comment}{// Using disk directly}}
\DoxyCodeLine{00770     writeWAVHeader(*m\_wavFile);}
\DoxyCodeLine{00771     m\_wavFile-\/>close();}
\DoxyCodeLine{00772     \textcolor{keyword}{delete} m\_wavFile;}
\DoxyCodeLine{00773     m\_wavFile = NULL;}
\DoxyCodeLine{00774   \}}
\DoxyCodeLine{00775 }
\DoxyCodeLine{00776   m\_wrRawB = 0;}
\DoxyCodeLine{00777   m\_peakL  = 0.0;}
\DoxyCodeLine{00778   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00779 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_audio_writer_w_a_v_ad80d76f3ac0605ac3b0e7f9f8e7916a3}\label{class_audio_writer_w_a_v_ad80d76f3ac0605ac3b0e7f9f8e7916a3}} 
\index{AudioWriterWAV@{AudioWriterWAV}!writeData@{writeData}}
\index{writeData@{writeData}!AudioWriterWAV@{AudioWriterWAV}}
\doxysubsubsection{\texorpdfstring{writeData()}{writeData()}}
{\footnotesize\ttfamily qint64 Audio\+Writer\+WAV\+::write\+Data (\begin{DoxyParamCaption}\item[{const char $\ast$}]{data,  }\item[{qint64}]{len }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00809                                                              \{}
\DoxyCodeLine{00810   \textcolor{keywordtype}{int} tmp, peak = 0.0;}
\DoxyCodeLine{00811 }
\DoxyCodeLine{00812   \textcolor{comment}{// Measure peak}}
\DoxyCodeLine{00813   \textcolor{keywordflow}{if} (m\_format.sampleSize() == 8) \{}
\DoxyCodeLine{00814     \textcolor{keyword}{const} quint8 *sdata = (\textcolor{keyword}{const} quint8 *)data;}
\DoxyCodeLine{00815     \textcolor{keywordtype}{int} slen            = len;}
\DoxyCodeLine{00816     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < slen; ++i) \{}
\DoxyCodeLine{00817       tmp = qAbs<int>(sdata[i] -\/ 128);}
\DoxyCodeLine{00818       \textcolor{keywordflow}{if} (tmp > peak) peak = tmp;}
\DoxyCodeLine{00819     \}}
\DoxyCodeLine{00820   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_format.sampleSize() == 16) \{}
\DoxyCodeLine{00821     \textcolor{keyword}{const} qint16 *sdata = (\textcolor{keyword}{const} qint16 *)data;}
\DoxyCodeLine{00822     \textcolor{keywordtype}{int} slen            = len / 2;}
\DoxyCodeLine{00823     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < slen; ++i) \{}
\DoxyCodeLine{00824       tmp = qAbs<int>(sdata[i]);}
\DoxyCodeLine{00825       \textcolor{keywordflow}{if} (tmp > peak) peak = tmp;}
\DoxyCodeLine{00826     \}}
\DoxyCodeLine{00827   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00828     \textcolor{comment}{// 32-\/bits isn't supported}}
\DoxyCodeLine{00829     peak = -\/1;}
\DoxyCodeLine{00830   \}}
\DoxyCodeLine{00831   m\_level = qreal(peak) / m\_maxAmp;}
\DoxyCodeLine{00832   \textcolor{keywordflow}{if} (m\_level > m\_peakL) m\_peakL = m\_level;}
\DoxyCodeLine{00833 }
\DoxyCodeLine{00834   \textcolor{comment}{// Write to memory or disk}}
\DoxyCodeLine{00835   \textcolor{keywordflow}{if} (m\_wavBuff) \{}
\DoxyCodeLine{00836     m\_wavBuff-\/>append(data, len);}
\DoxyCodeLine{00837   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00838     m\_wavFile-\/>write(data, len);}
\DoxyCodeLine{00839   \}}
\DoxyCodeLine{00840   m\_wrRawB += len;}
\DoxyCodeLine{00841 }
\DoxyCodeLine{00842   \textcolor{comment}{// Emit an update}}
\DoxyCodeLine{00843   emit update(qreal(m\_wrRawB) * m\_rbytesms);}
\DoxyCodeLine{00844   \textcolor{keywordflow}{return} len;}
\DoxyCodeLine{00845 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonz/audiorecordingpopup.\+h\item 
E\+:/opentoonz/toonz/sources/toonz/audiorecordingpopup.\+cpp\end{DoxyCompactItemize}
