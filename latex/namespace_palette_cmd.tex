\hypertarget{namespace_palette_cmd}{}\doxysection{Palette\+Cmd Namespace Reference}
\label{namespace_palette_cmd}\index{PaletteCmd@{PaletteCmd}}


Provides a collection of methods to manage {\bfseries{\mbox{\hyperlink{class_t_palette}{TPalette}}}}.  


\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_palette_cmd_1_1_color_model_loading_configuration}{Color\+Model\+Loading\+Configuration}}
\end{DoxyCompactItemize}
\doxysubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Color\+Model\+Plt\+Behavior} \{ {\bfseries Keep\+Color\+Model\+Plt} = 0
, {\bfseries Replace\+Color\+Model\+Plt}
, {\bfseries Add\+Color\+Model\+Plt}
 \}
\item 
enum {\bfseries Color\+Model\+Raster\+Pick\+Type} \{ {\bfseries Pick\+Every\+Colors} = 0
, {\bfseries Integrate\+Similar\+Colors}
, {\bfseries Pick\+Color\+Chip\+Grid}
 \}
\item 
enum {\bfseries Color\+Chip\+Order} \{ {\bfseries Upper\+Left} = 0
, {\bfseries Lower\+Left}
, {\bfseries Left\+Upper}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_a462cdcbc9c985d216b719a6b8619ab2d}{arrange\+Styles}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, int dst\+Page\+Index, int dst\+Index\+In\+Page, int src\+Page\+Index, const std\+::set$<$ int $>$ \&src\+Indices\+In\+Page)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_a539a7e06a519d1d646027e21ebc95e97}{create\+Style}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, \mbox{\hyperlink{class_t_palette_1_1_page}{TPalette\+::\+Page}} $\ast$page)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_afe6098bed818ae0f12e5ab08c753d294}{add\+Styles}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, int page\+Index, int index\+In\+Page, const std\+::vector$<$ \mbox{\hyperlink{class_t_color_style}{TColor\+Style}} $\ast$ $>$ \&styles)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_afcf0c23a9a8c973314e552053d8f0c81}{erase\+Styles}} (const std\+::set$<$ \mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$ $>$ \&levels, const std\+::vector$<$ int $>$ \&style\+Ids)
\begin{DoxyCompactList}\small\item\em Erases {\itshape image entities} whose style is any of the specified ones. \end{DoxyCompactList}\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_a465dde67c45f742753592b1d5a807d17}{add\+Page}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, std\+::wstring name=L\char`\"{}\char`\"{}, bool with\+Undo=true)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_ac1cf00d41fc881d9468a42df17279ab0}{destroy\+Page}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, int page\+Index)
\item 
DVAPI int \mbox{\hyperlink{namespace_palette_cmd_af8e43b40fc4a702614ce9bf4b9fca29a}{load\+Reference\+Image}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, const \mbox{\hyperlink{struct_palette_cmd_1_1_color_model_loading_configuration}{Color\+Model\+Loading\+Configuration}} \&config, const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&\+\_\+fp, \mbox{\hyperlink{class_toonz_scene}{Toonz\+Scene}} $\ast$scene, const std\+::vector$<$ int $>$ \&frames=std\+::vector$<$ int $>$())
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_a75213302b1303d48304f99ac5ba175dd}{remove\+Reference\+Image}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_ad60c275f8a21dd866a91dd84630e3654}{move\+Palette\+Page}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, int src\+Index, int dst\+Index)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_a402113f4bd931e0144d15a8b0cb002c4}{rename\+Palette\+Page}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, int page\+Index, const std\+::wstring \&new\+Name)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_ab2c398e5ac92c0586bf6af4ab4d918e9}{rename\+Palette\+Style}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, const std\+::wstring \&new\+Name)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_aad4d7fb8494fb9d6240352e78c9c6b9f}{organize\+Palette\+Style}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, int style\+Id, const \mbox{\hyperlink{struct_t_color_style_1_1_picked_position}{TColor\+Style\+::\+Picked\+Position}} \&point)
\item 
DVAPI void \mbox{\hyperlink{namespace_palette_cmd_ade4586ecdaf9fd428f531d9b98012e30}{pick\+Color\+By\+Using\+Picked\+Position}} (\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$palette\+Handle, \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img, int frame)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Provides a collection of methods to manage {\bfseries{\mbox{\hyperlink{class_t_palette}{TPalette}}}}. 

\doxysubsection{Enumeration Type Documentation}
\mbox{\Hypertarget{namespace_palette_cmd_afa62297dcc18e3198376d2e8e6fc976b}\label{namespace_palette_cmd_afa62297dcc18e3198376d2e8e6fc976b}} 
\index{PaletteCmd@{PaletteCmd}!ColorChipOrder@{ColorChipOrder}}
\index{ColorChipOrder@{ColorChipOrder}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{ColorChipOrder}{ColorChipOrder}}
{\footnotesize\ttfamily enum Palette\+Cmd\+::\+Color\+Chip\+Order}


\begin{DoxyCode}{0}
\DoxyCodeLine{00081 \{ UpperLeft = 0, LowerLeft, LeftUpper \};}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_a19a0dfe694ea14e38e5b63e1f8f3429b}\label{namespace_palette_cmd_a19a0dfe694ea14e38e5b63e1f8f3429b}} 
\index{PaletteCmd@{PaletteCmd}!ColorModelPltBehavior@{ColorModelPltBehavior}}
\index{ColorModelPltBehavior@{ColorModelPltBehavior}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{ColorModelPltBehavior}{ColorModelPltBehavior}}
{\footnotesize\ttfamily enum Palette\+Cmd\+::\+Color\+Model\+Plt\+Behavior}


\begin{DoxyCode}{0}
\DoxyCodeLine{00069                            \{}
\DoxyCodeLine{00070   KeepColorModelPlt = 0,}
\DoxyCodeLine{00071   ReplaceColorModelPlt,}
\DoxyCodeLine{00072   AddColorModelPlt}
\DoxyCodeLine{00073 \};}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_a125b7cbde6109a1b84622fbd78efa610}\label{namespace_palette_cmd_a125b7cbde6109a1b84622fbd78efa610}} 
\index{PaletteCmd@{PaletteCmd}!ColorModelRasterPickType@{ColorModelRasterPickType}}
\index{ColorModelRasterPickType@{ColorModelRasterPickType}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{ColorModelRasterPickType}{ColorModelRasterPickType}}
{\footnotesize\ttfamily enum Palette\+Cmd\+::\+Color\+Model\+Raster\+Pick\+Type}


\begin{DoxyCode}{0}
\DoxyCodeLine{00075                               \{}
\DoxyCodeLine{00076   PickEveryColors = 0,}
\DoxyCodeLine{00077   IntegrateSimilarColors,}
\DoxyCodeLine{00078   PickColorChipGrid}
\DoxyCodeLine{00079 \};}

\end{DoxyCode}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespace_palette_cmd_a465dde67c45f742753592b1d5a807d17}\label{namespace_palette_cmd_a465dde67c45f742753592b1d5a807d17}} 
\index{PaletteCmd@{PaletteCmd}!addPage@{addPage}}
\index{addPage@{addPage}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{addPage()}{addPage()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::add\+Page (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{std\+::wstring}]{name = {\ttfamily L\char`\"{}\char`\"{}},  }\item[{bool}]{with\+Undo = {\ttfamily true} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00683                                         \{}
\DoxyCodeLine{00684   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{00685   \textcolor{keywordflow}{if} (name == L\textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00686     name = L\textcolor{stringliteral}{"{}page "{}} + std::to\_wstring(palette-\/>getPageCount() + 1);}
\DoxyCodeLine{00687   \mbox{\hyperlink{class_t_palette_1_1_page}{TPalette::Page}} *page = palette-\/>addPage(name);}
\DoxyCodeLine{00688 }
\DoxyCodeLine{00689   palette-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{00690 }
\DoxyCodeLine{00691   paletteHandle-\/>notifyPaletteChanged();}
\DoxyCodeLine{00692   \textcolor{keywordflow}{if} (withUndo)}
\DoxyCodeLine{00693     TUndoManager::manager()-\/>add(}
\DoxyCodeLine{00694         \textcolor{keyword}{new} AddPageUndo(paletteHandle, page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a0e09146e776286b87fc90283c561d19d}{getIndex}}(), name));}
\DoxyCodeLine{00695 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_afe6098bed818ae0f12e5ab08c753d294}\label{namespace_palette_cmd_afe6098bed818ae0f12e5ab08c753d294}} 
\index{PaletteCmd@{PaletteCmd}!addStyles@{addStyles}}
\index{addStyles@{addStyles}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{addStyles()}{addStyles()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::add\+Styles (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{int}]{page\+Index,  }\item[{int}]{index\+In\+Page,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{class_t_color_style}{TColor\+Style}} $\ast$ $>$ \&}]{styles }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00465                                                                    \{}
\DoxyCodeLine{00466   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{00467   assert(0 <= pageIndex \&\& pageIndex < palette-\/>getPageCount());}
\DoxyCodeLine{00468   \mbox{\hyperlink{class_t_palette_1_1_page}{TPalette::Page}} *page = palette-\/>getPage(pageIndex);}
\DoxyCodeLine{00469   assert(page);}
\DoxyCodeLine{00470   assert(0 <= indexInPage \&\& indexInPage <= page-\/>getStyleCount());}
\DoxyCodeLine{00471   \textcolor{keywordtype}{int} count = styles.size();}
\DoxyCodeLine{00472   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; i++) \{}
\DoxyCodeLine{00473     page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_aba6f78043e4370496a1bb7b7be5bd792}{insertStyle}}(indexInPage + i, styles[i]-\/>clone());}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475     \textcolor{comment}{/*-\/-\/ StudioPaletteから持ち込んだ場合、その元の名前をoriginalNameに入れる}}
\DoxyCodeLine{00476 \textcolor{comment}{     * -\/-\/*/}}
\DoxyCodeLine{00477     \textcolor{keywordflow}{if} (styles[i]-\/>getGlobalName() != L\textcolor{stringliteral}{"{}"{}}) \{}
\DoxyCodeLine{00478       \textcolor{comment}{/*-\/-\/}}
\DoxyCodeLine{00479 \textcolor{comment}{       * もし元のStyleにOriginalNameが無ければ（コピー元がStudioPaletteからということ）-\/-\/*/}}
\DoxyCodeLine{00480       \textcolor{keywordflow}{if} (styles[i]-\/>getOriginalName() == L\textcolor{stringliteral}{"{}"{}}) \{}
\DoxyCodeLine{00481         \textcolor{comment}{/*-\/-\/ 元のStyleの名前をペースト先のOriginalNameに入れる -\/-\/*/}}
\DoxyCodeLine{00482         page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_abe9e434ff44cbe1fde53f32aa7978f9c}{getStyle}}(indexInPage + i)-\/>\mbox{\hyperlink{class_t_color_style_a22061dd49a8282e8af93840441998532}{setOriginalName}}(styles[i]-\/>getName());}
\DoxyCodeLine{00483       \}}
\DoxyCodeLine{00484     \}}
\DoxyCodeLine{00485     \textcolor{comment}{/*-\/-\/}}
\DoxyCodeLine{00486 \textcolor{comment}{     * それ以外の場合は、clone()でそれぞれの名前をコピーしているので、そのままでOK}}
\DoxyCodeLine{00487 \textcolor{comment}{     * -\/-\/*/}}
\DoxyCodeLine{00488   \}}
\DoxyCodeLine{00489   TUndoManager::manager()-\/>add(}
\DoxyCodeLine{00490       \textcolor{keyword}{new} AddStylesUndo(palette, pageIndex, indexInPage, count, paletteHandle));}
\DoxyCodeLine{00491   palette-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{00492 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_a462cdcbc9c985d216b719a6b8619ab2d}\label{namespace_palette_cmd_a462cdcbc9c985d216b719a6b8619ab2d}} 
\index{PaletteCmd@{PaletteCmd}!arrangeStyles@{arrangeStyles}}
\index{arrangeStyles@{arrangeStyles}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{arrangeStyles()}{arrangeStyles()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::arrange\+Styles (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{int}]{dst\+Page\+Index,  }\item[{int}]{dst\+Index\+In\+Page,  }\item[{int}]{src\+Page\+Index,  }\item[{const std\+::set$<$ int $>$ \&}]{src\+Indices\+In\+Page }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00263                                                                     \{}
\DoxyCodeLine{00264   \textcolor{keywordflow}{if} (dstPageIndex == srcPageIndex \&\&}
\DoxyCodeLine{00265       dstIndexInPage == *srcIndicesInPage.begin())}
\DoxyCodeLine{00266     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00267   ArrangeStylesUndo *undo =}
\DoxyCodeLine{00268       \textcolor{keyword}{new} ArrangeStylesUndo(paletteHandle, dstPageIndex, dstIndexInPage,}
\DoxyCodeLine{00269                             srcPageIndex, srcIndicesInPage);}
\DoxyCodeLine{00270   undo-\/>redo();}
\DoxyCodeLine{00271   TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{00272 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_a539a7e06a519d1d646027e21ebc95e97}\label{namespace_palette_cmd_a539a7e06a519d1d646027e21ebc95e97}} 
\index{PaletteCmd@{PaletteCmd}!createStyle@{createStyle}}
\index{createStyle@{createStyle}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{createStyle()}{createStyle()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::create\+Style (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{\mbox{\hyperlink{class_t_palette_1_1_page}{TPalette\+::\+Page}} $\ast$}]{page }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00334                                                  \{}
\DoxyCodeLine{00335   \textcolor{keywordtype}{int} index         = paletteHandle-\/>getStyleIndex();}
\DoxyCodeLine{00336   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{00337   \textcolor{keywordtype}{int} newIndex;}
\DoxyCodeLine{00338 }
\DoxyCodeLine{00339   \textcolor{keywordtype}{int} UnpagedId = palette-\/>getFirstUnpagedStyle();}
\DoxyCodeLine{00340   \textcolor{keywordflow}{if} (UnpagedId != -\/1 \&\& !palette-\/>isCleanupPalette()) \{}
\DoxyCodeLine{00341     \textcolor{keywordflow}{if} (index == -\/1)}
\DoxyCodeLine{00342       palette-\/>getStyle(UnpagedId)-\/>setMainColor(TPixel32::Black);}
\DoxyCodeLine{00343     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00344       palette-\/>getStyle(UnpagedId)-\/>setMainColor(}
\DoxyCodeLine{00345           palette-\/>getStyle(index)-\/>getMainColor());}
\DoxyCodeLine{00346     newIndex = page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a6836aae497ab21f4ec1af5f026c68d5f}{addStyle}}(UnpagedId);}
\DoxyCodeLine{00347   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!palette-\/>isCleanupPalette()) \{}
\DoxyCodeLine{00348     \textcolor{keywordflow}{if} (index == -\/1)}
\DoxyCodeLine{00349       newIndex = page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a6836aae497ab21f4ec1af5f026c68d5f}{addStyle}}(TPixel32::Black);}
\DoxyCodeLine{00350     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00351       \mbox{\hyperlink{class_t_color_style}{TColorStyle}} *style          = palette-\/>getStyle(index);}
\DoxyCodeLine{00352       \mbox{\hyperlink{class_t_cleanup_style}{TCleanupStyle}} *cleanupStyle = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_cleanup_style}{TCleanupStyle}} *\textcolor{keyword}{>}(style);}
\DoxyCodeLine{00353       \textcolor{keywordflow}{if} ((cleanupStyle || index == 0) \&\& palette-\/>isCleanupPalette()) \{}
\DoxyCodeLine{00354         \mbox{\hyperlink{class_t_color_cleanup_style}{TColorCleanupStyle}} *newCleanupStyle = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_color_cleanup_style}{TColorCleanupStyle}}();}
\DoxyCodeLine{00355         \textcolor{keywordflow}{if} (cleanupStyle) \{}
\DoxyCodeLine{00356           \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00357           \textcolor{keywordflow}{for} (i = 0; i < cleanupStyle-\/>\mbox{\hyperlink{class_t_cleanup_style_a3c591761c3880d68dd18e66453f58ddd}{getParamCount}}(); i++)}
\DoxyCodeLine{00358             newCleanupStyle-\/>\mbox{\hyperlink{class_t_cleanup_style_aa74f6eb493135c2404f4a13d5548f41a}{setColorParamValue}}(}
\DoxyCodeLine{00359                 i, cleanupStyle-\/>\mbox{\hyperlink{class_t_cleanup_style_a90f8b64ceb5042751d4324c9ec2c6837}{getColorParamValue}}(i));}
\DoxyCodeLine{00360         \}}
\DoxyCodeLine{00361         newIndex = page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a6836aae497ab21f4ec1af5f026c68d5f}{addStyle}}(newCleanupStyle);}
\DoxyCodeLine{00362       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00363         newIndex = page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a6836aae497ab21f4ec1af5f026c68d5f}{addStyle}}(style-\/>\mbox{\hyperlink{class_t_color_style_abd78dd4e3ff3e2e78b647195f7622aa7}{getMainColor}}());}
\DoxyCodeLine{00364     \}}
\DoxyCodeLine{00365   \} \textcolor{keywordflow}{else} \textcolor{comment}{/*-\/ CleanupPaletteの場合 -\/*/}}
\DoxyCodeLine{00366   \{}
\DoxyCodeLine{00367     newIndex = page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a6836aae497ab21f4ec1af5f026c68d5f}{addStyle}}(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_color_cleanup_style}{TColorCleanupStyle}}(TPixel32::Red));}
\DoxyCodeLine{00368   \}}
\DoxyCodeLine{00369   \textcolor{keywordtype}{int} newStyleId = page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a3d6eed995ee8b1c22d50a73911a45786}{getStyleId}}(newIndex);}
\DoxyCodeLine{00370   \textcolor{comment}{/*-\/  StudioPalette上でStyleを追加した場合、GlobalNameを自動で割り振る -\/*/}}
\DoxyCodeLine{00371   \textcolor{keywordflow}{if} (palette-\/>getGlobalName() != L\textcolor{stringliteral}{"{}"{}}) \{}
\DoxyCodeLine{00372     \mbox{\hyperlink{class_t_color_style}{TColorStyle}} *cs = palette-\/>getStyle(newStyleId);}
\DoxyCodeLine{00373     std::wstring gname =}
\DoxyCodeLine{00374         L\textcolor{stringliteral}{"{}-\/"{}} + palette-\/>getGlobalName() + L\textcolor{stringliteral}{"{}-\/"{}} + std::to\_wstring(newStyleId);}
\DoxyCodeLine{00375     cs-\/>\mbox{\hyperlink{class_t_color_style_af6a3579e3785b9addcf434574bc89367}{setGlobalName}}(gname);}
\DoxyCodeLine{00376   \}}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378   page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_abe9e434ff44cbe1fde53f32aa7978f9c}{getStyle}}(newIndex)-\/>\mbox{\hyperlink{class_t_color_style_aeb25e0ae1708d473bd551b0d0c9bf4a9}{setName}}(}
\DoxyCodeLine{00379       QString(\textcolor{stringliteral}{"{}color\_\%1"{}}).arg(newStyleId).toStdWString());}
\DoxyCodeLine{00380   paletteHandle-\/>setStyleIndex(newStyleId);}
\DoxyCodeLine{00381 }
\DoxyCodeLine{00382   palette-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{00383   paletteHandle-\/>notifyPaletteChanged();}
\DoxyCodeLine{00384   TUndoManager::manager()-\/>add(\textcolor{keyword}{new} CreateStyleUndo(}
\DoxyCodeLine{00385       paletteHandle, page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a0e09146e776286b87fc90283c561d19d}{getIndex}}(), page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a3d6eed995ee8b1c22d50a73911a45786}{getStyleId}}(newIndex)));}
\DoxyCodeLine{00386 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_ac1cf00d41fc881d9468a42df17279ab0}\label{namespace_palette_cmd_ac1cf00d41fc881d9468a42df17279ab0}} 
\index{PaletteCmd@{PaletteCmd}!destroyPage@{destroyPage}}
\index{destroyPage@{destroyPage}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{destroyPage()}{destroyPage()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::destroy\+Page (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{int}]{page\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00747                                                                          \{}
\DoxyCodeLine{00748   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{00749   assert(0 <= pageIndex \&\& pageIndex < palette-\/>getPageCount());}
\DoxyCodeLine{00750 }
\DoxyCodeLine{00751   TUndoManager::manager()-\/>add(\textcolor{keyword}{new} DestroyPageUndo(paletteHandle, pageIndex));}
\DoxyCodeLine{00752   palette-\/>erasePage(pageIndex);}
\DoxyCodeLine{00753 }
\DoxyCodeLine{00754   palette-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{00755 }
\DoxyCodeLine{00756   paletteHandle-\/>notifyPaletteChanged();}
\DoxyCodeLine{00757 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_afcf0c23a9a8c973314e552053d8f0c81}\label{namespace_palette_cmd_afcf0c23a9a8c973314e552053d8f0c81}} 
\index{PaletteCmd@{PaletteCmd}!eraseStyles@{eraseStyles}}
\index{eraseStyles@{eraseStyles}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{eraseStyles()}{eraseStyles()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::erase\+Styles (\begin{DoxyParamCaption}\item[{const std\+::set$<$ \mbox{\hyperlink{class_t_xsh_simple_level}{TXsh\+Simple\+Level}} $\ast$ $>$ \&}]{levels,  }\item[{const std\+::vector$<$ int $>$ \&}]{style\+Ids }\end{DoxyParamCaption})}



Erases {\itshape image entities} whose style is any of the specified ones. 

This function applies to {\itshape all objects contained in the images of a level}; for example, all strokes and regions of the {\ttfamily \mbox{\hyperlink{class_t_vector_image}{TVector\+Image}}}s in a level.

\begin{DoxyRemark}{Remarks}
This command does not provide an undo for level types whose images are raster-\/based (specifically, fullcolor and TLV images), due to memory occupation concerns. 
\end{DoxyRemark}

\begin{DoxyCode}{0}
\DoxyCodeLine{00523                                                              \{}
\DoxyCodeLine{00524   \textcolor{keyword}{typedef} std::pair<const TXshSimpleLevelP, std::vector<TVectorImageP>>}
\DoxyCodeLine{00525       LevelImages;}
\DoxyCodeLine{00526 }
\DoxyCodeLine{00527   \textcolor{keyword}{struct }Undo final : \textcolor{keyword}{public} \mbox{\hyperlink{class_t_undo}{TUndo}} \{}
\DoxyCodeLine{00528     std::set<TXshSimpleLevel *> m\_levels;}
\DoxyCodeLine{00529     std::vector<int> m\_styleIds;}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531     \textcolor{keyword}{mutable} std::map<TXshSimpleLevelP, std::vector<TVectorImageP>>}
\DoxyCodeLine{00532         m\_imagesByLevel;}
\DoxyCodeLine{00533 }
\DoxyCodeLine{00534   \textcolor{keyword}{public}:}
\DoxyCodeLine{00535     Undo(\textcolor{keyword}{const} std::set<TXshSimpleLevel *> \&levels,}
\DoxyCodeLine{00536          \textcolor{keyword}{const} std::vector<int> \&styleIds)}
\DoxyCodeLine{00537         : m\_levels(levels), m\_styleIds(styleIds) \{}
\DoxyCodeLine{00538       tcg::substitute(m\_imagesByLevel,}
\DoxyCodeLine{00539                       levels | boost::adaptors::filtered(isVector) |}
\DoxyCodeLine{00540                           boost::adaptors::transformed(toEmptyLevelImages));}
\DoxyCodeLine{00541     \}}
\DoxyCodeLine{00542 }
\DoxyCodeLine{00543     \textcolor{keywordtype}{bool} isValid()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} !m\_levels.empty(); \}}
\DoxyCodeLine{00544 }
\DoxyCodeLine{00545     \textcolor{keywordtype}{void} redo()\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{00546       std::for\_each(m\_imagesByLevel.begin(), m\_imagesByLevel.end(),}
\DoxyCodeLine{00547                     cloneImages);}
\DoxyCodeLine{00548       eraseStylesInLevels(m\_levels, m\_styleIds);}
\DoxyCodeLine{00549     \}}
\DoxyCodeLine{00550 }
\DoxyCodeLine{00551     \textcolor{keywordtype}{void} undo()\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{00552       std::for\_each(m\_imagesByLevel.begin(), m\_imagesByLevel.end(),}
\DoxyCodeLine{00553                     restoreImages);}
\DoxyCodeLine{00554     \}}
\DoxyCodeLine{00555 }
\DoxyCodeLine{00556     \textcolor{keywordtype}{int} getSize()\textcolor{keyword}{ const override }\{ \textcolor{keywordflow}{return} 10 << 20; \}  \textcolor{comment}{// At max 10 per 100 MB}}
\DoxyCodeLine{00557 }
\DoxyCodeLine{00558   \textcolor{keyword}{private}:}
\DoxyCodeLine{00559     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isVector(\textcolor{keyword}{const} \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *level) \{}
\DoxyCodeLine{00560       \textcolor{keywordflow}{return} (assert(level), level-\/>\mbox{\hyperlink{class_t_xsh_level_a1a147f1e970a62120c0bbaf0020a8932}{getType}}() == PLI\_XSHLEVEL);}
\DoxyCodeLine{00561     \}}
\DoxyCodeLine{00562 }
\DoxyCodeLine{00563     \textcolor{keyword}{static} LevelImages toEmptyLevelImages(\mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *level) \{}
\DoxyCodeLine{00564       \textcolor{keywordflow}{return} LevelImages(level, std::vector<TVectorImageP>());}
\DoxyCodeLine{00565     \}}
\DoxyCodeLine{00566 }
\DoxyCodeLine{00567     \textcolor{keyword}{static} \textcolor{keywordtype}{void} copyStrokeIds(\textcolor{keyword}{const} \mbox{\hyperlink{class_t_vector_image}{TVectorImage}} \&src, \mbox{\hyperlink{class_t_vector_image}{TVectorImage}} \&dst) \{}
\DoxyCodeLine{00568       UINT s, sCount = src.\mbox{\hyperlink{class_t_vector_image_add44e109ce62ba075799c0602724a841}{getStrokeCount}}();}
\DoxyCodeLine{00569       \textcolor{keywordflow}{for} (s = 0; s != sCount; ++s)}
\DoxyCodeLine{00570         dst.\mbox{\hyperlink{class_t_vector_image_a1aa2f3ab6c30a6f8a64b2cb35072ffeb}{getStroke}}(s)-\/>setId(src.\mbox{\hyperlink{class_t_vector_image_a1aa2f3ab6c30a6f8a64b2cb35072ffeb}{getStroke}}(s)-\/>getId());}
\DoxyCodeLine{00571     \}}
\DoxyCodeLine{00572 }
\DoxyCodeLine{00573     \textcolor{keyword}{static} \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} cloneImage(\textcolor{keyword}{const} \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} \&level, \textcolor{keywordtype}{int} f) \{}
\DoxyCodeLine{00574       \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} src = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}}\textcolor{keyword}{>}(}
\DoxyCodeLine{00575           level.getFrame(level.\mbox{\hyperlink{class_t_xsh_simple_level_abb72e2ab0c1baeda0a8af3146003181d}{getFrameId}}(f), \textcolor{keyword}{false}));}
\DoxyCodeLine{00576       \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} dst = src-\/>clone();}
\DoxyCodeLine{00577 }
\DoxyCodeLine{00578       copyStrokeIds(*src, *dst);}
\DoxyCodeLine{00579       \textcolor{keywordflow}{return} dst;}
\DoxyCodeLine{00580     \}}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582     \textcolor{keyword}{static} \textcolor{keywordtype}{void} cloneImages(LevelImages \&levelImages) \{}
\DoxyCodeLine{00583       \mbox{\hyperlink{range__utility_8h_a6e998835f065bb4b10d59722f3ec9019}{tcg::substitute}}(}
\DoxyCodeLine{00584           levelImages.second,}
\DoxyCodeLine{00585           boost::counting\_range(0, levelImages.first-\/>getFrameCount()) |}
\DoxyCodeLine{00586               boost::adaptors::transformed(boost::bind(}
\DoxyCodeLine{00587                   cloneImage, boost::cref(*levelImages.first), \_1)));}
\DoxyCodeLine{00588     \}}
\DoxyCodeLine{00589 }
\DoxyCodeLine{00590     \textcolor{keyword}{static} \textcolor{keywordtype}{void} restoreImage(\textcolor{keyword}{const} \mbox{\hyperlink{class_t_smart_pointer_t}{TXshSimpleLevelP}} \&level, \textcolor{keywordtype}{int} f,}
\DoxyCodeLine{00591                              \textcolor{keyword}{const} \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} \&vi) \{}
\DoxyCodeLine{00592       level-\/>setFrame(level-\/>\mbox{\hyperlink{class_t_xsh_simple_level_abb72e2ab0c1baeda0a8af3146003181d}{getFrameId}}(f), vi.getPointer());}
\DoxyCodeLine{00593     \}}
\DoxyCodeLine{00594 }
\DoxyCodeLine{00595     \textcolor{keyword}{static} \textcolor{keywordtype}{void} restoreImages(LevelImages \&levelImages) \{}
\DoxyCodeLine{00596       \textcolor{keywordtype}{int} f, fCount = std::min(levelImages.first-\/>getFrameCount(),}
\DoxyCodeLine{00597                                \textcolor{keywordtype}{int}(levelImages.second.size()));}
\DoxyCodeLine{00598 }
\DoxyCodeLine{00599       \textcolor{keywordflow}{for} (f = 0; f != fCount; ++f)}
\DoxyCodeLine{00600         restoreImage(levelImages.first, f, levelImages.second[f]);}
\DoxyCodeLine{00601     \}}
\DoxyCodeLine{00602 }
\DoxyCodeLine{00603   \};  \textcolor{comment}{// Undo}}
\DoxyCodeLine{00604 }
\DoxyCodeLine{00605   \textcolor{keywordflow}{if} (levels.empty() || styleIds.empty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00606 }
\DoxyCodeLine{00607   std::unique\_ptr<TUndo> undo(\textcolor{keyword}{new} Undo(levels, styleIds));}
\DoxyCodeLine{00608   \textcolor{keywordflow}{if} (\textcolor{keyword}{static\_cast<}Undo \&\textcolor{keyword}{>}(*undo).isValid()) \{}
\DoxyCodeLine{00609     undo-\/>redo();}
\DoxyCodeLine{00610     TUndoManager::manager()-\/>add(undo.release());}
\DoxyCodeLine{00611   \}}
\DoxyCodeLine{00612 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00460}{TXsh\+Simple\+Level\+::get\+Frame\+Id()}}, \mbox{\hyperlink{l00524}{TVector\+Image\+::get\+Stroke()}}, \mbox{\hyperlink{l00388}{TVector\+Image\+::get\+Stroke\+Count()}}, and \mbox{\hyperlink{l00081}{TXsh\+Level\+::get\+Type()}}.

\mbox{\Hypertarget{namespace_palette_cmd_af8e43b40fc4a702614ce9bf4b9fca29a}\label{namespace_palette_cmd_af8e43b40fc4a702614ce9bf4b9fca29a}} 
\index{PaletteCmd@{PaletteCmd}!loadReferenceImage@{loadReferenceImage}}
\index{loadReferenceImage@{loadReferenceImage}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{loadReferenceImage()}{loadReferenceImage()}}
{\footnotesize\ttfamily int Palette\+Cmd\+::load\+Reference\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{const \mbox{\hyperlink{struct_palette_cmd_1_1_color_model_loading_configuration}{Color\+Model\+Loading\+Configuration}} \&}]{config,  }\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{\+\_\+fp,  }\item[{\mbox{\hyperlink{class_toonz_scene}{Toonz\+Scene}} $\ast$}]{scene,  }\item[{const std\+::vector$<$ int $>$ \&}]{frames = {\ttfamily std\+:\+:vector$<$int$>$()} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00990                                                                  \{}
\DoxyCodeLine{00991   \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} levelPalette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{00992   \textcolor{keywordflow}{if} (!levelPalette) \textcolor{keywordflow}{return} 2;}
\DoxyCodeLine{00993 }
\DoxyCodeLine{00994   \textcolor{keywordtype}{int} ret =}
\DoxyCodeLine{00995       loadRefImage(paletteHandle, config, levelPalette, \_fp, scene, frames);}
\DoxyCodeLine{00996   \textcolor{keywordflow}{if} (ret != 0) \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{00997 }
\DoxyCodeLine{00998   \textcolor{comment}{// when choosing replace(Keep the destination palette), dirty flag is}}
\DoxyCodeLine{00999   \textcolor{comment}{// unchanged}}
\DoxyCodeLine{01000   \textcolor{keywordflow}{if} (config.behavior != ReplaceColorModelPlt) \{}
\DoxyCodeLine{01001     levelPalette-\/>\mbox{\hyperlink{class_t_palette_a382fa102abee4e69e386cb5a4d8d5184}{setDirtyFlag}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01002     paletteHandle-\/>notifyPaletteDirtyFlagChanged();}
\DoxyCodeLine{01003   \}}
\DoxyCodeLine{01004 }
\DoxyCodeLine{01005   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{01006 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_ad60c275f8a21dd866a91dd84630e3654}\label{namespace_palette_cmd_ad60c275f8a21dd866a91dd84630e3654}} 
\index{PaletteCmd@{PaletteCmd}!movePalettePage@{movePalettePage}}
\index{movePalettePage@{movePalettePage}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{movePalettePage()}{movePalettePage()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::move\+Palette\+Page (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{int}]{src\+Index,  }\item[{int}]{dst\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01064                                                \{}
\DoxyCodeLine{01065   \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{01066   palette-\/>movePage(palette-\/>getPage(srcIndex), dstIndex);}
\DoxyCodeLine{01067   TUndoManager::manager()-\/>add(}
\DoxyCodeLine{01068       \textcolor{keyword}{new} MovePageUndo(paletteHandle, srcIndex, dstIndex));}
\DoxyCodeLine{01069   paletteHandle-\/>notifyPaletteChanged();}
\DoxyCodeLine{01070 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_aad4d7fb8494fb9d6240352e78c9c6b9f}\label{namespace_palette_cmd_aad4d7fb8494fb9d6240352e78c9c6b9f}} 
\index{PaletteCmd@{PaletteCmd}!organizePaletteStyle@{organizePaletteStyle}}
\index{organizePaletteStyle@{organizePaletteStyle}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{organizePaletteStyle()}{organizePaletteStyle()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::organize\+Palette\+Style (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{int}]{style\+Id,  }\item[{const \mbox{\hyperlink{struct_t_color_style_1_1_picked_position}{TColor\+Style\+::\+Picked\+Position}} \&}]{point }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01249                                             \{}
\DoxyCodeLine{01250   \textcolor{keywordflow}{if} (!paletteHandle) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01251   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{01252   \textcolor{keywordflow}{if} (!palette) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01253   \textcolor{comment}{// if the style is already in the first page, then do nothing}}
\DoxyCodeLine{01254   \mbox{\hyperlink{class_t_palette_1_1_page}{TPalette::Page}} *page = palette-\/>getStylePage(styleId);}
\DoxyCodeLine{01255   \textcolor{keywordflow}{if} (!page || page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a0e09146e776286b87fc90283c561d19d}{getIndex}}() == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01256 }
\DoxyCodeLine{01257   \textcolor{keywordtype}{int} indexInPage = page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a5d85ded487f7152a95ccbab63c5aecd5}{search}}(styleId);}
\DoxyCodeLine{01258 }
\DoxyCodeLine{01259   TUndoManager::manager()-\/>beginBlock();}
\DoxyCodeLine{01260 }
\DoxyCodeLine{01261   \textcolor{comment}{// call arrangeStyles() to move style to the first page}}
\DoxyCodeLine{01262   arrangeStyles(paletteHandle, 0, palette-\/>getPage(0)-\/>getStyleCount(),}
\DoxyCodeLine{01263                 page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_a0e09146e776286b87fc90283c561d19d}{getIndex}}(), \{indexInPage\});}
\DoxyCodeLine{01264   \textcolor{comment}{// then set the picked position}}
\DoxyCodeLine{01265   setStylePickedPositionUndo *undo =}
\DoxyCodeLine{01266       \textcolor{keyword}{new} setStylePickedPositionUndo(paletteHandle, styleId, point);}
\DoxyCodeLine{01267   undo-\/>redo();}
\DoxyCodeLine{01268   TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{01269 }
\DoxyCodeLine{01270   TUndoManager::manager()-\/>endBlock();}
\DoxyCodeLine{01271 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_ade4586ecdaf9fd428f531d9b98012e30}\label{namespace_palette_cmd_ade4586ecdaf9fd428f531d9b98012e30}} 
\index{PaletteCmd@{PaletteCmd}!pickColorByUsingPickedPosition@{pickColorByUsingPickedPosition}}
\index{pickColorByUsingPickedPosition@{pickColorByUsingPickedPosition}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{pickColorByUsingPickedPosition()}{pickColorByUsingPickedPosition()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::pick\+Color\+By\+Using\+Picked\+Position (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}}]{img,  }\item[{int}]{frame }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01341                                                                         \{}
\DoxyCodeLine{01342   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri = img;}
\DoxyCodeLine{01343   \textcolor{keywordflow}{if} (!ri) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01344 }
\DoxyCodeLine{01345   \mbox{\hyperlink{class_t_palette}{TPalette}} *currentPalette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{01346   \textcolor{keywordflow}{if} (!currentPalette) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01347 }
\DoxyCodeLine{01348   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} imgSize = ri-\/>getRaster()-\/>getSize();}
\DoxyCodeLine{01349   QHash<int, QPair<TPixel32, TPixel32>> styleList;}
\DoxyCodeLine{01350 }
\DoxyCodeLine{01351   \textcolor{comment}{// For all styles (starting from \#1 as \#0 is reserved for the transparent)}}
\DoxyCodeLine{01352   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} sId = 1; sId < currentPalette-\/>\mbox{\hyperlink{class_t_palette_a5a562f2d3a5fa256fcb4bb2be5b45534}{getStyleCount}}(); sId++) \{}
\DoxyCodeLine{01353     \mbox{\hyperlink{class_t_color_style}{TColorStyle}} *style = currentPalette-\/>\mbox{\hyperlink{class_t_palette_a0f6a4eda7dafb0a9f2b43160cfec81e4}{getStyle}}(sId);}
\DoxyCodeLine{01354     \mbox{\hyperlink{class_t_point_t}{TPoint}} pp          = style-\/>getPickedPosition().pos;}
\DoxyCodeLine{01355     \textcolor{keywordtype}{int} pickedFrame    = style-\/>getPickedPosition().frame;}
\DoxyCodeLine{01356     \textcolor{comment}{// If style has a valid picked position}}
\DoxyCodeLine{01357     \textcolor{keywordflow}{if} (pp != \mbox{\hyperlink{class_t_point_t}{TPoint}}() \&\& frame == pickedFrame \&\& pp.x >= 0 \&\&}
\DoxyCodeLine{01358         pp.x < imgSize.lx \&\& pp.y >= 0 \&\& pp.y < imgSize.ly \&\&}
\DoxyCodeLine{01359         style-\/>\mbox{\hyperlink{class_t_color_style_a90ad0a12f571c18a5e842acddf1c9a90}{hasMainColor}}()) \{}
\DoxyCodeLine{01360       TPixel32 beforeColor = style-\/>\mbox{\hyperlink{class_t_color_style_abd78dd4e3ff3e2e78b647195f7622aa7}{getMainColor}}();}
\DoxyCodeLine{01361       TPixel32 afterColor  = pickColor(ri, pp);}
\DoxyCodeLine{01362       style-\/>\mbox{\hyperlink{class_t_color_style_a7298dce9321f51cfb21f3fcb13701240}{setMainColor}}(afterColor);}
\DoxyCodeLine{01363       \textcolor{comment}{//... store the style in the list for undo}}
\DoxyCodeLine{01364       styleList.insert(sId, QPair<TPixel32, TPixel32>(beforeColor, afterColor));}
\DoxyCodeLine{01365     \}}
\DoxyCodeLine{01366   \}}
\DoxyCodeLine{01367 }
\DoxyCodeLine{01368   \textcolor{comment}{// if some style has been changed, then register undo and notify changes}}
\DoxyCodeLine{01369   \textcolor{keywordflow}{if} (!styleList.isEmpty()) \{}
\DoxyCodeLine{01370     pickColorByUsingPickedPositionUndo *undo =}
\DoxyCodeLine{01371         \textcolor{keyword}{new} pickColorByUsingPickedPositionUndo(paletteHandle, styleList);}
\DoxyCodeLine{01372     TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{01373     paletteHandle-\/>notifyColorStyleChanged(\textcolor{keyword}{false}, \textcolor{keyword}{true});  \textcolor{comment}{// set dirty flag here}}
\DoxyCodeLine{01374   \}}
\DoxyCodeLine{01375 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_a75213302b1303d48304f99ac5ba175dd}\label{namespace_palette_cmd_a75213302b1303d48304f99ac5ba175dd}} 
\index{PaletteCmd@{PaletteCmd}!removeReferenceImage@{removeReferenceImage}}
\index{removeReferenceImage@{removeReferenceImage}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{removeReferenceImage()}{removeReferenceImage()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::remove\+Reference\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01012                                                                    \{}
\DoxyCodeLine{01013   \mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} levelPalette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{01014   \textcolor{keywordflow}{if} (!levelPalette) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01015   \mbox{\hyperlink{class_t_undo}{TUndo}} *undo = \textcolor{keyword}{new} SetReferenceImageUndo(levelPalette, paletteHandle);}
\DoxyCodeLine{01016 }
\DoxyCodeLine{01017   levelPalette-\/>\mbox{\hyperlink{class_t_palette_a971fd2aac3c14754d6cdcb0679cf6893}{setRefImg}}(\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}());}
\DoxyCodeLine{01018   levelPalette-\/>\mbox{\hyperlink{class_t_palette_a3009b4c976d9458d71dca9ea176bd7e1}{setRefImgPath}}(\mbox{\hyperlink{class_t_file_path}{TFilePath}}());}
\DoxyCodeLine{01019 }
\DoxyCodeLine{01020   std::vector<TFrameId> fids;}
\DoxyCodeLine{01021   levelPalette-\/>\mbox{\hyperlink{class_t_palette_a807070f5c3f7033531f455f08ee489c4}{setRefLevelFids}}(fids, \textcolor{keyword}{false});}
\DoxyCodeLine{01022 }
\DoxyCodeLine{01023   levelPalette-\/>\mbox{\hyperlink{class_t_palette_a382fa102abee4e69e386cb5a4d8d5184}{setDirtyFlag}}(\textcolor{keyword}{true});}
\DoxyCodeLine{01024   paletteHandle-\/>notifyPaletteChanged();}
\DoxyCodeLine{01025 }
\DoxyCodeLine{01026   TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{01027 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_a402113f4bd931e0144d15a8b0cb002c4}\label{namespace_palette_cmd_a402113f4bd931e0144d15a8b0cb002c4}} 
\index{PaletteCmd@{PaletteCmd}!renamePalettePage@{renamePalettePage}}
\index{renamePalettePage@{renamePalettePage}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{renamePalettePage()}{renamePalettePage()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::rename\+Palette\+Page (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{int}]{page\+Index,  }\item[{const std\+::wstring \&}]{new\+Name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01118                                                               \{}
\DoxyCodeLine{01119   \textcolor{keywordflow}{if} (!paletteHandle) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01120   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{01121   \textcolor{keywordflow}{if} (!palette) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01122   \textcolor{keywordflow}{if} (pageIndex < 0 || pageIndex >= palette-\/>getPageCount()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01123   RenamePageUndo *undo = \textcolor{keyword}{new} RenamePageUndo(paletteHandle, pageIndex, newName);}
\DoxyCodeLine{01124   paletteHandle-\/>notifyPaletteChanged();}
\DoxyCodeLine{01125   \mbox{\hyperlink{class_t_palette_1_1_page}{TPalette::Page}} *page = palette-\/>getPage(pageIndex);}
\DoxyCodeLine{01126   assert(page);}
\DoxyCodeLine{01127   page-\/>\mbox{\hyperlink{class_t_palette_1_1_page_acd6c0eb1874647e8af39da95459cfdde}{setName}}(newName);}
\DoxyCodeLine{01128   palette-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{01129   paletteHandle-\/>notifyPaletteChanged();}
\DoxyCodeLine{01130   TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{01131 \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespace_palette_cmd_ab2c398e5ac92c0586bf6af4ab4d918e9}\label{namespace_palette_cmd_ab2c398e5ac92c0586bf6af4ab4d918e9}} 
\index{PaletteCmd@{PaletteCmd}!renamePaletteStyle@{renamePaletteStyle}}
\index{renamePaletteStyle@{renamePaletteStyle}!PaletteCmd@{PaletteCmd}}
\doxysubsubsection{\texorpdfstring{renamePaletteStyle()}{renamePaletteStyle()}}
{\footnotesize\ttfamily void Palette\+Cmd\+::rename\+Palette\+Style (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_palette_handle}{TPalette\+Handle}} $\ast$}]{palette\+Handle,  }\item[{const std\+::wstring \&}]{new\+Name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01184                                                                \{}
\DoxyCodeLine{01185   \textcolor{keywordflow}{if} (!paletteHandle) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01186   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = paletteHandle-\/>getPalette();}
\DoxyCodeLine{01187   \textcolor{keywordflow}{if} (!palette) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01188   \mbox{\hyperlink{class_t_color_style}{TColorStyle}} *style = paletteHandle-\/>getStyle();}
\DoxyCodeLine{01189   \textcolor{keywordflow}{if} (!style) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01190   \textcolor{keywordflow}{if} (style-\/>\mbox{\hyperlink{class_t_color_style_a611de20d126c5838456f9113b4682c4f}{getName}}() == newName) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01191 }
\DoxyCodeLine{01192   RenamePaletteStyleUndo *undo =}
\DoxyCodeLine{01193       \textcolor{keyword}{new} RenamePaletteStyleUndo(paletteHandle, newName);}
\DoxyCodeLine{01194   style-\/>\mbox{\hyperlink{class_t_color_style_aeb25e0ae1708d473bd551b0d0c9bf4a9}{setName}}(newName);}
\DoxyCodeLine{01195   palette-\/>setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{01196   paletteHandle-\/>notifyColorStyleChanged(\textcolor{keyword}{false});}
\DoxyCodeLine{01197   TUndoManager::manager()-\/>add(undo);}
\DoxyCodeLine{01198 \}}

\end{DoxyCode}
