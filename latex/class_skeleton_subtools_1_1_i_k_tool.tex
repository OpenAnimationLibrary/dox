\hypertarget{class_skeleton_subtools_1_1_i_k_tool}{}\doxysection{Skeleton\+Subtools\+::IKTool Class Reference}
\label{class_skeleton_subtools_1_1_i_k_tool}\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
Inheritance diagram for Skeleton\+Subtools\+::IKTool\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_skeleton_subtools_1_1_i_k_tool}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_a0d3c7ced244fbcd197828a5379351aee}{IKTool}} (\mbox{\hyperlink{class_skeleton_tool}{Skeleton\+Tool}} $\ast$tool, \mbox{\hyperlink{class_t_tool_1_1_viewer}{TTool\+::\+Viewer}} $\ast$viewer, \mbox{\hyperlink{class_skeleton}{Skeleton}} $\ast$skeleton, int column\+Index)
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_aab2ceed96785bc8b372b4ed65b0d6913}{init\+Engine}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos)
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_ad1fee843d36f9b2ccbb15c670375eb7d}{store\+Old\+Values}} ()
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_ae2c9711d540e39a6c419c7f5d9074447}{compute\+IHate\+IK}} ()
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_ae675b0846f67c9eb4eaa00ffc9b7102e}{set\+Angle\+Offsets}} ()
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_a15d3ba382b1efafa8ca581151468649d}{apply}} ()
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_a30028289b44972cf7f8a0b703258969c}{left\+Button\+Down}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_ae5a1bf8d4cdd8e69eb6bf5bfe9b45ba4}{left\+Button\+Drag}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_ab6f663b01d410a34622cd53e85bff3cc}{left\+Button\+Up}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_a4ad9d00db94615ac134eaaf25aa42b4e}{draw}} () override
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_a0d3c7ced244fbcd197828a5379351aee}\label{class_skeleton_subtools_1_1_i_k_tool_a0d3c7ced244fbcd197828a5379351aee}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!IKTool@{IKTool}}
\index{IKTool@{IKTool}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{IKTool()}{IKTool()}}
{\footnotesize\ttfamily IKTool\+::\+IKTool (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_skeleton_tool}{Skeleton\+Tool}} $\ast$}]{tool,  }\item[{\mbox{\hyperlink{class_t_tool_1_1_viewer}{TTool\+::\+Viewer}} $\ast$}]{viewer,  }\item[{\mbox{\hyperlink{class_skeleton}{Skeleton}} $\ast$}]{skeleton,  }\item[{int}]{column\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00735     : \mbox{\hyperlink{class_skeleton_subtools_1_1_drag_tool}{DragTool}}(tool)}
\DoxyCodeLine{00736     , m\_viewer(viewer)}
\DoxyCodeLine{00737     , m\_skeleton(skeleton)}
\DoxyCodeLine{00738     , m\_pos()}
\DoxyCodeLine{00739     , m\_columnIndex(columnIndex)}
\DoxyCodeLine{00740     , m\_valid(\textcolor{keyword}{false})}
\DoxyCodeLine{00741     , m\_frameOnNewPin(\textcolor{keyword}{false})}
\DoxyCodeLine{00742     , m\_foot(0)}
\DoxyCodeLine{00743     , m\_firstFoot(0)}
\DoxyCodeLine{00744     , m\_undo(0) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_afd3729e5e92cdf94173d309b64159d86}\label{class_skeleton_subtools_1_1_i_k_tool_afd3729e5e92cdf94173d309b64159d86}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!````~IKTool@{$\sim$IKTool}}
\index{````~IKTool@{$\sim$IKTool}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{$\sim$IKTool()}{~IKTool()}}
{\footnotesize\ttfamily IKTool\+::$\sim$\+IKTool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00748 \{ \textcolor{keyword}{delete} m\_skeleton; \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_a15d3ba382b1efafa8ca581151468649d}\label{class_skeleton_subtools_1_1_i_k_tool_a15d3ba382b1efafa8ca581151468649d}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!apply@{apply}}
\index{apply@{apply}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{apply()}{apply()}}
{\footnotesize\ttfamily void IKTool\+::apply (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00996                    \{}
\DoxyCodeLine{00997   \textcolor{keywordflow}{if} (!m\_valid) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00998   \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *rootObj = m\_skeleton-\/>\mbox{\hyperlink{class_skeleton_a05a444ea535b7834f4b25da24afc9764}{getRootBone}}()-\/>getStageObject();}
\DoxyCodeLine{00999   \textcolor{keywordflow}{if} (!m\_undo) \{}
\DoxyCodeLine{01000     m\_undo = \textcolor{keyword}{new} \mbox{\hyperlink{class_skeleton_subtools_1_1_i_k_tool_undo}{IKToolUndo}}();}
\DoxyCodeLine{01001     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_joints.size(); i++)}
\DoxyCodeLine{01002       m\_undo-\/>addNode(m\_joints[i].m\_bone-\/>getStageObject()-\/>getId());}
\DoxyCodeLine{01003 }
\DoxyCodeLine{01004     \textcolor{keywordflow}{if} (m\_frameOnNewPin \&\& m\_firstFoot) \{}
\DoxyCodeLine{01005       m\_undo-\/>setFirstFootId(m\_firstFoot-\/>\mbox{\hyperlink{class_t_stage_object_a7acac7f9d2b8aabae125a81cc4ac5b10}{getId}}());}
\DoxyCodeLine{01006       m\_undo-\/>setFirstFootOldPlacement(}
\DoxyCodeLine{01007           m\_firstFoot-\/>getPinnedRangeSet()-\/>getPlacement());}
\DoxyCodeLine{01008     \}}
\DoxyCodeLine{01009   \}}
\DoxyCodeLine{01010 }
\DoxyCodeLine{01011   \textcolor{keywordtype}{int} frame = TTool::getApplication()-\/>getCurrentFrame()-\/>getFrame();}
\DoxyCodeLine{01012   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_joints.size(); i++) \{}
\DoxyCodeLine{01013     \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj   = m\_joints[i].m\_bone-\/>getStageObject();}
\DoxyCodeLine{01014     \mbox{\hyperlink{class_t_double_param}{TDoubleParam}} *param = obj-\/>\mbox{\hyperlink{class_t_stage_object_ae4cf64f5085310a14074ceb54d2b5177}{getParam}}(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a08806eb331bdede66bb3113b1642a6ad}{TStageObject::T\_Angle}});}
\DoxyCodeLine{01015     \textcolor{keywordtype}{double} theta        = m\_joints[i].m\_sign * m\_engine.getJointAngle(i) -\/}
\DoxyCodeLine{01016                    m\_joints[i].m\_angleOffset;}
\DoxyCodeLine{01017     theta *= M\_180\_PI;}
\DoxyCodeLine{01018     \textcolor{keywordtype}{double} oldTheta = param-\/>getValue(frame);}
\DoxyCodeLine{01019     \textcolor{keywordtype}{double} delta    = theta -\/ oldTheta;}
\DoxyCodeLine{01020     \textcolor{keywordflow}{if} (fabs(delta) > 180) theta += (theta < oldTheta ? 1 : -\/1) * 360;}
\DoxyCodeLine{01021     param-\/>setValue(frame, theta);}
\DoxyCodeLine{01022   \}}
\DoxyCodeLine{01023   m\_skeleton-\/>\mbox{\hyperlink{class_skeleton_a05a444ea535b7834f4b25da24afc9764}{getRootBone}}()-\/>getStageObject()-\/>\mbox{\hyperlink{class_t_stage_object_add34b90eaaa8ff75b9ed098c4d9bec27}{invalidate}}();}
\DoxyCodeLine{01024   \textcolor{keywordflow}{if} (m\_frameOnNewPin) \{}
\DoxyCodeLine{01025     \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *rootObj = m\_skeleton-\/>\mbox{\hyperlink{class_skeleton_a05a444ea535b7834f4b25da24afc9764}{getRootBone}}()-\/>getStageObject();}
\DoxyCodeLine{01026     rootObj-\/>\mbox{\hyperlink{class_t_stage_object_a47bbc7e7d5b5334d6b0c5b6b265570c9}{setStatus}}(\mbox{\hyperlink{class_t_stage_object_a4c228002778d80aa07ed34abde5dec84ac9c6e1fed425869b235ea7ef9c820024}{TStageObject::XY}});}
\DoxyCodeLine{01027     rootObj-\/>\mbox{\hyperlink{class_t_stage_object_add34b90eaaa8ff75b9ed098c4d9bec27}{invalidate}}();}
\DoxyCodeLine{01028     \mbox{\hyperlink{class_t_affine}{TAffine}} rootBasePlacement = rootObj-\/>getPlacement(frame);}
\DoxyCodeLine{01029     rootObj-\/>\mbox{\hyperlink{class_t_stage_object_a47bbc7e7d5b5334d6b0c5b6b265570c9}{setStatus}}(\mbox{\hyperlink{class_t_stage_object_a4c228002778d80aa07ed34abde5dec84a7e9784777840246d5ed3b4aba27c7d26}{TStageObject::IK}});}
\DoxyCodeLine{01030     rootObj-\/>\mbox{\hyperlink{class_t_stage_object_add34b90eaaa8ff75b9ed098c4d9bec27}{invalidate}}();}
\DoxyCodeLine{01031 }
\DoxyCodeLine{01032     \mbox{\hyperlink{class_t_pinned_range_set}{TPinnedRangeSet}} *rangeSet = m\_firstFoot-\/>getPinnedRangeSet();}
\DoxyCodeLine{01033 }
\DoxyCodeLine{01034     \mbox{\hyperlink{class_t_affine}{TAffine}} oldFootPlacement = m\_foot-\/>getPlacement(frame);}
\DoxyCodeLine{01035     \mbox{\hyperlink{class_t_affine}{TAffine}} relativeOldFootPlacement =}
\DoxyCodeLine{01036         rootBasePlacement.\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}() * oldFootPlacement;}
\DoxyCodeLine{01037     \mbox{\hyperlink{class_t_affine}{TAffine}} correction = rootBasePlacement.\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}() * m\_footPlacement *}
\DoxyCodeLine{01038                          oldFootPlacement.\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}() * rootBasePlacement;}
\DoxyCodeLine{01039 }
\DoxyCodeLine{01040     rangeSet-\/>setPlacement(correction * rangeSet-\/>getPlacement());}
\DoxyCodeLine{01041     rootObj-\/>\mbox{\hyperlink{class_t_stage_object_add34b90eaaa8ff75b9ed098c4d9bec27}{invalidate}}();}
\DoxyCodeLine{01042 }
\DoxyCodeLine{01043     \mbox{\hyperlink{class_t_affine}{TAffine}} currentFootPlacement = m\_foot-\/>getPlacement(frame);}
\DoxyCodeLine{01044     \mbox{\hyperlink{class_t_affine}{TAffine}} check                = m\_footPlacement.\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}() * currentFootPlacement;}
\DoxyCodeLine{01045 }
\DoxyCodeLine{01046     assert(check.\mbox{\hyperlink{class_t_affine_a5671bcda5ebc9262ec1681bb96cf8633}{isIdentity}}(0.01));}
\DoxyCodeLine{01047   \}}
\DoxyCodeLine{01048 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_ae2c9711d540e39a6c419c7f5d9074447}\label{class_skeleton_subtools_1_1_i_k_tool_ae2c9711d540e39a6c419c7f5d9074447}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!computeIHateIK@{computeIHateIK}}
\index{computeIHateIK@{computeIHateIK}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{computeIHateIK()}{computeIHateIK()}}
{\footnotesize\ttfamily void IKTool\+::compute\+IHate\+IK (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00911                             \{}
\DoxyCodeLine{00912   std::vector<TStageObject *> objs;}
\DoxyCodeLine{00913   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m\_skeleton-\/>getBoneCount(); i++)}
\DoxyCodeLine{00914     objs.push\_back(m\_skeleton-\/>getBone(i)-\/>getStageObject());}
\DoxyCodeLine{00915   \textcolor{keywordtype}{int} n     = (int)objs.size();}
\DoxyCodeLine{00916   \textcolor{keywordtype}{int} frame = TTool::getApplication()-\/>getCurrentFrame()-\/>getFrame();}
\DoxyCodeLine{00917   m\_foot = m\_firstFoot = 0;}
\DoxyCodeLine{00918   m\_frameOnNewPin      = \textcolor{keyword}{false};}
\DoxyCodeLine{00919 }
\DoxyCodeLine{00920   \textcolor{comment}{// this just finds the first pin}}
\DoxyCodeLine{00921   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00922   \textcolor{keywordflow}{for} (i = 0; i < n \&\& !objs[i]-\/>getPinnedRangeSet()-\/>isPinned(frame); i++) \{}
\DoxyCodeLine{00923   \}}
\DoxyCodeLine{00924   \textcolor{keywordflow}{if} (i == n) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00925 }
\DoxyCodeLine{00926   \textcolor{comment}{// this makes m\_foot to be the current pin}}
\DoxyCodeLine{00927   m\_foot = objs[i];}
\DoxyCodeLine{00928 }
\DoxyCodeLine{00929   \textcolor{comment}{// check to see if this frame is the start of a new pin}}
\DoxyCodeLine{00930   \textcolor{keyword}{const} \mbox{\hyperlink{struct_t_pinned_range_set_1_1_range}{TPinnedRangeSet::Range}} *range =}
\DoxyCodeLine{00931       m\_foot-\/>getPinnedRangeSet()-\/>getRange(frame);}
\DoxyCodeLine{00932   \textcolor{keywordflow}{if} (!range || range-\/>first != frame) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00933 }
\DoxyCodeLine{00934   m\_frameOnNewPin = \textcolor{keyword}{true};}
\DoxyCodeLine{00935   \textcolor{keywordtype}{int} firstFrame  = frame -\/ 1;}
\DoxyCodeLine{00936   m\_firstFoot     = m\_foot;}
\DoxyCodeLine{00937 }
\DoxyCodeLine{00938   \textcolor{comment}{// the frame is the start of a new pinned frame, find the previous pin}}
\DoxyCodeLine{00939   \textcolor{keywordflow}{for} (;;) \{}
\DoxyCodeLine{00940     \textcolor{keywordflow}{for} (i = 0; i < n \&\& !objs[i]-\/>getPinnedRangeSet()-\/>isPinned(firstFrame);}
\DoxyCodeLine{00941          i++) \{}
\DoxyCodeLine{00942     \}}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944     \textcolor{keywordflow}{if} (i == n) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00945     m\_firstFoot = objs[i];}
\DoxyCodeLine{00946     range       = m\_firstFoot-\/>getPinnedRangeSet()-\/>getRange(firstFrame);}
\DoxyCodeLine{00947     \textcolor{keywordflow}{if} (!range) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00948     firstFrame = range-\/>first -\/ 1;}
\DoxyCodeLine{00949     \textcolor{keywordflow}{if} (firstFrame < 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00950   \}}
\DoxyCodeLine{00951 }
\DoxyCodeLine{00952   m\_footPlacement      = m\_foot-\/>getPlacement(frame);}
\DoxyCodeLine{00953   m\_firstFootPlacement = m\_firstFoot-\/>getPinnedRangeSet()-\/>getPlacement();}
\DoxyCodeLine{00954 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_a4ad9d00db94615ac134eaaf25aa42b4e}\label{class_skeleton_subtools_1_1_i_k_tool_a4ad9d00db94615ac134eaaf25aa42b4e}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!draw@{draw}}
\index{draw@{draw}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void IKTool\+::draw (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_skeleton_subtools_1_1_drag_tool}{Skeleton\+Subtools\+::\+Drag\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01086                   \{}
\DoxyCodeLine{01087   \textcolor{keywordtype}{int} err = glGetError();}
\DoxyCodeLine{01088   assert(err == GL\_NO\_ERROR);}
\DoxyCodeLine{01089   \mbox{\hyperlink{class_t_application}{TTool::Application}} *app = TTool::getApplication();}
\DoxyCodeLine{01090   \textcolor{keywordtype}{int} frame               = app-\/>getCurrentFrame()-\/>getFrame();}
\DoxyCodeLine{01091 }
\DoxyCodeLine{01092   \textcolor{keywordtype}{double} unit =}
\DoxyCodeLine{01093       TTool::getApplication()-\/>getCurrentTool()-\/>getTool()-\/>getPixelSize();}
\DoxyCodeLine{01094 }
\DoxyCodeLine{01095   \textcolor{keywordflow}{if} (m\_engine.getJointCount() > 0) \{}
\DoxyCodeLine{01096     glColor3d(1, 0, 1);}
\DoxyCodeLine{01097     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m\_engine.getJointCount(); i++) \{}
\DoxyCodeLine{01098       \mbox{\hyperlink{class_t_point_t}{TPointD}} pa = m\_engine.getJoint(i);}
\DoxyCodeLine{01099       tglDrawDisk(pa, 5 * unit);}
\DoxyCodeLine{01100       \textcolor{keywordflow}{if} (i > 0) \{}
\DoxyCodeLine{01101         \textcolor{keywordtype}{int} j = m\_engine.getJointParent(i);}
\DoxyCodeLine{01102         tglDrawSegment(pa, m\_engine.getJoint(j));}
\DoxyCodeLine{01103       \}}
\DoxyCodeLine{01104     \}}
\DoxyCodeLine{01105   \}}
\DoxyCodeLine{01106 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_aab2ceed96785bc8b372b4ed65b0d6913}\label{class_skeleton_subtools_1_1_i_k_tool_aab2ceed96785bc8b372b4ed65b0d6913}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!initEngine@{initEngine}}
\index{initEngine@{initEngine}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{initEngine()}{initEngine()}}
{\footnotesize\ttfamily void IKTool\+::init\+Engine (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00762                                           \{}
\DoxyCodeLine{00763   m\_valid = \textcolor{keyword}{false};}
\DoxyCodeLine{00764   m\_engine.clear();}
\DoxyCodeLine{00765   m\_joints.clear();}
\DoxyCodeLine{00766 }
\DoxyCodeLine{00767   \textcolor{comment}{// build the active chain (bounded by m\_columnIndex and pinned nodes)}}
\DoxyCodeLine{00768   \mbox{\hyperlink{class_graph}{Graph}} \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}};}
\DoxyCodeLine{00769   addToActiveChain(chain, m\_skeleton-\/>getBoneByColumnIndex(m\_columnIndex), 0);}
\DoxyCodeLine{00770 }
\DoxyCodeLine{00771   \textcolor{comment}{// mark leaves as child\_end or parent\_end: a leave is child/parent\_end iff}}
\DoxyCodeLine{00772   \textcolor{comment}{// all its link are parent/child}}
\DoxyCodeLine{00773   \textcolor{keywordflow}{for} (Graph::NodeIter it = \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.begin(); it != \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.end(); ++it)}
\DoxyCodeLine{00774     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLeaveType(it-\/>first) \& (Graph::PINNED | Graph::TEMP)) \{}
\DoxyCodeLine{00775       \textcolor{keywordtype}{int} type = 0;}
\DoxyCodeLine{00776       \textcolor{keywordflow}{for} (Graph::LinkIter j = it-\/>second.begin(); j != it-\/>second.end(); ++j) \{}
\DoxyCodeLine{00777         \textcolor{keywordtype}{int} f =}
\DoxyCodeLine{00778             isParentOf(*j, it-\/>first) ? Graph::CHILD\_END : Graph::PARENT\_END;}
\DoxyCodeLine{00779         \textcolor{keywordflow}{if} (type == 0)}
\DoxyCodeLine{00780           type = f;}
\DoxyCodeLine{00781         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (type != f) \{}
\DoxyCodeLine{00782           type = 0;}
\DoxyCodeLine{00783           \textcolor{keywordflow}{break};}
\DoxyCodeLine{00784         \}}
\DoxyCodeLine{00785       \}}
\DoxyCodeLine{00786       \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.setLeaveType(it-\/>first, \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLeaveType(it-\/>first) | type);}
\DoxyCodeLine{00787     \}}
\DoxyCodeLine{00788 }
\DoxyCodeLine{00789   \textcolor{comment}{// search the foot (i.e. the pinned node). if there are no pinned node find}}
\DoxyCodeLine{00790   \textcolor{comment}{// the first temp-\/pinned}}
\DoxyCodeLine{00791   \textcolor{keywordtype}{int} foot = -\/1;}
\DoxyCodeLine{00792   \textcolor{keywordflow}{for} (Graph::NodeIter it = \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.begin(); it != \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.end(); ++it)}
\DoxyCodeLine{00793     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.isLeave(it-\/>first)) \{}
\DoxyCodeLine{00794       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLeaveType(it-\/>first) \& Graph::PINNED) != 0 || foot < 0)}
\DoxyCodeLine{00795         foot = it-\/>first;}
\DoxyCodeLine{00796     \}}
\DoxyCodeLine{00797   \textcolor{keywordflow}{if} (foot < 0 || !\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.isNode(foot)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00798 }
\DoxyCodeLine{00799   \textcolor{comment}{// If the chain descend from the foot then the whole foot should be still}}
\DoxyCodeLine{00800   \textcolor{comment}{// (e.g. no rotation)}}
\DoxyCodeLine{00801   \textcolor{comment}{// => chop the foot}}
\DoxyCodeLine{00802   \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLinkCount(foot) == 1 \&\&}
\DoxyCodeLine{00803       (\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLeaveType(foot) \& Graph::PINNED)) \{}
\DoxyCodeLine{00804     \textcolor{keywordtype}{int} nextNode = \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getFirstLink(foot);}
\DoxyCodeLine{00805     \textcolor{keywordflow}{if} (isParentOf(foot, nextNode)) \{}
\DoxyCodeLine{00806       \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.remove(foot);}
\DoxyCodeLine{00807       foot = nextNode;}
\DoxyCodeLine{00808       \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.setLeaveType(foot, 3);}
\DoxyCodeLine{00809     \}}
\DoxyCodeLine{00810   \}}
\DoxyCodeLine{00811 }
\DoxyCodeLine{00812   \textcolor{comment}{// if the handle is a terminal node (i.e. just one link) and the next node is}}
\DoxyCodeLine{00813   \textcolor{comment}{// a child move the handle to the next node}}
\DoxyCodeLine{00814   \textcolor{keywordtype}{int} handle = m\_columnIndex;}
\DoxyCodeLine{00815   \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLinkCount(handle) == 1) \{}
\DoxyCodeLine{00816     \textcolor{keywordtype}{int} nextNode = \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getFirstLink(handle);}
\DoxyCodeLine{00817     \textcolor{keywordflow}{if} (isParentOf(handle, nextNode)) \{}
\DoxyCodeLine{00818       \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.remove(handle);}
\DoxyCodeLine{00819       handle = nextNode;}
\DoxyCodeLine{00820     \}}
\DoxyCodeLine{00821   \}}
\DoxyCodeLine{00822 }
\DoxyCodeLine{00823   \textcolor{comment}{// "{}reverse"{} the tree to suit the IKEngine convention}}
\DoxyCodeLine{00824   std::vector<std::pair<int, Skeleton::Bone *>> stack;}
\DoxyCodeLine{00825   std::vector<int> done;}
\DoxyCodeLine{00826   stack.push\_back(std::make\_pair(foot, (\mbox{\hyperlink{class_skeleton_1_1_bone}{Skeleton::Bone}} *)0));}
\DoxyCodeLine{00827   \textcolor{keywordflow}{while} (!stack.empty()) \{}
\DoxyCodeLine{00828     \mbox{\hyperlink{class_skeleton_1_1_bone}{Skeleton::Bone}} *bone = m\_skeleton-\/>getBoneByColumnIndex(stack.back().first);}
\DoxyCodeLine{00829     \mbox{\hyperlink{class_skeleton_1_1_bone}{Skeleton::Bone}} *prev = stack.back().second;}
\DoxyCodeLine{00830     \mbox{\hyperlink{class_skeleton_1_1_bone}{Skeleton::Bone}} *prev2 = prev;}
\DoxyCodeLine{00831     stack.pop\_back();}
\DoxyCodeLine{00832     \textcolor{keywordflow}{for} (;;) \{}
\DoxyCodeLine{00833       \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = bone-\/>getColumnIndex();}
\DoxyCodeLine{00834       done.push\_back(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00835       \textcolor{keywordtype}{double} \mbox{\hyperlink{namespacetcg_1_1numeric__ops_abd17f65a269ec069dc06d0f97e41fb77}{sign}} = 1;}
\DoxyCodeLine{00836       \textcolor{keywordflow}{if} (prev) \{}
\DoxyCodeLine{00837         \textcolor{keywordflow}{if} (prev-\/>getParent() == bone) \mbox{\hyperlink{namespacetcg_1_1numeric__ops_abd17f65a269ec069dc06d0f97e41fb77}{sign}} = -\/1;}
\DoxyCodeLine{00838       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (done.size() == 1) \{}
\DoxyCodeLine{00839         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLeaveType(\textcolor{keywordtype}{id}) \& Graph::CHILD\_END) \mbox{\hyperlink{namespacetcg_1_1numeric__ops_abd17f65a269ec069dc06d0f97e41fb77}{sign}} = -\/1;}
\DoxyCodeLine{00840       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00841         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLeaveType(\textcolor{keywordtype}{id}) \& Graph::PARENT\_END) \mbox{\hyperlink{namespacetcg_1_1numeric__ops_abd17f65a269ec069dc06d0f97e41fb77}{sign}} = -\/1;}
\DoxyCodeLine{00842       \}}
\DoxyCodeLine{00843 }
\DoxyCodeLine{00844       Graph::Links links = \mbox{\hyperlink{namespacetcg_1_1poly__ops_ad4299a9653d24554e97e3e75a34dfeef}{chain}}.getLinks(bone-\/>getColumnIndex());}
\DoxyCodeLine{00845       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)done.size(); i++) links.erase(done[i]);}
\DoxyCodeLine{00846       \textcolor{keywordflow}{if} (links.size() == 0) \{}
\DoxyCodeLine{00847         \textcolor{comment}{// terminal point}}
\DoxyCodeLine{00848         m\_joints.push\_back(Joint(bone, prev, sign));}
\DoxyCodeLine{00849         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00850       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00851         Graph::LinkIter it   = links.begin();}
\DoxyCodeLine{00852         \mbox{\hyperlink{class_skeleton_1_1_bone}{Skeleton::Bone}} *next = m\_skeleton-\/>getBoneByColumnIndex(*it++);}
\DoxyCodeLine{00853         \textcolor{keywordflow}{for} (; it != links.end(); ++it)}
\DoxyCodeLine{00854           stack.push\_back(std::make\_pair(*it, prev));}
\DoxyCodeLine{00855         \textcolor{keywordflow}{if} (links.size() > 1 ||}
\DoxyCodeLine{00856             (prev \&\& next \&\&}
\DoxyCodeLine{00857              (prev-\/>getParent() == bone \&\& next-\/>getParent() == bone))) \{}
\DoxyCodeLine{00858           bone = next;}
\DoxyCodeLine{00859         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00860           m\_joints.push\_back(Joint(bone, prev, sign));}
\DoxyCodeLine{00861           prev = bone;}
\DoxyCodeLine{00862           bone = next;}
\DoxyCodeLine{00863         \}}
\DoxyCodeLine{00864       \}}
\DoxyCodeLine{00865     \}}
\DoxyCodeLine{00866   \}}
\DoxyCodeLine{00867   \textcolor{comment}{// if(m\_joints.size()>=2 \&\& m\_joints[1].m\_prevBone == m\_joints[0].m\_bone)}}
\DoxyCodeLine{00868   \textcolor{comment}{//  m\_joints[0].m\_sign = m\_joints[1].m\_sign;}}
\DoxyCodeLine{00869 }
\DoxyCodeLine{00870   \textcolor{comment}{// feed the engine}}
\DoxyCodeLine{00871   m\_engine.setRoot(m\_joints[0].m\_bone-\/>getCenter());}
\DoxyCodeLine{00872   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < (int)m\_joints.size(); i++) \{}
\DoxyCodeLine{00873     \textcolor{keywordtype}{int} parent = -\/1;}
\DoxyCodeLine{00874     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < i; j++)}
\DoxyCodeLine{00875       \textcolor{keywordflow}{if} (m\_joints[j].m\_bone == m\_joints[i].m\_prevBone) \{}
\DoxyCodeLine{00876         parent = j;}
\DoxyCodeLine{00877         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00878       \}}
\DoxyCodeLine{00879     \textcolor{keywordflow}{if} (parent < 0) \{}
\DoxyCodeLine{00880       assert(0);}
\DoxyCodeLine{00881       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00882     \}}
\DoxyCodeLine{00883     m\_engine.addJoint(m\_joints[i].m\_bone-\/>getCenter(), parent);}
\DoxyCodeLine{00884     \textcolor{keywordflow}{if} (m\_joints[i].m\_bone-\/>getPinnedStatus() != Skeleton::Bone::FREE)}
\DoxyCodeLine{00885       m\_engine.lock(i);}
\DoxyCodeLine{00886   \}}
\DoxyCodeLine{00887 }
\DoxyCodeLine{00888   \textcolor{comment}{// add the handle}}
\DoxyCodeLine{00889   \textcolor{keywordtype}{bool} handleFound = \textcolor{keyword}{false};}
\DoxyCodeLine{00890   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_joints.size(); i++)}
\DoxyCodeLine{00891     \textcolor{keywordflow}{if} (m\_joints[i].m\_bone-\/>getColumnIndex() == handle) \{}
\DoxyCodeLine{00892       m\_engine.addJoint(pos, i);}
\DoxyCodeLine{00893       handleFound = \textcolor{keyword}{true};}
\DoxyCodeLine{00894       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00895     \}}
\DoxyCodeLine{00896   \textcolor{keywordflow}{if} (!handleFound) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00897 }
\DoxyCodeLine{00898   setAngleOffsets();}
\DoxyCodeLine{00899   computeIHateIK();}
\DoxyCodeLine{00900 }
\DoxyCodeLine{00901   m\_valid = \textcolor{keyword}{true};}
\DoxyCodeLine{00902 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_a30028289b44972cf7f8a0b703258969c}\label{class_skeleton_subtools_1_1_i_k_tool_a30028289b44972cf7f8a0b703258969c}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!leftButtonDown@{leftButtonDown}}
\index{leftButtonDown@{leftButtonDown}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDown()}{leftButtonDown()}}
{\footnotesize\ttfamily void IKTool\+::left\+Button\+Down (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{p,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_skeleton_subtools_1_1_drag_tool}{Skeleton\+Subtools\+::\+Drag\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01052                                                                   \{}
\DoxyCodeLine{01053   \mbox{\hyperlink{class_t_point_t}{TPointD}} pos = m\_viewer-\/>winToWorld(e.\mbox{\hyperlink{class_t_mouse_event_a05a3f2378eb2179d121e2e46766916de}{m\_pos}});}
\DoxyCodeLine{01054   m\_pos       = pos;}
\DoxyCodeLine{01055   initEngine(pos);}
\DoxyCodeLine{01056   storeOldValues();}
\DoxyCodeLine{01057 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_ae5a1bf8d4cdd8e69eb6bf5bfe9b45ba4}\label{class_skeleton_subtools_1_1_i_k_tool_ae5a1bf8d4cdd8e69eb6bf5bfe9b45ba4}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!leftButtonDrag@{leftButtonDrag}}
\index{leftButtonDrag@{leftButtonDrag}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDrag()}{leftButtonDrag()}}
{\footnotesize\ttfamily void IKTool\+::left\+Button\+Drag (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{p,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_skeleton_subtools_1_1_drag_tool}{Skeleton\+Subtools\+::\+Drag\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01061                                                                   \{}
\DoxyCodeLine{01062   \textcolor{keywordflow}{if} (!m\_valid) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01063   \textcolor{keywordflow}{if} (m\_engine.getJointCount() > 0) \{}
\DoxyCodeLine{01064     \mbox{\hyperlink{class_t_point_t}{TPointD}} tmp = m\_viewer-\/>winToWorld(e.\mbox{\hyperlink{class_t_mouse_event_a05a3f2378eb2179d121e2e46766916de}{m\_pos}});}
\DoxyCodeLine{01065     m\_engine.drag(tmp);}
\DoxyCodeLine{01066     apply();}
\DoxyCodeLine{01067   \}}
\DoxyCodeLine{01068 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_ab6f663b01d410a34622cd53e85bff3cc}\label{class_skeleton_subtools_1_1_i_k_tool_ab6f663b01d410a34622cd53e85bff3cc}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!leftButtonUp@{leftButtonUp}}
\index{leftButtonUp@{leftButtonUp}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{leftButtonUp()}{leftButtonUp()}}
{\footnotesize\ttfamily void IKTool\+::left\+Button\+Up (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{p,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_skeleton_subtools_1_1_drag_tool}{Skeleton\+Subtools\+::\+Drag\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01071                                                                 \{}
\DoxyCodeLine{01072   \textcolor{keywordflow}{if} (m\_undo) \{}
\DoxyCodeLine{01073     \textcolor{keywordflow}{if} (m\_frameOnNewPin \&\& m\_firstFoot)}
\DoxyCodeLine{01074       m\_undo-\/>setFirstFootNewPlacement(}
\DoxyCodeLine{01075           m\_firstFoot-\/>getPinnedRangeSet()-\/>getPlacement());}
\DoxyCodeLine{01076     TUndoManager::manager()-\/>add(m\_undo);}
\DoxyCodeLine{01077     m\_undo = 0;}
\DoxyCodeLine{01078   \}}
\DoxyCodeLine{01079 }
\DoxyCodeLine{01080   m\_valid = \textcolor{keyword}{false};}
\DoxyCodeLine{01081   m\_engine.clear();}
\DoxyCodeLine{01082 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_ae675b0846f67c9eb4eaa00ffc9b7102e}\label{class_skeleton_subtools_1_1_i_k_tool_ae675b0846f67c9eb4eaa00ffc9b7102e}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!setAngleOffsets@{setAngleOffsets}}
\index{setAngleOffsets@{setAngleOffsets}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{setAngleOffsets()}{setAngleOffsets()}}
{\footnotesize\ttfamily void IKTool\+::set\+Angle\+Offsets (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00958                              \{}
\DoxyCodeLine{00959   \textcolor{keywordtype}{int} frame = TTool::getApplication()-\/>getCurrentFrame()-\/>getFrame();}
\DoxyCodeLine{00960   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_joints.size(); i++) \{}
\DoxyCodeLine{00961     \textcolor{keywordtype}{double} angle = m\_joints[i].m\_bone-\/>getStageObject()-\/>getParam(}
\DoxyCodeLine{00962         \mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a08806eb331bdede66bb3113b1642a6ad}{TStageObject::T\_Angle}}, frame);}
\DoxyCodeLine{00963     \textcolor{keywordtype}{double} theta0             = angle * M\_PI\_180;}
\DoxyCodeLine{00964     \textcolor{keywordtype}{double} theta1             = m\_joints[i].m\_sign * m\_engine.getJointAngle(i);}
\DoxyCodeLine{00965     m\_joints[i].m\_angleOffset = theta1 -\/ theta0;}
\DoxyCodeLine{00966   \}}
\DoxyCodeLine{00967 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_skeleton_subtools_1_1_i_k_tool_ad1fee843d36f9b2ccbb15c670375eb7d}\label{class_skeleton_subtools_1_1_i_k_tool_ad1fee843d36f9b2ccbb15c670375eb7d}} 
\index{SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}!storeOldValues@{storeOldValues}}
\index{storeOldValues@{storeOldValues}!SkeletonSubtools::IKTool@{SkeletonSubtools::IKTool}}
\doxysubsubsection{\texorpdfstring{storeOldValues()}{storeOldValues()}}
{\footnotesize\ttfamily void IKTool\+::store\+Old\+Values (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00971                             \{}
\DoxyCodeLine{00972   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_joints.size(); i++) \{}
\DoxyCodeLine{00973     \mbox{\hyperlink{class_t_stage_object_values}{TStageObjectValues}} values(m\_joints[i].m\_bone-\/>getStageObject()-\/>getId(),}
\DoxyCodeLine{00974                               \mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a08806eb331bdede66bb3113b1642a6ad}{TStageObject::T\_Angle}});}
\DoxyCodeLine{00975     \textcolor{keywordflow}{if} (getTool()-\/>isGlobalKeyframesEnabled()) \{}
\DoxyCodeLine{00976       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a23087217a2f7436152fa0ee4b2362448}{TStageObject::T\_X}});}
\DoxyCodeLine{00977       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a45e2b29d25f50909ebd06d1bd9c1944a}{TStageObject::T\_Y}});}
\DoxyCodeLine{00978       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a6c8e9e0e35cdf4d4a5427a00eaeb255d}{TStageObject::T\_Z}});}
\DoxyCodeLine{00979       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a426bfbbf201379648fff0257dd067289}{TStageObject::T\_SO}});}
\DoxyCodeLine{00980       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a078a9701f533b38eb16dfe8914c45958}{TStageObject::T\_ScaleX}});}
\DoxyCodeLine{00981       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a9bda4b3de61fbbebf8ce48749d22dd86}{TStageObject::T\_ScaleY}});}
\DoxyCodeLine{00982       values.add(TStageObject::T\_Scale);}
\DoxyCodeLine{00983       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439aa0630d9663bbf752a92702f3a1818e58}{TStageObject::T\_Path}});}
\DoxyCodeLine{00984       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a92fbb950a2ad460478a6fa7606196a17}{TStageObject::T\_ShearX}});}
\DoxyCodeLine{00985       values.add(\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439a0c485ea820893a408d07bab60b9b7a0d}{TStageObject::T\_ShearY}});}
\DoxyCodeLine{00986     \}}
\DoxyCodeLine{00987     \mbox{\hyperlink{class_t_application}{TTool::Application}} *app = TTool::getApplication();}
\DoxyCodeLine{00988     values.setFrameHandle(app-\/>getCurrentFrame());}
\DoxyCodeLine{00989     values.setXsheetHandle(app-\/>getCurrentXsheet());}
\DoxyCodeLine{00990     values.updateValues();}
\DoxyCodeLine{00991     m\_joints[i].m\_oldValues = values;}
\DoxyCodeLine{00992   \}}
\DoxyCodeLine{00993 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnztools/skeletonsubtools.\+h\item 
E\+:/opentoonz/toonz/sources/tnztools/skeletonsubtools.\+cpp\end{DoxyCompactItemize}
