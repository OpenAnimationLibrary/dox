\hypertarget{class_t_raster_codec_l_z_o}{}\doxysection{TRaster\+Codec\+LZO Class Reference}
\label{class_t_raster_codec_l_z_o}\index{TRasterCodecLZO@{TRasterCodecLZO}}
Inheritance diagram for TRaster\+Codec\+LZO\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_t_raster_codec_l_z_o}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_raster_codec_l_z_o_a9cf743fe9d73ca260712c734bba4ff8f}{TRaster\+Codec\+LZO}} (const std\+::string \&name, bool use\+Cache)
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \mbox{\hyperlink{class_t_raster_codec_l_z_o_a580837e7e845658e34c9a82a729a338d}{compress}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&in\+Ras, int alloc\+Unit, TINT32 \&out\+Data\+Size)
\item 
bool \mbox{\hyperlink{class_t_raster_codec_l_z_o_abfa752ba725c35452ec743fa5519ba24}{decompress}} (const UCHAR $\ast$in\+Data, TINT32 in\+Data\+Size, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&out\+Ras, bool safe\+Mode)
\item 
void \mbox{\hyperlink{class_t_raster_codec_l_z_o_aefeefaca7bd6f0fb9b76eb872a5ef4c1}{decompress}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&compressed\+Ras, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&out\+Ras)
\item 
void \mbox{\hyperlink{class_t_raster_codec_l_z_o_afe726539bf243c6d0e36ff95ab3ba69c}{reset}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_raster_codec_l_z_o_a9cf743fe9d73ca260712c734bba4ff8f}\label{class_t_raster_codec_l_z_o_a9cf743fe9d73ca260712c734bba4ff8f}} 
\index{TRasterCodecLZO@{TRasterCodecLZO}!TRasterCodecLZO@{TRasterCodecLZO}}
\index{TRasterCodecLZO@{TRasterCodecLZO}!TRasterCodecLZO@{TRasterCodecLZO}}
\doxysubsubsection{\texorpdfstring{TRasterCodecLZO()}{TRasterCodecLZO()}}
{\footnotesize\ttfamily TRaster\+Codec\+LZO\+::\+TRaster\+Codec\+LZO (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{name,  }\item[{bool}]{use\+Cache }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00601     : \mbox{\hyperlink{class_t_raster_codec}{TRasterCodec}}(name), m\_raster(), m\_useCache(useCache), m\_cacheId(\textcolor{stringliteral}{"{}"{}}) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_l_z_o_ab57a75cb766373dead406d803787a16e}\label{class_t_raster_codec_l_z_o_ab57a75cb766373dead406d803787a16e}} 
\index{TRasterCodecLZO@{TRasterCodecLZO}!````~TRasterCodecLZO@{$\sim$TRasterCodecLZO}}
\index{````~TRasterCodecLZO@{$\sim$TRasterCodecLZO}!TRasterCodecLZO@{TRasterCodecLZO}}
\doxysubsubsection{\texorpdfstring{$\sim$TRasterCodecLZO()}{~TRasterCodecLZO()}}
{\footnotesize\ttfamily TRaster\+Codec\+LZO\+::$\sim$\+TRaster\+Codec\+LZO (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00605                                   \{}
\DoxyCodeLine{00606   \textcolor{keywordflow}{if} (m\_useCache)}
\DoxyCodeLine{00607     TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove}}(m\_cacheId);}
\DoxyCodeLine{00608   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00609     m\_raster = \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}}();}
\DoxyCodeLine{00610 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_raster_codec_l_z_o_a580837e7e845658e34c9a82a729a338d}\label{class_t_raster_codec_l_z_o_a580837e7e845658e34c9a82a729a338d}} 
\index{TRasterCodecLZO@{TRasterCodecLZO}!compress@{compress}}
\index{compress@{compress}!TRasterCodecLZO@{TRasterCodecLZO}}
\doxysubsubsection{\texorpdfstring{compress()}{compress()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} TRaster\+Codec\+LZO\+::compress (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{in\+Ras,  }\item[{int}]{alloc\+Unit,  }\item[{TINT32 \&}]{out\+Data\+Size }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00671                                                         \{}
\DoxyCodeLine{00672   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} rasOut;}
\DoxyCodeLine{00673   UINT outSize = doCompress(inRas, allocUnit, rasOut);}
\DoxyCodeLine{00674   \textcolor{keywordflow}{if} (outSize == 0) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00675 }
\DoxyCodeLine{00676   UINT headerSize = \textcolor{keyword}{sizeof}(Header);}
\DoxyCodeLine{00677   \textcolor{keywordflow}{if} (TBigMemoryManager::instance()-\/>isActive() \&\&}
\DoxyCodeLine{00678       TBigMemoryManager::instance()-\/>getAvailableMemoryinKb() <}
\DoxyCodeLine{00679           ((outSize + headerSize) >> 10))}
\DoxyCodeLine{00680     \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} r8(outSize + headerSize, 1);}
\DoxyCodeLine{00683   r8-\/>lock();}
\DoxyCodeLine{00684   UCHAR *memoryChunk = r8-\/>getRawData();}
\DoxyCodeLine{00685   \textcolor{keywordflow}{if} (!memoryChunk) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00686   Header head(inRas);}
\DoxyCodeLine{00687 }
\DoxyCodeLine{00688   memcpy(memoryChunk, \&head, headerSize);}
\DoxyCodeLine{00689   UCHAR *tmp = memoryChunk + headerSize;}
\DoxyCodeLine{00690   rasOut-\/>lock();}
\DoxyCodeLine{00691   memcpy(tmp, rasOut-\/>getRawData(), outSize);}
\DoxyCodeLine{00692   r8-\/>unlock();}
\DoxyCodeLine{00693   rasOut-\/>unlock();}
\DoxyCodeLine{00694   outDataSize = outSize + headerSize;}
\DoxyCodeLine{00695   \textcolor{keywordflow}{return} r8;}
\DoxyCodeLine{00696 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_l_z_o_aefeefaca7bd6f0fb9b76eb872a5ef4c1}\label{class_t_raster_codec_l_z_o_aefeefaca7bd6f0fb9b76eb872a5ef4c1}} 
\index{TRasterCodecLZO@{TRasterCodecLZO}!decompress@{decompress}}
\index{decompress@{decompress}!TRasterCodecLZO@{TRasterCodecLZO}}
\doxysubsubsection{\texorpdfstring{decompress()}{decompress()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void TRaster\+Codec\+LZO\+::decompress (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{compressed\+Ras,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{out\+Ras }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00750                                                    \{}
\DoxyCodeLine{00751   \textcolor{keywordtype}{int} headerSize = \textcolor{keyword}{sizeof}(Header);}
\DoxyCodeLine{00752 }
\DoxyCodeLine{00753   assert(compressedRas-\/>getLy() == 1 \&\& compressedRas-\/>getPixelSize() == 1);}
\DoxyCodeLine{00754   UINT inDataSize = compressedRas-\/>getLx();}
\DoxyCodeLine{00755 }
\DoxyCodeLine{00756   compressedRas-\/>lock();}
\DoxyCodeLine{00757 }
\DoxyCodeLine{00758   UCHAR *inData = compressedRas-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}();}
\DoxyCodeLine{00759   Header header(inData);}
\DoxyCodeLine{00760 }
\DoxyCodeLine{00761   \textcolor{keywordflow}{if} (!outRas) \{}
\DoxyCodeLine{00762     outRas = header.createRaster();}
\DoxyCodeLine{00763     \textcolor{keywordflow}{if} (!outRas) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00764   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00765     \textcolor{keywordflow}{if} (outRas-\/>getLx() != outRas-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}()) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00766   \}}
\DoxyCodeLine{00767 }
\DoxyCodeLine{00768   \textcolor{keywordtype}{int} outDataSize = header.getRasterSize();}
\DoxyCodeLine{00769 }
\DoxyCodeLine{00770   \textcolor{keywordtype}{char} *mc = (\textcolor{keywordtype}{char} *)inData + headerSize;}
\DoxyCodeLine{00771   \textcolor{keywordtype}{int} ds   = inDataSize -\/ headerSize;}
\DoxyCodeLine{00772 }
\DoxyCodeLine{00773   \textcolor{keywordtype}{size\_t} outSize = outDataSize;  \textcolor{comment}{// Calculate output buffer size}}
\DoxyCodeLine{00774 }
\DoxyCodeLine{00775   \textcolor{keywordtype}{char} *outData = (\textcolor{keywordtype}{char} *)outRas-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}();}
\DoxyCodeLine{00776 }
\DoxyCodeLine{00777   QByteArray decompressedBuffer;}
\DoxyCodeLine{00778   \textcolor{keywordflow}{if} (!lzoDecompress(QByteArray(mc, ds), outSize, decompressedBuffer))}
\DoxyCodeLine{00779     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}LZO decompression failed"{}});}
\DoxyCodeLine{00780   outRas-\/>lock();}
\DoxyCodeLine{00781   memcpy(outRas-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}(), decompressedBuffer.data(),}
\DoxyCodeLine{00782          decompressedBuffer.size());}
\DoxyCodeLine{00783   \textcolor{keywordtype}{bool} rc = \textcolor{keyword}{true};}
\DoxyCodeLine{00784 }
\DoxyCodeLine{00785   outRas-\/>unlock();}
\DoxyCodeLine{00786   compressedRas-\/>unlock();}
\DoxyCodeLine{00787 }
\DoxyCodeLine{00788   \textcolor{keywordflow}{if} (rc != \textcolor{keyword}{true})  \textcolor{comment}{// Check success code here}}
\DoxyCodeLine{00789     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}decompress... something goes bad"{}});}
\DoxyCodeLine{00790 }
\DoxyCodeLine{00791   assert(outSize == (\textcolor{keywordtype}{size\_t})outDataSize);}
\DoxyCodeLine{00792 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_l_z_o_abfa752ba725c35452ec743fa5519ba24}\label{class_t_raster_codec_l_z_o_abfa752ba725c35452ec743fa5519ba24}} 
\index{TRasterCodecLZO@{TRasterCodecLZO}!decompress@{decompress}}
\index{decompress@{decompress}!TRasterCodecLZO@{TRasterCodecLZO}}
\doxysubsubsection{\texorpdfstring{decompress()}{decompress()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool TRaster\+Codec\+LZO\+::decompress (\begin{DoxyParamCaption}\item[{const UCHAR $\ast$}]{in\+Data,  }\item[{TINT32}]{in\+Data\+Size,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{out\+Ras,  }\item[{bool}]{safe\+Mode }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00701                                                                   \{}
\DoxyCodeLine{00702   \textcolor{keywordtype}{int} headerSize = \textcolor{keyword}{sizeof}(Header);}
\DoxyCodeLine{00703 }
\DoxyCodeLine{00704   Header *header = (Header *)inData;}
\DoxyCodeLine{00705   \textcolor{keywordflow}{if} (!outRas) \{}
\DoxyCodeLine{00706     outRas = header-\/>createRaster();}
\DoxyCodeLine{00707     \textcolor{keywordflow}{if} (!outRas) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00708   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00709     \textcolor{keywordflow}{if} (outRas-\/>getLx() != outRas-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}()) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00710   \}}
\DoxyCodeLine{00711 }
\DoxyCodeLine{00712   \textcolor{keywordtype}{int} outDataSize = header-\/>getRasterSize();}
\DoxyCodeLine{00713 }
\DoxyCodeLine{00714   \textcolor{keywordtype}{char} *mc = (\textcolor{keywordtype}{char} *)inData + headerSize;}
\DoxyCodeLine{00715   \textcolor{keywordtype}{int} ds   = inDataSize -\/ headerSize;}
\DoxyCodeLine{00716 }
\DoxyCodeLine{00717   \textcolor{keywordtype}{size\_t} outSize = outDataSize;  \textcolor{comment}{// Calculate output buffer size}}
\DoxyCodeLine{00718 }
\DoxyCodeLine{00719   QByteArray decompressedBuffer;}
\DoxyCodeLine{00720   \textcolor{keywordflow}{if} (!lzoDecompress(QByteArray(mc, ds), outSize, decompressedBuffer))}
\DoxyCodeLine{00721     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}LZO decompression failed"{}});}
\DoxyCodeLine{00722 }
\DoxyCodeLine{00723   outRas-\/>lock();}
\DoxyCodeLine{00724   memcpy(outRas-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}(), decompressedBuffer.data(),}
\DoxyCodeLine{00725          decompressedBuffer.size());}
\DoxyCodeLine{00726   \textcolor{keywordtype}{bool} rc = \textcolor{keyword}{true};}
\DoxyCodeLine{00727 }
\DoxyCodeLine{00728   outRas-\/>unlock();}
\DoxyCodeLine{00729 }
\DoxyCodeLine{00730   \textcolor{comment}{/*}}
\DoxyCodeLine{00731 \textcolor{comment}{if (rc != true)                                     // Check success code here}}
\DoxyCodeLine{00732 \textcolor{comment}{\{}}
\DoxyCodeLine{00733 \textcolor{comment}{if (safeMode)}}
\DoxyCodeLine{00734 \textcolor{comment}{return false;}}
\DoxyCodeLine{00735 \textcolor{comment}{else}}
\DoxyCodeLine{00736 \textcolor{comment}{\{}}
\DoxyCodeLine{00737 \textcolor{comment}{throw TException("{}decompress... something goes bad"{});}}
\DoxyCodeLine{00738 \textcolor{comment}{return false;}}
\DoxyCodeLine{00739 \textcolor{comment}{\}}}
\DoxyCodeLine{00740 \textcolor{comment}{\}}}
\DoxyCodeLine{00741 \textcolor{comment}{  */}}
\DoxyCodeLine{00742 }
\DoxyCodeLine{00743   assert(outSize == (\textcolor{keywordtype}{size\_t})outDataSize);}
\DoxyCodeLine{00744   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00745 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_l_z_o_afe726539bf243c6d0e36ff95ab3ba69c}\label{class_t_raster_codec_l_z_o_afe726539bf243c6d0e36ff95ab3ba69c}} 
\index{TRasterCodecLZO@{TRasterCodecLZO}!reset@{reset}}
\index{reset@{reset}!TRasterCodecLZO@{TRasterCodecLZO}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily void TRaster\+Codec\+LZO\+::reset (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00146                \{}
\DoxyCodeLine{00147     \textcolor{keywordflow}{if} (m\_useCache) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00148     m\_raster = \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}}();}
\DoxyCodeLine{00149   \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tcodec.\+h\item 
E\+:/opentoonz/toonz/sources/common/trasterimage/tcodec.\+cpp\end{DoxyCompactItemize}
