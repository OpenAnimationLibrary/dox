\hypertarget{class_imp_p_d_x}{}\doxysection{Imp\+PDX Class Reference}
\label{class_imp_p_d_x}\index{ImpPDX@{ImpPDX}}
Inheritance diagram for Imp\+PDX\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_imp_p_d_x}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_imp_p_d_x_a32ee91dbb5c3c9c70831ada9fddaed26}{Imp\+PDX}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
void \mbox{\hyperlink{class_imp_p_d_x_a299dd6074ef164ae08138f4bd507cd9e}{open\+File}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fname, TINT64 file\+Size)
\item 
void \mbox{\hyperlink{class_imp_p_d_x_aaa4f2fa0295c4cd543483faa39973ede}{set\+Current\+View}} (int pos, int \&new\+Low\+Pos, int \&new\+Hi\+Pos)
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_imp_p_d_x_a32ee91dbb5c3c9c70831ada9fddaed26}\label{class_imp_p_d_x_a32ee91dbb5c3c9c70831ada9fddaed26}} 
\index{ImpPDX@{ImpPDX}!ImpPDX@{ImpPDX}}
\index{ImpPDX@{ImpPDX}!ImpPDX@{ImpPDX}}
\doxysubsubsection{\texorpdfstring{ImpPDX()}{ImpPDX()}}
{\footnotesize\ttfamily Imp\+PDX\+::\+Imp\+PDX (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00415                                   : \mbox{\hyperlink{class_imp_p_d}{ImpPD}}(fp), m\_fd(-\/1) \{}
\DoxyCodeLine{00416   \textcolor{comment}{// std::cout << "{}cache file "{} << toString(m\_fname.getFullPath()) << std::endl;}}
\DoxyCodeLine{00417   m\_pageSize = getpagesize();}
\DoxyCodeLine{00418   openFile(m\_fname, 0);}
\DoxyCodeLine{00419   assert(m\_fd >= 0);}
\DoxyCodeLine{00420 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_imp_p_d_x_a28c0df758fe80b6b648434366225e2cc}\label{class_imp_p_d_x_a28c0df758fe80b6b648434366225e2cc}} 
\index{ImpPDX@{ImpPDX}!````~ImpPDX@{$\sim$ImpPDX}}
\index{````~ImpPDX@{$\sim$ImpPDX}!ImpPDX@{ImpPDX}}
\doxysubsubsection{\texorpdfstring{$\sim$ImpPDX()}{~ImpPDX()}}
{\footnotesize\ttfamily Imp\+PDX\+::$\sim$\+Imp\+PDX (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00424                 \{}
\DoxyCodeLine{00425   \textcolor{keywordflow}{if} (m\_fileMapAddress) munmap(m\_fileMapAddress, m\_viewSize);}
\DoxyCodeLine{00426   close(m\_fd);}
\DoxyCodeLine{00427   m\_fd = 0;}
\DoxyCodeLine{00428 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_imp_p_d_x_a299dd6074ef164ae08138f4bd507cd9e}\label{class_imp_p_d_x_a299dd6074ef164ae08138f4bd507cd9e}} 
\index{ImpPDX@{ImpPDX}!openFile@{openFile}}
\index{openFile@{openFile}!ImpPDX@{ImpPDX}}
\doxysubsubsection{\texorpdfstring{openFile()}{openFile()}}
{\footnotesize\ttfamily void Imp\+PDX\+::open\+File (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fname,  }\item[{TINT64}]{file\+Size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_imp_p_d}{Imp\+PD}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00432                                                              \{}
\DoxyCodeLine{00433   assert(0);}
\DoxyCodeLine{00434   \textcolor{comment}{/*}}
\DoxyCodeLine{00435 \textcolor{comment}{string fn(toString(fname.getWideString()));}}
\DoxyCodeLine{00436 \textcolor{comment}{std::cout << "{}open "{} << fn << std::endl;}}
\DoxyCodeLine{00437 \textcolor{comment}{m\_fd = open(fn.c\_str(), O\_RDWR|O\_CREAT, 00666);}}
\DoxyCodeLine{00438 \textcolor{comment}{assert(m\_fd >=0);}}
\DoxyCodeLine{00439 \textcolor{comment}{*/}}
\DoxyCodeLine{00440 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_imp_p_d_x_aaa4f2fa0295c4cd543483faa39973ede}\label{class_imp_p_d_x_aaa4f2fa0295c4cd543483faa39973ede}} 
\index{ImpPDX@{ImpPDX}!setCurrentView@{setCurrentView}}
\index{setCurrentView@{setCurrentView}!ImpPDX@{ImpPDX}}
\doxysubsubsection{\texorpdfstring{setCurrentView()}{setCurrentView()}}
{\footnotesize\ttfamily void Imp\+PDX\+::set\+Current\+View (\begin{DoxyParamCaption}\item[{int}]{pos,  }\item[{int \&}]{new\+Low\+Pos,  }\item[{int \&}]{new\+Hi\+Pos }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_imp_p_d}{Imp\+PD}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00442                                                                   \{}
\DoxyCodeLine{00443   newLowPos = pos;}
\DoxyCodeLine{00444   newHiPos  = newLowPos + (m\_viewSize / m\_chunkSize);}
\DoxyCodeLine{00445 }
\DoxyCodeLine{00446   assert(m\_fd >= 0);}
\DoxyCodeLine{00447   \textcolor{keywordflow}{if} (m\_fileMapAddress)  \textcolor{comment}{// previous view...}}
\DoxyCodeLine{00448     \textcolor{keywordflow}{if} (munmap(m\_fileMapAddress, m\_viewSize) != 0)}
\DoxyCodeLine{00449       \textcolor{keywordflow}{throw} TCachedLevelException(errno);}
\DoxyCodeLine{00450   \textcolor{keywordtype}{void} *start       = 0;}
\DoxyCodeLine{00451   \textcolor{keywordtype}{int} flags         = MAP\_SHARED;}
\DoxyCodeLine{00452   \textcolor{keywordtype}{size\_t} viewOffset = ((newLowPos * m\_chunkSize) / m\_pageSize) * m\_pageSize;}
\DoxyCodeLine{00453   m\_mapOffset       = newLowPos * m\_chunkSize -\/ viewOffset;}
\DoxyCodeLine{00454 }
\DoxyCodeLine{00455   assert(!\textcolor{stringliteral}{"{}controllare le dimensioni"{}});}
\DoxyCodeLine{00456   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} lastByte =}
\DoxyCodeLine{00457       (\textcolor{keywordtype}{unsigned} long)(((newHiPos * m\_chunkSize) / (\textcolor{keywordtype}{double})m\_pageSize + 0.5) *}
\DoxyCodeLine{00458                       m\_pageSize);}
\DoxyCodeLine{00459 }
\DoxyCodeLine{00460   \textcolor{keywordflow}{if} (lastByte > m\_currentFileSize)  \textcolor{comment}{// devo riallocare!}}
\DoxyCodeLine{00461   \{}
\DoxyCodeLine{00462     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bu =}
\DoxyCodeLine{00463         (\textcolor{keywordtype}{unsigned} long)((lastByte / (\textcolor{keywordtype}{double})m\_reallocSize + 0.5) *}
\DoxyCodeLine{00464                         m\_reallocSize);}
\DoxyCodeLine{00465     bu = (\textcolor{keywordtype}{unsigned} long)((bu / (\textcolor{keywordtype}{double})m\_pageSize + 0.5) * m\_pageSize);}
\DoxyCodeLine{00466     \textcolor{comment}{// m\_maxFileSize = tmax(m\_maxFileSize + m\_reallocFileSize, lastByte);}}
\DoxyCodeLine{00467     m\_currentFileSize += bu;}
\DoxyCodeLine{00468 }
\DoxyCodeLine{00469     std::cout << \textcolor{stringliteral}{"{}new cache size "{}} << m\_currentFileSize << std::endl;}
\DoxyCodeLine{00470     \textcolor{keywordflow}{if} (lseek(m\_fd, m\_currentFileSize, SEEK\_SET) == -\/1)}
\DoxyCodeLine{00471       \textcolor{keywordflow}{throw} TCachedLevelException(errno);}
\DoxyCodeLine{00472     \textcolor{keywordflow}{if} (write(m\_fd, \textcolor{stringliteral}{"{}"{}}, 1) == -\/1) \textcolor{keywordflow}{throw} TCachedLevelException(errno);}
\DoxyCodeLine{00473     \textcolor{keywordflow}{if} (ftruncate(m\_fd, m\_currentFileSize) == -\/1)}
\DoxyCodeLine{00474       \textcolor{keywordflow}{throw} TCachedLevelException(errno);}
\DoxyCodeLine{00475   \}}
\DoxyCodeLine{00476 }
\DoxyCodeLine{00477   m\_fileMapAddress =}
\DoxyCodeLine{00478       mmap(start, m\_viewSize, PROT\_READ | PROT\_WRITE, flags, m\_fd, viewOffset);}
\DoxyCodeLine{00479   \textcolor{keywordflow}{if} (m\_fileMapAddress == (\textcolor{keywordtype}{void} *)-\/1) \textcolor{keywordflow}{throw} TCachedLevelException(errno);}
\DoxyCodeLine{00480 \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/common/trasterimage/tcachedlevel.\+cpp\end{DoxyCompactItemize}
