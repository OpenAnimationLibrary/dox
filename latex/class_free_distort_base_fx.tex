\hypertarget{class_free_distort_base_fx}{}\doxysection{Free\+Distort\+Base\+Fx Class Reference}
\label{class_free_distort_base_fx}\index{FreeDistortBaseFx@{FreeDistortBaseFx}}
Inheritance diagram for Free\+Distort\+Base\+Fx\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=6.000000cm]{class_free_distort_base_fx}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_free_distort_base_fx_ae1d63b45ad7ef3ad1fcbd9a5120f5b49}{Free\+Distort\+Base\+Fx}} (bool is\+Cast\+Shadow)
\item 
bool \mbox{\hyperlink{class_free_distort_base_fx_abe097dd5c012a5c2d3625f2c7cb8b1e8}{do\+Get\+BBox}} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
void \mbox{\hyperlink{class_free_distort_base_fx_ac3a54859740090da036bb51090e9956b}{do\+Compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&ri) override
\item 
void \mbox{\hyperlink{class_free_distort_base_fx_ad8535b2f6559d5915f71b86c5ed14576}{do\+Dry\+Compute}} (\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&ri) override
\item 
\mbox{\Hypertarget{class_free_distort_base_fx_a962b41fcd29e2d0af575953b0a2b575d}\label{class_free_distort_base_fx_a962b41fcd29e2d0af575953b0a2b575d}} 
void {\bfseries on\+Port\+Connected} (\mbox{\hyperlink{class_t_fx_port}{TFx\+Port}} $\ast$port)
\item 
bool \mbox{\hyperlink{class_free_distort_base_fx_aa9e95f0e68da9a42aa44f1a1e31fbc98}{can\+Handle}} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame) override
\item 
int \mbox{\hyperlink{class_free_distort_base_fx_a3767c7c4eeca091bb9d5a4d32fcded03}{get\+Memory\+Requirement}} (const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
void \mbox{\hyperlink{class_free_distort_base_fx_a1d9947b75e7eb6164ab4640ca320bd91}{transform}} (double frame, int port, const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect\+On\+Output, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info\+On\+Output, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect\+On\+Input, \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info\+On\+Input) override
\item 
void \mbox{\hyperlink{class_free_distort_base_fx_a9f9db41293b8a573675b8422f0399c41}{safe\+Transform}} (double frame, int port, const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect\+On\+Output, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info\+On\+Output, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect\+On\+Input, \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info\+On\+Input, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&in\+BBox)
\item 
void \mbox{\hyperlink{class_free_distort_base_fx_a63c5a3bdbc538b39ee0fe312d5e8e06e}{get\+Param\+UIs}} (\mbox{\hyperlink{class_t_param_u_i_concept}{TParam\+UIConcept}} $\ast$\&concepts, int \&length) override
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_free_distort_base_fx_ae1d63b45ad7ef3ad1fcbd9a5120f5b49}\label{class_free_distort_base_fx_ae1d63b45ad7ef3ad1fcbd9a5120f5b49}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{FreeDistortBaseFx()}{FreeDistortBaseFx()}}
{\footnotesize\ttfamily Free\+Distort\+Base\+Fx\+::\+Free\+Distort\+Base\+Fx (\begin{DoxyParamCaption}\item[{bool}]{is\+Cast\+Shadow }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00094     : m\_deactivate(\textcolor{keyword}{false})}
\DoxyCodeLine{00095     , m\_color(TPixel32::Black)}
\DoxyCodeLine{00096     , m\_fade(0.0)}
\DoxyCodeLine{00097     , m\_upTransp(0.0)}
\DoxyCodeLine{00098     , m\_downTransp(0.0)}
\DoxyCodeLine{00099     , m\_upBlur(0.0)}
\DoxyCodeLine{00100     , m\_downBlur(0.0)}
\DoxyCodeLine{00101     , m\_isCastShadow(isCastShadow)}
\DoxyCodeLine{00102     , m\_distortType(\textcolor{keyword}{new} \mbox{\hyperlink{class_t_enum_param}{TIntEnumParam}}(PERSPECTIVE, \textcolor{stringliteral}{"{}Perspective"{}})) \{}
\DoxyCodeLine{00103   m\_upBlur-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00104   m\_downBlur-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00105   \textcolor{keywordtype}{double} ext = 400.;}
\DoxyCodeLine{00106   \textcolor{keywordtype}{double} inn = 400.;}
\DoxyCodeLine{00107   m\_p00\_a    = \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/ext, -\/ext);}
\DoxyCodeLine{00108   m\_p00\_b    = \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/inn, -\/inn);}
\DoxyCodeLine{00109 }
\DoxyCodeLine{00110   m\_p01\_a = \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/ext, ext);}
\DoxyCodeLine{00111   m\_p01\_b = \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/inn, inn);}
\DoxyCodeLine{00112 }
\DoxyCodeLine{00113   m\_p11\_a = \mbox{\hyperlink{class_t_point_t}{TPointD}}(ext, ext);}
\DoxyCodeLine{00114   m\_p11\_b = \mbox{\hyperlink{class_t_point_t}{TPointD}}(inn, inn);}
\DoxyCodeLine{00115 }
\DoxyCodeLine{00116   m\_p10\_a = \mbox{\hyperlink{class_t_point_t}{TPointD}}(ext, -\/ext);}
\DoxyCodeLine{00117   m\_p10\_b = \mbox{\hyperlink{class_t_point_t}{TPointD}}(inn, -\/inn);}
\DoxyCodeLine{00118 }
\DoxyCodeLine{00119   m\_p00\_b-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00120   m\_p00\_b-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00121   m\_p10\_b-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00122   m\_p10\_b-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00123   m\_p01\_b-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00124   m\_p01\_b-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00125   m\_p11\_b-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00126   m\_p11\_b-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00127 }
\DoxyCodeLine{00128   m\_p00\_a-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00129   m\_p00\_a-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00130   m\_p10\_a-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00131   m\_p10\_a-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00132   m\_p01\_a-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00133   m\_p01\_a-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00134   m\_p11\_a-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00135   m\_p11\_a-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}distort\_type"{}}, m\_distortType);}
\DoxyCodeLine{00138 }
\DoxyCodeLine{00139   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}bottom\_left\_b"{}}, m\_p00\_b);}
\DoxyCodeLine{00140   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}bottom\_right\_b"{}}, m\_p10\_b);}
\DoxyCodeLine{00141   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}top\_left\_b"{}}, m\_p01\_b);}
\DoxyCodeLine{00142   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}top\_right\_b"{}}, m\_p11\_b);}
\DoxyCodeLine{00143 }
\DoxyCodeLine{00144   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}bottom\_left\_a"{}}, m\_p00\_a);}
\DoxyCodeLine{00145   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}bottom\_right\_a"{}}, m\_p10\_a);}
\DoxyCodeLine{00146   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}top\_left\_a"{}}, m\_p01\_a);}
\DoxyCodeLine{00147   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}top\_right\_a"{}}, m\_p11\_a);}
\DoxyCodeLine{00148 }
\DoxyCodeLine{00149   \textcolor{keywordflow}{if} (isCastShadow) \{}
\DoxyCodeLine{00150     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}color"{}}, m\_color);}
\DoxyCodeLine{00151     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}fade"{}}, m\_fade);}
\DoxyCodeLine{00152     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}up\_transp"{}}, m\_upTransp);}
\DoxyCodeLine{00153     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}down\_transp"{}}, m\_downTransp);}
\DoxyCodeLine{00154     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}up\_blur"{}}, m\_upBlur);}
\DoxyCodeLine{00155     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}down\_blur"{}}, m\_downBlur);}
\DoxyCodeLine{00156 }
\DoxyCodeLine{00157     m\_color-\/>enableMatte(\textcolor{keyword}{false});}
\DoxyCodeLine{00158     m\_fade-\/>setValueRange(0.0, 100.0);}
\DoxyCodeLine{00159     m\_upTransp-\/>setValueRange(0.0, 100.0);}
\DoxyCodeLine{00160     m\_downTransp-\/>setValueRange(0.0, 100.0);}
\DoxyCodeLine{00161     m\_upBlur-\/>setValueRange(0.0, (std::numeric\_limits<double>::max)());}
\DoxyCodeLine{00162     m\_downBlur-\/>setValueRange(0.0, (std::numeric\_limits<double>::max)());}
\DoxyCodeLine{00163   \}}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}deactivate"{}}, m\_deactivate);}
\DoxyCodeLine{00166   \mbox{\hyperlink{class_t_fx_af0ccf8d65934ed9f7a62d3b45ee5f2b6}{addInputPort}}(\textcolor{stringliteral}{"{}source"{}}, m\_input);}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168   m\_p00\_a-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00169   m\_p00\_b-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00170 }
\DoxyCodeLine{00171   m\_p00\_a-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00172   m\_p00\_b-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00173 }
\DoxyCodeLine{00174   m\_p01\_a-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00175   m\_p01\_b-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00176 }
\DoxyCodeLine{00177   m\_p01\_a-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00178   m\_p01\_b-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00179 }
\DoxyCodeLine{00180   m\_p11\_a-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00181   m\_p11\_b-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00182 }
\DoxyCodeLine{00183   m\_p11\_a-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00184   m\_p11\_b-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00185 }
\DoxyCodeLine{00186   m\_p10\_a-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00187   m\_p10\_b-\/>getX()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00188 }
\DoxyCodeLine{00189   m\_p10\_a-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00190   m\_p10\_b-\/>getY()-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00191 }
\DoxyCodeLine{00192   m\_distortType-\/>addItem(BILINEAR, \textcolor{stringliteral}{"{}Bilinear"{}});}
\DoxyCodeLine{00193 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_free_distort_base_fx_a04163d741b6357573d8cffd13fdcbc43}\label{class_free_distort_base_fx_a04163d741b6357573d8cffd13fdcbc43}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!````~FreeDistortBaseFx@{$\sim$FreeDistortBaseFx}}
\index{````~FreeDistortBaseFx@{$\sim$FreeDistortBaseFx}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{$\sim$FreeDistortBaseFx()}{~FreeDistortBaseFx()}}
{\footnotesize\ttfamily Free\+Distort\+Base\+Fx\+::$\sim$\+Free\+Distort\+Base\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00197 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_free_distort_base_fx_aa9e95f0e68da9a42aa44f1a1e31fbc98}\label{class_free_distort_base_fx_aa9e95f0e68da9a42aa44f1a1e31fbc98}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!canHandle@{canHandle}}
\index{canHandle@{canHandle}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{canHandle()}{canHandle()}}
{\footnotesize\ttfamily bool Free\+Distort\+Base\+Fx\+::can\+Handle (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00201                                                                            \{}
\DoxyCodeLine{00202   \textcolor{comment}{// Blurs cant deal with anisotropic affines, so these are retained above}}
\DoxyCodeLine{00203   \textcolor{keywordflow}{return} m\_upBlur-\/>getValue(frame) == 0 \&\& m\_downBlur-\/>getValue(frame) == 0;}
\DoxyCodeLine{00204 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_free_distort_base_fx_ac3a54859740090da036bb51090e9956b}\label{class_free_distort_base_fx_ac3a54859740090da036bb51090e9956b}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!doCompute@{doCompute}}
\index{doCompute@{doCompute}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{doCompute()}{doCompute()}}
{\footnotesize\ttfamily void Free\+Distort\+Base\+Fx\+::do\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{ri }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00673                                                              \{}
\DoxyCodeLine{00674   \textcolor{keywordflow}{if} (!m\_input.isConnected()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00675 }
\DoxyCodeLine{00676   \textcolor{comment}{// Upon deactivation, this fx does nothing.}}
\DoxyCodeLine{00677   \textcolor{keywordflow}{if} (m\_deactivate-\/>getValue()) \{}
\DoxyCodeLine{00678     m\_input-\/>compute(tile, frame, ri);}
\DoxyCodeLine{00679     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00680   \}}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682   \textcolor{comment}{// Get the source quad}}
\DoxyCodeLine{00683   \mbox{\hyperlink{class_t_point_t}{TPointD}} p00\_b = m\_p00\_b-\/>getValue(frame);}
\DoxyCodeLine{00684   \mbox{\hyperlink{class_t_point_t}{TPointD}} p10\_b = m\_p10\_b-\/>getValue(frame);}
\DoxyCodeLine{00685   \mbox{\hyperlink{class_t_point_t}{TPointD}} p01\_b = m\_p01\_b-\/>getValue(frame);}
\DoxyCodeLine{00686   \mbox{\hyperlink{class_t_point_t}{TPointD}} p11\_b = m\_p11\_b-\/>getValue(frame);}
\DoxyCodeLine{00687 }
\DoxyCodeLine{00688   \textcolor{comment}{// Get destination quad}}
\DoxyCodeLine{00689   \mbox{\hyperlink{class_t_point_t}{TPointD}} p00\_a = m\_p00\_a-\/>getValue(frame);}
\DoxyCodeLine{00690   \mbox{\hyperlink{class_t_point_t}{TPointD}} p10\_a = m\_p10\_a-\/>getValue(frame);}
\DoxyCodeLine{00691   \mbox{\hyperlink{class_t_point_t}{TPointD}} p01\_a = m\_p01\_a-\/>getValue(frame);}
\DoxyCodeLine{00692   \mbox{\hyperlink{class_t_point_t}{TPointD}} p11\_a = m\_p11\_a-\/>getValue(frame);}
\DoxyCodeLine{00693 }
\DoxyCodeLine{00694   \textcolor{keywordflow}{if} (m\_isCastShadow) \{}
\DoxyCodeLine{00695     \textcolor{comment}{// Shadows are mirrored}}
\DoxyCodeLine{00696     std::swap(p00\_a, p01\_a);}
\DoxyCodeLine{00697     std::swap(p10\_a, p11\_a);}
\DoxyCodeLine{00698   \}}
\DoxyCodeLine{00699 }
\DoxyCodeLine{00700   \textcolor{comment}{// Get requested tile's geometry}}
\DoxyCodeLine{00701   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} tileRas(tile.getRaster());}
\DoxyCodeLine{00702   \mbox{\hyperlink{class_t_rect_t}{TRectD}} tileRect(convert(tileRas-\/>getBounds()) + tile.m\_pos);}
\DoxyCodeLine{00703 }
\DoxyCodeLine{00704   \textcolor{comment}{// Call transform to get the minimal rectOnInput}}
\DoxyCodeLine{00705   \mbox{\hyperlink{class_t_rect_t}{TRectD}} inRect;}
\DoxyCodeLine{00706   \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} riNew;}
\DoxyCodeLine{00707   \mbox{\hyperlink{class_t_rect_t}{TRectD}} inBBox;}
\DoxyCodeLine{00708 }
\DoxyCodeLine{00709   safeTransform(frame, 0, tileRect, ri, inRect, riNew, inBBox);}
\DoxyCodeLine{00710 }
\DoxyCodeLine{00711   \textcolor{comment}{// Intersect with the bbox}}
\DoxyCodeLine{00712   inRect *= inBBox;}
\DoxyCodeLine{00713 }
\DoxyCodeLine{00714   \textcolor{keywordflow}{if} (myIsEmpty(inRect)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00715 }
\DoxyCodeLine{00716   \textcolor{keywordtype}{double} scale = ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}}.a11;}
\DoxyCodeLine{00717 }
\DoxyCodeLine{00718   \textcolor{keywordtype}{double} downBlur = m\_downBlur-\/>getValue(frame) * scale;}
\DoxyCodeLine{00719   \textcolor{keywordtype}{double} upBlur   = m\_upBlur-\/>getValue(frame) * scale;}
\DoxyCodeLine{00720   \textcolor{keywordtype}{int} brad        = tceil(std::max(downBlur, upBlur));}
\DoxyCodeLine{00721 }
\DoxyCodeLine{00722   inRect = inRect.enlarge(brad);}
\DoxyCodeLine{00723 }
\DoxyCodeLine{00724   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} inRectSize(tceil(inRect.getLx()), tceil(inRect.getLy()));}
\DoxyCodeLine{00725 }
\DoxyCodeLine{00726   \mbox{\hyperlink{class_t_tile}{TTile}} inTile;}
\DoxyCodeLine{00727   m\_input-\/>allocateAndCompute(inTile, inRect.getP00(), inRectSize, tileRas,}
\DoxyCodeLine{00728                               frame, riNew);}
\DoxyCodeLine{00729 }
\DoxyCodeLine{00730   \mbox{\hyperlink{class_t_point_t}{TPointD}} inTilePosRi = inTile.m\_pos;}
\DoxyCodeLine{00731 }
\DoxyCodeLine{00732   \textcolor{comment}{// Update quads by the scale factors}}
\DoxyCodeLine{00733   p00\_b = riNew.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p00\_b;}
\DoxyCodeLine{00734   p10\_b = riNew.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p10\_b;}
\DoxyCodeLine{00735   p01\_b = riNew.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p01\_b;}
\DoxyCodeLine{00736   p11\_b = riNew.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p11\_b;}
\DoxyCodeLine{00737 }
\DoxyCodeLine{00738   p00\_a = ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p00\_a;}
\DoxyCodeLine{00739   p10\_a = ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p10\_a;}
\DoxyCodeLine{00740   p01\_a = ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p01\_a;}
\DoxyCodeLine{00741   p11\_a = ri.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p11\_a;}
\DoxyCodeLine{00742 }
\DoxyCodeLine{00743   \mbox{\hyperlink{class_perspective_distorter}{PerspectiveDistorter}} perpDistorter(p00\_b -\/ inTile.m\_pos, p10\_b -\/ inTile.m\_pos,}
\DoxyCodeLine{00744                                      p01\_b -\/ inTile.m\_pos, p11\_b -\/ inTile.m\_pos,}
\DoxyCodeLine{00745                                      p00\_a, p10\_a, p01\_a, p11\_a);}
\DoxyCodeLine{00746 }
\DoxyCodeLine{00747   \mbox{\hyperlink{class_bilinear_distorter}{BilinearDistorter}} bilDistorter(p00\_b -\/ inTile.m\_pos, p10\_b -\/ inTile.m\_pos,}
\DoxyCodeLine{00748                                  p01\_b -\/ inTile.m\_pos, p11\_b -\/ inTile.m\_pos,}
\DoxyCodeLine{00749                                  p00\_a, p10\_a, p01\_a, p11\_a);}
\DoxyCodeLine{00750 }
\DoxyCodeLine{00751   \mbox{\hyperlink{class_t_quad_distorter}{TQuadDistorter}} *distorter;}
\DoxyCodeLine{00752   \textcolor{keywordflow}{if} (m\_distortType-\/>getValue() == PERSPECTIVE)}
\DoxyCodeLine{00753     distorter = \&perpDistorter;}
\DoxyCodeLine{00754   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_distortType-\/>getValue() == BILINEAR)}
\DoxyCodeLine{00755     distorter = \&bilDistorter;}
\DoxyCodeLine{00756   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00757     assert(0);}
\DoxyCodeLine{00758 }
\DoxyCodeLine{00759   \textcolor{keywordflow}{if} (m\_isCastShadow) \{}
\DoxyCodeLine{00760     \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32 = inTile.getRaster();}
\DoxyCodeLine{00761     \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} ras64 = inTile.getRaster();}
\DoxyCodeLine{00762 }
\DoxyCodeLine{00763     \textcolor{keywordflow}{if} (ras32) \{}
\DoxyCodeLine{00764       \textcolor{keywordflow}{if} (m\_fade-\/>getValue(frame) > 0)}
\DoxyCodeLine{00765         doFade(ras32, m\_color-\/>getValue(frame),}
\DoxyCodeLine{00766                m\_fade-\/>getValue(frame) / 100.0);}
\DoxyCodeLine{00767       \textcolor{keywordflow}{if} (brad > 0)}
\DoxyCodeLine{00768         doBlur(ras32, upBlur, downBlur, m\_upTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00769                m\_downTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00770                inBBox.y0 -\/ inTile.m\_pos.y, inBBox.y1 -\/ inTile.m\_pos.y);}
\DoxyCodeLine{00771       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_upTransp-\/>getValue(frame) > 0 ||}
\DoxyCodeLine{00772                m\_downTransp-\/>getValue(frame) > 0)}
\DoxyCodeLine{00773         doTransparency(ras32, m\_upTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00774                        m\_downTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00775                        inBBox.y0 -\/ inTile.m\_pos.y, inBBox.y1 -\/ inTile.m\_pos.y);}
\DoxyCodeLine{00776     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ras64) \{}
\DoxyCodeLine{00777       \textcolor{keywordflow}{if} (m\_fade-\/>getValue(frame) > 0)}
\DoxyCodeLine{00778         doFade(ras64, toPixel64(m\_color-\/>getValue(frame)),}
\DoxyCodeLine{00779                m\_fade-\/>getValue(frame) / 100.0);}
\DoxyCodeLine{00780       \textcolor{keywordflow}{if} (brad > 0)}
\DoxyCodeLine{00781         doBlur(ras64, upBlur, downBlur, m\_upTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00782                m\_downTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00783                inBBox.y0 -\/ inTile.m\_pos.y, inBBox.y1 -\/ inTile.m\_pos.y);}
\DoxyCodeLine{00784       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_upTransp-\/>getValue(frame) > 0 ||}
\DoxyCodeLine{00785                m\_downTransp-\/>getValue(frame) > 0)}
\DoxyCodeLine{00786         doTransparency(ras64, m\_upTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00787                        m\_downTransp-\/>getValue(frame) / 100.0,}
\DoxyCodeLine{00788                        inBBox.y0 -\/ inTile.m\_pos.y, inBBox.y1 -\/ inTile.m\_pos.y);}
\DoxyCodeLine{00789     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00790       assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00791   \}}
\DoxyCodeLine{00792 }
\DoxyCodeLine{00793   distort(tileRas, inTile.getRaster(), *distorter, convert(tile.m\_pos),}
\DoxyCodeLine{00794           \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a152d46ac03e804c799ed08f703eeeb4e}{TRop::Bilinear}});}
\DoxyCodeLine{00795 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_free_distort_base_fx_ad8535b2f6559d5915f71b86c5ed14576}\label{class_free_distort_base_fx_ad8535b2f6559d5915f71b86c5ed14576}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!doDryCompute@{doDryCompute}}
\index{doDryCompute@{doDryCompute}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{doDryCompute()}{doDryCompute()}}
{\footnotesize\ttfamily void Free\+Distort\+Base\+Fx\+::do\+Dry\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Declares the computation scheme of this fx for rendering optimization purposes. This is an important function of the Toonz rendering API, and should be reimplemented with the necessary care. The Toonz rendering process makes use of this function to enact most of the optimization steps about the fx computation, in particular fx caching. A correct implementation of this method should follow these rules\+:  The invocation of child node computations should be faithfully reproduced.  TRaster\+Fx\+::compute and TRaster\+Fx\+::allocate\+And\+Compute calls have to be translated to TRaster\+Fx\+::dry\+Compute calls.  This fx is intended for precomputation stage, so the hard rendering code should be skipped here. By default, this method raises a dry\+Compute call to each input port in increasing order, using the TRaster\+Fx\+::transform method to identify the tiles to be passed on input precomputation. 

Reimplemented from \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00650                                                                   \{}
\DoxyCodeLine{00651   \textcolor{keywordflow}{if} (!m\_input.isConnected()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00652 }
\DoxyCodeLine{00653   \textcolor{keywordflow}{if} (m\_deactivate-\/>getValue()) \{}
\DoxyCodeLine{00654     m\_input-\/>dryCompute(rect, frame, info);}
\DoxyCodeLine{00655     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00656   \}}
\DoxyCodeLine{00657 }
\DoxyCodeLine{00658   \mbox{\hyperlink{class_t_rect_t}{TRectD}} rectOnInput;}
\DoxyCodeLine{00659   \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} infoOnInput;}
\DoxyCodeLine{00660   \mbox{\hyperlink{class_t_rect_t}{TRectD}} inBBox;}
\DoxyCodeLine{00661 }
\DoxyCodeLine{00662   safeTransform(frame, 0, rect, info, rectOnInput, infoOnInput, inBBox);}
\DoxyCodeLine{00663 }
\DoxyCodeLine{00664   rectOnInput *= inBBox;}
\DoxyCodeLine{00665 }
\DoxyCodeLine{00666   \textcolor{keywordflow}{if} (!myIsEmpty(rectOnInput))}
\DoxyCodeLine{00667     m\_input-\/>dryCompute(rectOnInput, frame, infoOnInput);}
\DoxyCodeLine{00668 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_free_distort_base_fx_abe097dd5c012a5c2d3625f2c7cb8b1e8}\label{class_free_distort_base_fx_abe097dd5c012a5c2d3625f2c7cb8b1e8}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!doGetBBox@{doGetBBox}}
\index{doGetBBox@{doGetBBox}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{doGetBBox()}{doGetBBox()}}
{\footnotesize\ttfamily bool Free\+Distort\+Base\+Fx\+::do\+Get\+BBox (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{b\+Box,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00209                                                                \{}
\DoxyCodeLine{00210   \textcolor{keywordflow}{if} (m\_input.isConnected()) \{}
\DoxyCodeLine{00211     \textcolor{comment}{// We'll treat this fx like a zerary one. The idea is, since}}
\DoxyCodeLine{00212     \textcolor{comment}{// the task of taking images and pre-\/images of rects through}}
\DoxyCodeLine{00213     \textcolor{comment}{// these kind of distortions is definitely non-\/trivial, we'll}}
\DoxyCodeLine{00214     \textcolor{comment}{// simply avoid doing so...}}
\DoxyCodeLine{00215     bBox = TConsts::infiniteRectD;}
\DoxyCodeLine{00216     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00217 }
\DoxyCodeLine{00218     \textcolor{comment}{/*}}
\DoxyCodeLine{00219 \textcolor{comment}{bool ret = m\_input-\/>doGetBBox(frame, bBox);}}
\DoxyCodeLine{00220 \textcolor{comment}{}}
\DoxyCodeLine{00221 \textcolor{comment}{if(m\_deactivate-\/>getValue())}}
\DoxyCodeLine{00222 \textcolor{comment}{return ret;}}
\DoxyCodeLine{00223 \textcolor{comment}{}}
\DoxyCodeLine{00224 \textcolor{comment}{TPointD p00\_a = m\_p00\_a-\/>getValue(frame);}}
\DoxyCodeLine{00225 \textcolor{comment}{TPointD p00\_b = m\_p00\_b-\/>getValue(frame);}}
\DoxyCodeLine{00226 \textcolor{comment}{TPointD p10\_a = m\_p10\_a-\/>getValue(frame);}}
\DoxyCodeLine{00227 \textcolor{comment}{TPointD p10\_b = m\_p10\_b-\/>getValue(frame);}}
\DoxyCodeLine{00228 \textcolor{comment}{TPointD p01\_a = m\_p01\_a-\/>getValue(frame);}}
\DoxyCodeLine{00229 \textcolor{comment}{TPointD p01\_b = m\_p01\_b-\/>getValue(frame);}}
\DoxyCodeLine{00230 \textcolor{comment}{TPointD p11\_a = m\_p11\_a-\/>getValue(frame);}}
\DoxyCodeLine{00231 \textcolor{comment}{TPointD p11\_b = m\_p11\_b-\/>getValue(frame);}}
\DoxyCodeLine{00232 \textcolor{comment}{}}
\DoxyCodeLine{00233 \textcolor{comment}{    if (m\_isCastShadow)}}
\DoxyCodeLine{00234 \textcolor{comment}{\{}}
\DoxyCodeLine{00235 \textcolor{comment}{            std::swap(p00\_a, p01\_a);}}
\DoxyCodeLine{00236 \textcolor{comment}{std::swap(p10\_a, p11\_a);}}
\DoxyCodeLine{00237 \textcolor{comment}{    \}*/}}
\DoxyCodeLine{00238 }
\DoxyCodeLine{00239     \textcolor{comment}{/*TRectD source;}}
\DoxyCodeLine{00240 \textcolor{comment}{source.x0 = std::min(p00\_b.x, p10\_b.x, p01\_b.x, p11\_b.x);}}
\DoxyCodeLine{00241 \textcolor{comment}{source.y0 = std::min(p00\_b.y, p10\_b.y, p01\_b.y, p11\_b.y);}}
\DoxyCodeLine{00242 \textcolor{comment}{source.x1 = std::max(p00\_b.x, p10\_b.x, p01\_b.x, p11\_b.x);}}
\DoxyCodeLine{00243 \textcolor{comment}{source.y1 = std::max(p00\_b.y, p10\_b.y, p01\_b.y, p11\_b.y);}}
\DoxyCodeLine{00244 \textcolor{comment}{bBox *= source;}}
\DoxyCodeLine{00245 \textcolor{comment}{}}
\DoxyCodeLine{00246 \textcolor{comment}{int distortType = m\_distortType-\/>getValue();}}
\DoxyCodeLine{00247 \textcolor{comment}{if(distortType == PERSPECTIVE)}}
\DoxyCodeLine{00248 \textcolor{comment}{\{}}
\DoxyCodeLine{00249 \textcolor{comment}{PerspectiveDistorter distorter(}}
\DoxyCodeLine{00250 \textcolor{comment}{p00\_b, p10\_b, p01\_b, p11\_b,}}
\DoxyCodeLine{00251 \textcolor{comment}{p00\_a, p10\_a, p01\_a, p11\_a}}
\DoxyCodeLine{00252 \textcolor{comment}{);}}
\DoxyCodeLine{00253 \textcolor{comment}{bBox = distorter.map(bBox);}}
\DoxyCodeLine{00254 \textcolor{comment}{\}}}
\DoxyCodeLine{00255 \textcolor{comment}{else if(distortType == BILINEAR)}}
\DoxyCodeLine{00256 \textcolor{comment}{\{}}
\DoxyCodeLine{00257 \textcolor{comment}{BilinearDistorter distorter(}}
\DoxyCodeLine{00258 \textcolor{comment}{p00\_b, p10\_b, p01\_b, p11\_b,}}
\DoxyCodeLine{00259 \textcolor{comment}{p00\_a, p10\_a, p01\_a, p11\_a}}
\DoxyCodeLine{00260 \textcolor{comment}{);}}
\DoxyCodeLine{00261 \textcolor{comment}{bBox = distorter.map(bBox);}}
\DoxyCodeLine{00262 \textcolor{comment}{\}}}
\DoxyCodeLine{00263 \textcolor{comment}{else assert(0);*/}}
\DoxyCodeLine{00264 }
\DoxyCodeLine{00265     \textcolor{comment}{// Further, we will also avoid the assumption that the bbox}}
\DoxyCodeLine{00266     \textcolor{comment}{// is defined by that of destination points...}}
\DoxyCodeLine{00267     \textcolor{comment}{/*TRectD result;}}
\DoxyCodeLine{00268 \textcolor{comment}{result.x0 = std::min(p00\_a.x, p10\_a.x, p01\_a.x, p11\_a.x);}}
\DoxyCodeLine{00269 \textcolor{comment}{result.y0 = std::min(p00\_a.y, p10\_a.y, p01\_a.y, p11\_a.y);}}
\DoxyCodeLine{00270 \textcolor{comment}{result.x1 = std::max(p00\_a.x, p10\_a.x, p01\_a.x, p11\_a.x);}}
\DoxyCodeLine{00271 \textcolor{comment}{result.y1 = std::max(p00\_a.y, p10\_a.y, p01\_a.y, p11\_a.y);}}
\DoxyCodeLine{00272 \textcolor{comment}{bBox = result;    //bBox *= result;*/}}
\DoxyCodeLine{00273   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00274     bBox = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00275     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00276   \}}
\DoxyCodeLine{00277 }
\DoxyCodeLine{00278   \textcolor{keywordflow}{if} (m\_upBlur-\/>getValue(frame) > 0 || m\_downBlur-\/>getValue(frame) > 0) \{}
\DoxyCodeLine{00279     \textcolor{keywordtype}{int} brad = std::max((\textcolor{keywordtype}{int})m\_upBlur-\/>getValue(frame),}
\DoxyCodeLine{00280                         (\textcolor{keywordtype}{int})m\_downBlur-\/>getValue(frame));}
\DoxyCodeLine{00281     bBox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} -\/= brad;}
\DoxyCodeLine{00282     bBox.x1 += brad;}
\DoxyCodeLine{00283     bBox.y0 -\/= brad;}
\DoxyCodeLine{00284     bBox.y1 += brad;}
\DoxyCodeLine{00285   \}}
\DoxyCodeLine{00286 }
\DoxyCodeLine{00287   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00288 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_free_distort_base_fx_a3767c7c4eeca091bb9d5a4d32fcded03}\label{class_free_distort_base_fx_a3767c7c4eeca091bb9d5a4d32fcded03}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!getMemoryRequirement@{getMemoryRequirement}}
\index{getMemoryRequirement@{getMemoryRequirement}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{getMemoryRequirement()}{getMemoryRequirement()}}
{\footnotesize\ttfamily int Free\+Distort\+Base\+Fx\+::get\+Memory\+Requirement (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Specifies the approximate size (in Mega\+Bytes) of the maximum allocation instance that this fx will need to perform in order to render the passed input. This method should be reimplemented in order to make the Toonz rendering process aware of the use of big raster memory chunks, at least. Observe that the passed tile geometry is implicitly {\itshape  already allocated \texorpdfstring{$<$}{<}\textbackslash{}i\texorpdfstring{$>$}{>} for the fx output. ~\newline
The default implementation returns 0, assuming that the passed implicit memory size is passed below in node computation without further allocation of resources. Fxs can reimplement this to -\/1 to explicitly disable the Toonz\textquotesingle{}s smart memory handling. ~\newline
 ~\newline
\begin{DoxyNote}{Note}
The rendering process ensures that the passed render settings are {\itshape handled} by the fx before this function is invoked -\/ do not waste code for it. 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRaster\+Fx\+::memory\+Size}} and TRaster\+Fx\+::can\+Handle methods. 
\end{DoxySeeAlso}
}

Reimplemented from \mbox{\hyperlink{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00800                                                                          \{}
\DoxyCodeLine{00801   \textcolor{keywordflow}{if} (!m\_input.isConnected()) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00802 }
\DoxyCodeLine{00803   \mbox{\hyperlink{class_t_rect_t}{TRectD}} inRect;}
\DoxyCodeLine{00804   \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} riNew;}
\DoxyCodeLine{00805   \mbox{\hyperlink{class_t_rect_t}{TRectD}} inBBox;}
\DoxyCodeLine{00806   safeTransform(frame, 0, rect, info, inRect, riNew, inBBox);}
\DoxyCodeLine{00807   inRect *= inBBox;}
\DoxyCodeLine{00808 }
\DoxyCodeLine{00809   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRasterFx::memorySize}}(inRect, riNew.\mbox{\hyperlink{class_t_render_settings_a9489ed9d21a047b29cc5dd285f1f6f19}{m\_bpp}});}
\DoxyCodeLine{00810 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00116}{TRender\+Settings\+::m\+\_\+bpp}}, and \mbox{\hyperlink{l00560}{TRaster\+Fx\+::memory\+Size()}}.

\mbox{\Hypertarget{class_free_distort_base_fx_a63c5a3bdbc538b39ee0fe312d5e8e06e}\label{class_free_distort_base_fx_a63c5a3bdbc538b39ee0fe312d5e8e06e}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!getParamUIs@{getParamUIs}}
\index{getParamUIs@{getParamUIs}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{getParamUIs()}{getParamUIs()}}
{\footnotesize\ttfamily void Free\+Distort\+Base\+Fx\+::get\+Param\+UIs (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_param_u_i_concept}{TParam\+UIConcept}} $\ast$\&}]{params,  }\item[{int \&}]{length }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Returns a list of User Interface Concepts to be displayed when editing the fx parameters. \begin{DoxyNote}{Note}
Ownership of the returned array allocated with new\mbox{[}\mbox{]} is passed to callers. 
\end{DoxyNote}


Reimplemented from \mbox{\hyperlink{class_t_fx_a18766b107b77772d67c5678e7d832b18}{TFx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00417                                                                            \{}
\DoxyCodeLine{00418   concepts = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_param_u_i_concept}{TParamUIConcept}}[length = 6];}
\DoxyCodeLine{00419 }
\DoxyCodeLine{00420   concepts[0].\mbox{\hyperlink{class_t_param_u_i_concept_a2dbb7c954ca5f2441a6931945cf004a5}{m\_type}} = TParamUIConcept::QUAD;}
\DoxyCodeLine{00421   concepts[0].m\_params.push\_back(m\_p01\_b);}
\DoxyCodeLine{00422   concepts[0].m\_params.push\_back(m\_p11\_b);}
\DoxyCodeLine{00423   concepts[0].m\_params.push\_back(m\_p10\_b);}
\DoxyCodeLine{00424   concepts[0].m\_params.push\_back(m\_p00\_b);}
\DoxyCodeLine{00425   concepts[0].m\_label = \textcolor{stringliteral}{"{} Src"{}};}
\DoxyCodeLine{00426 }
\DoxyCodeLine{00427   concepts[1].m\_type = TParamUIConcept::QUAD;}
\DoxyCodeLine{00428   concepts[1].m\_params.push\_back(m\_p01\_a);}
\DoxyCodeLine{00429   concepts[1].m\_params.push\_back(m\_p11\_a);}
\DoxyCodeLine{00430   concepts[1].m\_params.push\_back(m\_p10\_a);}
\DoxyCodeLine{00431   concepts[1].m\_params.push\_back(m\_p00\_a);}
\DoxyCodeLine{00432   concepts[1].m\_label = \textcolor{stringliteral}{"{} Dst"{}};}
\DoxyCodeLine{00433 }
\DoxyCodeLine{00434   concepts[2].m\_type = TParamUIConcept::VECTOR;}
\DoxyCodeLine{00435   concepts[2].m\_params.push\_back(m\_p00\_b);}
\DoxyCodeLine{00436   concepts[2].m\_params.push\_back(m\_p00\_a);}
\DoxyCodeLine{00437 }
\DoxyCodeLine{00438   concepts[3].m\_type = TParamUIConcept::VECTOR;}
\DoxyCodeLine{00439   concepts[3].m\_params.push\_back(m\_p10\_b);}
\DoxyCodeLine{00440   concepts[3].m\_params.push\_back(m\_p10\_a);}
\DoxyCodeLine{00441 }
\DoxyCodeLine{00442   concepts[4].m\_type = TParamUIConcept::VECTOR;}
\DoxyCodeLine{00443   concepts[4].m\_params.push\_back(m\_p01\_b);}
\DoxyCodeLine{00444   concepts[4].m\_params.push\_back(m\_p01\_a);}
\DoxyCodeLine{00445 }
\DoxyCodeLine{00446   concepts[5].m\_type = TParamUIConcept::VECTOR;}
\DoxyCodeLine{00447   concepts[5].m\_params.push\_back(m\_p11\_b);}
\DoxyCodeLine{00448   concepts[5].m\_params.push\_back(m\_p11\_a);}
\DoxyCodeLine{00449 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00078}{TParam\+UIConcept\+::m\+\_\+label}}, \mbox{\hyperlink{l00079}{TParam\+UIConcept\+::m\+\_\+params}}, and \mbox{\hyperlink{l00077}{TParam\+UIConcept\+::m\+\_\+type}}.

\mbox{\Hypertarget{class_free_distort_base_fx_a9f9db41293b8a573675b8422f0399c41}\label{class_free_distort_base_fx_a9f9db41293b8a573675b8422f0399c41}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!safeTransform@{safeTransform}}
\index{safeTransform@{safeTransform}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{safeTransform()}{safeTransform()}}
{\footnotesize\ttfamily void Free\+Distort\+Base\+Fx\+::safe\+Transform (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{int}]{port,  }\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect\+On\+Output,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info\+On\+Output,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect\+On\+Input,  }\item[{\mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info\+On\+Input,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{in\+BBox }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00375                                                       \{}
\DoxyCodeLine{00376   assert(port == 0 \&\& m\_input.isConnected());}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378   \textcolor{keywordflow}{if} (m\_deactivate-\/>getValue()) \{}
\DoxyCodeLine{00379     infoOnInput = infoOnOutput;}
\DoxyCodeLine{00380     rectOnInput = rectOnOutput;}
\DoxyCodeLine{00381     m\_input-\/>getBBox(frame, inBBox, infoOnInput);}
\DoxyCodeLine{00382     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00383   \}}
\DoxyCodeLine{00384 }
\DoxyCodeLine{00385   \textcolor{comment}{// Avoid the singular matrix cases}}
\DoxyCodeLine{00386   \textcolor{keywordflow}{if} (fabs(infoOnOutput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}}.det()) < 1.e-\/3) \{}
\DoxyCodeLine{00387     infoOnInput = infoOnOutput;}
\DoxyCodeLine{00388     rectOnInput.empty();}
\DoxyCodeLine{00389     m\_input-\/>getBBox(frame, inBBox, infoOnInput);}
\DoxyCodeLine{00390     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00391   \}}
\DoxyCodeLine{00392 }
\DoxyCodeLine{00393   transform(frame, port, rectOnOutput, infoOnOutput, rectOnInput, infoOnInput);}
\DoxyCodeLine{00394 }
\DoxyCodeLine{00395   m\_input-\/>getBBox(frame, inBBox, infoOnInput);}
\DoxyCodeLine{00396 }
\DoxyCodeLine{00397   \textcolor{comment}{// In case inBBox is infinite, such as with gradients, also intersect with the}}
\DoxyCodeLine{00398   \textcolor{comment}{// input quadrilateral's bbox}}
\DoxyCodeLine{00399   \textcolor{keywordflow}{if} (inBBox == TConsts::infiniteRectD) \{}
\DoxyCodeLine{00400     \mbox{\hyperlink{class_t_point_t}{TPointD}} affP00\_b(infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * m\_p00\_b-\/>getValue(frame));}
\DoxyCodeLine{00401     \mbox{\hyperlink{class_t_point_t}{TPointD}} affP10\_b(infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * m\_p10\_b-\/>getValue(frame));}
\DoxyCodeLine{00402     \mbox{\hyperlink{class_t_point_t}{TPointD}} affP01\_b(infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * m\_p01\_b-\/>getValue(frame));}
\DoxyCodeLine{00403     \mbox{\hyperlink{class_t_point_t}{TPointD}} affP11\_b(infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * m\_p11\_b-\/>getValue(frame));}
\DoxyCodeLine{00404 }
\DoxyCodeLine{00405     \mbox{\hyperlink{class_t_rect_t}{TRectD}} source;}
\DoxyCodeLine{00406     source.x0 = std::min(\{affP00\_b.x, affP10\_b.x, affP01\_b.x, affP11\_b.x\});}
\DoxyCodeLine{00407     source.y0 = std::min(\{affP00\_b.y, affP10\_b.y, affP01\_b.y, affP11\_b.y\});}
\DoxyCodeLine{00408     source.x1 = std::max(\{affP00\_b.x, affP10\_b.x, affP01\_b.x, affP11\_b.x\});}
\DoxyCodeLine{00409     source.y1 = std::max(\{affP00\_b.y, affP10\_b.y, affP01\_b.y, affP11\_b.y\});}
\DoxyCodeLine{00410 }
\DoxyCodeLine{00411     rectOnInput *= source;}
\DoxyCodeLine{00412   \}}
\DoxyCodeLine{00413 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_free_distort_base_fx_a1d9947b75e7eb6164ab4640ca320bd91}\label{class_free_distort_base_fx_a1d9947b75e7eb6164ab4640ca320bd91}} 
\index{FreeDistortBaseFx@{FreeDistortBaseFx}!transform@{transform}}
\index{transform@{transform}!FreeDistortBaseFx@{FreeDistortBaseFx}}
\doxysubsubsection{\texorpdfstring{transform()}{transform()}}
{\footnotesize\ttfamily void Free\+Distort\+Base\+Fx\+::transform (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{int}]{port,  }\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect\+On\+Output,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info\+On\+Output,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect\+On\+Input,  }\item[{\mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info\+On\+Input }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00296                                                                 \{}
\DoxyCodeLine{00297   \mbox{\hyperlink{class_t_point_t}{TPointD}} p00\_b = m\_p00\_b-\/>getValue(frame);}
\DoxyCodeLine{00298   \mbox{\hyperlink{class_t_point_t}{TPointD}} p10\_b = m\_p10\_b-\/>getValue(frame);}
\DoxyCodeLine{00299   \mbox{\hyperlink{class_t_point_t}{TPointD}} p01\_b = m\_p01\_b-\/>getValue(frame);}
\DoxyCodeLine{00300   \mbox{\hyperlink{class_t_point_t}{TPointD}} p11\_b = m\_p11\_b-\/>getValue(frame);}
\DoxyCodeLine{00301 }
\DoxyCodeLine{00302   \mbox{\hyperlink{class_t_point_t}{TPointD}} p00\_a = m\_p00\_a-\/>getValue(frame);}
\DoxyCodeLine{00303   \mbox{\hyperlink{class_t_point_t}{TPointD}} p10\_a = m\_p10\_a-\/>getValue(frame);}
\DoxyCodeLine{00304   \mbox{\hyperlink{class_t_point_t}{TPointD}} p01\_a = m\_p01\_a-\/>getValue(frame);}
\DoxyCodeLine{00305   \mbox{\hyperlink{class_t_point_t}{TPointD}} p11\_a = m\_p11\_a-\/>getValue(frame);}
\DoxyCodeLine{00306 }
\DoxyCodeLine{00307   \textcolor{keywordflow}{if} (m\_isCastShadow) \{}
\DoxyCodeLine{00308     \textcolor{comment}{// Shadows are mirrored}}
\DoxyCodeLine{00309     std::swap(p00\_a, p01\_a);}
\DoxyCodeLine{00310     std::swap(p10\_a, p11\_a);}
\DoxyCodeLine{00311   \}}
\DoxyCodeLine{00312 }
\DoxyCodeLine{00313   \textcolor{comment}{// Build the input affine}}
\DoxyCodeLine{00314   infoOnInput = infoOnOutput;}
\DoxyCodeLine{00315 }
\DoxyCodeLine{00316   \textcolor{keywordtype}{double} scale = 0;}
\DoxyCodeLine{00317   scale        = std::max(scale, norm(p10\_a -\/ p00\_a) / norm(p10\_b -\/ p00\_b));}
\DoxyCodeLine{00318   scale        = std::max(scale, norm(p01\_a -\/ p00\_a) / norm(p01\_b -\/ p00\_b));}
\DoxyCodeLine{00319   scale        = std::max(scale, norm(p11\_a -\/ p10\_a) / norm(p11\_b -\/ p10\_b));}
\DoxyCodeLine{00320   scale        = std::max(scale, norm(p11\_a -\/ p01\_a) / norm(p11\_b -\/ p01\_b));}
\DoxyCodeLine{00321 }
\DoxyCodeLine{00322   scale *= sqrt(fabs(infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}}.det()));}
\DoxyCodeLine{00323 }
\DoxyCodeLine{00324   \textcolor{keywordflow}{if} (infoOnOutput.\mbox{\hyperlink{class_t_render_settings_a4903fdcd70fc5cc539133ac3d7c53316}{m\_isSwatch}}) \{}
\DoxyCodeLine{00325     \textcolor{comment}{// Swatch viewers work out a lite version of the distort: only contractions}}
\DoxyCodeLine{00326     \textcolor{comment}{// are passed below in the schematic -\/ so that input memory load is always}}
\DoxyCodeLine{00327     \textcolor{comment}{// at minimum.}}
\DoxyCodeLine{00328     \textcolor{comment}{// This is allowed in order to make fx adjusts the less frustrating as}}
\DoxyCodeLine{00329     \textcolor{comment}{// possible.}}
\DoxyCodeLine{00330     \textcolor{keywordflow}{if} (scale > 1) scale = 1;}
\DoxyCodeLine{00331   \}}
\DoxyCodeLine{00332 }
\DoxyCodeLine{00333   infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} = \mbox{\hyperlink{class_t_scale}{TScale}}(scale);}
\DoxyCodeLine{00334 }
\DoxyCodeLine{00335   \textcolor{comment}{// Build rectOnInput}}
\DoxyCodeLine{00336   p00\_a = infoOnOutput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p00\_a;}
\DoxyCodeLine{00337   p10\_a = infoOnOutput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p10\_a;}
\DoxyCodeLine{00338   p01\_a = infoOnOutput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p01\_a;}
\DoxyCodeLine{00339   p11\_a = infoOnOutput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p11\_a;}
\DoxyCodeLine{00340 }
\DoxyCodeLine{00341   p00\_b = infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p00\_b;}
\DoxyCodeLine{00342   p10\_b = infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p10\_b;}
\DoxyCodeLine{00343   p01\_b = infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p01\_b;}
\DoxyCodeLine{00344   p11\_b = infoOnInput.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}} * p11\_b;}
\DoxyCodeLine{00345 }
\DoxyCodeLine{00346   \textcolor{keywordflow}{if} (m\_distortType-\/>getValue() == PERSPECTIVE) \{}
\DoxyCodeLine{00347     \mbox{\hyperlink{class_perspective_distorter}{PerspectiveDistorter}} pd(p00\_b, p10\_b, p01\_b, p11\_b, p00\_a, p10\_a, p01\_a,}
\DoxyCodeLine{00348                             p11\_a);}
\DoxyCodeLine{00349 }
\DoxyCodeLine{00350     rectOnInput = ((\mbox{\hyperlink{class_t_quad_distorter}{TQuadDistorter}} *)\&pd)-\/>invMap(rectOnOutput);}
\DoxyCodeLine{00351   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00352     \mbox{\hyperlink{class_bilinear_distorter}{BilinearDistorter}} bd(p00\_b, p10\_b, p01\_b, p11\_b, p00\_a, p10\_a, p01\_a,}
\DoxyCodeLine{00353                          p11\_a);}
\DoxyCodeLine{00354 }
\DoxyCodeLine{00355     rectOnInput = ((\mbox{\hyperlink{class_t_quad_distorter}{TQuadDistorter}} *)\&bd)-\/>invMap(rectOnOutput);}
\DoxyCodeLine{00356   \}}
\DoxyCodeLine{00357 }
\DoxyCodeLine{00358   \textcolor{keywordflow}{if} (rectOnInput.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} != TConsts::infiniteRectD.x0)}
\DoxyCodeLine{00359     rectOnInput.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} = tfloor(rectOnInput.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}});}
\DoxyCodeLine{00360   \textcolor{keywordflow}{if} (rectOnInput.y0 != TConsts::infiniteRectD.y0)}
\DoxyCodeLine{00361     rectOnInput.y0 = tfloor(rectOnInput.y0);}
\DoxyCodeLine{00362   \textcolor{keywordflow}{if} (rectOnInput.x1 != TConsts::infiniteRectD.x1)}
\DoxyCodeLine{00363     rectOnInput.x1 = tceil(rectOnInput.x1);}
\DoxyCodeLine{00364   \textcolor{keywordflow}{if} (rectOnInput.y1 != TConsts::infiniteRectD.y1)}
\DoxyCodeLine{00365     rectOnInput.y1 = tceil(rectOnInput.y1);}
\DoxyCodeLine{00366 \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/freedistortfx.\+cpp\end{DoxyCompactItemize}
