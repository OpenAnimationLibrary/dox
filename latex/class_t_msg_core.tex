\hypertarget{class_t_msg_core}{}\doxysection{TMsg\+Core Class Reference}
\label{class_t_msg_core}\index{TMsgCore@{TMsgCore}}
Inheritance diagram for TMsg\+Core\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_t_msg_core}
\end{center}
\end{figure}
\doxysubsection*{Public Slots}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_t_msg_core_a7a7d49fa8aa48b7914efd88303283fcc}{On\+New\+Connection}} ()
\item 
void \mbox{\hyperlink{class_t_msg_core_a9762783cc61140f631b2ea96a7500966}{On\+Ready\+Read}} ()
\item 
void \mbox{\hyperlink{class_t_msg_core_a0ef940a1d3affbab519161322648987e}{On\+Disconnected}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Signals}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_t_msg_core_a9fd6787df5360260ec520f674f1fb85f}\label{class_t_msg_core_a9fd6787df5360260ec520f674f1fb85f}} 
void {\bfseries send\+Message} (int type, const QString \&message)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_t_msg_core_aa5fbc1fa9b5367e74e71ad2099cf5bf8}{send}} (DVGui\+::\+Msg\+Type type, const QString \&message)
\item 
void \mbox{\hyperlink{class_t_msg_core_a577642fc9bb2fbb262e79d4673154eda}{connect\+To}} (const QString \&address=\char`\"{}\char`\"{})
\item 
bool \mbox{\hyperlink{class_t_msg_core_a986caf34d9dec905673db8f3fb3095f7}{open\+Connection}} ()
\item 
QString \mbox{\hyperlink{class_t_msg_core_aaef092ef98563d4e8473a0f1d9bbdeab}{get\+Connection\+Name}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_msg_core}{TMsg\+Core}} $\ast$ \mbox{\hyperlink{class_t_msg_core_aa9791a512bed70f7586c09296f09463e}{instance}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_msg_core_ac1d570799f82a3fe68fde6df3845d994}\label{class_t_msg_core_ac1d570799f82a3fe68fde6df3845d994}} 
\index{TMsgCore@{TMsgCore}!TMsgCore@{TMsgCore}}
\index{TMsgCore@{TMsgCore}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{TMsgCore()}{TMsgCore()}}
{\footnotesize\ttfamily TMsg\+Core\+::\+TMsg\+Core (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00020 : m\_tcpServer(0), m\_clientSocket(0) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_ad38e489cd27622d466536b3474b5abc0}\label{class_t_msg_core_ad38e489cd27622d466536b3474b5abc0}} 
\index{TMsgCore@{TMsgCore}!````~TMsgCore@{$\sim$TMsgCore}}
\index{````~TMsgCore@{$\sim$TMsgCore}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{$\sim$TMsgCore()}{~TMsgCore()}}
{\footnotesize\ttfamily TMsg\+Core\+::$\sim$\+TMsg\+Core (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00154                     \{}
\DoxyCodeLine{00155   \textcolor{keywordflow}{if} (m\_tcpServer == 0 \&\& m\_clientSocket != 0)  \textcolor{comment}{// client side}}
\DoxyCodeLine{00156   \{}
\DoxyCodeLine{00157     \textcolor{comment}{// m\_socketIn-\/>waitForBytesWritten (-\/1);}}
\DoxyCodeLine{00158     \textcolor{comment}{//   m\_clientSocket-\/>disconnectFromServer();}}
\DoxyCodeLine{00159     \textcolor{comment}{// m\_clientSocket-\/>waitForDisconnected();}}
\DoxyCodeLine{00160     \textcolor{keyword}{delete} m\_clientSocket;}
\DoxyCodeLine{00161     m\_clientSocket = 0;}
\DoxyCodeLine{00162   \}}
\DoxyCodeLine{00163 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_msg_core_a577642fc9bb2fbb262e79d4673154eda}\label{class_t_msg_core_a577642fc9bb2fbb262e79d4673154eda}} 
\index{TMsgCore@{TMsgCore}!connectTo@{connectTo}}
\index{connectTo@{connectTo}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{connectTo()}{connectTo()}}
{\footnotesize\ttfamily void TMsg\+Core\+::connect\+To (\begin{DoxyParamCaption}\item[{const QString \&}]{address = {\ttfamily \char`\"{}\char`\"{}} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00196 \{}
\DoxyCodeLine{00197   m\_clientSocket = \textcolor{keyword}{new} QTcpSocket();}
\DoxyCodeLine{00198   m\_clientSocket-\/>connectToHost(}
\DoxyCodeLine{00199       address == \textcolor{stringliteral}{"{}"{}} ? QHostAddress::LocalHost : QHostAddress(address),}
\DoxyCodeLine{00200       TMSG\_PORT);}
\DoxyCodeLine{00201   \textcolor{comment}{// m\_clientSocket-\/>connectToServer (connectionName, QIODevice::ReadWrite |}}
\DoxyCodeLine{00202   \textcolor{comment}{// QIODevice::Text);}}
\DoxyCodeLine{00203   \textcolor{keywordtype}{bool} ret = m\_clientSocket-\/>waitForConnected(1000);}
\DoxyCodeLine{00204   \textcolor{keywordflow}{if} (!ret) \{}
\DoxyCodeLine{00205     \textcolor{comment}{// std::cout << "{}cannot connect to "{}<< address.toStdString() << std::endl;}}
\DoxyCodeLine{00206     \textcolor{comment}{// std::cout << "{}error "{}<< m\_clientSocket-\/>errorString().toStdString() <<}}
\DoxyCodeLine{00207     \textcolor{comment}{// std::endl;}}
\DoxyCodeLine{00208     \textcolor{keywordtype}{int} err = m\_clientSocket-\/>error();}
\DoxyCodeLine{00209   \}}
\DoxyCodeLine{00210 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_aaef092ef98563d4e8473a0f1d9bbdeab}\label{class_t_msg_core_aaef092ef98563d4e8473a0f1d9bbdeab}} 
\index{TMsgCore@{TMsgCore}!getConnectionName@{getConnectionName}}
\index{getConnectionName@{getConnectionName}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{getConnectionName()}{getConnectionName()}}
{\footnotesize\ttfamily QString TMsg\+Core\+::get\+Connection\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00068 \{}
\DoxyCodeLine{00069   assert(m\_tcpServer);}
\DoxyCodeLine{00070   QString serverName = \textcolor{stringliteral}{"{}pippo"{}};  \textcolor{comment}{// m\_tcpServer-\/>serverName();}}
\DoxyCodeLine{00071   \textcolor{keywordflow}{return} serverName;}
\DoxyCodeLine{00072 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_aa9791a512bed70f7586c09296f09463e}\label{class_t_msg_core_aa9791a512bed70f7586c09296f09463e}} 
\index{TMsgCore@{TMsgCore}!instance@{instance}}
\index{instance@{instance}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_msg_core}{TMsg\+Core}} $\ast$ TMsg\+Core\+::instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00012                              \{}
\DoxyCodeLine{00013   \textcolor{keyword}{static} \mbox{\hyperlink{class_t_msg_core}{TMsgCore}} *theInstance  = 0;}
\DoxyCodeLine{00014   \textcolor{keywordflow}{if} (!theInstance) theInstance = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_msg_core}{TMsgCore}}();}
\DoxyCodeLine{00015   \textcolor{keywordflow}{return} theInstance;}
\DoxyCodeLine{00016 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_a0ef940a1d3affbab519161322648987e}\label{class_t_msg_core_a0ef940a1d3affbab519161322648987e}} 
\index{TMsgCore@{TMsgCore}!OnDisconnected@{OnDisconnected}}
\index{OnDisconnected@{OnDisconnected}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{OnDisconnected}{OnDisconnected}}
{\footnotesize\ttfamily void TMsg\+Core\+::\+On\+Disconnected (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00077 \{}
\DoxyCodeLine{00078   std::set<QTcpSocket *>::iterator it = m\_sockets.begin();}
\DoxyCodeLine{00079   \textcolor{keywordflow}{while} (it != m\_sockets.end()) \{}
\DoxyCodeLine{00080     \textcolor{keywordflow}{if} ((*it)-\/>state() != QTcpSocket::ConnectedState)}
\DoxyCodeLine{00081       m\_sockets.erase(it++);}
\DoxyCodeLine{00082     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00083       it++;}
\DoxyCodeLine{00084   \}}
\DoxyCodeLine{00085 }
\DoxyCodeLine{00086   \textcolor{comment}{// if (m\_socketIn)}}
\DoxyCodeLine{00087   \textcolor{comment}{// delete m\_socketIn;}}
\DoxyCodeLine{00088   \textcolor{comment}{// m\_socketIn = 0;}}
\DoxyCodeLine{00089 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_a7a7d49fa8aa48b7914efd88303283fcc}\label{class_t_msg_core_a7a7d49fa8aa48b7914efd88303283fcc}} 
\index{TMsgCore@{TMsgCore}!OnNewConnection@{OnNewConnection}}
\index{OnNewConnection@{OnNewConnection}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{OnNewConnection}{OnNewConnection}}
{\footnotesize\ttfamily void TMsg\+Core\+::\+On\+New\+Connection (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00025 \{}
\DoxyCodeLine{00026   QTcpSocket *socket;}
\DoxyCodeLine{00027   \textcolor{keywordflow}{if} (m\_tcpServer) socket = m\_tcpServer-\/>nextPendingConnection();}
\DoxyCodeLine{00028   assert(socket);}
\DoxyCodeLine{00029 }
\DoxyCodeLine{00030   \textcolor{keywordtype}{bool} ret = connect(socket, SIGNAL(readyRead()), SLOT(OnReadyRead()));}
\DoxyCodeLine{00031   ret = ret \&\& connect(socket, SIGNAL(disconnected()), SLOT(OnDisconnected()));}
\DoxyCodeLine{00032   assert(ret);}
\DoxyCodeLine{00033   m\_sockets.insert(socket);}
\DoxyCodeLine{00034 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_a9762783cc61140f631b2ea96a7500966}\label{class_t_msg_core_a9762783cc61140f631b2ea96a7500966}} 
\index{TMsgCore@{TMsgCore}!OnReadyRead@{OnReadyRead}}
\index{OnReadyRead@{OnReadyRead}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{OnReadyRead}{OnReadyRead}}
{\footnotesize\ttfamily void TMsg\+Core\+::\+On\+Ready\+Read (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00094 \{}
\DoxyCodeLine{00095   std::set<QTcpSocket *>::iterator it = m\_sockets.begin();}
\DoxyCodeLine{00096   \textcolor{keywordflow}{for} (; it != m\_sockets.end(); it++)  \textcolor{comment}{// devo scorrerli tutti perche' non so da}}
\DoxyCodeLine{00097                                        \textcolor{comment}{// quale socket viene il messaggio...}}
\DoxyCodeLine{00098   \{}
\DoxyCodeLine{00099     \textcolor{keywordflow}{if} ((*it)-\/>state() == QTcpSocket::ConnectedState \&\&}
\DoxyCodeLine{00100         (*it)-\/>bytesAvailable() > 0)}
\DoxyCodeLine{00101       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00102   \}}
\DoxyCodeLine{00103   \textcolor{keywordflow}{if} (it != m\_sockets.end()) \{}
\DoxyCodeLine{00104     readFromSocket(*it);}
\DoxyCodeLine{00105     OnReadyRead();}
\DoxyCodeLine{00106   \}}
\DoxyCodeLine{00107 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_a986caf34d9dec905673db8f3fb3095f7}\label{class_t_msg_core_a986caf34d9dec905673db8f3fb3095f7}} 
\index{TMsgCore@{TMsgCore}!openConnection@{openConnection}}
\index{openConnection@{openConnection}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{openConnection()}{openConnection()}}
{\footnotesize\ttfamily bool TMsg\+Core\+::open\+Connection (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00041 \{}
\DoxyCodeLine{00042   \textcolor{comment}{// QHostAddress host = (remoteConnection) ?}}
\DoxyCodeLine{00043   \textcolor{comment}{// QHostAddress::AnyQHostAddress::LocalHost : ;}}
\DoxyCodeLine{00044 }
\DoxyCodeLine{00045   \textcolor{keywordflow}{if} (m\_tcpServer != 0 \&\& m\_tcpServer-\/>serverAddress() == QHostAddress::Any)}
\DoxyCodeLine{00046     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00047   \textcolor{keywordflow}{if} (m\_tcpServer != 0) \textcolor{keyword}{delete} m\_tcpServer;}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00049   m\_tcpServer = \textcolor{keyword}{new} QTcpServer();}
\DoxyCodeLine{00050   \textcolor{keywordtype}{bool} ret =}
\DoxyCodeLine{00051       connect(m\_tcpServer, SIGNAL(newConnection()), SLOT(OnNewConnection()));}
\DoxyCodeLine{00052   \textcolor{comment}{// bool listen =}}
\DoxyCodeLine{00053   \textcolor{comment}{// m\_tcpServer-\/>listen(QString("{}tmsg"{})+QString::number(QCoreApplication::applicationPid()));}}
\DoxyCodeLine{00054   \textcolor{keywordtype}{bool} listen = m\_tcpServer-\/>listen(}
\DoxyCodeLine{00055       QHostAddress::Any,}
\DoxyCodeLine{00056       TMSG\_PORT);  \textcolor{comment}{// QString("{}tmsg"{})+QString::number(QCoreApplication::applicationPid()));}}
\DoxyCodeLine{00057   \textcolor{keywordflow}{if} (!listen) \{}
\DoxyCodeLine{00058     QString err = m\_tcpServer-\/>errorString();}
\DoxyCodeLine{00059   \}}
\DoxyCodeLine{00060 }
\DoxyCodeLine{00061   assert(ret \&\& listen);}
\DoxyCodeLine{00062   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00063 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_msg_core_aa5fbc1fa9b5367e74e71ad2099cf5bf8}\label{class_t_msg_core_aa5fbc1fa9b5367e74e71ad2099cf5bf8}} 
\index{TMsgCore@{TMsgCore}!send@{send}}
\index{send@{send}!TMsgCore@{TMsgCore}}
\doxysubsubsection{\texorpdfstring{send()}{send()}}
{\footnotesize\ttfamily bool TMsg\+Core\+::send (\begin{DoxyParamCaption}\item[{DVGui\+::\+Msg\+Type}]{type,  }\item[{const QString \&}]{message }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00168 \{}
\DoxyCodeLine{00169   \textcolor{keywordflow}{if} (receivers(SIGNAL(sendMessage(\textcolor{keywordtype}{int}, \textcolor{keyword}{const} QString \&))) == 0) \{}
\DoxyCodeLine{00170     \textcolor{keywordflow}{if} (m\_clientSocket == 0 ||}
\DoxyCodeLine{00171         m\_clientSocket-\/>state() != QTcpSocket::ConnectedState)}
\DoxyCodeLine{00172       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00173 }
\DoxyCodeLine{00174     QString socketMessage =}
\DoxyCodeLine{00175         (type == DVGui::CRITICAL}
\DoxyCodeLine{00176              ? \textcolor{stringliteral}{"{}\#TMSG ERROR "{}}}
\DoxyCodeLine{00177              : (type == DVGui::WARNING ? \textcolor{stringliteral}{"{}\#TMSG WARNING "{}} : \textcolor{stringliteral}{"{}\#TMSG INFO "{}})) +}
\DoxyCodeLine{00178         message + \textcolor{stringliteral}{"{} \#END\(\backslash\)n"{}};}
\DoxyCodeLine{00179 }
\DoxyCodeLine{00180 \textcolor{preprocessor}{\#if QT\_VERSION >= 0x050000}}
\DoxyCodeLine{00181     m\_clientSocket-\/>write(socketMessage.toLatin1());}
\DoxyCodeLine{00182 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00183     m\_clientSocket-\/>write(socketMessage.toAscii());}
\DoxyCodeLine{00184 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00185     m\_clientSocket-\/>flush();}
\DoxyCodeLine{00186     \textcolor{comment}{// m\_clientSocket-\/>waitForBytesWritten (1000);}}
\DoxyCodeLine{00187   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00188     Q\_EMIT sendMessage(type, message);}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00191 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tmsgcore.\+h\item 
E\+:/opentoonz/toonz/sources/common/tmsgcore.\+cpp\end{DoxyCompactItemize}
