\hypertarget{class_pump_tool}{}\doxysection{Pump\+Tool Class Reference}
\label{class_pump_tool}\index{PumpTool@{PumpTool}}
Inheritance diagram for Pump\+Tool\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_pump_tool}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} \mbox{\hyperlink{class_pump_tool_a85e008defbf7193546dcc6c16755e029}{get\+Tool\+Type}} () const override
\item 
\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ \mbox{\hyperlink{class_pump_tool_aef074d9d0b0ece0896c3b2f4f2ab9094}{get\+Properties}} (int target\+Type) override
\item 
void \mbox{\hyperlink{class_pump_tool_adb2fb93faa99854e0192b0ebd2dd3e9c}{update\+Translation}} () override
\item 
void \mbox{\hyperlink{class_pump_tool_aa5eba20d789549e7c6f822a4d3c42846}{on\+Enter}} () override
\begin{DoxyCompactList}\small\item\em Callback for the mouse entering the viewer area. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_pump_tool_a35187a25ecf2bec34b751cd19a89b08a}{on\+Leave}} () override
\begin{DoxyCompactList}\small\item\em Callback for the mouse leaving the viewer area. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_pump_tool_a8d5824d783185e215ec527328435c339}{draw}} () override
\begin{DoxyCompactList}\small\item\em Draws the tool on the viewer. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_pump_tool_a6f1db4980dc10c02e960dc2348d787ab}{left\+Button\+Down}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_pump_tool_a20f6531d3db8c07e2e8eec14dce11e55}{left\+Button\+Drag}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_pump_tool_a2946375ae7ed258a02e546a35b02baa8}{left\+Button\+Up}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_pump_tool_a9a374b95df3b0cb757d48b9889e7ed42}{mouse\+Move}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
bool \mbox{\hyperlink{class_pump_tool_a32b74e9309f7cafb671ddb75925f5953}{move\+Cursor}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos)
\item 
int \mbox{\hyperlink{class_pump_tool_a697fbddf89a86d399435758010870e12}{get\+Cursor\+Id}} () const override
\begin{DoxyCompactList}\small\item\em Returns the type of cursor used by the tool. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_pump_tool_a97dab34eabf7567dda83a341ea8f66d2}{invalidate\+Cursor\+Area}} ()
\item 
void \mbox{\hyperlink{class_pump_tool_ae405b450b3312b0ffe1565e64928ce77}{on\+Deactivate}} () override
\begin{DoxyCompactList}\small\item\em Callback for tool deactivation, includes tool switch. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_pump_tool_ad387013675007093aec731429c3a6775}\label{class_pump_tool_ad387013675007093aec731429c3a6775}} 
\index{PumpTool@{PumpTool}!PumpTool@{PumpTool}}
\index{PumpTool@{PumpTool}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{PumpTool()}{PumpTool()}}
{\footnotesize\ttfamily Pump\+Tool\+::\+Pump\+Tool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00076       : \mbox{\hyperlink{class_t_tool_a9c63ec35f606e755d0d036bf4fed62ab}{TTool}}(\textcolor{stringliteral}{"{}T\_Pump"{}})}
\DoxyCodeLine{00077       , m\_active(\textcolor{keyword}{false})}
\DoxyCodeLine{00078       , m\_actionW(0)}
\DoxyCodeLine{00079       , m\_strokeIndex((std::numeric\_limits<UINT>::max)())}
\DoxyCodeLine{00080       , m\_inStroke(0)}
\DoxyCodeLine{00081       , m\_outStroke(0)}
\DoxyCodeLine{00082       , m\_stroke1Idx(-\/1)}
\DoxyCodeLine{00083       , m\_stroke2Idx(-\/1)}
\DoxyCodeLine{00084       , m\_cursorEnabled(\textcolor{keyword}{false})}
\DoxyCodeLine{00085       , m\_cursorId(ToolCursor::PumpCursor)}
\DoxyCodeLine{00086       , m\_actionRadius(1)}
\DoxyCodeLine{00087       , m\_draw(\textcolor{keyword}{false})}
\DoxyCodeLine{00088       , m\_undo(0)}
\DoxyCodeLine{00089       , m\_toolSize(\textcolor{stringliteral}{"{}Size:"{}}, 1, 100, 20)}
\DoxyCodeLine{00090       , m\_accuracy(\textcolor{stringliteral}{"{}Accuracy:"{}}, 0, 100, 40)}
\DoxyCodeLine{00091       , m\_enabled(\textcolor{keyword}{false}) \{}
\DoxyCodeLine{00092     bind(\mbox{\hyperlink{class_t_tool_adf0ea3a7f9d003f761fe57638dd6eff4a6528d353c20fcbe8932de09845117046}{TTool::VectorImage}});}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094     m\_splitPars.resize(2);}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096     m\_prop.\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_toolSize);}
\DoxyCodeLine{00097     m\_prop.\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_accuracy);}
\DoxyCodeLine{00098   \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_pump_tool_a8d5824d783185e215ec527328435c339}\label{class_pump_tool_a8d5824d783185e215ec527328435c339}} 
\index{PumpTool@{PumpTool}!draw@{draw}}
\index{draw@{draw}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void Pump\+Tool\+::draw (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Draws the tool on the viewer. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a058bf656d73bf3cd63b9826cbaaf48e0}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00159                     \{}
\DoxyCodeLine{00160   \textcolor{keywordflow}{if} (!m\_draw || !m\_enabled) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00161 }
\DoxyCodeLine{00162   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false}));}
\DoxyCodeLine{00163   \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165   QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{00166 }
\DoxyCodeLine{00167   \mbox{\hyperlink{class_t_palette}{TPalette}} *palette = vi-\/>getPalette();}
\DoxyCodeLine{00168   assert(palette);}
\DoxyCodeLine{00169   \textcolor{keywordflow}{if} (m\_active) \{}
\DoxyCodeLine{00170     \textcolor{comment}{// Editing with the tool}}
\DoxyCodeLine{00171     assert(m\_outStroke);}
\DoxyCodeLine{00172 }
\DoxyCodeLine{00173     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bboxD(m\_outStroke-\/>\mbox{\hyperlink{class_t_stroke_a456bedcae5e8af3a84823cb251584957}{getBBox}}());}
\DoxyCodeLine{00174     \mbox{\hyperlink{class_t_rect_t}{TRect}} bbox(tfloor(bboxD.x0), tfloor(bboxD.y0), tceil(bboxD.x1) -\/ 1,}
\DoxyCodeLine{00175                tceil(bboxD.y1) -\/ 1);}
\DoxyCodeLine{00176 }
\DoxyCodeLine{00177     tglDraw(\mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}}(\mbox{\hyperlink{class_t_affine}{TAffine}}(), bbox, palette, 0, \textcolor{keyword}{true}), m\_outStroke);}
\DoxyCodeLine{00178   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00179     \textcolor{comment}{// Hovering}}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181     \textcolor{keywordtype}{double} w, dist;}
\DoxyCodeLine{00182     UINT index;}
\DoxyCodeLine{00183 }
\DoxyCodeLine{00184     \textcolor{keywordflow}{if} (m\_cursorEnabled) \{}
\DoxyCodeLine{00185       \textcolor{comment}{// Draw cursor}}
\DoxyCodeLine{00186       glColor3d(1.0, 0.0, 1.0);}
\DoxyCodeLine{00187       \textcolor{keywordflow}{if} (m\_cursor.thick > 0) tglDrawCircle(m\_cursor, m\_cursor.thick);}
\DoxyCodeLine{00188       tglDrawCircle(m\_cursor, m\_cursor.thick + 4 * getPixelSize());}
\DoxyCodeLine{00189     \}}
\DoxyCodeLine{00190 }
\DoxyCodeLine{00191     \textcolor{keywordflow}{if} (getNearestStrokeWithLock(m\_cursor, w, index, dist, \textcolor{keyword}{true})) \{}
\DoxyCodeLine{00192       \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke  = vi-\/>getStroke(index);}
\DoxyCodeLine{00193       \textcolor{keywordtype}{double} totalLen  = stroke-\/>\mbox{\hyperlink{class_t_stroke_a079a513cb8a60d9a759b4f0c8211eab4}{getLength}}();}
\DoxyCodeLine{00194       \textcolor{keywordtype}{double} actionLen = actionRadius(totalLen);}
\DoxyCodeLine{00195 }
\DoxyCodeLine{00196       tglColor(TPixel32::Red);}
\DoxyCodeLine{00197 }
\DoxyCodeLine{00198       \textcolor{keywordflow}{if} (totalLen < actionLen ||}
\DoxyCodeLine{00199           (stroke-\/>\mbox{\hyperlink{class_t_stroke_a3565d6c34d3eb02fb1a6993ca626425c}{isSelfLoop}}() \&\& totalLen < actionLen + actionLen))}
\DoxyCodeLine{00200         drawStrokeCenterline(*stroke, getPixelSize());}
\DoxyCodeLine{00201       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00202         \textcolor{keywordtype}{int} i, chunckIndex1, chunckIndex2;}
\DoxyCodeLine{00203         \textcolor{keywordtype}{double} t, t1, t2, w1, w2;}
\DoxyCodeLine{00204 }
\DoxyCodeLine{00205         \textcolor{keywordtype}{double} len = stroke-\/>\mbox{\hyperlink{class_t_stroke_a079a513cb8a60d9a759b4f0c8211eab4}{getLength}}(w);}
\DoxyCodeLine{00206 }
\DoxyCodeLine{00207         \textcolor{keywordtype}{double} len1 = len -\/ actionLen;}
\DoxyCodeLine{00208         \textcolor{keywordflow}{if} (len1 < 0) \{}
\DoxyCodeLine{00209           \textcolor{keywordflow}{if} (stroke-\/>\mbox{\hyperlink{class_t_stroke_a3565d6c34d3eb02fb1a6993ca626425c}{isSelfLoop}}()) \{}
\DoxyCodeLine{00210             len1 += totalLen;}
\DoxyCodeLine{00211           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00212             len1 = 0;}
\DoxyCodeLine{00213           \}}
\DoxyCodeLine{00214         \}}
\DoxyCodeLine{00215 }
\DoxyCodeLine{00216         \textcolor{keywordtype}{double} len2 = len + actionLen;}
\DoxyCodeLine{00217         \textcolor{keywordflow}{if} (len2 > totalLen) \{}
\DoxyCodeLine{00218           \textcolor{keywordflow}{if} (stroke-\/>\mbox{\hyperlink{class_t_stroke_a3565d6c34d3eb02fb1a6993ca626425c}{isSelfLoop}}()) \{}
\DoxyCodeLine{00219             len2 -\/= totalLen;}
\DoxyCodeLine{00220           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00221             len2 = totalLen;}
\DoxyCodeLine{00222           \}}
\DoxyCodeLine{00223         \}}
\DoxyCodeLine{00224 }
\DoxyCodeLine{00225         w1 = stroke-\/>\mbox{\hyperlink{class_t_stroke_a45226c432c0d643e9985823abccdeda2}{getParameterAtLength}}(len1);}
\DoxyCodeLine{00226         w2 = stroke-\/>\mbox{\hyperlink{class_t_stroke_a45226c432c0d643e9985823abccdeda2}{getParameterAtLength}}(len2);}
\DoxyCodeLine{00227 }
\DoxyCodeLine{00228         \textcolor{keywordtype}{int} chunkCount = stroke-\/>\mbox{\hyperlink{class_t_stroke_a81b63663a798724333d8de692fdbcac0}{getChunkCount}}();}
\DoxyCodeLine{00229 }
\DoxyCodeLine{00230         stroke-\/>\mbox{\hyperlink{class_t_stroke_aa984dd40b1109e4afeae144085d11c7e}{getChunkAndT}}(w1, chunckIndex1, t1);}
\DoxyCodeLine{00231         stroke-\/>\mbox{\hyperlink{class_t_stroke_aa984dd40b1109e4afeae144085d11c7e}{getChunkAndT}}(w2, chunckIndex2, t2);}
\DoxyCodeLine{00232         \textcolor{keywordtype}{double} step;}
\DoxyCodeLine{00233 }
\DoxyCodeLine{00234         \textcolor{keyword}{const} \mbox{\hyperlink{class_t_thick_quadratic}{TThickQuadratic}} *q = 0;}
\DoxyCodeLine{00235 }
\DoxyCodeLine{00236         glBegin(GL\_LINE\_STRIP);}
\DoxyCodeLine{00237 }
\DoxyCodeLine{00238         q    = stroke-\/>\mbox{\hyperlink{class_t_stroke_a06b18ffed330411aad73ef1748a3f263}{getChunk}}(chunckIndex1);}
\DoxyCodeLine{00239         step = computeStep(*q, getPixelSize());}
\DoxyCodeLine{00240 }
\DoxyCodeLine{00241         \textcolor{keywordflow}{if} (chunckIndex1 == chunckIndex2 \&\& t1 < t2) \{}
\DoxyCodeLine{00242           \textcolor{keywordflow}{for} (t = t1; t < t2; t += step) tglVertex(q-\/>\mbox{\hyperlink{class_t_quadratic_a3c2903b06b6ee0c7ae16e5528a10f24a}{getPoint}}(t));}
\DoxyCodeLine{00243 }
\DoxyCodeLine{00244           tglVertex(stroke-\/>\mbox{\hyperlink{class_t_stroke_ace861e064b925c5d41a6d7381ae6ada5}{getPoint}}(w2));}
\DoxyCodeLine{00245           glEnd();}
\DoxyCodeLine{00246           \textcolor{keywordflow}{return};}
\DoxyCodeLine{00247         \}}
\DoxyCodeLine{00248 }
\DoxyCodeLine{00249         \textcolor{keywordflow}{for} (t = t1; t < 1; t += step) tglVertex(q-\/>\mbox{\hyperlink{class_t_quadratic_a3c2903b06b6ee0c7ae16e5528a10f24a}{getPoint}}(t));}
\DoxyCodeLine{00250 }
\DoxyCodeLine{00251         \textcolor{keywordflow}{for} (i = chunckIndex1 + 1; i != chunckIndex2; i++) \{}
\DoxyCodeLine{00252           \textcolor{keywordflow}{if} (i == chunkCount) i = 0;}
\DoxyCodeLine{00253 }
\DoxyCodeLine{00254           \textcolor{keywordflow}{if} (i == chunckIndex2) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00255 }
\DoxyCodeLine{00256           q    = stroke-\/>\mbox{\hyperlink{class_t_stroke_a06b18ffed330411aad73ef1748a3f263}{getChunk}}(i);}
\DoxyCodeLine{00257           step = computeStep(*q, getPixelSize());}
\DoxyCodeLine{00258           \textcolor{keywordflow}{for} (t = 0; t < 1; t += step) tglVertex(q-\/>\mbox{\hyperlink{class_t_quadratic_a3c2903b06b6ee0c7ae16e5528a10f24a}{getPoint}}(t));}
\DoxyCodeLine{00259         \}}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261         q    = stroke-\/>\mbox{\hyperlink{class_t_stroke_a06b18ffed330411aad73ef1748a3f263}{getChunk}}(chunckIndex2);}
\DoxyCodeLine{00262         step = computeStep(*q, getPixelSize());}
\DoxyCodeLine{00263         \textcolor{keywordflow}{for} (t = 0; t < t2; t += step) tglVertex(q-\/>\mbox{\hyperlink{class_t_quadratic_a3c2903b06b6ee0c7ae16e5528a10f24a}{getPoint}}(t));}
\DoxyCodeLine{00264 }
\DoxyCodeLine{00265         tglVertex(stroke-\/>\mbox{\hyperlink{class_t_stroke_ace861e064b925c5d41a6d7381ae6ada5}{getPoint}}(w2));}
\DoxyCodeLine{00266 }
\DoxyCodeLine{00267         glEnd();}
\DoxyCodeLine{00268       \}}
\DoxyCodeLine{00269     \}}
\DoxyCodeLine{00270   \}}
\DoxyCodeLine{00271 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01861}{TStroke\+::get\+BBox()}}, \mbox{\hyperlink{l01855}{TStroke\+::get\+Chunk()}}, \mbox{\hyperlink{l00994}{TStroke\+::get\+Chunk\+And\+T()}}, \mbox{\hyperlink{l01845}{TStroke\+::get\+Chunk\+Count()}}, \mbox{\hyperlink{l00276}{TTool\+::get\+Image()}}, \mbox{\hyperlink{l01591}{TStroke\+::get\+Length()}}, \mbox{\hyperlink{l01981}{TStroke\+::get\+Parameter\+At\+Length()}}, \mbox{\hyperlink{l00040}{TQuadratic\+::get\+Point()}}, \mbox{\hyperlink{l00236}{TStroke\+::get\+Point()}}, \mbox{\hyperlink{l02488}{TStroke\+::is\+Self\+Loop()}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_pump_tool_a697fbddf89a86d399435758010870e12}\label{class_pump_tool_a697fbddf89a86d399435758010870e12}} 
\index{PumpTool@{PumpTool}!getCursorId@{getCursorId}}
\index{getCursorId@{getCursorId}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{getCursorId()}{getCursorId()}}
{\footnotesize\ttfamily int Pump\+Tool\+::get\+Cursor\+Id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Returns the type of cursor used by the tool. 

\begin{DoxySeeAlso}{See also}
For a list of cursor ids \mbox{\hyperlink{}{cursor.\+h}} 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{class_t_tool_a1768a57b8b6d1480618fd923fad15f1d}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00121                                    \{}
\DoxyCodeLine{00122     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}} \&\& \mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}}-\/>getGuidedStrokePickerMode())}
\DoxyCodeLine{00123       \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}}-\/>getGuidedStrokePickerCursor();}
\DoxyCodeLine{00124     \textcolor{keywordflow}{return} m\_cursorId;}
\DoxyCodeLine{00125   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00555}{TTool\+::m\+\_\+viewer}}.

\mbox{\Hypertarget{class_pump_tool_aef074d9d0b0ece0896c3b2f4f2ab9094}\label{class_pump_tool_aef074d9d0b0ece0896c3b2f4f2ab9094}} 
\index{PumpTool@{PumpTool}!getProperties@{getProperties}}
\index{getProperties@{getProperties}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{getProperties()}{getProperties()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ Pump\+Tool\+::get\+Properties (\begin{DoxyParamCaption}\item[{int}]{target\+Type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00102 \{ \textcolor{keywordflow}{return} \&m\_prop; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_a85e008defbf7193546dcc6c16755e029}\label{class_pump_tool_a85e008defbf7193546dcc6c16755e029}} 
\index{PumpTool@{PumpTool}!getToolType@{getToolType}}
\index{getToolType@{getToolType}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{getToolType()}{getToolType()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} Pump\+Tool\+::get\+Tool\+Type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00100 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296ca01ffd66b00b05a88c02ce8ceb5da3b8b}{TTool::LevelWriteTool}}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_a97dab34eabf7567dda83a341ea8f66d2}\label{class_pump_tool_a97dab34eabf7567dda83a341ea8f66d2}} 
\index{PumpTool@{PumpTool}!invalidateCursorArea@{invalidateCursorArea}}
\index{invalidateCursorArea@{invalidateCursorArea}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{invalidateCursorArea()}{invalidateCursorArea()}}
{\footnotesize\ttfamily void Pump\+Tool\+::invalidate\+Cursor\+Area (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00483                                     \{}
\DoxyCodeLine{00484   \textcolor{keywordtype}{double} r = m\_cursor.thick + 6;}
\DoxyCodeLine{00485   \mbox{\hyperlink{class_t_point_t}{TPointD}} d(r, r);}
\DoxyCodeLine{00486   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}(\mbox{\hyperlink{class_t_rect_t}{TRectD}}(m\_cursor -\/ d, m\_cursor + d));}
\DoxyCodeLine{00487 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_a6f1db4980dc10c02e960dc2348d787ab}\label{class_pump_tool_a6f1db4980dc10c02e960dc2348d787ab}} 
\index{PumpTool@{PumpTool}!leftButtonDown@{leftButtonDown}}
\index{leftButtonDown@{leftButtonDown}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDown()}{leftButtonDown()}}
{\footnotesize\ttfamily void Pump\+Tool\+::left\+Button\+Down (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00275                                                                       \{}
\DoxyCodeLine{00276   \textcolor{keywordflow}{if} (getViewer() \&\& getViewer()-\/>getGuidedStrokePickerMode()) \{}
\DoxyCodeLine{00277     getViewer()-\/>doPickGuideStroke(pos);}
\DoxyCodeLine{00278     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00279   \}}
\DoxyCodeLine{00280 }
\DoxyCodeLine{00281   \textcolor{keywordflow}{if} (m\_active || !m\_enabled) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00282 }
\DoxyCodeLine{00283   m\_isCtrlPressed = e.isCtrlPressed();}
\DoxyCodeLine{00284 }
\DoxyCodeLine{00285   assert(m\_undo == 0);}
\DoxyCodeLine{00286   m\_active = \textcolor{keyword}{false};}
\DoxyCodeLine{00287 }
\DoxyCodeLine{00288   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00289   \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00290 }
\DoxyCodeLine{00291   QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{00292 }
\DoxyCodeLine{00293   \textcolor{comment}{// set current point and init parameters}}
\DoxyCodeLine{00294   m\_oldPoint  = pos;}
\DoxyCodeLine{00295   m\_downPoint = pos;}
\DoxyCodeLine{00296 }
\DoxyCodeLine{00297   m\_inStroke = m\_outStroke = 0;}
\DoxyCodeLine{00298   m\_stroke1Idx = m\_stroke2Idx = -\/1;}
\DoxyCodeLine{00299   m\_splitPars[0] = m\_splitPars[1] = -\/2;}
\DoxyCodeLine{00300   m\_actionW                       = 0;}
\DoxyCodeLine{00301 }
\DoxyCodeLine{00302   m\_errorTol = (1.0 -\/ 0.01 * m\_accuracy.getValue()) * getPixelSize();}
\DoxyCodeLine{00303 }
\DoxyCodeLine{00304   \textcolor{keywordtype}{double} dist2 = 0.0;}
\DoxyCodeLine{00305   \textcolor{keywordtype}{int} cpCount;}
\DoxyCodeLine{00306   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00307   UINT index;}
\DoxyCodeLine{00308 }
\DoxyCodeLine{00309   \textcolor{keywordflow}{if} (getNearestStrokeWithLock(pos, m\_actionW, index, dist2)) \{}
\DoxyCodeLine{00310     \textcolor{comment}{// A stroke near the pressed point was found -\/ modify it}}
\DoxyCodeLine{00311     m\_active      = \textcolor{keyword}{true};}
\DoxyCodeLine{00312     m\_strokeIndex = index;}
\DoxyCodeLine{00313 }
\DoxyCodeLine{00314     m\_inStroke  = vi-\/>getStroke(m\_strokeIndex);}
\DoxyCodeLine{00315     m\_outStroke = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stroke}{TStroke}}(*m\_inStroke);}
\DoxyCodeLine{00316 }
\DoxyCodeLine{00317     \textcolor{keywordtype}{double} totalLength = m\_inStroke-\/>\mbox{\hyperlink{class_t_stroke_a079a513cb8a60d9a759b4f0c8211eab4}{getLength}}();}
\DoxyCodeLine{00318     \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl =}
\DoxyCodeLine{00319         TTool::getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel();}
\DoxyCodeLine{00320     assert(sl);}
\DoxyCodeLine{00321     \mbox{\hyperlink{class_t_frame_id}{TFrameId}} \textcolor{keywordtype}{id} = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{00322 }
\DoxyCodeLine{00323     \textcolor{comment}{// Allocate the modification undo -\/ will be assigned to the undo manager on}}
\DoxyCodeLine{00324     \textcolor{comment}{// mouse release}}
\DoxyCodeLine{00325     m\_undo = \textcolor{keyword}{new} \mbox{\hyperlink{class_tool_utils_1_1_undo_modify_stroke_and_paint}{UndoModifyStrokeAndPaint}}(sl, \textcolor{keywordtype}{id}, m\_strokeIndex);}
\DoxyCodeLine{00326 }
\DoxyCodeLine{00327     \textcolor{comment}{// Set the stroke's style to 'none'. This is needed to make the original}}
\DoxyCodeLine{00328     \textcolor{comment}{// stroke transparent,}}
\DoxyCodeLine{00329     \textcolor{comment}{// while the deformed one is shown at its place.}}
\DoxyCodeLine{00330     m\_strokeStyleId = m\_inStroke-\/>\mbox{\hyperlink{class_t_stroke_ab77068d7894a29cc1878e173f46ed785}{getStyle}}();}
\DoxyCodeLine{00331     m\_inStroke-\/>\mbox{\hyperlink{class_t_stroke_a33f59dfbed74b577700351eac8c2fc7b}{setStyle}}(0);}
\DoxyCodeLine{00332 }
\DoxyCodeLine{00333     \textcolor{keywordflow}{if} (totalLength <= 0.0) \{}
\DoxyCodeLine{00334       \textcolor{comment}{// Single point case}}
\DoxyCodeLine{00335       cpCount = m\_inStroke-\/>\mbox{\hyperlink{class_t_stroke_a45101afd31e40d08100fdf23c89fb49e}{getControlPointCount}}();}
\DoxyCodeLine{00336       m\_cpLenDiff1.resize(cpCount);}
\DoxyCodeLine{00337 }
\DoxyCodeLine{00338       \textcolor{keywordflow}{for} (i = 0; i < cpCount; i++) m\_cpLenDiff1[i] = 0.0;}
\DoxyCodeLine{00339 }
\DoxyCodeLine{00340       m\_splitStrokes.resize(1);}
\DoxyCodeLine{00341       m\_splitStrokes[0] = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stroke}{TStroke}}(*m\_inStroke);}
\DoxyCodeLine{00342 }
\DoxyCodeLine{00343       m\_stroke1Idx = 0;}
\DoxyCodeLine{00344     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00345       \textcolor{comment}{// Common strokes -\/ split the stroke according to deformation requirements}}
\DoxyCodeLine{00346       splitStroke(m\_inStroke);}
\DoxyCodeLine{00347   \}}
\DoxyCodeLine{00348 }
\DoxyCodeLine{00349   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00350 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_a20f6531d3db8c07e2e8eec14dce11e55}\label{class_pump_tool_a20f6531d3db8c07e2e8eec14dce11e55}} 
\index{PumpTool@{PumpTool}!leftButtonDrag@{leftButtonDrag}}
\index{leftButtonDrag@{leftButtonDrag}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDrag()}{leftButtonDrag()}}
{\footnotesize\ttfamily void Pump\+Tool\+::left\+Button\+Drag (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00354                                                                       \{}
\DoxyCodeLine{00355   \textcolor{keywordflow}{if} (!m\_active || !m\_enabled) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00356 }
\DoxyCodeLine{00357   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00358   \textcolor{keywordflow}{if} (!vi || !m\_outStroke) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00359 }
\DoxyCodeLine{00360   m\_isCtrlPressed = e.isCtrlPressed();}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362   QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{00363 }
\DoxyCodeLine{00364   \textcolor{comment}{// Revert current deformation, recovering the one from button press}}
\DoxyCodeLine{00365   \textcolor{keyword}{delete} m\_outStroke;}
\DoxyCodeLine{00366 }
\DoxyCodeLine{00367   \textcolor{comment}{// Retrieve cursor's vertical displacement}}
\DoxyCodeLine{00368   \mbox{\hyperlink{class_t_point_t}{TPointD}} delta = \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, (pos -\/ m\_downPoint).y);}
\DoxyCodeLine{00369   \textcolor{keywordtype}{int} deltaSign = tsign(delta.y);}
\DoxyCodeLine{00370   \textcolor{keywordflow}{if} (deltaSign == 0) \{}
\DoxyCodeLine{00371     \textcolor{comment}{// Use a copy of the original stroke}}
\DoxyCodeLine{00372     m\_outStroke = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stroke}{TStroke}}(*m\_inStroke);}
\DoxyCodeLine{00373     m\_outStroke-\/>\mbox{\hyperlink{class_t_stroke_a33f59dfbed74b577700351eac8c2fc7b}{setStyle}}(m\_strokeStyleId);}
\DoxyCodeLine{00374     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00375     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00376   \}}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378   \textcolor{comment}{// Build deformation upon the original stroke pieces}}
\DoxyCodeLine{00379   \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke1 = 0, *stroke2 = 0;}
\DoxyCodeLine{00380 }
\DoxyCodeLine{00381   stroke1 = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stroke}{TStroke}}(*m\_splitStrokes[m\_stroke1Idx]);}
\DoxyCodeLine{00382 }
\DoxyCodeLine{00383   \textcolor{comment}{// Deform stroke1}}
\DoxyCodeLine{00384   \mbox{\hyperlink{class_t_stroke_thickness_deformation}{TStrokeThicknessDeformation}} deformer(stroke1, delta, m\_actionS1,}
\DoxyCodeLine{00385                                        m\_actionRadius, deltaSign);}
\DoxyCodeLine{00386   modifyThickness(*stroke1, deformer, m\_cpLenDiff1, deltaSign < 0);}
\DoxyCodeLine{00387 }
\DoxyCodeLine{00388   \textcolor{keywordflow}{if} (m\_stroke2Idx >= 0) \{}
\DoxyCodeLine{00389     \textcolor{comment}{// Deform stroke2}}
\DoxyCodeLine{00390     stroke2 = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stroke}{TStroke}}(*m\_splitStrokes[m\_stroke2Idx]);}
\DoxyCodeLine{00391 }
\DoxyCodeLine{00392     \mbox{\hyperlink{class_t_stroke_thickness_deformation}{TStrokeThicknessDeformation}} deformer2(stroke2, delta, m\_actionS2,}
\DoxyCodeLine{00393                                           m\_actionRadius, deltaSign);}
\DoxyCodeLine{00394     modifyThickness(*stroke2, deformer2, m\_cpLenDiff2, deltaSign < 0);}
\DoxyCodeLine{00395   \}}
\DoxyCodeLine{00396 }
\DoxyCodeLine{00397   \textcolor{comment}{// Apply deformation}}
\DoxyCodeLine{00398   std::vector<TStroke *> splitStrokesCopy(m\_splitStrokes);}
\DoxyCodeLine{00399   splitStrokesCopy[m\_stroke1Idx] = stroke1;}
\DoxyCodeLine{00400   \textcolor{keywordflow}{if} (stroke2) splitStrokesCopy[m\_stroke2Idx] = stroke2;}
\DoxyCodeLine{00401 }
\DoxyCodeLine{00402   m\_outStroke = mergeStrokes(splitStrokesCopy);}
\DoxyCodeLine{00403 }
\DoxyCodeLine{00404   \textcolor{keyword}{delete} stroke1;}
\DoxyCodeLine{00405   \textcolor{keyword}{delete} stroke2;}
\DoxyCodeLine{00406 }
\DoxyCodeLine{00407   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00408 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_a2946375ae7ed258a02e546a35b02baa8}\label{class_pump_tool_a2946375ae7ed258a02e546a35b02baa8}} 
\index{PumpTool@{PumpTool}!leftButtonUp@{leftButtonUp}}
\index{leftButtonUp@{leftButtonUp}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{leftButtonUp()}{leftButtonUp()}}
{\footnotesize\ttfamily void Pump\+Tool\+::left\+Button\+Up (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00412                                                                     \{}
\DoxyCodeLine{00413   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi;}
\DoxyCodeLine{00414 }
\DoxyCodeLine{00415   \textcolor{keywordflow}{if} (!m\_active || !m\_enabled) \textcolor{keywordflow}{goto} cleanup;}
\DoxyCodeLine{00416 }
\DoxyCodeLine{00417   vi = \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00418   \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{goto} cleanup;}
\DoxyCodeLine{00419 }
\DoxyCodeLine{00420   m\_isCtrlPressed = e.isCtrlPressed();}
\DoxyCodeLine{00421 }
\DoxyCodeLine{00422   \{}
\DoxyCodeLine{00423     m\_active = \textcolor{keyword}{false};}
\DoxyCodeLine{00424 }
\DoxyCodeLine{00425     QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{00426 }
\DoxyCodeLine{00427     \textcolor{comment}{// Reset cursor data}}
\DoxyCodeLine{00428     \textcolor{keywordtype}{double} t;}
\DoxyCodeLine{00429     UINT index;}
\DoxyCodeLine{00430     \textcolor{keywordtype}{double} dist2;}
\DoxyCodeLine{00431     \textcolor{keywordflow}{if} (getNearestStrokeWithLock(pos, t, index, dist2)) \{}
\DoxyCodeLine{00432       \mbox{\hyperlink{class_t_stroke}{TStroke}} *nearestStroke = vi-\/>getStroke(index);}
\DoxyCodeLine{00433       \textcolor{keywordflow}{if} (nearestStroke) m\_cursor = nearestStroke-\/>\mbox{\hyperlink{class_t_stroke_ada4f6fc3fea4a7c0b949cd1d9dc6e640}{getThickPoint}}(t);}
\DoxyCodeLine{00434     \}}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00436     \textcolor{keywordflow}{if} (m\_outStroke \&\&}
\DoxyCodeLine{00437         !areAlmostEqual(m\_downPoint, pos, PickRadius * getPixelSize())) \{}
\DoxyCodeLine{00438       \textcolor{comment}{// Accept action}}
\DoxyCodeLine{00439 }
\DoxyCodeLine{00440       \textcolor{comment}{// Clone input stroke -\/ it is someway needed by the stroke change}}
\DoxyCodeLine{00441       \textcolor{comment}{// notifier... I wonder why...}}
\DoxyCodeLine{00442       \mbox{\hyperlink{class_t_stroke}{TStroke}} *oldStroke = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stroke}{TStroke}}(*m\_inStroke);}
\DoxyCodeLine{00443 }
\DoxyCodeLine{00444       m\_outStroke-\/>\mbox{\hyperlink{class_t_stroke_a9c648b7727206be3cd815f8105507694}{swap}}(*m\_inStroke);}
\DoxyCodeLine{00445 }
\DoxyCodeLine{00446       m\_inStroke-\/>\mbox{\hyperlink{class_t_stroke_a03d49743089710215ab6984db1f6e3a2}{invalidate}}();}
\DoxyCodeLine{00447 }
\DoxyCodeLine{00448       \textcolor{keyword}{delete} m\_outStroke;}
\DoxyCodeLine{00449       m\_outStroke = 0;}
\DoxyCodeLine{00450 }
\DoxyCodeLine{00451       assert(m\_undo);}
\DoxyCodeLine{00452       TUndoManager::manager()-\/>add(m\_undo);}
\DoxyCodeLine{00453       m\_undo = 0;}
\DoxyCodeLine{00454 }
\DoxyCodeLine{00455       vi-\/>notifyChangedStrokes(m\_strokeIndex, oldStroke);}
\DoxyCodeLine{00456       \mbox{\hyperlink{class_t_tool_abd1824e9b49705c534e0a773305294c4}{notifyImageChanged}}();}
\DoxyCodeLine{00457 }
\DoxyCodeLine{00458       \textcolor{keyword}{delete} oldStroke;}
\DoxyCodeLine{00459     \}}
\DoxyCodeLine{00460   \}}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462 cleanup:}
\DoxyCodeLine{00463 }
\DoxyCodeLine{00464   \textcolor{keywordflow}{if} (m\_inStroke)}
\DoxyCodeLine{00465     m\_inStroke-\/>\mbox{\hyperlink{class_t_stroke_a33f59dfbed74b577700351eac8c2fc7b}{setStyle}}(}
\DoxyCodeLine{00466         m\_strokeStyleId);  \textcolor{comment}{// Make the image stroke visible again}}
\DoxyCodeLine{00467 }
\DoxyCodeLine{00468   m\_strokeIndex = m\_strokeStyleId = -\/1;}
\DoxyCodeLine{00469 }
\DoxyCodeLine{00470   clearPointerContainer(m\_splitStrokes);}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472   \textcolor{keyword}{delete} m\_outStroke;}
\DoxyCodeLine{00473   m\_inStroke = m\_outStroke = 0;}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475   \textcolor{keyword}{delete} m\_undo;}
\DoxyCodeLine{00476   m\_undo = 0;}
\DoxyCodeLine{00477 }
\DoxyCodeLine{00478   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00479 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_a9a374b95df3b0cb757d48b9889e7ed42}\label{class_pump_tool_a9a374b95df3b0cb757d48b9889e7ed42}} 
\index{PumpTool@{PumpTool}!mouseMove@{mouseMove}}
\index{mouseMove@{mouseMove}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{mouseMove()}{mouseMove()}}
{\footnotesize\ttfamily void Pump\+Tool\+::mouse\+Move (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00491                                                                  \{}
\DoxyCodeLine{00492   \textcolor{keywordflow}{if} (m\_active || !m\_enabled) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00493 }
\DoxyCodeLine{00494   m\_isCtrlPressed = e.isCtrlPressed();}
\DoxyCodeLine{00495 }
\DoxyCodeLine{00496   \textcolor{comment}{// Cursor preview updates on 3-\/pixel steps}}
\DoxyCodeLine{00497   \textcolor{keywordflow}{if} (tdistance2(pos, m\_oldPoint) < 9.0 * sq(getPixelSize())) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00498 }
\DoxyCodeLine{00499   \textcolor{keywordflow}{if} (!m\_draw) m\_draw = \textcolor{keyword}{true};}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501   m\_oldPoint = pos;}
\DoxyCodeLine{00502 }
\DoxyCodeLine{00503   \textcolor{keywordflow}{if} (moveCursor(pos)) \{}
\DoxyCodeLine{00504     m\_cursorEnabled = \textcolor{keyword}{true};}
\DoxyCodeLine{00505     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00506   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00507     m\_cursorEnabled = \textcolor{keyword}{false};}
\DoxyCodeLine{00508 }
\DoxyCodeLine{00509   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00510 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_a32b74e9309f7cafb671ddb75925f5953}\label{class_pump_tool_a32b74e9309f7cafb671ddb75925f5953}} 
\index{PumpTool@{PumpTool}!moveCursor@{moveCursor}}
\index{moveCursor@{moveCursor}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{moveCursor()}{moveCursor()}}
{\footnotesize\ttfamily bool Pump\+Tool\+::move\+Cursor (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00514                                             \{}
\DoxyCodeLine{00515   \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false}));}
\DoxyCodeLine{00516   \textcolor{keywordflow}{if} (vi) \{}
\DoxyCodeLine{00517     \textcolor{keywordtype}{double} t;}
\DoxyCodeLine{00518     UINT index;}
\DoxyCodeLine{00519     \textcolor{keywordtype}{double} dist2;}
\DoxyCodeLine{00520     \textcolor{keywordflow}{if} (getNearestStrokeWithLock(pos, t, index, dist2)) \{}
\DoxyCodeLine{00521       \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke = vi-\/>getStroke(index);}
\DoxyCodeLine{00522       \textcolor{keywordflow}{if} (stroke) \{}
\DoxyCodeLine{00523         m\_cursor = stroke-\/>\mbox{\hyperlink{class_t_stroke_ada4f6fc3fea4a7c0b949cd1d9dc6e640}{getThickPoint}}(t);}
\DoxyCodeLine{00524         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00525       \}}
\DoxyCodeLine{00526     \}}
\DoxyCodeLine{00527   \}}
\DoxyCodeLine{00528 }
\DoxyCodeLine{00529   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00530 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_ae405b450b3312b0ffe1565e64928ce77}\label{class_pump_tool_ae405b450b3312b0ffe1565e64928ce77}} 
\index{PumpTool@{PumpTool}!onDeactivate@{onDeactivate}}
\index{onDeactivate@{onDeactivate}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{onDeactivate()}{onDeactivate()}}
{\footnotesize\ttfamily void Pump\+Tool\+::on\+Deactivate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for tool deactivation, includes tool switch. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a00fee58728c1e12fb50846f47d7e9f5e}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00534                             \{}
\DoxyCodeLine{00535   m\_draw = \textcolor{keyword}{false};}
\DoxyCodeLine{00536   \textcolor{keywordflow}{if} (m\_active) \{}
\DoxyCodeLine{00537     m\_active = \textcolor{keyword}{false};}
\DoxyCodeLine{00538     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00539     assert(!!vi \&\& m\_outStroke);}
\DoxyCodeLine{00540     \textcolor{keywordflow}{if} (!vi || !m\_outStroke) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00541 }
\DoxyCodeLine{00542     clearPointerContainer(m\_splitStrokes);}
\DoxyCodeLine{00543     \textcolor{keywordflow}{if} (m\_splitPars[0] == -\/1) \{}
\DoxyCodeLine{00544       \textcolor{keyword}{delete} m\_outStroke;}
\DoxyCodeLine{00545       m\_outStroke = 0;}
\DoxyCodeLine{00546     \}}
\DoxyCodeLine{00547 }
\DoxyCodeLine{00548     \textcolor{comment}{// restore previous style}}
\DoxyCodeLine{00549     assert(m\_strokeIndex >= 0);}
\DoxyCodeLine{00550     \textcolor{keywordflow}{if} (m\_strokeIndex >= 0) \{}
\DoxyCodeLine{00551       \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke = vi-\/>getStroke(m\_strokeIndex);}
\DoxyCodeLine{00552       stroke-\/>\mbox{\hyperlink{class_t_stroke_a33f59dfbed74b577700351eac8c2fc7b}{setStyle}}(m\_strokeStyleId);}
\DoxyCodeLine{00553     \}}
\DoxyCodeLine{00554 }
\DoxyCodeLine{00555     assert(m\_undo);}
\DoxyCodeLine{00556     \textcolor{keyword}{delete} m\_undo;}
\DoxyCodeLine{00557     m\_undo = 0;}
\DoxyCodeLine{00558 }
\DoxyCodeLine{00559     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00560 }
\DoxyCodeLine{00561     m\_strokeIndex = -\/1;}
\DoxyCodeLine{00562     m\_outStroke   = 0;}
\DoxyCodeLine{00563   \}}
\DoxyCodeLine{00564 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00276}{TTool\+::get\+Image()}}, \mbox{\hyperlink{l00540}{TTool\+::invalidate()}}, and \mbox{\hyperlink{l02370}{TStroke\+::set\+Style()}}.

\mbox{\Hypertarget{class_pump_tool_aa5eba20d789549e7c6f822a4d3c42846}\label{class_pump_tool_aa5eba20d789549e7c6f822a4d3c42846}} 
\index{PumpTool@{PumpTool}!onEnter@{onEnter}}
\index{onEnter@{onEnter}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{onEnter()}{onEnter()}}
{\footnotesize\ttfamily void Pump\+Tool\+::on\+Enter (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for the mouse entering the viewer area. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a3e775cfcd05aa3c35048b11fa40ab3e4}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00145                        \{}
\DoxyCodeLine{00146   m\_draw = \textcolor{keyword}{true};}
\DoxyCodeLine{00147   \textcolor{keywordflow}{if} (TTool::getApplication()-\/>getCurrentObject()-\/>isSpline() ||}
\DoxyCodeLine{00148       !(\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}})\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false})) \{}
\DoxyCodeLine{00149     m\_enabled  = \textcolor{keyword}{false};}
\DoxyCodeLine{00150     m\_cursorId = ToolCursor::CURSOR\_NO;}
\DoxyCodeLine{00151   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00152     m\_enabled  = \textcolor{keyword}{true};}
\DoxyCodeLine{00153     m\_cursorId = ToolCursor::PumpCursor;}
\DoxyCodeLine{00154   \}}
\DoxyCodeLine{00155 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00276}{TTool\+::get\+Image()}}.

\mbox{\Hypertarget{class_pump_tool_a35187a25ecf2bec34b751cd19a89b08a}\label{class_pump_tool_a35187a25ecf2bec34b751cd19a89b08a}} 
\index{PumpTool@{PumpTool}!onLeave@{onLeave}}
\index{onLeave@{onLeave}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{onLeave()}{onLeave()}}
{\footnotesize\ttfamily void Pump\+Tool\+::on\+Leave (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for the mouse leaving the viewer area. 



Reimplemented from \mbox{\hyperlink{class_t_tool_af7fb05265a94131da081da654e271a22}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00568                        \{}
\DoxyCodeLine{00569   \textcolor{keywordflow}{if} (!m\_active) m\_draw = \textcolor{keyword}{false};}
\DoxyCodeLine{00570 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_pump_tool_adb2fb93faa99854e0192b0ebd2dd3e9c}\label{class_pump_tool_adb2fb93faa99854e0192b0ebd2dd3e9c}} 
\index{PumpTool@{PumpTool}!updateTranslation@{updateTranslation}}
\index{updateTranslation@{updateTranslation}!PumpTool@{PumpTool}}
\doxysubsubsection{\texorpdfstring{updateTranslation()}{updateTranslation()}}
{\footnotesize\ttfamily void Pump\+Tool\+::update\+Translation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00104                                     \{}
\DoxyCodeLine{00105     m\_toolSize.setQStringName(tr(\textcolor{stringliteral}{"{}Size:"{}}));}
\DoxyCodeLine{00106     m\_accuracy.setQStringName(tr(\textcolor{stringliteral}{"{}Accuracy:"{}}));}
\DoxyCodeLine{00107   \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnztools/pumptool.\+cpp\end{DoxyCompactItemize}
