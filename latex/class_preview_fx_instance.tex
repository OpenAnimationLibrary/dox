\hypertarget{class_preview_fx_instance}{}\doxysection{Preview\+Fx\+Instance Class Reference}
\label{class_preview_fx_instance}\index{PreviewFxInstance@{PreviewFxInstance}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_preview_fx_instance_1_1_frame_info}{Frame\+Info}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_preview_fx_instance_af11e5a714c2df3809fbbbed659ee5413}{Preview\+Fx\+Instance}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsh)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a62670059421d064d977abe0fbe33f3fb}{add\+Flipbook}} (\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$\&flipbook)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a57e09100813885795ae780781b8bc55c}{detach\+Flipbook}} (\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$flipbook)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a2ff7e815cd92558d26de7315360d1c24}{update\+Flipbooks}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a0e2a13a03afc8e7ab8c4a309a12b5e7a}{refresh\+View\+Rects}} (bool rebuild=false)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a2bfb1e7aff8c279a35914d21e3a8e1b1}{reset}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_af533f6caaf4610d3d2abdff3ef8b0e50}{reset}} (int frame)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_aaa4e664b16cecbb0dab05bb78a1d6040}{update\+Frame\+Range}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a833839c7ed6a4d73f60009c3ad97d5fa}{update\+Initial\+Frame}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a7a33819dffd6795da4c6e8bf455dcc48}{update\+Render\+Settings}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_aa6f20d2d48bdc184c450da167ad34bf1}{update\+Camera}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a89ffdad38d8543ffed86df5bf22200a5}{update\+Flipbook\+Titles}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a760f8462936389aedfbde7fa6aa7acab}{update\+Preview\+Rect}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a7a94e101ac882fe90c6be5b07cee7d4e}{update\+Aliases}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a84580d14b2e2b4c74b281f4c9b6ef1eb}{update\+Alias\+Keyword}} (const std\+::string \&keyword)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a13fd49615c00e7f9b64d00669825db05}{update\+Progress\+Bar\+Status}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a3446aec5136735b6ff46252bcbe31c63}{on\+Render\+Raster\+Started}} (const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&render\+Data)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a4cba19459b82cb62f421e5ce318a5203}{on\+Render\+Raster\+Completed}} (const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&render\+Data)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_a3fe7eae13164cc0bd28f168cb7f0e07a}{on\+Render\+Failure}} (const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&render\+Data, \mbox{\hyperlink{class_t_exception}{TException}} \&e)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_afd6d3b954582af841ebdd2d5c8280a41}{on\+Render\+Finished}} (bool is\+Canceled=false)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_ae458548c9a63bb85c73d4f8f799a8ede}{do\+On\+Render\+Raster\+Completed}} (const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&render\+Data)
\item 
void \mbox{\hyperlink{class_preview_fx_instance_ad17a88cfd8ba639ad7f68ab55526b83f}{do\+On\+Render\+Raster\+Started}} (const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&render\+Data)
\item 
bool \mbox{\hyperlink{class_preview_fx_instance_a9d23c0846fa6216b977b72497240d757}{is\+Sub\+Camera\+Active}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TXsheetP}} \mbox{\hyperlink{class_preview_fx_instance_ae458618a79dfa77a6368ea6155594ba8}{m\+\_\+xsheet}}
\item 
\mbox{\hyperlink{class_t_raster_fx_p}{TRaster\+FxP}} \mbox{\hyperlink{class_preview_fx_instance_adf8267a27dea336c0cc22206290a526c}{m\+\_\+fx}}
\item 
\mbox{\hyperlink{class_t_renderer}{TRenderer}} \mbox{\hyperlink{class_preview_fx_instance_a37176275251d167c39f288cffa3d9db8}{m\+\_\+renderer}}
\item 
\mbox{\hyperlink{class_preview_fx_render_port}{Preview\+Fx\+Render\+Port}} \mbox{\hyperlink{class_preview_fx_instance_a2481fc8217bbcb1cd7cfa138c57fb9ab}{m\+\_\+render\+Port}}
\item 
std\+::set$<$ \mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$ $>$ \mbox{\hyperlink{class_preview_fx_instance_a1df3c0f57e8b4d027d946e469a9dfa3d}{m\+\_\+flipbooks}}
\item 
std\+::set$<$ \mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$ $>$ \mbox{\hyperlink{class_preview_fx_instance_acf53b066078651d94ae3bfc6e3b27f36}{m\+\_\+frozen\+Flips}}
\item 
int \mbox{\hyperlink{class_preview_fx_instance_a9b0380d271511993f9c73e73b73c9f83}{m\+\_\+start}}
\item 
int \mbox{\hyperlink{class_preview_fx_instance_acd645c4651a4caaa37f4207da9e95fb8}{m\+\_\+end}}
\item 
int \mbox{\hyperlink{class_preview_fx_instance_aff987233f3fbdab7926151756c15bb9a}{m\+\_\+step}}
\item 
int \mbox{\hyperlink{class_preview_fx_instance_a91462407184b2a258d767c7a506b2bd4}{m\+\_\+init\+Frame}}
\item 
std\+::map$<$ int, \mbox{\hyperlink{struct_preview_fx_instance_1_1_frame_info}{Frame\+Info}} $>$ \mbox{\hyperlink{class_preview_fx_instance_ad2945d4a198b601412679971468e04fc}{m\+\_\+frame\+Infos}}
\item 
std\+::vector$<$ UCHAR $>$ \mbox{\hyperlink{class_preview_fx_instance_a5f44679fa5a96fd4f66190197ae2fdaf}{m\+\_\+pb\+Status}}
\item 
\mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \mbox{\hyperlink{class_preview_fx_instance_a72a5fd83f86f755bb74739e8e571d519}{m\+\_\+render\+Settings}}
\item 
\mbox{\hyperlink{class_t_dimension_t}{TDimension}} \mbox{\hyperlink{class_preview_fx_instance_af0a1470869572b13c1923efc4d1ddd1d}{m\+\_\+camera\+Res}}
\item 
\mbox{\hyperlink{class_t_rect_t}{TRectD}} \mbox{\hyperlink{class_preview_fx_instance_a6a481fbc7aa26bed908d6979d09435f6}{m\+\_\+render\+Area}}
\item 
\mbox{\hyperlink{class_t_point_t}{TPointD}} \mbox{\hyperlink{class_preview_fx_instance_a2fefab9c159e69dbabdc7e3e81972493}{m\+\_\+camera\+Pos}}
\item 
\mbox{\hyperlink{class_t_point_t}{TPointD}} \mbox{\hyperlink{class_preview_fx_instance_a0235643057d471bbdee8c4f60857c021}{m\+\_\+subcamera\+Displacement}}
\item 
bool \mbox{\hyperlink{class_preview_fx_instance_ad7d9755fdec873845d63c95f239adccc}{m\+\_\+subcamera}}
\item 
QRegion \mbox{\hyperlink{class_preview_fx_instance_aaf166a23e002b732e6afbd0fc797e076}{m\+\_\+overall\+Rendered\+Region}}
\item 
\mbox{\hyperlink{class_t_rect_t}{TRect}} \mbox{\hyperlink{class_preview_fx_instance_ad2365971deca81f301c2898789351839}{m\+\_\+rect\+Under\+Render}}
\item 
bool \mbox{\hyperlink{class_preview_fx_instance_a065668bc0367d4af37c6d8003102ae5b}{m\+\_\+render\+Failed}}
\item 
\mbox{\hyperlink{class_t_level_p}{TLevelP}} \mbox{\hyperlink{class_preview_fx_instance_af213db1fe5bafb80ae759aac9783f0d0}{m\+\_\+level}}
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \mbox{\hyperlink{class_preview_fx_instance_a957b9772662f913b3900ff61c24fa7fe}{m\+\_\+snd}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_preview_fx_instance_af11e5a714c2df3809fbbbed659ee5413}\label{class_preview_fx_instance_af11e5a714c2df3809fbbbed659ee5413}} 
\index{PreviewFxInstance@{PreviewFxInstance}!PreviewFxInstance@{PreviewFxInstance}}
\index{PreviewFxInstance@{PreviewFxInstance}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{PreviewFxInstance()}{PreviewFxInstance()}}
{\footnotesize\ttfamily Preview\+Fx\+Instance\+::\+Preview\+Fx\+Instance (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}}]{fx,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsh }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00343     : m\_renderer(TSystem::getProcessorCount())}
\DoxyCodeLine{00344     , m\_renderPort(\textcolor{keyword}{this})}
\DoxyCodeLine{00345     , m\_fx(fx)}
\DoxyCodeLine{00346     , m\_cameraRes(0, 0)}
\DoxyCodeLine{00347     , m\_start(0)}
\DoxyCodeLine{00348     , m\_end(-\/1)}
\DoxyCodeLine{00349     , m\_initFrame(0)}
\DoxyCodeLine{00350     , m\_xsheet(xsh) \{}
\DoxyCodeLine{00351   \textcolor{comment}{// Install the render port on the instance renderer}}
\DoxyCodeLine{00352   m\_renderer.addPort(\&m\_renderPort);}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354   updateRenderSettings();}
\DoxyCodeLine{00355   updateCamera();}
\DoxyCodeLine{00356   updateFrameRange();}
\DoxyCodeLine{00357   updateAliases();}
\DoxyCodeLine{00358 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a0b6467ab267da6b4ee75dc2d5d0b600d}\label{class_preview_fx_instance_a0b6467ab267da6b4ee75dc2d5d0b600d}} 
\index{PreviewFxInstance@{PreviewFxInstance}!````~PreviewFxInstance@{$\sim$PreviewFxInstance}}
\index{````~PreviewFxInstance@{$\sim$PreviewFxInstance}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{$\sim$PreviewFxInstance()}{~PreviewFxInstance()}}
{\footnotesize\ttfamily Preview\+Fx\+Instance\+::$\sim$\+Preview\+Fx\+Instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00362                                       \{}
\DoxyCodeLine{00363   \textcolor{comment}{// Stop the render -\/ there is no need to wait for a complete (and blocking)}}
\DoxyCodeLine{00364   \textcolor{comment}{// render stop.}}
\DoxyCodeLine{00365   m\_renderer.removePort(}
\DoxyCodeLine{00366       \&m\_renderPort);  \textcolor{comment}{// No more images to be stored in the cache!}}
\DoxyCodeLine{00367   m\_renderer.stopRendering();}
\DoxyCodeLine{00368 }
\DoxyCodeLine{00369   \textcolor{comment}{// Release the user cache about this instance}}
\DoxyCodeLine{00370   std::string contextName(\textcolor{stringliteral}{"{}PFX"{}});}
\DoxyCodeLine{00371   contextName += std::to\_string(m\_fx-\/>getIdentifier());}
\DoxyCodeLine{00372   TPassiveCacheManager::instance()-\/>releaseContextNamesWithPrefix(contextName);}
\DoxyCodeLine{00373 }
\DoxyCodeLine{00374   \textcolor{comment}{// Clear the cached images}}
\DoxyCodeLine{00375   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00376   \textcolor{keywordflow}{for} (i = m\_start; i <= m\_end; i += m\_step)}
\DoxyCodeLine{00377     TImageCache::instance()-\/>remove(getCacheId(m\_fx, i));}
\DoxyCodeLine{00378 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_preview_fx_instance_a62670059421d064d977abe0fbe33f3fb}\label{class_preview_fx_instance_a62670059421d064d977abe0fbe33f3fb}} 
\index{PreviewFxInstance@{PreviewFxInstance}!addFlipbook@{addFlipbook}}
\index{addFlipbook@{addFlipbook}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{addFlipbook()}{addFlipbook()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::add\+Flipbook (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$\&}]{flipbook }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00418                                                        \{}
\DoxyCodeLine{00419   \mbox{\hyperlink{class_t_app}{TApp}} *app         = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{00420   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{00421   \mbox{\hyperlink{class_t_output_properties}{TOutputProperties}} *properties =}
\DoxyCodeLine{00422       scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_a0b905e0ea16e27aa5e67da31e469026e}{getPreviewProperties}}();}
\DoxyCodeLine{00423 }
\DoxyCodeLine{00424   \textcolor{keywordtype}{int} currFrame = flipbook ? flipbook-\/>getCurrentFrame() -\/ 1}
\DoxyCodeLine{00425                            : app-\/>\mbox{\hyperlink{class_t_app_a35516f8175dab3ccdf3d6d3c3e5f59ae}{getCurrentFrame}}()-\/>getFrame();}
\DoxyCodeLine{00426   cropAndStep(currFrame);}
\DoxyCodeLine{00427 }
\DoxyCodeLine{00428   \textcolor{keywordflow}{if} (!flipbook) \{}
\DoxyCodeLine{00429     \textcolor{comment}{/*-\/-\/ 使用可能なFlipbookを取り出す。Poolに無い場合は新たに作る -\/-\/*/}}
\DoxyCodeLine{00430     flipbook = FlipBookPool::instance()-\/>\mbox{\hyperlink{class_flip_book_pool_aa110af5e7e2650be4540744f53de314b}{pop}}();}
\DoxyCodeLine{00431 }
\DoxyCodeLine{00432     \textcolor{comment}{// In case this is a subcamera preview, fit the flipbook's view. This is}}
\DoxyCodeLine{00433     \textcolor{comment}{// done *before* associating}}
\DoxyCodeLine{00434     \textcolor{comment}{// m\_fx to the flipbook (using Flipbook::setLevel) -\/ so there is no}}
\DoxyCodeLine{00435     \textcolor{comment}{// duplicate view refresh.}}
\DoxyCodeLine{00436     \textcolor{comment}{/*-\/-\/ Preview Settingsで"{}Use Sub Camera"{}}}
\DoxyCodeLine{00437 \textcolor{comment}{     * がONのとき、サブカメラ枠の外は計算しないようになる -\/-\/*/}}
\DoxyCodeLine{00438     \textcolor{keywordflow}{if} (m\_subcamera) \{}
\DoxyCodeLine{00439       \textcolor{comment}{// result-\/>adaptGeometry(TRect(previewInstance-\/>m\_cameraRes));   //This}}
\DoxyCodeLine{00440       \textcolor{comment}{// one fits the panel, too.}}
\DoxyCodeLine{00441       adaptView(flipbook, m\_cameraRes);  \textcolor{comment}{// This one adapts the view. If has}}
\DoxyCodeLine{00442                                          \textcolor{comment}{// associated fx, calls refresh...}}
\DoxyCodeLine{00443     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00444       \textcolor{comment}{// Retrieve the eventual sub-\/camera}}
\DoxyCodeLine{00445       \mbox{\hyperlink{class_t_camera}{TCamera}} *currCamera = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()}
\DoxyCodeLine{00446                                 -\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()}
\DoxyCodeLine{00447                                 -\/>getScene()}
\DoxyCodeLine{00448                                 -\/>getCurrentPreviewCamera();}
\DoxyCodeLine{00449       \mbox{\hyperlink{class_t_rect_t}{TRect}} subcameraRect(currCamera-\/>\mbox{\hyperlink{class_t_camera_ad95e2b9f128939f1ce9777623643c69c}{getInterestRect}}());}
\DoxyCodeLine{00450       \textcolor{comment}{/*-\/-\/ Viewer上でサブカメラが指定されている状態でFxPreviewをした場合 -\/-\/*/}}
\DoxyCodeLine{00451       \textcolor{keywordflow}{if} (subcameraRect.getLx() > 0 \&\& subcameraRect.getLy() > 0) \{}
\DoxyCodeLine{00452         \textcolor{comment}{/*-\/-\/ サブカメラ枠のShrink -\/-\/*/}}
\DoxyCodeLine{00453         \textcolor{keywordflow}{if} (m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_a52dd41881bbf6aaf953fe300be2e233e}{m\_shrinkX}} > 1 || m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_ae1882f584ce9ffad12ce6bf9ff23814c}{m\_shrinkY}} > 1) \{}
\DoxyCodeLine{00454           subcameraRect.x0 /= m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_a52dd41881bbf6aaf953fe300be2e233e}{m\_shrinkX}};}
\DoxyCodeLine{00455           subcameraRect.y0 /= m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_ae1882f584ce9ffad12ce6bf9ff23814c}{m\_shrinkY}};}
\DoxyCodeLine{00456           subcameraRect.x1 =}
\DoxyCodeLine{00457               (subcameraRect.x1 + 1) / m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_a52dd41881bbf6aaf953fe300be2e233e}{m\_shrinkX}} -\/ 1;}
\DoxyCodeLine{00458           subcameraRect.y1 =}
\DoxyCodeLine{00459               (subcameraRect.y1 + 1) / m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_ae1882f584ce9ffad12ce6bf9ff23814c}{m\_shrinkY}} -\/ 1;}
\DoxyCodeLine{00460         \}}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462         \textcolor{comment}{// Fit \& pan the panel to cover the sub-\/camera}}
\DoxyCodeLine{00463         flipbook-\/>adaptGeometry(subcameraRect, \mbox{\hyperlink{class_t_rect_t}{TRect}}(\mbox{\hyperlink{class_t_point_t}{TPoint}}(), m\_cameraRes));}
\DoxyCodeLine{00464       \}}
\DoxyCodeLine{00465     \}}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467     \textcolor{comment}{/*-\/-\/ フリーズボタンの表示 -\/-\/*/}}
\DoxyCodeLine{00468     flipbook-\/>\mbox{\hyperlink{class_flip_book_ad87f98266b74bb91a7bf6588924abba5}{addFreezeButtonToTitleBar}}();}
\DoxyCodeLine{00469   \}}
\DoxyCodeLine{00470 }
\DoxyCodeLine{00471   m\_flipbooks.insert(flipbook);}
\DoxyCodeLine{00472 }
\DoxyCodeLine{00473   \textcolor{comment}{/*-\/-\/ タイトルの設定。Previewコマンドから呼ばれた場合はisFullPreviewがON -\/-\/*/}}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475   \textcolor{comment}{// Build the fx string description -\/ Should really be moved in a better}}
\DoxyCodeLine{00476   \textcolor{comment}{// function...}}
\DoxyCodeLine{00477   std::wstring fxId;}
\DoxyCodeLine{00478   \mbox{\hyperlink{class_t_level_column_fx}{TLevelColumnFx}} *columnFx = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_level_column_fx}{TLevelColumnFx}} *\textcolor{keyword}{>}(m\_fx.getPointer());}
\DoxyCodeLine{00479   \mbox{\hyperlink{class_t_zerary_column_fx}{TZeraryColumnFx}} *sfx     = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_zerary_column_fx}{TZeraryColumnFx}} *\textcolor{keyword}{>}(m\_fx.getPointer());}
\DoxyCodeLine{00480   \textcolor{keywordflow}{if} (columnFx)}
\DoxyCodeLine{00481     fxId =}
\DoxyCodeLine{00482         L\textcolor{stringliteral}{"{}Col"{}} + QString::number(columnFx-\/>getColumnIndex() + 1).toStdWString();}
\DoxyCodeLine{00483   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sfx)}
\DoxyCodeLine{00484     fxId = sfx-\/>getZeraryFx()-\/>getFxId();}
\DoxyCodeLine{00485   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00486     fxId = m\_fx-\/>getFxId();}
\DoxyCodeLine{00487     \textcolor{keywordflow}{if} (fxId.empty()) fxId = m\_fx-\/>getName();}
\DoxyCodeLine{00488   \}}
\DoxyCodeLine{00489 }
\DoxyCodeLine{00490   \textcolor{comment}{// Adjust the flipbook appropriately}}
\DoxyCodeLine{00491 }
\DoxyCodeLine{00492   \textcolor{comment}{// Decorate the description for the flipbook}}
\DoxyCodeLine{00493   \textcolor{keywordflow}{if} (isFullPreview()) \{}
\DoxyCodeLine{00494     flipbook-\/>setTitle(}
\DoxyCodeLine{00495         \textcolor{comment}{/*"{}Rendered Frames  ::  From "{} + QString::number(m\_start+1) +}}
\DoxyCodeLine{00496 \textcolor{comment}{            "{} To "{} + QString::number(m\_end+1) +}}
\DoxyCodeLine{00497 \textcolor{comment}{     "{}  ::  Step "{} + QString::number(m\_step)*/}}
\DoxyCodeLine{00498         QObject::tr(\textcolor{stringliteral}{"{}Rendered Frames  ::  From \%1 To \%2  ::  Step \%3"{}})}
\DoxyCodeLine{00499             .arg(QString::number(m\_start + 1))}
\DoxyCodeLine{00500             .arg(QString::number(m\_end + 1))}
\DoxyCodeLine{00501             .arg(QString::number(m\_step)));}
\DoxyCodeLine{00502     \mbox{\hyperlink{class_t_xsheet_1_1_sound_properties}{TXsheet::SoundProperties}} *prop = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_xsheet_1_1_sound_properties}{TXsheet::SoundProperties}}();}
\DoxyCodeLine{00503     prop-\/>m\_frameRate              = properties-\/>\mbox{\hyperlink{class_t_output_properties_a0d9662971bc33097aa1b55111965b967}{getFrameRate}}();}
\DoxyCodeLine{00504     m\_snd                          = m\_xsheet-\/>makeSound(prop);}
\DoxyCodeLine{00505     \textcolor{keywordflow}{if} (Preferences::instance()-\/>fitToFlipbookEnabled())}
\DoxyCodeLine{00506       flipbook-\/>getImageViewer()-\/>\mbox{\hyperlink{class_image_viewer_aaad0ef7fa1fb0ed91e36026e5e520e6d}{adaptView}}(\mbox{\hyperlink{class_t_rect_t}{TRect}}(m\_cameraRes),}
\DoxyCodeLine{00507                                             \mbox{\hyperlink{class_t_rect_t}{TRect}}(m\_cameraRes));}
\DoxyCodeLine{00508 }
\DoxyCodeLine{00509   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00510     flipbook-\/>setTitle(}
\DoxyCodeLine{00511         QObject::tr(\textcolor{stringliteral}{"{}Preview FX :: \%1 "{}}).arg(QString::fromStdWString(fxId)));}
\DoxyCodeLine{00512 }
\DoxyCodeLine{00513   \textcolor{comment}{// In case the render is a full preview, add the soundtrack}}
\DoxyCodeLine{00514 }
\DoxyCodeLine{00515   \textcolor{comment}{// Associate the rendered level to flipbook}}
\DoxyCodeLine{00516   flipbook-\/>\mbox{\hyperlink{class_flip_book_ac70c72b88200e2821ea83f4273cb34e4}{setLevel}}(m\_fx.getPointer(), m\_xsheet.getPointer(),}
\DoxyCodeLine{00517                      m\_level.getPointer(), 0, m\_start + 1, m\_end + 1, m\_step,}
\DoxyCodeLine{00518                      currFrame + 1, m\_snd.getPointer());}
\DoxyCodeLine{00519 }
\DoxyCodeLine{00520   \textcolor{comment}{// Add the progress bar status pointer}}
\DoxyCodeLine{00521   flipbook-\/>setProgressBarStatus(\&m\_pbStatus);}
\DoxyCodeLine{00522 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a57e09100813885795ae780781b8bc55c}\label{class_preview_fx_instance_a57e09100813885795ae780781b8bc55c}} 
\index{PreviewFxInstance@{PreviewFxInstance}!detachFlipbook@{detachFlipbook}}
\index{detachFlipbook@{detachFlipbook}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{detachFlipbook()}{detachFlipbook()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::detach\+Flipbook (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$}]{flipbook }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00526                                                          \{}
\DoxyCodeLine{00527   \textcolor{comment}{// Just remove the flipbook from the flipbooks container}}
\DoxyCodeLine{00528   std::set<FlipBook *>::iterator it = m\_flipbooks.find(flipbook);}
\DoxyCodeLine{00529   \textcolor{keywordflow}{if} (it == m\_flipbooks.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531   m\_flipbooks.erase(it);}
\DoxyCodeLine{00532 }
\DoxyCodeLine{00533   \textcolor{comment}{// If the flipbook set associated with the render is now empty, stop the}}
\DoxyCodeLine{00534   \textcolor{comment}{// render}}
\DoxyCodeLine{00535   \textcolor{keywordflow}{if} (m\_flipbooks.empty()) m\_renderer.stopRendering();}
\DoxyCodeLine{00536 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_ae458548c9a63bb85c73d4f8f799a8ede}\label{class_preview_fx_instance_ae458548c9a63bb85c73d4f8f799a8ede}} 
\index{PreviewFxInstance@{PreviewFxInstance}!doOnRenderRasterCompleted@{doOnRenderRasterCompleted}}
\index{doOnRenderRasterCompleted@{doOnRenderRasterCompleted}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{doOnRenderRasterCompleted()}{doOnRenderRasterCompleted()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::do\+On\+Render\+Raster\+Completed (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&}]{render\+Data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01060                                              \{}
\DoxyCodeLine{01061   std::string cacheId(getCacheId(m\_fx, renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_af4f12632267aa8902e5738bc5e04e9d5}{m\_frames}}[0]));}
\DoxyCodeLine{01062 }
\DoxyCodeLine{01063   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri(TImageCache::instance()-\/>get(cacheId, \textcolor{keyword}{true}));}
\DoxyCodeLine{01064   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras;}
\DoxyCodeLine{01065   \textcolor{keywordflow}{if} (ri)}
\DoxyCodeLine{01066     ras = ri-\/>getRaster();}
\DoxyCodeLine{01067   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01068     ras = 0;}
\DoxyCodeLine{01069 }
\DoxyCodeLine{01070   \textcolor{comment}{/*-\/-\/ 16bpcで計算された場合、結果をDitheringする -\/-\/*/}}
\DoxyCodeLine{01071   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} rasA = renderData.m\_rasA;}
\DoxyCodeLine{01072   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} rasB = renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_a9294fb22acd75bb3d06ac5941ab35c45}{m\_rasB}};}
\DoxyCodeLine{01073   \textcolor{comment}{// dither the 16bpc image IF the "{}30bit display"{} preference option is OFF}}
\DoxyCodeLine{01074   \textcolor{keywordflow}{if} (rasA-\/>getPixelSize() == 8 \&\&}
\DoxyCodeLine{01075       !Preferences::instance()-\/>is30bitDisplayEnabled())  \textcolor{comment}{// render in 64 bits}}
\DoxyCodeLine{01076   \{}
\DoxyCodeLine{01077     \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} auxA(rasA-\/>getLx(), rasA-\/>getLy());}
\DoxyCodeLine{01078     \mbox{\hyperlink{namespace_t_rop_a45a08fb48dd7d33ec629d722081d55c6}{TRop::convert}}(auxA, rasA);  \textcolor{comment}{// dithering}}
\DoxyCodeLine{01079     rasA = auxA;}
\DoxyCodeLine{01080     \textcolor{keywordflow}{if} (m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_aadbd5a3a50b242b366a93023d5f7da07}{m\_stereoscopic}}) \{}
\DoxyCodeLine{01081       assert(rasB);}
\DoxyCodeLine{01082       \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} auxB(rasB-\/>getLx(), rasB-\/>getLy());}
\DoxyCodeLine{01083       \mbox{\hyperlink{namespace_t_rop_a45a08fb48dd7d33ec629d722081d55c6}{TRop::convert}}(auxB, rasB);  \textcolor{comment}{// dithering}}
\DoxyCodeLine{01084       rasB = auxB;}
\DoxyCodeLine{01085     \}}
\DoxyCodeLine{01086   \}}
\DoxyCodeLine{01087 }
\DoxyCodeLine{01088   \textcolor{keywordflow}{if} (!ras || (ras-\/>getSize() != m\_cameraRes)) \{}
\DoxyCodeLine{01089     TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove}}(cacheId);}
\DoxyCodeLine{01090 }
\DoxyCodeLine{01091     \textcolor{comment}{// Create the raster at camera resolution}}
\DoxyCodeLine{01092     ras = rasA-\/>create(m\_cameraRes.lx, m\_cameraRes.ly);}
\DoxyCodeLine{01093     ras-\/>clear();}
\DoxyCodeLine{01094     ri = \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}}(ras);}
\DoxyCodeLine{01095   \}}
\DoxyCodeLine{01096 }
\DoxyCodeLine{01097   \textcolor{comment}{// Finally, copy the rendered raster over the cached one}}
\DoxyCodeLine{01098   \mbox{\hyperlink{class_t_rect_t}{TRect}} rectUnderRender(}
\DoxyCodeLine{01099       m\_rectUnderRender);  \textcolor{comment}{// Extract may MODIFY IT! E.g. with shrinks..!}}
\DoxyCodeLine{01100   ras = ras-\/>extract(rectUnderRender);}
\DoxyCodeLine{01101   \textcolor{keywordflow}{if} (ras) \{}
\DoxyCodeLine{01102     \textcolor{keywordflow}{if} (m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_aadbd5a3a50b242b366a93023d5f7da07}{m\_stereoscopic}}) \{}
\DoxyCodeLine{01103       assert(rasB);}
\DoxyCodeLine{01104       TRop::makeStereoRaster(rasA, rasB);}
\DoxyCodeLine{01105     \}}
\DoxyCodeLine{01106     ras-\/>copy(rasA);}
\DoxyCodeLine{01107   \}}
\DoxyCodeLine{01108   \textcolor{comment}{// Submit the image to the cache, for all cluster's frames}}
\DoxyCodeLine{01109   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i, size = renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_af4f12632267aa8902e5738bc5e04e9d5}{m\_frames}}.size();}
\DoxyCodeLine{01110   \textcolor{keywordflow}{for} (i = 0; i < size; ++i) \{}
\DoxyCodeLine{01111     \textcolor{keywordtype}{int} frame = renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_af4f12632267aa8902e5738bc5e04e9d5}{m\_frames}}[i];}
\DoxyCodeLine{01112     TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a124eae4cf370288f42c22b3477cb5163}{add}}(getCacheId(m\_fx, frame), ri);}
\DoxyCodeLine{01113 }
\DoxyCodeLine{01114     \textcolor{comment}{// Update the pb status}}
\DoxyCodeLine{01115     \textcolor{keywordtype}{int} pbIndex = (frame -\/ m\_start) / m\_step;}
\DoxyCodeLine{01116     \textcolor{keywordflow}{if} (pbIndex >= 0 \&\& pbIndex < (\textcolor{keywordtype}{int})m\_pbStatus.size())}
\DoxyCodeLine{01117       m\_pbStatus[pbIndex] = FlipSlider::PBFrameFinished;}
\DoxyCodeLine{01118 }
\DoxyCodeLine{01119     \textcolor{comment}{// Update the frame-\/specific rendered region}}
\DoxyCodeLine{01120     std::map<int, FrameInfo>::iterator jt = m\_frameInfos.find(frame);}
\DoxyCodeLine{01121     assert(jt != m\_frameInfos.end());}
\DoxyCodeLine{01122     jt-\/>second.m\_renderedRegion += toQRect(m\_rectUnderRender);}
\DoxyCodeLine{01123 }
\DoxyCodeLine{01124     std::set<FlipBook *>::iterator it;}
\DoxyCodeLine{01125     \textcolor{keywordtype}{int} renderedFrame = frame + 1;}
\DoxyCodeLine{01126     \textcolor{keywordflow}{for} (it = m\_flipbooks.begin(); it != m\_flipbooks.end(); ++it)}
\DoxyCodeLine{01127       \textcolor{keywordflow}{if} ((*it)-\/>getCurrentFrame() == renderedFrame)}
\DoxyCodeLine{01128         (*it)-\/>showFrame(renderedFrame);}
\DoxyCodeLine{01129   \}}
\DoxyCodeLine{01130 }
\DoxyCodeLine{01131   updateFlipbooks();}
\DoxyCodeLine{01132 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_ad17a88cfd8ba639ad7f68ab55526b83f}\label{class_preview_fx_instance_ad17a88cfd8ba639ad7f68ab55526b83f}} 
\index{PreviewFxInstance@{PreviewFxInstance}!doOnRenderRasterStarted@{doOnRenderRasterStarted}}
\index{doOnRenderRasterStarted@{doOnRenderRasterStarted}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{doOnRenderRasterStarted()}{doOnRenderRasterStarted()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::do\+On\+Render\+Raster\+Started (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&}]{render\+Data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01041                                              \{}
\DoxyCodeLine{01042   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i, size = renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_af4f12632267aa8902e5738bc5e04e9d5}{m\_frames}}.size();}
\DoxyCodeLine{01043   \textcolor{keywordflow}{for} (i = 0; i < size; ++i)}
\DoxyCodeLine{01044     \textcolor{comment}{// Update the pb status for each cluster's frame}}
\DoxyCodeLine{01045     m\_pbStatus[(renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_af4f12632267aa8902e5738bc5e04e9d5}{m\_frames}}[i] -\/ m\_start) / m\_step] =}
\DoxyCodeLine{01046         FlipSlider::PBFrameStarted;}
\DoxyCodeLine{01047 }
\DoxyCodeLine{01048   \textcolor{comment}{/*-\/-\/ 計算中の赤枠を表示する -\/-\/*/}}
\DoxyCodeLine{01049   std::set<FlipBook *>::iterator it;}
\DoxyCodeLine{01050   \textcolor{keywordflow}{for} (it = m\_flipbooks.begin(); it != m\_flipbooks.end(); ++it)}
\DoxyCodeLine{01051     (*it)-\/>setIsRemakingPreviewFx(\textcolor{keyword}{true});}
\DoxyCodeLine{01052 }
\DoxyCodeLine{01053   updateFlipbooks();}
\DoxyCodeLine{01054 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a9d23c0846fa6216b977b72497240d757}\label{class_preview_fx_instance_a9d23c0846fa6216b977b72497240d757}} 
\index{PreviewFxInstance@{PreviewFxInstance}!isSubCameraActive@{isSubCameraActive}}
\index{isSubCameraActive@{isSubCameraActive}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{isSubCameraActive()}{isSubCameraActive()}}
{\footnotesize\ttfamily bool Preview\+Fx\+Instance\+::is\+Sub\+Camera\+Active (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00250 \{ \textcolor{keywordflow}{return} m\_subcamera; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a3fe7eae13164cc0bd28f168cb7f0e07a}\label{class_preview_fx_instance_a3fe7eae13164cc0bd28f168cb7f0e07a}} 
\index{PreviewFxInstance@{PreviewFxInstance}!onRenderFailure@{onRenderFailure}}
\index{onRenderFailure@{onRenderFailure}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{onRenderFailure()}{onRenderFailure()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::on\+Render\+Failure (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&}]{render\+Data,  }\item[{\mbox{\hyperlink{class_t_exception}{TException}} \&}]{e }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01137                                                             \{}
\DoxyCodeLine{01138   m\_renderFailed = \textcolor{keyword}{true};}
\DoxyCodeLine{01139 }
\DoxyCodeLine{01140   \textcolor{comment}{// Update each frame status}}
\DoxyCodeLine{01141   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i, size = renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_af4f12632267aa8902e5738bc5e04e9d5}{m\_frames}}.size();}
\DoxyCodeLine{01142   \textcolor{keywordflow}{for} (i = 0; i < size; ++i) \{}
\DoxyCodeLine{01143     \textcolor{keywordtype}{int} frame = renderData.\mbox{\hyperlink{struct_t_render_port_1_1_render_data_af4f12632267aa8902e5738bc5e04e9d5}{m\_frames}}[i];}
\DoxyCodeLine{01144 }
\DoxyCodeLine{01145     \textcolor{comment}{// Update the pb status}}
\DoxyCodeLine{01146     \textcolor{keywordtype}{int} pbIndex = (frame -\/ m\_start) / m\_step;}
\DoxyCodeLine{01147     \textcolor{keywordflow}{if} (pbIndex >= 0 \&\& pbIndex < (\textcolor{keywordtype}{int})m\_pbStatus.size())}
\DoxyCodeLine{01148       m\_pbStatus[pbIndex] = FlipSlider::PBFrameNotStarted;}
\DoxyCodeLine{01149   \}}
\DoxyCodeLine{01150 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_afd6d3b954582af841ebdd2d5c8280a41}\label{class_preview_fx_instance_afd6d3b954582af841ebdd2d5c8280a41}} 
\index{PreviewFxInstance@{PreviewFxInstance}!onRenderFinished@{onRenderFinished}}
\index{onRenderFinished@{onRenderFinished}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{onRenderFinished()}{onRenderFinished()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::on\+Render\+Finished (\begin{DoxyParamCaption}\item[{bool}]{is\+Canceled = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01154                                                         \{}
\DoxyCodeLine{01155   \textcolor{comment}{// Update the rendered region}}
\DoxyCodeLine{01156   \textcolor{keywordflow}{if} (!m\_renderFailed \&\& !isCanceled)}
\DoxyCodeLine{01157     m\_overallRenderedRegion += toQRect(m\_rectUnderRender);}
\DoxyCodeLine{01158 }
\DoxyCodeLine{01159   \textcolor{comment}{/*-\/-\/ 計算中の赤枠の表示を消す -\/-\/*/}}
\DoxyCodeLine{01160   std::set<FlipBook *>::iterator it;}
\DoxyCodeLine{01161   \textcolor{keywordflow}{for} (it = m\_flipbooks.begin(); it != m\_flipbooks.end(); ++it)}
\DoxyCodeLine{01162     (*it)-\/>setIsRemakingPreviewFx(\textcolor{keyword}{false});}
\DoxyCodeLine{01163 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a4cba19459b82cb62f421e5ce318a5203}\label{class_preview_fx_instance_a4cba19459b82cb62f421e5ce318a5203}} 
\index{PreviewFxInstance@{PreviewFxInstance}!onRenderRasterCompleted@{onRenderRasterCompleted}}
\index{onRenderRasterCompleted@{onRenderRasterCompleted}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{onRenderRasterCompleted()}{onRenderRasterCompleted()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::on\+Render\+Raster\+Completed (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&}]{render\+Data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01032                                              \{}
\DoxyCodeLine{01033   \mbox{\hyperlink{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}{PreviewFxManager::instance}}()-\/>emitRenderedFrame(m\_fx-\/>getIdentifier(),}
\DoxyCodeLine{01034                                                   renderData);}
\DoxyCodeLine{01035 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a3446aec5136735b6ff46252bcbe31c63}\label{class_preview_fx_instance_a3446aec5136735b6ff46252bcbe31c63}} 
\index{PreviewFxInstance@{PreviewFxInstance}!onRenderRasterStarted@{onRenderRasterStarted}}
\index{onRenderRasterStarted@{onRenderRasterStarted}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{onRenderRasterStarted()}{onRenderRasterStarted()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::on\+Render\+Raster\+Started (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} \&}]{render\+Data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01024                                              \{}
\DoxyCodeLine{01025   \mbox{\hyperlink{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}{PreviewFxManager::instance}}()-\/>emitStartedFrame(m\_fx-\/>getIdentifier(),}
\DoxyCodeLine{01026                                                  renderData);}
\DoxyCodeLine{01027 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a0e2a13a03afc8e7ab8c4a309a12b5e7a}\label{class_preview_fx_instance_a0e2a13a03afc8e7ab8c4a309a12b5e7a}} 
\index{PreviewFxInstance@{PreviewFxInstance}!refreshViewRects@{refreshViewRects}}
\index{refreshViewRects@{refreshViewRects}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{refreshViewRects()}{refreshViewRects()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::refresh\+View\+Rects (\begin{DoxyParamCaption}\item[{bool}]{rebuild = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00891                                                      \{}
\DoxyCodeLine{00892   \textcolor{keywordflow}{if} (suspendedRendering) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00893 }
\DoxyCodeLine{00894   \textcolor{keywordflow}{if} (m\_flipbooks.empty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00895 }
\DoxyCodeLine{00896   \textcolor{comment}{// Stop any currently running render process. It *should not* be necessary to}}
\DoxyCodeLine{00897   \textcolor{comment}{// wait for complete stop.}}
\DoxyCodeLine{00898   \textcolor{comment}{// WARNING: This requires that different rendering instances are}}
\DoxyCodeLine{00899   \textcolor{comment}{// simultaneously}}
\DoxyCodeLine{00900   \textcolor{comment}{// supported in a single TRenderer...!! We're not currently supporting this...}}
\DoxyCodeLine{00901   \{}
\DoxyCodeLine{00902     \textcolor{comment}{// NOTE: stopRendering(true) LOOPS and may trigger events which delete this}}
\DoxyCodeLine{00903     \textcolor{comment}{// very}}
\DoxyCodeLine{00904     \textcolor{comment}{// render instance. So we have to watch inside the manager to see if this is}}
\DoxyCodeLine{00905     \textcolor{comment}{// still}}
\DoxyCodeLine{00906     \textcolor{comment}{// alive... The following should be removed using stopRendering(false)...}}
\DoxyCodeLine{00907     \textcolor{comment}{// NOTE: The same problem imposes that refreshViewRects() is not invoked}}
\DoxyCodeLine{00908     \textcolor{comment}{// directly}}
\DoxyCodeLine{00909     \textcolor{comment}{// when iterating the previewInstances map -\/ we've used a signal-\/slot}}
\DoxyCodeLine{00910     \textcolor{comment}{// connection for this.}}
\DoxyCodeLine{00911     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} fxId = m\_fx-\/>getIdentifier();}
\DoxyCodeLine{00912 }
\DoxyCodeLine{00913     m\_renderer.stopRendering(\textcolor{keyword}{true});  \textcolor{comment}{// Wait until we've finished}}
\DoxyCodeLine{00914 }
\DoxyCodeLine{00915     QMap<unsigned long, PreviewFxInstance *> \&previewInstances =}
\DoxyCodeLine{00916         \mbox{\hyperlink{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}{PreviewFxManager::instance}}()-\/>m\_previewInstances;}
\DoxyCodeLine{00917     \textcolor{keywordflow}{if} (previewInstances.find(fxId) == previewInstances.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00918   \}}
\DoxyCodeLine{00919 }
\DoxyCodeLine{00920   \textcolor{keywordflow}{if} (suspendedRendering) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00921 }
\DoxyCodeLine{00922   updatePreviewRect();}
\DoxyCodeLine{00923   updateProgressBarStatus();}
\DoxyCodeLine{00924   updateFlipbooks();}
\DoxyCodeLine{00925 }
\DoxyCodeLine{00926   startRender(rebuild);}
\DoxyCodeLine{00927 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a2bfb1e7aff8c279a35914d21e3a8e1b1}\label{class_preview_fx_instance_a2bfb1e7aff8c279a35914d21e3a8e1b1}} 
\index{PreviewFxInstance@{PreviewFxInstance}!reset@{reset}}
\index{reset@{reset}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::reset (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Clears the preview instance information, including cached images. Information needed to preview again are rebuilt. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00402                               \{}
\DoxyCodeLine{00403   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00404   \textcolor{keywordflow}{for} (i = m\_start; i <= m\_end; i += m\_step)}
\DoxyCodeLine{00405     TImageCache::instance()-\/>remove(getCacheId(m\_fx, i));}
\DoxyCodeLine{00406 }
\DoxyCodeLine{00407   m\_frameInfos.clear();}
\DoxyCodeLine{00408 }
\DoxyCodeLine{00409   updateFrameRange();}
\DoxyCodeLine{00410   updateRenderSettings();}
\DoxyCodeLine{00411   updateCamera();}
\DoxyCodeLine{00412   updateFlipbookTitles();}
\DoxyCodeLine{00413   updateAliases();}
\DoxyCodeLine{00414 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01260}{TImage\+Cache\+::remove()}}.

\mbox{\Hypertarget{class_preview_fx_instance_af533f6caaf4610d3d2abdff3ef8b0e50}\label{class_preview_fx_instance_af533f6caaf4610d3d2abdff3ef8b0e50}} 
\index{PreviewFxInstance@{PreviewFxInstance}!reset@{reset}}
\index{reset@{reset}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::reset (\begin{DoxyParamCaption}\item[{int}]{frame }\end{DoxyParamCaption})}

Clears the preview instance information about passed frame, including any cached image. Information needed to preview again are NOT rebuilt. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00385                                        \{}
\DoxyCodeLine{00386   TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove}}(getCacheId(m\_fx, frame));}
\DoxyCodeLine{00387   std::map<int, FrameInfo>::iterator it = m\_frameInfos.find(frame);}
\DoxyCodeLine{00388   \textcolor{keywordflow}{if} (it != m\_frameInfos.end()) \{}
\DoxyCodeLine{00389     \mbox{\hyperlink{class_t_raster_fx_p}{TRasterFxP}} builtFx = buildSceneFx(frame);}
\DoxyCodeLine{00390     it-\/>second.m\_alias =}
\DoxyCodeLine{00391         builtFx ? builtFx-\/>getAlias(frame, m\_renderSettings) : \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00392     it-\/>second.m\_renderedRegion = QRegion();}
\DoxyCodeLine{00393     m\_overallRenderedRegion     = QRegion();}
\DoxyCodeLine{00394   \}}
\DoxyCodeLine{00395 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01260}{TImage\+Cache\+::remove()}}.

\mbox{\Hypertarget{class_preview_fx_instance_a7a94e101ac882fe90c6be5b07cee7d4e}\label{class_preview_fx_instance_a7a94e101ac882fe90c6be5b07cee7d4e}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateAliases@{updateAliases}}
\index{updateAliases@{updateAliases}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateAliases()}{updateAliases()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Aliases (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00651                                       \{}
\DoxyCodeLine{00652   \textcolor{keywordflow}{if} (m\_start > m\_end) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654   std::string newAlias;}
\DoxyCodeLine{00655 }
\DoxyCodeLine{00656   \textcolor{comment}{// Build and compare the new aliases with the stored ones}}
\DoxyCodeLine{00657   std::map<int, FrameInfo>::iterator it;}
\DoxyCodeLine{00658   \textcolor{keywordflow}{for} (it = m\_frameInfos.begin(); it != m\_frameInfos.end(); ++it) \{}
\DoxyCodeLine{00659     \mbox{\hyperlink{class_t_raster_fx_p}{TRasterFxP}} builtFx = buildSceneFx(it-\/>first);}
\DoxyCodeLine{00660     newAlias = builtFx ? builtFx-\/>getAlias(it-\/>first, m\_renderSettings) : \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00661     \textcolor{keywordflow}{if} (newAlias != it-\/>second.m\_alias) \{}
\DoxyCodeLine{00662       \textcolor{comment}{// Clear the overall and frame-\/specific rendered regions}}
\DoxyCodeLine{00663       m\_overallRenderedRegion     = QRegion();}
\DoxyCodeLine{00664       it-\/>second.m\_renderedRegion = QRegion();}
\DoxyCodeLine{00665 }
\DoxyCodeLine{00666       it-\/>second.m\_alias = newAlias;}
\DoxyCodeLine{00667     \}}
\DoxyCodeLine{00668   \}}
\DoxyCodeLine{00669 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a84580d14b2e2b4c74b281f4c9b6ef1eb}\label{class_preview_fx_instance_a84580d14b2e2b4c74b281f4c9b6ef1eb}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateAliasKeyword@{updateAliasKeyword}}
\index{updateAliasKeyword@{updateAliasKeyword}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateAliasKeyword()}{updateAliasKeyword()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Alias\+Keyword (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{keyword }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00673                                                                    \{}
\DoxyCodeLine{00674   \textcolor{keywordflow}{if} (m\_start > m\_end) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00675 }
\DoxyCodeLine{00676   \textcolor{comment}{// Remove the rendered image whose alias contains keyword}}
\DoxyCodeLine{00677   std::map<int, FrameInfo>::iterator it;}
\DoxyCodeLine{00678   \textcolor{keywordflow}{for} (it = m\_frameInfos.begin(); it != m\_frameInfos.end(); ++it) \{}
\DoxyCodeLine{00679     \textcolor{keywordflow}{if} (it-\/>second.m\_alias.find(keyword) != std::string::npos) \{}
\DoxyCodeLine{00680       \textcolor{comment}{// Clear the overall and frame-\/specific rendered regions}}
\DoxyCodeLine{00681       m\_overallRenderedRegion     = QRegion();}
\DoxyCodeLine{00682       it-\/>second.m\_renderedRegion = QRegion();}
\DoxyCodeLine{00683 }
\DoxyCodeLine{00684       \textcolor{comment}{// Clear the cached image}}
\DoxyCodeLine{00685       \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri =}
\DoxyCodeLine{00686           TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_aea3ac2752efd6fa9689f5a7c1e895e41}{get}}(getCacheId(m\_fx, it-\/>first), \textcolor{keyword}{true});}
\DoxyCodeLine{00687       \textcolor{keywordflow}{if} (ri) ri-\/>getRaster()-\/>clear();}
\DoxyCodeLine{00688     \}}
\DoxyCodeLine{00689   \}}
\DoxyCodeLine{00690 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_aa6f20d2d48bdc184c450da167ad34bf1}\label{class_preview_fx_instance_aa6f20d2d48bdc184c450da167ad34bf1}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateCamera@{updateCamera}}
\index{updateCamera@{updateCamera}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateCamera()}{updateCamera()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Camera (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00735                                      \{}
\DoxyCodeLine{00736   \textcolor{comment}{// Clear the overall rendered region}}
\DoxyCodeLine{00737   m\_overallRenderedRegion = QRegion();}
\DoxyCodeLine{00738 }
\DoxyCodeLine{00739   \textcolor{comment}{// Retrieve the preview camera}}
\DoxyCodeLine{00740   \mbox{\hyperlink{class_t_camera}{TCamera}} *currCamera = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()}
\DoxyCodeLine{00741                             -\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()}
\DoxyCodeLine{00742                             -\/>getScene()}
\DoxyCodeLine{00743                             -\/>getCurrentPreviewCamera();}
\DoxyCodeLine{00744   \mbox{\hyperlink{class_t_rect_t}{TRect}} subCameraRect = currCamera-\/>\mbox{\hyperlink{class_t_camera_ad95e2b9f128939f1ce9777623643c69c}{getInterestRect}}();}
\DoxyCodeLine{00745   \mbox{\hyperlink{class_t_point_t}{TPointD}} cameraPos(-\/0.5 * currCamera-\/>\mbox{\hyperlink{class_t_camera_a9a7c573e7a2c397ffae4b747809ea2a5}{getRes}}().lx,}
\DoxyCodeLine{00746                     -\/0.5 * currCamera-\/>\mbox{\hyperlink{class_t_camera_a9a7c573e7a2c397ffae4b747809ea2a5}{getRes}}().ly);}
\DoxyCodeLine{00747 }
\DoxyCodeLine{00748   \textcolor{comment}{// Update the camera region and camera stage area}}
\DoxyCodeLine{00749   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} cameraRes(0, 0);}
\DoxyCodeLine{00750   \mbox{\hyperlink{class_t_rect_t}{TRectD}} renderArea;}
\DoxyCodeLine{00751   \textcolor{keywordflow}{if} (m\_subcamera \&\& subCameraRect.getLx() > 0 \&\& subCameraRect.getLy() > 0) \{}
\DoxyCodeLine{00752     cameraRes  = \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(subCameraRect.getLx(), subCameraRect.getLy());}
\DoxyCodeLine{00753     renderArea = \mbox{\hyperlink{class_t_rect_t}{TRectD}}(subCameraRect.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, subCameraRect.y0,}
\DoxyCodeLine{00754                         subCameraRect.x1 + 1, subCameraRect.y1 + 1) +}
\DoxyCodeLine{00755                  cameraPos;}
\DoxyCodeLine{00756   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00757     cameraRes  = currCamera-\/>\mbox{\hyperlink{class_t_camera_a9a7c573e7a2c397ffae4b747809ea2a5}{getRes}}();}
\DoxyCodeLine{00758     renderArea = \mbox{\hyperlink{class_t_rect_t}{TRectD}}(cameraPos, \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}}(cameraRes.lx, cameraRes.ly));}
\DoxyCodeLine{00759   \}}
\DoxyCodeLine{00760 }
\DoxyCodeLine{00761   cameraRes.lx /= m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_a52dd41881bbf6aaf953fe300be2e233e}{m\_shrinkX}};}
\DoxyCodeLine{00762   cameraRes.ly /= m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_ae1882f584ce9ffad12ce6bf9ff23814c}{m\_shrinkY}};}
\DoxyCodeLine{00763 }
\DoxyCodeLine{00764   \textcolor{keywordflow}{if} (m\_cameraRes != cameraRes || m\_renderArea != renderArea) \{}
\DoxyCodeLine{00765     m\_cameraRes  = cameraRes;}
\DoxyCodeLine{00766     m\_renderArea = renderArea;}
\DoxyCodeLine{00767     m\_cameraPos  = cameraPos;}
\DoxyCodeLine{00768 }
\DoxyCodeLine{00769     \textcolor{comment}{// Build the displacement needed when extracting the flipbooks' views}}
\DoxyCodeLine{00770     m\_subcameraDisplacement =}
\DoxyCodeLine{00771         \mbox{\hyperlink{class_t_point_t}{TPointD}}(0.5 * (m\_renderArea.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} + m\_renderArea.x1),}
\DoxyCodeLine{00772                 0.5 * (m\_renderArea.y0 + m\_renderArea.y1));}
\DoxyCodeLine{00773 }
\DoxyCodeLine{00774     \textcolor{comment}{// Erase all previuosly previewed images}}
\DoxyCodeLine{00775     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00776     \textcolor{keywordflow}{for} (i = m\_start; i <= m\_end; i += m\_step)}
\DoxyCodeLine{00777       TImageCache::instance()-\/>remove(getCacheId(m\_fx, i));}
\DoxyCodeLine{00778 }
\DoxyCodeLine{00779     \textcolor{comment}{// Clear all frame-\/specific rendered regions}}
\DoxyCodeLine{00780     std::map<int, FrameInfo>::iterator it;}
\DoxyCodeLine{00781     \textcolor{keywordflow}{for} (it = m\_frameInfos.begin(); it != m\_frameInfos.end(); ++it)}
\DoxyCodeLine{00782       it-\/>second.m\_renderedRegion = QRegion();}
\DoxyCodeLine{00783   \}}
\DoxyCodeLine{00784 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a2ff7e815cd92558d26de7315360d1c24}\label{class_preview_fx_instance_a2ff7e815cd92558d26de7315360d1c24}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateFlipbooks@{updateFlipbooks}}
\index{updateFlipbooks@{updateFlipbooks}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateFlipbooks()}{updateFlipbooks()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Flipbooks (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00540                                         \{}
\DoxyCodeLine{00541   std::set<FlipBook *>::iterator it;}
\DoxyCodeLine{00542   \textcolor{keywordflow}{for} (it = m\_flipbooks.begin(); it != m\_flipbooks.end(); ++it) (*it)-\/>update();}
\DoxyCodeLine{00543 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a89ffdad38d8543ffed86df5bf22200a5}\label{class_preview_fx_instance_a89ffdad38d8543ffed86df5bf22200a5}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateFlipbookTitles@{updateFlipbookTitles}}
\index{updateFlipbookTitles@{updateFlipbookTitles}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateFlipbookTitles()}{updateFlipbookTitles()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Flipbook\+Titles (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00628                                              \{}
\DoxyCodeLine{00629   \textcolor{keywordflow}{if} (isFullPreview() \&\& m\_start <= m\_end) \{}
\DoxyCodeLine{00630     \textcolor{keywordtype}{int} start = m\_start + 1;}
\DoxyCodeLine{00631     \textcolor{keywordtype}{int} end   = m\_end + 1;}
\DoxyCodeLine{00632 }
\DoxyCodeLine{00633     std::set<FlipBook *>::iterator kt;}
\DoxyCodeLine{00634     \textcolor{keywordflow}{for} (kt = m\_flipbooks.begin(); kt != m\_flipbooks.end(); ++kt) \{}
\DoxyCodeLine{00635       \textcolor{comment}{// In the full preview case, the title must display the frame range}}
\DoxyCodeLine{00636       \textcolor{comment}{// information}}
\DoxyCodeLine{00637       (*kt)-\/>setTitle(}
\DoxyCodeLine{00638           \textcolor{comment}{/*"{}Rendered Frames  ::  From "{} + QString::number(start) +}}
\DoxyCodeLine{00639 \textcolor{comment}{        "{} To "{} + QString::number(end) +}}
\DoxyCodeLine{00640 \textcolor{comment}{ "{}  ::  Step "{} + QString::number(m\_step)*/}}
\DoxyCodeLine{00641           QObject::tr(\textcolor{stringliteral}{"{}Rendered Frames  ::  From \%1 To \%2  ::  Step \%3"{}})}
\DoxyCodeLine{00642               .arg(QString::number(start))}
\DoxyCodeLine{00643               .arg(QString::number(end))}
\DoxyCodeLine{00644               .arg(QString::number(m\_step)));}
\DoxyCodeLine{00645     \}}
\DoxyCodeLine{00646   \}}
\DoxyCodeLine{00647 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_aaa4e664b16cecbb0dab05bb78a1d6040}\label{class_preview_fx_instance_aaa4e664b16cecbb0dab05bb78a1d6040}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateFrameRange@{updateFrameRange}}
\index{updateFrameRange@{updateFrameRange}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateFrameRange()}{updateFrameRange()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Frame\+Range (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00547                                          \{}
\DoxyCodeLine{00548   \mbox{\hyperlink{class_t_app}{TApp}} *app         = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{00549   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{00550   \mbox{\hyperlink{class_t_output_properties}{TOutputProperties}} *properties =}
\DoxyCodeLine{00551       scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_a0b905e0ea16e27aa5e67da31e469026e}{getPreviewProperties}}();}
\DoxyCodeLine{00552 }
\DoxyCodeLine{00553   \textcolor{keywordtype}{int} frameCount = m\_xsheet-\/>\mbox{\hyperlink{class_t_xsheet_a12a62da7dc04395088112e492d73374f}{getFrameCount}}();}
\DoxyCodeLine{00554 }
\DoxyCodeLine{00555   \textcolor{comment}{// Initialize the render starting from current frame. If not in the preview}}
\DoxyCodeLine{00556   \textcolor{comment}{// range,}}
\DoxyCodeLine{00557   \textcolor{comment}{// start from the closest range extreme.}}
\DoxyCodeLine{00558   properties-\/>\mbox{\hyperlink{class_t_output_properties_aae127cbd8b19eaed0b0fbaf589349176}{getRange}}(m\_start, m\_end, m\_step);}
\DoxyCodeLine{00559   \textcolor{keywordflow}{if} (m\_end < 0) m\_end = frameCount -\/ 1;}
\DoxyCodeLine{00560 }
\DoxyCodeLine{00561   \textcolor{comment}{// Intersect with the fx active frame range}}
\DoxyCodeLine{00562   \mbox{\hyperlink{class_t_raster_fx_p}{TRasterFxP}} rasterFx(m\_fx);}
\DoxyCodeLine{00563   \mbox{\hyperlink{class_t_fx_time_region}{TFxTimeRegion}} timeRegion(rasterFx-\/>getTimeRegion());}
\DoxyCodeLine{00564   m\_start = std::max(timeRegion.getFirstFrame(), m\_start);}
\DoxyCodeLine{00565   m\_end   = std::min(timeRegion.getLastFrame(), m\_end);}
\DoxyCodeLine{00566 }
\DoxyCodeLine{00567   \textcolor{comment}{// Release all images not in the new frame range}}
\DoxyCodeLine{00568   std::map<int, FrameInfo>::iterator it, jt;}
\DoxyCodeLine{00569   \textcolor{keywordflow}{for} (it = m\_frameInfos.begin(); it != m\_frameInfos.end();) \{}
\DoxyCodeLine{00570     \textcolor{keywordflow}{if} (it-\/>first < m\_start || it-\/>first > m\_end ||}
\DoxyCodeLine{00571         ((it-\/>first -\/ m\_start) \% m\_step)) \{}
\DoxyCodeLine{00572       TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove}}(getCacheId(m\_fx, it-\/>first));}
\DoxyCodeLine{00573       jt = it++;}
\DoxyCodeLine{00574       m\_frameInfos.erase(jt);}
\DoxyCodeLine{00575     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00576       ++it;}
\DoxyCodeLine{00577   \}}
\DoxyCodeLine{00578 }
\DoxyCodeLine{00579   \textcolor{comment}{// Build a level to associate the flipbook with the rendered output}}
\DoxyCodeLine{00580   m\_level-\/>setName(std::to\_string(m\_fx-\/>getIdentifier()) + \textcolor{stringliteral}{"{}.noext"{}});}
\DoxyCodeLine{00581   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00582   \textcolor{keywordflow}{for} (i = 0; i < frameCount; i++) m\_level-\/>setFrame(\mbox{\hyperlink{class_t_frame_id}{TFrameId}}(i), 0);}
\DoxyCodeLine{00583 }
\DoxyCodeLine{00584   \textcolor{comment}{// Resize and update internal containers}}
\DoxyCodeLine{00585   \textcolor{keywordflow}{if} (m\_start > m\_end) \{}
\DoxyCodeLine{00586     m\_frameInfos.clear();}
\DoxyCodeLine{00587     m\_pbStatus.clear();}
\DoxyCodeLine{00588   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00589     \textcolor{comment}{// Build the new frame-\/alias range}}
\DoxyCodeLine{00590     \textcolor{keywordflow}{for} (i = m\_start; i <= m\_end; i += m\_step)}
\DoxyCodeLine{00591       \textcolor{keywordflow}{if} (m\_frameInfos.find(i) == m\_frameInfos.end()) \{}
\DoxyCodeLine{00592         \textcolor{comment}{// Clear the overall rendered region and build the frame info}}
\DoxyCodeLine{00593         m\_overallRenderedRegion = QRegion();}
\DoxyCodeLine{00594         m\_frameInfos.insert(std::make\_pair(i, std::string()));}
\DoxyCodeLine{00595       \}}
\DoxyCodeLine{00596 }
\DoxyCodeLine{00597     \textcolor{comment}{// Resize the progress bar}}
\DoxyCodeLine{00598     m\_pbStatus.resize((m\_end -\/ m\_start) / m\_step + 1);}
\DoxyCodeLine{00599   \}}
\DoxyCodeLine{00600 }
\DoxyCodeLine{00601   \textcolor{comment}{// Reset the flipbooks' frame range}}
\DoxyCodeLine{00602   std::set<FlipBook *>::iterator kt;}
\DoxyCodeLine{00603   \textcolor{keywordtype}{int} currFrame;}
\DoxyCodeLine{00604   \textcolor{keywordtype}{bool} fullPreview = isFullPreview();}
\DoxyCodeLine{00605   \textcolor{keywordflow}{for} (kt = m\_flipbooks.begin(); kt != m\_flipbooks.end(); ++kt) \{}
\DoxyCodeLine{00606     currFrame = (*kt)-\/>getCurrentFrame() -\/ 1;}
\DoxyCodeLine{00607     cropAndStep(currFrame);}
\DoxyCodeLine{00608     (*kt)-\/>setLevel(m\_fx.getPointer(), m\_xsheet.getPointer(),}
\DoxyCodeLine{00609                     m\_level.getPointer(), 0, m\_start + 1, m\_end + 1, m\_step,}
\DoxyCodeLine{00610                     currFrame + 1, m\_snd.getPointer());}
\DoxyCodeLine{00611   \}}
\DoxyCodeLine{00612 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a833839c7ed6a4d73f60009c3ad97d5fa}\label{class_preview_fx_instance_a833839c7ed6a4d73f60009c3ad97d5fa}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateInitialFrame@{updateInitialFrame}}
\index{updateInitialFrame@{updateInitialFrame}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateInitialFrame()}{updateInitialFrame()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Initial\+Frame (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00616                                            \{}
\DoxyCodeLine{00617   \textcolor{comment}{// Search all flipbooks and take the minimum of each's current}}
\DoxyCodeLine{00618   std::set<FlipBook *>::iterator kt;}
\DoxyCodeLine{00619   m\_initFrame = (std::numeric\_limits<int>::max)();}
\DoxyCodeLine{00620   \textcolor{keywordflow}{for} (kt = m\_flipbooks.begin(); kt != m\_flipbooks.end(); ++kt)}
\DoxyCodeLine{00621     m\_initFrame = std::min(m\_initFrame, (*kt)-\/>getCurrentFrame() -\/ 1);}
\DoxyCodeLine{00622 }
\DoxyCodeLine{00623   cropAndStep(m\_initFrame);}
\DoxyCodeLine{00624 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a760f8462936389aedfbde7fa6aa7acab}\label{class_preview_fx_instance_a760f8462936389aedfbde7fa6aa7acab}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updatePreviewRect@{updatePreviewRect}}
\index{updatePreviewRect@{updatePreviewRect}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updatePreviewRect()}{updatePreviewRect()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Preview\+Rect (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00788                                           \{}
\DoxyCodeLine{00789   \textcolor{keywordtype}{bool} isFullRender = \textcolor{keyword}{false};}
\DoxyCodeLine{00790   \textcolor{keywordflow}{if} (!m\_subcamera) \{}
\DoxyCodeLine{00791     \textcolor{comment}{// Retrieve the eventual sub-\/camera}}
\DoxyCodeLine{00792     \mbox{\hyperlink{class_t_camera}{TCamera}} *currCamera = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()}
\DoxyCodeLine{00793                               -\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()}
\DoxyCodeLine{00794                               -\/>getScene()}
\DoxyCodeLine{00795                               -\/>getCurrentPreviewCamera();}
\DoxyCodeLine{00796     \mbox{\hyperlink{class_t_rect_t}{TRect}} subcameraRect(currCamera-\/>\mbox{\hyperlink{class_t_camera_ad95e2b9f128939f1ce9777623643c69c}{getInterestRect}}());}
\DoxyCodeLine{00797 }
\DoxyCodeLine{00798     \textcolor{comment}{/*-\/-\/ Viewer上でサブカメラが指定されていない状態でFxPreviewをした場合 -\/-\/*/}}
\DoxyCodeLine{00799     \textcolor{keywordflow}{if} (subcameraRect.getLx() == 0 || subcameraRect.getLy() == 0)}
\DoxyCodeLine{00800       isFullRender = \textcolor{keyword}{true};}
\DoxyCodeLine{00801   \}}
\DoxyCodeLine{00802 }
\DoxyCodeLine{00803   \textcolor{comment}{// Build all the viewRects to be calculated. They will be computed on}}
\DoxyCodeLine{00804   \textcolor{comment}{// consecutive}}
\DoxyCodeLine{00805   \textcolor{comment}{// render operations.}}
\DoxyCodeLine{00806   \textcolor{comment}{// NOTE: For now, we'll perform a simplicistic solution -\/ coalesce all the}}
\DoxyCodeLine{00807   \textcolor{comment}{// flipbooks'}}
\DoxyCodeLine{00808   \textcolor{comment}{// viewrects and launch just one render.}}
\DoxyCodeLine{00809   \mbox{\hyperlink{class_t_rect_t}{TRectD}} previewRectD;}
\DoxyCodeLine{00810   m\_rectUnderRender = \mbox{\hyperlink{class_t_rect_t}{TRect}}();}
\DoxyCodeLine{00811 }
\DoxyCodeLine{00812   \textcolor{keywordtype}{int} shrinkX = m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_a52dd41881bbf6aaf953fe300be2e233e}{m\_shrinkX}};}
\DoxyCodeLine{00813   \textcolor{keywordtype}{int} shrinkY = m\_renderSettings.\mbox{\hyperlink{class_t_render_settings_ae1882f584ce9ffad12ce6bf9ff23814c}{m\_shrinkY}};}
\DoxyCodeLine{00814 }
\DoxyCodeLine{00815   \textcolor{keywordflow}{if} (!isFullRender) \{}
\DoxyCodeLine{00816     \textcolor{comment}{// For each opened flipbook}}
\DoxyCodeLine{00817     \textcolor{comment}{/*-\/-\/ 開いているFlipbookの表示範囲を足しこんでいく -\/-\/*/}}
\DoxyCodeLine{00818     std::set<FlipBook *>::iterator it;}
\DoxyCodeLine{00819     \textcolor{keywordflow}{for} (it = m\_flipbooks.begin(); it != m\_flipbooks.end(); ++it) \{}
\DoxyCodeLine{00820       \textcolor{comment}{// Only visible flipbooks are considered}}
\DoxyCodeLine{00821       \textcolor{keywordflow}{if} ((*it)-\/>isVisible())}
\DoxyCodeLine{00822         \textcolor{comment}{// Retrieve the flipbook's viewRect. Observe that this image geometry}}
\DoxyCodeLine{00823         \textcolor{comment}{// is intended in shrinked image reference, and assumes that the camera}}
\DoxyCodeLine{00824         \textcolor{comment}{// center}}
\DoxyCodeLine{00825         \textcolor{comment}{// lies at coords (0.0, 0.0).}}
\DoxyCodeLine{00826         previewRectD += (*it)-\/>getPreviewedImageGeometry();}
\DoxyCodeLine{00827     \}}
\DoxyCodeLine{00828 }
\DoxyCodeLine{00829     \textcolor{comment}{// Pass from shrinked to standard image geometry}}
\DoxyCodeLine{00830     \textcolor{comment}{/*-\/-\/ いったんShrinkを元に戻す -\/-\/*/}}
\DoxyCodeLine{00831     previewRectD.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} *= shrinkX;}
\DoxyCodeLine{00832     previewRectD.y0 *= shrinkY;}
\DoxyCodeLine{00833     previewRectD.x1 *= shrinkX;}
\DoxyCodeLine{00834     previewRectD.y1 *= shrinkY;}
\DoxyCodeLine{00835 }
\DoxyCodeLine{00836     \textcolor{comment}{// Now, the viewer will center the subcamera's raster instead than camera's.}}
\DoxyCodeLine{00837     \textcolor{comment}{// So, we have}}
\DoxyCodeLine{00838     \textcolor{comment}{// to correct the previewRectD by the stored displacement.}}
\DoxyCodeLine{00839     previewRectD += m\_subcameraDisplacement;}
\DoxyCodeLine{00840 }
\DoxyCodeLine{00841     \textcolor{comment}{/*-\/-\/ 表示範囲と計算範囲の共通部分を得る -\/-\/*/}}
\DoxyCodeLine{00842     previewRectD *= m\_renderArea;}
\DoxyCodeLine{00843   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00844     previewRectD = m\_renderArea;}
\DoxyCodeLine{00845 }
\DoxyCodeLine{00846   \textcolor{comment}{// Ensure that rect has the same pixel geometry as the preview camera}}
\DoxyCodeLine{00847   \textcolor{comment}{/*-\/-\/ 再度Shrink -\/-\/*/}}
\DoxyCodeLine{00848   previewRectD -\/= m\_cameraPos;}
\DoxyCodeLine{00849   previewRectD.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} = previewRectD.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} / shrinkX;}
\DoxyCodeLine{00850   previewRectD.y0 = previewRectD.y0 / shrinkY;}
\DoxyCodeLine{00851   previewRectD.x1 = previewRectD.x1 / shrinkX;}
\DoxyCodeLine{00852   previewRectD.y1 = previewRectD.y1 / shrinkY;}
\DoxyCodeLine{00853 }
\DoxyCodeLine{00854   \textcolor{comment}{// Now, pass to m\_cameraRes-\/relative coordinates}}
\DoxyCodeLine{00855   \textcolor{comment}{/*-\/-\/ 計算エリア基準の座標 → カメラ基準の座標 -\/-\/*/}}
\DoxyCodeLine{00856   \mbox{\hyperlink{class_t_point_t}{TPointD}} shrinkedRelPos((m\_renderArea.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} -\/ m\_cameraPos.x) / shrinkX,}
\DoxyCodeLine{00857                          (m\_renderArea.y0 -\/ m\_cameraPos.y) / shrinkY);}
\DoxyCodeLine{00858   previewRectD -\/= shrinkedRelPos;}
\DoxyCodeLine{00859 }
\DoxyCodeLine{00860   previewRectD.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} = tfloor(previewRectD.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}});}
\DoxyCodeLine{00861   previewRectD.y0 = tfloor(previewRectD.y0);}
\DoxyCodeLine{00862   previewRectD.x1 = tceil(previewRectD.x1);}
\DoxyCodeLine{00863   previewRectD.y1 = tceil(previewRectD.y1);}
\DoxyCodeLine{00864 }
\DoxyCodeLine{00865   \textcolor{comment}{/*-\/-\/ 表示しなくてはいけないRect -\/-\/*/}}
\DoxyCodeLine{00866   QRect qViewRect(previewRectD.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, previewRectD.y0, previewRectD.getLx(),}
\DoxyCodeLine{00867                   previewRectD.getLy());}
\DoxyCodeLine{00868   \textcolor{comment}{/*-\/-\/ 表示しなくてはいけないRectから、既に計算済みの範囲を引く ＝}}
\DoxyCodeLine{00869 \textcolor{comment}{   * 新たに計算が必要な領域 -\/-\/*/}}
\DoxyCodeLine{00870   QRegion viewRectRegionToRender(}
\DoxyCodeLine{00871       QRegion(qViewRect).subtracted(m\_overallRenderedRegion));}
\DoxyCodeLine{00872 }
\DoxyCodeLine{00873   \textcolor{comment}{// If the rect to render has already been calculated, continue.}}
\DoxyCodeLine{00874   \textcolor{comment}{/*-\/-\/ 新たに計算が必要な領域が無ければReturn -\/-\/*/}}
\DoxyCodeLine{00875   \textcolor{keywordflow}{if} (viewRectRegionToRender.isEmpty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00876 }
\DoxyCodeLine{00877   \textcolor{comment}{// Retrieve the minimal box containing the region yet to be rendered}}
\DoxyCodeLine{00878   \textcolor{comment}{/*-\/-\/ 新たに計算が必要な領域を含む最小のRectを得る -\/-\/*/}}
\DoxyCodeLine{00879   QRect boxRectToRender(viewRectRegionToRender.boundingRect());}
\DoxyCodeLine{00880 }
\DoxyCodeLine{00881   \textcolor{comment}{/*-\/-\/ 計算中のRectに登録する -\/-\/*/}}
\DoxyCodeLine{00882   m\_rectUnderRender = toTRect(boxRectToRender);}
\DoxyCodeLine{00883   \textcolor{comment}{/*-\/-\/ カメラ基準の座標 → 計算エリア基準の座標 -\/-\/*/}}
\DoxyCodeLine{00884   previewRectD = toTRectD(boxRectToRender) + m\_cameraPos + shrinkedRelPos;}
\DoxyCodeLine{00885   \textcolor{comment}{/*-\/-\/ RenderAreaをセット -\/-\/*/}}
\DoxyCodeLine{00886   m\_renderPort.\mbox{\hyperlink{class_t_render_port_a743d79f021d27a9f8017ef468839cadb}{setRenderArea}}(previewRectD);}
\DoxyCodeLine{00887 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a13fd49615c00e7f9b64d00669825db05}\label{class_preview_fx_instance_a13fd49615c00e7f9b64d00669825db05}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateProgressBarStatus@{updateProgressBarStatus}}
\index{updateProgressBarStatus@{updateProgressBarStatus}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateProgressBarStatus()}{updateProgressBarStatus()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Progress\+Bar\+Status (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00694                                                 \{}
\DoxyCodeLine{00695   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00696   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j;}
\DoxyCodeLine{00697   std::map<int, FrameInfo>::iterator it;}
\DoxyCodeLine{00698   \textcolor{keywordflow}{for} (i = m\_start, j = 0; i <= m\_end; i += m\_step, ++j) \{}
\DoxyCodeLine{00699     it            = m\_frameInfos.find(i);}
\DoxyCodeLine{00700     m\_pbStatus[j] = ::contains(it-\/>second.m\_renderedRegion, m\_rectUnderRender)}
\DoxyCodeLine{00701                         ? FlipSlider::PBFrameFinished}
\DoxyCodeLine{00702                         : FlipSlider::PBFrameNotStarted;}
\DoxyCodeLine{00703   \}}
\DoxyCodeLine{00704 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_instance_a7a33819dffd6795da4c6e8bf455dcc48}\label{class_preview_fx_instance_a7a33819dffd6795da4c6e8bf455dcc48}} 
\index{PreviewFxInstance@{PreviewFxInstance}!updateRenderSettings@{updateRenderSettings}}
\index{updateRenderSettings@{updateRenderSettings}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{updateRenderSettings()}{updateRenderSettings()}}
{\footnotesize\ttfamily void Preview\+Fx\+Instance\+::update\+Render\+Settings (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00708                                              \{}
\DoxyCodeLine{00709   \mbox{\hyperlink{class_t_app}{TApp}} *app         = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}();}
\DoxyCodeLine{00710   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} *scene = app-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene();}
\DoxyCodeLine{00711   \mbox{\hyperlink{class_t_output_properties}{TOutputProperties}} *properties =}
\DoxyCodeLine{00712       scene-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}()-\/>\mbox{\hyperlink{class_t_scene_properties_a0b905e0ea16e27aa5e67da31e469026e}{getPreviewProperties}}();}
\DoxyCodeLine{00713 }
\DoxyCodeLine{00714   m\_subcamera = properties-\/>isSubcameraPreview();}
\DoxyCodeLine{00715 }
\DoxyCodeLine{00716   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} \&renderSettings = properties-\/>\mbox{\hyperlink{class_t_output_properties_afa7c771452b57b50047aa4afc6032cad}{getRenderSettings}}();}
\DoxyCodeLine{00717 }
\DoxyCodeLine{00718   \textcolor{keywordflow}{if} (m\_renderSettings != renderSettings) \{}
\DoxyCodeLine{00719     m\_renderSettings = renderSettings;}
\DoxyCodeLine{00720 }
\DoxyCodeLine{00721     \textcolor{comment}{// Erase all previuosly previewed images}}
\DoxyCodeLine{00722     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00723     \textcolor{keywordflow}{for} (i = m\_start; i <= m\_end; i += m\_step)}
\DoxyCodeLine{00724       TImageCache::instance()-\/>remove(getCacheId(m\_fx, i));}
\DoxyCodeLine{00725 }
\DoxyCodeLine{00726     \textcolor{comment}{// Clear all frame-\/specific rendered regions}}
\DoxyCodeLine{00727     std::map<int, FrameInfo>::iterator it;}
\DoxyCodeLine{00728     \textcolor{keywordflow}{for} (it = m\_frameInfos.begin(); it != m\_frameInfos.end(); ++it)}
\DoxyCodeLine{00729       it-\/>second.m\_renderedRegion = QRegion();}
\DoxyCodeLine{00730   \}}
\DoxyCodeLine{00731 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_preview_fx_instance_a2fefab9c159e69dbabdc7e3e81972493}\label{class_preview_fx_instance_a2fefab9c159e69dbabdc7e3e81972493}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_cameraPos@{m\_cameraPos}}
\index{m\_cameraPos@{m\_cameraPos}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_cameraPos}{m\_cameraPos}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_point_t}{TPointD}} Preview\+Fx\+Instance\+::m\+\_\+camera\+Pos}

\mbox{\Hypertarget{class_preview_fx_instance_af0a1470869572b13c1923efc4d1ddd1d}\label{class_preview_fx_instance_af0a1470869572b13c1923efc4d1ddd1d}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_cameraRes@{m\_cameraRes}}
\index{m\_cameraRes@{m\_cameraRes}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_cameraRes}{m\_cameraRes}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_dimension_t}{TDimension}} Preview\+Fx\+Instance\+::m\+\_\+camera\+Res}

\mbox{\Hypertarget{class_preview_fx_instance_acd645c4651a4caaa37f4207da9e95fb8}\label{class_preview_fx_instance_acd645c4651a4caaa37f4207da9e95fb8}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_end@{m\_end}}
\index{m\_end@{m\_end}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_end}{m\_end}}
{\footnotesize\ttfamily int Preview\+Fx\+Instance\+::m\+\_\+end}

\mbox{\Hypertarget{class_preview_fx_instance_a1df3c0f57e8b4d027d946e469a9dfa3d}\label{class_preview_fx_instance_a1df3c0f57e8b4d027d946e469a9dfa3d}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_flipbooks@{m\_flipbooks}}
\index{m\_flipbooks@{m\_flipbooks}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_flipbooks}{m\_flipbooks}}
{\footnotesize\ttfamily std\+::set$<$\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$$>$ Preview\+Fx\+Instance\+::m\+\_\+flipbooks}

\mbox{\Hypertarget{class_preview_fx_instance_ad2945d4a198b601412679971468e04fc}\label{class_preview_fx_instance_ad2945d4a198b601412679971468e04fc}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_frameInfos@{m\_frameInfos}}
\index{m\_frameInfos@{m\_frameInfos}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_frameInfos}{m\_frameInfos}}
{\footnotesize\ttfamily std\+::map$<$int, \mbox{\hyperlink{struct_preview_fx_instance_1_1_frame_info}{Frame\+Info}}$>$ Preview\+Fx\+Instance\+::m\+\_\+frame\+Infos}

\mbox{\Hypertarget{class_preview_fx_instance_acf53b066078651d94ae3bfc6e3b27f36}\label{class_preview_fx_instance_acf53b066078651d94ae3bfc6e3b27f36}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_frozenFlips@{m\_frozenFlips}}
\index{m\_frozenFlips@{m\_frozenFlips}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_frozenFlips}{m\_frozenFlips}}
{\footnotesize\ttfamily std\+::set$<$\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$$>$ Preview\+Fx\+Instance\+::m\+\_\+frozen\+Flips}

\mbox{\Hypertarget{class_preview_fx_instance_adf8267a27dea336c0cc22206290a526c}\label{class_preview_fx_instance_adf8267a27dea336c0cc22206290a526c}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_fx@{m\_fx}}
\index{m\_fx@{m\_fx}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_fx}{m\_fx}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_fx_p}{TRaster\+FxP}} Preview\+Fx\+Instance\+::m\+\_\+fx}

\mbox{\Hypertarget{class_preview_fx_instance_a91462407184b2a258d767c7a506b2bd4}\label{class_preview_fx_instance_a91462407184b2a258d767c7a506b2bd4}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_initFrame@{m\_initFrame}}
\index{m\_initFrame@{m\_initFrame}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_initFrame}{m\_initFrame}}
{\footnotesize\ttfamily int Preview\+Fx\+Instance\+::m\+\_\+init\+Frame}

\mbox{\Hypertarget{class_preview_fx_instance_af213db1fe5bafb80ae759aac9783f0d0}\label{class_preview_fx_instance_af213db1fe5bafb80ae759aac9783f0d0}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_level@{m\_level}}
\index{m\_level@{m\_level}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_level}{m\_level}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_level_p}{TLevelP}} Preview\+Fx\+Instance\+::m\+\_\+level}

\mbox{\Hypertarget{class_preview_fx_instance_aaf166a23e002b732e6afbd0fc797e076}\label{class_preview_fx_instance_aaf166a23e002b732e6afbd0fc797e076}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_overallRenderedRegion@{m\_overallRenderedRegion}}
\index{m\_overallRenderedRegion@{m\_overallRenderedRegion}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_overallRenderedRegion}{m\_overallRenderedRegion}}
{\footnotesize\ttfamily QRegion Preview\+Fx\+Instance\+::m\+\_\+overall\+Rendered\+Region}

\mbox{\Hypertarget{class_preview_fx_instance_a5f44679fa5a96fd4f66190197ae2fdaf}\label{class_preview_fx_instance_a5f44679fa5a96fd4f66190197ae2fdaf}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_pbStatus@{m\_pbStatus}}
\index{m\_pbStatus@{m\_pbStatus}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_pbStatus}{m\_pbStatus}}
{\footnotesize\ttfamily std\+::vector$<$UCHAR$>$ Preview\+Fx\+Instance\+::m\+\_\+pb\+Status}

\mbox{\Hypertarget{class_preview_fx_instance_ad2365971deca81f301c2898789351839}\label{class_preview_fx_instance_ad2365971deca81f301c2898789351839}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_rectUnderRender@{m\_rectUnderRender}}
\index{m\_rectUnderRender@{m\_rectUnderRender}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_rectUnderRender}{m\_rectUnderRender}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_rect_t}{TRect}} Preview\+Fx\+Instance\+::m\+\_\+rect\+Under\+Render}

\mbox{\Hypertarget{class_preview_fx_instance_a6a481fbc7aa26bed908d6979d09435f6}\label{class_preview_fx_instance_a6a481fbc7aa26bed908d6979d09435f6}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_renderArea@{m\_renderArea}}
\index{m\_renderArea@{m\_renderArea}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_renderArea}{m\_renderArea}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_rect_t}{TRectD}} Preview\+Fx\+Instance\+::m\+\_\+render\+Area}

\mbox{\Hypertarget{class_preview_fx_instance_a37176275251d167c39f288cffa3d9db8}\label{class_preview_fx_instance_a37176275251d167c39f288cffa3d9db8}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_renderer@{m\_renderer}}
\index{m\_renderer@{m\_renderer}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_renderer}{m\_renderer}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_renderer}{TRenderer}} Preview\+Fx\+Instance\+::m\+\_\+renderer}

\mbox{\Hypertarget{class_preview_fx_instance_a065668bc0367d4af37c6d8003102ae5b}\label{class_preview_fx_instance_a065668bc0367d4af37c6d8003102ae5b}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_renderFailed@{m\_renderFailed}}
\index{m\_renderFailed@{m\_renderFailed}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_renderFailed}{m\_renderFailed}}
{\footnotesize\ttfamily bool Preview\+Fx\+Instance\+::m\+\_\+render\+Failed}

\mbox{\Hypertarget{class_preview_fx_instance_a2481fc8217bbcb1cd7cfa138c57fb9ab}\label{class_preview_fx_instance_a2481fc8217bbcb1cd7cfa138c57fb9ab}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_renderPort@{m\_renderPort}}
\index{m\_renderPort@{m\_renderPort}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_renderPort}{m\_renderPort}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_preview_fx_render_port}{Preview\+Fx\+Render\+Port}} Preview\+Fx\+Instance\+::m\+\_\+render\+Port}

\mbox{\Hypertarget{class_preview_fx_instance_a72a5fd83f86f755bb74739e8e571d519}\label{class_preview_fx_instance_a72a5fd83f86f755bb74739e8e571d519}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_renderSettings@{m\_renderSettings}}
\index{m\_renderSettings@{m\_renderSettings}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_renderSettings}{m\_renderSettings}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} Preview\+Fx\+Instance\+::m\+\_\+render\+Settings}

\mbox{\Hypertarget{class_preview_fx_instance_a957b9772662f913b3900ff61c24fa7fe}\label{class_preview_fx_instance_a957b9772662f913b3900ff61c24fa7fe}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_snd@{m\_snd}}
\index{m\_snd@{m\_snd}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_snd}{m\_snd}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} Preview\+Fx\+Instance\+::m\+\_\+snd}

\mbox{\Hypertarget{class_preview_fx_instance_a9b0380d271511993f9c73e73b73c9f83}\label{class_preview_fx_instance_a9b0380d271511993f9c73e73b73c9f83}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_start@{m\_start}}
\index{m\_start@{m\_start}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_start}{m\_start}}
{\footnotesize\ttfamily int Preview\+Fx\+Instance\+::m\+\_\+start}

\mbox{\Hypertarget{class_preview_fx_instance_aff987233f3fbdab7926151756c15bb9a}\label{class_preview_fx_instance_aff987233f3fbdab7926151756c15bb9a}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_step@{m\_step}}
\index{m\_step@{m\_step}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_step}{m\_step}}
{\footnotesize\ttfamily int Preview\+Fx\+Instance\+::m\+\_\+step}

\mbox{\Hypertarget{class_preview_fx_instance_ad7d9755fdec873845d63c95f239adccc}\label{class_preview_fx_instance_ad7d9755fdec873845d63c95f239adccc}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_subcamera@{m\_subcamera}}
\index{m\_subcamera@{m\_subcamera}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_subcamera}{m\_subcamera}}
{\footnotesize\ttfamily bool Preview\+Fx\+Instance\+::m\+\_\+subcamera}

\mbox{\Hypertarget{class_preview_fx_instance_a0235643057d471bbdee8c4f60857c021}\label{class_preview_fx_instance_a0235643057d471bbdee8c4f60857c021}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_subcameraDisplacement@{m\_subcameraDisplacement}}
\index{m\_subcameraDisplacement@{m\_subcameraDisplacement}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_subcameraDisplacement}{m\_subcameraDisplacement}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_point_t}{TPointD}} Preview\+Fx\+Instance\+::m\+\_\+subcamera\+Displacement}

\mbox{\Hypertarget{class_preview_fx_instance_ae458618a79dfa77a6368ea6155594ba8}\label{class_preview_fx_instance_ae458618a79dfa77a6368ea6155594ba8}} 
\index{PreviewFxInstance@{PreviewFxInstance}!m\_xsheet@{m\_xsheet}}
\index{m\_xsheet@{m\_xsheet}!PreviewFxInstance@{PreviewFxInstance}}
\doxysubsubsection{\texorpdfstring{m\_xsheet}{m\_xsheet}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TXsheetP}} Preview\+Fx\+Instance\+::m\+\_\+xsheet}



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonz/previewfxmanager.\+cpp\end{DoxyCompactItemize}
