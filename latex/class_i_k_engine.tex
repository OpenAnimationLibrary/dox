\hypertarget{class_i_k_engine}{}\doxysection{IKEngine Class Reference}
\label{class_i_k_engine}\index{IKEngine@{IKEngine}}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_i_k_engine_a7ac668ddf4c0c1fbd5cfdb00f90acaeb}{set\+Root}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos)
\item 
int \mbox{\hyperlink{class_i_k_engine_a3486c863583990c5cd32d8b356d4f887}{add\+Joint}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, int parent\+Index)
\item 
void \mbox{\hyperlink{class_i_k_engine_a8f5959b06f7127b5c3c995ab7018d3c5}{lock}} (int index)
\item 
void \mbox{\hyperlink{class_i_k_engine_a971564e4155ad95157e0987ce675b29d}{unlock}} (int index)
\item 
bool \mbox{\hyperlink{class_i_k_engine_afe967a6536a7bd1c0524147d95bbbfc2}{is\+Locked}} (int index)
\item 
void \mbox{\hyperlink{class_i_k_engine_a60213c35b2625c68e316e1251620a515}{clear}} ()
\item 
int \mbox{\hyperlink{class_i_k_engine_a201db7f64d9daa798f1fada29809afe6}{get\+Joint\+Count}} () const
\item 
const \mbox{\hyperlink{class_t_point_t}{TPointD}} \mbox{\hyperlink{class_i_k_engine_a16968a677bc35c7892b1e70767040693}{get\+Joint}} (int index) const
\item 
int \mbox{\hyperlink{class_i_k_engine_ad547bf63abe0567b4552a6a1d1e22352}{get\+Joint\+Parent}} (int index) const
\item 
double \mbox{\hyperlink{class_i_k_engine_a616e66a6ab000159d677b471924aca2e}{get\+Joint\+Angle}} (int index)
\item 
void \mbox{\hyperlink{class_i_k_engine_a0026ac605f9c9db225deb5c05227bf7e}{drag}} (\mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_i_k_engine_ab790b2ff8b1a730c2ac59062dda9a37c}\label{class_i_k_engine_ab790b2ff8b1a730c2ac59062dda9a37c}} 
\index{IKEngine@{IKEngine}!IKEngine@{IKEngine}}
\index{IKEngine@{IKEngine}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{IKEngine()}{IKEngine()}}
{\footnotesize\ttfamily IKEngine\+::\+IKEngine (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00008 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_i_k_engine_a3486c863583990c5cd32d8b356d4f887}\label{class_i_k_engine_a3486c863583990c5cd32d8b356d4f887}} 
\index{IKEngine@{IKEngine}!addJoint@{addJoint}}
\index{addJoint@{addJoint}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{addJoint()}{addJoint()}}
{\footnotesize\ttfamily int IKEngine\+::add\+Joint (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{int}]{parent\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00010                                                           \{}
\DoxyCodeLine{00011   \textcolor{comment}{// TODO: evitare che si formino segmenti nulli}}
\DoxyCodeLine{00012   \textcolor{comment}{// assert(m\_joints.empty() || norm2(pos-\/m\_joints.back())>0.000001);}}
\DoxyCodeLine{00013   \textcolor{comment}{// assert(m\_nodes[indexParent]);}}
\DoxyCodeLine{00014   assert(m\_skeleton.getNode(indexParent));}
\DoxyCodeLine{00015   m\_skeleton.addNode(\textcolor{keyword}{new} \mbox{\hyperlink{class_i_k_node}{IKNode}}());}
\DoxyCodeLine{00016   \textcolor{keywordtype}{int} index = m\_skeleton.getNodeCount() -\/ 1;}
\DoxyCodeLine{00017   m\_skeleton.setNode(index, pos, IKNode::JOINT);}
\DoxyCodeLine{00018   m\_skeleton.setParent(index, indexParent);}
\DoxyCodeLine{00019   \textcolor{keywordflow}{return} index;}
\DoxyCodeLine{00020 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a60213c35b2625c68e316e1251620a515}\label{class_i_k_engine_a60213c35b2625c68e316e1251620a515}} 
\index{IKEngine@{IKEngine}!clear@{clear}}
\index{clear@{clear}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{clear()}{clear()}}
{\footnotesize\ttfamily void IKEngine\+::clear (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00036                \{}
\DoxyCodeLine{00037     m\_skeleton.clear();}
\DoxyCodeLine{00038     target.clear();}
\DoxyCodeLine{00039   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a0026ac605f9c9db225deb5c05227bf7e}\label{class_i_k_engine_a0026ac605f9c9db225deb5c05227bf7e}} 
\index{IKEngine@{IKEngine}!drag@{drag}}
\index{drag@{drag}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{drag()}{drag()}}
{\footnotesize\ttfamily void IKEngine\+::drag (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00062                                 \{}
\DoxyCodeLine{00063   \textcolor{comment}{// assert(index>-\/1 \&\& index<m\_skeleton.getNodeCount());}}
\DoxyCodeLine{00064   \textcolor{comment}{// se lo scheletro Ã¨ vuoto non succede nulla}}
\DoxyCodeLine{00065   \textcolor{keywordflow}{if} (m\_skeleton.getNodeCount() == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00066 }
\DoxyCodeLine{00067   \textcolor{comment}{// Grab the last point of the chain}}
\DoxyCodeLine{00068   \textcolor{keywordtype}{int} indexDrag = m\_skeleton.getNodeCount() -\/ 1;}
\DoxyCodeLine{00069   \textcolor{keywordflow}{if} (m\_skeleton.getNode(indexDrag)-\/>getParent()-\/>IsEffector()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00070   m\_skeleton.setPurpose(indexDrag, IKNode::EFFECTOR);}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072   \textcolor{comment}{// assegno un indice alla sequenza dei giunti (nodi -\/end effectors)}}
\DoxyCodeLine{00073   setSequenceJoints();}
\DoxyCodeLine{00074 }
\DoxyCodeLine{00075   target.push\_back(pos);}
\DoxyCodeLine{00076 }
\DoxyCodeLine{00077   \mbox{\hyperlink{class_jacobian}{Jacobian}} jacobian(\&m\_skeleton, target);}
\DoxyCodeLine{00078   target.pop\_back();}
\DoxyCodeLine{00079   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 250; i++) doUpdateStep(jacobian);}
\DoxyCodeLine{00080 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a16968a677bc35c7892b1e70767040693}\label{class_i_k_engine_a16968a677bc35c7892b1e70767040693}} 
\index{IKEngine@{IKEngine}!getJoint@{getJoint}}
\index{getJoint@{getJoint}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{getJoint()}{getJoint()}}
{\footnotesize\ttfamily const \mbox{\hyperlink{class_t_point_t}{TPointD}} IKEngine\+::get\+Joint (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00043                                           \{}
\DoxyCodeLine{00044     assert(0 <= index \&\& index < (\textcolor{keywordtype}{int})m\_skeleton.getNodeCount());}
\DoxyCodeLine{00045     \mbox{\hyperlink{class_t_point_t}{TPointD}} jointPos = m\_skeleton.getNode(index)-\/>getPos();}
\DoxyCodeLine{00046     \textcolor{keywordflow}{return} jointPos;}
\DoxyCodeLine{00047   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a616e66a6ab000159d677b471924aca2e}\label{class_i_k_engine_a616e66a6ab000159d677b471924aca2e}} 
\index{IKEngine@{IKEngine}!getJointAngle@{getJointAngle}}
\index{getJointAngle@{getJointAngle}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{getJointAngle()}{getJointAngle()}}
{\footnotesize\ttfamily double IKEngine\+::get\+Joint\+Angle (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00046                                         \{}
\DoxyCodeLine{00047   assert(index > -\/1 \&\& index < m\_skeleton.getNodeCount());}
\DoxyCodeLine{00048   \mbox{\hyperlink{class_t_point_t}{TPointD}} pos = m\_skeleton.getNode(index)-\/>getPos();}
\DoxyCodeLine{00049   \mbox{\hyperlink{class_t_point_t}{TPointD}} u(1, 0);}
\DoxyCodeLine{00050   \textcolor{keywordflow}{if} (index != 0) \{}
\DoxyCodeLine{00051     \textcolor{keywordtype}{int} parent      = getJointParent(index);}
\DoxyCodeLine{00052     \mbox{\hyperlink{class_t_point_t}{TPointD}} prevPos = m\_skeleton.getNode(parent)-\/>getPos();}
\DoxyCodeLine{00053     u               = normalize(pos -\/ prevPos);}
\DoxyCodeLine{00054   \}}
\DoxyCodeLine{00055   \mbox{\hyperlink{class_t_point_t}{TPointD}} v(-\/u.y, u.x);}
\DoxyCodeLine{00056   \mbox{\hyperlink{class_t_point_t}{TPointD}} nextPos = m\_skeleton.getNode(index + 1)-\/>getPos();}
\DoxyCodeLine{00057   \mbox{\hyperlink{class_t_point_t}{TPointD}} d       = nextPos -\/ pos;}
\DoxyCodeLine{00058   \textcolor{keywordtype}{double} theta    = atan2(d * v, d * u);}
\DoxyCodeLine{00059   \textcolor{keywordflow}{return} theta;}
\DoxyCodeLine{00060 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a201db7f64d9daa798f1fada29809afe6}\label{class_i_k_engine_a201db7f64d9daa798f1fada29809afe6}} 
\index{IKEngine@{IKEngine}!getJointCount@{getJointCount}}
\index{getJointCount@{getJointCount}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{getJointCount()}{getJointCount()}}
{\footnotesize\ttfamily int IKEngine\+::get\+Joint\+Count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00041 \{ \textcolor{keywordflow}{return} m\_skeleton.getNodeCount(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_ad547bf63abe0567b4552a6a1d1e22352}\label{class_i_k_engine_ad547bf63abe0567b4552a6a1d1e22352}} 
\index{IKEngine@{IKEngine}!getJointParent@{getJointParent}}
\index{getJointParent@{getJointParent}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{getJointParent()}{getJointParent()}}
{\footnotesize\ttfamily int IKEngine\+::get\+Joint\+Parent (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00049                                       \{}
\DoxyCodeLine{00050     assert(index > -\/1 \&\& index < m\_skeleton.getNodeCount());}
\DoxyCodeLine{00051     \mbox{\hyperlink{class_i_k_node}{IKNode}} *node = m\_skeleton.getNode(index)-\/>getParent();}
\DoxyCodeLine{00052     \textcolor{keywordflow}{return} node ? node-\/>getIndex() : -\/1;}
\DoxyCodeLine{00053   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_afe967a6536a7bd1c0524147d95bbbfc2}\label{class_i_k_engine_afe967a6536a7bd1c0524147d95bbbfc2}} 
\index{IKEngine@{IKEngine}!isLocked@{isLocked}}
\index{isLocked@{isLocked}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{isLocked()}{isLocked()}}
{\footnotesize\ttfamily bool IKEngine\+::is\+Locked (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00041                                  \{}
\DoxyCodeLine{00042   assert(index > -\/1 \&\& index < m\_skeleton.getNodeCount());}
\DoxyCodeLine{00043   \textcolor{keywordflow}{return} m\_skeleton.getNode(index)-\/>IsEffector();}
\DoxyCodeLine{00044 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a8f5959b06f7127b5c3c995ab7018d3c5}\label{class_i_k_engine_a8f5959b06f7127b5c3c995ab7018d3c5}} 
\index{IKEngine@{IKEngine}!lock@{lock}}
\index{lock@{lock}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{lock()}{lock()}}
{\footnotesize\ttfamily void IKEngine\+::lock (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00029                              \{}
\DoxyCodeLine{00030   assert(index > -\/1 \&\& index < m\_skeleton.getNodeCount());}
\DoxyCodeLine{00031   m\_skeleton.setPurpose(index, IKNode::EFFECTOR);}
\DoxyCodeLine{00032   \mbox{\hyperlink{class_i_k_node}{IKNode}} *n   = m\_skeleton.getNode(index);}
\DoxyCodeLine{00033   \mbox{\hyperlink{class_t_point_t}{TPointD}} pos = n-\/>getPos();}
\DoxyCodeLine{00034   target.push\_back(pos);}
\DoxyCodeLine{00035 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a7ac668ddf4c0c1fbd5cfdb00f90acaeb}\label{class_i_k_engine_a7ac668ddf4c0c1fbd5cfdb00f90acaeb}} 
\index{IKEngine@{IKEngine}!setRoot@{setRoot}}
\index{setRoot@{setRoot}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{setRoot()}{setRoot()}}
{\footnotesize\ttfamily void IKEngine\+::set\+Root (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00022                                          \{}
\DoxyCodeLine{00023   m\_skeleton.addNode(\textcolor{keyword}{new} \mbox{\hyperlink{class_i_k_node}{IKNode}}());}
\DoxyCodeLine{00024   m\_skeleton.setNode(0, pos, IKNode::JOINT);}
\DoxyCodeLine{00025   \textcolor{comment}{// m\_skeleton.setParent(0,0);}}
\DoxyCodeLine{00026   m\_skeleton.setRoot(0);}
\DoxyCodeLine{00027 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_i_k_engine_a971564e4155ad95157e0987ce675b29d}\label{class_i_k_engine_a971564e4155ad95157e0987ce675b29d}} 
\index{IKEngine@{IKEngine}!unlock@{unlock}}
\index{unlock@{unlock}!IKEngine@{IKEngine}}
\doxysubsubsection{\texorpdfstring{unlock()}{unlock()}}
{\footnotesize\ttfamily void IKEngine\+::unlock (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00036                                \{}
\DoxyCodeLine{00037   assert(index > -\/1 \&\& index < m\_skeleton.getNodeCount());}
\DoxyCodeLine{00038   m\_skeleton.setPurpose(index, IKNode::JOINT);}
\DoxyCodeLine{00039 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/toonz/ikengine.\+h\item 
E\+:/opentoonz/toonz/sources/toonzlib/ikengine.\+cpp\end{DoxyCompactItemize}
