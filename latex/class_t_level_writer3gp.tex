\hypertarget{class_t_level_writer3gp}{}\doxysection{TLevel\+Writer3gp Class Reference}
\label{class_t_level_writer3gp}\index{TLevelWriter3gp@{TLevelWriter3gp}}
Inheritance diagram for TLevel\+Writer3gp\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_level_writer3gp}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_level_writer3gp_a76be3c02efbd2cdce19ba4504a184ef9}{TLevel\+Writer3gp}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\item 
\mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} \mbox{\hyperlink{class_t_level_writer3gp_a67d876264c0e4fee9d7df1d8d8b3eec7}{get\+Frame\+Writer}} (\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} fid) override
\item 
void \mbox{\hyperlink{class_t_level_writer3gp_a6e8b03746dc97fbbf57bcb89a269a1f5}{save}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&img, int frame\+Index)
\item 
void \mbox{\hyperlink{class_t_level_writer3gp_a3903642f89ec7dc3969b49057ef0daf1}{save\+Sound\+Track}} (\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$st) override
\item 
\mbox{\Hypertarget{class_t_level_writer3gp_a76be3c02efbd2cdce19ba4504a184ef9}\label{class_t_level_writer3gp_a76be3c02efbd2cdce19ba4504a184ef9}} 
{\bfseries TLevel\+Writer3gp} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\item 
\mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} \mbox{\hyperlink{class_t_level_writer3gp_abe3c0eff2654114738023a45a7e39885}{get\+Frame\+Writer}} (\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} fid)
\item 
\mbox{\Hypertarget{class_t_level_writer3gp_a6e8b03746dc97fbbf57bcb89a269a1f5}\label{class_t_level_writer3gp_a6e8b03746dc97fbbf57bcb89a269a1f5}} 
void {\bfseries save} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&img, int frame\+Index)
\item 
void \mbox{\hyperlink{class_t_level_writer3gp_a0f28dcd1c8e363174e04c0bb4eeec04a}{save\+Sound\+Track}} (\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$st)
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ \mbox{\hyperlink{class_t_level_writer3gp_af983b9b3ef479232c60e22af44585516}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&f, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\item 
static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ \mbox{\hyperlink{class_t_level_writer3gp_af983b9b3ef479232c60e22af44585516}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&f, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_t_level_writer3gp_a0d114a2c8fedead0efeac21c9359e1c1}{m\+\_\+init\+Done}}
\item 
int \mbox{\hyperlink{class_t_level_writer3gp_ab4dec70fd58156e15ec84aa6de08620c}{m\+\_\+\+IOError}}
\item 
Handle \mbox{\hyperlink{class_t_level_writer3gp_a708af9631065133452fa7087b061deca}{m\+\_\+data\+Ref}}
\item 
Handle \mbox{\hyperlink{class_t_level_writer3gp_a9dc02c96e2722149ec3e4e18cf80d1f5}{m\+\_\+h\+Movie\+Data}}
\item 
Handle \mbox{\hyperlink{class_t_level_writer3gp_a955738d8ed16f042daa9e03fcbf1415b}{m\+\_\+sound\+Data\+Ref}}
\item 
Handle \mbox{\hyperlink{class_t_level_writer3gp_a2d0652e55f511998bcf3b163c716087f}{m\+\_\+h\+Sound\+Movie\+Data}}
\item 
Movie\+Export\+Component \mbox{\hyperlink{class_t_level_writer3gp_a13d5c9957976ed569589b93d8ff14c28}{m\+\_\+my\+Exporter}}
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_level_writer3gp_a76be3c02efbd2cdce19ba4504a184ef9}\label{class_t_level_writer3gp_a76be3c02efbd2cdce19ba4504a184ef9}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!TLevelWriter3gp@{TLevelWriter3gp}}
\index{TLevelWriter3gp@{TLevelWriter3gp}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{TLevelWriter3gp()}{TLevelWriter3gp()}}
{\footnotesize\ttfamily TLevel\+Writer3gp\+::\+TLevel\+Writer3gp (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{path,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00525     : \mbox{\hyperlink{class_t_level_writer}{TLevelWriter}}(path, winfo)}
\DoxyCodeLine{00526     , m\_initDone(\textcolor{keyword}{false})}
\DoxyCodeLine{00527     , m\_IOError(QTNoError)}
\DoxyCodeLine{00528     , m\_pixmap(0)}
\DoxyCodeLine{00529     , m\_compressedData(0)}
\DoxyCodeLine{00530     , m\_gworld(0)}
\DoxyCodeLine{00531     , m\_videoMedia(0)}
\DoxyCodeLine{00532     , m\_videoTrack(0)}
\DoxyCodeLine{00533     , m\_movie(0)}
\DoxyCodeLine{00534     , m\_cancelled(\textcolor{keyword}{false})}
\DoxyCodeLine{00535     , m\_soundDataRef(0)}
\DoxyCodeLine{00536     , m\_hSoundMovieData(0)}
\DoxyCodeLine{00537 }
\DoxyCodeLine{00538 \{}
\DoxyCodeLine{00539   m\_frameRate = 12.;}
\DoxyCodeLine{00540   QDErr err;}
\DoxyCodeLine{00541   \textcolor{comment}{// FSSpec fspec;}}
\DoxyCodeLine{00542   \textcolor{keywordflow}{if} (QuickTimeStuff::instance()-\/>getStatus() != noErr) \{}
\DoxyCodeLine{00543     m\_IOError = QTNotInstalled;}
\DoxyCodeLine{00544     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, buildQTErrorString(m\_IOError));}
\DoxyCodeLine{00545   \}}
\DoxyCodeLine{00546 }
\DoxyCodeLine{00547   m\_movie = NewMovie(0);}
\DoxyCodeLine{00548   \textcolor{keywordflow}{if} ((err = GetMoviesError() != noErr))}
\DoxyCodeLine{00549     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create movie"{}});}
\DoxyCodeLine{00550 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer3gp_a769309ce25e6ceb9db7a5299682373a5}\label{class_t_level_writer3gp_a769309ce25e6ceb9db7a5299682373a5}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!````~TLevelWriter3gp@{$\sim$TLevelWriter3gp}}
\index{````~TLevelWriter3gp@{$\sim$TLevelWriter3gp}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{$\sim$TLevelWriter3gp()}{~TLevelWriter3gp()}}
{\footnotesize\ttfamily TLevel\+Writer3gp\+::$\sim$\+TLevel\+Writer3gp (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00775                                   \{}
\DoxyCodeLine{00776 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{00777 \textcolor{keywordflow}{if} (m\_pixmap) }
\DoxyCodeLine{00778   UnlockPixels(m\_pixmap);}
\DoxyCodeLine{00779 \textcolor{keywordflow}{if} (m\_compressedData)}
\DoxyCodeLine{00780   DisposeHandle(m\_compressedData);}
\DoxyCodeLine{00781 \textcolor{keywordflow}{if} (m\_gworld)}
\DoxyCodeLine{00782   DisposeGWorld(m\_gworld);}
\DoxyCodeLine{00783 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00784 }
\DoxyCodeLine{00785   QDErr err;}
\DoxyCodeLine{00786 }
\DoxyCodeLine{00787   \textcolor{keywordflow}{if} (m\_videoMedia)}
\DoxyCodeLine{00788     \textcolor{keywordflow}{if} ((err = EndMediaEdits(m\_videoMedia)) != noErr) \{}
\DoxyCodeLine{00789     \}  \textcolor{comment}{// throw TImageException(getFilePath(), "{}can't end edit media"{});}}
\DoxyCodeLine{00790 }
\DoxyCodeLine{00791   \textcolor{keywordflow}{if} (m\_videoTrack)}
\DoxyCodeLine{00792     \textcolor{keywordflow}{if} ((err = InsertMediaIntoTrack(m\_videoTrack, 0, 0,}
\DoxyCodeLine{00793                                     GetMediaDuration(m\_videoMedia), fixed1))) \{}
\DoxyCodeLine{00794     \}  \textcolor{comment}{// throw TImageException(getFilePath(), "{}can't insert media into track"{});}}
\DoxyCodeLine{00795 }
\DoxyCodeLine{00796   \textcolor{keywordtype}{short} resId = movieInDataForkResID;}
\DoxyCodeLine{00797   \textcolor{keywordflow}{if} (m\_movie) \{}
\DoxyCodeLine{00798     FSSpec fspec;}
\DoxyCodeLine{00799     \textcolor{keywordtype}{long} myFlags = 0L;}
\DoxyCodeLine{00800     OSErr myErr  = noErr;}
\DoxyCodeLine{00801     \textcolor{comment}{// UCHAR myCancelled = FALSE;}}
\DoxyCodeLine{00802 }
\DoxyCodeLine{00803     getFSSpecFromPosixPath(::to\_string(m\_path).c\_str(), \&fspec, \textcolor{keyword}{true});}
\DoxyCodeLine{00804 }
\DoxyCodeLine{00805     myFlags = createMovieFileDeleteCurFile;  \textcolor{comment}{// |}}
\DoxyCodeLine{00806     \textcolor{comment}{// movieFileSpecValid | movieToFileOnlyExport;}}
\DoxyCodeLine{00807 }
\DoxyCodeLine{00808     myErr =}
\DoxyCodeLine{00809         ConvertMovieToFile(m\_movie,                 \textcolor{comment}{// the movie to convert}}
\DoxyCodeLine{00810                            NULL,                    \textcolor{comment}{// all tracks in the movie}}
\DoxyCodeLine{00811                            \&fspec,                  \textcolor{comment}{// the output file}}
\DoxyCodeLine{00812                            \textcolor{stringliteral}{'3gpp'},                  \textcolor{comment}{// the output file type}}
\DoxyCodeLine{00813                            FOUR\_CHAR\_CODE(\textcolor{stringliteral}{'TVOD'}),  \textcolor{comment}{// the output file creator}}
\DoxyCodeLine{00814                            smSystemScript,          \textcolor{comment}{// the script}}
\DoxyCodeLine{00815                            \&resId,         \textcolor{comment}{// no resource ID to be returned}}
\DoxyCodeLine{00816                            myFlags,        \textcolor{comment}{// export flags}}
\DoxyCodeLine{00817                            m\_myExporter);  \textcolor{comment}{// no specific exp}}
\DoxyCodeLine{00818   \}}
\DoxyCodeLine{00819 }
\DoxyCodeLine{00820   DisposeHandle(m\_hMovieData);}
\DoxyCodeLine{00821   DisposeHandle(m\_dataRef);}
\DoxyCodeLine{00822   \textcolor{keywordflow}{if} (m\_hSoundMovieData) DisposeHandle(m\_hSoundMovieData);}
\DoxyCodeLine{00823 }
\DoxyCodeLine{00824   \textcolor{keywordflow}{if} (m\_refNum) CloseMovieFile(m\_refNum);}
\DoxyCodeLine{00825   DisposeMovie(m\_movie);}
\DoxyCodeLine{00826 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_level_writer3gp_af983b9b3ef479232c60e22af44585516}\label{class_t_level_writer3gp_af983b9b3ef479232c60e22af44585516}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!create@{create}}
\index{create@{create}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{create()}{create()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ TLevel\+Writer3gp\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{f,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00080                                                                          \{}
\DoxyCodeLine{00081     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_level_writer3gp}{TLevelWriter3gp}}(f, winfo);}
\DoxyCodeLine{00082   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer3gp_af983b9b3ef479232c60e22af44585516}\label{class_t_level_writer3gp_af983b9b3ef479232c60e22af44585516}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!create@{create}}
\index{create@{create}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{create()}{create()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ TLevel\+Writer3gp\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{f,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00058                                                                          \{}
\DoxyCodeLine{00059     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_level_writer3gp}{TLevelWriter3gp}}(f, winfo);}
\DoxyCodeLine{00060   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer3gp_abe3c0eff2654114738023a45a7e39885}\label{class_t_level_writer3gp_abe3c0eff2654114738023a45a7e39885}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!getFrameWriter@{getFrameWriter}}
\index{getFrameWriter@{getFrameWriter}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{getFrameWriter()}{getFrameWriter()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} TLevel\+Writer3gp\+::get\+Frame\+Writer (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}}}]{fid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.

\mbox{\Hypertarget{class_t_level_writer3gp_a67d876264c0e4fee9d7df1d8d8b3eec7}\label{class_t_level_writer3gp_a67d876264c0e4fee9d7df1d8d8b3eec7}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!getFrameWriter@{getFrameWriter}}
\index{getFrameWriter@{getFrameWriter}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{getFrameWriter()}{getFrameWriter()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} TLevel\+Writer3gp\+::get\+Frame\+Writer (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}}}]{fid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00830                                                           \{}
\DoxyCodeLine{00831   \textcolor{keywordflow}{if} (m\_cancelled) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00832   \textcolor{keywordflow}{if} (m\_IOError) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, buildQTErrorString(m\_IOError));}
\DoxyCodeLine{00833   \textcolor{keywordflow}{if} (fid.getLetter() != 0) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_image_writer_p}{TImageWriterP}}(0);}
\DoxyCodeLine{00834   \textcolor{keywordtype}{int} index            = fid.getNumber() -\/ 1;}
\DoxyCodeLine{00835   \mbox{\hyperlink{class_t_image_writer3gp}{TImageWriter3gp}} *iwm = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_image_writer3gp}{TImageWriter3gp}}(m\_path, index, \textcolor{keyword}{this});}
\DoxyCodeLine{00836   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_image_writer_p}{TImageWriterP}}(iwm);}
\DoxyCodeLine{00837 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer3gp_a6e8b03746dc97fbbf57bcb89a269a1f5}\label{class_t_level_writer3gp_a6e8b03746dc97fbbf57bcb89a269a1f5}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!save@{save}}
\index{save@{save}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily void TLevel\+Writer3gp\+::save (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&}]{img,  }\item[{int}]{frame\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00352                                                              \{}
\DoxyCodeLine{00353   \textcolor{keywordflow}{if} (m\_cancelled) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00354 }
\DoxyCodeLine{00355   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} image(img);}
\DoxyCodeLine{00356   \textcolor{keywordtype}{int} lx = image-\/>getRaster()-\/>getLx();}
\DoxyCodeLine{00357   \textcolor{keywordtype}{int} ly = image-\/>getRaster()-\/>getLy();}
\DoxyCodeLine{00358   \textcolor{comment}{// void *buffer = image-\/>getRaster()-\/>getRawData();}}
\DoxyCodeLine{00359   \textcolor{keywordtype}{int} pixSize = image-\/>getRaster()-\/>getPixelSize();}
\DoxyCodeLine{00360   \textcolor{keywordflow}{if} (pixSize != 4)}
\DoxyCodeLine{00361     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}Unsupported pixel type"{}});}
\DoxyCodeLine{00362 }
\DoxyCodeLine{00363   QMutexLocker sl(\&m\_mutex);}
\DoxyCodeLine{00364 }
\DoxyCodeLine{00365   \textcolor{keywordflow}{if} (!m\_properties) m\_properties = \textcolor{keyword}{new} \mbox{\hyperlink{class_tiio_1_1_mov_writer_properties}{Tiio::MovWriterProperties}}();}
\DoxyCodeLine{00366 }
\DoxyCodeLine{00367   \mbox{\hyperlink{class_tiio_1_1_mov_writer_properties}{Tiio::MovWriterProperties}} *prop = (\mbox{\hyperlink{class_tiio_1_1_mov_writer_properties}{Tiio::MovWriterProperties}} *)(m\_properties);}
\DoxyCodeLine{00368 }
\DoxyCodeLine{00369   \textcolor{comment}{// CodecType compression = StandardCompressionType;  prop-\/>getCurrentCodec();}}
\DoxyCodeLine{00370   \textcolor{comment}{// CodecQ quality = StandardQualityType;  prop-\/>getCurrentQuality();}}
\DoxyCodeLine{00371 }
\DoxyCodeLine{00372   \textcolor{keywordflow}{if} (!m\_initDone) \{}
\DoxyCodeLine{00373     \textcolor{comment}{// FSSpec fspec;}}
\DoxyCodeLine{00374     Rect frame;}
\DoxyCodeLine{00375     \textcolor{keywordtype}{long} max\_compressed\_size;}
\DoxyCodeLine{00376     QDErr err;}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378     m\_videoTrack = NewMovieTrack(m\_movie, FixRatio((\textcolor{keywordtype}{short})lx, 1),}
\DoxyCodeLine{00379                                  FixRatio((\textcolor{keywordtype}{short})ly, 1), kNoVolume);}
\DoxyCodeLine{00380 }
\DoxyCodeLine{00381     \textcolor{keywordflow}{if} ((err = GetMoviesError() != noErr))}
\DoxyCodeLine{00382       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create video track"{}});}
\DoxyCodeLine{00383 }
\DoxyCodeLine{00384     m\_dataRef    = nil;}
\DoxyCodeLine{00385     m\_hMovieData = NewHandle(0);}
\DoxyCodeLine{00386 }
\DoxyCodeLine{00387     \textcolor{comment}{// Construct the Handle data reference}}
\DoxyCodeLine{00388     err = PtrToHand(\&m\_hMovieData, \&m\_dataRef, \textcolor{keyword}{sizeof}(Handle));}
\DoxyCodeLine{00389 }
\DoxyCodeLine{00390     \textcolor{keywordflow}{if} ((err = GetMoviesError() != noErr))}
\DoxyCodeLine{00391       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create Data Ref"{}});}
\DoxyCodeLine{00392 }
\DoxyCodeLine{00393     m\_videoMedia =}
\DoxyCodeLine{00394         NewTrackMedia(m\_videoTrack, VideoMediaType, (TINT32)m\_frameRate,}
\DoxyCodeLine{00395                       m\_dataRef, HandleDataHandlerSubType);}
\DoxyCodeLine{00396 }
\DoxyCodeLine{00397     OpenADefaultComponent(MovieExportType, \textcolor{stringliteral}{'3gpp'}, \&m\_myExporter);}
\DoxyCodeLine{00398 }
\DoxyCodeLine{00399     \textcolor{comment}{//  err = (short)MovieExportDoUserDialog(m\_myExporter, m\_movie, 0, 0, 0,}}
\DoxyCodeLine{00400     \textcolor{comment}{//  \&m\_cancelled);}}
\DoxyCodeLine{00401 }
\DoxyCodeLine{00402     \textcolor{comment}{//  if (m\_cancelled)}}
\DoxyCodeLine{00403     \textcolor{comment}{//    throw TImageException(getFilePath(), "{}User abort of 3GP render"{});}}
\DoxyCodeLine{00404     \textcolor{keywordflow}{if} ((err = GetMoviesError() != noErr))}
\DoxyCodeLine{00405       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create video media"{}});}
\DoxyCodeLine{00406     \textcolor{keywordflow}{if} ((err = BeginMediaEdits(m\_videoMedia)) != noErr)}
\DoxyCodeLine{00407       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't begin edit video media"{}});}
\DoxyCodeLine{00408     frame.left   = 0;}
\DoxyCodeLine{00409     frame.top    = 0;}
\DoxyCodeLine{00410     frame.right  = lx;}
\DoxyCodeLine{00411     frame.bottom = ly;}
\DoxyCodeLine{00412 }
\DoxyCodeLine{00413 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{00414   \textcolor{keywordflow}{if} ((err = NewGWorld(\&(m\_gworld), pixSize * 8, \&frame, 0, 0, 0))!=noErr)}
\DoxyCodeLine{00415 \textcolor{preprocessor}{\#else }\textcolor{comment}{/* Mac OSX 10.7 later */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00416     \textcolor{keywordflow}{if} ((err = QTNewGWorld(\&(m\_gworld), pixSize * 8, \&frame, 0, 0, 0)) != noErr)}
\DoxyCodeLine{00417 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00418     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create movie buffer"{}});}
\DoxyCodeLine{00419 \textcolor{preprocessor}{\#ifdef WIN32}}
\DoxyCodeLine{00420     LockPixels(m\_gworld-\/>portPixMap);}
\DoxyCodeLine{00421     \textcolor{keywordflow}{if} ((err = GetMaxCompressionSize(m\_gworld-\/>portPixMap, \&frame, 0, quality,}
\DoxyCodeLine{00422                                      compression, anyCodec,}
\DoxyCodeLine{00423                                      \&max\_compressed\_size)) != noErr)}
\DoxyCodeLine{00424       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't get max compression size"{}});}
\DoxyCodeLine{00425 }
\DoxyCodeLine{00426 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00427 }
\DoxyCodeLine{00428 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{00429   PixMapHandle pixmapH = GetPortPixMap (m\_gworld);}
\DoxyCodeLine{00430   LockPixels(pixmapH);}
\DoxyCodeLine{00431 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00432     PixMapHandle pixmapH = NULL;}
\DoxyCodeLine{00433 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00434     max\_compressed\_size = lx * ly * 4 * 20;}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00436 \textcolor{comment}{/*if ((err = GetMaxCompressionSize(pixmapH, \&frame, 0,}}
\DoxyCodeLine{00437 \textcolor{comment}{                                quality,  compression,anyCodec,}}
\DoxyCodeLine{00438 \textcolor{comment}{                                 \&max\_compressed\_size))!=noErr)}}
\DoxyCodeLine{00439 \textcolor{comment}{    throw TImageException(getFilePath(), "{}can't get max compression size"{});*/}}
\DoxyCodeLine{00440 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00441 }
\DoxyCodeLine{00442     m\_compressedData = NewHandle(max\_compressed\_size);}
\DoxyCodeLine{00443 }
\DoxyCodeLine{00444     \textcolor{keywordflow}{if} ((err = MemError()) != noErr)}
\DoxyCodeLine{00445       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(),}
\DoxyCodeLine{00446                             \textcolor{stringliteral}{"{}can't allocate compressed data for movie"{}});}
\DoxyCodeLine{00447 }
\DoxyCodeLine{00448     MoveHHi(m\_compressedData);}
\DoxyCodeLine{00449     HLock(m\_compressedData);}
\DoxyCodeLine{00450     \textcolor{keywordflow}{if} ((err = MemError()) != noErr)}
\DoxyCodeLine{00451       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't allocate img handle"{}});}
\DoxyCodeLine{00452 }
\DoxyCodeLine{00453 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{00454   m\_pixmap = GetGWorldPixMap(m\_gworld);}
\DoxyCodeLine{00455   }
\DoxyCodeLine{00456   }
\DoxyCodeLine{00457   \textcolor{keywordflow}{if} (!LockPixels(m\_pixmap))}
\DoxyCodeLine{00458     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't lock pixels"{}});}
\DoxyCodeLine{00459 }
\DoxyCodeLine{00460   buf    = (\mbox{\hyperlink{struct_pixel_x_r_g_b}{PixelXRGB}}*) GetPixBaseAddr(m\_pixmap);}
\DoxyCodeLine{00461 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00462     m\_pixmap          = NULL;}
\DoxyCodeLine{00463     buf               = NULL;}
\DoxyCodeLine{00464 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00465     buf\_lx = lx;}
\DoxyCodeLine{00466     buf\_ly = ly;}
\DoxyCodeLine{00467 }
\DoxyCodeLine{00468     m\_initDone = \textcolor{keyword}{true};}
\DoxyCodeLine{00469   \}}
\DoxyCodeLine{00470 }
\DoxyCodeLine{00471   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} rowBytes =}
\DoxyCodeLine{00472       (\textcolor{keywordtype}{unsigned} short)(((\textcolor{keywordtype}{short})(*(m\_pixmap))-\/>rowBytes \& \string~(3 << 14)));}
\DoxyCodeLine{00473 }
\DoxyCodeLine{00474   Rect frame;}
\DoxyCodeLine{00475   ImageDescriptionHandle img\_descr;}
\DoxyCodeLine{00476   Ptr compressed\_data\_ptr;}
\DoxyCodeLine{00477   QDErr err;}
\DoxyCodeLine{00478 }
\DoxyCodeLine{00479   frame.left   = 0;}
\DoxyCodeLine{00480   frame.top    = 0;}
\DoxyCodeLine{00481   frame.right  = lx;}
\DoxyCodeLine{00482   frame.bottom = ly;}
\DoxyCodeLine{00483 }
\DoxyCodeLine{00484   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras = image-\/>getRaster();}
\DoxyCodeLine{00485 \textcolor{preprocessor}{\#ifdef WIN32}}
\DoxyCodeLine{00486   compressed\_data\_ptr = StripAddress(*(m\_compressedData));}
\DoxyCodeLine{00487   \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}(ras, buf, buf\_lx, buf\_ly);}
\DoxyCodeLine{00488 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00489   compressed\_data\_ptr = *m\_compressedData;}
\DoxyCodeLine{00490   \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}(ras, buf, buf\_lx, buf\_ly, rowBytes);}
\DoxyCodeLine{00491 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00492   img\_descr = (ImageDescriptionHandle)NewHandle(4);}
\DoxyCodeLine{00493 }
\DoxyCodeLine{00494 \textcolor{preprocessor}{\#ifdef WIN32}}
\DoxyCodeLine{00495   \textcolor{keywordflow}{if} ((err = CompressImage(m\_gworld-\/>portPixMap, \&frame, quality, compression,}
\DoxyCodeLine{00496                            img\_descr, compressed\_data\_ptr)) != noErr)}
\DoxyCodeLine{00497     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't compress image"{}});}
\DoxyCodeLine{00498 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00499 }
\DoxyCodeLine{00500 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{00501  PixMapHandle pixmapH = GetPortPixMap (m\_gworld);}
\DoxyCodeLine{00502  \textcolor{keywordflow}{if} ((err = CompressImage(pixmapH, }
\DoxyCodeLine{00503                      \&frame, }
\DoxyCodeLine{00504              codecNormalQuality, kJPEGCodecType,}
\DoxyCodeLine{00505              img\_descr, compressed\_data\_ptr))!=noErr)}
\DoxyCodeLine{00506     \{}
\DoxyCodeLine{00507   \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't compress image"{}});}
\DoxyCodeLine{00508 \}}
\DoxyCodeLine{00509 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00510 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00511 }
\DoxyCodeLine{00512   \textcolor{keywordflow}{if} ((err = AddMediaSample(}
\DoxyCodeLine{00513            m\_videoMedia, m\_compressedData, 0, (*img\_descr)-\/>dataSize, 1,}
\DoxyCodeLine{00514            (SampleDescriptionHandle)img\_descr, 1, 0, 0)) != noErr)}
\DoxyCodeLine{00515     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't add image to movie media"{}});}
\DoxyCodeLine{00516 }
\DoxyCodeLine{00517   DisposeHandle((Handle)img\_descr);}
\DoxyCodeLine{00518 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer3gp_a0f28dcd1c8e363174e04c0bb4eeec04a}\label{class_t_level_writer3gp_a0f28dcd1c8e363174e04c0bb4eeec04a}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!saveSoundTrack@{saveSoundTrack}}
\index{saveSoundTrack@{saveSoundTrack}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{saveSoundTrack()}{saveSoundTrack()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void TLevel\+Writer3gp\+::save\+Sound\+Track (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$}]{st }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.

\mbox{\Hypertarget{class_t_level_writer3gp_a3903642f89ec7dc3969b49057ef0daf1}\label{class_t_level_writer3gp_a3903642f89ec7dc3969b49057ef0daf1}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!saveSoundTrack@{saveSoundTrack}}
\index{saveSoundTrack@{saveSoundTrack}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{saveSoundTrack()}{saveSoundTrack()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void TLevel\+Writer3gp\+::save\+Sound\+Track (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$}]{st }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00586                                                     \{}
\DoxyCodeLine{00587   Track theTrack;}
\DoxyCodeLine{00588   OSErr myErr = noErr;}
\DoxyCodeLine{00589   SoundDescriptionV1Handle mySampleDesc;}
\DoxyCodeLine{00590   Media myMedia;}
\DoxyCodeLine{00591   Handle myDestHandle;}
\DoxyCodeLine{00592   SoundComponentData sourceInfo;}
\DoxyCodeLine{00593   SoundComponentData destInfo;}
\DoxyCodeLine{00594   SoundConverter converter;}
\DoxyCodeLine{00595   CompressionInfo compressionInfo;}
\DoxyCodeLine{00596   \textcolor{keywordtype}{int} err;}
\DoxyCodeLine{00597 }
\DoxyCodeLine{00598   \textcolor{keywordflow}{if} (!st) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}null reference to soundtrack"{}});}
\DoxyCodeLine{00599 }
\DoxyCodeLine{00600   \textcolor{keywordflow}{if} (st-\/>getBitPerSample() != 16) \{}
\DoxyCodeLine{00601     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}Only 16 bits per sample is supported"{}});}
\DoxyCodeLine{00602   \}}
\DoxyCodeLine{00603 }
\DoxyCodeLine{00604   theTrack = NewMovieTrack(m\_movie, 0, 0, kFullVolume);}
\DoxyCodeLine{00605   myErr    = GetMoviesError();}
\DoxyCodeLine{00606   \textcolor{keywordflow}{if} (myErr != noErr)}
\DoxyCodeLine{00607     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error creating audio track"{}});}
\DoxyCodeLine{00608 }
\DoxyCodeLine{00609   FailIf(myErr != noErr, CompressErr);}
\DoxyCodeLine{00610 }
\DoxyCodeLine{00611   myDestHandle = NewHandle(0);}
\DoxyCodeLine{00612 }
\DoxyCodeLine{00613   FailWithAction(myDestHandle == NULL, myErr = MemError(), NoDest);}
\DoxyCodeLine{00614 }
\DoxyCodeLine{00615   *myDestHandle = (\textcolor{keywordtype}{char} *)st-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00616 }
\DoxyCodeLine{00618   \textcolor{comment}{//}}
\DoxyCodeLine{00619   \textcolor{comment}{// create a media for the track passed in}}
\DoxyCodeLine{00620   \textcolor{comment}{//}}
\DoxyCodeLine{00622 \textcolor{comment}{}}
\DoxyCodeLine{00623   \textcolor{comment}{// set new track to be a sound track}}
\DoxyCodeLine{00624   m\_soundDataRef    = nil;}
\DoxyCodeLine{00625   m\_hSoundMovieData = NewHandle(0);}
\DoxyCodeLine{00626 }
\DoxyCodeLine{00627   \textcolor{comment}{// Construct the Handle data reference}}
\DoxyCodeLine{00628   err = PtrToHand(\&m\_hSoundMovieData, \&m\_soundDataRef, \textcolor{keyword}{sizeof}(Handle));}
\DoxyCodeLine{00629 }
\DoxyCodeLine{00630   \textcolor{keywordflow}{if} ((err = GetMoviesError() != noErr))}
\DoxyCodeLine{00631     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create Data Ref"{}});}
\DoxyCodeLine{00632 }
\DoxyCodeLine{00633   myMedia = NewTrackMedia(theTrack, SoundMediaType, st-\/>getSampleRate(),}
\DoxyCodeLine{00634                           m\_soundDataRef,}
\DoxyCodeLine{00635                           HandleDataHandlerSubType);  \textcolor{comment}{// track-\/>rate >> 16}}
\DoxyCodeLine{00636 }
\DoxyCodeLine{00637   myErr = GetMoviesError();}
\DoxyCodeLine{00638   \textcolor{keywordflow}{if} (myErr != noErr)}
\DoxyCodeLine{00639     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error setting audio track"{}});}
\DoxyCodeLine{00640   FailIf(myErr != noErr, Exit);}
\DoxyCodeLine{00641 }
\DoxyCodeLine{00642   \textcolor{comment}{// start a media editing session}}
\DoxyCodeLine{00643   myErr = BeginMediaEdits(myMedia);}
\DoxyCodeLine{00644   \textcolor{keywordflow}{if} (myErr != noErr)}
\DoxyCodeLine{00645     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error beginning edit audio track"{}});}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647   FailIf(myErr != noErr, Exit);}
\DoxyCodeLine{00648 }
\DoxyCodeLine{00649   sourceInfo.flags       = 0x0;}
\DoxyCodeLine{00650   sourceInfo.format      = kSoundNotCompressed;}
\DoxyCodeLine{00651   sourceInfo.numChannels = st-\/>getChannelCount();}
\DoxyCodeLine{00652   sourceInfo.sampleSize  = st-\/>getBitPerSample();}
\DoxyCodeLine{00653   sourceInfo.sampleRate  = st-\/>getSampleRate();}
\DoxyCodeLine{00654   sourceInfo.sampleCount = st-\/>getSampleCount();}
\DoxyCodeLine{00655   sourceInfo.buffer      = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)st-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00656   sourceInfo.reserved    = 0x0;}
\DoxyCodeLine{00657 }
\DoxyCodeLine{00658   destInfo.flags = kNoSampleRateConversion | kNoSampleSizeConversion |}
\DoxyCodeLine{00659                    kNoSampleFormatConversion | kNoChannelConversion |}
\DoxyCodeLine{00660                    kNoDecompression | kNoVolumeConversion |}
\DoxyCodeLine{00661                    kNoRealtimeProcessing;}
\DoxyCodeLine{00662 }
\DoxyCodeLine{00663   destInfo.format = k16BitNativeEndianFormat;}
\DoxyCodeLine{00664 }
\DoxyCodeLine{00665   destInfo.numChannels = st-\/>getChannelCount();}
\DoxyCodeLine{00666   destInfo.sampleSize  = st-\/>getBitPerSample();}
\DoxyCodeLine{00667   destInfo.sampleRate  = st-\/>getSampleRate();}
\DoxyCodeLine{00668   destInfo.sampleCount = st-\/>getSampleCount();}
\DoxyCodeLine{00669   destInfo.buffer      = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)st-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00670   destInfo.reserved    = 0x0;}
\DoxyCodeLine{00671 }
\DoxyCodeLine{00672   SoundConverterOpen(\&sourceInfo, \&destInfo, \&converter);}
\DoxyCodeLine{00673 }
\DoxyCodeLine{00674   myErr =}
\DoxyCodeLine{00675       SoundConverterGetInfo(converter, siCompressionFactor, \&compressionInfo);}
\DoxyCodeLine{00676   \textcolor{keywordflow}{if} (myErr != noErr)}
\DoxyCodeLine{00677     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error getting audio converter info"{}});}
\DoxyCodeLine{00678 }
\DoxyCodeLine{00679   myErr = GetCompressionInfo(fixedCompression, sourceInfo.format,}
\DoxyCodeLine{00680                              sourceInfo.numChannels, sourceInfo.sampleSize,}
\DoxyCodeLine{00681                              \&compressionInfo);}
\DoxyCodeLine{00682   \textcolor{keywordflow}{if} (myErr != noErr)}
\DoxyCodeLine{00683     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error getting audio compression info"{}});}
\DoxyCodeLine{00684   FailIf(myErr != noErr, ConverterErr);}
\DoxyCodeLine{00685 }
\DoxyCodeLine{00686   compressionInfo.bytesPerFrame =}
\DoxyCodeLine{00687       compressionInfo.bytesPerPacket * destInfo.numChannels;}
\DoxyCodeLine{00688 }
\DoxyCodeLine{00690   \textcolor{comment}{//}}
\DoxyCodeLine{00691   \textcolor{comment}{// create a sound sample description}}
\DoxyCodeLine{00692   \textcolor{comment}{//}}
\DoxyCodeLine{00694 \textcolor{comment}{}}
\DoxyCodeLine{00695   \textcolor{comment}{// use the SoundDescription format 1 because it adds fields for data size}}
\DoxyCodeLine{00696   \textcolor{comment}{// information}}
\DoxyCodeLine{00697   \textcolor{comment}{// and is required by AddSoundDescriptionExtension if an extension is required}}
\DoxyCodeLine{00698   \textcolor{comment}{// for the compression format}}
\DoxyCodeLine{00699 }
\DoxyCodeLine{00700   mySampleDesc =}
\DoxyCodeLine{00701       (SoundDescriptionV1Handle)NewHandleClear(\textcolor{keyword}{sizeof}(SoundDescriptionV1));}
\DoxyCodeLine{00702   FailWithAction(myErr != noErr, myErr = MemError(), Exit);}
\DoxyCodeLine{00703 }
\DoxyCodeLine{00704   (**mySampleDesc).desc.descSize      = \textcolor{keyword}{sizeof}(SoundDescriptionV1);}
\DoxyCodeLine{00705   (**mySampleDesc).desc.dataFormat    = destInfo.format;}
\DoxyCodeLine{00706   (**mySampleDesc).desc.resvd1        = 0;}
\DoxyCodeLine{00707   (**mySampleDesc).desc.resvd2        = 0;}
\DoxyCodeLine{00708   (**mySampleDesc).desc.dataRefIndex  = 1;}
\DoxyCodeLine{00709   (**mySampleDesc).desc.version       = 1;}
\DoxyCodeLine{00710   (**mySampleDesc).desc.revlevel      = 0;}
\DoxyCodeLine{00711   (**mySampleDesc).desc.vendor        = 0;}
\DoxyCodeLine{00712   (**mySampleDesc).desc.numChannels   = destInfo.numChannels;}
\DoxyCodeLine{00713   (**mySampleDesc).desc.sampleSize    = destInfo.sampleSize;}
\DoxyCodeLine{00714   (**mySampleDesc).desc.compressionID = 0;}
\DoxyCodeLine{00715   (**mySampleDesc).desc.packetSize    = 0;}
\DoxyCodeLine{00716   (**mySampleDesc).desc.sampleRate    = st-\/>getSampleRate() << 16;}
\DoxyCodeLine{00717   (**mySampleDesc).samplesPerPacket   = compressionInfo.samplesPerPacket;}
\DoxyCodeLine{00718   (**mySampleDesc).bytesPerPacket     = compressionInfo.bytesPerPacket;}
\DoxyCodeLine{00719   (**mySampleDesc).bytesPerFrame      = compressionInfo.bytesPerFrame;}
\DoxyCodeLine{00720   (**mySampleDesc).bytesPerSample     = compressionInfo.bytesPerSample;}
\DoxyCodeLine{00721 }
\DoxyCodeLine{00723   \textcolor{comment}{//}}
\DoxyCodeLine{00724   \textcolor{comment}{// add samples to the media}}
\DoxyCodeLine{00725   \textcolor{comment}{//}}
\DoxyCodeLine{00727 \textcolor{comment}{}}
\DoxyCodeLine{00728   myErr = AddMediaSample(}
\DoxyCodeLine{00729       myMedia, myDestHandle, 0,}
\DoxyCodeLine{00730       destInfo.sampleCount * compressionInfo.bytesPerFrame, 1,}
\DoxyCodeLine{00731       (SampleDescriptionHandle)mySampleDesc,}
\DoxyCodeLine{00732       destInfo.sampleCount * compressionInfo.samplesPerPacket, 0, NULL);}
\DoxyCodeLine{00733 }
\DoxyCodeLine{00734   \textcolor{keywordflow}{if} (myErr != noErr)}
\DoxyCodeLine{00735     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error adding audio samples"{}});}
\DoxyCodeLine{00736 }
\DoxyCodeLine{00737   FailIf(myErr != noErr, MediaErr);}
\DoxyCodeLine{00738 }
\DoxyCodeLine{00739   myErr = EndMediaEdits(myMedia);}
\DoxyCodeLine{00740   \textcolor{keywordflow}{if} (myErr != noErr) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error ending audio edit"{}});}
\DoxyCodeLine{00741 }
\DoxyCodeLine{00742   FailIf(myErr != noErr, MediaErr);}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00745   \textcolor{comment}{//}}
\DoxyCodeLine{00746   \textcolor{comment}{// insert the media into the track}}
\DoxyCodeLine{00747   \textcolor{comment}{//}}
\DoxyCodeLine{00749 \textcolor{comment}{}}
\DoxyCodeLine{00750   myErr =}
\DoxyCodeLine{00751       InsertMediaIntoTrack(theTrack, 0, 0, GetMediaDuration(myMedia), fixed1);}
\DoxyCodeLine{00752   \textcolor{keywordflow}{if} (myErr != noErr)}
\DoxyCodeLine{00753     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error inserting audio track"{}});}
\DoxyCodeLine{00754 }
\DoxyCodeLine{00755   FailIf(myErr != noErr, MediaErr);}
\DoxyCodeLine{00756   \textcolor{keywordflow}{goto} Done;}
\DoxyCodeLine{00757 }
\DoxyCodeLine{00758 ConverterErr:}
\DoxyCodeLine{00759 NoDest:}
\DoxyCodeLine{00760 CompressErr:}
\DoxyCodeLine{00761 Exit:}
\DoxyCodeLine{00762 }
\DoxyCodeLine{00763 Done:}
\DoxyCodeLine{00764 }
\DoxyCodeLine{00765 MediaErr:}
\DoxyCodeLine{00766   \textcolor{keywordflow}{if} (mySampleDesc != NULL) DisposeHandle((Handle)mySampleDesc);}
\DoxyCodeLine{00767 }
\DoxyCodeLine{00768   \textcolor{keywordflow}{if} (converter) SoundConverterClose(converter);}
\DoxyCodeLine{00769 }
\DoxyCodeLine{00770   \textcolor{keywordflow}{if} (myErr != noErr) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error saving audio track"{}});}
\DoxyCodeLine{00771 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_t_level_writer3gp_a708af9631065133452fa7087b061deca}\label{class_t_level_writer3gp_a708af9631065133452fa7087b061deca}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!m\_dataRef@{m\_dataRef}}
\index{m\_dataRef@{m\_dataRef}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{m\_dataRef}{m\_dataRef}}
{\footnotesize\ttfamily Handle TLevel\+Writer3gp\+::m\+\_\+data\+Ref}

\mbox{\Hypertarget{class_t_level_writer3gp_a9dc02c96e2722149ec3e4e18cf80d1f5}\label{class_t_level_writer3gp_a9dc02c96e2722149ec3e4e18cf80d1f5}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!m\_hMovieData@{m\_hMovieData}}
\index{m\_hMovieData@{m\_hMovieData}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{m\_hMovieData}{m\_hMovieData}}
{\footnotesize\ttfamily Handle TLevel\+Writer3gp\+::m\+\_\+h\+Movie\+Data}

\mbox{\Hypertarget{class_t_level_writer3gp_a2d0652e55f511998bcf3b163c716087f}\label{class_t_level_writer3gp_a2d0652e55f511998bcf3b163c716087f}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!m\_hSoundMovieData@{m\_hSoundMovieData}}
\index{m\_hSoundMovieData@{m\_hSoundMovieData}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{m\_hSoundMovieData}{m\_hSoundMovieData}}
{\footnotesize\ttfamily Handle TLevel\+Writer3gp\+::m\+\_\+h\+Sound\+Movie\+Data}

\mbox{\Hypertarget{class_t_level_writer3gp_a0d114a2c8fedead0efeac21c9359e1c1}\label{class_t_level_writer3gp_a0d114a2c8fedead0efeac21c9359e1c1}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!m\_initDone@{m\_initDone}}
\index{m\_initDone@{m\_initDone}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{m\_initDone}{m\_initDone}}
{\footnotesize\ttfamily bool TLevel\+Writer3gp\+::m\+\_\+init\+Done}

\mbox{\Hypertarget{class_t_level_writer3gp_ab4dec70fd58156e15ec84aa6de08620c}\label{class_t_level_writer3gp_ab4dec70fd58156e15ec84aa6de08620c}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!m\_IOError@{m\_IOError}}
\index{m\_IOError@{m\_IOError}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{m\_IOError}{m\_IOError}}
{\footnotesize\ttfamily int TLevel\+Writer3gp\+::m\+\_\+\+IOError}

\mbox{\Hypertarget{class_t_level_writer3gp_a13d5c9957976ed569589b93d8ff14c28}\label{class_t_level_writer3gp_a13d5c9957976ed569589b93d8ff14c28}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!m\_myExporter@{m\_myExporter}}
\index{m\_myExporter@{m\_myExporter}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{m\_myExporter}{m\_myExporter}}
{\footnotesize\ttfamily Movie\+Export\+Component TLevel\+Writer3gp\+::m\+\_\+my\+Exporter}

\mbox{\Hypertarget{class_t_level_writer3gp_a955738d8ed16f042daa9e03fcbf1415b}\label{class_t_level_writer3gp_a955738d8ed16f042daa9e03fcbf1415b}} 
\index{TLevelWriter3gp@{TLevelWriter3gp}!m\_soundDataRef@{m\_soundDataRef}}
\index{m\_soundDataRef@{m\_soundDataRef}!TLevelWriter3gp@{TLevelWriter3gp}}
\doxysubsubsection{\texorpdfstring{m\_soundDataRef}{m\_soundDataRef}}
{\footnotesize\ttfamily Handle TLevel\+Writer3gp\+::m\+\_\+sound\+Data\+Ref}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/image/3gp/tiio\+\_\+3gp.\+h\item 
E\+:/opentoonz/toonz/sources/image/3gp/tiio\+\_\+3gp\+M.\+h\item 
E\+:/opentoonz/toonz/sources/image/3gp/tiio\+\_\+3gp\+M.\+cpp\item 
E\+:/opentoonz/toonz/sources/image/3gp/tiio\+\_\+3gp\+W.\+cpp\end{DoxyCompactItemize}
