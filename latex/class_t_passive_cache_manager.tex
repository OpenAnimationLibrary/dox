\hypertarget{class_t_passive_cache_manager}{}\doxysection{TPassive\+Cache\+Manager Class Reference}
\label{class_t_passive_cache_manager}\index{TPassiveCacheManager@{TPassiveCacheManager}}


{\ttfamily \#include $<$tpassivecachemanager.\+h$>$}

Inheritance diagram for TPassive\+Cache\+Manager\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_passive_cache_manager}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_passive_cache_manager_1_1_resources_container}{Resources\+Container}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Storage\+Flag} \{ {\bfseries NONE} = 0x0
, {\bfseries IN\+\_\+\+MEMORY} = 0x1
, {\bfseries ON\+\_\+\+DISK} = 0x2
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_a2c20bd3232f55e2786bd20635e1bb112}{set\+Context\+Name}} (unsigned long render\+Id, const std\+::string \&name)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_a2ab35ba38c7038585c65d3b44097cbae}{release\+Context\+Names\+With\+Prefix}} (const std\+::string \&prefix)
\item 
\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$ \mbox{\hyperlink{class_t_passive_cache_manager_a08c6354eecadc7b40b6458839f96c269}{get\+Not\+Allowing\+Ancestor}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_aa06d1bf369dceef622bd73c94149900c}{set\+Enabled}} (bool enabled)
\item 
bool \mbox{\hyperlink{class_t_passive_cache_manager_a034f5042af0c2ae32b3f3782800bdea4}{is\+Enabled}} () const
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_a0e2330d9eb0eadbfcec493cebedaa060}{reset}} ()
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_aff0e2de17a7a016845b873c2b4fef62d}{set\+Storage\+Mode}} (Storage\+Flag mode)
\item 
Storage\+Flag \mbox{\hyperlink{class_t_passive_cache_manager_ad527fce42a3a2ab5f58e59f84951d216}{get\+Storage\+Mode}} () const
\item 
int \mbox{\hyperlink{class_t_passive_cache_manager_ac77b86f4e781f8fb5de7cc8bd01f84da}{declare\+Cached}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx, int passive\+Cache\+Id)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_aff55be837bd0ada9ac55d74b89dfa668}{on\+Scene\+Loaded}} ()
\item 
int \mbox{\hyperlink{class_t_passive_cache_manager_ae1c6d4589d4f802f0fa4984dcf48ebf4}{get\+Passive\+Cache\+Id}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_ae0552b16b8aa4e3c463b68911106085f}{enable\+Cache}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_ab4ef11129f6733e0fcd8eab7f898a150}{disable\+Cache}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx)
\item 
bool \mbox{\hyperlink{class_t_passive_cache_manager_af3a4e5c9a22b727b433fe6616b752162}{cache\+Enabled}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_adee26ed665001a580acac328fc4d421d}{toggle\+Cache}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx)
\item 
Storage\+Flag \mbox{\hyperlink{class_t_passive_cache_manager_a5249ffe01029bdc7c8fa78bf800482f1}{get\+Storage\+Mode}} (\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$fx)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_aadc703ccd97a5146378e6febbe8bd6b9}{invalidate\+Level}} (const std\+::string \&level\+Name)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_a0af562eb6c9ba61d36d3da699bdd6da6}{force\+Invalidate}} ()
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_a4dbe2f625fb87bdfbec07d1c10f8044a}{get\+Resource}} (\mbox{\hyperlink{class_t_cache_resource_p}{TCache\+ResourceP}} \&resource, const std\+::string \&alias, const \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} \&fx, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&rs, \mbox{\hyperlink{struct_resource_declaration}{Resource\+Declaration}} $\ast$res\+Data) override
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_ae959b124b1c6ea8cfd22b47fc2caa0bb}{on\+Render\+Instance\+Start}} (unsigned long render\+Id) override
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_ada3c1f609ae26d2fa8da6a45294c843d}{on\+Render\+Instance\+End}} (unsigned long render\+Id) override
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_ada26a2c0534df8a0afb156963028e154}{on\+Render\+Status\+End}} (int render\+Status) override
\item 
bool \mbox{\hyperlink{class_t_passive_cache_manager_a9260b4991f1e0c54a5223772f9a2dc53}{render\+Has\+Ownership}} () override
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_afea42d661b5eb770e3387c6b9109a69f}{set\+Tree\+Descriptor}} (Tree\+Descriptor callback)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_a5056738b643855e3891b28dd1b7660ef}{on\+Fx\+Changed}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} \&fx)
\item 
void \mbox{\hyperlink{class_t_passive_cache_manager_a37aac967d7abcf63b5e27b934f0cb885}{on\+Xsheet\+Changed}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_passive_cache_manager}{TPassive\+Cache\+Manager}} $\ast$ \mbox{\hyperlink{class_t_passive_cache_manager_a5344938175e12d4b173ed7a11dfe033c}{instance}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The \mbox{\hyperlink{class_t_passive_cache_manager}{TPassive\+Cache\+Manager}} is the cache delegate manager that allows render processes to cache fx results from externally specified schematic nodes for future reuse. Observe that this manager takes no effort in verifying the usefulness of caching an fx, as the expected behaviour for such cached results is that of being recycled on future, {\itshape unpredictable} render instances under the same passive cache management. Active, predictive caching takes place under control of another manager class -\/ namely, the \mbox{\hyperlink{class_t_fx_cache_manager}{TFx\+Cache\+Manager}} -\/ for single render instances. 

\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{class_t_passive_cache_manager_a21077c90b4eba6c9cff6718b16701256}\label{class_t_passive_cache_manager_a21077c90b4eba6c9cff6718b16701256}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!StorageFlag@{StorageFlag}}
\index{StorageFlag@{StorageFlag}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{StorageFlag}{StorageFlag}}
{\footnotesize\ttfamily enum TPassive\+Cache\+Manager\+::\+Storage\+Flag}


\begin{DoxyCode}{0}
\DoxyCodeLine{00088 \{ NONE = 0x0, IN\_MEMORY = 0x1, ON\_DISK = 0x2 \};}

\end{DoxyCode}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_passive_cache_manager_abc5ccecee9dba4cf97bbc3653840e865}\label{class_t_passive_cache_manager_abc5ccecee9dba4cf97bbc3653840e865}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!````~TPassiveCacheManager@{$\sim$TPassiveCacheManager}}
\index{````~TPassiveCacheManager@{$\sim$TPassiveCacheManager}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{$\sim$TPassiveCacheManager()}{~TPassiveCacheManager()}}
{\footnotesize\ttfamily TPassive\+Cache\+Manager\+::$\sim$\+TPassive\+Cache\+Manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00442 \{ \textcolor{keyword}{delete} m\_resources; \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_passive_cache_manager_af3a4e5c9a22b727b433fe6616b752162}\label{class_t_passive_cache_manager_af3a4e5c9a22b727b433fe6616b752162}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!cacheEnabled@{cacheEnabled}}
\index{cacheEnabled@{cacheEnabled}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{cacheEnabled()}{cacheEnabled()}}
{\footnotesize\ttfamily bool TPassive\+Cache\+Manager\+::cache\+Enabled (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00576                                                \{}
\DoxyCodeLine{00577   \textcolor{keywordtype}{int} idx = fx-\/>getAttributes()-\/>passiveCacheDataIdx();}
\DoxyCodeLine{00578   \textcolor{keywordflow}{if} (idx < 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00579 }
\DoxyCodeLine{00580   assert(idx < (\textcolor{keywordtype}{int})m\_fxDataVector.size());}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00583 }
\DoxyCodeLine{00584   \textcolor{keywordflow}{return} m\_fxDataVector[idx].m\_storageFlag > 0;}
\DoxyCodeLine{00585 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ac77b86f4e781f8fb5de7cc8bd01f84da}\label{class_t_passive_cache_manager_ac77b86f4e781f8fb5de7cc8bd01f84da}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!declareCached@{declareCached}}
\index{declareCached@{declareCached}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{declareCached()}{declareCached()}}
{\footnotesize\ttfamily int TPassive\+Cache\+Manager\+::declare\+Cached (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx,  }\item[{int}]{passive\+Cache\+Id }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00553                                                                    \{}
\DoxyCodeLine{00554   \textcolor{keywordtype}{int} \&idx = fx-\/>getAttributes()-\/>passiveCacheDataIdx();}
\DoxyCodeLine{00555   touchFxData(idx);}
\DoxyCodeLine{00556 }
\DoxyCodeLine{00557   FxData \&data          = m\_fxDataVector[idx];}
\DoxyCodeLine{00558   data.m\_fx             = fx;}
\DoxyCodeLine{00559   data.m\_storageFlag    = m\_currStorageFlag;}
\DoxyCodeLine{00560   data.m\_passiveCacheId = updatePassiveCacheId(passiveCacheId);}
\DoxyCodeLine{00561 }
\DoxyCodeLine{00562   \textcolor{keywordflow}{return} idx;}
\DoxyCodeLine{00563 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ab4ef11129f6733e0fcd8eab7f898a150}\label{class_t_passive_cache_manager_ab4ef11129f6733e0fcd8eab7f898a150}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!disableCache@{disableCache}}
\index{disableCache@{disableCache}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{disableCache()}{disableCache()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::disable\+Cache (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00659                                                \{}
\DoxyCodeLine{00660   \textcolor{keywordtype}{int} idx = fx-\/>getAttributes()-\/>passiveCacheDataIdx();}
\DoxyCodeLine{00661   \textcolor{keywordflow}{if} (idx < 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00662 }
\DoxyCodeLine{00663   FxData \&data = m\_fxDataVector[idx];}
\DoxyCodeLine{00664 }
\DoxyCodeLine{00665   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00666 }
\DoxyCodeLine{00667 \textcolor{preprocessor}{\#ifdef DIAGNOSTICS}}
\DoxyCodeLine{00668   DIAGNOSTICS\_STR(\textcolor{stringliteral}{"{}\#activity.txt | "{}} + QTime::currentTime().toString() + \textcolor{stringliteral}{"{} "{}} +}
\DoxyCodeLine{00669                   QString(\textcolor{stringliteral}{"{}Disable Cache"{}}));}
\DoxyCodeLine{00670 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00671 }
\DoxyCodeLine{00672   StorageFlag flag = getStorageMode();}
\DoxyCodeLine{00673   \textcolor{keywordflow}{if} (flag) \{}
\DoxyCodeLine{00674     UCHAR \&storedFlag = data.m\_storageFlag;}
\DoxyCodeLine{00675     UCHAR oldFlag     = storedFlag;}
\DoxyCodeLine{00676 }
\DoxyCodeLine{00677     storedFlag \&= \string~flag;}
\DoxyCodeLine{00678 }
\DoxyCodeLine{00679     \textcolor{keywordflow}{if} ((oldFlag \& IN\_MEMORY) \&\& !(storedFlag \& IN\_MEMORY)) \{}
\DoxyCodeLine{00680       m\_resources-\/>getTable().erase(data.m\_passiveCacheId);}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682       data.m\_fx              = \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}();}
\DoxyCodeLine{00683       data.m\_treeDescription = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00684     \}}
\DoxyCodeLine{00685 }
\DoxyCodeLine{00686 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00687     \textcolor{keywordflow}{if} ((oldFlag \& ON\_DISK) \&\& !(storedFlag \& ON\_DISK))}
\DoxyCodeLine{00688       TCacheResourcePool::instance()-\/>releaseReferences(}
\DoxyCodeLine{00689           \textcolor{stringliteral}{"{}P"{}} + QString::number(data.m\_passiveCacheId));}
\DoxyCodeLine{00690 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00691   \}}
\DoxyCodeLine{00692 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ae0552b16b8aa4e3c463b68911106085f}\label{class_t_passive_cache_manager_ae0552b16b8aa4e3c463b68911106085f}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!enableCache@{enableCache}}
\index{enableCache@{enableCache}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{enableCache()}{enableCache()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::enable\+Cache (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00613                                               \{}
\DoxyCodeLine{00614   \textcolor{keywordtype}{int} \&idx = fx-\/>getAttributes()-\/>passiveCacheDataIdx();}
\DoxyCodeLine{00615   touchFxData(idx);}
\DoxyCodeLine{00616 }
\DoxyCodeLine{00617   FxData \&data = m\_fxDataVector[idx];}
\DoxyCodeLine{00618 }
\DoxyCodeLine{00619   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00620 }
\DoxyCodeLine{00621 \textcolor{preprocessor}{\#ifdef DIAGNOSTICS}}
\DoxyCodeLine{00622   DIAGNOSTICS\_STR(\textcolor{stringliteral}{"{}\#activity.txt | "{}} + QTime::currentTime().toString() + \textcolor{stringliteral}{"{} "{}} +}
\DoxyCodeLine{00623                   QString(\textcolor{stringliteral}{"{}Enable Cache"{}}));}
\DoxyCodeLine{00624 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00625 }
\DoxyCodeLine{00626   StorageFlag flag = getStorageMode();}
\DoxyCodeLine{00627   \textcolor{keywordflow}{if} (flag) \{}
\DoxyCodeLine{00628     UCHAR \&storedFlag = data.m\_storageFlag;}
\DoxyCodeLine{00629     UCHAR oldFlag     = storedFlag;}
\DoxyCodeLine{00630 }
\DoxyCodeLine{00631     storedFlag |= flag;}
\DoxyCodeLine{00632 }
\DoxyCodeLine{00633     \textcolor{keywordflow}{if} (data.m\_passiveCacheId == 0)}
\DoxyCodeLine{00634       data.m\_passiveCacheId = getNewPassiveCacheId();}
\DoxyCodeLine{00635 }
\DoxyCodeLine{00636     \textcolor{keywordflow}{if} ((storedFlag \& ON\_DISK) \&\& !(oldFlag \& ON\_DISK)) \{}
\DoxyCodeLine{00637       ResourcesTable::ColIterator it =}
\DoxyCodeLine{00638           m\_resources-\/>getTable().colBegin(data.m\_passiveCacheId);}
\DoxyCodeLine{00639       \textcolor{keywordflow}{for} (; it; ++it) \{}
\DoxyCodeLine{00640         std::set<LockedResourceP> \&resources = *it;}
\DoxyCodeLine{00641 }
\DoxyCodeLine{00642         std::set<LockedResourceP>::iterator jt;}
\DoxyCodeLine{00643         \textcolor{keywordflow}{for} (jt = resources.begin(); jt != resources.end(); ++jt)}
\DoxyCodeLine{00644           (*jt)-\/>enableBackup();}
\DoxyCodeLine{00645       \}}
\DoxyCodeLine{00646     \}}
\DoxyCodeLine{00647 }
\DoxyCodeLine{00648 \textcolor{preprocessor}{\#ifndef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00649     \textcolor{keywordflow}{if} ((storedFlag \& IN\_MEMORY) \&\& !(oldFlag \& IN\_MEMORY)) \{}
\DoxyCodeLine{00650       data.m\_fx = fx;}
\DoxyCodeLine{00651       (*m\_descriptorCallback)(data.m\_treeDescription, data.m\_fx);}
\DoxyCodeLine{00652     \}}
\DoxyCodeLine{00653 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00654   \}}
\DoxyCodeLine{00655 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a0af562eb6c9ba61d36d3da699bdd6da6}\label{class_t_passive_cache_manager_a0af562eb6c9ba61d36d3da699bdd6da6}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!forceInvalidate@{forceInvalidate}}
\index{forceInvalidate@{forceInvalidate}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{forceInvalidate()}{forceInvalidate()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::force\+Invalidate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00792                                            \{}
\DoxyCodeLine{00793 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00794   \mbox{\hyperlink{class_t_cache_resource_pool}{TCacheResourcePool}} *pool = TCacheResourcePool::instance();}
\DoxyCodeLine{00795 }
\DoxyCodeLine{00796   \textcolor{comment}{// Clear all invalidated levels from the resource pool}}
\DoxyCodeLine{00797   std::set<std::string>::iterator it;}
\DoxyCodeLine{00798   \textcolor{keywordflow}{for} (it = m\_invalidatedLevels.begin(); it != m\_invalidatedLevels.end(); ++it)}
\DoxyCodeLine{00799     pool-\/>clearKeyword(*it);}
\DoxyCodeLine{00800 }
\DoxyCodeLine{00801   m\_invalidatedLevels.clear();}
\DoxyCodeLine{00802 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00803 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a08c6354eecadc7b40b6458839f96c269}\label{class_t_passive_cache_manager_a08c6354eecadc7b40b6458839f96c269}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!getNotAllowingAncestor@{getNotAllowingAncestor}}
\index{getNotAllowingAncestor@{getNotAllowingAncestor}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{getNotAllowingAncestor()}{getNotAllowingAncestor()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_fx}{TFx}} $\ast$ TPassive\+Cache\+Manager\+::get\+Not\+Allowing\+Ancestor (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00153                                                          \{}
\DoxyCodeLine{00154   \textcolor{comment}{// Trace all output ports}}
\DoxyCodeLine{00155   \textcolor{keywordtype}{int} outputPortsCount = fx-\/>getOutputConnectionCount();}
\DoxyCodeLine{00156   \textcolor{comment}{/*if(!outputPortsCount)   //We have no access to TApp here!!}}
\DoxyCodeLine{00157 \textcolor{comment}{\{}}
\DoxyCodeLine{00158 \textcolor{comment}{//It could be a terminal fx. In that case, pass to the xsheet fx}}
\DoxyCodeLine{00159 \textcolor{comment}{FxDag* dag = TApp::instance()-\/>getCurrentXsheet()-\/>getXsheet()-\/>getFxDag();}}
\DoxyCodeLine{00160 \textcolor{comment}{if(dag-\/>getTerminalFxs()-\/>containsFx(fx))}}
\DoxyCodeLine{00161 \textcolor{comment}{return getNotAllowingAncestor(dag-\/>getXsheetFx());}}
\DoxyCodeLine{00162 \textcolor{comment}{\}*/}}
\DoxyCodeLine{00163 }
\DoxyCodeLine{00164   \textcolor{comment}{// Now, for common ports}}
\DoxyCodeLine{00165   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < outputPortsCount; ++i) \{}
\DoxyCodeLine{00166     \textcolor{comment}{// Find the output Fx and the port connected to our fx}}
\DoxyCodeLine{00167     \mbox{\hyperlink{class_t_fx_port}{TFxPort}} *port    = fx-\/>getOutputConnection(i);}
\DoxyCodeLine{00168     \mbox{\hyperlink{class_t_raster_fx}{TRasterFx}} *outFx = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_t_raster_fx}{TRasterFx}} *\textcolor{keyword}{>}(port-\/>getOwnerFx());}
\DoxyCodeLine{00169 }
\DoxyCodeLine{00170     \textcolor{keywordtype}{int} portIdx, portsCount = outFx-\/>getInputPortCount();}
\DoxyCodeLine{00171     \textcolor{keywordflow}{for} (portIdx = 0; portIdx < portsCount; ++portIdx)}
\DoxyCodeLine{00172       \textcolor{keywordflow}{if} (outFx-\/>getInputPort(portIdx) == port) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00173     assert(portIdx < portsCount);}
\DoxyCodeLine{00174 }
\DoxyCodeLine{00175     \textcolor{keywordflow}{if} (!outFx-\/>allowUserCacheOnPort(portIdx)) \textcolor{keywordflow}{return} outFx;}
\DoxyCodeLine{00176 }
\DoxyCodeLine{00177     \mbox{\hyperlink{class_t_fx}{TFx}} *naAncestor = getNotAllowingAncestor(outFx);}
\DoxyCodeLine{00178     \textcolor{keywordflow}{if} (naAncestor) \textcolor{keywordflow}{return} naAncestor;}
\DoxyCodeLine{00179   \}}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00182 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ae1c6d4589d4f802f0fa4984dcf48ebf4}\label{class_t_passive_cache_manager_ae1c6d4589d4f802f0fa4984dcf48ebf4}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!getPassiveCacheId@{getPassiveCacheId}}
\index{getPassiveCacheId@{getPassiveCacheId}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{getPassiveCacheId()}{getPassiveCacheId()}}
{\footnotesize\ttfamily int TPassive\+Cache\+Manager\+::get\+Passive\+Cache\+Id (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00589                                                    \{}
\DoxyCodeLine{00590   \textcolor{keywordtype}{int} idx = fx-\/>getAttributes()-\/>passiveCacheDataIdx();}
\DoxyCodeLine{00591   \textcolor{keywordflow}{if} (idx < 0) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00592 }
\DoxyCodeLine{00593   \textcolor{comment}{// This needs not be mutex locked}}
\DoxyCodeLine{00594 }
\DoxyCodeLine{00595   assert(idx < (\textcolor{keywordtype}{int})m\_fxDataVector.size());}
\DoxyCodeLine{00596   \textcolor{keywordflow}{return} m\_fxDataVector[idx].m\_passiveCacheId;}
\DoxyCodeLine{00597 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a4dbe2f625fb87bdfbec07d1c10f8044a}\label{class_t_passive_cache_manager_a4dbe2f625fb87bdfbec07d1c10f8044a}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!getResource@{getResource}}
\index{getResource@{getResource}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{getResource()}{getResource()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::get\+Resource (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_cache_resource_p}{TCache\+ResourceP}} \&}]{resource,  }\item[{const std\+::string \&}]{alias,  }\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} \&}]{fx,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{rs,  }\item[{\mbox{\hyperlink{struct_resource_declaration}{Resource\+Declaration}} $\ast$}]{res\+Data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_fx_cache_manager_delegate}{TFx\+Cache\+Manager\+Delegate}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00863                                                                      \{}
\DoxyCodeLine{00864   \textcolor{keywordflow}{if} (!(m\_enabled \&\& fx \&\& rs.\mbox{\hyperlink{class_t_render_settings_aee613531a92343c1f61548465bcb7741}{m\_userCachable}})) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00865 }
\DoxyCodeLine{00866   StorageFlag flag = getStorageMode(fx.getPointer());}
\DoxyCodeLine{00867   \textcolor{keywordflow}{if} (flag == NONE) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00868 }
\DoxyCodeLine{00869   std::string contextName(getContextName());}
\DoxyCodeLine{00870   \textcolor{keywordflow}{if} (contextName.empty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00871 }
\DoxyCodeLine{00872   \textcolor{comment}{// Build a resource if none was passed.}}
\DoxyCodeLine{00873   \textcolor{keywordflow}{if} (!resource) resource = \mbox{\hyperlink{class_t_cache_resource_p}{TCacheResourceP}}(alias, \textcolor{keyword}{true});}
\DoxyCodeLine{00874 }
\DoxyCodeLine{00875 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00876   \textcolor{keywordflow}{if} (flag \& ON\_DISK) \{}
\DoxyCodeLine{00877     resource-\/>enableBackup();}
\DoxyCodeLine{00878 }
\DoxyCodeLine{00879     \textcolor{keywordtype}{int} passiveCacheId =}
\DoxyCodeLine{00880         m\_fxDataVector[fx-\/>getAttributes()-\/>passiveCacheDataIdx()]}
\DoxyCodeLine{00881             .m\_passiveCacheId;}
\DoxyCodeLine{00882     TCacheResourcePool::instance()-\/>addReference(}
\DoxyCodeLine{00883         resource, \textcolor{stringliteral}{"{}P"{}} + QString::number(passiveCacheId));}
\DoxyCodeLine{00884   \}}
\DoxyCodeLine{00885 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00886 }
\DoxyCodeLine{00887   \textcolor{keywordflow}{if} (flag \& IN\_MEMORY) \{}
\DoxyCodeLine{00888     QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00889 }
\DoxyCodeLine{00890     \textcolor{keywordtype}{int} passiveCacheId =}
\DoxyCodeLine{00891         m\_fxDataVector[fx-\/>getAttributes()-\/>passiveCacheDataIdx()]}
\DoxyCodeLine{00892             .m\_passiveCacheId;}
\DoxyCodeLine{00893     m\_resources-\/>getTable().value(contextName, passiveCacheId).insert(resource);}
\DoxyCodeLine{00894   \}}
\DoxyCodeLine{00895 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ad527fce42a3a2ab5f58e59f84951d216}\label{class_t_passive_cache_manager_ad527fce42a3a2ab5f58e59f84951d216}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!getStorageMode@{getStorageMode}}
\index{getStorageMode@{getStorageMode}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{getStorageMode()}{getStorageMode()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily TPassive\+Cache\+Manager\+::\+Storage\+Flag TPassive\+Cache\+Manager\+::get\+Storage\+Mode (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00497                                                                            \{}
\DoxyCodeLine{00498   \textcolor{keywordflow}{return} m\_currStorageFlag;}
\DoxyCodeLine{00499 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a5249ffe01029bdc7c8fa78bf800482f1}\label{class_t_passive_cache_manager_a5249ffe01029bdc7c8fa78bf800482f1}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!getStorageMode@{getStorageMode}}
\index{getStorageMode@{getStorageMode}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{getStorageMode()}{getStorageMode()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily TPassive\+Cache\+Manager\+::\+Storage\+Flag TPassive\+Cache\+Manager\+::get\+Storage\+Mode (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00602              \{}
\DoxyCodeLine{00603   \textcolor{keywordtype}{int} idx = fx-\/>getAttributes()-\/>passiveCacheDataIdx();}
\DoxyCodeLine{00604   \textcolor{keywordflow}{if} (idx < 0) \textcolor{keywordflow}{return} NONE;}
\DoxyCodeLine{00605 }
\DoxyCodeLine{00606   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00607 }
\DoxyCodeLine{00608   \textcolor{keywordflow}{return} (StorageFlag)m\_fxDataVector[idx].m\_storageFlag;}
\DoxyCodeLine{00609 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a5344938175e12d4b173ed7a11dfe033c}\label{class_t_passive_cache_manager_a5344938175e12d4b173ed7a11dfe033c}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!instance@{instance}}
\index{instance@{instance}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_passive_cache_manager}{TPassive\+Cache\+Manager}} $\ast$ TPassive\+Cache\+Manager\+::instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00446                                                      \{}
\DoxyCodeLine{00447   \textcolor{keyword}{static} \mbox{\hyperlink{class_t_passive_cache_manager}{TPassiveCacheManager}} theInstance;}
\DoxyCodeLine{00448   \textcolor{keywordflow}{return} \&theInstance;}
\DoxyCodeLine{00449 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_aadc703ccd97a5146378e6febbe8bd6b9}\label{class_t_passive_cache_manager_aadc703ccd97a5146378e6febbe8bd6b9}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!invalidateLevel@{invalidateLevel}}
\index{invalidateLevel@{invalidateLevel}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{invalidateLevel()}{invalidateLevel()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::invalidate\+Level (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{level\+Name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00761                                                                      \{}
\DoxyCodeLine{00762   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00763 }
\DoxyCodeLine{00764   \textcolor{comment}{// Traverse the managed resources for passed levelName.}}
\DoxyCodeLine{00765   \mbox{\hyperlink{class_table}{ResourcesTable}} \&table       = m\_resources-\/>getTable();}
\DoxyCodeLine{00766   ResourcesTable::Iterator it = table.begin();}
\DoxyCodeLine{00767   \textcolor{keywordflow}{while} (it) \{}
\DoxyCodeLine{00768     std::set<LockedResourceP> \&resources = *it;}
\DoxyCodeLine{00769     std::set<LockedResourceP>::iterator jt, kt;}
\DoxyCodeLine{00770     \textcolor{keywordflow}{for} (jt = resources.begin(); jt != resources.end();) \{}
\DoxyCodeLine{00771       \textcolor{keywordflow}{if} ((*jt)-\/>getName().find(levelName) != std::string::npos) \{}
\DoxyCodeLine{00772         kt = jt++;}
\DoxyCodeLine{00773         it-\/>erase(kt);}
\DoxyCodeLine{00774       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00775         ++jt;}
\DoxyCodeLine{00776     \}}
\DoxyCodeLine{00777 }
\DoxyCodeLine{00778     \textcolor{keywordflow}{if} (resources.empty())}
\DoxyCodeLine{00779       it = table.erase(it);}
\DoxyCodeLine{00780     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00781       ++it;}
\DoxyCodeLine{00782   \}}
\DoxyCodeLine{00783 }
\DoxyCodeLine{00784 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00785   \textcolor{comment}{// Store the level name until the invalidation is forced}}
\DoxyCodeLine{00786   m\_invalidatedLevels.insert(levelName);}
\DoxyCodeLine{00787 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00788 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a034f5042af0c2ae32b3f3782800bdea4}\label{class_t_passive_cache_manager_a034f5042af0c2ae32b3f3782800bdea4}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!isEnabled@{isEnabled}}
\index{isEnabled@{isEnabled}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{isEnabled()}{isEnabled()}}
{\footnotesize\ttfamily bool TPassive\+Cache\+Manager\+::is\+Enabled (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00487 \{ \textcolor{keywordflow}{return} m\_enabled; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a5056738b643855e3891b28dd1b7660ef}\label{class_t_passive_cache_manager_a5056738b643855e3891b28dd1b7660ef}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!onFxChanged@{onFxChanged}}
\index{onFxChanged@{onFxChanged}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{onFxChanged()}{onFxChanged()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::on\+Fx\+Changed (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} \&}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00809                                                      \{}
\DoxyCodeLine{00810 \textcolor{preprocessor}{\#ifndef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00811 }
\DoxyCodeLine{00812   std::string fxTreeDescription;}
\DoxyCodeLine{00813   (*m\_descriptorCallback)(fxTreeDescription, fx);}
\DoxyCodeLine{00814 }
\DoxyCodeLine{00815   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} count = m\_fxDataVector.size();}
\DoxyCodeLine{00816   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < count; ++i) \{}
\DoxyCodeLine{00817     FxData \&data = m\_fxDataVector[i];}
\DoxyCodeLine{00818 }
\DoxyCodeLine{00819     \textcolor{keywordflow}{if} (!data.m\_fx) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00820 }
\DoxyCodeLine{00821     \textcolor{keywordflow}{if} (data.m\_treeDescription.find(fxTreeDescription) != std::string::npos)}
\DoxyCodeLine{00822       m\_resources-\/>getTable().erase(data.m\_passiveCacheId);}
\DoxyCodeLine{00823   \}}
\DoxyCodeLine{00824 }
\DoxyCodeLine{00825 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00826 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ada3c1f609ae26d2fa8da6a45294c843d}\label{class_t_passive_cache_manager_ada3c1f609ae26d2fa8da6a45294c843d}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!onRenderInstanceEnd@{onRenderInstanceEnd}}
\index{onRenderInstanceEnd@{onRenderInstanceEnd}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{onRenderInstanceEnd()}{onRenderInstanceEnd()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::on\+Render\+Instance\+End (\begin{DoxyParamCaption}\item[{unsigned long}]{render\+Id }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_render_resource_manager}{TRender\+Resource\+Manager}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00973                                                                      \{}
\DoxyCodeLine{00974   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00975 }
\DoxyCodeLine{00976   releaseOldResources();}
\DoxyCodeLine{00977   m\_contextNamesByRenderId.erase(renderId);}
\DoxyCodeLine{00978 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ae959b124b1c6ea8cfd22b47fc2caa0bb}\label{class_t_passive_cache_manager_ae959b124b1c6ea8cfd22b47fc2caa0bb}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!onRenderInstanceStart@{onRenderInstanceStart}}
\index{onRenderInstanceStart@{onRenderInstanceStart}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{onRenderInstanceStart()}{onRenderInstanceStart()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::on\+Render\+Instance\+Start (\begin{DoxyParamCaption}\item[{unsigned long}]{render\+Id }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_fx_cache_manager_delegate}{TFx\+Cache\+Manager\+Delegate}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00962                                                                        \{}
\DoxyCodeLine{00963   TFxCacheManagerDelegate::onRenderInstanceStart(renderId);}
\DoxyCodeLine{00964 }
\DoxyCodeLine{00965 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00966   \textcolor{comment}{// Force invalidation of levels before the render starts}}
\DoxyCodeLine{00967   forceInvalidate();}
\DoxyCodeLine{00968 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00969 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_ada26a2c0534df8a0afb156963028e154}\label{class_t_passive_cache_manager_ada26a2c0534df8a0afb156963028e154}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!onRenderStatusEnd@{onRenderStatusEnd}}
\index{onRenderStatusEnd@{onRenderStatusEnd}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{onRenderStatusEnd()}{onRenderStatusEnd()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::on\+Render\+Status\+End (\begin{DoxyParamCaption}\item[{int}]{render\+Status }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_render_resource_manager}{TRender\+Resource\+Manager}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00982                                                              \{}
\DoxyCodeLine{00983   \textcolor{keywordflow}{if} (renderStatus == TRenderer::TESTRUN) releaseOldResources();}
\DoxyCodeLine{00984 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_aff55be837bd0ada9ac55d74b89dfa668}\label{class_t_passive_cache_manager_aff55be837bd0ada9ac55d74b89dfa668}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!onSceneLoaded@{onSceneLoaded}}
\index{onSceneLoaded@{onSceneLoaded}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{onSceneLoaded()}{onSceneLoaded()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::on\+Scene\+Loaded (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00526                                          \{}
\DoxyCodeLine{00527   m\_updatingPassiveCacheIds = \textcolor{keyword}{false};}
\DoxyCodeLine{00528 }
\DoxyCodeLine{00529 \textcolor{comment}{// Initialize the fxs tree description. This was not possible before, as the}}
\DoxyCodeLine{00530 \textcolor{comment}{// scene was yet incomplete (in loading state).}}
\DoxyCodeLine{00531 \textcolor{preprocessor}{\#ifndef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00532   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} count = m\_fxDataVector.size();}
\DoxyCodeLine{00533   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < count; ++i) \{}
\DoxyCodeLine{00534     FxData \&data = m\_fxDataVector[i];}
\DoxyCodeLine{00535     (*m\_descriptorCallback)(data.m\_treeDescription, data.m\_fx);}
\DoxyCodeLine{00536   \}}
\DoxyCodeLine{00537 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00538 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a37aac967d7abcf63b5e27b934f0cb885}\label{class_t_passive_cache_manager_a37aac967d7abcf63b5e27b934f0cb885}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!onXsheetChanged@{onXsheetChanged}}
\index{onXsheetChanged@{onXsheetChanged}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{onXsheetChanged()}{onXsheetChanged()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::on\+Xsheet\+Changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00832                                            \{}
\DoxyCodeLine{00833 \textcolor{preprocessor}{\#ifndef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00834 }
\DoxyCodeLine{00835 \textcolor{preprocessor}{\#ifdef DIAGNOSTICS}}
\DoxyCodeLine{00836   DIAGNOSTICS\_STR(\textcolor{stringliteral}{"{}\#activity.txt | "{}} + QTime::currentTime().toString() +}
\DoxyCodeLine{00837                   \textcolor{stringliteral}{"{} XSheet changed"{}});}
\DoxyCodeLine{00838 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00839 }
\DoxyCodeLine{00840   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} count = m\_fxDataVector.size();}
\DoxyCodeLine{00841   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < count; ++i) \{}
\DoxyCodeLine{00842     FxData \&data = m\_fxDataVector[i];}
\DoxyCodeLine{00843 }
\DoxyCodeLine{00844     \textcolor{keywordflow}{if} (!data.m\_fx) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00845 }
\DoxyCodeLine{00846     std::string newTreeDescription;}
\DoxyCodeLine{00847     (*m\_descriptorCallback)(newTreeDescription, data.m\_fx);}
\DoxyCodeLine{00848 }
\DoxyCodeLine{00849     \textcolor{keywordflow}{if} (data.m\_treeDescription != newTreeDescription) \{}
\DoxyCodeLine{00850       m\_resources-\/>getTable().erase(data.m\_passiveCacheId);}
\DoxyCodeLine{00851       data.m\_treeDescription = newTreeDescription;}
\DoxyCodeLine{00852     \}}
\DoxyCodeLine{00853   \}}
\DoxyCodeLine{00854 }
\DoxyCodeLine{00855 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00856 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a2ab35ba38c7038585c65d3b44097cbae}\label{class_t_passive_cache_manager_a2ab35ba38c7038585c65d3b44097cbae}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!releaseContextNamesWithPrefix@{releaseContextNamesWithPrefix}}
\index{releaseContextNamesWithPrefix@{releaseContextNamesWithPrefix}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{releaseContextNamesWithPrefix()}{releaseContextNamesWithPrefix()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::release\+Context\+Names\+With\+Prefix (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{prefix }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00900                              \{}
\DoxyCodeLine{00901   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00902 }
\DoxyCodeLine{00903 \textcolor{preprocessor}{\#ifdef DIAGNOSTICS}}
\DoxyCodeLine{00904   DIAGNOSTICS\_STR(\textcolor{stringliteral}{"{}\#activity.txt | "{}} + QTime::currentTime().toString() +}
\DoxyCodeLine{00905                   \textcolor{stringliteral}{"{} Release Context Name ("{}} + QString::fromStdString(prefix) +}
\DoxyCodeLine{00906                   \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{00907 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00908 }
\DoxyCodeLine{00909   \textcolor{comment}{// Retrieve the context range}}
\DoxyCodeLine{00910   std::string prefixPlus1 = prefix;}
\DoxyCodeLine{00911   prefixPlus1[prefix.size() -\/ 1]++;}
\DoxyCodeLine{00912 }
\DoxyCodeLine{00913   \{}
\DoxyCodeLine{00914     std::map<std::string, UCHAR>::iterator it, jt;}
\DoxyCodeLine{00915     it = m\_contextNames.lower\_bound(prefix);}
\DoxyCodeLine{00916     jt = m\_contextNames.lower\_bound(prefixPlus1);}
\DoxyCodeLine{00917     m\_contextNames.erase(it, jt);}
\DoxyCodeLine{00918   \}}
\DoxyCodeLine{00919 }
\DoxyCodeLine{00920   \textcolor{comment}{// Transfer to temporary}}
\DoxyCodeLine{00921   \mbox{\hyperlink{class_table}{ResourcesTable}} \&table = m\_resources-\/>getTable();}
\DoxyCodeLine{00922   std::map<std::string, ResourcesTable::Row> \&rows =}
\DoxyCodeLine{00923       m\_resources-\/>getTable().rows();}
\DoxyCodeLine{00924 }
\DoxyCodeLine{00925   std::map<std::string, ResourcesTable::Row>::iterator it, jt, kt;}
\DoxyCodeLine{00926   it = rows.lower\_bound(prefix);}
\DoxyCodeLine{00927   jt = rows.lower\_bound(prefixPlus1);}
\DoxyCodeLine{00928 }
\DoxyCodeLine{00929   std::string temporaryName(\textcolor{stringliteral}{"{}T"{}});}
\DoxyCodeLine{00930   \textcolor{keywordflow}{for} (kt = it; kt != jt; ++kt) \{}
\DoxyCodeLine{00931     ResourcesTable::RowIterator lt(kt);}
\DoxyCodeLine{00932     \textcolor{keywordflow}{for} (; lt; ++lt)}
\DoxyCodeLine{00933       table.value(temporaryName, lt.col()).insert(lt-\/>begin(), lt-\/>end());}
\DoxyCodeLine{00934   \}}
\DoxyCodeLine{00935   rows.erase(it, jt == rows.end() ? rows.lower\_bound(prefixPlus1) : jt);}
\DoxyCodeLine{00936 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a9260b4991f1e0c54a5223772f9a2dc53}\label{class_t_passive_cache_manager_a9260b4991f1e0c54a5223772f9a2dc53}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!renderHasOwnership@{renderHasOwnership}}
\index{renderHasOwnership@{renderHasOwnership}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{renderHasOwnership()}{renderHasOwnership()}}
{\footnotesize\ttfamily bool TPassive\+Cache\+Manager\+::render\+Has\+Ownership (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_render_resource_manager}{TRender\+Resource\+Manager}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00115 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a0e2330d9eb0eadbfcec493cebedaa060}\label{class_t_passive_cache_manager_a0e2330d9eb0eadbfcec493cebedaa060}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!reset@{reset}}
\index{reset@{reset}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::reset (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00567                                  \{}
\DoxyCodeLine{00568   m\_updatingPassiveCacheIds = \textcolor{keyword}{true};}
\DoxyCodeLine{00569   m\_currentPassiveCacheId   = 0;}
\DoxyCodeLine{00570   m\_fxDataVector.clear();}
\DoxyCodeLine{00571   m\_resources-\/>getTable().clear();}
\DoxyCodeLine{00572 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_a2c20bd3232f55e2786bd20635e1bb112}\label{class_t_passive_cache_manager_a2c20bd3232f55e2786bd20635e1bb112}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!setContextName@{setContextName}}
\index{setContextName@{setContextName}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{setContextName()}{setContextName()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::set\+Context\+Name (\begin{DoxyParamCaption}\item[{unsigned long}]{render\+Id,  }\item[{const std\+::string \&}]{name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00454                                                                  \{}
\DoxyCodeLine{00455   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00456 }
\DoxyCodeLine{00457   \textcolor{comment}{// Retrieve the context data if already present}}
\DoxyCodeLine{00458   std::map<std::string, UCHAR>::iterator it = m\_contextNames.find(name);}
\DoxyCodeLine{00459   \textcolor{keywordflow}{if} (it == m\_contextNames.end())}
\DoxyCodeLine{00460     it = m\_contextNames.insert(std::make\_pair(name, 0)).first;}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462   it-\/>second = !it-\/>second;}
\DoxyCodeLine{00463   m\_contextNamesByRenderId.insert(}
\DoxyCodeLine{00464       std::make\_pair(renderId, name + \textcolor{stringliteral}{"{}\%"{}} + std::to\_string(it-\/>second)));}
\DoxyCodeLine{00465 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_aa06d1bf369dceef622bd73c94149900c}\label{class_t_passive_cache_manager_aa06d1bf369dceef622bd73c94149900c}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!setEnabled@{setEnabled}}
\index{setEnabled@{setEnabled}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{setEnabled()}{setEnabled()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::set\+Enabled (\begin{DoxyParamCaption}\item[{bool}]{enabled }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00483 \{ m\_enabled = enabled; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_aff0e2de17a7a016845b873c2b4fef62d}\label{class_t_passive_cache_manager_aff0e2de17a7a016845b873c2b4fef62d}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!setStorageMode@{setStorageMode}}
\index{setStorageMode@{setStorageMode}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{setStorageMode()}{setStorageMode()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::set\+Storage\+Mode (\begin{DoxyParamCaption}\item[{Storage\+Flag}]{mode }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00491                                                           \{}
\DoxyCodeLine{00492   m\_currStorageFlag = mode;}
\DoxyCodeLine{00493 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_afea42d661b5eb770e3387c6b9109a69f}\label{class_t_passive_cache_manager_afea42d661b5eb770e3387c6b9109a69f}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!setTreeDescriptor@{setTreeDescriptor}}
\index{setTreeDescriptor@{setTreeDescriptor}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{setTreeDescriptor()}{setTreeDescriptor()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::set\+Tree\+Descriptor (\begin{DoxyParamCaption}\item[{Tree\+Descriptor}]{callback }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00503                                                                     \{}
\DoxyCodeLine{00504   m\_descriptorCallback = callback;}
\DoxyCodeLine{00505 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_passive_cache_manager_adee26ed665001a580acac328fc4d421d}\label{class_t_passive_cache_manager_adee26ed665001a580acac328fc4d421d}} 
\index{TPassiveCacheManager@{TPassiveCacheManager}!toggleCache@{toggleCache}}
\index{toggleCache@{toggleCache}!TPassiveCacheManager@{TPassiveCacheManager}}
\doxysubsubsection{\texorpdfstring{toggleCache()}{toggleCache()}}
{\footnotesize\ttfamily void TPassive\+Cache\+Manager\+::toggle\+Cache (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_fx}{TFx}} $\ast$}]{fx }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00696                                               \{}
\DoxyCodeLine{00697   \textcolor{keywordtype}{int} \&idx = fx-\/>getAttributes()-\/>passiveCacheDataIdx();}
\DoxyCodeLine{00698   touchFxData(idx);}
\DoxyCodeLine{00699 }
\DoxyCodeLine{00700   FxData \&data = m\_fxDataVector[idx];}
\DoxyCodeLine{00701 }
\DoxyCodeLine{00702   QMutexLocker locker(\&m\_mutex);}
\DoxyCodeLine{00703 }
\DoxyCodeLine{00704   StorageFlag flag = getStorageMode();}
\DoxyCodeLine{00705   \textcolor{keywordflow}{if} (flag) \{}
\DoxyCodeLine{00706     UCHAR \&storedFlag = data.m\_storageFlag;}
\DoxyCodeLine{00707     UCHAR oldFlag     = storedFlag;}
\DoxyCodeLine{00708 }
\DoxyCodeLine{00709     storedFlag \string^= flag;}
\DoxyCodeLine{00710 }
\DoxyCodeLine{00711 \textcolor{preprocessor}{\#ifdef DIAGNOSTICS}}
\DoxyCodeLine{00712     DIAGNOSTICS\_STR(\textcolor{stringliteral}{"{}\#activity.txt | "{}} + QTime::currentTime().toString() + \textcolor{stringliteral}{"{} "{}} +}
\DoxyCodeLine{00713                     QString(\textcolor{stringliteral}{"{}Toggle Cache (now "{}}) +}
\DoxyCodeLine{00714                     ((storedFlag \& IN\_MEMORY) ? \textcolor{stringliteral}{"{}enabled)"{}} : \textcolor{stringliteral}{"{}disabled)"{}}));}
\DoxyCodeLine{00715 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00716 }
\DoxyCodeLine{00717     \textcolor{keywordflow}{if} (data.m\_passiveCacheId == 0)}
\DoxyCodeLine{00718       data.m\_passiveCacheId = getNewPassiveCacheId();}
\DoxyCodeLine{00719 }
\DoxyCodeLine{00720     \textcolor{keywordflow}{if} ((storedFlag \& ON\_DISK) \&\& !(oldFlag \& ON\_DISK)) \{}
\DoxyCodeLine{00721       ResourcesTable::ColIterator it =}
\DoxyCodeLine{00722           m\_resources-\/>getTable().colBegin(data.m\_passiveCacheId);}
\DoxyCodeLine{00723       \textcolor{keywordflow}{for} (; it; ++it) \{}
\DoxyCodeLine{00724         std::set<LockedResourceP> \&resources = *it;}
\DoxyCodeLine{00725 }
\DoxyCodeLine{00726         std::set<LockedResourceP>::iterator jt;}
\DoxyCodeLine{00727         \textcolor{keywordflow}{for} (jt = resources.begin(); jt != resources.end(); ++jt)}
\DoxyCodeLine{00728           (*jt)-\/>enableBackup();}
\DoxyCodeLine{00729       \}}
\DoxyCodeLine{00730     \}}
\DoxyCodeLine{00731 }
\DoxyCodeLine{00732     \textcolor{comment}{// Implementa la versione contraria -\/ eliminazione dell'fx nell'hdPool...}}
\DoxyCodeLine{00733     \textcolor{comment}{// Metti anche questo in versione ritardata con flush... Il flush e' da}}
\DoxyCodeLine{00734     \textcolor{comment}{// unificare...}}
\DoxyCodeLine{00735     \textcolor{comment}{// e magari da spostare direttamente nell'hdPool}}
\DoxyCodeLine{00736 }
\DoxyCodeLine{00737     \textcolor{keywordflow}{if} ((oldFlag \& IN\_MEMORY) \&\& !(storedFlag \& IN\_MEMORY)) \{}
\DoxyCodeLine{00738       m\_resources-\/>getTable().erase(data.m\_passiveCacheId);}
\DoxyCodeLine{00739 }
\DoxyCodeLine{00740       data.m\_fx              = \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}();}
\DoxyCodeLine{00741       data.m\_treeDescription = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00742     \}}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00744 \textcolor{preprocessor}{\#ifndef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00745     \textcolor{keywordflow}{if} ((storedFlag \& IN\_MEMORY) \&\& !(oldFlag \& IN\_MEMORY)) \{}
\DoxyCodeLine{00746       data.m\_fx = fx;}
\DoxyCodeLine{00747       (*m\_descriptorCallback)(data.m\_treeDescription, data.m\_fx);}
\DoxyCodeLine{00748     \}}
\DoxyCodeLine{00749 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00750 }
\DoxyCodeLine{00751 \textcolor{preprocessor}{\#ifdef USE\_SQLITE\_HDPOOL}}
\DoxyCodeLine{00752     \textcolor{keywordflow}{if} ((oldFlag \& ON\_DISK) \&\& !(storedFlag \& ON\_DISK))}
\DoxyCodeLine{00753       TCacheResourcePool::instance()-\/>releaseReferences(}
\DoxyCodeLine{00754           \textcolor{stringliteral}{"{}P"{}} + QString::number(data.m\_passiveCacheId));}
\DoxyCodeLine{00755 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00756   \}}
\DoxyCodeLine{00757 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tpassivecachemanager.\+h\item 
E\+:/opentoonz/toonz/sources/common/tfx/tpassivecachemanager.\+cpp\end{DoxyCompactItemize}
