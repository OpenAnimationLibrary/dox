\hypertarget{class_magnet_tool}{}\doxysection{Magnet\+Tool Class Reference}
\label{class_magnet_tool}\index{MagnetTool@{MagnetTool}}
Inheritance diagram for Magnet\+Tool\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_magnet_tool}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} \mbox{\hyperlink{class_magnet_tool_acf6d00e6011804042afa535b25b51153}{get\+Tool\+Type}} () const override
\item 
void \mbox{\hyperlink{class_magnet_tool_abb66dccfdd579e92aa8212b86b84a27a}{update\+Translation}} () override
\item 
void \mbox{\hyperlink{class_magnet_tool_ad7d276db6c85a7e6b33be5f0f690fc55}{on\+Enter}} () override
\begin{DoxyCompactList}\small\item\em Callback for the mouse entering the viewer area. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_magnet_tool_a60464801eb49c0290b1aca279da7eacd}{left\+Button\+Down}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_magnet_tool_a94510c2bea8d96dc016efe6fb788e8a8}{left\+Button\+Drag}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&p, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
void \mbox{\hyperlink{class_magnet_tool_aa82d486dd6fb796dd7f45745aa91f8cf}{mouse\+Move}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&p, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_magnet_tool_a269f41a0be01131d1a963944df6c232a}{left\+Button\+Up}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
void \mbox{\hyperlink{class_magnet_tool_a568746745fa158ff8572cb64fef135ca}{draw}} () override
\begin{DoxyCompactList}\small\item\em Draws the tool on the viewer. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_magnet_tool_a4e43905b73f791bfc30f2d97e87ef7f6}{on\+Activate}} () override
\begin{DoxyCompactList}\small\item\em Callback invoked whenever the tool activates. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ \mbox{\hyperlink{class_magnet_tool_a76362921392739be73ff2621d1d0a1f1}{get\+Properties}} (int target\+Type) override
\item 
int \mbox{\hyperlink{class_magnet_tool_a5416d153639cc56d842a9aee4ccd4230}{get\+Cursor\+Id}} () const override
\begin{DoxyCompactList}\small\item\em Returns the type of cursor used by the tool. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_magnet_tool_ab836116a4a7702d3864868b31c0f1882}{on\+Property\+Changed}} (std\+::string property\+Name) override
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_magnet_tool_a9ecec696cee2b5d5b5a144b09ebea6bd}\label{class_magnet_tool_a9ecec696cee2b5d5b5a144b09ebea6bd}} 
\index{MagnetTool@{MagnetTool}!MagnetTool@{MagnetTool}}
\index{MagnetTool@{MagnetTool}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{MagnetTool()}{MagnetTool()}}
{\footnotesize\ttfamily Magnet\+Tool\+::\+Magnet\+Tool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00142       : \mbox{\hyperlink{class_t_tool_a9c63ec35f606e755d0d036bf4fed62ab}{TTool}}(\textcolor{stringliteral}{"{}T\_Magnet"{}})}
\DoxyCodeLine{00143       , m\_active(\textcolor{keyword}{false})}
\DoxyCodeLine{00144       , m\_oldStrokesArray()}
\DoxyCodeLine{00145       , m\_toolSize(\textcolor{stringliteral}{"{}Size:"{}}, 10, 1000, 20)  \textcolor{comment}{// W\_ToolOptions\_MagnetTool}}
\DoxyCodeLine{00146   \{}
\DoxyCodeLine{00147     bind(TTool::Vectors);}
\DoxyCodeLine{00148 }
\DoxyCodeLine{00149     m\_toolSize.setNonLinearSlider();}
\DoxyCodeLine{00150 }
\DoxyCodeLine{00151     m\_prop.\mbox{\hyperlink{class_t_property_group_af135c807390f3d18237f4123e9d81d3d}{bind}}(m\_toolSize);}
\DoxyCodeLine{00152   \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_magnet_tool_a568746745fa158ff8572cb64fef135ca}\label{class_magnet_tool_a568746745fa158ff8572cb64fef135ca}} 
\index{MagnetTool@{MagnetTool}!draw@{draw}}
\index{draw@{draw}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::draw (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Draws the tool on the viewer. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a058bf656d73bf3cd63b9826cbaaf48e0}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00400                        \{}
\DoxyCodeLine{00401     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00402     \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00403 }
\DoxyCodeLine{00404     \textcolor{comment}{// TAffine viewMatrix = getViewer()-\/>getViewMatrix();}}
\DoxyCodeLine{00405     \textcolor{comment}{// glPushMatrix();}}
\DoxyCodeLine{00406     \textcolor{comment}{// tglMultMatrix(viewMatrix);}}
\DoxyCodeLine{00407 }
\DoxyCodeLine{00408     \textcolor{keywordtype}{double} pointSize = m\_toolSize.getValue();}
\DoxyCodeLine{00409 }
\DoxyCodeLine{00410     tglColor(TPixel32::Red);}
\DoxyCodeLine{00411     tglDrawCircle(m\_pointAtMove, pointSize);}
\DoxyCodeLine{00412 }
\DoxyCodeLine{00413     \textcolor{keywordflow}{if} (!m\_active) \{}
\DoxyCodeLine{00414       \textcolor{comment}{// glPopMatrix();}}
\DoxyCodeLine{00415       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00416     \}}
\DoxyCodeLine{00417 }
\DoxyCodeLine{00418     \mbox{\hyperlink{class_t_point_t}{TPointD}} delta = m\_pointAtMouseDown -\/ m\_startingPos;}
\DoxyCodeLine{00419 }
\DoxyCodeLine{00420     \textcolor{comment}{//    glPushMatrix();}}
\DoxyCodeLine{00421     \textcolor{comment}{// tglMultMatrix(m\_referenceMatrix);}}
\DoxyCodeLine{00422 }
\DoxyCodeLine{00423     \textcolor{keywordflow}{if} (!m\_strokeHit.empty())}
\DoxyCodeLine{00424       \textcolor{keywordflow}{for} (UINT i = 0; i < m\_strokeHit.size(); ++i)}
\DoxyCodeLine{00425         drawStrokeCenterline(*m\_strokeHit[i], getPixelSize());}
\DoxyCodeLine{00426 }
\DoxyCodeLine{00427     tglColor(TPixel32::Red);}
\DoxyCodeLine{00428     UINT i, j;}
\DoxyCodeLine{00429 }
\DoxyCodeLine{00430     \textcolor{keywordflow}{for} (i = 0; i < m\_strokeToModify.size(); ++i)}
\DoxyCodeLine{00431       \textcolor{keywordflow}{for} (j = 0; j < m\_strokeToModify[i].m\_splittedToMove.size(); ++j) \{}
\DoxyCodeLine{00432         \mbox{\hyperlink{class_t_stroke}{TStroke}} *temp = m\_strokeToModify[i].m\_splittedToMove[j];}
\DoxyCodeLine{00433         drawStrokeCenterline(*temp, getPixelSize());}
\DoxyCodeLine{00434       \}}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00436     \textcolor{comment}{//    glPopMatrix();}}
\DoxyCodeLine{00437     \textcolor{comment}{// glPopMatrix();}}
\DoxyCodeLine{00438   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00276}{TTool\+::get\+Image()}}.

\mbox{\Hypertarget{class_magnet_tool_a5416d153639cc56d842a9aee4ccd4230}\label{class_magnet_tool_a5416d153639cc56d842a9aee4ccd4230}} 
\index{MagnetTool@{MagnetTool}!getCursorId@{getCursorId}}
\index{getCursorId@{getCursorId}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{getCursorId()}{getCursorId()}}
{\footnotesize\ttfamily int Magnet\+Tool\+::get\+Cursor\+Id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Returns the type of cursor used by the tool. 

\begin{DoxySeeAlso}{See also}
For a list of cursor ids \mbox{\hyperlink{}{cursor.\+h}} 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{class_t_tool_a1768a57b8b6d1480618fd923fad15f1d}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00446                                    \{}
\DoxyCodeLine{00447     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}} \&\& \mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}}-\/>getGuidedStrokePickerMode())}
\DoxyCodeLine{00448       \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a66f61f998b655c1c917ee63a595657c6}{m\_viewer}}-\/>getGuidedStrokePickerCursor();}
\DoxyCodeLine{00449     \textcolor{keywordflow}{return} m\_cursorId;}
\DoxyCodeLine{00450   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00555}{TTool\+::m\+\_\+viewer}}.

\mbox{\Hypertarget{class_magnet_tool_a76362921392739be73ff2621d1d0a1f1}\label{class_magnet_tool_a76362921392739be73ff2621d1d0a1f1}} 
\index{MagnetTool@{MagnetTool}!getProperties@{getProperties}}
\index{getProperties@{getProperties}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{getProperties()}{getProperties()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$ Magnet\+Tool\+::get\+Properties (\begin{DoxyParamCaption}\item[{int}]{target\+Type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00444 \{ \textcolor{keywordflow}{return} \&m\_prop; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_magnet_tool_acf6d00e6011804042afa535b25b51153}\label{class_magnet_tool_acf6d00e6011804042afa535b25b51153}} 
\index{MagnetTool@{MagnetTool}!getToolType@{getToolType}}
\index{getToolType@{getToolType}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{getToolType()}{getToolType()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} Magnet\+Tool\+::get\+Tool\+Type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00154 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296ca01ffd66b00b05a88c02ce8ceb5da3b8b}{TTool::LevelWriteTool}}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_magnet_tool_a60464801eb49c0290b1aca279da7eacd}\label{class_magnet_tool_a60464801eb49c0290b1aca279da7eacd}} 
\index{MagnetTool@{MagnetTool}!leftButtonDown@{leftButtonDown}}
\index{leftButtonDown@{leftButtonDown}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDown()}{leftButtonDown()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::left\+Button\+Down (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00165                                                                          \{}
\DoxyCodeLine{00166     \mbox{\hyperlink{class_t_point_t}{TPointD}} p(pos);}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168     \textcolor{keywordflow}{if} (getViewer() \&\& getViewer()-\/>getGuidedStrokePickerMode()) \{}
\DoxyCodeLine{00169       getViewer()-\/>doPickGuideStroke(p);}
\DoxyCodeLine{00170       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00171     \}}
\DoxyCodeLine{00172 }
\DoxyCodeLine{00173     m\_oldPos = pos;}
\DoxyCodeLine{00174 }
\DoxyCodeLine{00175     m\_pointAtMouseDown = p;}
\DoxyCodeLine{00176     m\_startingPos      = p;}
\DoxyCodeLine{00177     m\_active           = \textcolor{keyword}{false};}
\DoxyCodeLine{00178     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi   = \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00179     \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00180     QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{00181     m\_active = \textcolor{keyword}{true};}
\DoxyCodeLine{00182 }
\DoxyCodeLine{00183     m\_pointAtMove = m\_pointAtMouseDown = p;}
\DoxyCodeLine{00184     m\_strokeHit.clear();}
\DoxyCodeLine{00185     m\_changedStrokes.clear();}
\DoxyCodeLine{00186     m\_strokeToModify.clear();}
\DoxyCodeLine{00187 }
\DoxyCodeLine{00188     std::vector<TStroke *> strokeUndo;}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190     \mbox{\hyperlink{class_t_stroke}{TStroke}} *ref;}
\DoxyCodeLine{00191 }
\DoxyCodeLine{00192     m\_hitStrokeCorners.clear();}
\DoxyCodeLine{00193     m\_strokeToModifyCorners.clear();}
\DoxyCodeLine{00194 }
\DoxyCodeLine{00195     \textcolor{keywordtype}{double} pointSize = m\_toolSize.getValue();}
\DoxyCodeLine{00196 }
\DoxyCodeLine{00197     UINT i = 0;}
\DoxyCodeLine{00198     \textcolor{keywordflow}{for} (; i < vi-\/>getStrokeCount(); ++i) \{}
\DoxyCodeLine{00199       \textcolor{keywordflow}{if} (!vi-\/>inCurrentGroup(i)) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00200 }
\DoxyCodeLine{00201       \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke = vi-\/>getStroke(i);}
\DoxyCodeLine{00202       ref             = stroke;}
\DoxyCodeLine{00203       \textcolor{comment}{//  calcola le intersezioni}}
\DoxyCodeLine{00204       std::vector<double> intersections;}
\DoxyCodeLine{00205       intersect(*ref, p, pointSize, intersections);}
\DoxyCodeLine{00206 }
\DoxyCodeLine{00207       \textcolor{keywordflow}{if} (intersections.empty()) \{}
\DoxyCodeLine{00208         \textcolor{keywordflow}{if} (increaseControlPoints(*ref,}
\DoxyCodeLine{00209                                   \mbox{\hyperlink{class_t_stroke_point_deformation}{TStrokePointDeformation}}(p, pointSize))) \{}
\DoxyCodeLine{00210           m\_changedStrokes.push\_back(i);}
\DoxyCodeLine{00211           m\_strokeHit.push\_back(ref);}
\DoxyCodeLine{00212 }
\DoxyCodeLine{00213           std::vector<int> *corners = \textcolor{keyword}{new} std::vector<int>;}
\DoxyCodeLine{00214           corners-\/>push\_back(0);}
\DoxyCodeLine{00215           detectCorners(ref, 20, *corners);}
\DoxyCodeLine{00216           corners-\/>push\_back(ref-\/>\mbox{\hyperlink{class_t_stroke_a81b63663a798724333d8de692fdbcac0}{getChunkCount}}());}
\DoxyCodeLine{00217           m\_hitStrokeCorners.push\_back(corners);}
\DoxyCodeLine{00218 }
\DoxyCodeLine{00219           ref-\/>\mbox{\hyperlink{class_t_stroke_a6f250bc1c05e22775c016b3932d6f9a9}{disableComputeOfCaches}}();}
\DoxyCodeLine{00220 }
\DoxyCodeLine{00221           strokeUndo.push\_back(ref);}
\DoxyCodeLine{00222         \}}
\DoxyCodeLine{00223       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00224         strokeUndo.push\_back(ref);}
\DoxyCodeLine{00225 }
\DoxyCodeLine{00226         MagnetTool::strokeCollection sc;}
\DoxyCodeLine{00227 }
\DoxyCodeLine{00228         sc.m\_parent = ref;}
\DoxyCodeLine{00229 }
\DoxyCodeLine{00230         splitStroke(*sc.m\_parent, intersections, sc.m\_splitted);}
\DoxyCodeLine{00231 }
\DoxyCodeLine{00232         selectStrokeToMove(sc.m\_splitted, p, pointSize, sc.m\_splittedToMove);}
\DoxyCodeLine{00233         \textcolor{keywordflow}{for} (UINT ii = 0; ii < sc.m\_splittedToMove.size(); ++ii) \{}
\DoxyCodeLine{00234           \mbox{\hyperlink{class_t_stroke}{TStroke}} *temp = sc.m\_splittedToMove[ii];}
\DoxyCodeLine{00235           \textcolor{keywordtype}{bool} test     = increaseControlPoints(}
\DoxyCodeLine{00236               *temp, \mbox{\hyperlink{class_t_stroke_point_deformation}{TStrokePointDeformation}}(p, pointSize));}
\DoxyCodeLine{00237           assert(test);}
\DoxyCodeLine{00238 }
\DoxyCodeLine{00239           std::vector<int> *corners = \textcolor{keyword}{new} std::vector<int>;}
\DoxyCodeLine{00240           corners-\/>push\_back(0);}
\DoxyCodeLine{00241           detectCorners(temp, 20, *corners);}
\DoxyCodeLine{00242           corners-\/>push\_back(temp-\/>\mbox{\hyperlink{class_t_stroke_a81b63663a798724333d8de692fdbcac0}{getChunkCount}}());}
\DoxyCodeLine{00243           m\_strokeToModifyCorners.push\_back(corners);}
\DoxyCodeLine{00244         \}}
\DoxyCodeLine{00245 }
\DoxyCodeLine{00246         m\_strokeToModify.push\_back(sc);}
\DoxyCodeLine{00247         m\_changedStrokes.push\_back(i);}
\DoxyCodeLine{00248       \}}
\DoxyCodeLine{00249     \}}
\DoxyCodeLine{00250 }
\DoxyCodeLine{00251     m\_oldStrokesArray.resize(m\_changedStrokes.size());}
\DoxyCodeLine{00252     \textcolor{keywordflow}{for} (i = 0; i < m\_changedStrokes.size(); i++)}
\DoxyCodeLine{00253       m\_oldStrokesArray[i] = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stroke}{TStroke}}(*(vi-\/>getStroke(m\_changedStrokes[i])));}
\DoxyCodeLine{00254 }
\DoxyCodeLine{00255     \textcolor{keywordflow}{if} (!strokeUndo.empty()) \{}
\DoxyCodeLine{00256       \textcolor{keywordflow}{if} (TTool::getApplication()-\/>getCurrentObject()-\/>isSpline())}
\DoxyCodeLine{00257         m\_undo = \textcolor{keyword}{new} \mbox{\hyperlink{class_tool_utils_1_1_undo_path}{UndoPath}}(}
\DoxyCodeLine{00258             \mbox{\hyperlink{class_t_tool_a8716e1462da359f4902c044a79f2d40d}{getXsheet}}()-\/>getStageObject(\mbox{\hyperlink{class_t_tool_a25b57b82dfac131d9d6405e07fbd98b4}{getObjectId}}())-\/>getSpline());}
\DoxyCodeLine{00259       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00260         \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl =}
\DoxyCodeLine{00261             TTool::getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel();}
\DoxyCodeLine{00262         assert(sl);}
\DoxyCodeLine{00263         \mbox{\hyperlink{class_t_frame_id}{TFrameId}} \textcolor{keywordtype}{id} = \mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}();}
\DoxyCodeLine{00264         m\_undo      = \textcolor{keyword}{new} \mbox{\hyperlink{class_tool_utils_1_1_undo_modify_list_stroke}{UndoModifyListStroke}}(sl, \textcolor{keywordtype}{id}, strokeUndo);}
\DoxyCodeLine{00265       \}}
\DoxyCodeLine{00266     \}}
\DoxyCodeLine{00267 }
\DoxyCodeLine{00268     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00269     \textcolor{comment}{// vi-\/>validateRegionEdges(ref, true);}}
\DoxyCodeLine{00270   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_magnet_tool_a94510c2bea8d96dc016efe6fb788e8a8}\label{class_magnet_tool_a94510c2bea8d96dc016efe6fb788e8a8}} 
\index{MagnetTool@{MagnetTool}!leftButtonDrag@{leftButtonDrag}}
\index{leftButtonDrag@{leftButtonDrag}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDrag()}{leftButtonDrag()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::left\+Button\+Drag (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{p,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00272                                                                       \{}
\DoxyCodeLine{00273     \textcolor{keywordflow}{if} (!m\_active) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00274 }
\DoxyCodeLine{00275     \textcolor{comment}{//      double dx = p.x -\/ m\_pointAtMouseDown.x;}}
\DoxyCodeLine{00276     \textcolor{keywordtype}{double} pixelSize = getPixelSize();}
\DoxyCodeLine{00277     \textcolor{keywordflow}{if} (tdistance2(p, m\_oldPos) < 9.0 * pixelSize * pixelSize) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00278 }
\DoxyCodeLine{00279     m\_oldPos           = p;}
\DoxyCodeLine{00280     m\_pointAtMouseDown = p;}
\DoxyCodeLine{00281 }
\DoxyCodeLine{00282     \textcolor{comment}{// double sc = exp(0.001 * (double)dx);}}
\DoxyCodeLine{00283     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00284     \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00285     QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{00286     \mbox{\hyperlink{class_t_point_t}{TPointD}} offset = p -\/ m\_pointAtMove;}
\DoxyCodeLine{00287 }
\DoxyCodeLine{00288     \textcolor{comment}{/*}}
\DoxyCodeLine{00289 \textcolor{comment}{if( tdistance2(m\_pointAtMouseDown, p ) > sq(m\_pointSize * 0.5) ) // reincremento}}
\DoxyCodeLine{00290 \textcolor{comment}{\{}}
\DoxyCodeLine{00291 \textcolor{comment}{leftButtonUp(p);}}
\DoxyCodeLine{00292 \textcolor{comment}{lefrightButtonDown(p);}}
\DoxyCodeLine{00293 \textcolor{comment}{\}}}
\DoxyCodeLine{00294 \textcolor{comment}{*/}}
\DoxyCodeLine{00295     \textcolor{keywordtype}{double} pointSize = m\_toolSize.getValue();}
\DoxyCodeLine{00296 }
\DoxyCodeLine{00297     UINT i, j;}
\DoxyCodeLine{00298 }
\DoxyCodeLine{00299     \textcolor{keywordflow}{for} (i = 0; i < m\_strokeHit.size(); ++i)}
\DoxyCodeLine{00300       modifyControlPoints(}
\DoxyCodeLine{00301           *m\_strokeHit[i],}
\DoxyCodeLine{00302           \mbox{\hyperlink{class_t_stroke_point_deformation}{TStrokePointDeformation}}(offset, m\_pointAtMouseDown, pointSize * 0.7));}
\DoxyCodeLine{00303 }
\DoxyCodeLine{00304     \textcolor{keywordflow}{for} (i = 0; i < m\_strokeToModify.size(); ++i)}
\DoxyCodeLine{00305       \textcolor{keywordflow}{for} (j = 0; j < m\_strokeToModify[i].m\_splittedToMove.size(); ++j) \{}
\DoxyCodeLine{00306         \mbox{\hyperlink{class_t_stroke}{TStroke}} *temp = m\_strokeToModify[i].m\_splittedToMove[j];}
\DoxyCodeLine{00307         modifyControlPoints(*temp,}
\DoxyCodeLine{00308                             \mbox{\hyperlink{class_t_stroke_point_deformation}{TStrokePointDeformation}}(offset, m\_pointAtMouseDown,}
\DoxyCodeLine{00309                                                     pointSize * 0.7));}
\DoxyCodeLine{00310       \}}
\DoxyCodeLine{00311 }
\DoxyCodeLine{00312     m\_pointAtMove = p;}
\DoxyCodeLine{00313 }
\DoxyCodeLine{00314     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00315   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_magnet_tool_a269f41a0be01131d1a963944df6c232a}\label{class_magnet_tool_a269f41a0be01131d1a963944df6c232a}} 
\index{MagnetTool@{MagnetTool}!leftButtonUp@{leftButtonUp}}
\index{leftButtonUp@{leftButtonUp}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{leftButtonUp()}{leftButtonUp()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::left\+Button\+Up (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00326                                                                    \{}
\DoxyCodeLine{00327     \textcolor{keywordflow}{if} (!m\_active) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00328 }
\DoxyCodeLine{00329     m\_active           = \textcolor{keyword}{false};}
\DoxyCodeLine{00330     m\_pointAtMouseDown = m\_pointAtMove = TConsts::napd;}
\DoxyCodeLine{00331 }
\DoxyCodeLine{00332     \mbox{\hyperlink{class_t_stroke}{TStroke}} *ref;}
\DoxyCodeLine{00333 }
\DoxyCodeLine{00334     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}(\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{00335     \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00336     QMutexLocker lock(vi-\/>getMutex());}
\DoxyCodeLine{00337     UINT i, j;}
\DoxyCodeLine{00338 }
\DoxyCodeLine{00339     \textcolor{keywordflow}{for} (i = 0; i < m\_strokeHit.size(); ++i) \{}
\DoxyCodeLine{00340       ref = m\_strokeHit[i];}
\DoxyCodeLine{00341       ref-\/>enableComputeOfCaches();}
\DoxyCodeLine{00342       ref-\/>\mbox{\hyperlink{class_t_stroke_a81a280d6be49406cf03d65530b9d9ce6}{reduceControlPoints}}(getPixelSize() * ReduceControlPointCorrection,}
\DoxyCodeLine{00343                                *(m\_hitStrokeCorners[i]));}
\DoxyCodeLine{00344       \textcolor{comment}{// vi-\/>validateRegionEdges(ref, false);}}
\DoxyCodeLine{00345     \}}
\DoxyCodeLine{00346     clearPointerContainer(m\_hitStrokeCorners);}
\DoxyCodeLine{00347     m\_hitStrokeCorners.clear();}
\DoxyCodeLine{00348 }
\DoxyCodeLine{00349     UINT count = 0;}
\DoxyCodeLine{00350     \textcolor{keywordflow}{for} (i = 0; i < m\_strokeToModify.size(); ++i) \{}
\DoxyCodeLine{00351       \textcolor{comment}{// recupero la stroke collection}}
\DoxyCodeLine{00352       MagnetTool::strokeCollection \&sc = m\_strokeToModify[i];}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354       \textcolor{keywordflow}{for} (j = 0; j < sc.m\_splittedToMove.size(); ++j) \{}
\DoxyCodeLine{00355         ref = sc.m\_splittedToMove[j];}
\DoxyCodeLine{00356         ref-\/>enableComputeOfCaches();}
\DoxyCodeLine{00357         ref-\/>\mbox{\hyperlink{class_t_stroke_a81a280d6be49406cf03d65530b9d9ce6}{reduceControlPoints}}(getPixelSize() * ReduceControlPointCorrection,}
\DoxyCodeLine{00358                                  *(m\_strokeToModifyCorners[count++]));}
\DoxyCodeLine{00359       \}}
\DoxyCodeLine{00360 }
\DoxyCodeLine{00361       \textcolor{comment}{// ricostruisco una stroke con quella data}}
\DoxyCodeLine{00362       ref = merge(sc.m\_splitted);}
\DoxyCodeLine{00363 }
\DoxyCodeLine{00364       \textcolor{keywordflow}{if} (sc.m\_parent-\/>isSelfLoop()) \{}
\DoxyCodeLine{00365         \textcolor{keywordtype}{int} cpCount      = ref-\/>\mbox{\hyperlink{class_t_stroke_a45101afd31e40d08100fdf23c89fb49e}{getControlPointCount}}();}
\DoxyCodeLine{00366         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} p1   = ref-\/>\mbox{\hyperlink{class_t_stroke_a9b60f87075b703360efe4b38097d923f}{getControlPoint}}(0);}
\DoxyCodeLine{00367         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} p2   = ref-\/>\mbox{\hyperlink{class_t_stroke_a9b60f87075b703360efe4b38097d923f}{getControlPoint}}(cpCount -\/ 1);}
\DoxyCodeLine{00368         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} midP = (p1 + p2) * 0.5;}
\DoxyCodeLine{00369         ref-\/>\mbox{\hyperlink{class_t_stroke_abc4f174af1e2712c400ae63e005aac18}{setControlPoint}}(0, midP);}
\DoxyCodeLine{00370         ref-\/>\mbox{\hyperlink{class_t_stroke_abc4f174af1e2712c400ae63e005aac18}{setControlPoint}}(cpCount -\/ 1, midP);}
\DoxyCodeLine{00371         ref-\/>\mbox{\hyperlink{class_t_stroke_afa2c66ae11a70e68b3de3ce0b4cfb049}{setSelfLoop}}(\textcolor{keyword}{true});}
\DoxyCodeLine{00372       \}}
\DoxyCodeLine{00373 }
\DoxyCodeLine{00374       sc.m\_parent-\/>swapGeometry(*ref);}
\DoxyCodeLine{00375 }
\DoxyCodeLine{00376       \textcolor{keyword}{delete} ref;  \textcolor{comment}{// elimino la curva temporanea}}
\DoxyCodeLine{00377       clearPointerContainer(}
\DoxyCodeLine{00378           sc.m\_splitted);           \textcolor{comment}{// pulisco le stroke trovate con lo split}}
\DoxyCodeLine{00379       sc.m\_splittedToMove.clear();  \textcolor{comment}{// pulisco il contenitore ( le stroke}}
\DoxyCodeLine{00380                                     \textcolor{comment}{// che erano contenute qua sono state}}
\DoxyCodeLine{00381                                     \textcolor{comment}{// eliminate nella clearPointer....}}
\DoxyCodeLine{00382     \}}
\DoxyCodeLine{00383     clearPointerContainer(m\_strokeToModifyCorners);}
\DoxyCodeLine{00384     m\_strokeToModifyCorners.clear();}
\DoxyCodeLine{00385 }
\DoxyCodeLine{00386     \textcolor{keywordflow}{for} (i = 0; i < vi-\/>getStrokeCount(); ++i) \{}
\DoxyCodeLine{00387       ref = vi-\/>getStroke(i);}
\DoxyCodeLine{00388       ref-\/>\mbox{\hyperlink{class_t_stroke_a03d49743089710215ab6984db1f6e3a2}{invalidate}}();}
\DoxyCodeLine{00389     \}}
\DoxyCodeLine{00390 }
\DoxyCodeLine{00391     vi-\/>notifyChangedStrokes(m\_changedStrokes, m\_oldStrokesArray);}
\DoxyCodeLine{00392     \mbox{\hyperlink{class_t_tool_abd1824e9b49705c534e0a773305294c4}{notifyImageChanged}}();}
\DoxyCodeLine{00393     \textcolor{keywordflow}{if} (m\_undo) TUndoManager::manager()-\/>add(m\_undo);}
\DoxyCodeLine{00394     m\_undo = 0;}
\DoxyCodeLine{00395     clearPointerContainer(m\_oldStrokesArray);}
\DoxyCodeLine{00396     m\_oldStrokesArray.clear();}
\DoxyCodeLine{00397     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00398   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_magnet_tool_aa82d486dd6fb796dd7f45745aa91f8cf}\label{class_magnet_tool_aa82d486dd6fb796dd7f45745aa91f8cf}} 
\index{MagnetTool@{MagnetTool}!mouseMove@{mouseMove}}
\index{mouseMove@{mouseMove}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{mouseMove()}{mouseMove()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::mouse\+Move (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{p,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00317                                                                   \{}
\DoxyCodeLine{00318     m\_pointAtMove    = p;}
\DoxyCodeLine{00319     \textcolor{keywordtype}{double} pixelSize = getPixelSize();}
\DoxyCodeLine{00320     \textcolor{keywordflow}{if} (tdistance2(p, m\_oldPos) < 9.0 * pixelSize * pixelSize) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00321 }
\DoxyCodeLine{00322     m\_oldPos = p;}
\DoxyCodeLine{00323     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00324   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_magnet_tool_a4e43905b73f791bfc30f2d97e87ef7f6}\label{class_magnet_tool_a4e43905b73f791bfc30f2d97e87ef7f6}} 
\index{MagnetTool@{MagnetTool}!onActivate@{onActivate}}
\index{onActivate@{onActivate}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{onActivate()}{onActivate()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::on\+Activate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Callback invoked whenever the tool activates. 



Reimplemented from \mbox{\hyperlink{class_t_tool_ac286a2681633b4db6106596b4f54e53b}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00440                              \{}
\DoxyCodeLine{00441     \textcolor{comment}{//        getApplication()-\/>editImageOrSpline();}}
\DoxyCodeLine{00442   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_magnet_tool_ad7d276db6c85a7e6b33be5f0f690fc55}\label{class_magnet_tool_ad7d276db6c85a7e6b33be5f0f690fc55}} 
\index{MagnetTool@{MagnetTool}!onEnter@{onEnter}}
\index{onEnter@{onEnter}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{onEnter()}{onEnter()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::on\+Enter (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for the mouse entering the viewer area. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a3e775cfcd05aa3c35048b11fa40ab3e4}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00158                           \{}
\DoxyCodeLine{00159     \textcolor{keywordflow}{if} ((\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}})\mbox{\hyperlink{class_t_tool_a947d2af39fd4df397577bbf8602abfd4}{getImage}}(\textcolor{keyword}{false}))}
\DoxyCodeLine{00160       m\_cursorId = ToolCursor::MagnetCursor;}
\DoxyCodeLine{00161     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00162       m\_cursorId = ToolCursor::CURSOR\_NO;}
\DoxyCodeLine{00163   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00276}{TTool\+::get\+Image()}}.

\mbox{\Hypertarget{class_magnet_tool_ab836116a4a7702d3864868b31c0f1882}\label{class_magnet_tool_ab836116a4a7702d3864868b31c0f1882}} 
\index{MagnetTool@{MagnetTool}!onPropertyChanged@{onPropertyChanged}}
\index{onPropertyChanged@{onPropertyChanged}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{onPropertyChanged()}{onPropertyChanged()}}
{\footnotesize\ttfamily bool Magnet\+Tool\+::on\+Property\+Changed (\begin{DoxyParamCaption}\item[{std\+::string}]{property\+Name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

\begin{DoxyVerb} Does the tasks associated to changes in \p propertyName and returns \p
\end{DoxyVerb}
 true; Does the tasks associated to changes in {\ttfamily property\+Name} and returns {\ttfamily true}. 

Reimplemented from \mbox{\hyperlink{class_t_tool_a06694e0586f807c34b18e16341aa9ee2}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00452                                                           \{}
\DoxyCodeLine{00453     \textcolor{keywordflow}{if} (propertyName == m\_toolSize.getName()) \{}
\DoxyCodeLine{00454       \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00455     \}}
\DoxyCodeLine{00456 }
\DoxyCodeLine{00457     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00458   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00540}{TTool\+::invalidate()}}.

\mbox{\Hypertarget{class_magnet_tool_abb66dccfdd579e92aa8212b86b84a27a}\label{class_magnet_tool_abb66dccfdd579e92aa8212b86b84a27a}} 
\index{MagnetTool@{MagnetTool}!updateTranslation@{updateTranslation}}
\index{updateTranslation@{updateTranslation}!MagnetTool@{MagnetTool}}
\doxysubsubsection{\texorpdfstring{updateTranslation()}{updateTranslation()}}
{\footnotesize\ttfamily void Magnet\+Tool\+::update\+Translation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00156 \{ m\_toolSize.setQStringName(tr(\textcolor{stringliteral}{"{}Size:"{}})); \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnztools/magnettool.\+cpp\end{DoxyCompactItemize}
