\hypertarget{class_iwa___perspective_distort_fx}{}\doxysection{Iwa\+\_\+\+Perspective\+Distort\+Fx Class Reference}
\label{class_iwa___perspective_distort_fx}\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
Inheritance diagram for Iwa\+\_\+\+Perspective\+Distort\+Fx\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=5.000000cm]{class_iwa___perspective_distort_fx}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_iwa___perspective_distort_fx_a130d7856797d517a764267d85fb568b5}{do\+Get\+BBox}} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
bool \mbox{\hyperlink{class_iwa___perspective_distort_fx_a6846cd05865e383d41035cbdacf1e13f}{can\+Handle}} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame) override
\item 
void \mbox{\hyperlink{class_iwa___perspective_distort_fx_a6d689a4c6d488b4462e639b365106d51}{do\+Compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&rend\+\_\+sets) override
\item 
void \mbox{\hyperlink{class_iwa___perspective_distort_fx_aee7ef4646fa654259f68066f8db07bc6}{do\+Compute\+\_\+\+CPU}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, const double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&settings, \mbox{\hyperlink{class_t_point_t}{TPointD}} \&vanishing\+Point, \mbox{\hyperlink{class_t_point_t}{TPointD}} \&anchor\+Point, \mbox{\hyperlink{structfloat4}{float4}} $\ast$source\+\_\+host, \mbox{\hyperlink{structfloat4}{float4}} $\ast$result\+\_\+host, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} \&source\+Dim, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} \&result\+Dim, const double precision, const double offs)
\item 
void \mbox{\hyperlink{class_iwa___perspective_distort_fx_ae7e78e7c7940d27056d345fa55574a75}{get\+Param\+UIs}} (\mbox{\hyperlink{class_t_param_u_i_concept}{TParam\+UIConcept}} $\ast$\&concepts, int \&length) override
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ }\\void \mbox{\hyperlink{class_iwa___perspective_distort_fx_a78238c9e912ea766f49753dc8e521c93}{set\+Output\+Raster}} (\mbox{\hyperlink{structfloat4}{float4}} $\ast$src\+Mem, const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} dst\+Ras, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dim, int draw\+Level)
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ }\\void \mbox{\hyperlink{class_iwa___perspective_distort_fx_aaff1885f9d9664d810309ea5125c5fce}{set\+Source\+Raster}} (const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} src\+Ras, \mbox{\hyperlink{structfloat4}{float4}} $\ast$dst\+Mem, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} dim)
\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} \mbox{\hyperlink{class_iwa___perspective_distort_fx_a6567c88e02fd2f4a270cf320f4008d11}{m\+\_\+source}}
\item 
TPoint\+ParamP \mbox{\hyperlink{class_iwa___perspective_distort_fx_acf2344609df458f675ea09c92d79ba82}{m\+\_\+vanishing\+Point}}
\item 
TPoint\+ParamP \mbox{\hyperlink{class_iwa___perspective_distort_fx_a0e10e3ee9f2b7301efd972412e977f67}{m\+\_\+anchor\+Point}}
\item 
TDouble\+ParamP \mbox{\hyperlink{class_iwa___perspective_distort_fx_ac17778f67b40640173a8034ecf9a91f3}{m\+\_\+precision}}
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_ac09589a193a80afb7ef27d16a908908a}\label{class_iwa___perspective_distort_fx_ac09589a193a80afb7ef27d16a908908a}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{Iwa\_PerspectiveDistortFx()}{Iwa\_PerspectiveDistortFx()}}
{\footnotesize\ttfamily Iwa\+\_\+\+Perspective\+Distort\+Fx\+::\+Iwa\+\_\+\+Perspective\+Distort\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00093     : m\_vanishingPoint(\mbox{\hyperlink{class_t_point_t}{TPointD}}(0, 0))}
\DoxyCodeLine{00094     , m\_anchorPoint(\mbox{\hyperlink{class_t_point_t}{TPointD}}(0, -\/100.0))}
\DoxyCodeLine{00095     , m\_precision(300.0 / 162.5) \{}
\DoxyCodeLine{00096   \textcolor{comment}{/*-\/ 共通パラメータのバインド -\/*/}}
\DoxyCodeLine{00097   \mbox{\hyperlink{class_t_fx_af0ccf8d65934ed9f7a62d3b45ee5f2b6}{addInputPort}}(\textcolor{stringliteral}{"{}Source"{}}, m\_source);}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}vanishingPoint"{}}, m\_vanishingPoint);}
\DoxyCodeLine{00100   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}anchorPoint"{}}, m\_anchorPoint);}
\DoxyCodeLine{00101   bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}precision"{}}, m\_precision);}
\DoxyCodeLine{00102 }
\DoxyCodeLine{00103   m\_vanishingPoint-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00104   m\_vanishingPoint-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00105   m\_anchorPoint-\/>getX()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00106   m\_anchorPoint-\/>getY()-\/>setMeasureName(\textcolor{stringliteral}{"{}fxLength"{}});}
\DoxyCodeLine{00107 }
\DoxyCodeLine{00108   m\_precision-\/>setValueRange(1.0, 2.0);}
\DoxyCodeLine{00109 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_a6846cd05865e383d41035cbdacf1e13f}\label{class_iwa___perspective_distort_fx_a6846cd05865e383d41035cbdacf1e13f}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!canHandle@{canHandle}}
\index{canHandle@{canHandle}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{canHandle()}{canHandle()}}
{\footnotesize\ttfamily bool Iwa\+\_\+\+Perspective\+Distort\+Fx\+::can\+Handle (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00126                                                        \{}
\DoxyCodeLine{00127   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00128 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_a6d689a4c6d488b4462e639b365106d51}\label{class_iwa___perspective_distort_fx_a6d689a4c6d488b4462e639b365106d51}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!doCompute@{doCompute}}
\index{doCompute@{doCompute}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{doCompute()}{doCompute()}}
{\footnotesize\ttfamily void Iwa\+\_\+\+Perspective\+Distort\+Fx\+::do\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{rend\+\_\+sets }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00133                                                                            \{}
\DoxyCodeLine{00134   \textcolor{comment}{/*-\/ ソース画像が刺さっていなければreturn -\/*/}}
\DoxyCodeLine{00135   \textcolor{keywordflow}{if} (!m\_source.isConnected()) \{}
\DoxyCodeLine{00136     tile.getRaster()-\/>clear();}
\DoxyCodeLine{00137     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00138   \}}
\DoxyCodeLine{00139 }
\DoxyCodeLine{00140   \textcolor{comment}{/*-\/ パラメータの取得 -\/*/}}
\DoxyCodeLine{00141   \mbox{\hyperlink{class_t_point_t}{TPointD}} vp       = m\_vanishingPoint-\/>getValue(frame);}
\DoxyCodeLine{00142   \mbox{\hyperlink{class_t_point_t}{TPointD}} ap       = m\_anchorPoint-\/>getValue(frame);}
\DoxyCodeLine{00143   \textcolor{keywordtype}{double} precision = m\_precision-\/>getValue(frame);}
\DoxyCodeLine{00144 }
\DoxyCodeLine{00145   \textcolor{comment}{/*-\/ 基準点が消失点よりも上にあったらreturn -\/*/}}
\DoxyCodeLine{00146   \textcolor{keywordflow}{if} (vp.y <= ap.y) \{}
\DoxyCodeLine{00147     std::cout << \textcolor{stringliteral}{"{}the anchor must be lower than the vanishing point"{}}}
\DoxyCodeLine{00148               << std::endl;}
\DoxyCodeLine{00149     tile.getRaster()-\/>clear();}
\DoxyCodeLine{00150     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00151   \}}
\DoxyCodeLine{00152 }
\DoxyCodeLine{00153   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = rend\_sets.\mbox{\hyperlink{class_t_render_settings_a1250181bf3fe8e05db005d5faa76b3ea}{m\_affine}};}
\DoxyCodeLine{00154   \textcolor{comment}{/*-\/ カメラ左下を中心としたピクセル座標に変換する -\/*/}}
\DoxyCodeLine{00155   \mbox{\hyperlink{class_t_point_t}{TPointD}} vanishingPoint = aff * vp -\/}
\DoxyCodeLine{00156                            (tile.m\_pos + tile.getRaster()-\/>getCenterD()) +}
\DoxyCodeLine{00157                            \mbox{\hyperlink{class_t_point_t}{TPointD}}(rend\_sets.m\_cameraBox.getLx() / 2.0,}
\DoxyCodeLine{00158                                    rend\_sets.m\_cameraBox.getLy() / 2.0);}
\DoxyCodeLine{00159   \mbox{\hyperlink{class_t_point_t}{TPointD}} anchorPoint = aff * ap -\/}
\DoxyCodeLine{00160                         (tile.m\_pos + tile.getRaster()-\/>getCenterD()) +}
\DoxyCodeLine{00161                         \mbox{\hyperlink{class_t_point_t}{TPointD}}(rend\_sets.m\_cameraBox.getLx() / 2.0,}
\DoxyCodeLine{00162                                 rend\_sets.m\_cameraBox.getLy() / 2.0);}
\DoxyCodeLine{00163 }
\DoxyCodeLine{00164   \textcolor{keywordtype}{double} offs = vanishingPoint.x -\/ rend\_sets.m\_cameraBox.getLx() / 2.0;}
\DoxyCodeLine{00165 }
\DoxyCodeLine{00166   \textcolor{comment}{/*-\/ 取り込む解像度の倍率 -\/*/}}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168   \mbox{\hyperlink{class_t_rect_t}{TRectD}} rectOut(tile.m\_pos, \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}}(tile.getRaster()-\/>getLx(),}
\DoxyCodeLine{00169                                          tile.getRaster()-\/>getLy()));}
\DoxyCodeLine{00170   \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} outDim(rectOut.getLx(), rectOut.getLy());}
\DoxyCodeLine{00171   \textcolor{comment}{/*-\/ ソース画像を正規化して格納 -\/*/}}
\DoxyCodeLine{00172   \textcolor{comment}{/*-\/ 素材を拡大させて持ち込む -\/*/}}
\DoxyCodeLine{00173   \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} sourceDim(rectOut.getLx() * (\textcolor{keywordtype}{int})tceil(precision), anchorPoint.y);}
\DoxyCodeLine{00174   \mbox{\hyperlink{structfloat4}{float4}} *source\_host;}
\DoxyCodeLine{00175   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} source\_host\_ras(sourceDim.lx * \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structfloat4}{float4}}), sourceDim.ly);}
\DoxyCodeLine{00176   source\_host\_ras-\/>lock();}
\DoxyCodeLine{00177   source\_host = (\mbox{\hyperlink{structfloat4}{float4}} *)source\_host\_ras-\/>getRawData();}
\DoxyCodeLine{00178   \{}
\DoxyCodeLine{00179     \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} new\_sets(rend\_sets);}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181     new\_sets.m\_affine *= \mbox{\hyperlink{class_t_translation}{TTranslation}}(vp.x, vp.y);}
\DoxyCodeLine{00182     new\_sets.m\_affine *= \mbox{\hyperlink{class_t_scale}{TScale}}(precision, 1.0);}
\DoxyCodeLine{00183     new\_sets.m\_affine *= \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/vp.x, -\/vp.y);}
\DoxyCodeLine{00184 }
\DoxyCodeLine{00185     \textcolor{keywordtype}{double} sourcePosX = offs + precision * (tile.m\_pos.x -\/ offs);}
\DoxyCodeLine{00186 }
\DoxyCodeLine{00187     \mbox{\hyperlink{class_t_tile}{TTile}} sourceTile;}
\DoxyCodeLine{00188     m\_source-\/>allocateAndCompute(sourceTile, \mbox{\hyperlink{class_t_point_t}{TPointD}}(sourcePosX, tile.m\_pos.y),}
\DoxyCodeLine{00189                                  sourceDim, tile.getRaster(), frame, new\_sets);}
\DoxyCodeLine{00190 }
\DoxyCodeLine{00191     \textcolor{comment}{/*-\/ タイルの画像を０〜１に正規化してホストメモリに読み込む -\/*/}}
\DoxyCodeLine{00192     \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}})sourceTile.getRaster();}
\DoxyCodeLine{00193     \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} ras64 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}})sourceTile.getRaster();}
\DoxyCodeLine{00194     \textcolor{keywordflow}{if} (ras32)}
\DoxyCodeLine{00195       setSourceRaster<TRaster32P, TPixel32>(ras32, source\_host, sourceDim);}
\DoxyCodeLine{00196     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ras64)}
\DoxyCodeLine{00197       setSourceRaster<TRaster64P, TPixel64>(ras64, source\_host, sourceDim);}
\DoxyCodeLine{00198   \}}
\DoxyCodeLine{00199 }
\DoxyCodeLine{00200   \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} resultDim(rectOut.getLx(), anchorPoint.y);}
\DoxyCodeLine{00201   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} result\_host\_ras(resultDim.lx * \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structfloat4}{float4}}), resultDim.ly);}
\DoxyCodeLine{00202   \textcolor{comment}{/*-\/ 結果を収めるメモリ -\/*/}}
\DoxyCodeLine{00203   \mbox{\hyperlink{structfloat4}{float4}} *result\_host;}
\DoxyCodeLine{00204   result\_host\_ras-\/>lock();}
\DoxyCodeLine{00205   result\_host = (\mbox{\hyperlink{structfloat4}{float4}} *)result\_host\_ras-\/>getRawData();}
\DoxyCodeLine{00206 }
\DoxyCodeLine{00207   doCompute\_CPU(tile, frame, rend\_sets, vanishingPoint, anchorPoint,}
\DoxyCodeLine{00208                 source\_host, result\_host, sourceDim, resultDim, precision,}
\DoxyCodeLine{00209                 offs);}
\DoxyCodeLine{00210 }
\DoxyCodeLine{00211   source\_host\_ras-\/>unlock();}
\DoxyCodeLine{00212 }
\DoxyCodeLine{00213   \textcolor{comment}{/*-\/ 出力結果をChannel値に変換して格納 -\/*/}}
\DoxyCodeLine{00214   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} outRas32 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}})tile.getRaster();}
\DoxyCodeLine{00215   \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} outRas64 = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}})tile.getRaster();}
\DoxyCodeLine{00216   \textcolor{keywordflow}{if} (outRas32)}
\DoxyCodeLine{00217     setOutputRaster<TRaster32P, TPixel32>(result\_host, outRas32, outDim,}
\DoxyCodeLine{00218                                           resultDim.ly);}
\DoxyCodeLine{00219   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (outRas64)}
\DoxyCodeLine{00220     setOutputRaster<TRaster64P, TPixel64>(result\_host, outRas64, outDim,}
\DoxyCodeLine{00221                                           resultDim.ly);}
\DoxyCodeLine{00222 }
\DoxyCodeLine{00223   result\_host\_ras-\/>unlock();}
\DoxyCodeLine{00224 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_aee7ef4646fa654259f68066f8db07bc6}\label{class_iwa___perspective_distort_fx_aee7ef4646fa654259f68066f8db07bc6}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!doCompute\_CPU@{doCompute\_CPU}}
\index{doCompute\_CPU@{doCompute\_CPU}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{doCompute\_CPU()}{doCompute\_CPU()}}
{\footnotesize\ttfamily void Iwa\+\_\+\+Perspective\+Distort\+Fx\+::do\+Compute\+\_\+\+CPU (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{const double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{settings,  }\item[{\mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{vanishing\+Point,  }\item[{\mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{anchor\+Point,  }\item[{\mbox{\hyperlink{structfloat4}{float4}} $\ast$}]{source\+\_\+host,  }\item[{\mbox{\hyperlink{structfloat4}{float4}} $\ast$}]{result\+\_\+host,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} \&}]{source\+Dim,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} \&}]{result\+Dim,  }\item[{const double}]{precision,  }\item[{const double}]{offs }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00232                        \{}
\DoxyCodeLine{00233   \textcolor{comment}{/*-\/ 結果ポインタ -\/*/}}
\DoxyCodeLine{00234   \mbox{\hyperlink{structfloat4}{float4}} *result\_p = result\_host;}
\DoxyCodeLine{00235   \textcolor{comment}{/*-\/ 結果画像内でループ -\/*/}}
\DoxyCodeLine{00236   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < resultDim.ly; j++) \{}
\DoxyCodeLine{00237     \textcolor{comment}{/*-\/ サンプルスタート地点 -\/*/}}
\DoxyCodeLine{00238     \textcolor{keywordtype}{double} sampleX =}
\DoxyCodeLine{00239         precision * (vp.x * (ap.y -\/ (double)j) / (vp.y -\/ (double)j));}
\DoxyCodeLine{00240     \textcolor{comment}{/*-\/ 1ピクセル横に移動した場合のサンプリング位置の移動量 -\/*/}}
\DoxyCodeLine{00241     \textcolor{keywordtype}{double} dx = precision * (vp.y -\/ ap.y) / (vp.y -\/ (\textcolor{keywordtype}{double})j);}
\DoxyCodeLine{00242     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < resultDim.lx; i++, result\_p++, sampleX += dx) \{}
\DoxyCodeLine{00243       \textcolor{keywordtype}{int} index    = (int)tfloor(sampleX);}
\DoxyCodeLine{00244       \textcolor{keywordtype}{double} ratio = sampleX -\/ (double)index;}
\DoxyCodeLine{00245       (*result\_p)  = interp\_CPU(}
\DoxyCodeLine{00246           getSource\_CPU(source\_host, sourceDim, index, j),}
\DoxyCodeLine{00247           getSource\_CPU(source\_host, sourceDim, index + 1, j), ratio);}
\DoxyCodeLine{00248     \}}
\DoxyCodeLine{00249   \}}
\DoxyCodeLine{00250 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_a130d7856797d517a764267d85fb568b5}\label{class_iwa___perspective_distort_fx_a130d7856797d517a764267d85fb568b5}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!doGetBBox@{doGetBBox}}
\index{doGetBBox@{doGetBBox}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{doGetBBox()}{doGetBBox()}}
{\footnotesize\ttfamily bool Iwa\+\_\+\+Perspective\+Distort\+Fx\+::do\+Get\+BBox (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{b\+Box,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00114                                                                       \{}
\DoxyCodeLine{00115   \textcolor{keywordflow}{if} (m\_source.isConnected()) \{}
\DoxyCodeLine{00116     \textcolor{keywordtype}{bool} ret      = m\_source-\/>doGetBBox(frame, bBox, info);}
\DoxyCodeLine{00117     \textcolor{keywordflow}{if} (ret) bBox = TConsts::infiniteRectD;}
\DoxyCodeLine{00118     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{00119   \}}
\DoxyCodeLine{00120   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00121 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_ae7e78e7c7940d27056d345fa55574a75}\label{class_iwa___perspective_distort_fx_ae7e78e7c7940d27056d345fa55574a75}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!getParamUIs@{getParamUIs}}
\index{getParamUIs@{getParamUIs}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{getParamUIs()}{getParamUIs()}}
{\footnotesize\ttfamily void Iwa\+\_\+\+Perspective\+Distort\+Fx\+::get\+Param\+UIs (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_param_u_i_concept}{TParam\+UIConcept}} $\ast$\&}]{params,  }\item[{int \&}]{length }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Returns a list of User Interface Concepts to be displayed when editing the fx parameters. \begin{DoxyNote}{Note}
Ownership of the returned array allocated with new\mbox{[}\mbox{]} is passed to callers. 
\end{DoxyNote}


Reimplemented from \mbox{\hyperlink{class_t_fx_a18766b107b77772d67c5678e7d832b18}{TFx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00255                                                         \{}
\DoxyCodeLine{00256   concepts = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_param_u_i_concept}{TParamUIConcept}}[length = 2];}
\DoxyCodeLine{00257 }
\DoxyCodeLine{00258   concepts[0].\mbox{\hyperlink{class_t_param_u_i_concept_a2dbb7c954ca5f2441a6931945cf004a5}{m\_type}}  = TParamUIConcept::POINT;}
\DoxyCodeLine{00259   concepts[0].m\_label = \textcolor{stringliteral}{"{}Vanishing Point"{}};}
\DoxyCodeLine{00260   concepts[0].m\_params.push\_back(m\_vanishingPoint);}
\DoxyCodeLine{00261 }
\DoxyCodeLine{00262   concepts[1].m\_type  = TParamUIConcept::POINT;}
\DoxyCodeLine{00263   concepts[1].m\_label = \textcolor{stringliteral}{"{}Anchor Point"{}};}
\DoxyCodeLine{00264   concepts[1].m\_params.push\_back(m\_anchorPoint);}
\DoxyCodeLine{00265 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00078}{TParam\+UIConcept\+::m\+\_\+label}}, \mbox{\hyperlink{l00079}{TParam\+UIConcept\+::m\+\_\+params}}, and \mbox{\hyperlink{l00077}{TParam\+UIConcept\+::m\+\_\+type}}.

\mbox{\Hypertarget{class_iwa___perspective_distort_fx_a78238c9e912ea766f49753dc8e521c93}\label{class_iwa___perspective_distort_fx_a78238c9e912ea766f49753dc8e521c93}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!setOutputRaster@{setOutputRaster}}
\index{setOutputRaster@{setOutputRaster}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{setOutputRaster()}{setOutputRaster()}}
{\footnotesize\ttfamily template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ \\
void Iwa\+\_\+\+Perspective\+Distort\+Fx\+::set\+Output\+Raster (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structfloat4}{float4}} $\ast$}]{src\+Mem,  }\item[{const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}}}]{dst\+Ras,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}}}]{dim,  }\item[{int}]{draw\+Level }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00037                                                                                \{}
\DoxyCodeLine{00038   \textcolor{keyword}{typename} PIXEL::Channel halfChan =}
\DoxyCodeLine{00039       (\textcolor{keyword}{typename} PIXEL::Channel)(PIXEL::maxChannelValue / 2);}
\DoxyCodeLine{00040 }
\DoxyCodeLine{00041   dstRas-\/>fill(PIXEL::Transparent);}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043   \mbox{\hyperlink{structfloat4}{float4}} *chan\_p = srcMem;}
\DoxyCodeLine{00044   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < drawLevel; j++) \{}
\DoxyCodeLine{00045     \textcolor{keywordflow}{if} (j >= dstRas-\/>getLy()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00046 }
\DoxyCodeLine{00047     PIXEL *pix = dstRas-\/>pixels(j);}
\DoxyCodeLine{00048     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dstRas-\/>getLx(); i++, chan\_p++, pix++) \{}
\DoxyCodeLine{00049       \textcolor{keywordtype}{float} val;}
\DoxyCodeLine{00050       val    = (*chan\_p).x * (float)PIXEL::maxChannelValue + 0.5f;}
\DoxyCodeLine{00051       pix-\/>r = (\textcolor{keyword}{typename} PIXEL::Channel)((val > (\textcolor{keywordtype}{float})PIXEL::maxChannelValue)}
\DoxyCodeLine{00052                                              ? (\textcolor{keywordtype}{float})PIXEL::maxChannelValue}
\DoxyCodeLine{00053                                              : val);}
\DoxyCodeLine{00054       val    = (*chan\_p).y * (float)PIXEL::maxChannelValue + 0.5f;}
\DoxyCodeLine{00055       pix-\/>g = (\textcolor{keyword}{typename} PIXEL::Channel)((val > (\textcolor{keywordtype}{float})PIXEL::maxChannelValue)}
\DoxyCodeLine{00056                                              ? (\textcolor{keywordtype}{float})PIXEL::maxChannelValue}
\DoxyCodeLine{00057                                              : val);}
\DoxyCodeLine{00058       val    = (*chan\_p).z * (float)PIXEL::maxChannelValue + 0.5f;}
\DoxyCodeLine{00059       pix-\/>b = (\textcolor{keyword}{typename} PIXEL::Channel)((val > (\textcolor{keywordtype}{float})PIXEL::maxChannelValue)}
\DoxyCodeLine{00060                                              ? (\textcolor{keywordtype}{float})PIXEL::maxChannelValue}
\DoxyCodeLine{00061                                              : val);}
\DoxyCodeLine{00062       val    = (*chan\_p).w * (float)PIXEL::maxChannelValue + 0.5f;}
\DoxyCodeLine{00063       pix-\/>m = (\textcolor{keyword}{typename} PIXEL::Channel)((val > (\textcolor{keywordtype}{float})PIXEL::maxChannelValue)}
\DoxyCodeLine{00064                                              ? (\textcolor{keywordtype}{float})PIXEL::maxChannelValue}
\DoxyCodeLine{00065                                              : val);}
\DoxyCodeLine{00066     \}}
\DoxyCodeLine{00067   \}}
\DoxyCodeLine{00068 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_aaff1885f9d9664d810309ea5125c5fce}\label{class_iwa___perspective_distort_fx_aaff1885f9d9664d810309ea5125c5fce}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!setSourceRaster@{setSourceRaster}}
\index{setSourceRaster@{setSourceRaster}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{setSourceRaster()}{setSourceRaster()}}
{\footnotesize\ttfamily template$<$typename \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}} , typename PIXEL $>$ \\
void Iwa\+\_\+\+Perspective\+Distort\+Fx\+::set\+Source\+Raster (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct___r_a_s_t_e_r}{RASTER}}}]{src\+Ras,  }\item[{\mbox{\hyperlink{structfloat4}{float4}} $\ast$}]{dst\+Mem,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}}}]{dim }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00077                                                                 \{}
\DoxyCodeLine{00078   \mbox{\hyperlink{structfloat4}{float4}} *chann\_p = dstMem;}
\DoxyCodeLine{00079   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < dim.ly; j++) \{}
\DoxyCodeLine{00080     PIXEL *pix = srcRas-\/>pixels(j);}
\DoxyCodeLine{00081     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dim.lx; i++, pix++, chann\_p++) \{}
\DoxyCodeLine{00082       (*chann\_p).x = (float)pix-\/>r / (\textcolor{keywordtype}{float})PIXEL::maxChannelValue;}
\DoxyCodeLine{00083       (*chann\_p).y = (float)pix-\/>g / (\textcolor{keywordtype}{float})PIXEL::maxChannelValue;}
\DoxyCodeLine{00084       (*chann\_p).z = (float)pix-\/>b / (\textcolor{keywordtype}{float})PIXEL::maxChannelValue;}
\DoxyCodeLine{00085       (*chann\_p).w = (float)pix-\/>m / (\textcolor{keywordtype}{float})PIXEL::maxChannelValue;}
\DoxyCodeLine{00086     \}}
\DoxyCodeLine{00087   \}}
\DoxyCodeLine{00088 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_iwa___perspective_distort_fx_a0e10e3ee9f2b7301efd972412e977f67}\label{class_iwa___perspective_distort_fx_a0e10e3ee9f2b7301efd972412e977f67}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!m\_anchorPoint@{m\_anchorPoint}}
\index{m\_anchorPoint@{m\_anchorPoint}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{m\_anchorPoint}{m\_anchorPoint}}
{\footnotesize\ttfamily TPoint\+ParamP Iwa\+\_\+\+Perspective\+Distort\+Fx\+::m\+\_\+anchor\+Point\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_iwa___perspective_distort_fx_ac17778f67b40640173a8034ecf9a91f3}\label{class_iwa___perspective_distort_fx_ac17778f67b40640173a8034ecf9a91f3}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!m\_precision@{m\_precision}}
\index{m\_precision@{m\_precision}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{m\_precision}{m\_precision}}
{\footnotesize\ttfamily TDouble\+ParamP Iwa\+\_\+\+Perspective\+Distort\+Fx\+::m\+\_\+precision\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_iwa___perspective_distort_fx_a6567c88e02fd2f4a270cf320f4008d11}\label{class_iwa___perspective_distort_fx_a6567c88e02fd2f4a270cf320f4008d11}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!m\_source@{m\_source}}
\index{m\_source@{m\_source}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{m\_source}{m\_source}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} Iwa\+\_\+\+Perspective\+Distort\+Fx\+::m\+\_\+source\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_iwa___perspective_distort_fx_acf2344609df458f675ea09c92d79ba82}\label{class_iwa___perspective_distort_fx_acf2344609df458f675ea09c92d79ba82}} 
\index{Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}!m\_vanishingPoint@{m\_vanishingPoint}}
\index{m\_vanishingPoint@{m\_vanishingPoint}!Iwa\_PerspectiveDistortFx@{Iwa\_PerspectiveDistortFx}}
\doxysubsubsection{\texorpdfstring{m\_vanishingPoint}{m\_vanishingPoint}}
{\footnotesize\ttfamily TPoint\+ParamP Iwa\+\_\+\+Perspective\+Distort\+Fx\+::m\+\_\+vanishing\+Point\hspace{0.3cm}{\ttfamily [protected]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+perspectivedistortfx.\+h\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+perspectivedistortfx.\+cpp\end{DoxyCompactItemize}
