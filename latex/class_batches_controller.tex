\hypertarget{class_batches_controller}{}\doxysection{Batches\+Controller Class Reference}
\label{class_batches_controller}\index{BatchesController@{BatchesController}}
Inheritance diagram for Batches\+Controller\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_batches_controller}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_batches_controller_1_1_observer}{Observer}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Slots}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_batches_controller_a78297b26c178f7637bd26a80919c93c4}{on\+Exit}} (bool \&)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_batches_controller_ac94898c42a31de28e94114dfdb189305}{set\+Dirty\+Flag}} (bool state)
\item 
QString \mbox{\hyperlink{class_batches_controller_afe88f2d87a18a90a6bb895ca0e8b969b}{get\+List\+Name}} () const
\item 
void \mbox{\hyperlink{class_batches_controller_ac9381c8608c85f17287fa3c80b351950}{add\+Composer\+Task}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&task\+File\+Path)
\item 
void \mbox{\hyperlink{class_batches_controller_ab829c6486c9f458671580691e0f54fb9}{add\+Cleanup\+Task}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&task\+File\+Path)
\item 
void \mbox{\hyperlink{class_batches_controller_a763114c21b6a43cbf1d024373cf5cfd4}{add\+Task}} (const QString \&id, \mbox{\hyperlink{class_t_farm_task}{TFarm\+Task}} $\ast$task, bool do\+Update=true)
\item 
void \mbox{\hyperlink{class_batches_controller_ad92494a02d0fde7e4da51cedba78e0bf}{remove\+Task}} (const QString \&id)
\item 
void \mbox{\hyperlink{class_batches_controller_a3dda8208547576d66ea7541a801f888a}{remove\+All\+Tasks}} ()
\item 
int \mbox{\hyperlink{class_batches_controller_a1406df29a4281536df3cc5ea67a2d105}{get\+Task\+Count}} () const
\item 
QString \mbox{\hyperlink{class_batches_controller_adcb6113509056b61eff95fd16047e329}{get\+Task\+Id}} (int index) const
\item 
\mbox{\hyperlink{class_t_farm_task}{TFarm\+Task}} $\ast$ \mbox{\hyperlink{class_batches_controller_a2c6fb61e5ef6c55a18e114fe658615dd}{get\+Task}} (int index) const
\item 
\mbox{\hyperlink{class_t_farm_task}{TFarm\+Task}} $\ast$ \mbox{\hyperlink{class_batches_controller_a348ea610e745a1d6b063a53de02c53e7}{get\+Task}} (const QString \&id) const
\item 
bool \mbox{\hyperlink{class_batches_controller_a8c7e0f94ac7b01b62a84a8a785ffd0d3}{get\+Task\+Info}} (const QString \&id, QString \&parent, QString \&name, Task\+State \&status)
\item 
Task\+State \mbox{\hyperlink{class_batches_controller_a275e0fdb3ab3aaee8503e35a5599a4b7}{get\+Task\+Status}} (const QString \&id) const
\item 
void \mbox{\hyperlink{class_batches_controller_a5d40b3c5326e114dfc0d227897921fac}{load\+Task}} (bool is\+Render\+Task)
\item 
void \mbox{\hyperlink{class_batches_controller_a405f14ff2b5da5c7d8370b182f8d93bd}{get\+Tasks}} (const QString \&parent\+Id, std\+::vector$<$ QString $>$ \&tasks) const
\item 
void \mbox{\hyperlink{class_batches_controller_aa4fb1bff8a363a183971890e1dfbfd4b}{set\+Tasks\+Tree}} (\mbox{\hyperlink{class_task_tree_model}{Task\+Tree\+Model}} $\ast$tree)
\item 
\mbox{\hyperlink{class_task_tree_model}{Task\+Tree\+Model}} $\ast$ \mbox{\hyperlink{class_batches_controller_afbf82c21d303ec546d67cf5c39cbafd2}{get\+Tasks\+Tree}} ()
\item 
void \mbox{\hyperlink{class_batches_controller_ad7e89a6a6b82ede790b0a78217804dee}{start\+All}} ()
\item 
void \mbox{\hyperlink{class_batches_controller_a6bb156b170444bb414301052e005c3d8}{start}} (const QString \&task\+Id)
\item 
void \mbox{\hyperlink{class_batches_controller_a795de86a203d8d242d7dae193aee2a9f}{stop\+All}} ()
\item 
void \mbox{\hyperlink{class_batches_controller_afd9928485e42f6fe4914d8cf9386f2d9}{stop}} (const QString \&task\+Id)
\item 
void \mbox{\hyperlink{class_batches_controller_aae6c7b6875e9d20c4f078d30e2052a00}{load}} ()
\item 
void \mbox{\hyperlink{class_batches_controller_afc9b6a6a2f819c89501d3fcbba22be3d}{do\+Load}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
void \mbox{\hyperlink{class_batches_controller_afca4f3611db70966953975898a3d336b}{save}} ()
\item 
void \mbox{\hyperlink{class_batches_controller_a2b415b1d1d977be10e0922080575538d}{saveas}} ()
\item 
void \mbox{\hyperlink{class_batches_controller_a0914619e8d5891a6ad29db74ed0d8e6f}{do\+Save}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp=\mbox{\hyperlink{class_t_file_path}{TFile\+Path}}())
\item 
void \mbox{\hyperlink{class_batches_controller_aeb96d1312f14d7de762bafdce4fdc797}{attach}} (\mbox{\hyperlink{class_batches_controller_1_1_observer}{Observer}} $\ast$obs)
\item 
void \mbox{\hyperlink{class_batches_controller_ab140396deccc7a1758f18c2a5754362e}{detach}} (\mbox{\hyperlink{class_batches_controller_1_1_observer}{Observer}} $\ast$obs)
\item 
void \mbox{\hyperlink{class_batches_controller_af0c4381ebf25d652679a1870ba9c55a8}{notify}} ()
\item 
void \mbox{\hyperlink{class_batches_controller_ae179d66b33eb3ddc15689ea5cee9695b}{set\+Controller}} (\mbox{\hyperlink{class_t_farm_controller}{TFarm\+Controller}} $\ast$controller)
\item 
\mbox{\hyperlink{class_t_farm_controller}{TFarm\+Controller}} $\ast$ \mbox{\hyperlink{class_batches_controller_a5c8269bdeb87cde7867fce2ab1537b9a}{get\+Controller}} () const
\item 
void \mbox{\hyperlink{class_batches_controller_ada2ea43207cdc70fe3d165e79d160ef7}{update}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_batches_controller}{Batches\+Controller}} $\ast$ \mbox{\hyperlink{class_batches_controller_a2526727f29f49f8fe56b74f5b2aece76}{instance}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_batches_controller_a840d4eb5326d72258c00ddfd6408ec4f}\label{class_batches_controller_a840d4eb5326d72258c00ddfd6408ec4f}} 
{\bfseries Batches\+Controller} (const \mbox{\hyperlink{class_batches_controller}{Batches\+Controller}} \&)
\item 
\mbox{\Hypertarget{class_batches_controller_a155a9664d5886980561f5d172396c411}\label{class_batches_controller_a155a9664d5886980561f5d172396c411}} 
void {\bfseries operator=} (const \mbox{\hyperlink{class_batches_controller}{Batches\+Controller}} \&)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_batches_controller_a9e7b5b8b56929610702b40c7cecdf681}\label{class_batches_controller_a9e7b5b8b56929610702b40c7cecdf681}} 
\index{BatchesController@{BatchesController}!BatchesController@{BatchesController}}
\index{BatchesController@{BatchesController}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{BatchesController()}{BatchesController()}}
{\footnotesize\ttfamily Batches\+Controller\+::\+Batches\+Controller (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00277     : m\_controller(0), m\_tasksTree(0), m\_filepath(), m\_dirtyFlag(\textcolor{keyword}{false}) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_aa719bdc411da2434c42fc173e3b2fe12}\label{class_batches_controller_aa719bdc411da2434c42fc173e3b2fe12}} 
\index{BatchesController@{BatchesController}!````~BatchesController@{$\sim$BatchesController}}
\index{````~BatchesController@{$\sim$BatchesController}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{$\sim$BatchesController()}{~BatchesController()}}
{\footnotesize\ttfamily Batches\+Controller\+::$\sim$\+Batches\+Controller (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00281 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_batches_controller_ab829c6486c9f458671580691e0f54fb9}\label{class_batches_controller_ab829c6486c9f458671580691e0f54fb9}} 
\index{BatchesController@{BatchesController}!addCleanupTask@{addCleanupTask}}
\index{addCleanupTask@{addCleanupTask}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{addCleanupTask()}{addCleanupTask()}}
{\footnotesize\ttfamily void Batches\+Controller\+::add\+Cleanup\+Task (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{task\+File\+Path }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00301                                                                     \{}
\DoxyCodeLine{00302   setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{00303   QString \textcolor{keywordtype}{id} = QString::number(TaskCounter++);}
\DoxyCodeLine{00304   \textcolor{keywordflow}{while} (BatchesController::instance()-\/>getTask(\textcolor{keywordtype}{id}))}
\DoxyCodeLine{00305     \textcolor{keywordtype}{id} = QString::number(TaskCounter++);}
\DoxyCodeLine{00306 }
\DoxyCodeLine{00307   \mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *taskGroup = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}}(}
\DoxyCodeLine{00308       \textcolor{keywordtype}{id},                                              \textcolor{comment}{// id}}
\DoxyCodeLine{00309       QString::fromStdString(taskFilePath.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()),  \textcolor{comment}{// name}}
\DoxyCodeLine{00310       TSystem::getUserName(),                          \textcolor{comment}{// user}}
\DoxyCodeLine{00311       TSystem::getHostName(),                          \textcolor{comment}{// host}}
\DoxyCodeLine{00312       1,                                               \textcolor{comment}{// stepCount}}
\DoxyCodeLine{00313       50,                                              \textcolor{comment}{// priority}}
\DoxyCodeLine{00314       taskFilePath,                                    \textcolor{comment}{// taskFilePath}}
\DoxyCodeLine{00315       Overwrite\_Off,                                   \textcolor{comment}{// Overwrite}}
\DoxyCodeLine{00316       \textcolor{keyword}{false});                                          \textcolor{comment}{// onlyvisible}}
\DoxyCodeLine{00317 }
\DoxyCodeLine{00318   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00319     BatchesController::instance()-\/>addTask(\textcolor{keywordtype}{id}, taskGroup);}
\DoxyCodeLine{00320   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_exception}{TException}} \&) \{}
\DoxyCodeLine{00321   \}}
\DoxyCodeLine{00322 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_ac9381c8608c85f17287fa3c80b351950}\label{class_batches_controller_ac9381c8608c85f17287fa3c80b351950}} 
\index{BatchesController@{BatchesController}!addComposerTask@{addComposerTask}}
\index{addComposerTask@{addComposerTask}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{addComposerTask()}{addComposerTask()}}
{\footnotesize\ttfamily void Batches\+Controller\+::add\+Composer\+Task (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{task\+File\+Path }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00326                                                                       \{}
\DoxyCodeLine{00327   setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{00328   \mbox{\hyperlink{class_t_file_path}{TFilePath}} taskFilePath;}
\DoxyCodeLine{00329   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00330     taskFilePath = TSystem::toUNC(\_taskFilePath);}
\DoxyCodeLine{00331   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_exception}{TException}} \&) \{}
\DoxyCodeLine{00332   \}}
\DoxyCodeLine{00333 }
\DoxyCodeLine{00334   \mbox{\hyperlink{class_toonz_scene}{ToonzScene}} scene;}
\DoxyCodeLine{00335   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00336     scene.\mbox{\hyperlink{class_toonz_scene_ac1c6f51c86f8feba26ea8633a2283125}{loadNoResources}}(taskFilePath);}
\DoxyCodeLine{00337   \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{00338     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00339   \}}
\DoxyCodeLine{00340 }
\DoxyCodeLine{00341   \mbox{\hyperlink{class_t_scene_properties}{TSceneProperties}} *sprop      = scene.\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}();}
\DoxyCodeLine{00342   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_output_properties}{TOutputProperties}} \&out = *sprop-\/>\mbox{\hyperlink{class_t_scene_properties_abea7b4b8e4f0cedbf753b26ec30b5331}{getOutputProperties}}();}
\DoxyCodeLine{00343   \textcolor{keyword}{const} \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} \&rs    = out.\mbox{\hyperlink{class_t_output_properties_afa7c771452b57b50047aa4afc6032cad}{getRenderSettings}}();}
\DoxyCodeLine{00344 }
\DoxyCodeLine{00345   QString name = QString::fromStdString(taskFilePath.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}());}
\DoxyCodeLine{00346   \textcolor{keywordtype}{int} r0, r1, step;}
\DoxyCodeLine{00347   out.\mbox{\hyperlink{class_t_output_properties_aae127cbd8b19eaed0b0fbaf589349176}{getRange}}(r0, r1, step);}
\DoxyCodeLine{00348 }
\DoxyCodeLine{00349   \textcolor{keywordtype}{int} sceneFrameCount = scene.\mbox{\hyperlink{class_toonz_scene_ab5cd3ad6f894b1acc5656ca747a80627}{getFrameCount}}();}
\DoxyCodeLine{00350   \textcolor{keywordflow}{if} (r0 < 0) r0      = 0;}
\DoxyCodeLine{00351   \textcolor{keywordflow}{if} (r1 >= sceneFrameCount)}
\DoxyCodeLine{00352     r1 = sceneFrameCount -\/ 1;}
\DoxyCodeLine{00353   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (r1 < r0)}
\DoxyCodeLine{00354     r1 = sceneFrameCount -\/ 1;}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00356   r0++, r1++;}
\DoxyCodeLine{00357   \textcolor{keywordtype}{int} shrink = rs.\mbox{\hyperlink{class_t_render_settings_a52dd41881bbf6aaf953fe300be2e233e}{m\_shrinkX}};}
\DoxyCodeLine{00358 }
\DoxyCodeLine{00359   \textcolor{keywordtype}{int} multimedia       = out.getMultimediaRendering();}
\DoxyCodeLine{00360   \textcolor{keywordtype}{int} threadsIndex     = out.getThreadIndex();}
\DoxyCodeLine{00361   \textcolor{keywordtype}{int} maxTileSizeIndex = out.getMaxTileSizeIndex();}
\DoxyCodeLine{00362 }
\DoxyCodeLine{00363   \mbox{\hyperlink{class_t_file_path}{TFilePath}} outputPath =}
\DoxyCodeLine{00364       scene.\mbox{\hyperlink{class_toonz_scene_aa2ed57dfbae7f8cf02a4abe47ed533c6}{decodeFilePath}}(sprop-\/>\mbox{\hyperlink{class_t_scene_properties_abea7b4b8e4f0cedbf753b26ec30b5331}{getOutputProperties}}()-\/>\mbox{\hyperlink{class_t_output_properties_ab082a7e84177a558484d648215e4b4f7}{getPath}}());}
\DoxyCodeLine{00365   \textcolor{keywordflow}{if} (outputPath.getWideName() == L\textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00366     outputPath = outputPath.\mbox{\hyperlink{class_t_file_path_a3ebf9ced558cfef97a60bba536b23c6f}{withName}}(scene.\mbox{\hyperlink{class_toonz_scene_ad42b52b671b094f66e003c4b7ebefd45}{getScenePath}}().\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}());}
\DoxyCodeLine{00367   \textcolor{keywordtype}{int} taskChunkSize;}
\DoxyCodeLine{00368   \textcolor{keywordflow}{if} (isMovieType(outputPath.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}()))}
\DoxyCodeLine{00369     taskChunkSize = sceneFrameCount;}
\DoxyCodeLine{00370   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00371     \textcolor{keywordtype}{int} size = Preferences::instance()-\/>getDefaultTaskChunkSize();}
\DoxyCodeLine{00372     \textcolor{keywordflow}{if} (r1 -\/ r0 + 1 < size)}
\DoxyCodeLine{00373       taskChunkSize = r1 -\/ r0 + 1;}
\DoxyCodeLine{00374     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00375       taskChunkSize = size;}
\DoxyCodeLine{00376   \}}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378   QString \textcolor{keywordtype}{id} = QString::number(TaskCounter++);}
\DoxyCodeLine{00379   \textcolor{keywordflow}{while} (BatchesController::instance()-\/>getTask(\textcolor{keywordtype}{id}))}
\DoxyCodeLine{00380     \textcolor{keywordtype}{id} = QString::number(TaskCounter++);}
\DoxyCodeLine{00381 }
\DoxyCodeLine{00382   \mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *taskGroup = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}}(}
\DoxyCodeLine{00383       \textcolor{keywordtype}{id}, name, TSystem::getUserName(), TSystem::getHostName(), sceneFrameCount,}
\DoxyCodeLine{00384       50, taskFilePath, outputPath, r0, r1, step, shrink, multimedia,}
\DoxyCodeLine{00385       taskChunkSize, threadsIndex, maxTileSizeIndex);}
\DoxyCodeLine{00386 }
\DoxyCodeLine{00387   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00388     BatchesController::instance()-\/>addTask(\textcolor{keywordtype}{id}, taskGroup);}
\DoxyCodeLine{00389   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_exception}{TException}} \&) \{}
\DoxyCodeLine{00390     \textcolor{comment}{// TMessage::error(toString(e.getMessage()));}}
\DoxyCodeLine{00391   \}}
\DoxyCodeLine{00392   \textcolor{comment}{// m\_data-\/>m\_scene.setProject( mainprogramProj);}}
\DoxyCodeLine{00393   \textcolor{comment}{// TModalPopup::closePopup();}}
\DoxyCodeLine{00394 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a763114c21b6a43cbf1d024373cf5cfd4}\label{class_batches_controller_a763114c21b6a43cbf1d024373cf5cfd4}} 
\index{BatchesController@{BatchesController}!addTask@{addTask}}
\index{addTask@{addTask}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{addTask()}{addTask()}}
{\footnotesize\ttfamily void Batches\+Controller\+::add\+Task (\begin{DoxyParamCaption}\item[{const QString \&}]{id,  }\item[{\mbox{\hyperlink{class_t_farm_task}{TFarm\+Task}} $\ast$}]{task,  }\item[{bool}]{do\+Update = {\ttfamily true} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00400                                                \{}
\DoxyCodeLine{00401 \textcolor{preprocessor}{\#ifdef \_DEBUG}}
\DoxyCodeLine{00402   std::map<QString, TFarmTask *>::iterator it = m\_tasks.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00403 \textcolor{comment}{// assert(it == m\_tasks.end());}}
\DoxyCodeLine{00404 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00405   \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}}.isEmpty()) task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}} = id;}
\DoxyCodeLine{00406 }
\DoxyCodeLine{00407   task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}}         = Suspended;}
\DoxyCodeLine{00408   task-\/>m\_submissionDate = QDateTime::currentDateTime();}
\DoxyCodeLine{00409 }
\DoxyCodeLine{00410   m\_tasks.insert(std::make\_pair(\textcolor{keywordtype}{id}, task));}
\DoxyCodeLine{00411 }
\DoxyCodeLine{00412   \textcolor{keywordtype}{int} count = task-\/>getTaskCount();}
\DoxyCodeLine{00413   \textcolor{keywordflow}{if} (count == 1 \&\& task-\/>getTask(0) == task) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00414 }
\DoxyCodeLine{00415   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; ++i) \{}
\DoxyCodeLine{00416     \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *subtask = task-\/>getTask(i);}
\DoxyCodeLine{00417     assert(subtask);}
\DoxyCodeLine{00418     addTask(subtask-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}}, subtask);}
\DoxyCodeLine{00419   \}}
\DoxyCodeLine{00420   \textcolor{keywordflow}{if} (doUpdate) update();}
\DoxyCodeLine{00421 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_aeb96d1312f14d7de762bafdce4fdc797}\label{class_batches_controller_aeb96d1312f14d7de762bafdce4fdc797}} 
\index{BatchesController@{BatchesController}!attach@{attach}}
\index{attach@{attach}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{attach()}{attach()}}
{\footnotesize\ttfamily void Batches\+Controller\+::attach (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_batches_controller_1_1_observer}{Batches\+Controller\+::\+Observer}} $\ast$}]{obs }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00919                                                              \{}
\DoxyCodeLine{00920   m\_observers.insert(obs);}
\DoxyCodeLine{00921 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_ab140396deccc7a1758f18c2a5754362e}\label{class_batches_controller_ab140396deccc7a1758f18c2a5754362e}} 
\index{BatchesController@{BatchesController}!detach@{detach}}
\index{detach@{detach}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{detach()}{detach()}}
{\footnotesize\ttfamily void Batches\+Controller\+::detach (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_batches_controller_1_1_observer}{Batches\+Controller\+::\+Observer}} $\ast$}]{obs }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00925                                                              \{}
\DoxyCodeLine{00926   m\_observers.erase(obs);}
\DoxyCodeLine{00927 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_afc9b6a6a2f819c89501d3fcbba22be3d}\label{class_batches_controller_afc9b6a6a2f819c89501d3fcbba22be3d}} 
\index{BatchesController@{BatchesController}!doLoad@{doLoad}}
\index{doLoad@{doLoad}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{doLoad()}{doLoad()}}
{\footnotesize\ttfamily void Batches\+Controller\+::do\+Load (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00796                                                   \{}
\DoxyCodeLine{00797   \textcolor{keywordflow}{if} (m\_dirtyFlag) \{}
\DoxyCodeLine{00798     \textcolor{keywordtype}{int} ret =}
\DoxyCodeLine{00799         DVGui::MsgBox(QString(tr(\textcolor{stringliteral}{"{}The current task list has been modified.\(\backslash\)nDo "{}}}
\DoxyCodeLine{00800                                  \textcolor{stringliteral}{"{}you want to save your changes?"{}})),}
\DoxyCodeLine{00801                       tr(\textcolor{stringliteral}{"{}Save"{}}), tr(\textcolor{stringliteral}{"{}Discard"{}}), tr(\textcolor{stringliteral}{"{}Cancel"{}}));}
\DoxyCodeLine{00802     \textcolor{keywordflow}{if} (ret == 1)}
\DoxyCodeLine{00803       save();}
\DoxyCodeLine{00804     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 3 || ret == 0)}
\DoxyCodeLine{00805       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00806   \}}
\DoxyCodeLine{00807 }
\DoxyCodeLine{00808   setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{00809 }
\DoxyCodeLine{00810   m\_tasks.clear();}
\DoxyCodeLine{00811   m\_farmIdsTable.clear();}
\DoxyCodeLine{00812 }
\DoxyCodeLine{00813   \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00814     \mbox{\hyperlink{class_t_i_stream}{TIStream}} is(fp);}
\DoxyCodeLine{00815     \textcolor{keywordflow}{if} (is) \{}
\DoxyCodeLine{00816     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00817       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(fp.getWideString() + L\textcolor{stringliteral}{"{}: Can't open file"{}});}
\DoxyCodeLine{00818 }
\DoxyCodeLine{00819     m\_filepath = fp;}
\DoxyCodeLine{00820 }
\DoxyCodeLine{00821     std::string tagName = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00822     \textcolor{keywordflow}{if} (!is.matchTag(tagName)) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}Bad file format"{}});}
\DoxyCodeLine{00823 }
\DoxyCodeLine{00824     \textcolor{keywordflow}{if} (tagName == \textcolor{stringliteral}{"{}tnzbatches"{}}) \{}
\DoxyCodeLine{00825       std::string rootTagName = tagName;}
\DoxyCodeLine{00826       std::string v           = is.getTagAttribute(\textcolor{stringliteral}{"{}version"{}});}
\DoxyCodeLine{00827       \textcolor{keywordflow}{while} (is.matchTag(tagName)) \{}
\DoxyCodeLine{00828         \textcolor{keywordflow}{if} (tagName == \textcolor{stringliteral}{"{}generator"{}}) \{}
\DoxyCodeLine{00829           std::string program = is.getString();}
\DoxyCodeLine{00830         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (tagName == \textcolor{stringliteral}{"{}batch"{}}) \{}
\DoxyCodeLine{00831           \textcolor{keywordflow}{while} (!is.eos()) \{}
\DoxyCodeLine{00832             \mbox{\hyperlink{class_t_persist}{TPersist}} *p = 0;}
\DoxyCodeLine{00833             is >> p;}
\DoxyCodeLine{00834             \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *\textcolor{keyword}{>}(p);}
\DoxyCodeLine{00835             \textcolor{keywordflow}{if} (task) addTask(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}}, task, \textcolor{keyword}{false});}
\DoxyCodeLine{00836           \}}
\DoxyCodeLine{00837         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00838           \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(tagName + \textcolor{stringliteral}{"{} : unexpected tag"{}});}
\DoxyCodeLine{00839         \}}
\DoxyCodeLine{00840 }
\DoxyCodeLine{00841         \textcolor{keywordflow}{if} (!is.matchEndTag()) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(tagName + \textcolor{stringliteral}{"{} : missing end tag"{}});}
\DoxyCodeLine{00842       \}}
\DoxyCodeLine{00843       \textcolor{keywordflow}{if} (!is.matchEndTag())}
\DoxyCodeLine{00844         \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(rootTagName + \textcolor{stringliteral}{"{} : missing end tag"{}});}
\DoxyCodeLine{00845     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00846       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}Bad file format"{}});}
\DoxyCodeLine{00847     \}}
\DoxyCodeLine{00848   \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_exception}{TException}} \&e) \{}
\DoxyCodeLine{00849     \textcolor{keywordflow}{throw} e;}
\DoxyCodeLine{00850   \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{00851     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}Loading error."{}});}
\DoxyCodeLine{00852   \}}
\DoxyCodeLine{00853   update();}
\DoxyCodeLine{00854   notify();}
\DoxyCodeLine{00855 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a0914619e8d5891a6ad29db74ed0d8e6f}\label{class_batches_controller_a0914619e8d5891a6ad29db74ed0d8e6f}} 
\index{BatchesController@{BatchesController}!doSave@{doSave}}
\index{doSave@{doSave}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{doSave()}{doSave()}}
{\footnotesize\ttfamily void Batches\+Controller\+::do\+Save (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp = {\ttfamily \mbox{\hyperlink{class_t_file_path}{TFile\+Path}}()} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00887                                                    \{}
\DoxyCodeLine{00888   setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{00889 }
\DoxyCodeLine{00890   \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp;}
\DoxyCodeLine{00891   \textcolor{keywordflow}{if} (\_fp == \mbox{\hyperlink{class_t_file_path}{TFilePath}}())}
\DoxyCodeLine{00892     fp = m\_filepath;}
\DoxyCodeLine{00893   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00894     fp = m\_filepath = \_fp;}
\DoxyCodeLine{00895 }
\DoxyCodeLine{00896   \mbox{\hyperlink{class_t_o_stream}{TOStream}} os(fp);}
\DoxyCodeLine{00897 }
\DoxyCodeLine{00898   std::map<std::string, std::string> attr;}
\DoxyCodeLine{00899   attr[\textcolor{stringliteral}{"{}version"{}}] = \textcolor{stringliteral}{"{}1.0"{}};}
\DoxyCodeLine{00900 }
\DoxyCodeLine{00901   os.openChild(\textcolor{stringliteral}{"{}tnzbatches"{}}, attr);}
\DoxyCodeLine{00902   os.child(\textcolor{stringliteral}{"{}generator"{}}) << TEnv::getApplicationFullName();}
\DoxyCodeLine{00903 }
\DoxyCodeLine{00904   os.openChild(\textcolor{stringliteral}{"{}batch"{}});}
\DoxyCodeLine{00905   std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.begin();}
\DoxyCodeLine{00906   \textcolor{keywordflow}{for} (; it != m\_tasks.end(); ++it) \{}
\DoxyCodeLine{00907     \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it-\/>second;}
\DoxyCodeLine{00908     assert(task);}
\DoxyCodeLine{00909     os << task;}
\DoxyCodeLine{00910   \}}
\DoxyCodeLine{00911   os.closeChild();  \textcolor{comment}{// "{}batch"{}}}
\DoxyCodeLine{00912   os.closeChild();  \textcolor{comment}{// "{}tnzbatches"{}}}
\DoxyCodeLine{00913 }
\DoxyCodeLine{00914   update();}
\DoxyCodeLine{00915 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a5c8269bdeb87cde7867fce2ab1537b9a}\label{class_batches_controller_a5c8269bdeb87cde7867fce2ab1537b9a}} 
\index{BatchesController@{BatchesController}!getController@{getController}}
\index{getController@{getController}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getController()}{getController()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_farm_controller}{TFarm\+Controller}} $\ast$ Batches\+Controller\+::get\+Controller (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00948                                                         \{}
\DoxyCodeLine{00949   \textcolor{keywordflow}{return} m\_controller;}
\DoxyCodeLine{00950 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_afe88f2d87a18a90a6bb895ca0e8b969b}\label{class_batches_controller_afe88f2d87a18a90a6bb895ca0e8b969b}} 
\index{BatchesController@{BatchesController}!getListName@{getListName}}
\index{getListName@{getListName}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getListName()}{getListName()}}
{\footnotesize\ttfamily QString Batches\+Controller\+::get\+List\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00859                                              \{}
\DoxyCodeLine{00860   QString str = (m\_filepath == \mbox{\hyperlink{class_t_file_path}{TFilePath}}()}
\DoxyCodeLine{00861                      ? tr(\textcolor{stringliteral}{"{}Tasks"{}})}
\DoxyCodeLine{00862                      : QString::fromStdString(m\_filepath.getName()));}
\DoxyCodeLine{00863   \textcolor{keywordflow}{return} str + (m\_dirtyFlag ? \textcolor{stringliteral}{"{}*"{}} : \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00864 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a348ea610e745a1d6b063a53de02c53e7}\label{class_batches_controller_a348ea610e745a1d6b063a53de02c53e7}} 
\index{BatchesController@{BatchesController}!getTask@{getTask}}
\index{getTask@{getTask}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTask()}{getTask()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_farm_task}{TFarm\+Task}} $\ast$ Batches\+Controller\+::get\+Task (\begin{DoxyParamCaption}\item[{const QString \&}]{id }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00524                                                              \{}
\DoxyCodeLine{00525   std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00526   \textcolor{keywordflow}{if} (it != m\_tasks.end()) \textcolor{keywordflow}{return} it-\/>second;}
\DoxyCodeLine{00527   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00528 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a2c6fb61e5ef6c55a18e114fe658615dd}\label{class_batches_controller_a2c6fb61e5ef6c55a18e114fe658615dd}} 
\index{BatchesController@{BatchesController}!getTask@{getTask}}
\index{getTask@{getTask}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTask()}{getTask()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_farm_task}{TFarm\+Task}} $\ast$ Batches\+Controller\+::get\+Task (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00515                                                      \{}
\DoxyCodeLine{00516   assert(index >= 0 \&\& index < (\textcolor{keywordtype}{int})m\_tasks.size());}
\DoxyCodeLine{00517   std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.begin();}
\DoxyCodeLine{00518   std::advance(it, index);}
\DoxyCodeLine{00519   \textcolor{keywordflow}{return} it-\/>second;}
\DoxyCodeLine{00520 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a1406df29a4281536df3cc5ea67a2d105}\label{class_batches_controller_a1406df29a4281536df3cc5ea67a2d105}} 
\index{BatchesController@{BatchesController}!getTaskCount@{getTaskCount}}
\index{getTaskCount@{getTaskCount}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTaskCount()}{getTaskCount()}}
{\footnotesize\ttfamily int Batches\+Controller\+::get\+Task\+Count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00502 \{ \textcolor{keywordflow}{return} m\_tasks.size(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_adcb6113509056b61eff95fd16047e329}\label{class_batches_controller_adcb6113509056b61eff95fd16047e329}} 
\index{BatchesController@{BatchesController}!getTaskId@{getTaskId}}
\index{getTaskId@{getTaskId}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTaskId()}{getTaskId()}}
{\footnotesize\ttfamily QString Batches\+Controller\+::get\+Task\+Id (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00506                                                     \{}
\DoxyCodeLine{00507   assert(index >= 0 \&\& index < (\textcolor{keywordtype}{int})m\_tasks.size());}
\DoxyCodeLine{00508   std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.begin();}
\DoxyCodeLine{00509   std::advance(it, index);}
\DoxyCodeLine{00510   \textcolor{keywordflow}{return} it-\/>first;}
\DoxyCodeLine{00511 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a8c7e0f94ac7b01b62a84a8a785ffd0d3}\label{class_batches_controller_a8c7e0f94ac7b01b62a84a8a785ffd0d3}} 
\index{BatchesController@{BatchesController}!getTaskInfo@{getTaskInfo}}
\index{getTaskInfo@{getTaskInfo}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTaskInfo()}{getTaskInfo()}}
{\footnotesize\ttfamily bool Batches\+Controller\+::get\+Task\+Info (\begin{DoxyParamCaption}\item[{const QString \&}]{id,  }\item[{QString \&}]{parent,  }\item[{QString \&}]{name,  }\item[{Task\+State \&}]{status }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00533                                                                       \{}
\DoxyCodeLine{00534   \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = getTask(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00535   \textcolor{keywordflow}{if} (task) \{}
\DoxyCodeLine{00536     parent = task-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}};}
\DoxyCodeLine{00537     name   = task-\/>\mbox{\hyperlink{class_t_farm_task_a14686e563d198398938fa8a9ed8ffff2}{m\_name}};}
\DoxyCodeLine{00538     status = task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}};}
\DoxyCodeLine{00539   \}}
\DoxyCodeLine{00540 }
\DoxyCodeLine{00541   \textcolor{keywordflow}{return} task != 0;}
\DoxyCodeLine{00542 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a405f14ff2b5da5c7d8370b182f8d93bd}\label{class_batches_controller_a405f14ff2b5da5c7d8370b182f8d93bd}} 
\index{BatchesController@{BatchesController}!getTasks@{getTasks}}
\index{getTasks@{getTasks}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTasks()}{getTasks()}}
{\footnotesize\ttfamily void Batches\+Controller\+::get\+Tasks (\begin{DoxyParamCaption}\item[{const QString \&}]{parent\+Id,  }\item[{std\+::vector$<$ QString $>$ \&}]{tasks }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00573                                                                   \{}
\DoxyCodeLine{00574   std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.begin();}
\DoxyCodeLine{00575   \textcolor{keywordflow}{for} (; it != m\_tasks.end(); ++it) \{}
\DoxyCodeLine{00576     \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it-\/>second;}
\DoxyCodeLine{00577     assert(task);}
\DoxyCodeLine{00578     \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}} == parentId) tasks.push\_back(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}});}
\DoxyCodeLine{00579   \}}
\DoxyCodeLine{00580 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a275e0fdb3ab3aaee8503e35a5599a4b7}\label{class_batches_controller_a275e0fdb3ab3aaee8503e35a5599a4b7}} 
\index{BatchesController@{BatchesController}!getTaskStatus@{getTaskStatus}}
\index{getTaskStatus@{getTaskStatus}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTaskStatus()}{getTaskStatus()}}
{\footnotesize\ttfamily Task\+State Batches\+Controller\+::get\+Task\+Status (\begin{DoxyParamCaption}\item[{const QString \&}]{id }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00546                                                                   \{}
\DoxyCodeLine{00547   \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = getTask(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00548   \textcolor{keywordflow}{if} (task)}
\DoxyCodeLine{00549     \textcolor{keywordflow}{return} task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}};}
\DoxyCodeLine{00550   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00551     \textcolor{keywordflow}{return} TaskUnknown;}
\DoxyCodeLine{00552 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_afbf82c21d303ec546d67cf5c39cbafd2}\label{class_batches_controller_afbf82c21d303ec546d67cf5c39cbafd2}} 
\index{BatchesController@{BatchesController}!getTasksTree@{getTasksTree}}
\index{getTasksTree@{getTasksTree}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{getTasksTree()}{getTasksTree()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_task_tree_model}{Task\+Tree\+Model}} $\ast$ Batches\+Controller\+::get\+Tasks\+Tree (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00054 \{ \textcolor{keywordflow}{return} m\_tasksTree; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a2526727f29f49f8fe56b74f5b2aece76}\label{class_batches_controller_a2526727f29f49f8fe56b74f5b2aece76}} 
\index{BatchesController@{BatchesController}!instance@{instance}}
\index{instance@{instance}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_batches_controller}{Batches\+Controller}} $\ast$ Batches\+Controller\+::instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01206                                                \{}
\DoxyCodeLine{01207   \textcolor{keywordflow}{if} (!m\_instance) \{}
\DoxyCodeLine{01208     m\_instance = \textcolor{keyword}{new} \mbox{\hyperlink{class_batches_controller}{BatchesController}};}
\DoxyCodeLine{01209 }
\DoxyCodeLine{01210     \textcolor{comment}{// scandisce un range di porte fino a troverne una libera da utilizzare come}}
\DoxyCodeLine{01211     \textcolor{comment}{// porta del local controller}}
\DoxyCodeLine{01212 }
\DoxyCodeLine{01213     \textcolor{keyword}{const} \textcolor{keywordtype}{int} portRangeSize = 100;}
\DoxyCodeLine{01214 }
\DoxyCodeLine{01215     \textcolor{keywordtype}{int} i          = 0;}
\DoxyCodeLine{01216     \textcolor{keywordtype}{int} portNumber = cPortNumber;}
\DoxyCodeLine{01217     \textcolor{keywordflow}{for} (; i < portRangeSize; ++i, ++portNumber) \{}
\DoxyCodeLine{01218       \textcolor{keywordtype}{bool} portBusy = TFarmStuff::testConnection(\textcolor{stringliteral}{"{}localhost"{}}, portNumber);}
\DoxyCodeLine{01219       \textcolor{keywordflow}{if} (!portBusy) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01220     \}}
\DoxyCodeLine{01221 }
\DoxyCodeLine{01222     \textcolor{keywordflow}{if} (i < portRangeSize) \{}
\DoxyCodeLine{01223       m\_instance-\/>m\_localControllerPortNumber = portNumber;}
\DoxyCodeLine{01224 }
\DoxyCodeLine{01225       \textcolor{comment}{//      static MyLocalControllerController *TheLocalController =}}
\DoxyCodeLine{01226       \textcolor{keyword}{new} MyLocalControllerController(portNumber);}
\DoxyCodeLine{01227     \}}
\DoxyCodeLine{01228   \}}
\DoxyCodeLine{01229   \textcolor{keywordflow}{return} m\_instance;}
\DoxyCodeLine{01230 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_aae6c7b6875e9d20c4f078d30e2052a00}\label{class_batches_controller_aae6c7b6875e9d20c4f078d30e2052a00}} 
\index{BatchesController@{BatchesController}!load@{load}}
\index{load@{load}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily void Batches\+Controller\+::load (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00781                              \{}
\DoxyCodeLine{00782   \textcolor{keyword}{static} \mbox{\hyperlink{class_load_task_list_popup}{LoadTaskListPopup}} *popup = 0;}
\DoxyCodeLine{00783 }
\DoxyCodeLine{00784   \textcolor{keywordflow}{if} (!popup) popup = \textcolor{keyword}{new} \mbox{\hyperlink{class_load_task_list_popup}{LoadTaskListPopup}}();}
\DoxyCodeLine{00785   popup-\/>exec();}
\DoxyCodeLine{00786 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a5d40b3c5326e114dfc0d227897921fac}\label{class_batches_controller_a5d40b3c5326e114dfc0d227897921fac}} 
\index{BatchesController@{BatchesController}!loadTask@{loadTask}}
\index{loadTask@{loadTask}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{loadTask()}{loadTask()}}
{\footnotesize\ttfamily void Batches\+Controller\+::load\+Task (\begin{DoxyParamCaption}\item[{bool}]{is\+Render\+Task }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00789                                                   \{}
\DoxyCodeLine{00790   \textcolor{keyword}{static} \mbox{\hyperlink{class_load_task_popup}{LoadTaskPopup}} *popup = \textcolor{keyword}{new} \mbox{\hyperlink{class_load_task_popup}{LoadTaskPopup}}();}
\DoxyCodeLine{00791   popup-\/>open(isRenderTask);}
\DoxyCodeLine{00792 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_af0c4381ebf25d652679a1870ba9c55a8}\label{class_batches_controller_af0c4381ebf25d652679a1870ba9c55a8}} 
\index{BatchesController@{BatchesController}!notify@{notify}}
\index{notify@{notify}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{notify()}{notify()}}
{\footnotesize\ttfamily void Batches\+Controller\+::notify (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00936                                \{}
\DoxyCodeLine{00937   std::for\_each(m\_observers.begin(), m\_observers.end(), notifyObserver);}
\DoxyCodeLine{00938 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a78297b26c178f7637bd26a80919c93c4}\label{class_batches_controller_a78297b26c178f7637bd26a80919c93c4}} 
\index{BatchesController@{BatchesController}!onExit@{onExit}}
\index{onExit@{onExit}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{onExit}{onExit}}
{\footnotesize\ttfamily void Batches\+Controller\+::on\+Exit (\begin{DoxyParamCaption}\item[{bool \&}]{ret }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00763                                         \{}
\DoxyCodeLine{00764   \textcolor{keywordtype}{int} answer = 0;}
\DoxyCodeLine{00765 }
\DoxyCodeLine{00766   \textcolor{keywordflow}{if} (m\_dirtyFlag)}
\DoxyCodeLine{00767     answer =}
\DoxyCodeLine{00768         DVGui::MsgBox(QString(tr(\textcolor{stringliteral}{"{}The current task list has been modified.\(\backslash\)nDo "{}}}
\DoxyCodeLine{00769                                  \textcolor{stringliteral}{"{}you want to save your changes?"{}})),}
\DoxyCodeLine{00770                       tr(\textcolor{stringliteral}{"{}Save"{}}), tr(\textcolor{stringliteral}{"{}Discard"{}}), tr(\textcolor{stringliteral}{"{}Cancel"{}}), 1);}
\DoxyCodeLine{00771 }
\DoxyCodeLine{00772   ret = \textcolor{keyword}{true};}
\DoxyCodeLine{00773   \textcolor{keywordflow}{if} (answer == 3)}
\DoxyCodeLine{00774     ret = \textcolor{keyword}{false};}
\DoxyCodeLine{00775   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (answer == 1)}
\DoxyCodeLine{00776     save();}
\DoxyCodeLine{00777 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a3dda8208547576d66ea7541a801f888a}\label{class_batches_controller_a3dda8208547576d66ea7541a801f888a}} 
\index{BatchesController@{BatchesController}!removeAllTasks@{removeAllTasks}}
\index{removeAllTasks@{removeAllTasks}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{removeAllTasks()}{removeAllTasks()}}
{\footnotesize\ttfamily void Batches\+Controller\+::remove\+All\+Tasks (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00483                                        \{}
\DoxyCodeLine{00484   std::map<QString, TFarmTask *>::iterator tt, tEnd(m\_tasks.end());}
\DoxyCodeLine{00485   \textcolor{keywordflow}{for} (tt = m\_tasks.begin(); tt != tEnd; ++tt) \{}
\DoxyCodeLine{00486     \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = tt-\/>second;}
\DoxyCodeLine{00487     \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} == Running || task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} == Waiting) \{}
\DoxyCodeLine{00488       DVGui::warning(taskBusyStr().arg(task-\/>\mbox{\hyperlink{class_t_farm_task_a14686e563d198398938fa8a9ed8ffff2}{m\_name}}));}
\DoxyCodeLine{00489       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00490     \}}
\DoxyCodeLine{00491   \}}
\DoxyCodeLine{00492 }
\DoxyCodeLine{00493   m\_filepath = \mbox{\hyperlink{class_t_file_path}{TFilePath}}();}
\DoxyCodeLine{00494   setDirtyFlag(\textcolor{keyword}{false});}
\DoxyCodeLine{00495 }
\DoxyCodeLine{00496   m\_tasks.clear();}
\DoxyCodeLine{00497   notify();}
\DoxyCodeLine{00498 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_ad92494a02d0fde7e4da51cedba78e0bf}\label{class_batches_controller_ad92494a02d0fde7e4da51cedba78e0bf}} 
\index{BatchesController@{BatchesController}!removeTask@{removeTask}}
\index{removeTask@{removeTask}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{removeTask()}{removeTask()}}
{\footnotesize\ttfamily void Batches\+Controller\+::remove\+Task (\begin{DoxyParamCaption}\item[{const QString \&}]{id }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00433                                                     \{}
\DoxyCodeLine{00434   std::map<QString, TFarmTask *>::iterator it = m\_tasks.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00435   \textcolor{keywordflow}{if} (it == m\_tasks.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00436 }
\DoxyCodeLine{00437   \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it-\/>second;}
\DoxyCodeLine{00438   \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} == Running || task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} == Waiting) \{}
\DoxyCodeLine{00439     DVGui::warning(taskBusyStr().arg(task-\/>\mbox{\hyperlink{class_t_farm_task_a14686e563d198398938fa8a9ed8ffff2}{m\_name}}));}
\DoxyCodeLine{00440     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00441   \}}
\DoxyCodeLine{00442 }
\DoxyCodeLine{00443   setDirtyFlag(\textcolor{keyword}{true});}
\DoxyCodeLine{00444 }
\DoxyCodeLine{00445   \textcolor{keywordflow}{if} (!task-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}}.isEmpty()) \{}
\DoxyCodeLine{00446     it                     = m\_tasks.find(task-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}});}
\DoxyCodeLine{00447     \mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *parent = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *\textcolor{keyword}{>}(it-\/>second);}
\DoxyCodeLine{00448     assert(parent);}
\DoxyCodeLine{00449     parent-\/>removeTask(task);}
\DoxyCodeLine{00450   \}}
\DoxyCodeLine{00451 }
\DoxyCodeLine{00452   \mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *taskGroup = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *\textcolor{keyword}{>}(task);}
\DoxyCodeLine{00453   \textcolor{keywordflow}{if} (taskGroup) \{}
\DoxyCodeLine{00454     \textcolor{keywordflow}{if} (m\_controller) \{}
\DoxyCodeLine{00455       \textcolor{comment}{// si sta usando la farm}}
\DoxyCodeLine{00456       std::map<QString, QString>::iterator it = m\_farmIdsTable.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00457       \textcolor{keywordflow}{if} (it != m\_farmIdsTable.end()) \{}
\DoxyCodeLine{00458         m\_controller-\/>suspendTask(it-\/>second);}
\DoxyCodeLine{00459       \}}
\DoxyCodeLine{00460     \}}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462     \textcolor{comment}{// rimuove i subtask}}
\DoxyCodeLine{00463     \textcolor{keywordtype}{int} taskCount = taskGroup-\/>getTaskCount();}
\DoxyCodeLine{00464     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < taskCount; ++i) \{}
\DoxyCodeLine{00465       \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *subTask = taskGroup-\/>getTask(i);}
\DoxyCodeLine{00466       assert(subTask);}
\DoxyCodeLine{00467       m\_tasks.erase(subTask-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}});}
\DoxyCodeLine{00468     \}}
\DoxyCodeLine{00469   \}}
\DoxyCodeLine{00470 }
\DoxyCodeLine{00471   m\_tasks.erase(\textcolor{keywordtype}{id});}
\DoxyCodeLine{00472   \textcolor{keyword}{delete} task;}
\DoxyCodeLine{00473 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_afca4f3611db70966953975898a3d336b}\label{class_batches_controller_afca4f3611db70966953975898a3d336b}} 
\index{BatchesController@{BatchesController}!save@{save}}
\index{save@{save}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily void Batches\+Controller\+::save (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00880                              \{}
\DoxyCodeLine{00881   \textcolor{keywordflow}{if} (m\_filepath.isEmpty())}
\DoxyCodeLine{00882     saveas();}
\DoxyCodeLine{00883   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00884     doSave();}
\DoxyCodeLine{00885 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a2b415b1d1d977be10e0922080575538d}\label{class_batches_controller_a2b415b1d1d977be10e0922080575538d}} 
\index{BatchesController@{BatchesController}!saveas@{saveas}}
\index{saveas@{saveas}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{saveas()}{saveas()}}
{\footnotesize\ttfamily void Batches\+Controller\+::saveas (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00868                                \{}
\DoxyCodeLine{00869   \textcolor{keywordflow}{if} (getTaskCount() == 0) \{}
\DoxyCodeLine{00870     DVGui::warning(tr(\textcolor{stringliteral}{"{}The Task List is empty!"{}}));}
\DoxyCodeLine{00871     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00872   \}}
\DoxyCodeLine{00873 }
\DoxyCodeLine{00874   \textcolor{keyword}{static} \mbox{\hyperlink{class_save_task_list_popup}{SaveTaskListPopup}} *popup = 0;}
\DoxyCodeLine{00875   \textcolor{keywordflow}{if} (!popup) popup               = \textcolor{keyword}{new} \mbox{\hyperlink{class_save_task_list_popup}{SaveTaskListPopup}}();}
\DoxyCodeLine{00876 }
\DoxyCodeLine{00877   popup-\/>exec();}
\DoxyCodeLine{00878 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_ae179d66b33eb3ddc15689ea5cee9695b}\label{class_batches_controller_ae179d66b33eb3ddc15689ea5cee9695b}} 
\index{BatchesController@{BatchesController}!setController@{setController}}
\index{setController@{setController}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{setController()}{setController()}}
{\footnotesize\ttfamily void Batches\+Controller\+::set\+Controller (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_farm_controller}{TFarm\+Controller}} $\ast$}]{controller }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00942                                                                  \{}
\DoxyCodeLine{00943   m\_controller = controller;}
\DoxyCodeLine{00944 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_ac94898c42a31de28e94114dfdb189305}\label{class_batches_controller_ac94898c42a31de28e94114dfdb189305}} 
\index{BatchesController@{BatchesController}!setDirtyFlag@{setDirtyFlag}}
\index{setDirtyFlag@{setDirtyFlag}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{setDirtyFlag()}{setDirtyFlag()}}
{\footnotesize\ttfamily void Batches\+Controller\+::set\+Dirty\+Flag (\begin{DoxyParamCaption}\item[{bool}]{state }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00554                                                \{}
\DoxyCodeLine{00555   \textcolor{keyword}{static} \textcolor{keywordtype}{bool} FirstTime = \textcolor{keyword}{true};}
\DoxyCodeLine{00556 }
\DoxyCodeLine{00557   \textcolor{keywordflow}{if} (FirstTime) \{}
\DoxyCodeLine{00558     FirstTime = \textcolor{keyword}{false};}
\DoxyCodeLine{00559     \textcolor{keywordtype}{bool} ret  = connect(\mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>getMainWindow(), SIGNAL(exit(\textcolor{keywordtype}{bool} \&)),}
\DoxyCodeLine{00560                        SLOT(onExit(\textcolor{keywordtype}{bool} \&)));}
\DoxyCodeLine{00561     assert(ret);}
\DoxyCodeLine{00562   \}}
\DoxyCodeLine{00563 }
\DoxyCodeLine{00564   \textcolor{keywordflow}{if} (state == m\_dirtyFlag) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00565 }
\DoxyCodeLine{00566   m\_dirtyFlag = state;}
\DoxyCodeLine{00567   update();}
\DoxyCodeLine{00568 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_aa4fb1bff8a363a183971890e1dfbfd4b}\label{class_batches_controller_aa4fb1bff8a363a183971890e1dfbfd4b}} 
\index{BatchesController@{BatchesController}!setTasksTree@{setTasksTree}}
\index{setTasksTree@{setTasksTree}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{setTasksTree()}{setTasksTree()}}
{\footnotesize\ttfamily void Batches\+Controller\+::set\+Tasks\+Tree (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_task_tree_model}{Task\+Tree\+Model}} $\ast$}]{tree }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00285                                                         \{}
\DoxyCodeLine{00286   m\_tasksTree = tree;}
\DoxyCodeLine{00287 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a6bb156b170444bb414301052e005c3d8}\label{class_batches_controller_a6bb156b170444bb414301052e005c3d8}} 
\index{BatchesController@{BatchesController}!start@{start}}
\index{start@{start}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{start()}{start()}}
{\footnotesize\ttfamily void Batches\+Controller\+::start (\begin{DoxyParamCaption}\item[{const QString \&}]{task\+Id }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00622                                                    \{}
\DoxyCodeLine{00623   QString computerName = QHostInfo().localHostName();}
\DoxyCodeLine{00624 }
\DoxyCodeLine{00625   std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.find(taskId);}
\DoxyCodeLine{00626   assert(it != m\_tasks.end());}
\DoxyCodeLine{00627   \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it-\/>second;}
\DoxyCodeLine{00628   assert(task);}
\DoxyCodeLine{00629   task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}}      = Waiting;}
\DoxyCodeLine{00630   task-\/>m\_failedSteps = task-\/>m\_successfullSteps = 0;}
\DoxyCodeLine{00631   task-\/>m\_completionDate = task-\/>m\_startDate = QDateTime();}
\DoxyCodeLine{00632   task-\/>\mbox{\hyperlink{class_t_farm_task_a2bc14475ca393f8103b1d73fffd62e8d}{m\_callerMachineName}}                  = computerName;}
\DoxyCodeLine{00633   \textcolor{keywordtype}{int} count                                  = task-\/>getTaskCount();}
\DoxyCodeLine{00634   \textcolor{keywordflow}{if} (count > 1)}
\DoxyCodeLine{00635     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; ++i) \{}
\DoxyCodeLine{00636       \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *subtask = task-\/>getTask(i);}
\DoxyCodeLine{00637       assert(subtask);}
\DoxyCodeLine{00638       subtask-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}}      = Waiting;}
\DoxyCodeLine{00639       subtask-\/>m\_failedSteps = subtask-\/>m\_successfullSteps = 0;}
\DoxyCodeLine{00640       subtask-\/>m\_completionDate = subtask-\/>m\_startDate = QDateTime();}
\DoxyCodeLine{00641       subtask-\/>\mbox{\hyperlink{class_t_farm_task_a2bc14475ca393f8103b1d73fffd62e8d}{m\_callerMachineName}}                     = computerName;}
\DoxyCodeLine{00642     \}}
\DoxyCodeLine{00643 }
\DoxyCodeLine{00644   \textcolor{comment}{// viene usata la farm <==> m\_controller != 0}}
\DoxyCodeLine{00645   \textcolor{keywordflow}{if} (!m\_controller) \{}
\DoxyCodeLine{00646     m\_localExecutor.\mbox{\hyperlink{class_t_thread_1_1_executor_af31c8db8ac72df4c342e7769e95e2135}{addTask}}(\textcolor{keyword}{new} \mbox{\hyperlink{class_task_runner}{TaskRunner}}(task, m\_localControllerPortNumber));}
\DoxyCodeLine{00647   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00648     std::map<QString, QString>::iterator ktor = m\_farmIdsTable.find(taskId);}
\DoxyCodeLine{00649     \textcolor{keywordflow}{if} (ktor != m\_farmIdsTable.end()) \{}
\DoxyCodeLine{00650       QString farmTaskId = ktor-\/>second;}
\DoxyCodeLine{00651       m\_controller-\/>restartTask(farmTaskId);}
\DoxyCodeLine{00652 }
\DoxyCodeLine{00653       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *\textcolor{keyword}{>}(task)) \{}
\DoxyCodeLine{00654         std::vector<QString> subtasks;}
\DoxyCodeLine{00655         m\_controller-\/>getTasks(farmTaskId, subtasks);}
\DoxyCodeLine{00656 }
\DoxyCodeLine{00657         \textcolor{keywordflow}{if} (!subtasks.empty()) \{}
\DoxyCodeLine{00658           assert((\textcolor{keywordtype}{int})subtasks.size() == task-\/>getTaskCount());}
\DoxyCodeLine{00659 }
\DoxyCodeLine{00660           std::vector<QString>::iterator jtor = subtasks.begin();}
\DoxyCodeLine{00661           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < task-\/>getTaskCount(); ++i, ++jtor)}
\DoxyCodeLine{00662             m\_farmIdsTable.insert(}
\DoxyCodeLine{00663                 std::make\_pair(task-\/>getTask(i)-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}}, *jtor));}
\DoxyCodeLine{00664         \}}
\DoxyCodeLine{00665       \}}
\DoxyCodeLine{00666     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00667       \textcolor{keywordtype}{bool} suspended = \textcolor{keyword}{false};}
\DoxyCodeLine{00668       QString \textcolor{keywordtype}{id}     = m\_controller-\/>addTask(*task, suspended);}
\DoxyCodeLine{00669       m\_farmIdsTable.insert(std::make\_pair(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}}, \textcolor{keywordtype}{id}));}
\DoxyCodeLine{00670 }
\DoxyCodeLine{00671       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_farm_task_group}{TFarmTaskGroup}} *\textcolor{keyword}{>}(task)) \{}
\DoxyCodeLine{00672         std::vector<QString> subtasks;}
\DoxyCodeLine{00673         m\_controller-\/>getTasks(\textcolor{keywordtype}{id}, subtasks);}
\DoxyCodeLine{00674         assert((\textcolor{keywordtype}{int})subtasks.size() == task-\/>getTaskCount());}
\DoxyCodeLine{00675 }
\DoxyCodeLine{00676         std::vector<QString>::iterator jtor = subtasks.begin();}
\DoxyCodeLine{00677         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < task-\/>getTaskCount(); ++i, ++jtor)}
\DoxyCodeLine{00678           m\_farmIdsTable.insert(std::make\_pair(task-\/>getTask(i)-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}}, *jtor));}
\DoxyCodeLine{00679       \}}
\DoxyCodeLine{00680     \}}
\DoxyCodeLine{00681   \}}
\DoxyCodeLine{00682   notify();}
\DoxyCodeLine{00683 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_ad7e89a6a6b82ede790b0a78217804dee}\label{class_batches_controller_ad7e89a6a6b82ede790b0a78217804dee}} 
\index{BatchesController@{BatchesController}!startAll@{startAll}}
\index{startAll@{startAll}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{startAll()}{startAll()}}
{\footnotesize\ttfamily void Batches\+Controller\+::start\+All (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00584                                  \{}
\DoxyCodeLine{00585   \textcolor{comment}{// viene usata la farm <==> m\_controller != 0}}
\DoxyCodeLine{00586   \textcolor{keywordflow}{if} (!m\_controller) \{}
\DoxyCodeLine{00587     \textcolor{comment}{// uso una multimap per ordinare rispetto alla priority}}
\DoxyCodeLine{00588     std::multimap<int, TFarmTask *> tasksByPriority;}
\DoxyCodeLine{00589 }
\DoxyCodeLine{00590     std::map<QString, TFarmTask *>::reverse\_iterator it = m\_tasks.rbegin();}
\DoxyCodeLine{00591     \textcolor{comment}{// uso il reverse iterator anche qui altrimenti se ho task con priorita'}}
\DoxyCodeLine{00592     \textcolor{comment}{// uguale li esegue dall'ultimo al primo}}
\DoxyCodeLine{00593     \textcolor{keywordflow}{for} (; it != m\_tasks.rend(); ++it) \{}
\DoxyCodeLine{00594       \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it-\/>second;}
\DoxyCodeLine{00595       tasksByPriority.insert(std::make\_pair(task-\/>\mbox{\hyperlink{class_t_farm_task_a7b0083ed49f8937a93c2de029352995c}{m\_priority}}, task));}
\DoxyCodeLine{00596     \}}
\DoxyCodeLine{00597 }
\DoxyCodeLine{00598     std::multimap<int, TFarmTask *>::reverse\_iterator it2 =}
\DoxyCodeLine{00599         tasksByPriority.rbegin();}
\DoxyCodeLine{00600     \textcolor{keywordflow}{for} (; it2 != tasksByPriority.rend(); ++it2) \{}
\DoxyCodeLine{00601       \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it2-\/>second;}
\DoxyCodeLine{00602       assert(task);}
\DoxyCodeLine{00603       task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} = Waiting;}
\DoxyCodeLine{00604       \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}}.isEmpty())}
\DoxyCodeLine{00605         m\_localExecutor.\mbox{\hyperlink{class_t_thread_1_1_executor_af31c8db8ac72df4c342e7769e95e2135}{addTask}}(}
\DoxyCodeLine{00606             \textcolor{keyword}{new} \mbox{\hyperlink{class_task_runner}{TaskRunner}}(task, m\_localControllerPortNumber));}
\DoxyCodeLine{00607     \}}
\DoxyCodeLine{00608   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00609     std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.begin();}
\DoxyCodeLine{00610     \textcolor{keywordflow}{for} (; it != m\_tasks.end(); ++it) \{}
\DoxyCodeLine{00611       \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it-\/>second;}
\DoxyCodeLine{00612       assert(task);}
\DoxyCodeLine{00613       \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}}.isEmpty()) start(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}});}
\DoxyCodeLine{00614     \}}
\DoxyCodeLine{00615   \}}
\DoxyCodeLine{00616 }
\DoxyCodeLine{00617   notify();}
\DoxyCodeLine{00618 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_afd9928485e42f6fe4914d8cf9386f2d9}\label{class_batches_controller_afd9928485e42f6fe4914d8cf9386f2d9}} 
\index{BatchesController@{BatchesController}!stop@{stop}}
\index{stop@{stop}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily void Batches\+Controller\+::stop (\begin{DoxyParamCaption}\item[{const QString \&}]{task\+Id }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00687                                                   \{}
\DoxyCodeLine{00688   std::map<QString, TFarmTask *>::const\_iterator it = m\_tasks.find(taskId);}
\DoxyCodeLine{00689   \textcolor{keywordflow}{if} (it == m\_tasks.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00690 }
\DoxyCodeLine{00691   \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = it-\/>second;}
\DoxyCodeLine{00692   assert(task);}
\DoxyCodeLine{00693 }
\DoxyCodeLine{00694   \textcolor{comment}{// Update the task status}}
\DoxyCodeLine{00695   \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} == Waiting) task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} = Suspended;}
\DoxyCodeLine{00696 }
\DoxyCodeLine{00697   \textcolor{comment}{// Local farm <==> m\_controller != 0}}
\DoxyCodeLine{00698   \textcolor{keywordflow}{if} (!m\_controller) \{}
\DoxyCodeLine{00699     QMutexLocker sl(\&TasksMutex);}
\DoxyCodeLine{00700     std::map<QString, QProcess *>::iterator it;}
\DoxyCodeLine{00701 }
\DoxyCodeLine{00702     \textcolor{comment}{// Kill the associated process if any}}
\DoxyCodeLine{00703     \textcolor{keywordflow}{if} ((it = RunningTasks.find(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}})) != RunningTasks.end()) \{}
\DoxyCodeLine{00704       it-\/>second-\/>kill();}
\DoxyCodeLine{00705       RunningTasks.erase(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}});}
\DoxyCodeLine{00706     \}}
\DoxyCodeLine{00707 }
\DoxyCodeLine{00708     \textcolor{comment}{// Do the same for child tasks}}
\DoxyCodeLine{00709     \textcolor{keywordtype}{int} count = task-\/>getTaskCount();}
\DoxyCodeLine{00710     \textcolor{keywordflow}{if} (count > 1) \{}
\DoxyCodeLine{00711       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; ++i) \{}
\DoxyCodeLine{00712         \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *subtask                                  = task-\/>getTask(i);}
\DoxyCodeLine{00713         \textcolor{keywordflow}{if} (subtask-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} == Waiting) subtask-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} = Suspended;}
\DoxyCodeLine{00714         \textcolor{keywordflow}{if} ((it = RunningTasks.find(subtask-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}})) != RunningTasks.end()) \{}
\DoxyCodeLine{00715           it-\/>second-\/>kill();}
\DoxyCodeLine{00716           RunningTasks.erase(subtask-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}});}
\DoxyCodeLine{00717         \}}
\DoxyCodeLine{00718       \}}
\DoxyCodeLine{00719     \}}
\DoxyCodeLine{00720   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00721     std::map<QString, QString>::iterator it = m\_farmIdsTable.find(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}});}
\DoxyCodeLine{00722     \textcolor{keywordflow}{if} (it != m\_farmIdsTable.end()) \{}
\DoxyCodeLine{00723       QString farmId = it-\/>second;}
\DoxyCodeLine{00724       m\_controller-\/>suspendTask(farmId);}
\DoxyCodeLine{00725     \}}
\DoxyCodeLine{00726   \}}
\DoxyCodeLine{00727   notify();}
\DoxyCodeLine{00728 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_a795de86a203d8d242d7dae193aee2a9f}\label{class_batches_controller_a795de86a203d8d242d7dae193aee2a9f}} 
\index{BatchesController@{BatchesController}!stopAll@{stopAll}}
\index{stopAll@{stopAll}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{stopAll()}{stopAll()}}
{\footnotesize\ttfamily void Batches\+Controller\+::stop\+All (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00732                                 \{}
\DoxyCodeLine{00733   \textcolor{keywordflow}{if} (!m\_controller) \{}
\DoxyCodeLine{00734     \textcolor{comment}{// Stop all running QProcesses}}
\DoxyCodeLine{00735     QMutexLocker sl(\&TasksMutex);}
\DoxyCodeLine{00736 }
\DoxyCodeLine{00737     std::map<QString, QProcess *>::iterator it;}
\DoxyCodeLine{00738     \textcolor{keywordflow}{for} (it = RunningTasks.begin(); it != RunningTasks.end(); ++it)}
\DoxyCodeLine{00739       it-\/>second-\/>kill();}
\DoxyCodeLine{00740 }
\DoxyCodeLine{00741     RunningTasks.clear();}
\DoxyCodeLine{00742     m\_localExecutor.\mbox{\hyperlink{class_t_thread_1_1_executor_a3ebba69410a233ff1e5774d7e4d1246f}{cancelAll}}();}
\DoxyCodeLine{00743   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00744     \textcolor{comment}{// Suspend all farmIds}}
\DoxyCodeLine{00745     std::map<QString, QString>::iterator it;}
\DoxyCodeLine{00746     \textcolor{keywordflow}{for} (it = m\_farmIdsTable.begin(); it != m\_farmIdsTable.end(); ++it) \{}
\DoxyCodeLine{00747       QString farmId = it-\/>second;}
\DoxyCodeLine{00748       m\_controller-\/>suspendTask(farmId);}
\DoxyCodeLine{00749     \}}
\DoxyCodeLine{00750   \}}
\DoxyCodeLine{00751 }
\DoxyCodeLine{00752   \textcolor{comment}{// Update all waiting task status}}
\DoxyCodeLine{00753   std::map<QString, TFarmTask *>::iterator jt;}
\DoxyCodeLine{00754   \textcolor{keywordflow}{for} (jt = m\_tasks.begin(); jt != m\_tasks.end(); ++jt) \{}
\DoxyCodeLine{00755     \textcolor{keywordflow}{if} (jt-\/>second-\/>m\_status == Waiting) jt-\/>second-\/>m\_status = Suspended;}
\DoxyCodeLine{00756   \}}
\DoxyCodeLine{00757 }
\DoxyCodeLine{00758   notify();}
\DoxyCodeLine{00759 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_batches_controller_ada2ea43207cdc70fe3d165e79d160ef7}\label{class_batches_controller_ada2ea43207cdc70fe3d165e79d160ef7}} 
\index{BatchesController@{BatchesController}!update@{update}}
\index{update@{update}!BatchesController@{BatchesController}}
\doxysubsubsection{\texorpdfstring{update()}{update()}}
{\footnotesize\ttfamily void Batches\+Controller\+::update (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00975                                \{}
\DoxyCodeLine{00976   \textcolor{keywordflow}{if} (m\_controller) \{}
\DoxyCodeLine{00977     \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00978       std::map<QString, QString>::iterator it = m\_farmIdsTable.begin();}
\DoxyCodeLine{00979       \textcolor{keywordflow}{for} (; it != m\_farmIdsTable.end(); ++it) \{}
\DoxyCodeLine{00980         QString farmTaskId    = it-\/>second;}
\DoxyCodeLine{00981         QString batchesTaskId = it-\/>first;}
\DoxyCodeLine{00982 }
\DoxyCodeLine{00983         \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *batchesTask = getTask(batchesTaskId);}
\DoxyCodeLine{00984         \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} farmTask     = *batchesTask;}
\DoxyCodeLine{00985 }
\DoxyCodeLine{00986         \textcolor{keywordflow}{if} (batchesTask) \{}
\DoxyCodeLine{00987           QString batchesTaskParentId = batchesTask-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}};}
\DoxyCodeLine{00988           m\_controller-\/>queryTaskInfo(farmTaskId, farmTask);}
\DoxyCodeLine{00989           \textcolor{keywordtype}{int} chunkSize            = batchesTask-\/>\mbox{\hyperlink{class_t_farm_task_a9ea9d7e43106ac9bcde3a4d47885b4cf}{m\_chunkSize}};}
\DoxyCodeLine{00990           *batchesTask             = farmTask;}
\DoxyCodeLine{00991           batchesTask-\/>\mbox{\hyperlink{class_t_farm_task_a9ea9d7e43106ac9bcde3a4d47885b4cf}{m\_chunkSize}} = chunkSize;}
\DoxyCodeLine{00992           batchesTask-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}}        = batchesTaskId;}
\DoxyCodeLine{00993           batchesTask-\/>\mbox{\hyperlink{class_t_farm_task_a93df061d1b990dc0c8f8149616b3fb0e}{m\_parentId}}  = batchesTaskParentId;}
\DoxyCodeLine{00994         \}}
\DoxyCodeLine{00995       \}}
\DoxyCodeLine{00996     \} \textcolor{keywordflow}{catch} (\mbox{\hyperlink{class_t_exception}{TException}} \&e) \{}
\DoxyCodeLine{00997       ControllerFailureMsg(e).send();}
\DoxyCodeLine{00998     \}}
\DoxyCodeLine{00999   \}}
\DoxyCodeLine{01000 }
\DoxyCodeLine{01001   std::map<QString, TFarmTask *>::iterator jtor = m\_tasks.begin();}
\DoxyCodeLine{01002   \textcolor{keywordflow}{for} (; jtor != m\_tasks.end(); ++jtor) \{}
\DoxyCodeLine{01003     \mbox{\hyperlink{class_t_farm_task}{TFarmTask}} *task = jtor-\/>second;}
\DoxyCodeLine{01004     assert(task);}
\DoxyCodeLine{01005     \textcolor{keywordflow}{if} (task-\/>\mbox{\hyperlink{class_t_farm_task_a2be81cd241bf4cbc9aa039b7183e7c98}{m\_status}} == Completed) m\_farmIdsTable.erase(task-\/>\mbox{\hyperlink{class_t_farm_task_a87ab2a7b7bcb3c5fc19ff3d38f8b93d6}{m\_id}});}
\DoxyCodeLine{01006   \}}
\DoxyCodeLine{01007 }
\DoxyCodeLine{01008   assert(m\_tasksTree);}
\DoxyCodeLine{01009   m\_tasksTree-\/>\mbox{\hyperlink{class_task_tree_model_a233ffc1f04bbeeb77a32924656babe5a}{setupModelData}}();}
\DoxyCodeLine{01010 }
\DoxyCodeLine{01011   notify();}
\DoxyCodeLine{01012 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonz/batches.\+h\item 
E\+:/opentoonz/toonz/sources/toonz/batches.\+cpp\end{DoxyCompactItemize}
