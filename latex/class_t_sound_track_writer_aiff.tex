\hypertarget{class_t_sound_track_writer_aiff}{}\doxysection{TSound\+Track\+Writer\+Aiff Class Reference}
\label{class_t_sound_track_writer_aiff}\index{TSoundTrackWriterAiff@{TSoundTrackWriterAiff}}


{\ttfamily \#include $<$tsio\+\_\+aiff.\+h$>$}

Inheritance diagram for TSound\+Track\+Writer\+Aiff\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_sound_track_writer_aiff}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_sound_track_writer_aiff_af5ca6c089238a4315f53d965ba3c6756}{TSound\+Track\+Writer\+Aiff}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
bool \mbox{\hyperlink{class_t_sound_track_writer_aiff_a1ab730cdbd8a31cd7c64ddd15f76909f}{save}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \&) override
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_sound_track_writer}{TSound\+Track\+Writer}} $\ast$ \mbox{\hyperlink{class_t_sound_track_writer_aiff_a948ab96a67835b404805a7c552fd6ba8}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
The class \mbox{\hyperlink{class_t_sound_track_writer_aiff}{TSound\+Track\+Writer\+Aiff}} writes audio file having .aiff extension 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_sound_track_writer_aiff_af5ca6c089238a4315f53d965ba3c6756}\label{class_t_sound_track_writer_aiff_af5ca6c089238a4315f53d965ba3c6756}} 
\index{TSoundTrackWriterAiff@{TSoundTrackWriterAiff}!TSoundTrackWriterAiff@{TSoundTrackWriterAiff}}
\index{TSoundTrackWriterAiff@{TSoundTrackWriterAiff}!TSoundTrackWriterAiff@{TSoundTrackWriterAiff}}
\doxysubsubsection{\texorpdfstring{TSoundTrackWriterAiff()}{TSoundTrackWriterAiff()}}
{\footnotesize\ttfamily TSound\+Track\+Writer\+Aiff\+::\+TSound\+Track\+Writer\+Aiff (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00455     : \mbox{\hyperlink{class_t_sound_track_writer}{TSoundTrackWriter}}(fp) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_track_writer_aiff_a39688066b12b9fe2c59000795cb0d416}\label{class_t_sound_track_writer_aiff_a39688066b12b9fe2c59000795cb0d416}} 
\index{TSoundTrackWriterAiff@{TSoundTrackWriterAiff}!````~TSoundTrackWriterAiff@{$\sim$TSoundTrackWriterAiff}}
\index{````~TSoundTrackWriterAiff@{$\sim$TSoundTrackWriterAiff}!TSoundTrackWriterAiff@{TSoundTrackWriterAiff}}
\doxysubsubsection{\texorpdfstring{$\sim$TSoundTrackWriterAiff()}{~TSoundTrackWriterAiff()}}
{\footnotesize\ttfamily TSound\+Track\+Writer\+Aiff\+::$\sim$\+TSound\+Track\+Writer\+Aiff (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00041 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_sound_track_writer_aiff_a948ab96a67835b404805a7c552fd6ba8}\label{class_t_sound_track_writer_aiff_a948ab96a67835b404805a7c552fd6ba8}} 
\index{TSoundTrackWriterAiff@{TSoundTrackWriterAiff}!create@{create}}
\index{create@{create}!TSoundTrackWriterAiff@{TSoundTrackWriterAiff}}
\doxysubsubsection{\texorpdfstring{create()}{create()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_sound_track_writer}{TSound\+Track\+Writer}} $\ast$ TSound\+Track\+Writer\+Aiff\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}

Returns a soundtrack writer able to write .aiff audio files 
\begin{DoxyCode}{0}
\DoxyCodeLine{00052                                                         \{}
\DoxyCodeLine{00053     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_writer_aiff}{TSoundTrackWriterAiff}}(fp);}
\DoxyCodeLine{00054   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_track_writer_aiff_a1ab730cdbd8a31cd7c64ddd15f76909f}\label{class_t_sound_track_writer_aiff_a1ab730cdbd8a31cd7c64ddd15f76909f}} 
\index{TSoundTrackWriterAiff@{TSoundTrackWriterAiff}!save@{save}}
\index{save@{save}!TSoundTrackWriterAiff@{TSoundTrackWriterAiff}}
\doxysubsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily bool TSound\+Track\+Writer\+Aiff\+::save (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \&}]{st }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Saves the information of the soundtrack in .aiff audio file whose path has been specified in the constructor. 

Implements \mbox{\hyperlink{class_t_sound_track_writer}{TSound\+Track\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00459                                                        \{}
\DoxyCodeLine{00460   \textcolor{keywordflow}{if} (!st)}
\DoxyCodeLine{00461     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(L\textcolor{stringliteral}{"{}Unable to save the soundtrack: "{}} +}
\DoxyCodeLine{00462                      m\_path.getWideString());}
\DoxyCodeLine{00463 }
\DoxyCodeLine{00464   \mbox{\hyperlink{class_t_smart_pointer_t}{TSoundTrackP}} sndtrack;}
\DoxyCodeLine{00465   \textcolor{keywordflow}{if} (st-\/>getBitPerSample() == 8 \&\& !st-\/>\mbox{\hyperlink{class_t_sound_track_a4c990666e5bd98da0da09eeb5b4f13dd}{isSampleSigned}}())}
\DoxyCodeLine{00466     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(}
\DoxyCodeLine{00467         \textcolor{stringliteral}{"{}The format (8 bit unsigned) is incompatible with AIFF file"{}});}
\DoxyCodeLine{00468   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00469     sndtrack = st;}
\DoxyCodeLine{00470 }
\DoxyCodeLine{00471   TINT32 soundDataCount =}
\DoxyCodeLine{00472       (TINT32)(sndtrack-\/>getSampleCount() * sndtrack-\/>getChannelCount() *}
\DoxyCodeLine{00473                tceil(sndtrack-\/>getBitPerSample() / 8));}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475   TINT32 postHeadData =}
\DoxyCodeLine{00476       AIFF\_NBYTE + COMM\_NBYTE + SSND\_PREDATA\_NBYTE + soundDataCount;}
\DoxyCodeLine{00477 }
\DoxyCodeLine{00478   \mbox{\hyperlink{class_t_file_status}{TFileStatus}} fs(m\_path);}
\DoxyCodeLine{00479   \textcolor{keywordflow}{if} (fs.doesExist() \&\& !fs.isWritable())}
\DoxyCodeLine{00480     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(L\textcolor{stringliteral}{"{}Unable to save the soundtrack: "{}} +}
\DoxyCodeLine{00481                      m\_path.getWideString() + L\textcolor{stringliteral}{"{} is read-\/only"{}});}
\DoxyCodeLine{00482 }
\DoxyCodeLine{00483   \mbox{\hyperlink{class_tofstream}{Tofstream}} os(m\_path);}
\DoxyCodeLine{00484 }
\DoxyCodeLine{00485   \mbox{\hyperlink{class_t_c_o_m_m_chunk}{TCOMMChunk}} commChunk(\textcolor{stringliteral}{"{}COMM"{}}, 18);}
\DoxyCodeLine{00486   commChunk.m\_chans  = sndtrack-\/>getChannelCount();}
\DoxyCodeLine{00487   commChunk.m\_frames = sndtrack-\/>getSampleCount();}
\DoxyCodeLine{00488   commChunk.m\_bitPerSample =}
\DoxyCodeLine{00489       sndtrack-\/>getBitPerSample();  \textcolor{comment}{// assumendo che non ci siano 12 bit}}
\DoxyCodeLine{00490   commChunk.m\_sampleRate = sndtrack-\/>getSampleRate();}
\DoxyCodeLine{00491 }
\DoxyCodeLine{00492   \mbox{\hyperlink{class_t_s_s_n_d_chunk}{TSSNDChunk}} ssndChunk(\textcolor{stringliteral}{"{}SSND"{}}, soundDataCount + OFFSETBLOCSIZE\_NBYTE);}
\DoxyCodeLine{00493   ssndChunk.m\_offset    = DEFAULT\_OFFSET;}
\DoxyCodeLine{00494   ssndChunk.m\_blockSize = DEFAULT\_BLOCKSIZE;}
\DoxyCodeLine{00495 }
\DoxyCodeLine{00496   std::unique\_ptr<UCHAR[]> waveData(\textcolor{keyword}{new} UCHAR[soundDataCount]);}
\DoxyCodeLine{00497 }
\DoxyCodeLine{00498   \textcolor{keywordflow}{if} (TNZ\_LITTLE\_ENDIAN) \{}
\DoxyCodeLine{00499     postHeadData = swapTINT32(postHeadData);}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501     \textcolor{keywordflow}{if} (commChunk.m\_bitPerSample == 16) \{}
\DoxyCodeLine{00502       swapAndCopySamples((\textcolor{keywordtype}{short} *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(),}
\DoxyCodeLine{00503                          (\textcolor{keywordtype}{short} *)waveData.get(),}
\DoxyCodeLine{00504                          (TINT32)(commChunk.m\_frames * commChunk.m\_chans));}
\DoxyCodeLine{00505     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (commChunk.m\_bitPerSample == 24) \{}
\DoxyCodeLine{00506       UCHAR *begin = (UCHAR *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00507       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)commChunk.m\_frames * commChunk.m\_chans; ++i) \{}
\DoxyCodeLine{00508         *(waveData.get() + 3 * i)     = *(begin + 4 * i + 2);}
\DoxyCodeLine{00509         *(waveData.get() + 3 * i + 1) = *(begin + 4 * i + 1);}
\DoxyCodeLine{00510         *(waveData.get() + 3 * i + 2) = *(begin + 4 * i);}
\DoxyCodeLine{00511 }
\DoxyCodeLine{00512         \textcolor{comment}{/*}}
\DoxyCodeLine{00513 \textcolor{comment}{*(waveData + 3*i + 2) = *(begin + 4*i + 3);}}
\DoxyCodeLine{00514 \textcolor{comment}{}}
\DoxyCodeLine{00515 \textcolor{comment}{// posiziona in modo corretto i due byte prima invertiti}}
\DoxyCodeLine{00516 \textcolor{comment}{*(waveData + 3*i) = *(begin + 4*i + 2);}}
\DoxyCodeLine{00517 \textcolor{comment}{*(waveData + 3*i + 1) = *(begin + 4*i + 1);}}
\DoxyCodeLine{00518 \textcolor{comment}{*/}}
\DoxyCodeLine{00519       \}}
\DoxyCodeLine{00520     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00521       memcpy((\textcolor{keywordtype}{void} *)waveData.get(), (\textcolor{keywordtype}{void} *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(),}
\DoxyCodeLine{00522              soundDataCount);}
\DoxyCodeLine{00523   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00524     \textcolor{keywordflow}{if} (commChunk.m\_bitPerSample != 24)}
\DoxyCodeLine{00525       memcpy((\textcolor{keywordtype}{void} *)waveData.get(), (\textcolor{keywordtype}{void} *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(),}
\DoxyCodeLine{00526              soundDataCount);}
\DoxyCodeLine{00527     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00528       UCHAR *begin = (UCHAR *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00529       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)commChunk.m\_frames * commChunk.m\_chans; ++i) \{}
\DoxyCodeLine{00530         *(waveData.get() + 3 * i)     = *(begin + 4 * i + 1);}
\DoxyCodeLine{00531         *(waveData.get() + 3 * i + 1) = *(begin + 4 * i + 2);}
\DoxyCodeLine{00532         *(waveData.get() + 3 * i + 2) = *(begin + 4 * i + 3);}
\DoxyCodeLine{00533       \}}
\DoxyCodeLine{00534     \}}
\DoxyCodeLine{00535   \}}
\DoxyCodeLine{00536 }
\DoxyCodeLine{00537   ssndChunk.m\_waveData = std::move(waveData);}
\DoxyCodeLine{00538 }
\DoxyCodeLine{00539   os.write(\textcolor{stringliteral}{"{}FORM"{}}, 4);}
\DoxyCodeLine{00540   os.write((\textcolor{keywordtype}{char} *)\&postHeadData, \textcolor{keyword}{sizeof}(TINT32));}
\DoxyCodeLine{00541   os.write(\textcolor{stringliteral}{"{}AIFF"{}}, 4);}
\DoxyCodeLine{00542   commChunk.write(os);}
\DoxyCodeLine{00543   ssndChunk.write(os);}
\DoxyCodeLine{00544 }
\DoxyCodeLine{00545   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00546 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00150}{TSound\+Track\+::get\+Raw\+Data()}}, and \mbox{\hyperlink{class_t_sound_track_a4c990666e5bd98da0da09eeb5b4f13dd}{TSound\+Track\+::is\+Sample\+Signed()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/sound/aiff/tsio\+\_\+aiff.\+h\item 
E\+:/opentoonz/toonz/sources/sound/aiff/tsio\+\_\+aiff.\+cpp\end{DoxyCompactItemize}
