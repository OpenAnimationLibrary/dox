\hypertarget{class_drag_selection_tool_1_1_vector_deform_tool}{}\doxysection{Drag\+Selection\+Tool\+::Vector\+Deform\+Tool Class Reference}
\label{class_drag_selection_tool_1_1_vector_deform_tool}\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
Inheritance diagram for Drag\+Selection\+Tool\+::Vector\+Deform\+Tool\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.028986cm]{class_drag_selection_tool_1_1_vector_deform_tool}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_vector_deform_tool_1_1_v_f_d_scoped_block}{VFDScoped\+Block}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_af3f6f0438d6ed303e2411ce5c55c54df}{Vector\+Deform\+Tool}} (\mbox{\hyperlink{class_vector_selection_tool}{Vector\+Selection\+Tool}} $\ast$tool)
\item 
void \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a89255048f0c8e33347bc1e121693b729}{apply\+Transform}} (\mbox{\hyperlink{class_drag_selection_tool_1_1_four_points}{Four\+Points}} bbox, bool on\+Fast\+Dragging=false) override
\item 
void \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a0647976226e172bc08c5feb724446170}{add\+Transform\+Undo}} () override
\item 
void \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a19bb481ad3f2905b81285c48e2678556}{transform\+Whole\+Level}} ()
\item 
bool \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_ae7c6a834c885c4e2d2097858aeac64f5}{is\+Flip}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_acbdd75b6c0d94d3ae109c35dd063f145}{left\+Button\+Drag}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a7567454b9516291a6d0c1371e80016be}{left\+Button\+Up}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a96428b3984d4510af1eb5279b4cf245d}{draw}} () override
\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{class_drag_selection_tool_1_1_undo_change_strokes}{Undo\+Change\+Strokes}} $>$ \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a6a2a849350053fbfca5ff63b3a9aaa79}{m\+\_\+undo}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_af3f6f0438d6ed303e2411ce5c55c54df}\label{class_drag_selection_tool_1_1_vector_deform_tool_af3f6f0438d6ed303e2411ce5c55c54df}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!VectorDeformTool@{VectorDeformTool}}
\index{VectorDeformTool@{VectorDeformTool}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{VectorDeformTool()}{VectorDeformTool()}}
{\footnotesize\ttfamily Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::\+Vector\+Deform\+Tool (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_vector_selection_tool}{Vector\+Selection\+Tool}} $\ast$}]{tool }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00562     : \mbox{\hyperlink{class_drag_selection_tool_1_1_deform_tool}{DeformTool}}(tool), m\_undo() \{}
\DoxyCodeLine{00563   \textcolor{keywordflow}{if} (!TTool::getApplication()-\/>getCurrentObject()-\/>isSpline()) \{}
\DoxyCodeLine{00564     m\_undo.reset(\textcolor{keyword}{new} \mbox{\hyperlink{class_drag_selection_tool_1_1_undo_change_strokes}{UndoChangeStrokes}}(}
\DoxyCodeLine{00565         TTool::getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel(),}
\DoxyCodeLine{00566         tool-\/>\mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}(), tool, tool-\/>strokeSelection()));}
\DoxyCodeLine{00567   \}}
\DoxyCodeLine{00568 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_a71eb10e3c5ccc611934b467dd8a88459}\label{class_drag_selection_tool_1_1_vector_deform_tool_a71eb10e3c5ccc611934b467dd8a88459}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!````~VectorDeformTool@{$\sim$VectorDeformTool}}
\index{````~VectorDeformTool@{$\sim$VectorDeformTool}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{$\sim$VectorDeformTool()}{~VectorDeformTool()}}
{\footnotesize\ttfamily Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::$\sim$\+Vector\+Deform\+Tool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00572                                                      \{}
\DoxyCodeLine{00573   \textcolor{comment}{// DO NOT REMOVE -\/ DESTRUCTS TYPES INCOMPLETE IN THE HEADER}}
\DoxyCodeLine{00574 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_a0647976226e172bc08c5feb724446170}\label{class_drag_selection_tool_1_1_vector_deform_tool_a0647976226e172bc08c5feb724446170}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!addTransformUndo@{addTransformUndo}}
\index{addTransformUndo@{addTransformUndo}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{addTransformUndo()}{addTransformUndo()}}
{\footnotesize\ttfamily void Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::add\+Transform\+Undo (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_drag_selection_tool_1_1_deform_tool}{Drag\+Selection\+Tool\+::\+Deform\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00621                                                          \{}
\DoxyCodeLine{00622   \textcolor{keywordflow}{if} (TTool::getApplication()-\/>getCurrentObject()-\/>isSpline())}
\DoxyCodeLine{00623     TUndoManager::manager()-\/>add(}
\DoxyCodeLine{00624         \textcolor{keyword}{new} \mbox{\hyperlink{class_tool_utils_1_1_undo_path}{UndoPath}}(getTool()}
\DoxyCodeLine{00625                          -\/>getXsheet()}
\DoxyCodeLine{00626                          -\/>getStageObject(getTool()-\/>getObjectId())}
\DoxyCodeLine{00627                          -\/>getSpline()));}
\DoxyCodeLine{00628   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_undo) \{}
\DoxyCodeLine{00629     m\_undo-\/>registerStrokes();}
\DoxyCodeLine{00630     TUndoManager::manager()-\/>add(m\_undo.release());}
\DoxyCodeLine{00631   \}}
\DoxyCodeLine{00632 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_a89255048f0c8e33347bc1e121693b729}\label{class_drag_selection_tool_1_1_vector_deform_tool_a89255048f0c8e33347bc1e121693b729}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!applyTransform@{applyTransform}}
\index{applyTransform@{applyTransform}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{applyTransform()}{applyTransform()}}
{\footnotesize\ttfamily void Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::apply\+Transform (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_drag_selection_tool_1_1_four_points}{Four\+Points}}}]{bbox,  }\item[{bool}]{on\+Fast\+Dragging = {\ttfamily false} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_drag_selection_tool_1_1_deform_tool}{Drag\+Selection\+Tool\+::\+Deform\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00579                                                                               \{}
\DoxyCodeLine{00580   \mbox{\hyperlink{class_selection_tool}{SelectionTool}} *tool = getTool();}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582   std::unique\_ptr<VFDScopedBlock> localVfdScopedBlock;}
\DoxyCodeLine{00583   \textcolor{keywordflow}{if} (!m\_vfdScopedBlock) \{}
\DoxyCodeLine{00584     std::unique\_ptr<VFDScopedBlock> \&vfdScopedBlock =}
\DoxyCodeLine{00585         m\_isDragging ? m\_vfdScopedBlock : localVfdScopedBlock;}
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587     vfdScopedBlock.reset(\textcolor{keyword}{new} VFDScopedBlock(tool));}
\DoxyCodeLine{00588   \}}
\DoxyCodeLine{00589 }
\DoxyCodeLine{00590   \mbox{\hyperlink{class_vector_free_deformer}{VectorFreeDeformer}} *freeDeformer =}
\DoxyCodeLine{00591       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_vector_free_deformer}{VectorFreeDeformer}} *\textcolor{keyword}{>}(tool-\/>getFreeDeformer());}
\DoxyCodeLine{00592 }
\DoxyCodeLine{00593   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} stayedTheSame = bbox.getP00() == freeDeformer-\/>\mbox{\hyperlink{class_vector_free_deformer_a37b664d93857784e204fd9d42c167211}{getPoint}}(0) \&\&}
\DoxyCodeLine{00594                              bbox.getP10() == freeDeformer-\/>\mbox{\hyperlink{class_vector_free_deformer_a37b664d93857784e204fd9d42c167211}{getPoint}}(1) \&\&}
\DoxyCodeLine{00595                              bbox.getP11() == freeDeformer-\/>\mbox{\hyperlink{class_vector_free_deformer_a37b664d93857784e204fd9d42c167211}{getPoint}}(2) \&\&}
\DoxyCodeLine{00596                              bbox.getP01() == freeDeformer-\/>\mbox{\hyperlink{class_vector_free_deformer_a37b664d93857784e204fd9d42c167211}{getPoint}}(3);}
\DoxyCodeLine{00597 }
\DoxyCodeLine{00598   freeDeformer-\/>\mbox{\hyperlink{class_vector_free_deformer_a8d60979a06158c8eb3cb0838b044e97a}{setPoints}}(bbox.getP00(), bbox.getP10(), bbox.getP11(),}
\DoxyCodeLine{00599                           bbox.getP01());}
\DoxyCodeLine{00600   freeDeformer-\/>setComputeRegion(!m\_isDragging);}
\DoxyCodeLine{00601   freeDeformer-\/>setPreserveThickness(tool-\/>isConstantThickness());}
\DoxyCodeLine{00602   freeDeformer-\/>setFlip(isFlip());}
\DoxyCodeLine{00603 }
\DoxyCodeLine{00604   \textcolor{keywordflow}{if} (!TTool::getApplication()-\/>getCurrentObject()-\/>isSpline() \&\& m\_undo)}
\DoxyCodeLine{00605     m\_undo-\/>setFlip(isFlip());}
\DoxyCodeLine{00606 }
\DoxyCodeLine{00607   freeDeformer-\/>deformImage();}
\DoxyCodeLine{00608 }
\DoxyCodeLine{00609   tool-\/>\mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00610 }
\DoxyCodeLine{00611   \textcolor{keywordflow}{if} (!m\_isDragging) tool-\/>\mbox{\hyperlink{class_t_tool_abd1824e9b49705c534e0a773305294c4}{notifyImageChanged}}();}
\DoxyCodeLine{00612 }
\DoxyCodeLine{00613   \textcolor{keywordflow}{if} (!stayedTheSame) tool-\/>m\_deformValues.m\_isSelectionModified = \textcolor{keyword}{true};}
\DoxyCodeLine{00614 }
\DoxyCodeLine{00615   \textcolor{keywordflow}{if} (!m\_isDragging \&\& (tool-\/>isLevelType() || tool-\/>isSelectedFramesType()))}
\DoxyCodeLine{00616     \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a19bb481ad3f2905b81285c48e2678556}{transformWholeLevel}}();}
\DoxyCodeLine{00617 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_a96428b3984d4510af1eb5279b4cf245d}\label{class_drag_selection_tool_1_1_vector_deform_tool_a96428b3984d4510af1eb5279b4cf245d}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!draw@{draw}}
\index{draw@{draw}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::draw (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_drag_selection_tool_1_1_deform_tool}{Drag\+Selection\+Tool\+::\+Deform\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00168 \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_ae7c6a834c885c4e2d2097858aeac64f5}\label{class_drag_selection_tool_1_1_vector_deform_tool_ae7c6a834c885c4e2d2097858aeac64f5}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!isFlip@{isFlip}}
\index{isFlip@{isFlip}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{isFlip()}{isFlip()}}
{\footnotesize\ttfamily bool Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::is\+Flip (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00714                                                \{}
\DoxyCodeLine{00715   \mbox{\hyperlink{class_t_point_t}{TPointD}} scaleValue = getTool()-\/>m\_deformValues.m\_scaleValue;}
\DoxyCodeLine{00716   \textcolor{keywordflow}{return} m\_startScaleValue.x * scaleValue.x < 0 ||}
\DoxyCodeLine{00717          m\_startScaleValue.y * scaleValue.y < 0;}
\DoxyCodeLine{00718 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_acbdd75b6c0d94d3ae109c35dd063f145}\label{class_drag_selection_tool_1_1_vector_deform_tool_acbdd75b6c0d94d3ae109c35dd063f145}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!leftButtonDrag@{leftButtonDrag}}
\index{leftButtonDrag@{leftButtonDrag}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDrag()}{leftButtonDrag()}}
{\footnotesize\ttfamily void Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::left\+Button\+Drag (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_drag_selection_tool_1_1_deform_tool}{Drag\+Selection\+Tool\+::\+Deform\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00164 \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_a7567454b9516291a6d0c1371e80016be}\label{class_drag_selection_tool_1_1_vector_deform_tool_a7567454b9516291a6d0c1371e80016be}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!leftButtonUp@{leftButtonUp}}
\index{leftButtonUp@{leftButtonUp}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{leftButtonUp()}{leftButtonUp()}}
{\footnotesize\ttfamily void Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::left\+Button\+Up (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_drag_selection_tool_1_1_deform_tool}{Drag\+Selection\+Tool\+::\+Deform\+Tool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00723                                                                              \{}
\DoxyCodeLine{00724   std::unique\_ptr<VFDScopedBlock> vfdScopedBlock(std::move(m\_vfdScopedBlock));}
\DoxyCodeLine{00725 }
\DoxyCodeLine{00726   \mbox{\hyperlink{class_selection_tool}{SelectionTool}} *tool = getTool();}
\DoxyCodeLine{00727   \mbox{\hyperlink{class_vector_free_deformer}{VectorFreeDeformer}} *deformer =}
\DoxyCodeLine{00728       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_vector_free_deformer}{VectorFreeDeformer}} *\textcolor{keyword}{>}(tool-\/>getFreeDeformer());}
\DoxyCodeLine{00729   \textcolor{keywordflow}{if} (!deformer) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00730 }
\DoxyCodeLine{00731   deformer-\/>setComputeRegion(\textcolor{keyword}{true});}
\DoxyCodeLine{00732   deformer-\/>setFlip(isFlip());}
\DoxyCodeLine{00733   deformer-\/>deformRegions();}
\DoxyCodeLine{00734 }
\DoxyCodeLine{00735   \textcolor{keywordflow}{if} (!tool-\/>isLevelType() \&\& !tool-\/>isSelectedFramesType())}
\DoxyCodeLine{00736     addTransformUndo();}
\DoxyCodeLine{00737   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00738     \mbox{\hyperlink{class_drag_selection_tool_1_1_vector_deform_tool_a19bb481ad3f2905b81285c48e2678556}{transformWholeLevel}}();}
\DoxyCodeLine{00739 }
\DoxyCodeLine{00740   m\_isDragging = \textcolor{keyword}{false};}
\DoxyCodeLine{00741 }
\DoxyCodeLine{00742   tool-\/>\mbox{\hyperlink{class_t_tool_abd1824e9b49705c534e0a773305294c4}{notifyImageChanged}}();}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00744   \mbox{\hyperlink{class_vector_selection_tool}{VectorSelectionTool}} *selectionTool =}
\DoxyCodeLine{00745       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_vector_selection_tool}{VectorSelectionTool}} *\textcolor{keyword}{>}(m\_tool);}
\DoxyCodeLine{00746   selectionTool-\/>setResetCenter(\textcolor{keyword}{true});}
\DoxyCodeLine{00747 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_a19bb481ad3f2905b81285c48e2678556}\label{class_drag_selection_tool_1_1_vector_deform_tool_a19bb481ad3f2905b81285c48e2678556}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!transformWholeLevel@{transformWholeLevel}}
\index{transformWholeLevel@{transformWholeLevel}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{transformWholeLevel()}{transformWholeLevel()}}
{\footnotesize\ttfamily void Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::transform\+Whole\+Level (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Transform whole level and add undo. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00636                                                             \{}
\DoxyCodeLine{00637   \mbox{\hyperlink{class_vector_selection_tool}{VectorSelectionTool}} *tool = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_vector_selection_tool}{VectorSelectionTool}} *\textcolor{keyword}{>}(m\_tool);}
\DoxyCodeLine{00638   assert(tool);}
\DoxyCodeLine{00639 }
\DoxyCodeLine{00640   assert(!tool-\/>levelSelection().\mbox{\hyperlink{class_level_selection_a264955fde632f3d59330edea8903b3ed}{isEmpty}}());}
\DoxyCodeLine{00641 }
\DoxyCodeLine{00642   \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *level =}
\DoxyCodeLine{00643       TTool::getApplication()-\/>getCurrentLevel()-\/>getSimpleLevel();}
\DoxyCodeLine{00644 }
\DoxyCodeLine{00645   std::vector<TFrameId> fids;}
\DoxyCodeLine{00646   level-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a567daee4ca12a0e92445bcf98a6541f1}{getFids}}(fids);}
\DoxyCodeLine{00647 }
\DoxyCodeLine{00648   \textcolor{comment}{// Remove unwanted fids}}
\DoxyCodeLine{00649   fids.erase(std::remove\_if(}
\DoxyCodeLine{00650                  fids.begin(), fids.end(),}
\DoxyCodeLine{00651                  boost::bind(::currentOrNotSelected, boost::cref(*tool), \_1)),}
\DoxyCodeLine{00652              fids.end());}
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654   TUndoManager::manager()-\/>beginBlock();}
\DoxyCodeLine{00655   \{}
\DoxyCodeLine{00656     addTransformUndo();  \textcolor{comment}{// For current frame}}
\DoxyCodeLine{00657 }
\DoxyCodeLine{00658     \textcolor{keywordtype}{int} f, fCount = int(fids.size());}
\DoxyCodeLine{00659     \textcolor{keywordflow}{for} (f = 0; f != fCount; ++f) \{}
\DoxyCodeLine{00660       \textcolor{keyword}{const} \mbox{\hyperlink{class_t_frame_id}{TFrameId}} \&fid = fids[f];}
\DoxyCodeLine{00661       \textcolor{keywordtype}{int} t               = f + 1;  \textcolor{comment}{// Current frame's data is always at index 0}}
\DoxyCodeLine{00662                                     \textcolor{comment}{// The others are thus shifted by 1}}
\DoxyCodeLine{00663       \textcolor{comment}{// Skip nonselected frames}}
\DoxyCodeLine{00664       \textcolor{keywordflow}{if} (tool-\/>\mbox{\hyperlink{class_t_tool_ae7db6c4288b721fd95f283419883a4b2}{getCurrentFid}}() == fid ||}
\DoxyCodeLine{00665           (tool-\/>isSelectedFramesType() \&\&}
\DoxyCodeLine{00666            tool-\/>getSelectedFrames().count(fid) == 0))}
\DoxyCodeLine{00667         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00668 }
\DoxyCodeLine{00669       \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = level-\/>getFrame(fid, \textcolor{keyword}{true});}
\DoxyCodeLine{00670       \textcolor{keywordflow}{if} (!vi) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00671 }
\DoxyCodeLine{00672       std::unique\_ptr<UndoChangeStrokes> undo(}
\DoxyCodeLine{00673           \textcolor{keyword}{new} \mbox{\hyperlink{class_drag_selection_tool_1_1_undo_change_strokes}{UndoChangeStrokes}}(level, fid, tool, tool-\/>levelSelection()));}
\DoxyCodeLine{00674 }
\DoxyCodeLine{00675       std::set<int> strokesIndices;}
\DoxyCodeLine{00676 }
\DoxyCodeLine{00677       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} s = 0; s < (int)vi-\/>getStrokeCount(); ++s)}
\DoxyCodeLine{00678         strokesIndices.insert(s);}
\DoxyCodeLine{00679 }
\DoxyCodeLine{00680       \mbox{\hyperlink{class_drag_selection_tool_1_1_four_points}{FourPoints}} bbox = tool-\/>getBBox(t);}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682       \mbox{\hyperlink{class_vector_free_deformer}{VectorFreeDeformer}} *freeDeformer =}
\DoxyCodeLine{00683           \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_vector_free_deformer}{VectorFreeDeformer}} *\textcolor{keyword}{>}(tool-\/>getFreeDeformer(t));}
\DoxyCodeLine{00684       freeDeformer-\/>\mbox{\hyperlink{class_vector_free_deformer_a8d60979a06158c8eb3cb0838b044e97a}{setPoints}}(bbox.\mbox{\hyperlink{class_drag_selection_tool_1_1_four_points_a6ee06390172fb31fa17e80273c947f4c}{getPoint}}(0), bbox.\mbox{\hyperlink{class_drag_selection_tool_1_1_four_points_a6ee06390172fb31fa17e80273c947f4c}{getPoint}}(1),}
\DoxyCodeLine{00685                               bbox.\mbox{\hyperlink{class_drag_selection_tool_1_1_four_points_a6ee06390172fb31fa17e80273c947f4c}{getPoint}}(2), bbox.\mbox{\hyperlink{class_drag_selection_tool_1_1_four_points_a6ee06390172fb31fa17e80273c947f4c}{getPoint}}(3));}
\DoxyCodeLine{00686       freeDeformer-\/>setComputeRegion(\textcolor{keyword}{true});}
\DoxyCodeLine{00687       freeDeformer-\/>setPreserveThickness(tool-\/>isConstantThickness());}
\DoxyCodeLine{00688       freeDeformer-\/>setFlip(isFlip());}
\DoxyCodeLine{00689       freeDeformer-\/>deformImage();}
\DoxyCodeLine{00690 }
\DoxyCodeLine{00691       undo-\/>registerStrokes();}
\DoxyCodeLine{00692 }
\DoxyCodeLine{00693       TUndoManager::manager()-\/>add(undo.release());}
\DoxyCodeLine{00694     \}}
\DoxyCodeLine{00695   \}}
\DoxyCodeLine{00696   TUndoManager::manager()-\/>endBlock();}
\DoxyCodeLine{00697 }
\DoxyCodeLine{00698   \textcolor{comment}{// Finally, notify changed frames}}
\DoxyCodeLine{00699   std::for\_each(fids.begin(), fids.end(),}
\DoxyCodeLine{00700                 boost::bind(  \textcolor{comment}{// NOTE: current frame is not here -\/ it should be,}}
\DoxyCodeLine{00701                     \&\mbox{\hyperlink{class_t_tool_abd1824e9b49705c534e0a773305294c4}{TTool::notifyImageChanged}}, m\_tool,}
\DoxyCodeLine{00702                     \_1));  \textcolor{comment}{//       but it's currently unnecessary, in fact...}}
\DoxyCodeLine{00703 }
\DoxyCodeLine{00704   \textcolor{comment}{// notifyImageChanged(fid) must be invoked OUTSIDE of the loop -\/ since it}}
\DoxyCodeLine{00705   \textcolor{comment}{// seems to imply notifyImageChanged()}}
\DoxyCodeLine{00706   \textcolor{comment}{// on CURRENT image -\/ which seems wrong, but it's too low-\/level and I'm not}}
\DoxyCodeLine{00707   \textcolor{comment}{// changing it.}}
\DoxyCodeLine{00708   \textcolor{comment}{// This reasonably leads to computeBBox(), but bboxes are taken as INPUT to}}
\DoxyCodeLine{00709   \textcolor{comment}{// this transformation...            >:(}}
\DoxyCodeLine{00710 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00688}{TTool\+::get\+Current\+Fid()}}, \mbox{\hyperlink{l00448}{TXsh\+Simple\+Level\+::get\+Fids()}}, \mbox{\hyperlink{l00122}{Drag\+Selection\+Tool\+::\+Four\+Points\+::get\+Point()}}, \mbox{\hyperlink{l00124}{Level\+Selection\+::is\+Empty()}}, \mbox{\hyperlink{l00609}{TTool\+::notify\+Image\+Changed()}}, and \mbox{\hyperlink{l00192}{Vector\+Free\+Deformer\+::set\+Points()}}.



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_drag_selection_tool_1_1_vector_deform_tool_a6a2a849350053fbfca5ff63b3a9aaa79}\label{class_drag_selection_tool_1_1_vector_deform_tool_a6a2a849350053fbfca5ff63b3a9aaa79}} 
\index{DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}!m\_undo@{m\_undo}}
\index{m\_undo@{m\_undo}!DragSelectionTool::VectorDeformTool@{DragSelectionTool::VectorDeformTool}}
\doxysubsubsection{\texorpdfstring{m\_undo}{m\_undo}}
{\footnotesize\ttfamily std\+::unique\+\_\+ptr$<$\mbox{\hyperlink{class_drag_selection_tool_1_1_undo_change_strokes}{Undo\+Change\+Strokes}}$>$ Drag\+Selection\+Tool\+::\+Vector\+Deform\+Tool\+::m\+\_\+undo\hspace{0.3cm}{\ttfamily [protected]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnztools/vectorselectiontool.\+h\item 
E\+:/opentoonz/toonz/sources/tnztools/vectorselectiontool.\+cpp\end{DoxyCompactItemize}
