\hypertarget{class_t_image_cache}{}\doxysection{TImage\+Cache Class Reference}
\label{class_t_image_cache}\index{TImageCache@{TImageCache}}


{\ttfamily \#include $<$timagecache.\+h$>$}

\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_image_cache_1_1_imp}{Imp}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
std\+::string \mbox{\hyperlink{class_t_image_cache_ae4fef5421da2d9a31a25efb27b192706}{get\+Unique\+Id}} ()
\item 
void \mbox{\hyperlink{class_t_image_cache_a6a55bc58e3f97d4ec6f3782b5acb704c}{set\+Enabled}} (bool enable)
\item 
bool \mbox{\hyperlink{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}{is\+Enabled}} ()
\begin{DoxyCompactList}\small\item\em Returns true or false whether the cache is active or not. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_t_image_cache_ac40a531e42468563fa695fac90d1e257}{set\+Root\+Dir}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
void \mbox{\hyperlink{class_t_image_cache_a124eae4cf370288f42c22b3477cb5163}{add}} (const std\+::string \&id, const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&img, bool overwrite=true)
\item 
void \mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove}} (const std\+::string \&id)
\begin{DoxyCompactList}\small\item\em Removes from the image cache the image associated to passed id. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_t_image_cache_a4a55f603009d6f1d884f9d1afee94178}{remap}} (const std\+::string \&dst\+Id, const std\+::string \&src\+Id)
\begin{DoxyCompactList}\small\item\em Rebinds the association between a previously cached image and its id. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_t_image_cache_aae960869d6789a4ec8538601ac4efcf7}{remap\+Icons}} (const std\+::string \&dst\+Id, const std\+::string \&src\+Id)
\item 
void \mbox{\hyperlink{class_t_image_cache_a6ad930f92d348ab6231f50b46888c8cf}{clear}} (bool delete\+Folder=false)
\item 
void \mbox{\hyperlink{class_t_image_cache_a6d19207677efac341b81cb84a71924e4}{clear\+Scene\+Images}} ()
\item 
bool \mbox{\hyperlink{class_t_image_cache_aef5ed676d5379c55c232c75f50ce4d0c}{is\+Cached}} (const std\+::string \&id) const
\item 
bool \mbox{\hyperlink{class_t_image_cache_ad339a2d7d4efda3e4c9192f0094cfa2b}{get\+Subsampling}} (const std\+::string \&id, int \&subs) const
\begin{DoxyCompactList}\small\item\em Returns the subsampling level of the image under the specified id. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \mbox{\hyperlink{class_t_image_cache_aea3ac2752efd6fa9689f5a7c1e895e41}{get}} (const std\+::string \&id, bool to\+Be\+Modified) const
\item 
UINT \mbox{\hyperlink{class_t_image_cache_aacf232d4ccaa09192a9eabaac4b22f40}{get\+Mem\+Usage}} () const
\begin{DoxyCompactList}\small\item\em Returns the RAM memory size (KB) occupied by the image cache. \end{DoxyCompactList}\item 
UINT \mbox{\hyperlink{class_t_image_cache_a4aa5545031cb8cc3016107bb26d9739e}{get\+Disk\+Usage}} () const
\item 
UINT \mbox{\hyperlink{class_t_image_cache_a5f6f7327e34bbf60a4aa00ef0718201b}{get\+Uncompressed\+Mem\+Usage}} (const std\+::string \&id) const
\item 
UINT \mbox{\hyperlink{class_t_image_cache_acc521ca28f12b9261b10e2a5c5174db1}{get\+Mem\+Usage}} (const std\+::string \&id) const
\begin{DoxyCompactList}\small\item\em Returns the RAM memory size (KB) of the image associated to passed id. \end{DoxyCompactList}\item 
UINT \mbox{\hyperlink{class_t_image_cache_af6a52551d4b6c4d10183a17cd674b154}{get\+Disk\+Usage}} (const std\+::string \&id) const
\item 
void \mbox{\hyperlink{class_t_image_cache_a515a265a953dbe11d321516835c99ad9}{dump}} (std\+::ostream \&os) const
\item 
UCHAR $\ast$ \mbox{\hyperlink{class_t_image_cache_aa2a3c6b224a17c86f63f65ec21dd63d1}{compress\+And\+Malloc}} (TUINT32 requested\+Size)
\item 
void \mbox{\hyperlink{class_t_image_cache_a60d19e45b309c08d6525f1630fc879ee}{output\+Map}} (UINT chunk\+Requested, std\+::string filename)
\item 
bool \mbox{\hyperlink{class_t_image_cache_aff9cc84974f653e857c54ce9e7fbcd06}{has\+Been\+Modified}} (const std\+::string \&id, bool reset) const
\item 
void \mbox{\hyperlink{class_t_image_cache_a04032caf7189664a8f0719b85f18f7da}{add}} (const QString \&id, const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&img, bool overwrite=true)
\item 
void \mbox{\hyperlink{class_t_image_cache_af23322c9d0ea7231a9d06fc2ddf8f314}{remove}} (const QString \&id)
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \mbox{\hyperlink{class_t_image_cache_a931afcdc1acca8b28bec0c57b3231206}{get}} (const QString \&id, bool to\+Be\+Modified) const
\item 
void \mbox{\hyperlink{class_t_image_cache_a51f6d0d317918c58b109972ce68b3857}{compress}} (const std\+::string \&id)
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_image_cache}{TImage\+Cache}} $\ast$ \mbox{\hyperlink{class_t_image_cache_ac2540f2121531b94a532d7c40bcf3c3b}{instance}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The Image Cache is the global container used throughout Toonz to store images that need to be retrieved at later times.

\mbox{\hyperlink{class_t_image_cache}{TImage\+Cache}} is Toonz\textquotesingle{}s low-\/level manager singleton that deals with image storage. ~\newline
~\newline
 The main task of \mbox{\hyperlink{class_t_image_cache}{TImage\+Cache}} is that of acting as an associative container that maps a name (of std\+::string type) into an image smart pointer. Many-\/to-\/one relationships where multiple names map to the same image {\itshape are} supported. Thus, users can \mbox{\hyperlink{class_t_image_cache_a124eae4cf370288f42c22b3477cb5163}{add()}} an image and \mbox{\hyperlink{class_t_image_cache_aea3ac2752efd6fa9689f5a7c1e895e41}{get()}} it later, until comes the time to \mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove()}} it. ~\newline
~\newline
 An important reason to use \mbox{\hyperlink{class_t_image_cache}{TImage\+Cache}} instead of direct storage of TImageP or TRasterP instances is that it takes care of verifying memory shortages in the process\textquotesingle{} virtual address space, and in case either compresses or ships to disk unreferenced images with last-\/access precedence.

\begin{DoxyWarning}{Warning}
Memory-\/hungry tasks should always use \mbox{\hyperlink{class_t_image_cache}{TImage\+Cache}} to store images, since it prevents abuses of system memory. This is especially true on 32-\/bit OSes. 
\end{DoxyWarning}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_image_cache_a04032caf7189664a8f0719b85f18f7da}\label{class_t_image_cache_a04032caf7189664a8f0719b85f18f7da}} 
\index{TImageCache@{TImageCache}!add@{add}}
\index{add@{add}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{add()}{add()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void TImage\+Cache\+::add (\begin{DoxyParamCaption}\item[{const QString \&}]{id,  }\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&}]{img,  }\item[{bool}]{overwrite = {\ttfamily true} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01952                                                                            \{}
\DoxyCodeLine{01953   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}{isEnabled}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01954   m\_imp-\/>add(\textcolor{keywordtype}{id}.toStdString(), img, overwrite);}
\DoxyCodeLine{01955 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_a124eae4cf370288f42c22b3477cb5163}\label{class_t_image_cache_a124eae4cf370288f42c22b3477cb5163}} 
\index{TImageCache@{TImageCache}!add@{add}}
\index{add@{add}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{add()}{add()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void TImage\+Cache\+::add (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id,  }\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&}]{img,  }\item[{bool}]{overwrite = {\ttfamily true} }\end{DoxyParamCaption})}

Adds the passed image to the cache, under the specified id. The optional {\bfseries{overwrite}} parameter may be specified in case an image with the same id has already been cached. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01154                                       \{}
\DoxyCodeLine{01155   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}{isEnabled}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01156   m\_imp-\/>add(\textcolor{keywordtype}{id}, img, overwrite);}
\DoxyCodeLine{01157 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01111}{is\+Enabled()}}.



Referenced by \mbox{\hyperlink{l01043}{TRop\+::convert\+Raster50to46()}}, \mbox{\hyperlink{l01360}{Preview\+Fx\+Manager\+::freeze()}}, \mbox{\hyperlink{l00310}{Image\+Manager\+::get\+Image()}}, \mbox{\hyperlink{l00123}{CSTPic$<$ P $>$\+::init\+Pic()}}, \mbox{\hyperlink{l02091}{TXsh\+Simple\+Level\+::renumber()}}, \mbox{\hyperlink{l00382}{Movie\+Renderer\+::\+Imp\+::save\+Frame()}}, \mbox{\hyperlink{l00445}{Image\+Manager\+::set\+Image()}}, and \mbox{\hyperlink{l01992}{TCached\+Image\+::set\+Image()}}.

\mbox{\Hypertarget{class_t_image_cache_a6ad930f92d348ab6231f50b46888c8cf}\label{class_t_image_cache_a6ad930f92d348ab6231f50b46888c8cf}} 
\index{TImageCache@{TImageCache}!clear@{clear}}
\index{clear@{clear}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{clear()}{clear()}}
{\footnotesize\ttfamily void TImage\+Cache\+::clear (\begin{DoxyParamCaption}\item[{bool}]{delete\+Folder = {\ttfamily false} }\end{DoxyParamCaption})}

Clears the image cache. After calling this method, every image in the cache is released -\/ and optionally the cache swap folder is deleted. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01375                                          \{}
\DoxyCodeLine{01376   TThread::MutexLocker sl(\&m\_imp-\/>m\_mutex);}
\DoxyCodeLine{01377   m\_imp-\/>m\_uncompressedItems.clear();}
\DoxyCodeLine{01378   m\_imp-\/>m\_itemHistory.clear();}
\DoxyCodeLine{01379   m\_imp-\/>m\_compressedItems.clear();}
\DoxyCodeLine{01380   m\_imp-\/>m\_duplicatedItems.clear();}
\DoxyCodeLine{01381   m\_imp-\/>m\_itemsByImagePointer.clear();}
\DoxyCodeLine{01382   \textcolor{keywordflow}{if} (deleteFolder \&\& m\_imp-\/>m\_rootDir != \mbox{\hyperlink{class_t_file_path}{TFilePath}}())}
\DoxyCodeLine{01383     TSystem::rmDirTree(m\_imp-\/>m\_rootDir);}
\DoxyCodeLine{01384 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_a6d19207677efac341b81cb84a71924e4}\label{class_t_image_cache_a6d19207677efac341b81cb84a71924e4}} 
\index{TImageCache@{TImageCache}!clearSceneImages@{clearSceneImages}}
\index{clearSceneImages@{clearSceneImages}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{clearSceneImages()}{clearSceneImages()}}
{\footnotesize\ttfamily void TImage\+Cache\+::clear\+Scene\+Images (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Clears the image cache of all images which belong to current scene. This spares images (typically file browser icons) which are scene-\/independent. ~\newline
 ~\newline
{\bfseries{}}\{NOTE\+:\} Scene-\/independent images are simply assumed to have the \char`\"{}\$\+:\char`\"{} id prefix. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01388                                    \{}
\DoxyCodeLine{01389   TThread::MutexLocker sl(\&m\_imp-\/>m\_mutex);}
\DoxyCodeLine{01390 }
\DoxyCodeLine{01391   \textcolor{comment}{// note the ';' -\/ which follows ':' in the ascii table}}
\DoxyCodeLine{01392   m\_imp-\/>m\_uncompressedItems.erase(}
\DoxyCodeLine{01393       m\_imp-\/>m\_uncompressedItems.begin(),}
\DoxyCodeLine{01394       m\_imp-\/>m\_uncompressedItems.lower\_bound(\textcolor{stringliteral}{"{}\$:"{}}));}
\DoxyCodeLine{01395   m\_imp-\/>m\_uncompressedItems.erase(m\_imp-\/>m\_uncompressedItems.lower\_bound(\textcolor{stringliteral}{"{}\$;"{}}),}
\DoxyCodeLine{01396                                    m\_imp-\/>m\_uncompressedItems.end());}
\DoxyCodeLine{01397 }
\DoxyCodeLine{01398   m\_imp-\/>m\_compressedItems.erase(m\_imp-\/>m\_compressedItems.begin(),}
\DoxyCodeLine{01399                                  m\_imp-\/>m\_compressedItems.lower\_bound(\textcolor{stringliteral}{"{}\$:"{}}));}
\DoxyCodeLine{01400   m\_imp-\/>m\_compressedItems.erase(m\_imp-\/>m\_compressedItems.lower\_bound(\textcolor{stringliteral}{"{}\$;"{}}),}
\DoxyCodeLine{01401                                  m\_imp-\/>m\_compressedItems.end());}
\DoxyCodeLine{01402 }
\DoxyCodeLine{01403   m\_imp-\/>m\_duplicatedItems.erase(m\_imp-\/>m\_duplicatedItems.begin(),}
\DoxyCodeLine{01404                                  m\_imp-\/>m\_duplicatedItems.lower\_bound(\textcolor{stringliteral}{"{}\$:"{}}));}
\DoxyCodeLine{01405   m\_imp-\/>m\_duplicatedItems.erase(m\_imp-\/>m\_duplicatedItems.lower\_bound(\textcolor{stringliteral}{"{}\$;"{}}),}
\DoxyCodeLine{01406                                  m\_imp-\/>m\_duplicatedItems.end());}
\DoxyCodeLine{01407 }
\DoxyCodeLine{01408   \textcolor{comment}{// Clear maps whose id is on the second of map pairs.}}
\DoxyCodeLine{01409 }
\DoxyCodeLine{01410   std::map<TUINT32, std::string>::iterator it;}
\DoxyCodeLine{01411   \textcolor{keywordflow}{for} (it = m\_imp-\/>m\_itemHistory.begin(); it != m\_imp-\/>m\_itemHistory.end();) \{}
\DoxyCodeLine{01412     \textcolor{keywordflow}{if} (it-\/>second.size() >= 2 \&\& it-\/>second[0] == \textcolor{charliteral}{'\$'} \&\& it-\/>second[1] == \textcolor{charliteral}{':'})}
\DoxyCodeLine{01413       ++it;}
\DoxyCodeLine{01414     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01415       std::map<TUINT32, std::string>::iterator app = it;}
\DoxyCodeLine{01416       app++;}
\DoxyCodeLine{01417       m\_imp-\/>m\_itemHistory.erase(it);}
\DoxyCodeLine{01418       it = app;}
\DoxyCodeLine{01419     \}}
\DoxyCodeLine{01420   \}}
\DoxyCodeLine{01421 }
\DoxyCodeLine{01422   std::map<void *, std::string>::iterator jt;}
\DoxyCodeLine{01423   \textcolor{keywordflow}{for} (jt = m\_imp-\/>m\_itemsByImagePointer.begin();}
\DoxyCodeLine{01424        jt != m\_imp-\/>m\_itemsByImagePointer.end();) \{}
\DoxyCodeLine{01425     \textcolor{keywordflow}{if} (jt-\/>second.size() >= 2 \&\& jt-\/>second[0] == \textcolor{charliteral}{'\$'} \&\& jt-\/>second[1] == \textcolor{charliteral}{':'})}
\DoxyCodeLine{01426       ++jt;}
\DoxyCodeLine{01427     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01428       std::map<void *, std::string>::iterator app = jt;}
\DoxyCodeLine{01429       app++;}
\DoxyCodeLine{01430       m\_imp-\/>m\_itemsByImagePointer.erase(jt);}
\DoxyCodeLine{01431       jt = app;}
\DoxyCodeLine{01432     \}}
\DoxyCodeLine{01433   \}}
\DoxyCodeLine{01434 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00269}{Image\+Manager\+::clear()}}.

\mbox{\Hypertarget{class_t_image_cache_a51f6d0d317918c58b109972ce68b3857}\label{class_t_image_cache_a51f6d0d317918c58b109972ce68b3857}} 
\index{TImageCache@{TImageCache}!compress@{compress}}
\index{compress@{compress}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{compress()}{compress()}}
{\footnotesize\ttfamily void TImage\+Cache\+::compress (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01946 \{ m\_imp-\/>doCompress(\textcolor{keywordtype}{id}); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_aa2a3c6b224a17c86f63f65ec21dd63d1}\label{class_t_image_cache_aa2a3c6b224a17c86f63f65ec21dd63d1}} 
\index{TImageCache@{TImageCache}!compressAndMalloc@{compressAndMalloc}}
\index{compressAndMalloc@{compressAndMalloc}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{compressAndMalloc()}{compressAndMalloc()}}
{\footnotesize\ttfamily UCHAR $\ast$ TImage\+Cache\+::compress\+And\+Malloc (\begin{DoxyParamCaption}\item[{TUINT32}]{requested\+Size }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01147                                                            \{}
\DoxyCodeLine{01148   \textcolor{keywordflow}{return} m\_imp-\/>compressAndMalloc(requestedSize);}
\DoxyCodeLine{01149 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_a515a265a953dbe11d321516835c99ad9}\label{class_t_image_cache_a515a265a953dbe11d321516835c99ad9}} 
\index{TImageCache@{TImageCache}!dump@{dump}}
\index{dump@{dump}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{dump()}{dump()}}
{\footnotesize\ttfamily void TImage\+Cache\+::dump (\begin{DoxyParamCaption}\item[{std\+::ostream \&}]{os }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{01829                                            \{}
\DoxyCodeLine{01830   os << \textcolor{stringliteral}{"{}mem: "{}} << \mbox{\hyperlink{class_t_image_cache_aacf232d4ccaa09192a9eabaac4b22f40}{getMemUsage}}() << std::endl;}
\DoxyCodeLine{01831   std::map<std::string, CacheItemP>::iterator it =}
\DoxyCodeLine{01832       m\_imp-\/>m\_uncompressedItems.begin();}
\DoxyCodeLine{01833   \textcolor{keywordflow}{for} (; it != m\_imp-\/>m\_uncompressedItems.end(); ++it) \{}
\DoxyCodeLine{01834     os << it-\/>first << std::endl;}
\DoxyCodeLine{01835   \}}
\DoxyCodeLine{01836 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_a931afcdc1acca8b28bec0c57b3231206}\label{class_t_image_cache_a931afcdc1acca8b28bec0c57b3231206}} 
\index{TImageCache@{TImageCache}!get@{get}}
\index{get@{get}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{get()}{get()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} TImage\+Cache\+::get (\begin{DoxyParamCaption}\item[{const QString \&}]{id,  }\item[{bool}]{to\+Be\+Modified }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{01963                                                                    \{}
\DoxyCodeLine{01964   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_image_cache_aea3ac2752efd6fa9689f5a7c1e895e41}{get}}(\textcolor{keywordtype}{id}.toStdString(), toBeModified);}
\DoxyCodeLine{01965 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_aea3ac2752efd6fa9689f5a7c1e895e41}\label{class_t_image_cache_aea3ac2752efd6fa9689f5a7c1e895e41}} 
\index{TImageCache@{TImageCache}!get@{get}}
\index{get@{get}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{get()}{get()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} TImage\+Cache\+::get (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id,  }\item[{bool}]{to\+Be\+Modified }\end{DoxyParamCaption}) const}

Retrieves the image associated to input {\bfseries{id}}. Returns an empty pointer if no image was found. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01672                                                                      \{}
\DoxyCodeLine{01673   \textcolor{keywordflow}{return} m\_imp-\/>get(\textcolor{keywordtype}{id}, toBeModified);}
\DoxyCodeLine{01674 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l01002}{Set\+Scan\+Cropbox\+Tool\+::draw()}}, \mbox{\hyperlink{l01360}{Preview\+Fx\+Manager\+::freeze()}}, \mbox{\hyperlink{l00310}{Image\+Manager\+::get\+Image()}}, \mbox{\hyperlink{l01143}{Previewer\+::get\+Raster()}}, \mbox{\hyperlink{l01998}{TCached\+Image\+::image()}}, and \mbox{\hyperlink{l00077}{CSTPic$<$ P $>$\+::lock()}}.

\mbox{\Hypertarget{class_t_image_cache_a4aa5545031cb8cc3016107bb26d9739e}\label{class_t_image_cache_a4aa5545031cb8cc3016107bb26d9739e}} 
\index{TImageCache@{TImageCache}!getDiskUsage@{getDiskUsage}}
\index{getDiskUsage@{getDiskUsage}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{getDiskUsage()}{getDiskUsage()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily UINT TImage\+Cache\+::get\+Disk\+Usage (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}

Returns the swap files size (KB) currently allocated by the image cache. ~\newline
 ~\newline
 {\bfseries{}}\{NOTE\+:\} This function is not implemented yet! 
\begin{DoxyCode}{0}
\DoxyCodeLine{01786 \{ \textcolor{keywordflow}{return} 0; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_af6a52551d4b6c4d10183a17cd674b154}\label{class_t_image_cache_af6a52551d4b6c4d10183a17cd674b154}} 
\index{TImageCache@{TImageCache}!getDiskUsage@{getDiskUsage}}
\index{getDiskUsage@{getDiskUsage}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{getDiskUsage()}{getDiskUsage()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily UINT TImage\+Cache\+::get\+Disk\+Usage (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{01825 \{ \textcolor{keywordflow}{return} 0; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_aacf232d4ccaa09192a9eabaac4b22f40}\label{class_t_image_cache_aacf232d4ccaa09192a9eabaac4b22f40}} 
\index{TImageCache@{TImageCache}!getMemUsage@{getMemUsage}}
\index{getMemUsage@{getMemUsage}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{getMemUsage()}{getMemUsage()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily UINT TImage\+Cache\+::get\+Mem\+Usage (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Returns the RAM memory size (KB) occupied by the image cache. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01772                                     \{}
\DoxyCodeLine{01773   TThread::MutexLocker sl(\&m\_imp-\/>m\_mutex);}
\DoxyCodeLine{01774 }
\DoxyCodeLine{01775   \textcolor{keywordtype}{int} ret = std::accumulate(m\_imp-\/>m\_uncompressedItems.begin(),}
\DoxyCodeLine{01776                             m\_imp-\/>m\_uncompressedItems.end(), 0,}
\DoxyCodeLine{01777                             AccumulateMemUsage());}
\DoxyCodeLine{01778 }
\DoxyCodeLine{01779   \textcolor{keywordflow}{return} ret + std::accumulate(m\_imp-\/>m\_compressedItems.begin(),}
\DoxyCodeLine{01780                                m\_imp-\/>m\_compressedItems.end(), 0,}
\DoxyCodeLine{01781                                AccumulateMemUsage());}
\DoxyCodeLine{01782 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_acc521ca28f12b9261b10e2a5c5174db1}\label{class_t_image_cache_acc521ca28f12b9261b10e2a5c5174db1}} 
\index{TImageCache@{TImageCache}!getMemUsage@{getMemUsage}}
\index{getMemUsage@{getMemUsage}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{getMemUsage()}{getMemUsage()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily UINT TImage\+Cache\+::get\+Mem\+Usage (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id }\end{DoxyParamCaption}) const}



Returns the RAM memory size (KB) of the image associated to passed id. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01790                                                        \{}
\DoxyCodeLine{01791   std::map<std::string, CacheItemP>::iterator it =}
\DoxyCodeLine{01792       m\_imp-\/>m\_uncompressedItems.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01793   \textcolor{keywordflow}{if} (it != m\_imp-\/>m\_uncompressedItems.end()) \textcolor{keywordflow}{return} it-\/>second-\/>getSize();}
\DoxyCodeLine{01794 }
\DoxyCodeLine{01795   it = m\_imp-\/>m\_compressedItems.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01796   \textcolor{keywordflow}{if} (it != m\_imp-\/>m\_compressedItems.end()) \textcolor{keywordflow}{return} it-\/>second-\/>getSize();}
\DoxyCodeLine{01797   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{01798 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_ad339a2d7d4efda3e4c9192f0094cfa2b}\label{class_t_image_cache_ad339a2d7d4efda3e4c9192f0094cfa2b}} 
\index{TImageCache@{TImageCache}!getSubsampling@{getSubsampling}}
\index{getSubsampling@{getSubsampling}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{getSubsampling()}{getSubsampling()}}
{\footnotesize\ttfamily bool TImage\+Cache\+::get\+Subsampling (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id,  }\item[{int \&}]{subs }\end{DoxyParamCaption}) const}



Returns the subsampling level of the image under the specified id. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01592                                                                      \{}
\DoxyCodeLine{01593   TThread::MutexLocker sl(\&m\_imp-\/>m\_mutex);}
\DoxyCodeLine{01594 }
\DoxyCodeLine{01595   std::map<std::string, std::string>::iterator it1;}
\DoxyCodeLine{01596   \textcolor{keywordflow}{if} ((it1 = m\_imp-\/>m\_duplicatedItems.find(\textcolor{keywordtype}{id})) !=}
\DoxyCodeLine{01597       m\_imp-\/>m\_duplicatedItems.end()) \{}
\DoxyCodeLine{01598     assert(m\_imp-\/>m\_duplicatedItems.find(it1-\/>second) ==}
\DoxyCodeLine{01599            m\_imp-\/>m\_duplicatedItems.end());}
\DoxyCodeLine{01600     \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_image_cache_ad339a2d7d4efda3e4c9192f0094cfa2b}{getSubsampling}}(it1-\/>second, subs);}
\DoxyCodeLine{01601   \}}
\DoxyCodeLine{01602 }
\DoxyCodeLine{01603   std::map<std::string, CacheItemP>::iterator it =}
\DoxyCodeLine{01604       m\_imp-\/>m\_uncompressedItems.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01605   \textcolor{keywordflow}{if} (it != m\_imp-\/>m\_uncompressedItems.end()) \{}
\DoxyCodeLine{01606     \mbox{\hyperlink{class_t_derived_smart_pointer_t}{UncompressedOnMemoryCacheItemP}} uncompressed = it-\/>second;}
\DoxyCodeLine{01607     assert(uncompressed);}
\DoxyCodeLine{01608 \textcolor{preprocessor}{\#ifndef TNZCORE\_LIGHT}}
\DoxyCodeLine{01609     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti = uncompressed-\/>getImage()) \{}
\DoxyCodeLine{01610       subs = ti-\/>getSubsampling();}
\DoxyCodeLine{01611       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01612     \}}
\DoxyCodeLine{01613 }
\DoxyCodeLine{01614     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01615 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01616         \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri = uncompressed-\/>getImage()) \{}
\DoxyCodeLine{01617       subs = ri-\/>getSubsampling();}
\DoxyCodeLine{01618       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01619     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{01620       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01621   \}}
\DoxyCodeLine{01622   std::map<std::string, CacheItemP>::iterator itc =}
\DoxyCodeLine{01623       m\_imp-\/>m\_compressedItems.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01624   \textcolor{keywordflow}{if} (itc == m\_imp-\/>m\_compressedItems.end()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01625   \mbox{\hyperlink{class_t_smart_pointer_t}{CacheItemP}} cacheItem = itc-\/>second;}
\DoxyCodeLine{01626   assert(cacheItem-\/>m\_imageInfo);}
\DoxyCodeLine{01627   \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_raster_image_info}{RasterImageInfo}} *rimageInfo =}
\DoxyCodeLine{01628           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_raster_image_info}{RasterImageInfo}} *\textcolor{keyword}{>}(cacheItem-\/>m\_imageInfo)) \{}
\DoxyCodeLine{01629     subs = rimageInfo-\/>m\_subs;}
\DoxyCodeLine{01630     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01631   \}}
\DoxyCodeLine{01632 \textcolor{preprocessor}{\#ifndef TNZCORE\_LIGHT}}
\DoxyCodeLine{01633   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_toonz_image_info}{ToonzImageInfo}} *timageInfo =}
\DoxyCodeLine{01634                \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_toonz_image_info}{ToonzImageInfo}} *\textcolor{keyword}{>}(cacheItem-\/>m\_imageInfo)) \{}
\DoxyCodeLine{01635     subs = timageInfo-\/>m\_subs;}
\DoxyCodeLine{01636     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01637   \}}
\DoxyCodeLine{01638 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01639   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01640     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01641 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01592}{get\+Subsampling()}}.



Referenced by \mbox{\hyperlink{l01592}{get\+Subsampling()}}.

\mbox{\Hypertarget{class_t_image_cache_a5f6f7327e34bbf60a4aa00ef0718201b}\label{class_t_image_cache_a5f6f7327e34bbf60a4aa00ef0718201b}} 
\index{TImageCache@{TImageCache}!getUncompressedMemUsage@{getUncompressedMemUsage}}
\index{getUncompressedMemUsage@{getUncompressedMemUsage}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{getUncompressedMemUsage()}{getUncompressedMemUsage()}}
{\footnotesize\ttfamily UINT TImage\+Cache\+::get\+Uncompressed\+Mem\+Usage (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id }\end{DoxyParamCaption}) const}

Returns the uncompressed image size (in KB) of the image associated with passd id, or 0 if none was found. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01804                                                                    \{}
\DoxyCodeLine{01805   std::map<std::string, CacheItemP>::iterator it =}
\DoxyCodeLine{01806       m\_imp-\/>m\_uncompressedItems.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01807   \textcolor{keywordflow}{if} (it != m\_imp-\/>m\_uncompressedItems.end()) \textcolor{keywordflow}{return} it-\/>second-\/>getSize();}
\DoxyCodeLine{01808 }
\DoxyCodeLine{01809   it = m\_imp-\/>m\_compressedItems.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01810   \textcolor{keywordflow}{if} (it != m\_imp-\/>m\_compressedItems.end()) \textcolor{keywordflow}{return} it-\/>second-\/>getSize();}
\DoxyCodeLine{01811 }
\DoxyCodeLine{01812   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{01813 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_ae4fef5421da2d9a31a25efb27b192706}\label{class_t_image_cache_ae4fef5421da2d9a31a25efb27b192706}} 
\index{TImageCache@{TImageCache}!getUniqueId@{getUniqueId}}
\index{getUniqueId@{getUniqueId}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{getUniqueId()}{getUniqueId()}}
{\footnotesize\ttfamily std\+::string TImage\+Cache\+::get\+Unique\+Id (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00678                                        \{}
\DoxyCodeLine{00679   \textcolor{keyword}{static} \mbox{\hyperlink{class_t_atomic_var}{TAtomicVar}} count;}
\DoxyCodeLine{00680   std::stringstream ss;}
\DoxyCodeLine{00681   ss << ++count;}
\DoxyCodeLine{00682   \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}IMAGECACHEUNIQUEID"{}} + ss.str();}
\DoxyCodeLine{00683 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_aff9cc84974f653e857c54ce9e7fbcd06}\label{class_t_image_cache_aff9cc84974f653e857c54ce9e7fbcd06}} 
\index{TImageCache@{TImageCache}!hasBeenModified@{hasBeenModified}}
\index{hasBeenModified@{hasBeenModified}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{hasBeenModified()}{hasBeenModified()}}
{\footnotesize\ttfamily bool TImage\+Cache\+::has\+Been\+Modified (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id,  }\item[{bool}]{reset }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{01645                                                                        \{}
\DoxyCodeLine{01646   TThread::MutexLocker sl(\&m\_imp-\/>m\_mutex);}
\DoxyCodeLine{01647 }
\DoxyCodeLine{01648   std::map<std::string, std::string>::iterator it;}
\DoxyCodeLine{01649   \textcolor{keywordflow}{if} ((it = m\_imp-\/>m\_duplicatedItems.find(\textcolor{keywordtype}{id})) !=}
\DoxyCodeLine{01650       m\_imp-\/>m\_duplicatedItems.end()) \{}
\DoxyCodeLine{01651     assert(m\_imp-\/>m\_duplicatedItems.find(it-\/>second) ==}
\DoxyCodeLine{01652            m\_imp-\/>m\_duplicatedItems.end());}
\DoxyCodeLine{01653     \textcolor{keywordflow}{return} hasBeenModified(it-\/>second, reset);}
\DoxyCodeLine{01654   \}}
\DoxyCodeLine{01655 }
\DoxyCodeLine{01656   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img;}
\DoxyCodeLine{01657 }
\DoxyCodeLine{01658   std::map<std::string, CacheItemP>::iterator itu =}
\DoxyCodeLine{01659       m\_imp-\/>m\_uncompressedItems.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01660   \textcolor{keywordflow}{if} (itu != m\_imp-\/>m\_uncompressedItems.end()) \{}
\DoxyCodeLine{01661     \textcolor{keywordflow}{if} (reset \&\& itu-\/>second-\/>m\_modified) \{}
\DoxyCodeLine{01662       itu-\/>second-\/>m\_modified = \textcolor{keyword}{false};}
\DoxyCodeLine{01663       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01664     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{01665       \textcolor{keywordflow}{return} itu-\/>second-\/>m\_modified;}
\DoxyCodeLine{01666   \}}
\DoxyCodeLine{01667   \textcolor{keywordflow}{return} \textcolor{keyword}{true};  \textcolor{comment}{// not present in cache==modified (for particle purposes...)}}
\DoxyCodeLine{01668 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_ac2540f2121531b94a532d7c40bcf3c3b}\label{class_t_image_cache_ac2540f2121531b94a532d7c40bcf3c3b}} 
\index{TImageCache@{TImageCache}!instance@{instance}}
\index{instance@{instance}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_image_cache}{TImage\+Cache}} $\ast$ TImage\+Cache\+::instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01065                                    \{}
\DoxyCodeLine{01066   \textcolor{keywordflow}{if} (CacheInstance == 0) CacheInstance = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_image_cache}{TImageCache}}();}
\DoxyCodeLine{01067   \textcolor{keywordflow}{return} CacheInstance;}
\DoxyCodeLine{01068   \textcolor{comment}{/*}}
\DoxyCodeLine{01069 \textcolor{comment}{if (!ImageCache::m\_instance)}}
\DoxyCodeLine{01070 \textcolor{comment}{\{}}
\DoxyCodeLine{01071 \textcolor{comment}{ImageCache::m\_instance = new ImageCache;}}
\DoxyCodeLine{01072 \textcolor{comment}{ImageCache::m\_destroyer.m\_imageCache = ImageCache::m\_instance;}}
\DoxyCodeLine{01073 \textcolor{comment}{\}}}
\DoxyCodeLine{01074 \textcolor{comment}{return ImageCache::m\_instance;}}
\DoxyCodeLine{01075 \textcolor{comment}{  */}}
\DoxyCodeLine{01076 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_aef5ed676d5379c55c232c75f50ce4d0c}\label{class_t_image_cache_aef5ed676d5379c55c232c75f50ce4d0c}} 
\index{TImageCache@{TImageCache}!isCached@{isCached}}
\index{isCached@{isCached}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{isCached()}{isCached()}}
{\footnotesize\ttfamily bool TImage\+Cache\+::is\+Cached (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id }\end{DoxyParamCaption}) const}

Returns true or false whether an image under the passed id is found in the cache. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01438                                                     \{}
\DoxyCodeLine{01439   TThread::MutexLocker sl(\&m\_imp-\/>m\_mutex);}
\DoxyCodeLine{01440   \textcolor{keywordflow}{return} (m\_imp-\/>m\_uncompressedItems.find(\textcolor{keywordtype}{id}) !=}
\DoxyCodeLine{01441               m\_imp-\/>m\_uncompressedItems.end() ||}
\DoxyCodeLine{01442           m\_imp-\/>m\_compressedItems.find(\textcolor{keywordtype}{id}) != m\_imp-\/>m\_compressedItems.end() ||}
\DoxyCodeLine{01443           m\_imp-\/>m\_duplicatedItems.find(\textcolor{keywordtype}{id}) != m\_imp-\/>m\_duplicatedItems.end());}
\DoxyCodeLine{01444 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}\label{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}} 
\index{TImageCache@{TImageCache}!isEnabled@{isEnabled}}
\index{isEnabled@{isEnabled}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{isEnabled()}{isEnabled()}}
{\footnotesize\ttfamily bool TImage\+Cache\+::is\+Enabled (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Returns true or false whether the cache is active or not. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01111                             \{}
\DoxyCodeLine{01112 \textcolor{preprocessor}{\#ifndef TNZCORE\_LIGHT}}
\DoxyCodeLine{01113   QThreadStorage<bool *> \&storage = m\_imp-\/>m\_isEnabled;}
\DoxyCodeLine{01114 }
\DoxyCodeLine{01115   \textcolor{keywordflow}{if} (!storage.hasLocalData()) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01116   \textcolor{keywordflow}{return} *(storage.localData());}
\DoxyCodeLine{01117 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01118   \textcolor{keywordflow}{return} m\_isEnabled;}
\DoxyCodeLine{01119 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01120 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l01153}{add()}}, \mbox{\hyperlink{l00310}{Image\+Manager\+::get\+Image()}}, and \mbox{\hyperlink{l01095}{set\+Enabled()}}.

\mbox{\Hypertarget{class_t_image_cache_a60d19e45b309c08d6525f1630fc879ee}\label{class_t_image_cache_a60d19e45b309c08d6525f1630fc879ee}} 
\index{TImageCache@{TImageCache}!outputMap@{outputMap}}
\index{outputMap@{outputMap}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{outputMap()}{outputMap()}}
{\footnotesize\ttfamily void TImage\+Cache\+::output\+Map (\begin{DoxyParamCaption}\item[{UINT}]{chunk\+Requested,  }\item[{std\+::string}]{filename }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01840                                                                    \{}
\DoxyCodeLine{01841   m\_imp-\/>outputMap(chunkRequested, filename);}
\DoxyCodeLine{01842 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_a4a55f603009d6f1d884f9d1afee94178}\label{class_t_image_cache_a4a55f603009d6f1d884f9d1afee94178}} 
\index{TImageCache@{TImageCache}!remap@{remap}}
\index{remap@{remap}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{remap()}{remap()}}
{\footnotesize\ttfamily void TImage\+Cache\+::remap (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{dst\+Id,  }\item[{const std\+::string \&}]{src\+Id }\end{DoxyParamCaption})}



Rebinds the association between a previously cached image and its id. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01317                                                                       \{}
\DoxyCodeLine{01318   m\_imp-\/>remap(dstId, srcId);}
\DoxyCodeLine{01319 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00237}{Image\+Manager\+::rebind()}}, and \mbox{\hyperlink{l02091}{TXsh\+Simple\+Level\+::renumber()}}.

\mbox{\Hypertarget{class_t_image_cache_aae960869d6789a4ec8538601ac4efcf7}\label{class_t_image_cache_aae960869d6789a4ec8538601ac4efcf7}} 
\index{TImageCache@{TImageCache}!remapIcons@{remapIcons}}
\index{remapIcons@{remapIcons}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{remapIcons()}{remapIcons()}}
{\footnotesize\ttfamily void TImage\+Cache\+::remap\+Icons (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{dst\+Id,  }\item[{const std\+::string \&}]{src\+Id }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01357                                                      \{}
\DoxyCodeLine{01358   std::map<std::string, CacheItemP>::iterator it;}
\DoxyCodeLine{01359   std::map<std::string, std::string> table;}
\DoxyCodeLine{01360   std::string prefix = srcId + \textcolor{stringliteral}{"{}:"{}};}
\DoxyCodeLine{01361   \textcolor{keywordtype}{int} j              = (int)prefix.length();}
\DoxyCodeLine{01362   \textcolor{keywordflow}{for} (it = m\_imp-\/>m\_uncompressedItems.begin();}
\DoxyCodeLine{01363        it != m\_imp-\/>m\_uncompressedItems.end(); ++it) \{}
\DoxyCodeLine{01364     std::string \textcolor{keywordtype}{id}                      = it-\/>first;}
\DoxyCodeLine{01365     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id}.find(prefix) == 0) table[\textcolor{keywordtype}{id}] = dstId + \textcolor{stringliteral}{"{}:"{}} + \textcolor{keywordtype}{id}.substr(j);}
\DoxyCodeLine{01366   \}}
\DoxyCodeLine{01367   \textcolor{keywordflow}{for} (std::map<std::string, std::string>::iterator it2 = table.begin();}
\DoxyCodeLine{01368        it2 != table.end(); ++it2) \{}
\DoxyCodeLine{01369     \mbox{\hyperlink{class_t_image_cache_a4a55f603009d6f1d884f9d1afee94178}{remap}}(it2-\/>second, it2-\/>first);}
\DoxyCodeLine{01370   \}}
\DoxyCodeLine{01371 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_af23322c9d0ea7231a9d06fc2ddf8f314}\label{class_t_image_cache_af23322c9d0ea7231a9d06fc2ddf8f314}} 
\index{TImageCache@{TImageCache}!remove@{remove}}
\index{remove@{remove}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{remove()}{remove()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void TImage\+Cache\+::remove (\begin{DoxyParamCaption}\item[{const QString \&}]{id }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01959 \{ m\_imp-\/>remove(\textcolor{keywordtype}{id}.toStdString()); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}\label{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}} 
\index{TImageCache@{TImageCache}!remove@{remove}}
\index{remove@{remove}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{remove()}{remove()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void TImage\+Cache\+::remove (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{id }\end{DoxyParamCaption})}



Removes from the image cache the image associated to passed id. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01260 \{ m\_imp-\/>remove(\textcolor{keywordtype}{id}); \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00198}{Image\+Manager\+::bind()}}, \mbox{\hyperlink{l00624}{TCache\+Resource\+::clear()}}, \mbox{\hyperlink{l00426}{Image\+Manager\+::invalidate()}}, \mbox{\hyperlink{l00113}{On\+Render\+Completed\+::on\+Deliver()}}, \mbox{\hyperlink{l01119}{TRop\+::release\+Raster46()}}, \mbox{\hyperlink{l00385}{Preview\+Fx\+Instance\+::reset()}}, \mbox{\hyperlink{l00214}{Image\+Manager\+::unbind()}}, and \mbox{\hyperlink{l00031}{TXsh\+Child\+Level\+::$\sim$\+TXsh\+Child\+Level()}}.

\mbox{\Hypertarget{class_t_image_cache_a6a55bc58e3f97d4ec6f3782b5acb704c}\label{class_t_image_cache_a6a55bc58e3f97d4ec6f3782b5acb704c}} 
\index{TImageCache@{TImageCache}!setEnabled@{setEnabled}}
\index{setEnabled@{setEnabled}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{setEnabled()}{setEnabled()}}
{\footnotesize\ttfamily void TImage\+Cache\+::set\+Enabled (\begin{DoxyParamCaption}\item[{bool}]{enable }\end{DoxyParamCaption})}

Enables or disables the image cache on current thread. When the cache is disabled, images can\textquotesingle{}t be added to the cache. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01095                                            \{}
\DoxyCodeLine{01096 \textcolor{preprocessor}{\#ifndef TNZCORE\_LIGHT}}
\DoxyCodeLine{01097   QThreadStorage<bool *> \&storage = m\_imp-\/>m\_isEnabled;}
\DoxyCodeLine{01098 }
\DoxyCodeLine{01099   \textcolor{keywordflow}{if} (storage.hasLocalData() \&\& *(storage.localData()) == \mbox{\hyperlink{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}{isEnabled}}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01100   \textcolor{keywordflow}{if} (!storage.hasLocalData())}
\DoxyCodeLine{01101     storage.setLocalData(\textcolor{keyword}{new} \textcolor{keywordtype}{bool}(\mbox{\hyperlink{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}{isEnabled}}));}
\DoxyCodeLine{01102   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01103     *(storage.localData()) = \mbox{\hyperlink{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}{isEnabled}};}
\DoxyCodeLine{01104 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01105   m\_imp-\/>m\_isEnabled = \mbox{\hyperlink{class_t_image_cache_a0da071a1466b04f8dc49052102d5e933}{isEnabled}};}
\DoxyCodeLine{01106 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01107 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01111}{is\+Enabled()}}.

\mbox{\Hypertarget{class_t_image_cache_ac40a531e42468563fa695fac90d1e257}\label{class_t_image_cache_ac40a531e42468563fa695fac90d1e257}} 
\index{TImageCache@{TImageCache}!setRootDir@{setRootDir}}
\index{setRootDir@{setRootDir}!TImageCache@{TImageCache}}
\doxysubsubsection{\texorpdfstring{setRootDir()}{setRootDir()}}
{\footnotesize\ttfamily void TImage\+Cache\+::set\+Root\+Dir (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}

Sets the hard disk swap directory. It is set by default in the \textbackslash{}it\{stuff\textbackslash{}cache\} folder. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01124                                                       \{}
\DoxyCodeLine{01125   \textcolor{keywordflow}{if} (m\_imp-\/>m\_rootDir != \mbox{\hyperlink{class_t_file_path}{TFilePath}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01126 }
\DoxyCodeLine{01127   m\_imp-\/>m\_rootDir =}
\DoxyCodeLine{01128       cacheDir + \mbox{\hyperlink{class_t_file_path}{TFilePath}}(std::to\_string(TSystem::getProcessId()));}
\DoxyCodeLine{01129 }
\DoxyCodeLine{01130 \textcolor{preprocessor}{\#ifndef TNZCORE\_LIGHT}}
\DoxyCodeLine{01131   \mbox{\hyperlink{class_t_file_status}{TFileStatus}} fs1(m\_imp-\/>m\_rootDir);}
\DoxyCodeLine{01132 }
\DoxyCodeLine{01133   \textcolor{keywordflow}{if} (!fs1.doesExist()) TSystem::mkDir(m\_imp-\/>m\_rootDir);}
\DoxyCodeLine{01134 }
\DoxyCodeLine{01135 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01136 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/timagecache.\+h\item 
E\+:/opentoonz/toonz/sources/common/tcache/timagecache.\+cpp\end{DoxyCompactItemize}
