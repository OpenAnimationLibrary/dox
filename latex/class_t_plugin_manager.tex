\hypertarget{class_t_plugin_manager}{}\doxysection{TPlugin\+Manager Class Reference}
\label{class_t_plugin_manager}\index{TPluginManager@{TPluginManager}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_plugin_manager_1_1_plugin}{Plugin}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_t_plugin_manager_adf91fa792667a70b857a8e3076ec83a2}{is\+Ignored}} (std\+::string name) const
\item 
void \mbox{\hyperlink{class_t_plugin_manager_a79b88750ced21a6b1f25d98d6b2a13ab}{set\+Ignored\+List}} (const std\+::set$<$ std\+::string $>$ \&lst)
\item 
void \mbox{\hyperlink{class_t_plugin_manager_a986b614ce7cdd558cb30481da00f6a9f}{set\+Ignored}} (std\+::string name)
\item 
void \mbox{\hyperlink{class_t_plugin_manager_a8d912377e8615d8f04bc7c10dbd25d16}{load\+Plugin}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
void \mbox{\hyperlink{class_t_plugin_manager_aa4b3fd458070824eba5da1c918e8a222}{load\+Plugins}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&dir)
\item 
void \mbox{\hyperlink{class_t_plugin_manager_af91777041276f26c9d1faf45e305b42f}{load\+Standard\+Plugins}} ()
\item 
void \mbox{\hyperlink{class_t_plugin_manager_a981d758396e9fa19262820b24c3af25a}{unload\+Plugins}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_plugin_manager}{TPlugin\+Manager}} $\ast$ \mbox{\hyperlink{class_t_plugin_manager_ae39dc1d9d271d5a75235f62e924f5938}{instance}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_plugin_manager_a3f27852509fb879f98c60dbda3f1e6f2}\label{class_t_plugin_manager_a3f27852509fb879f98c60dbda3f1e6f2}} 
\index{TPluginManager@{TPluginManager}!````~TPluginManager@{$\sim$TPluginManager}}
\index{````~TPluginManager@{$\sim$TPluginManager}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{$\sim$TPluginManager()}{~TPluginManager()}}
{\footnotesize\ttfamily TPlugin\+Manager\+::$\sim$\+TPlugin\+Manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00075                                 \{}
\DoxyCodeLine{00076   \textcolor{comment}{//   try \{ unloadPlugins(); \} catch(...) \{\}}}
\DoxyCodeLine{00077 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_plugin_manager_ae39dc1d9d271d5a75235f62e924f5938}\label{class_t_plugin_manager_ae39dc1d9d271d5a75235f62e924f5938}} 
\index{TPluginManager@{TPluginManager}!instance@{instance}}
\index{instance@{instance}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_plugin_manager}{TPlugin\+Manager}} $\ast$ TPlugin\+Manager\+::instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00081                                          \{}
\DoxyCodeLine{00082   \textcolor{keyword}{static} \mbox{\hyperlink{class_t_plugin_manager}{TPluginManager}} \_instance;}
\DoxyCodeLine{00083   \textcolor{keywordflow}{return} \&\_instance;}
\DoxyCodeLine{00084 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_plugin_manager_adf91fa792667a70b857a8e3076ec83a2}\label{class_t_plugin_manager_adf91fa792667a70b857a8e3076ec83a2}} 
\index{TPluginManager@{TPluginManager}!isIgnored@{isIgnored}}
\index{isIgnored@{isIgnored}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{isIgnored()}{isIgnored()}}
{\footnotesize\ttfamily bool TPlugin\+Manager\+::is\+Ignored (\begin{DoxyParamCaption}\item[{std\+::string}]{name }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00088                                                    \{}
\DoxyCodeLine{00089   \textcolor{keywordflow}{return} m\_ignoreList.count(toLower(name)) > 0;}
\DoxyCodeLine{00090 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_plugin_manager_a8d912377e8615d8f04bc7c10dbd25d16}\label{class_t_plugin_manager_a8d912377e8615d8f04bc7c10dbd25d16}} 
\index{TPluginManager@{TPluginManager}!loadPlugin@{loadPlugin}}
\index{loadPlugin@{loadPlugin}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{loadPlugin()}{loadPlugin()}}
{\footnotesize\ttfamily void TPlugin\+Manager\+::load\+Plugin (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00112                                                    \{}
\DoxyCodeLine{00113   \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{int})m\_loadedPlugins.count(fp) > 0) \{}
\DoxyCodeLine{00114     TLogger::debug() << \textcolor{stringliteral}{"{}Already loaded "{}} << fp;}
\DoxyCodeLine{00115     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00116   \}}
\DoxyCodeLine{00117   std::string name = fp.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}();}
\DoxyCodeLine{00118   \textcolor{keywordflow}{if} (isIgnored(name)) \{}
\DoxyCodeLine{00119     TLogger::debug() << \textcolor{stringliteral}{"{}Ignored "{}} << fp;}
\DoxyCodeLine{00120     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00121   \}}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123   TLogger::debug() << \textcolor{stringliteral}{"{}Loading "{}} << fp;}
\DoxyCodeLine{00124 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00125   Plugin::Handle handle = LoadLibraryW(fp.getWideString().c\_str());}
\DoxyCodeLine{00126 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00127   Plugin::Handle handle =}
\DoxyCodeLine{00128       dlopen(::to\_string(fp).c\_str(), RTLD\_NOW);  \textcolor{comment}{// RTLD\_LAZY}}
\DoxyCodeLine{00129 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00130   \textcolor{keywordflow}{if} (!handle) \{}
\DoxyCodeLine{00131     \textcolor{comment}{// non riesce a caricare la libreria;}}
\DoxyCodeLine{00132     TLogger::warning() << \textcolor{stringliteral}{"{}Unable to load "{}} << fp;}
\DoxyCodeLine{00133 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00134     std::wstring getFormattedMessage(DWORD lastError);}
\DoxyCodeLine{00135     TLogger::warning() << ::to\_string(getFormattedMessage(GetLastError()));}
\DoxyCodeLine{00136 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00137     TLogger::warning() << dlerror();}
\DoxyCodeLine{00138 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00139   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00140     m\_loadedPlugins.insert(fp);}
\DoxyCodeLine{00141     Plugin *plugin = \textcolor{keyword}{new} Plugin(handle);}
\DoxyCodeLine{00142     m\_pluginTable.push\_back(plugin);}
\DoxyCodeLine{00143     \textcolor{comment}{// cout << "{}loaded"{} << endl;}}
\DoxyCodeLine{00144     TnzLibMainProcType *tnzLibMain = 0;}
\DoxyCodeLine{00145 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00146     tnzLibMain =}
\DoxyCodeLine{00147         (TnzLibMainProcType *)GetProcAddress(handle, TnzLibMainProcName);}
\DoxyCodeLine{00148 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00149     tnzLibMain = (TnzLibMainProcType *)dlsym(handle, TnzLibMainProcName);}
\DoxyCodeLine{00150     \textcolor{keywordflow}{if} (!tnzLibMain)  \textcolor{comment}{// provo \_ come prefisso}}
\DoxyCodeLine{00151       tnzLibMain = (TnzLibMainProcType *)dlsym(handle, TnzLibMainProcName2);}
\DoxyCodeLine{00152 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00153 }
\DoxyCodeLine{00154     \textcolor{keywordflow}{if} (!tnzLibMain) \{}
\DoxyCodeLine{00155       \textcolor{comment}{// La libreria non esporta TLibMain;}}
\DoxyCodeLine{00156       TLogger::warning() << \textcolor{stringliteral}{"{}Corrupted "{}} << fp;}
\DoxyCodeLine{00157 }
\DoxyCodeLine{00158 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00159       FreeLibrary(handle);}
\DoxyCodeLine{00160 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00161       dlclose(handle);}
\DoxyCodeLine{00162 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00163     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00164       \textcolor{keyword}{const} \mbox{\hyperlink{class_t_plugin_info}{TPluginInfo}} *info = tnzLibMain();}
\DoxyCodeLine{00165       \textcolor{keywordflow}{if} (info) plugin-\/>setInfo(*info);}
\DoxyCodeLine{00166     \}}
\DoxyCodeLine{00167   \}}
\DoxyCodeLine{00168 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_plugin_manager_aa4b3fd458070824eba5da1c918e8a222}\label{class_t_plugin_manager_aa4b3fd458070824eba5da1c918e8a222}} 
\index{TPluginManager@{TPluginManager}!loadPlugins@{loadPlugins}}
\index{loadPlugins@{loadPlugins}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{loadPlugins()}{loadPlugins()}}
{\footnotesize\ttfamily void TPlugin\+Manager\+::load\+Plugins (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{dir }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00172                                                      \{}
\DoxyCodeLine{00173 \textcolor{preprocessor}{\#if defined(\_WIN32)}}
\DoxyCodeLine{00174   \textcolor{keyword}{const} std::string extension = \textcolor{stringliteral}{"{}dll"{}};}
\DoxyCodeLine{00175 \textcolor{preprocessor}{\#elif defined(LINUX) || defined(FREEBSD) || defined(\_\_sgi)}}
\DoxyCodeLine{00176   \textcolor{keyword}{const} std::string extension = \textcolor{stringliteral}{"{}so"{}};}
\DoxyCodeLine{00177 \textcolor{preprocessor}{\#elif defined(MACOSX)}}
\DoxyCodeLine{00178   \textcolor{keyword}{const} std::string extension = \textcolor{stringliteral}{"{}dylib"{}};}
\DoxyCodeLine{00179 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181   TFilePathSet dirContent = TSystem::readDirectory(dir, \textcolor{keyword}{false});}
\DoxyCodeLine{00182   \textcolor{keywordflow}{if} (dirContent.empty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00183 }
\DoxyCodeLine{00184   \textcolor{keywordflow}{for} (TFilePathSet::iterator it = dirContent.begin(); it != dirContent.end();}
\DoxyCodeLine{00185        it++) \{}
\DoxyCodeLine{00186     \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp = *it;}
\DoxyCodeLine{00187     \textcolor{keywordflow}{if} (fp.\mbox{\hyperlink{class_t_file_path_aefca624df1a5468a4c78ec6d5dbfae26}{getType}}() != extension) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00188     std::wstring fullpath = fp.getWideString();}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00191 }
\DoxyCodeLine{00192     \textcolor{keywordtype}{bool} isDebugLibrary =}
\DoxyCodeLine{00193         (fullpath.find(L\textcolor{stringliteral}{"{}.d."{}}) == fullpath.size() -\/ (extension.size() + 3));}
\DoxyCodeLine{00194 }
\DoxyCodeLine{00195 \textcolor{preprocessor}{\#ifdef \_DEBUG}}
\DoxyCodeLine{00196     \textcolor{keywordflow}{if} (!isDebugLibrary)}
\DoxyCodeLine{00197 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00198     \textcolor{keywordflow}{if} (isDebugLibrary)}
\DoxyCodeLine{00199 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00200       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00201 }
\DoxyCodeLine{00202 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00203 }
\DoxyCodeLine{00204     \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{00205       loadPlugin(fp);}
\DoxyCodeLine{00206     \} \textcolor{keywordflow}{catch} (...) \{}
\DoxyCodeLine{00207       TLogger::warning() << \textcolor{stringliteral}{"{}unexpected error loading "{}} << fp;}
\DoxyCodeLine{00208     \}}
\DoxyCodeLine{00209   \}}
\DoxyCodeLine{00210 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_plugin_manager_af91777041276f26c9d1faf45e305b42f}\label{class_t_plugin_manager_af91777041276f26c9d1faf45e305b42f}} 
\index{TPluginManager@{TPluginManager}!loadStandardPlugins@{loadStandardPlugins}}
\index{loadStandardPlugins@{loadStandardPlugins}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{loadStandardPlugins()}{loadStandardPlugins()}}
{\footnotesize\ttfamily void TPlugin\+Manager\+::load\+Standard\+Plugins (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00214                                          \{}
\DoxyCodeLine{00215   \mbox{\hyperlink{class_t_file_path}{TFilePath}} pluginsDir = TSystem::getDllDir() + \textcolor{stringliteral}{"{}plugins"{}};}
\DoxyCodeLine{00216 }
\DoxyCodeLine{00217   \textcolor{comment}{// loadPlugins(pluginsDir + "{}io"{});}}
\DoxyCodeLine{00218   loadPlugins(pluginsDir + \textcolor{stringliteral}{"{}fx"{}});}
\DoxyCodeLine{00219 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_plugin_manager_a986b614ce7cdd558cb30481da00f6a9f}\label{class_t_plugin_manager_a986b614ce7cdd558cb30481da00f6a9f}} 
\index{TPluginManager@{TPluginManager}!setIgnored@{setIgnored}}
\index{setIgnored@{setIgnored}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{setIgnored()}{setIgnored()}}
{\footnotesize\ttfamily void TPlugin\+Manager\+::set\+Ignored (\begin{DoxyParamCaption}\item[{std\+::string}]{name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00087                                   \{}
\DoxyCodeLine{00088     std::set<std::string> lst;}
\DoxyCodeLine{00089     lst.insert(name);}
\DoxyCodeLine{00090     setIgnoredList(lst);}
\DoxyCodeLine{00091   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_plugin_manager_a79b88750ced21a6b1f25d98d6b2a13ab}\label{class_t_plugin_manager_a79b88750ced21a6b1f25d98d6b2a13ab}} 
\index{TPluginManager@{TPluginManager}!setIgnoredList@{setIgnoredList}}
\index{setIgnoredList@{setIgnoredList}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{setIgnoredList()}{setIgnoredList()}}
{\footnotesize\ttfamily void TPlugin\+Manager\+::set\+Ignored\+List (\begin{DoxyParamCaption}\item[{const std\+::set$<$ std\+::string $>$ \&}]{lst }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00223                                                                   \{}
\DoxyCodeLine{00224   m\_ignoreList.clear();}
\DoxyCodeLine{00225   \textcolor{keywordflow}{for} (std::set<std::string>::const\_iterator it = names.begin();}
\DoxyCodeLine{00226        it != names.end(); ++it)}
\DoxyCodeLine{00227     m\_ignoreList.insert(toLower(*it));}
\DoxyCodeLine{00228 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_plugin_manager_a981d758396e9fa19262820b24c3af25a}\label{class_t_plugin_manager_a981d758396e9fa19262820b24c3af25a}} 
\index{TPluginManager@{TPluginManager}!unloadPlugins@{unloadPlugins}}
\index{unloadPlugins@{unloadPlugins}!TPluginManager@{TPluginManager}}
\doxysubsubsection{\texorpdfstring{unloadPlugins()}{unloadPlugins()}}
{\footnotesize\ttfamily void TPlugin\+Manager\+::unload\+Plugins (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00094                                    \{}
\DoxyCodeLine{00095   \textcolor{keywordflow}{for} (PluginTable::iterator it = m\_pluginTable.begin();}
\DoxyCodeLine{00096        it != m\_pluginTable.end(); ++it) \{}
\DoxyCodeLine{00097     Plugin::Handle handle = (*it)-\/>getHandle();}
\DoxyCodeLine{00098 \textcolor{preprocessor}{\#if !(defined(LINUX) || defined(FREEBSD))}}
\DoxyCodeLine{00099 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00100     FreeLibrary(handle);}
\DoxyCodeLine{00101 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00102     dlclose(handle);}
\DoxyCodeLine{00103 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00104 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00105     \textcolor{keyword}{delete} (*it);}
\DoxyCodeLine{00106   \}}
\DoxyCodeLine{00107   m\_pluginTable.clear();}
\DoxyCodeLine{00108 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tpluginmanager.\+h\item 
E\+:/opentoonz/toonz/sources/common/tsystem/tpluginmanager.\+cpp\end{DoxyCompactItemize}
