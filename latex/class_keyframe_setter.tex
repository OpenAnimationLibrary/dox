\hypertarget{class_keyframe_setter}{}\doxysection{Keyframe\+Setter Class Reference}
\label{class_keyframe_setter}\index{KeyframeSetter@{KeyframeSetter}}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_keyframe_setter_a55725f845e14ff3c67143534d8062078}{Keyframe\+Setter}} (\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$param, int k\+Index=-\/1, bool enable\+Undo=true)
\item 
\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$ \mbox{\hyperlink{class_keyframe_setter_ab743db719e1b1017a957d061893b12a8}{get\+Curve}} () const
\item 
void \mbox{\hyperlink{class_keyframe_setter_a3e54c3e6c837cd5169dce18177e36a07}{set\+Pixel\+Ratio}} (double pixel\+Ratio)
\item 
double \mbox{\hyperlink{class_keyframe_setter_a664acd6517dafcb648d59b3c972539c3}{get\+Pixel\+Ratio}} () const
\item 
void \mbox{\hyperlink{class_keyframe_setter_a42446e4bb84bfb7dab560fac3f4823c8}{select\+Keyframe}} (int k\+Index)
\item 
int \mbox{\hyperlink{class_keyframe_setter_a0edce0a06bc7ac57aded65429bfa18bb}{create\+Keyframe}} (double frame)
\item 
bool \mbox{\hyperlink{class_keyframe_setter_adfdb7719c037157d3600edb2f6d12ecb}{is\+Selected}} (int index) const
\item 
void \mbox{\hyperlink{class_keyframe_setter_acb8d17dbdf3faeb5b716a1db84ab7cf3}{move\+Keyframes}} (int d\+Frame, double d\+Value)
\item 
bool \mbox{\hyperlink{class_keyframe_setter_ab3d2ddb5d0130b3e3d28e2cfbad7776e}{is\+Speed\+In\+Out}} (int segment\+Index) const
\item 
bool \mbox{\hyperlink{class_keyframe_setter_a93d4180382c326ce2c7f47507316e3f8}{is\+Ease\+In\+Out}} (int segment\+Index) const
\item 
void \mbox{\hyperlink{class_keyframe_setter_acdee1631238f1fc4f88dd82cf7fbb83d}{set\+Type}} (TDouble\+Keyframe\+::\+Type type)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a4aff7752b0bbcd3370398e5347f0d23b}{set\+Type}} (int k\+Index, TDouble\+Keyframe\+::\+Type type)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a61aacefdf34787a9188dbdbbc726e96f}{set\+Step}} (int step)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a03aa77df7abd1830123f625b05d01c58}{set\+Expression}} (std\+::string expression)
\item 
void \mbox{\hyperlink{class_keyframe_setter_af5a7ffc311a9ad73864cea6151af990b}{set\+Similar\+Shape}} (std\+::string expression, double offset)
\item 
void \mbox{\hyperlink{class_keyframe_setter_ac88b1b7cf92edfbc63b32057a702cb24}{set\+File}} (const \mbox{\hyperlink{class_t_double_keyframe_1_1_file_params}{TDouble\+Keyframe\+::\+File\+Params}} \&params)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a54e10292a6066d79ce0ba09a216e7acb}{set\+Unit\+Name}} (std\+::string unit\+Name)
\item 
void \mbox{\hyperlink{class_keyframe_setter_ac04036bf8b34d96c863aee4d7d43aff2}{set\+Value}} (double value)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a805770208818f70de8f3462f025e108d}{link\+Handles}} ()
\item 
void \mbox{\hyperlink{class_keyframe_setter_a80ea737ff58a32565916dcaaa18152f4}{unlink\+Handles}} ()
\item 
void \mbox{\hyperlink{class_keyframe_setter_a2c28f0f5063657b7b3aea29af4d7f266}{set\+Speed\+In}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&speed\+In)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a52589254054b054882732b5a8c65e405}{set\+Speed\+Out}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&speed\+Out)
\item 
void \mbox{\hyperlink{class_keyframe_setter_ae7fb8363eb2ce763d68e835b160f2162}{set\+Ease\+In}} (double ease\+In)
\item 
void \mbox{\hyperlink{class_keyframe_setter_acc416527888f6777ff79d0bd72019e09}{set\+Ease\+Out}} (double ease\+Out)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a0844b9a8d2d5db5b17c71a2beb905efb}{set\+All\+Params}} (int step, TDouble\+Keyframe\+::\+Type combo\+Type, const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&speed\+In, const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&speed\+Out, std\+::string expression\+Text, std\+::string unit\+Name, const \mbox{\hyperlink{class_t_double_keyframe_1_1_file_params}{TDouble\+Keyframe\+::\+File\+Params}} \&file\+Param, double similar\+Shape\+Offset)
\item 
void \mbox{\hyperlink{class_keyframe_setter_a0556314ac12c841f6cf3d0ac3c3a08f7}{add\+Undo}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{class_keyframe_setter_ad72e0a769dd2652bda0e1bda175566b0}{set\+Value}} (\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$curve, double frame, double value)
\item 
static void \mbox{\hyperlink{class_keyframe_setter_a61513803b21ec059b02837d2c487c8f9}{remove\+Keyframe\+At}} (\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$curve, double frame)
\item 
static void \mbox{\hyperlink{class_keyframe_setter_ab35d80d875c4e22ff7713c3fa2321678}{enable\+Cycle}} (\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$curve, bool enabled, \mbox{\hyperlink{class_t_scene_handle}{TScene\+Handle}} $\ast$scene\+Handle=nullptr)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_keyframe_setter_a55725f845e14ff3c67143534d8062078}\label{class_keyframe_setter_a55725f845e14ff3c67143534d8062078}} 
\index{KeyframeSetter@{KeyframeSetter}!KeyframeSetter@{KeyframeSetter}}
\index{KeyframeSetter@{KeyframeSetter}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{KeyframeSetter()}{KeyframeSetter()}}
{\footnotesize\ttfamily Keyframe\+Setter\+::\+Keyframe\+Setter (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$}]{param,  }\item[{int}]{k\+Index = {\ttfamily -\/1},  }\item[{bool}]{enable\+Undo = {\ttfamily true} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00083     : m\_param(param)}
\DoxyCodeLine{00084     , m\_kIndex(-\/1)}
\DoxyCodeLine{00085     , m\_extraDFrame(0)}
\DoxyCodeLine{00086     , m\_enableUndo(enableUndo)}
\DoxyCodeLine{00087     , m\_undo(\textcolor{keyword}{new} \mbox{\hyperlink{class_keyframes_undo}{KeyframesUndo}}(param))}
\DoxyCodeLine{00088     , m\_changed(\textcolor{keyword}{false})}
\DoxyCodeLine{00089     , m\_pixelRatio(1) \{}
\DoxyCodeLine{00090   \textcolor{keywordflow}{if} (kIndex >= 0) selectKeyframe(kIndex);}
\DoxyCodeLine{00091 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_abf288d209b6146e1a5fe5cc0bf29f527}\label{class_keyframe_setter_abf288d209b6146e1a5fe5cc0bf29f527}} 
\index{KeyframeSetter@{KeyframeSetter}!````~KeyframeSetter@{$\sim$KeyframeSetter}}
\index{````~KeyframeSetter@{$\sim$KeyframeSetter}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{$\sim$KeyframeSetter()}{~KeyframeSetter()}}
{\footnotesize\ttfamily Keyframe\+Setter\+::$\sim$\+Keyframe\+Setter (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00093                                 \{}
\DoxyCodeLine{00094   \textcolor{keywordflow}{if} (m\_enableUndo)}
\DoxyCodeLine{00095     addUndo();}
\DoxyCodeLine{00096   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_undo) \{}
\DoxyCodeLine{00097     \textcolor{keyword}{delete} m\_undo;}
\DoxyCodeLine{00098     m\_undo = 0;}
\DoxyCodeLine{00099   \}}
\DoxyCodeLine{00100 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_keyframe_setter_a0556314ac12c841f6cf3d0ac3c3a08f7}\label{class_keyframe_setter_a0556314ac12c841f6cf3d0ac3c3a08f7}} 
\index{KeyframeSetter@{KeyframeSetter}!addUndo@{addUndo}}
\index{addUndo@{addUndo}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{addUndo()}{addUndo()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::add\+Undo (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00102                              \{}
\DoxyCodeLine{00103   \textcolor{keywordflow}{if} (m\_undo) \{}
\DoxyCodeLine{00104     \textcolor{keywordflow}{if} (m\_changed)}
\DoxyCodeLine{00105       TUndoManager::manager()-\/>add(m\_undo);}
\DoxyCodeLine{00106     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00107       \textcolor{keyword}{delete} m\_undo;}
\DoxyCodeLine{00108     m\_undo = 0;}
\DoxyCodeLine{00109   \}}
\DoxyCodeLine{00110 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a0edce0a06bc7ac57aded65429bfa18bb}\label{class_keyframe_setter_a0edce0a06bc7ac57aded65429bfa18bb}} 
\index{KeyframeSetter@{KeyframeSetter}!createKeyframe@{createKeyframe}}
\index{createKeyframe@{createKeyframe}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{createKeyframe()}{createKeyframe()}}
{\footnotesize\ttfamily int Keyframe\+Setter\+::create\+Keyframe (\begin{DoxyParamCaption}\item[{double}]{frame }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00122                                                \{}
\DoxyCodeLine{00123   \textcolor{comment}{/*-\/-\/-\/ すでにそこにキーフレームがある場合はそのIndexを返すだけ -\/-\/-\/*/}}
\DoxyCodeLine{00124   \textcolor{keywordtype}{int} kIndex = m\_param-\/>getClosestKeyframe(frame);}
\DoxyCodeLine{00125   \textcolor{keywordflow}{if} (kIndex >= 0 \&\& m\_param-\/>getKeyframe(kIndex).m\_frame == frame) \{}
\DoxyCodeLine{00126     selectKeyframe(kIndex);}
\DoxyCodeLine{00127     \textcolor{keywordflow}{return} kIndex;}
\DoxyCodeLine{00128   \}}
\DoxyCodeLine{00129   m\_changed = \textcolor{keyword}{true};}
\DoxyCodeLine{00130   kIndex    = m\_undo-\/>createKeyframe(frame);}
\DoxyCodeLine{00131   m\_indices.insert(kIndex);}
\DoxyCodeLine{00132   m\_kIndex   = kIndex;}
\DoxyCodeLine{00133   m\_keyframe = m\_param-\/>getKeyframe(m\_kIndex);}
\DoxyCodeLine{00134 }
\DoxyCodeLine{00135   setStep(Preferences::instance()-\/>getAnimationStep());}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137   \textcolor{keywordtype}{int} kCount = m\_param-\/>getKeyframeCount();}
\DoxyCodeLine{00138   \textcolor{keywordflow}{if} (kCount <= 1) \{}
\DoxyCodeLine{00139     \textcolor{comment}{// a single keyframe created in a empty curve}}
\DoxyCodeLine{00140   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (kCount == 2) \{}
\DoxyCodeLine{00141     \textcolor{comment}{// two keyframes => a linear segment}}
\DoxyCodeLine{00142     TDoubleKeyframe::Type type =}
\DoxyCodeLine{00143         TDoubleKeyframe::Type(Preferences::instance()-\/>getKeyframeType());}
\DoxyCodeLine{00144     setType(0, type);}
\DoxyCodeLine{00145   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00146     \textcolor{comment}{// there are at least other two keyframes (and therefore at least a segment)}}
\DoxyCodeLine{00147     \textcolor{keywordflow}{if} (m\_kIndex == 0) \{}
\DoxyCodeLine{00148       \textcolor{comment}{// a new segment added before the others. use the preference value}}
\DoxyCodeLine{00149       setType(}
\DoxyCodeLine{00150           TDoubleKeyframe::Type(Preferences::instance()-\/>getKeyframeType()));}
\DoxyCodeLine{00151     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_kIndex == kCount -\/ 1) \{}
\DoxyCodeLine{00152       \textcolor{comment}{// a new segment added after the others. use the preference value too}}
\DoxyCodeLine{00153       setType(m\_kIndex -\/ 1, TDoubleKeyframe::Type(}
\DoxyCodeLine{00154                                 Preferences::instance()-\/>getKeyframeType()));}
\DoxyCodeLine{00155     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00156       \textcolor{comment}{// a new point in a segment}}
\DoxyCodeLine{00157       \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} ka                = m\_param-\/>getKeyframe(m\_kIndex -\/ 1);}
\DoxyCodeLine{00158       \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} kb                = m\_param-\/>getKeyframe(m\_kIndex + 1);}
\DoxyCodeLine{00159       TDoubleKeyframe::Type segmentType = ka.m\_type;}
\DoxyCodeLine{00160       m\_keyframe.m\_type                 = ka.m\_type;}
\DoxyCodeLine{00161       m\_keyframe.m\_step = ka.m\_step;  \textcolor{comment}{// An existing segment step should prevail}}
\DoxyCodeLine{00162                                       \textcolor{comment}{// over the preference}}
\DoxyCodeLine{00163 }
\DoxyCodeLine{00164       \textcolor{comment}{/*-\/-\/-\/Segment内にKeyを打った場合は、Step値も元のSegmentの値を引き継ぐようにする-\/-\/-\/*/}}
\DoxyCodeLine{00165       m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00166 }
\DoxyCodeLine{00167       \textcolor{keywordflow}{if} (segmentType == TDoubleKeyframe::SpeedInOut ||}
\DoxyCodeLine{00168           segmentType == TDoubleKeyframe::EaseInOut ||}
\DoxyCodeLine{00169           segmentType == TDoubleKeyframe::EaseInOutPercentage) \{}
\DoxyCodeLine{00170         std::map<int, TDoubleKeyframe> keyframes;}
\DoxyCodeLine{00171         \textcolor{keywordflow}{if} (segmentType == TDoubleKeyframe::SpeedInOut) \{}
\DoxyCodeLine{00172           splitSpeedInOutSegment(m\_keyframe, ka, kb);}
\DoxyCodeLine{00173         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (segmentType == TDoubleKeyframe::EaseInOut) \{}
\DoxyCodeLine{00174           m\_keyframe.m\_speedIn = m\_keyframe.m\_speedOut = \mbox{\hyperlink{class_t_point_t}{TPointD}}();}
\DoxyCodeLine{00175           \textcolor{keywordflow}{if} (ka.m\_frame + ka.m\_speedOut.x > m\_keyframe.m\_frame)}
\DoxyCodeLine{00176             ka.m\_speedOut.x = m\_keyframe.m\_frame -\/ ka.m\_frame;}
\DoxyCodeLine{00177           \textcolor{keywordflow}{if} (kb.m\_frame + kb.m\_speedIn.x < m\_keyframe.m\_frame)}
\DoxyCodeLine{00178             ka.m\_speedIn.x = m\_keyframe.m\_frame -\/ kb.m\_frame;}
\DoxyCodeLine{00179         \} \textcolor{keywordflow}{else}  \textcolor{comment}{// easeinpercentage}}
\DoxyCodeLine{00180         \{}
\DoxyCodeLine{00181           m\_keyframe.m\_speedIn = m\_keyframe.m\_speedOut = \mbox{\hyperlink{class_t_point_t}{TPointD}}();}
\DoxyCodeLine{00182           \textcolor{keywordtype}{double} segmentWidth = kb.m\_frame -\/ ka.m\_frame;}
\DoxyCodeLine{00183         \}}
\DoxyCodeLine{00184         keyframes[m\_kIndex -\/ 1] = ka;}
\DoxyCodeLine{00185         keyframes[m\_kIndex]     = m\_keyframe;}
\DoxyCodeLine{00186         keyframes[m\_kIndex + 1] = kb;}
\DoxyCodeLine{00187         m\_undo-\/>addKeyframe(m\_kIndex -\/ 1);}
\DoxyCodeLine{00188         m\_undo-\/>addKeyframe(m\_kIndex + 1);}
\DoxyCodeLine{00189         m\_param-\/>setKeyframes(keyframes);}
\DoxyCodeLine{00190       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (segmentType == TDoubleKeyframe::Expression ||}
\DoxyCodeLine{00191                  segmentType == TDoubleKeyframe::SimilarShape) \{}
\DoxyCodeLine{00192         std::string expressionText = ka.m\_expressionText;}
\DoxyCodeLine{00193 }
\DoxyCodeLine{00194         setExpression(expressionText);}
\DoxyCodeLine{00195         setType(ka.m\_type);}
\DoxyCodeLine{00196       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00197         setType(ka.m\_type);}
\DoxyCodeLine{00198     \}}
\DoxyCodeLine{00199   \}}
\DoxyCodeLine{00200   \textcolor{keywordflow}{return} kIndex;}
\DoxyCodeLine{00201 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_ab35d80d875c4e22ff7713c3fa2321678}\label{class_keyframe_setter_ab35d80d875c4e22ff7713c3fa2321678}} 
\index{KeyframeSetter@{KeyframeSetter}!enableCycle@{enableCycle}}
\index{enableCycle@{enableCycle}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{enableCycle()}{enableCycle()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::enable\+Cycle (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$}]{curve,  }\item[{bool}]{enabled,  }\item[{\mbox{\hyperlink{class_t_scene_handle}{TScene\+Handle}} $\ast$}]{scene\+Handle = {\ttfamily nullptr} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00862                                                             \{}
\DoxyCodeLine{00863   curve-\/>\mbox{\hyperlink{class_t_double_param_aeebdac823f26002638dd01756e4c77a4}{enableCycle}}(enabled);}
\DoxyCodeLine{00864   \textcolor{keywordflow}{if} (sceneHandle) sceneHandle-\/>notifySceneChanged();}
\DoxyCodeLine{00865   TUndoManager::manager()-\/>add(\textcolor{keyword}{new} \mbox{\hyperlink{class_enable_cycle_undo}{EnableCycleUndo}}(curve, sceneHandle));}
\DoxyCodeLine{00866 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_ab743db719e1b1017a957d061893b12a8}\label{class_keyframe_setter_ab743db719e1b1017a957d061893b12a8}} 
\index{KeyframeSetter@{KeyframeSetter}!getCurve@{getCurve}}
\index{getCurve@{getCurve}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{getCurve()}{getCurve()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$ Keyframe\+Setter\+::get\+Curve (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00046 \{ \textcolor{keywordflow}{return} m\_param.getPointer(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a664acd6517dafcb648d59b3c972539c3}\label{class_keyframe_setter_a664acd6517dafcb648d59b3c972539c3}} 
\index{KeyframeSetter@{KeyframeSetter}!getPixelRatio@{getPixelRatio}}
\index{getPixelRatio@{getPixelRatio}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{getPixelRatio()}{getPixelRatio()}}
{\footnotesize\ttfamily double Keyframe\+Setter\+::get\+Pixel\+Ratio (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00051 \{ \textcolor{keywordflow}{return} m\_pixelRatio; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a93d4180382c326ce2c7f47507316e3f8}\label{class_keyframe_setter_a93d4180382c326ce2c7f47507316e3f8}} 
\index{KeyframeSetter@{KeyframeSetter}!isEaseInOut@{isEaseInOut}}
\index{isEaseInOut@{isEaseInOut}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{isEaseInOut()}{isEaseInOut()}}
{\footnotesize\ttfamily bool Keyframe\+Setter\+::is\+Ease\+In\+Out (\begin{DoxyParamCaption}\item[{int}]{segment\+Index }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00209                                                        \{}
\DoxyCodeLine{00210   \textcolor{keywordflow}{if} (0 <= segmentIndex \&\& segmentIndex + 1 < m\_param-\/>getKeyframeCount()) \{}
\DoxyCodeLine{00211     TDoubleKeyframe::Type type = m\_param-\/>getKeyframe(segmentIndex).m\_type;}
\DoxyCodeLine{00212     \textcolor{keywordflow}{if} (type == TDoubleKeyframe::EaseInOut ||}
\DoxyCodeLine{00213         type == TDoubleKeyframe::EaseInOutPercentage)}
\DoxyCodeLine{00214       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00215   \}}
\DoxyCodeLine{00216   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00217 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_adfdb7719c037157d3600edb2f6d12ecb}\label{class_keyframe_setter_adfdb7719c037157d3600edb2f6d12ecb}} 
\index{KeyframeSetter@{KeyframeSetter}!isSelected@{isSelected}}
\index{isSelected@{isSelected}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{isSelected()}{isSelected()}}
{\footnotesize\ttfamily bool Keyframe\+Setter\+::is\+Selected (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00061 \{ \textcolor{keywordflow}{return} m\_indices.count(index) > 0; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_ab3d2ddb5d0130b3e3d28e2cfbad7776e}\label{class_keyframe_setter_ab3d2ddb5d0130b3e3d28e2cfbad7776e}} 
\index{KeyframeSetter@{KeyframeSetter}!isSpeedInOut@{isSpeedInOut}}
\index{isSpeedInOut@{isSpeedInOut}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{isSpeedInOut()}{isSpeedInOut()}}
{\footnotesize\ttfamily bool Keyframe\+Setter\+::is\+Speed\+In\+Out (\begin{DoxyParamCaption}\item[{int}]{segment\+Index }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00203                                                         \{}
\DoxyCodeLine{00204   \textcolor{keywordflow}{return} 0 <= segmentIndex \&\& segmentIndex + 1 < m\_param-\/>getKeyframeCount() \&\&}
\DoxyCodeLine{00205          m\_param-\/>getKeyframe(segmentIndex).m\_type ==}
\DoxyCodeLine{00206              TDoubleKeyframe::SpeedInOut;}
\DoxyCodeLine{00207 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a805770208818f70de8f3462f025e108d}\label{class_keyframe_setter_a805770208818f70de8f3462f025e108d}} 
\index{KeyframeSetter@{KeyframeSetter}!linkHandles@{linkHandles}}
\index{linkHandles@{linkHandles}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{linkHandles()}{linkHandles()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::link\+Handles (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00557                                  \{}
\DoxyCodeLine{00558   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00559   \textcolor{keywordflow}{if} (m\_keyframe.m\_linkedHandles) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00560   m\_changed                  = \textcolor{keyword}{true};}
\DoxyCodeLine{00561   m\_keyframe.m\_linkedHandles = \textcolor{keyword}{true};}
\DoxyCodeLine{00562   \textcolor{keywordflow}{if} (isSpeedInOut(m\_kIndex) \&\& isSpeedInOut(m\_kIndex -\/ 1)) \{}
\DoxyCodeLine{00563     \textcolor{comment}{// keyframe is between two speedin/out segments (and therefore linkHandles}}
\DoxyCodeLine{00564     \textcolor{comment}{// makes sense)}}
\DoxyCodeLine{00565     \mbox{\hyperlink{class_t_point_t}{TPointD}} d        = -\/m\_keyframe.m\_speedIn + m\_keyframe.m\_speedOut;}
\DoxyCodeLine{00566     \textcolor{keyword}{const} \textcolor{keywordtype}{double} eps = 0.1e-\/3;}
\DoxyCodeLine{00567     \textcolor{keywordflow}{if} (d.x <= eps) \{}
\DoxyCodeLine{00568       m\_keyframe.m\_speedIn = m\_keyframe.m\_speedOut = \mbox{\hyperlink{class_t_point_t}{TPointD}}(0, 0);}
\DoxyCodeLine{00569     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00570       m\_keyframe.m\_speedIn.y  = d.y * m\_keyframe.m\_speedIn.x / d.x;}
\DoxyCodeLine{00571       m\_keyframe.m\_speedOut.y = d.y * m\_keyframe.m\_speedOut.x / d.x;}
\DoxyCodeLine{00572     \}}
\DoxyCodeLine{00573   \}}
\DoxyCodeLine{00574   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00575 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_acb8d17dbdf3faeb5b716a1db84ab7cf3}\label{class_keyframe_setter_acb8d17dbdf3faeb5b716a1db84ab7cf3}} 
\index{KeyframeSetter@{KeyframeSetter}!moveKeyframes@{moveKeyframes}}
\index{moveKeyframes@{moveKeyframes}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{moveKeyframes()}{moveKeyframes()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::move\+Keyframes (\begin{DoxyParamCaption}\item[{int}]{d\+Frame,  }\item[{double}]{d\+Value }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00254                                                             \{}
\DoxyCodeLine{00255   \textcolor{keywordtype}{int} n = m\_param-\/>getKeyframeCount();}
\DoxyCodeLine{00256   \textcolor{keywordflow}{if} (n == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00257 }
\DoxyCodeLine{00258   \textcolor{comment}{// to keep constant the "{}length"{} of speed handles which are modified as side}}
\DoxyCodeLine{00259   \textcolor{comment}{// effects}}
\DoxyCodeLine{00260   std::vector<std::pair<double, int>> rotatingSpeedHandles;}
\DoxyCodeLine{00261   \textcolor{keywordflow}{if} (m\_indices.size() == 1)}
\DoxyCodeLine{00262     getRotatingSpeedHandles(rotatingSpeedHandles, m\_param.getPointer(),}
\DoxyCodeLine{00263                             *m\_indices.begin());}
\DoxyCodeLine{00264 }
\DoxyCodeLine{00265   \textcolor{comment}{// update the frame change (m\_extraDFrame represent old moves}}
\DoxyCodeLine{00266   \textcolor{comment}{// which has not performed, e.g.  because of keyframe collisions)}}
\DoxyCodeLine{00267   dFrame += m\_extraDFrame;}
\DoxyCodeLine{00268   m\_extraDFrame = 0;}
\DoxyCodeLine{00269 }
\DoxyCodeLine{00270   \textcolor{keywordflow}{if} (dFrame != 0) \{}
\DoxyCodeLine{00271     \textcolor{comment}{// check frame constraints (keyframe collisions and segment type swaps)}}
\DoxyCodeLine{00272     \textcolor{keywordtype}{double} preferredDFrame = dFrame;}
\DoxyCodeLine{00273     \textcolor{keywordtype}{double} dFrameSgn       = dFrame < 0 ? -\/1 : 1;}
\DoxyCodeLine{00274     dFrame *= dFrameSgn;}
\DoxyCodeLine{00275 }
\DoxyCodeLine{00276     \textcolor{keyword}{typedef} std::pair<TDoubleKeyframe::Type, TDoubleKeyframe::Type> TypePair;}
\DoxyCodeLine{00277     std::vector<std::pair<double, TypePair>> keyframes(n);}
\DoxyCodeLine{00278     keyframes[0].second.first = TDoubleKeyframe::None;}
\DoxyCodeLine{00279     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++) \{}
\DoxyCodeLine{00280       \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} kf = m\_param-\/>getKeyframe(i);}
\DoxyCodeLine{00281       keyframes[i].first = kf.m\_frame;}
\DoxyCodeLine{00282       \textcolor{keywordflow}{if} (i < n -\/ 1) \{}
\DoxyCodeLine{00283         keyframes[i].second.second    = kf.m\_type;}
\DoxyCodeLine{00284         keyframes[i + 1].second.first = kf.m\_type;}
\DoxyCodeLine{00285       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00286         keyframes[i].second.second = TDoubleKeyframe::None;}
\DoxyCodeLine{00287     \}}
\DoxyCodeLine{00288 }
\DoxyCodeLine{00289     \textcolor{keywordflow}{while} (dFrame > 0) \{}
\DoxyCodeLine{00290       std::vector<std::pair<double, TypePair>> mk(}
\DoxyCodeLine{00291           keyframes);  \textcolor{comment}{// mk = moved keyframes}}
\DoxyCodeLine{00292       std::set<int>::iterator it;}
\DoxyCodeLine{00293       \textcolor{keywordflow}{for} (it = m\_indices.begin(); it != m\_indices.end(); ++it)}
\DoxyCodeLine{00294         mk[*it].first += dFrame * dFrameSgn;}
\DoxyCodeLine{00295       std::sort(mk.begin(), mk.end());}
\DoxyCodeLine{00296       \textcolor{keywordtype}{bool} ok = \textcolor{keyword}{true};}
\DoxyCodeLine{00297       \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00298       \textcolor{keywordflow}{for} (i = 0; i + 1 < n \&\& ok; i++) \{}
\DoxyCodeLine{00299         \textcolor{comment}{// check keyframe collisions}}
\DoxyCodeLine{00300         \textcolor{keywordflow}{if} (fabs(mk[i + 1].first -\/ mk[i].first) < 1.e-\/8) ok = \textcolor{keyword}{false};}
\DoxyCodeLine{00301         \textcolor{comment}{// check segment type swaps}}
\DoxyCodeLine{00302         \textcolor{keywordflow}{if} (mk[i].second.second != mk[i + 1].second.first \&\&}
\DoxyCodeLine{00303             mk[i].second.second != TDoubleKeyframe::None \&\&}
\DoxyCodeLine{00304             mk[i + 1].second.first != TDoubleKeyframe::None)}
\DoxyCodeLine{00305           ok = \textcolor{keyword}{false};}
\DoxyCodeLine{00306       \}}
\DoxyCodeLine{00307       \textcolor{keywordflow}{if} (ok) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00308       dFrame -\/= 1;}
\DoxyCodeLine{00309     \}}
\DoxyCodeLine{00310 }
\DoxyCodeLine{00311     dFrame = dFrameSgn * std::max(0, dFrame);}
\DoxyCodeLine{00312     \textcolor{keywordflow}{if} (dFrame != preferredDFrame) m\_extraDFrame = preferredDFrame -\/ dFrame;}
\DoxyCodeLine{00313     \textcolor{comment}{// at this point dFrame (possibly ==0) is ok (no keyframe collisions, no}}
\DoxyCodeLine{00314     \textcolor{comment}{// segment type mismatches)}}
\DoxyCodeLine{00315   \}}
\DoxyCodeLine{00316 }
\DoxyCodeLine{00317   std::map<int, TDoubleKeyframe> change;}
\DoxyCodeLine{00318   \textcolor{keywordflow}{if} (dFrame == 0) \{}
\DoxyCodeLine{00319     \textcolor{comment}{// only value changes}}
\DoxyCodeLine{00320 }
\DoxyCodeLine{00321     std::set<int>::iterator it;}
\DoxyCodeLine{00322     \textcolor{keywordtype}{int} i     = 0;}
\DoxyCodeLine{00323     m\_changed = \textcolor{keyword}{true};}
\DoxyCodeLine{00324     \textcolor{keywordflow}{for} (it = m\_indices.begin(); it != m\_indices.end(); ++it, i++) \{}
\DoxyCodeLine{00325       \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} keyframe = m\_param-\/>getKeyframe(*it);}
\DoxyCodeLine{00326       keyframe.m\_value += dValue;}
\DoxyCodeLine{00327       change[*it] = keyframe;}
\DoxyCodeLine{00328       m\_undo-\/>addKeyframe(i);}
\DoxyCodeLine{00329     \}}
\DoxyCodeLine{00330   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00331     \textcolor{comment}{// frame+value changes}}
\DoxyCodeLine{00332 }
\DoxyCodeLine{00333     \textcolor{keywordtype}{int} n = m\_param-\/>getKeyframeCount();}
\DoxyCodeLine{00334     std::vector<std::pair<TDoubleKeyframe, int>> keyframes(}
\DoxyCodeLine{00335         n);  \textcolor{comment}{// (keyframe, index)}}
\DoxyCodeLine{00336     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++)}
\DoxyCodeLine{00337       keyframes[i] = std::make\_pair(m\_param-\/>getKeyframe(i), i);}
\DoxyCodeLine{00338 }
\DoxyCodeLine{00339     \textcolor{comment}{// change frame and value of selected keyframes}}
\DoxyCodeLine{00340     std::set<int>::iterator it;}
\DoxyCodeLine{00341     \textcolor{keywordflow}{for} (it = m\_indices.begin(); it != m\_indices.end(); ++it) \{}
\DoxyCodeLine{00342       \textcolor{keywordtype}{int} i = *it;}
\DoxyCodeLine{00343       keyframes[i].first.m\_frame += dFrame;}
\DoxyCodeLine{00344       keyframes[i].first.m\_value += dValue;}
\DoxyCodeLine{00345       \textcolor{comment}{// keyframes[i].second = -\/1;  // to mark keyframes involved in the move}}
\DoxyCodeLine{00346     \}}
\DoxyCodeLine{00347     \textcolor{comment}{// keyframes.back().first.m\_type = TDoubleKeyframe::None;}}
\DoxyCodeLine{00348 }
\DoxyCodeLine{00349     \textcolor{comment}{// clear selection (indices can change: we have to rebuild it)}}
\DoxyCodeLine{00350 }
\DoxyCodeLine{00351     std::set<int> oldSelection(m\_indices);}
\DoxyCodeLine{00352     m\_indices.clear();}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354     \textcolor{comment}{// sort keyframes (according to their -\/ updated -\/ frames)}}
\DoxyCodeLine{00355     std::sort(keyframes.begin(), keyframes.end());}
\DoxyCodeLine{00356 }
\DoxyCodeLine{00357     \textcolor{keywordflow}{for} (std::set<int>::iterator it = oldSelection.begin();}
\DoxyCodeLine{00358          it != oldSelection.end(); ++it)}
\DoxyCodeLine{00359       m\_indices.insert(keyframes[*it].second);}
\DoxyCodeLine{00360 }
\DoxyCodeLine{00361     \textcolor{comment}{// update segment types (because of swaps)}}
\DoxyCodeLine{00362     \textcolor{comment}{/*}}
\DoxyCodeLine{00363 \textcolor{comment}{for(int i=0;i+1<n;i++)}}
\DoxyCodeLine{00364 \textcolor{comment}{\{}}
\DoxyCodeLine{00365 \textcolor{comment}{TDoubleKeyframe \&kfa = keyframes[i].first;}}
\DoxyCodeLine{00366 \textcolor{comment}{TDoubleKeyframe \&kfb = keyframes[i+1].first;}}
\DoxyCodeLine{00367 \textcolor{comment}{if(kfa.m\_type == TDoubleKeyframe::None)}}
\DoxyCodeLine{00368 \textcolor{comment}{\{}}
\DoxyCodeLine{00369 \textcolor{comment}{kfa.m\_type = TDoubleKeyframe::SpeedInOut;}}
\DoxyCodeLine{00370 \textcolor{comment}{kfa.m\_speedOut = TPointD(0,0);}}
\DoxyCodeLine{00371 \textcolor{comment}{\}}}
\DoxyCodeLine{00372 \textcolor{comment}{if(kfb.m\_prevType == TDoubleKeyframe::None)}}
\DoxyCodeLine{00373 \textcolor{comment}{\{}}
\DoxyCodeLine{00374 \textcolor{comment}{kfa.m\_prevType = TDoubleKeyframe::SpeedInOut;}}
\DoxyCodeLine{00375 \textcolor{comment}{kfa.m\_speedIn = TPointD(0,0);}}
\DoxyCodeLine{00376 \textcolor{comment}{\}}}
\DoxyCodeLine{00377 \textcolor{comment}{\}}}
\DoxyCodeLine{00378 \textcolor{comment}{*/}}
\DoxyCodeLine{00379 }
\DoxyCodeLine{00380     m\_changed = \textcolor{keyword}{true};}
\DoxyCodeLine{00381     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++) \{}
\DoxyCodeLine{00382       \textcolor{keywordflow}{if} (keyframes[i].second != i) \{}
\DoxyCodeLine{00383         \textcolor{comment}{/*}}
\DoxyCodeLine{00384 \textcolor{comment}{// i-\/th keyframe has changed is order position}}
\DoxyCodeLine{00385 \textcolor{comment}{if(keyframes[i].first.m\_type == TDoubleKeyframe::None)}}
\DoxyCodeLine{00386 \textcolor{comment}{\{}}
\DoxyCodeLine{00387 \textcolor{comment}{if(i==n-\/1) keyframes[i].first.m\_type = TDoubleKeyframe::Linear;}}
\DoxyCodeLine{00388 \textcolor{comment}{else keyframes[i].first.m\_type = keyframes[i+1].first.m\_type;}}
\DoxyCodeLine{00389 \textcolor{comment}{\}}}
\DoxyCodeLine{00390 \textcolor{comment}{*/}}
\DoxyCodeLine{00391 }
\DoxyCodeLine{00392         m\_undo-\/>addKeyframe(i);}
\DoxyCodeLine{00393         change[i] = keyframes[i].first;}
\DoxyCodeLine{00394       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_indices.count(i) > 0)}
\DoxyCodeLine{00395         change[i] = keyframes[i].first;}
\DoxyCodeLine{00396     \}}
\DoxyCodeLine{00397   \}}
\DoxyCodeLine{00398   m\_param-\/>setKeyframes(change);}
\DoxyCodeLine{00399   \textcolor{comment}{/*}}
\DoxyCodeLine{00400 \textcolor{comment}{if(!rotatingSpeedHandles.empty())}}
\DoxyCodeLine{00401 \textcolor{comment}{\{}}
\DoxyCodeLine{00402 \textcolor{comment}{for(int i=0;i<(int)rotatingSpeedHandles.size();i++)}}
\DoxyCodeLine{00403 \textcolor{comment}{\{}}
\DoxyCodeLine{00404 \textcolor{comment}{double speedLength = rotatingSpeedHandles[i].first;}}
\DoxyCodeLine{00405 \textcolor{comment}{int kIndex = rotatingSpeedHandles[i].second;}}
\DoxyCodeLine{00406 \textcolor{comment}{TDoubleKeyframe kf = m\_param-\/>getKeyframe(kIndex);}}
\DoxyCodeLine{00407 \textcolor{comment}{TPointD speed = speedLength<0 ? m\_param-\/>getSpeedIn(kIndex) :}}
\DoxyCodeLine{00408 \textcolor{comment}{m\_param-\/>getSpeedOut(kIndex);}}
\DoxyCodeLine{00409 \textcolor{comment}{speed = fabs(speedLength/getNorm(speed)) * speed;}}
\DoxyCodeLine{00410 \textcolor{comment}{if(speedLength<0)}}
\DoxyCodeLine{00411 \textcolor{comment}{  kf.m\_speedIn = speed;}}
\DoxyCodeLine{00412 \textcolor{comment}{else}}
\DoxyCodeLine{00413 \textcolor{comment}{  kf.m\_speedOut = speed;}}
\DoxyCodeLine{00414 \textcolor{comment}{m\_param-\/>setKeyframe(kf);}}
\DoxyCodeLine{00415 \textcolor{comment}{\}}}
\DoxyCodeLine{00416 \textcolor{comment}{\}}}
\DoxyCodeLine{00417 \textcolor{comment}{*/}}
\DoxyCodeLine{00418 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a61513803b21ec059b02837d2c487c8f9}\label{class_keyframe_setter_a61513803b21ec059b02837d2c487c8f9}} 
\index{KeyframeSetter@{KeyframeSetter}!removeKeyframeAt@{removeKeyframeAt}}
\index{removeKeyframeAt@{removeKeyframeAt}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{removeKeyframeAt()}{removeKeyframeAt()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::remove\+Keyframe\+At (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$}]{curve,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00821                                                                        \{}
\DoxyCodeLine{00822   \textcolor{keywordtype}{int} kIndex = curve-\/>getClosestKeyframe(frame);}
\DoxyCodeLine{00823   \textcolor{keywordflow}{if} (kIndex < 0 || kIndex >= curve-\/>getKeyframeCount() ||}
\DoxyCodeLine{00824       curve-\/>\mbox{\hyperlink{class_t_double_param_af08442b9fd968fddada028a6f07983d5}{keyframeIndexToFrame}}(kIndex) != frame)}
\DoxyCodeLine{00825     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00826   TUndoManager::manager()-\/>add(\textcolor{keyword}{new} \mbox{\hyperlink{class_remove_keyframe_undo}{RemoveKeyframeUndo}}(curve, kIndex));}
\DoxyCodeLine{00827   curve-\/>\mbox{\hyperlink{class_t_double_param_a4654e139a14f57eb7f455a82f56f683d}{deleteKeyframe}}(frame);}
\DoxyCodeLine{00828 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a42446e4bb84bfb7dab560fac3f4823c8}\label{class_keyframe_setter_a42446e4bb84bfb7dab560fac3f4823c8}} 
\index{KeyframeSetter@{KeyframeSetter}!selectKeyframe@{selectKeyframe}}
\index{selectKeyframe@{selectKeyframe}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{selectKeyframe()}{selectKeyframe()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::select\+Keyframe (\begin{DoxyParamCaption}\item[{int}]{k\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00112                                               \{}
\DoxyCodeLine{00113   \textcolor{keywordflow}{if} (m\_indices.count(kIndex) == 0) \{}
\DoxyCodeLine{00114     m\_indices.insert(kIndex);}
\DoxyCodeLine{00115     m\_undo-\/>addKeyframe(kIndex);}
\DoxyCodeLine{00116   \}}
\DoxyCodeLine{00117   m\_kIndex   = kIndex;}
\DoxyCodeLine{00118   m\_keyframe = m\_param-\/>getKeyframe(m\_kIndex);}
\DoxyCodeLine{00119 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a0844b9a8d2d5db5b17c71a2beb905efb}\label{class_keyframe_setter_a0844b9a8d2d5db5b17c71a2beb905efb}} 
\index{KeyframeSetter@{KeyframeSetter}!setAllParams@{setAllParams}}
\index{setAllParams@{setAllParams}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setAllParams()}{setAllParams()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+All\+Params (\begin{DoxyParamCaption}\item[{int}]{step,  }\item[{TDouble\+Keyframe\+::\+Type}]{combo\+Type,  }\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{speed\+In,  }\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{speed\+Out,  }\item[{std\+::string}]{expression\+Text,  }\item[{std\+::string}]{unit\+Name,  }\item[{const \mbox{\hyperlink{class_t_double_keyframe_1_1_file_params}{TDouble\+Keyframe\+::\+File\+Params}} \&}]{file\+Param,  }\item[{double}]{similar\+Shape\+Offset }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00704                                                                            \{}
\DoxyCodeLine{00705   assert(0 <= m\_kIndex \&\& m\_kIndex < m\_param-\/>getKeyframeCount());}
\DoxyCodeLine{00706 }
\DoxyCodeLine{00707   \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} keyframe = m\_param-\/>getKeyframe(m\_kIndex);}
\DoxyCodeLine{00708   \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} nextKeyframe;}
\DoxyCodeLine{00709 }
\DoxyCodeLine{00710   \textcolor{comment}{// get the next key}}
\DoxyCodeLine{00711   \textcolor{keywordflow}{if} (m\_kIndex + 1 < m\_param-\/>getKeyframeCount())}
\DoxyCodeLine{00712     nextKeyframe = m\_param-\/>getKeyframe(m\_kIndex + 1);}
\DoxyCodeLine{00713   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00714     comboType = TDoubleKeyframe::Linear;}
\DoxyCodeLine{00715 }
\DoxyCodeLine{00716   \textcolor{comment}{// I'm going to change kIndex. Make sure it is selected. set the dirty flag}}
\DoxyCodeLine{00717   m\_undo-\/>addKeyframe(m\_kIndex);}
\DoxyCodeLine{00718   m\_indices.insert(m\_kIndex);}
\DoxyCodeLine{00719   m\_changed = \textcolor{keyword}{true};}
\DoxyCodeLine{00720 }
\DoxyCodeLine{00721   \textcolor{comment}{// set step}}
\DoxyCodeLine{00722   \textcolor{keywordflow}{if} (step < 1) step = 1;}
\DoxyCodeLine{00723   keyframe.m\_step = step;}
\DoxyCodeLine{00724 }
\DoxyCodeLine{00725   \textcolor{comment}{// set type}}
\DoxyCodeLine{00726   keyframe.m\_type = comboType;}
\DoxyCodeLine{00727 }
\DoxyCodeLine{00728   \textcolor{comment}{// set parameters according to the type}}
\DoxyCodeLine{00729   std::map<int, TDoubleKeyframe> keyframes;}
\DoxyCodeLine{00730   \textcolor{keywordflow}{switch} (comboType) \{}
\DoxyCodeLine{00731   \textcolor{keywordflow}{case} TDoubleKeyframe::SpeedInOut:}
\DoxyCodeLine{00732     keyframe.m\_speedOut    = speedOut;}
\DoxyCodeLine{00733     nextKeyframe.m\_speedIn = speedIn;}
\DoxyCodeLine{00734 }
\DoxyCodeLine{00735     \textcolor{keywordflow}{if} (keyframe.m\_speedOut.x < 0) keyframe.m\_speedOut.x = 0;}
\DoxyCodeLine{00736     \textcolor{keywordflow}{if} (nextKeyframe.m\_speedIn.x > 0) nextKeyframe.m\_speedIn.x = 0;}
\DoxyCodeLine{00737     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00738 }
\DoxyCodeLine{00739   \textcolor{keywordflow}{case} TDoubleKeyframe::EaseInOut:}
\DoxyCodeLine{00740   \textcolor{keywordflow}{case} TDoubleKeyframe::EaseInOutPercentage:}
\DoxyCodeLine{00741     keyframe.m\_speedOut    = speedOut;}
\DoxyCodeLine{00742     nextKeyframe.m\_speedIn = speedIn;}
\DoxyCodeLine{00743     \textcolor{keywordflow}{if} (keyframe.m\_type == TDoubleKeyframe::EaseInOut) \{}
\DoxyCodeLine{00744       keyframe.m\_speedOut.x    = floor(speedOut.x + 0.5);}
\DoxyCodeLine{00745       nextKeyframe.m\_speedIn.x = floor(speedIn.x + 0.5);}
\DoxyCodeLine{00746     \}}
\DoxyCodeLine{00747     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00748 }
\DoxyCodeLine{00749   \textcolor{keywordflow}{case} TDoubleKeyframe::Expression:}
\DoxyCodeLine{00750     keyframe.m\_expressionText = expressionText;}
\DoxyCodeLine{00751     keyframe.m\_unitName       = unitName;}
\DoxyCodeLine{00752     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00753 }
\DoxyCodeLine{00754   \textcolor{keywordflow}{case} TDoubleKeyframe::File:}
\DoxyCodeLine{00755     keyframe.m\_fileParams = fileParam;}
\DoxyCodeLine{00756     keyframe.m\_unitName   = unitName;}
\DoxyCodeLine{00757     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00758 }
\DoxyCodeLine{00759   \textcolor{keywordflow}{case} TDoubleKeyframe::SimilarShape:}
\DoxyCodeLine{00760     keyframe.m\_expressionText     = expressionText;}
\DoxyCodeLine{00761     keyframe.m\_similarShapeOffset = similarShapeOffset;}
\DoxyCodeLine{00762     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00763 }
\DoxyCodeLine{00764   \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00765     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00766   \}}
\DoxyCodeLine{00767 }
\DoxyCodeLine{00768   \textcolor{comment}{/*-\/-\/-\/ リンクされたカーブの処理 -\/-\/-\/*/}}
\DoxyCodeLine{00769   \textcolor{keyword}{const} \textcolor{keywordtype}{double} eps = 0.00001;}
\DoxyCodeLine{00770   \textcolor{keywordflow}{if} (m\_kIndex != 0 \&\& keyframe.m\_linkedHandles \&\&}
\DoxyCodeLine{00771       keyframe.m\_prevType == TDoubleKeyframe::SpeedInOut) \{}
\DoxyCodeLine{00772     \textcolor{keywordtype}{double} inNorm = getNorm(keyframe.m\_speedIn);}
\DoxyCodeLine{00773     \textcolor{comment}{// update previous segment speed vector}}
\DoxyCodeLine{00774     \textcolor{keywordtype}{double} outNorm = getNorm(keyframe.m\_speedOut);}
\DoxyCodeLine{00775     \textcolor{keywordflow}{if} (outNorm > eps)}
\DoxyCodeLine{00776       keyframe.m\_speedIn = -\/inNorm / outNorm * keyframe.m\_speedOut;}
\DoxyCodeLine{00777   \}}
\DoxyCodeLine{00778 }
\DoxyCodeLine{00779   \textcolor{comment}{// Next curve}}
\DoxyCodeLine{00780   \textcolor{keywordflow}{if} (m\_kIndex + 2 < m\_param-\/>getKeyframeCount() \&\&}
\DoxyCodeLine{00781       nextKeyframe.m\_linkedHandles \&\&}
\DoxyCodeLine{00782       nextKeyframe.m\_type == TDoubleKeyframe::SpeedInOut) \{}
\DoxyCodeLine{00783     \textcolor{keywordtype}{double} outNorm = getNorm(nextKeyframe.m\_speedOut);}
\DoxyCodeLine{00784     \textcolor{comment}{// update next segment speed vector}}
\DoxyCodeLine{00785     \textcolor{keywordtype}{double} inNorm = getNorm(nextKeyframe.m\_speedIn);}
\DoxyCodeLine{00786     \textcolor{keywordflow}{if} (inNorm < eps)}
\DoxyCodeLine{00787       nextKeyframe.m\_speedOut = \mbox{\hyperlink{class_t_point_t}{TPointD}}(outNorm, 0);}
\DoxyCodeLine{00788     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00789       nextKeyframe.m\_speedOut = -\/(outNorm / inNorm) * nextKeyframe.m\_speedIn;}
\DoxyCodeLine{00790   \}}
\DoxyCodeLine{00791 }
\DoxyCodeLine{00792   \textcolor{comment}{// set modified keyframe}}
\DoxyCodeLine{00793   keyframes[m\_kIndex] = keyframe;}
\DoxyCodeLine{00794   \textcolor{keywordflow}{if} (m\_kIndex + 1 < m\_param-\/>getKeyframeCount())}
\DoxyCodeLine{00795     keyframes[m\_kIndex + 1] = nextKeyframe;}
\DoxyCodeLine{00796 }
\DoxyCodeLine{00797   m\_param-\/>setKeyframes(keyframes);}
\DoxyCodeLine{00798 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_ae7fb8363eb2ce763d68e835b160f2162}\label{class_keyframe_setter_ae7fb8363eb2ce763d68e835b160f2162}} 
\index{KeyframeSetter@{KeyframeSetter}!setEaseIn@{setEaseIn}}
\index{setEaseIn@{setEaseIn}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setEaseIn()}{setEaseIn()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Ease\+In (\begin{DoxyParamCaption}\item[{double}]{ease\+In }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00649                                             \{}
\DoxyCodeLine{00650   \textcolor{comment}{// easeIn <=0}}
\DoxyCodeLine{00651   assert(m\_kIndex >= 1 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00652   assert(isEaseInOut(m\_kIndex -\/ 1));}
\DoxyCodeLine{00653   m\_changed                    = \textcolor{keyword}{true};}
\DoxyCodeLine{00654   \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} prevKeyframe = m\_param-\/>getKeyframe(m\_kIndex -\/ 1);}
\DoxyCodeLine{00655   \textcolor{keywordtype}{bool} isPercentage =}
\DoxyCodeLine{00656       prevKeyframe.m\_type == TDoubleKeyframe::EaseInOutPercentage;}
\DoxyCodeLine{00657   \textcolor{keywordflow}{if} (!isPercentage) easeIn = floor(easeIn + 0.5);}
\DoxyCodeLine{00658   \textcolor{keywordtype}{double} segmentWidth =}
\DoxyCodeLine{00659       isPercentage ? 100.0 : m\_keyframe.m\_frame -\/ prevKeyframe.m\_frame;}
\DoxyCodeLine{00660   easeIn               = -\/tcrop(-\/easeIn, 0.0, segmentWidth);}
\DoxyCodeLine{00661   m\_keyframe.m\_speedIn = \mbox{\hyperlink{class_t_point_t}{TPointD}}(easeIn, 0);}
\DoxyCodeLine{00662   \textcolor{keywordflow}{if} (prevKeyframe.m\_speedOut.x -\/ easeIn > segmentWidth) \{}
\DoxyCodeLine{00663     m\_undo-\/>addKeyframe(m\_kIndex -\/ 1);}
\DoxyCodeLine{00664     prevKeyframe.m\_speedOut.x = segmentWidth + easeIn;}
\DoxyCodeLine{00665     std::map<int, TDoubleKeyframe> keyframes;}
\DoxyCodeLine{00666     keyframes[m\_kIndex -\/ 1] = prevKeyframe;}
\DoxyCodeLine{00667     keyframes[m\_kIndex]     = m\_keyframe;}
\DoxyCodeLine{00668     m\_param-\/>setKeyframes(keyframes);}
\DoxyCodeLine{00669   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00670     m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00671   \}}
\DoxyCodeLine{00672 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_acc416527888f6777ff79d0bd72019e09}\label{class_keyframe_setter_acc416527888f6777ff79d0bd72019e09}} 
\index{KeyframeSetter@{KeyframeSetter}!setEaseOut@{setEaseOut}}
\index{setEaseOut@{setEaseOut}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setEaseOut()}{setEaseOut()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Ease\+Out (\begin{DoxyParamCaption}\item[{double}]{ease\+Out }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00674                                               \{}
\DoxyCodeLine{00675   assert(m\_kIndex >= 0 \&\& m\_kIndex + 1 < m\_param-\/>getKeyframeCount() \&\&}
\DoxyCodeLine{00676          m\_indices.size() == 1);}
\DoxyCodeLine{00677   assert(isEaseInOut(m\_kIndex));}
\DoxyCodeLine{00678   m\_changed                    = \textcolor{keyword}{true};}
\DoxyCodeLine{00679   \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} nextKeyframe = m\_param-\/>getKeyframe(m\_kIndex + 1);}
\DoxyCodeLine{00680   \textcolor{keywordtype}{bool} isPercentage = m\_keyframe.m\_type == TDoubleKeyframe::EaseInOutPercentage;}
\DoxyCodeLine{00681   \textcolor{keywordflow}{if} (!isPercentage) easeOut = floor(easeOut + 0.5);}
\DoxyCodeLine{00682   \textcolor{keywordtype}{double} segmentWidth =}
\DoxyCodeLine{00683       isPercentage ? 100.0 : nextKeyframe.m\_frame -\/ m\_keyframe.m\_frame;}
\DoxyCodeLine{00684   easeOut               = tcrop(easeOut, 0.0, segmentWidth);}
\DoxyCodeLine{00685   m\_keyframe.m\_speedOut = \mbox{\hyperlink{class_t_point_t}{TPointD}}(easeOut, 0);}
\DoxyCodeLine{00686   \textcolor{keywordflow}{if} (-\/nextKeyframe.m\_speedIn.x + easeOut > segmentWidth) \{}
\DoxyCodeLine{00687     m\_undo-\/>addKeyframe(m\_kIndex + 1);}
\DoxyCodeLine{00688     nextKeyframe.m\_speedIn.x = easeOut -\/ segmentWidth;}
\DoxyCodeLine{00689     std::map<int, TDoubleKeyframe> keyframes;}
\DoxyCodeLine{00690     keyframes[m\_kIndex + 1] = nextKeyframe;}
\DoxyCodeLine{00691     keyframes[m\_kIndex]     = m\_keyframe;}
\DoxyCodeLine{00692     m\_param-\/>setKeyframes(keyframes);}
\DoxyCodeLine{00693   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00694     m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00695   \}}
\DoxyCodeLine{00696 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a03aa77df7abd1830123f625b05d01c58}\label{class_keyframe_setter_a03aa77df7abd1830123f625b05d01c58}} 
\index{KeyframeSetter@{KeyframeSetter}!setExpression@{setExpression}}
\index{setExpression@{setExpression}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setExpression()}{setExpression()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Expression (\begin{DoxyParamCaption}\item[{std\+::string}]{expression }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00517                                                        \{}
\DoxyCodeLine{00518   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00519   m\_changed                   = \textcolor{keyword}{true};}
\DoxyCodeLine{00520   m\_keyframe.m\_expressionText = expression;}
\DoxyCodeLine{00521   m\_keyframe.m\_type           = TDoubleKeyframe::Expression;}
\DoxyCodeLine{00522   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00523 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_ac88b1b7cf92edfbc63b32057a702cb24}\label{class_keyframe_setter_ac88b1b7cf92edfbc63b32057a702cb24}} 
\index{KeyframeSetter@{KeyframeSetter}!setFile@{setFile}}
\index{setFile@{setFile}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setFile()}{setFile()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+File (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_double_keyframe_1_1_file_params}{TDouble\+Keyframe\+::\+File\+Params}} \&}]{params }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00534                                                                     \{}
\DoxyCodeLine{00535   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00536   m\_changed               = \textcolor{keyword}{true};}
\DoxyCodeLine{00537   m\_keyframe.m\_fileParams = params;}
\DoxyCodeLine{00538   m\_keyframe.m\_type       = TDoubleKeyframe::File;}
\DoxyCodeLine{00539   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00540 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a3e54c3e6c837cd5169dce18177e36a07}\label{class_keyframe_setter_a3e54c3e6c837cd5169dce18177e36a07}} 
\index{KeyframeSetter@{KeyframeSetter}!setPixelRatio@{setPixelRatio}}
\index{setPixelRatio@{setPixelRatio}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setPixelRatio()}{setPixelRatio()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Pixel\+Ratio (\begin{DoxyParamCaption}\item[{double}]{pixel\+Ratio }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00050 \{ m\_pixelRatio = pixelRatio; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_af5a7ffc311a9ad73864cea6151af990b}\label{class_keyframe_setter_af5a7ffc311a9ad73864cea6151af990b}} 
\index{KeyframeSetter@{KeyframeSetter}!setSimilarShape@{setSimilarShape}}
\index{setSimilarShape@{setSimilarShape}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setSimilarShape()}{setSimilarShape()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Similar\+Shape (\begin{DoxyParamCaption}\item[{std\+::string}]{expression,  }\item[{double}]{offset }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00525                                                                         \{}
\DoxyCodeLine{00526   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00527   m\_changed                       = \textcolor{keyword}{true};}
\DoxyCodeLine{00528   m\_keyframe.m\_expressionText     = expression;}
\DoxyCodeLine{00529   m\_keyframe.m\_similarShapeOffset = offset;}
\DoxyCodeLine{00530   m\_keyframe.m\_type               = TDoubleKeyframe::SimilarShape;}
\DoxyCodeLine{00531   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00532 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a2c28f0f5063657b7b3aea29af4d7f266}\label{class_keyframe_setter_a2c28f0f5063657b7b3aea29af4d7f266}} 
\index{KeyframeSetter@{KeyframeSetter}!setSpeedIn@{setSpeedIn}}
\index{setSpeedIn@{setSpeedIn}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setSpeedIn()}{setSpeedIn()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Speed\+In (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{speed\+In }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00585                                                       \{}
\DoxyCodeLine{00586   \textcolor{keyword}{const} \textcolor{keywordtype}{double} eps = 0.00001;}
\DoxyCodeLine{00587   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00588   assert(isSpeedInOut(m\_kIndex -\/ 1));}
\DoxyCodeLine{00589   m\_changed            = \textcolor{keyword}{true};}
\DoxyCodeLine{00590   m\_keyframe.m\_speedIn = speedIn;}
\DoxyCodeLine{00591   \textcolor{keywordflow}{if} (m\_keyframe.m\_speedIn.x > 0) m\_keyframe.m\_speedIn.x = 0;}
\DoxyCodeLine{00592   \textcolor{keywordflow}{if} (m\_keyframe.m\_linkedHandles \&\&}
\DoxyCodeLine{00593       m\_kIndex + 1 <= m\_param-\/>getKeyframeCount()) \{}
\DoxyCodeLine{00594     \textcolor{keywordtype}{double} outNorm = getNorm(m\_keyframe.m\_speedOut);}
\DoxyCodeLine{00595     \textcolor{keywordflow}{if} (m\_kIndex + 1 == m\_param-\/>getKeyframeCount() || isSpeedInOut(m\_kIndex) ||}
\DoxyCodeLine{00596         (m\_keyframe.m\_type == TDoubleKeyframe::Expression \&\&}
\DoxyCodeLine{00597          m\_keyframe.m\_expressionText.find(\textcolor{stringliteral}{"{}cycle"{}}) != std::string::npos)) \{}
\DoxyCodeLine{00598       \textcolor{comment}{// update next segment speed vector}}
\DoxyCodeLine{00599       \textcolor{keywordtype}{double} inNorm = getNorm(m\_keyframe.m\_speedIn);}
\DoxyCodeLine{00600       \textcolor{keywordflow}{if} (inNorm < eps)}
\DoxyCodeLine{00601         m\_keyframe.m\_speedOut = \mbox{\hyperlink{class_t_point_t}{TPointD}}(outNorm, 0);}
\DoxyCodeLine{00602       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00603         m\_keyframe.m\_speedOut = -\/(outNorm / inNorm) * m\_keyframe.m\_speedIn;}
\DoxyCodeLine{00604     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00605       \textcolor{comment}{// can't change next segment speed vector => adjust speedIn to be}}
\DoxyCodeLine{00606       \textcolor{comment}{// collinear}}
\DoxyCodeLine{00607       \mbox{\hyperlink{class_t_point_t}{TPointD}} w     = rotate90(m\_keyframe.m\_speedOut);}
\DoxyCodeLine{00608       \textcolor{keywordtype}{double} wNorm2 = norm2(w);}
\DoxyCodeLine{00609       \textcolor{keywordflow}{if} (wNorm2 > eps * eps)}
\DoxyCodeLine{00610         m\_keyframe.m\_speedIn -\/= (1.0 / wNorm2) * (w * m\_keyframe.m\_speedIn) * w;}
\DoxyCodeLine{00611     \}}
\DoxyCodeLine{00612   \}}
\DoxyCodeLine{00613   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00614 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a52589254054b054882732b5a8c65e405}\label{class_keyframe_setter_a52589254054b054882732b5a8c65e405}} 
\index{KeyframeSetter@{KeyframeSetter}!setSpeedOut@{setSpeedOut}}
\index{setSpeedOut@{setSpeedOut}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setSpeedOut()}{setSpeedOut()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Speed\+Out (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{speed\+Out }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00616                                                         \{}
\DoxyCodeLine{00617   \textcolor{keyword}{const} \textcolor{keywordtype}{double} eps = 0.00001;}
\DoxyCodeLine{00618   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00619   assert(isSpeedInOut(m\_kIndex));}
\DoxyCodeLine{00620   m\_changed             = \textcolor{keyword}{true};}
\DoxyCodeLine{00621   m\_keyframe.m\_speedOut = speedOut;}
\DoxyCodeLine{00622   \textcolor{keywordflow}{if} (m\_keyframe.m\_speedOut.x < 0) m\_keyframe.m\_speedOut.x = 0;}
\DoxyCodeLine{00623   \textcolor{keywordflow}{if} (m\_keyframe.m\_linkedHandles \&\& m\_kIndex > 0) \{}
\DoxyCodeLine{00624     \textcolor{keywordtype}{double} inNorm = getNorm(m\_keyframe.m\_speedIn);}
\DoxyCodeLine{00625     \textcolor{keywordflow}{if} (isSpeedInOut(m\_kIndex -\/ 1)) \{}
\DoxyCodeLine{00626       \textcolor{comment}{// update previous segment speed vector}}
\DoxyCodeLine{00627       \textcolor{keywordtype}{double} outNorm = getNorm(m\_keyframe.m\_speedOut);}
\DoxyCodeLine{00628       \textcolor{keywordflow}{if} (outNorm > eps)}
\DoxyCodeLine{00629         m\_keyframe.m\_speedIn = -\/inNorm / outNorm * m\_keyframe.m\_speedOut;}
\DoxyCodeLine{00630       \textcolor{comment}{// else}}
\DoxyCodeLine{00631       \textcolor{comment}{//  m\_keyframe.m\_speedIn = TPointD(inNorm,0);}}
\DoxyCodeLine{00632 }
\DoxyCodeLine{00633     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00634       \textcolor{comment}{// can't change previous segment speed vector => adjust speedOut to be}}
\DoxyCodeLine{00635       \textcolor{comment}{// collinear}}
\DoxyCodeLine{00636       \textcolor{keywordtype}{double} h = 0.00001;}
\DoxyCodeLine{00637       \textcolor{keywordtype}{double} f = m\_keyframe.m\_frame;}
\DoxyCodeLine{00638       \textcolor{keywordtype}{double} v = (m\_param-\/>getValue(f) -\/ m\_param-\/>getValue(f -\/ h)) / h;}
\DoxyCodeLine{00639       \mbox{\hyperlink{class_t_point_t}{TPointD}} w(-\/v, 1);}
\DoxyCodeLine{00640       \textcolor{keywordtype}{double} wNorm2 = norm2(w);}
\DoxyCodeLine{00641       \textcolor{keywordflow}{if} (wNorm2 > eps * eps)}
\DoxyCodeLine{00642         m\_keyframe.m\_speedOut -\/=}
\DoxyCodeLine{00643             (1.0 / wNorm2) * (w * m\_keyframe.m\_speedOut) * w;}
\DoxyCodeLine{00644     \}}
\DoxyCodeLine{00645   \}}
\DoxyCodeLine{00646   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00647 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a61aacefdf34787a9188dbdbbc726e96f}\label{class_keyframe_setter_a61aacefdf34787a9188dbdbbc726e96f}} 
\index{KeyframeSetter@{KeyframeSetter}!setStep@{setStep}}
\index{setStep@{setStep}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setStep()}{setStep()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Step (\begin{DoxyParamCaption}\item[{int}]{step }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00509                                      \{}
\DoxyCodeLine{00510   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00511   \textcolor{keywordflow}{if} (m\_keyframe.m\_step == step) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00512   m\_changed         = \textcolor{keyword}{true};}
\DoxyCodeLine{00513   m\_keyframe.m\_step = step;}
\DoxyCodeLine{00514   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00515 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a4aff7752b0bbcd3370398e5347f0d23b}\label{class_keyframe_setter_a4aff7752b0bbcd3370398e5347f0d23b}} 
\index{KeyframeSetter@{KeyframeSetter}!setType@{setType}}
\index{setType@{setType}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setType()}{setType()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Type (\begin{DoxyParamCaption}\item[{int}]{k\+Index,  }\item[{TDouble\+Keyframe\+::\+Type}]{type }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00420                                                                  \{}
\DoxyCodeLine{00421   assert(0 <= kIndex \&\& kIndex < m\_param-\/>getKeyframeCount());}
\DoxyCodeLine{00422   \textcolor{comment}{// get the current keyframe value}}
\DoxyCodeLine{00423   \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} keyframe = m\_param-\/>getKeyframe(kIndex);}
\DoxyCodeLine{00424   \textcolor{comment}{// get the next keyframe (if any) and compute the segment length}}
\DoxyCodeLine{00425   \mbox{\hyperlink{class_t_double_keyframe}{TDoubleKeyframe}} nextKeyframe;}
\DoxyCodeLine{00426   \textcolor{keywordtype}{double} segmentWidth = 1;}
\DoxyCodeLine{00427   \textcolor{keywordflow}{if} (kIndex + 1 < m\_param-\/>getKeyframeCount()) \{}
\DoxyCodeLine{00428     nextKeyframe = m\_param-\/>getKeyframe(kIndex + 1);}
\DoxyCodeLine{00429     segmentWidth = nextKeyframe.m\_frame -\/ keyframe.m\_frame;}
\DoxyCodeLine{00430   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (kIndex + 1 > m\_param-\/>getKeyframeCount()) \{}
\DoxyCodeLine{00431     \textcolor{comment}{// kIndex is the last keyframe. no segment is defined (therefore no segment}}
\DoxyCodeLine{00432     \textcolor{comment}{// type)}}
\DoxyCodeLine{00433     type = TDoubleKeyframe::Linear;}
\DoxyCodeLine{00434   \}}
\DoxyCodeLine{00435   \textcolor{keywordflow}{if} (type == keyframe.m\_type) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00436 }
\DoxyCodeLine{00437   \textcolor{comment}{// I'm going to change kIndex. Make sure it is selected. set the dirty flag}}
\DoxyCodeLine{00438   m\_undo-\/>addKeyframe(kIndex);}
\DoxyCodeLine{00439   \textcolor{comment}{// m\_indices.insert(kIndex);}}
\DoxyCodeLine{00440   m\_changed    = \textcolor{keyword}{true};}
\DoxyCodeLine{00441   \textcolor{keywordtype}{double} ease0 = 0, ease1 = 0;}
\DoxyCodeLine{00442 }
\DoxyCodeLine{00443   std::map<int, TDoubleKeyframe> keyframes;}
\DoxyCodeLine{00444   \textcolor{keywordflow}{switch} (type) \{}
\DoxyCodeLine{00445   \textcolor{keywordflow}{case} TDoubleKeyframe::SpeedInOut:}
\DoxyCodeLine{00446     keyframe.m\_speedOut    = \mbox{\hyperlink{class_t_point_t}{TPointD}}(segmentWidth / 3, 0);}
\DoxyCodeLine{00447     nextKeyframe.m\_speedIn = \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/segmentWidth / 3, 0);}
\DoxyCodeLine{00448     \textcolor{keywordflow}{if} (nextKeyframe.m\_linkedHandles \&\& nextKeyframe.m\_speedOut.x > 0.01)}
\DoxyCodeLine{00449       nextKeyframe.m\_speedIn = -\/nextKeyframe.m\_speedOut;}
\DoxyCodeLine{00450     \textcolor{keywordflow}{if} (keyframe.m\_linkedHandles \&\& keyframe.m\_speedIn.x < -\/0.01)}
\DoxyCodeLine{00451       keyframe.m\_speedOut = -\/keyframe.m\_speedIn;}
\DoxyCodeLine{00452     keyframe.m\_type       = type;}
\DoxyCodeLine{00453     keyframes[kIndex]     = keyframe;}
\DoxyCodeLine{00454     keyframes[kIndex + 1] = nextKeyframe;}
\DoxyCodeLine{00455     m\_param-\/>setKeyframes(keyframes);}
\DoxyCodeLine{00456     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00457 }
\DoxyCodeLine{00458   \textcolor{keywordflow}{case} TDoubleKeyframe::EaseInOut:}
\DoxyCodeLine{00459   \textcolor{keywordflow}{case} TDoubleKeyframe::EaseInOutPercentage:}
\DoxyCodeLine{00460     \textcolor{keywordflow}{if} (keyframe.m\_type == TDoubleKeyframe::EaseInOut) \{}
\DoxyCodeLine{00461       \textcolor{comment}{// absolute -\/> percentage}}
\DoxyCodeLine{00462       ease0 = keyframe.m\_speedOut.x * 100.0 / segmentWidth;}
\DoxyCodeLine{00463       ease1 = -\/nextKeyframe.m\_speedIn.x * 100.0 / segmentWidth;}
\DoxyCodeLine{00464       \textcolor{comment}{// rounding could break constraints. crop parameters}}
\DoxyCodeLine{00465       ease0 = tcrop(ease0, 0.0, 100.0);}
\DoxyCodeLine{00466       ease1 = tcrop(ease1, 0.0, 100.0 -\/ ease0);}
\DoxyCodeLine{00467     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (keyframe.m\_type == TDoubleKeyframe::EaseInOutPercentage) \{}
\DoxyCodeLine{00468       \textcolor{comment}{// percentage -\/> absolute}}
\DoxyCodeLine{00469       ease0 = keyframe.m\_speedOut.x * 0.01 * segmentWidth;}
\DoxyCodeLine{00470       ease1 = -\/nextKeyframe.m\_speedIn.x * 0.01 * segmentWidth;}
\DoxyCodeLine{00471       \textcolor{comment}{// rounding could break constraints. crop parameters}}
\DoxyCodeLine{00472       ease0 = tcrop(ease0, 0.0, segmentWidth);}
\DoxyCodeLine{00473       ease1 = tcrop(ease1, 0.0, segmentWidth -\/ ease0);}
\DoxyCodeLine{00474     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00475       ease1 = ease0 = segmentWidth / 3;}
\DoxyCodeLine{00476     \}}
\DoxyCodeLine{00477     keyframe.m\_speedOut    = \mbox{\hyperlink{class_t_point_t}{TPointD}}(ease0, 0);}
\DoxyCodeLine{00478     nextKeyframe.m\_speedIn = \mbox{\hyperlink{class_t_point_t}{TPointD}}(-\/ease1, 0);}
\DoxyCodeLine{00479 }
\DoxyCodeLine{00480     keyframe.m\_type       = type;}
\DoxyCodeLine{00481     keyframes[kIndex]     = keyframe;}
\DoxyCodeLine{00482     keyframes[kIndex + 1] = nextKeyframe;}
\DoxyCodeLine{00483     m\_param-\/>setKeyframes(keyframes);}
\DoxyCodeLine{00484     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00485 }
\DoxyCodeLine{00486   \textcolor{keywordflow}{case} TDoubleKeyframe::Expression:}
\DoxyCodeLine{00487     keyframe.m\_type = type;}
\DoxyCodeLine{00488     \{}
\DoxyCodeLine{00489       \textcolor{keywordtype}{double} value      = m\_param-\/>getValue(keyframe.m\_frame);}
\DoxyCodeLine{00490       \textcolor{keyword}{const} \mbox{\hyperlink{class_t_unit}{TUnit}} *unit = 0;}
\DoxyCodeLine{00491       \textcolor{keywordflow}{if} (m\_param-\/>getMeasure()) unit = m\_param-\/>getMeasure()-\/>getCurrentUnit();}
\DoxyCodeLine{00492       \textcolor{keywordflow}{if} (unit) value = unit-\/>convertTo(value);}
\DoxyCodeLine{00493       keyframe.m\_expressionText = QString::number(value).toStdString();}
\DoxyCodeLine{00494     \}}
\DoxyCodeLine{00495     m\_param-\/>setKeyframe(kIndex, keyframe);}
\DoxyCodeLine{00496     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00497 }
\DoxyCodeLine{00498   \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00499     keyframe.m\_type = type;}
\DoxyCodeLine{00500     m\_param-\/>setKeyframe(kIndex, keyframe);}
\DoxyCodeLine{00501   \}}
\DoxyCodeLine{00502 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_acdee1631238f1fc4f88dd82cf7fbb83d}\label{class_keyframe_setter_acdee1631238f1fc4f88dd82cf7fbb83d}} 
\index{KeyframeSetter@{KeyframeSetter}!setType@{setType}}
\index{setType@{setType}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setType()}{setType()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Type (\begin{DoxyParamCaption}\item[{TDouble\+Keyframe\+::\+Type}]{type }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00504                                                      \{}
\DoxyCodeLine{00505   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00506   setType(m\_kIndex, type);}
\DoxyCodeLine{00507 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a54e10292a6066d79ce0ba09a216e7acb}\label{class_keyframe_setter_a54e10292a6066d79ce0ba09a216e7acb}} 
\index{KeyframeSetter@{KeyframeSetter}!setUnitName@{setUnitName}}
\index{setUnitName@{setUnitName}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setUnitName()}{setUnitName()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Unit\+Name (\begin{DoxyParamCaption}\item[{std\+::string}]{unit\+Name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00542                                                    \{}
\DoxyCodeLine{00543   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00544   m\_changed             = \textcolor{keyword}{true};}
\DoxyCodeLine{00545   m\_keyframe.m\_unitName = unitName;}
\DoxyCodeLine{00546   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00547 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_ac04036bf8b34d96c863aee4d7d43aff2}\label{class_keyframe_setter_ac04036bf8b34d96c863aee4d7d43aff2}} 
\index{KeyframeSetter@{KeyframeSetter}!setValue@{setValue}}
\index{setValue@{setValue}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setValue()}{setValue()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::set\+Value (\begin{DoxyParamCaption}\item[{double}]{value }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00549                                           \{}
\DoxyCodeLine{00550   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00551   \textcolor{keywordflow}{if} (m\_keyframe.m\_value == value) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00552   m\_changed          = \textcolor{keyword}{true};}
\DoxyCodeLine{00553   m\_keyframe.m\_value = value;}
\DoxyCodeLine{00554   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00555 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_ad72e0a769dd2652bda0e1bda175566b0}\label{class_keyframe_setter_ad72e0a769dd2652bda0e1bda175566b0}} 
\index{KeyframeSetter@{KeyframeSetter}!setValue@{setValue}}
\index{setValue@{setValue}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{setValue()}{setValue()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily static void Keyframe\+Setter\+::set\+Value (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_double_param}{TDouble\+Param}} $\ast$}]{curve,  }\item[{double}]{frame,  }\item[{double}]{value }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00098                                                                         \{}
\DoxyCodeLine{00099     \mbox{\hyperlink{class_keyframe_setter}{KeyframeSetter}} setter(curve);}
\DoxyCodeLine{00100     setter.createKeyframe(frame);}
\DoxyCodeLine{00101     setter.setValue(value);}
\DoxyCodeLine{00102   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_keyframe_setter_a80ea737ff58a32565916dcaaa18152f4}\label{class_keyframe_setter_a80ea737ff58a32565916dcaaa18152f4}} 
\index{KeyframeSetter@{KeyframeSetter}!unlinkHandles@{unlinkHandles}}
\index{unlinkHandles@{unlinkHandles}!KeyframeSetter@{KeyframeSetter}}
\doxysubsubsection{\texorpdfstring{unlinkHandles()}{unlinkHandles()}}
{\footnotesize\ttfamily void Keyframe\+Setter\+::unlink\+Handles (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00577                                    \{}
\DoxyCodeLine{00578   assert(m\_kIndex >= 0 \&\& m\_indices.size() == 1);}
\DoxyCodeLine{00579   \textcolor{keywordflow}{if} (!m\_keyframe.m\_linkedHandles) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00580   m\_changed                  = \textcolor{keyword}{true};}
\DoxyCodeLine{00581   m\_keyframe.m\_linkedHandles = \textcolor{keyword}{false};}
\DoxyCodeLine{00582   m\_param-\/>setKeyframe(m\_kIndex, m\_keyframe);}
\DoxyCodeLine{00583 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/toonz/doubleparamcmd.\+h\item 
E\+:/opentoonz/toonz/sources/toonzlib/doubleparamcmd.\+cpp\end{DoxyCompactItemize}
