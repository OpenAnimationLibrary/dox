\hypertarget{class_shift_trace_tool}{}\doxysection{Shift\+Trace\+Tool Class Reference}
\label{class_shift_trace_tool}\index{ShiftTraceTool@{ShiftTraceTool}}
Inheritance diagram for Shift\+Trace\+Tool\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_shift_trace_tool}
\end{center}
\end{figure}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Curve\+Status} \{ {\bfseries No\+Curve}
, {\bfseries Two\+Points\+Curve}
, {\bfseries Three\+Points\+Curve}
 \}
\item 
enum {\bfseries Gadget\+Id} \{ \newline
{\bfseries No\+Gadget}
, {\bfseries No\+Gadget\+\_\+\+In\+Box}
, {\bfseries Curve\+P0\+Gadget}
, {\bfseries Curve\+P1\+Gadget}
, \newline
{\bfseries Curve\+Pm\+Gadget}
, {\bfseries Move\+Center\+Gadget}
, {\bfseries Rotate\+Gadget}
, {\bfseries Translate\+Gadget}
, \newline
{\bfseries Scale\+Gadget}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_shift_trace_tool_a0b736f2800d55ba4a4060eb74075353e}{is\+Curve\+Gadget}} (Gadget\+Id id) const
\item 
\mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} \mbox{\hyperlink{class_shift_trace_tool_a63d6323a8fa3c0cd8b5d4a89edfb1223}{get\+Tool\+Type}} () const override
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a81829b5ecc81415560eca20e20834d97}{clear\+Data}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a13b9430d14ba51b14a02349f8d275b1d}{update\+Data}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_aa6f7f6159e36de9ae374e742db0e754c}{update\+Box}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_aa89fcdb2a232b2f269cda4315cef4392}{update\+Curve\+Affs}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_abc8784dea79e953068b652cf2261b925}{update\+Ghost}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a382cd777e8c033e878f038b1a5768573}{reset}} () override
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a430543df8aa3eb1288d3a91a3176b93f}{mouse\+Move}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&e) override
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a75f380a866f157f386ffeaae442d68ba}{left\+Button\+Down}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
void \mbox{\hyperlink{class_shift_trace_tool_aa2452ed333075e9569ab7869a96fbea7}{left\+Button\+Drag}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a8dcb1b96f4e618ad30c55b7760af2a3b}{left\+Button\+Up}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&, const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&) override
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a48727ff6695c72454138f4f10e69cf35}{draw}} () override
\begin{DoxyCompactList}\small\item\em Draws the tool on the viewer. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_t_affine}{TAffine}} \mbox{\hyperlink{class_shift_trace_tool_a7aff749dc42d1d772ee6682d28444663}{get\+Ghost\+Aff}} ()
\item 
Gadget\+Id \mbox{\hyperlink{class_shift_trace_tool_a567360aa1e162d7774dd518a523bbf39}{get\+Gadget}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&)
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a4b2e5e0ee70b2396eba8c6f7259f7d2c}{draw\+Dot}} (const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&center, double r, const TPixel32 \&color=TPixel32\+::\+White)
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a9c25c2ec5859de2536d2b9311c0c358f}{draw\+Control\+Rect}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_af566b00510d04ce0c0658836deb7d856}{draw\+Curve}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a8917dd8559f3e6d9fa59ff3c462a99a8}{on\+Activate}} () override
\begin{DoxyCompactList}\small\item\em Callback invoked whenever the tool activates. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_shift_trace_tool_a9c808812612a2b2372fb4fec4ffe7a4a}{on\+Deactivate}} () override
\begin{DoxyCompactList}\small\item\em Callback for tool deactivation, includes tool switch. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_shift_trace_tool_a22a808ff50e75dde59daac45dbb7081d}{on\+Leave}} () override
\begin{DoxyCompactList}\small\item\em Callback for the mouse leaving the viewer area. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_shift_trace_tool_a88850e7af83e957b7131123352fb0c42}{is\+Event\+Acceptable}} (QEvent $\ast$e) override
\item 
int \mbox{\hyperlink{class_shift_trace_tool_ac4ae96148da51a4373a16e789da6df78}{get\+Cursor\+Id}} () const override
\begin{DoxyCompactList}\small\item\em Returns the type of cursor used by the tool. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{class_shift_trace_tool_a887516af60026098f20cdc98e137e9c6}{get\+Current\+Ghost\+Index}} ()
\item 
void \mbox{\hyperlink{class_shift_trace_tool_a3c0b35b8d25d7cc4db6f5389e94d7aa0}{set\+Current\+Ghost\+Index}} (int index)
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{class_shift_trace_tool_a4e9077137e876b40bfba59e1d3f7241e}\label{class_shift_trace_tool_a4e9077137e876b40bfba59e1d3f7241e}} 
\index{ShiftTraceTool@{ShiftTraceTool}!CurveStatus@{CurveStatus}}
\index{CurveStatus@{CurveStatus}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{CurveStatus}{CurveStatus}}
{\footnotesize\ttfamily enum Shift\+Trace\+Tool\+::\+Curve\+Status}


\begin{DoxyCode}{0}
\DoxyCodeLine{00007                    \{}
\DoxyCodeLine{00008     NoCurve,}
\DoxyCodeLine{00009     TwoPointsCurve,  \textcolor{comment}{// just during the first click\&drag}}
\DoxyCodeLine{00010     ThreePointsCurve}
\DoxyCodeLine{00011   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a7b7d6a8659111471064614345b1b277a}\label{class_shift_trace_tool_a7b7d6a8659111471064614345b1b277a}} 
\index{ShiftTraceTool@{ShiftTraceTool}!GadgetId@{GadgetId}}
\index{GadgetId@{GadgetId}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{GadgetId}{GadgetId}}
{\footnotesize\ttfamily enum Shift\+Trace\+Tool\+::\+Gadget\+Id}


\begin{DoxyCode}{0}
\DoxyCodeLine{00013                 \{}
\DoxyCodeLine{00014     NoGadget,}
\DoxyCodeLine{00015     NoGadget\_InBox,}
\DoxyCodeLine{00016     CurveP0Gadget,}
\DoxyCodeLine{00017     CurveP1Gadget,}
\DoxyCodeLine{00018     CurvePmGadget,}
\DoxyCodeLine{00019     MoveCenterGadget,}
\DoxyCodeLine{00020     RotateGadget,}
\DoxyCodeLine{00021     TranslateGadget,}
\DoxyCodeLine{00022     ScaleGadget}
\DoxyCodeLine{00023   \};}

\end{DoxyCode}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_shift_trace_tool_a8d07e89f44537133150ab7a65c70401c}\label{class_shift_trace_tool_a8d07e89f44537133150ab7a65c70401c}} 
\index{ShiftTraceTool@{ShiftTraceTool}!ShiftTraceTool@{ShiftTraceTool}}
\index{ShiftTraceTool@{ShiftTraceTool}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{ShiftTraceTool()}{ShiftTraceTool()}}
{\footnotesize\ttfamily Shift\+Trace\+Tool\+::\+Shift\+Trace\+Tool (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00054     : \mbox{\hyperlink{class_t_tool_a9c63ec35f606e755d0d036bf4fed62ab}{TTool}}(\textcolor{stringliteral}{"{}T\_ShiftTrace"{}})}
\DoxyCodeLine{00055     , m\_ghostIndex(0)}
\DoxyCodeLine{00056     , m\_curveStatus(NoCurve)}
\DoxyCodeLine{00057     , m\_gadget(NoGadget)}
\DoxyCodeLine{00058     , m\_highlightedGadget(NoGadget) \{}
\DoxyCodeLine{00059   bind(TTool::AllTargets);  \textcolor{comment}{// Deals with tool deactivation internally}}
\DoxyCodeLine{00060 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_shift_trace_tool_a81829b5ecc81415560eca20e20834d97}\label{class_shift_trace_tool_a81829b5ecc81415560eca20e20834d97}} 
\index{ShiftTraceTool@{ShiftTraceTool}!clearData@{clearData}}
\index{clearData@{clearData}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{clearData()}{clearData()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::clear\+Data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00062                                \{}
\DoxyCodeLine{00063   m\_ghostIndex        = 0;}
\DoxyCodeLine{00064   m\_curveStatus       = NoCurve;}
\DoxyCodeLine{00065   m\_gadget            = NoGadget;}
\DoxyCodeLine{00066   m\_highlightedGadget = NoGadget;}
\DoxyCodeLine{00067 }
\DoxyCodeLine{00068   m\_box = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00069   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; i++) \{}
\DoxyCodeLine{00070     m\_row[i]    = -\/1;}
\DoxyCodeLine{00071     m\_aff[i]    = \mbox{\hyperlink{class_t_affine}{TAffine}}();}
\DoxyCodeLine{00072     m\_center[i] = \mbox{\hyperlink{class_t_point_t}{TPointD}}();}
\DoxyCodeLine{00073   \}}
\DoxyCodeLine{00074 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a48727ff6695c72454138f4f10e69cf35}\label{class_shift_trace_tool_a48727ff6695c72454138f4f10e69cf35}} 
\index{ShiftTraceTool@{ShiftTraceTool}!draw@{draw}}
\index{draw@{draw}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::draw (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Draws the tool on the viewer. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a058bf656d73bf3cd63b9826cbaaf48e0}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00570                           \{}
\DoxyCodeLine{00571   updateData();}
\DoxyCodeLine{00572   drawControlRect();}
\DoxyCodeLine{00573   drawCurve();}
\DoxyCodeLine{00574 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a9c25c2ec5859de2536d2b9311c0c358f}\label{class_shift_trace_tool_a9c25c2ec5859de2536d2b9311c0c358f}} 
\index{ShiftTraceTool@{ShiftTraceTool}!drawControlRect@{drawControlRect}}
\index{drawControlRect@{drawControlRect}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{drawControlRect()}{drawControlRect()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::draw\+Control\+Rect (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00228                                      \{  \textcolor{comment}{// TODO}}
\DoxyCodeLine{00229   \textcolor{keywordflow}{if} (m\_ghostIndex < 0 || m\_ghostIndex > 1) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00230   \textcolor{keywordtype}{int} row = m\_row[m\_ghostIndex];}
\DoxyCodeLine{00231   \textcolor{keywordflow}{if} (row < 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00232 }
\DoxyCodeLine{00233   \mbox{\hyperlink{class_t_rect_t}{TRectD}} box = m\_box;}
\DoxyCodeLine{00234   \textcolor{keywordflow}{if} (box.\mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{isEmpty}}()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00235   glPushMatrix();}
\DoxyCodeLine{00236   tglMultMatrix(getGhostAff());}
\DoxyCodeLine{00237 }
\DoxyCodeLine{00238   TPixel32 color;}
\DoxyCodeLine{00239 }
\DoxyCodeLine{00240   \textcolor{comment}{// draw onion-\/colored rectangle to indicate which ghost is grabbed}}
\DoxyCodeLine{00241   \{}
\DoxyCodeLine{00242     TPixel32 frontOniColor, backOniColor;}
\DoxyCodeLine{00243     \textcolor{keywordtype}{bool} inksOnly;}
\DoxyCodeLine{00244     Preferences::instance()-\/>getOnionData(frontOniColor, backOniColor,}
\DoxyCodeLine{00245                                           inksOnly);}
\DoxyCodeLine{00246     color       = (m\_ghostIndex == 0) ? backOniColor : frontOniColor;}
\DoxyCodeLine{00247     \textcolor{keywordtype}{double} unit = sqrt(tglGetPixelSize2());}
\DoxyCodeLine{00248     unit *= getDevPixRatio();}
\DoxyCodeLine{00249     \mbox{\hyperlink{class_t_rect_t}{TRectD}} coloredBox = box.enlarge(3.0 * unit);}
\DoxyCodeLine{00250     tglColor(color);}
\DoxyCodeLine{00251     glBegin(GL\_LINE\_STRIP);}
\DoxyCodeLine{00252     glVertex2d(coloredBox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, coloredBox.y0);}
\DoxyCodeLine{00253     glVertex2d(coloredBox.x1, coloredBox.y0);}
\DoxyCodeLine{00254     glVertex2d(coloredBox.x1, coloredBox.y1);}
\DoxyCodeLine{00255     glVertex2d(coloredBox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, coloredBox.y1);}
\DoxyCodeLine{00256     glVertex2d(coloredBox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, coloredBox.y0);}
\DoxyCodeLine{00257     glEnd();}
\DoxyCodeLine{00258   \}}
\DoxyCodeLine{00259 }
\DoxyCodeLine{00260   color = m\_highlightedGadget == TranslateGadget}
\DoxyCodeLine{00261               ? TPixel32(200, 100, 100)}
\DoxyCodeLine{00262               : m\_highlightedGadget == RotateGadget ? TPixel32(100, 200, 100)}
\DoxyCodeLine{00263                                                     : TPixel32(120, 120, 120);}
\DoxyCodeLine{00264   tglColor(color);}
\DoxyCodeLine{00265   glBegin(GL\_LINE\_STRIP);}
\DoxyCodeLine{00266   glVertex2d(box.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, box.y0);}
\DoxyCodeLine{00267   glVertex2d(box.x1, box.y0);}
\DoxyCodeLine{00268   glVertex2d(box.x1, box.y1);}
\DoxyCodeLine{00269   glVertex2d(box.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, box.y1);}
\DoxyCodeLine{00270   glVertex2d(box.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, box.y0);}
\DoxyCodeLine{00271   glEnd();}
\DoxyCodeLine{00272   color = m\_highlightedGadget == ScaleGadget ? TPixel32(200, 100, 100)}
\DoxyCodeLine{00273                                              : TPixel32::White;}
\DoxyCodeLine{00274   \textcolor{keywordtype}{double} r = 4 * sqrt(tglGetPixelSize2());}
\DoxyCodeLine{00275   drawDot(box.getP00(), r, color);}
\DoxyCodeLine{00276   drawDot(box.getP01(), r, color);}
\DoxyCodeLine{00277   drawDot(box.getP10(), r, color);}
\DoxyCodeLine{00278   drawDot(box.getP11(), r, color);}
\DoxyCodeLine{00279   \textcolor{keywordflow}{if} (m\_curveStatus == NoCurve) \{}
\DoxyCodeLine{00280     color = m\_highlightedGadget == MoveCenterGadget ? TPixel32(200, 100, 100)}
\DoxyCodeLine{00281                                                     : TPixel32::White;}
\DoxyCodeLine{00282     \mbox{\hyperlink{class_t_point_t}{TPointD}} c = m\_center[m\_ghostIndex];}
\DoxyCodeLine{00283     drawDot(c, r, color);}
\DoxyCodeLine{00284   \}}
\DoxyCodeLine{00285   glPopMatrix();}
\DoxyCodeLine{00286 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_af566b00510d04ce0c0658836deb7d856}\label{class_shift_trace_tool_af566b00510d04ce0c0658836deb7d856}} 
\index{ShiftTraceTool@{ShiftTraceTool}!drawCurve@{drawCurve}}
\index{drawCurve@{drawCurve}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{drawCurve()}{drawCurve()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::draw\+Curve (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00288                                \{}
\DoxyCodeLine{00289   \textcolor{keywordflow}{if} (m\_curveStatus == NoCurve) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00290   \textcolor{keywordtype}{double} r = 4 * sqrt(tglGetPixelSize2());}
\DoxyCodeLine{00291   \textcolor{keywordtype}{double} u = getPixelSize();}
\DoxyCodeLine{00292   \textcolor{keywordflow}{if} (m\_curveStatus == TwoPointsCurve) \{}
\DoxyCodeLine{00293     TPixel32 color = m\_highlightedGadget == CurveP0Gadget}
\DoxyCodeLine{00294                          ? TPixel32(200, 100, 100)}
\DoxyCodeLine{00295                          : TPixel32::White;}
\DoxyCodeLine{00296     drawDot(m\_p0, r, color);}
\DoxyCodeLine{00297     glColor3d(0.2, 0.2, 0.2);}
\DoxyCodeLine{00298     tglDrawSegment(m\_p0, m\_p1);}
\DoxyCodeLine{00299     drawDot(m\_p1, r, TPixel32::Red);}
\DoxyCodeLine{00300   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_curveStatus == ThreePointsCurve) \{}
\DoxyCodeLine{00301     TPixel32 color = m\_highlightedGadget == CurveP0Gadget}
\DoxyCodeLine{00302                          ? TPixel32(200, 100, 100)}
\DoxyCodeLine{00303                          : TPixel32::White;}
\DoxyCodeLine{00304     drawDot(m\_p0, r, color);}
\DoxyCodeLine{00305     color = m\_highlightedGadget == CurveP1Gadget ? TPixel32(200, 100, 100)}
\DoxyCodeLine{00306                                                  : TPixel32::White;}
\DoxyCodeLine{00307     drawDot(m\_p1, r, color);}
\DoxyCodeLine{00308 }
\DoxyCodeLine{00309     glColor3d(0.2, 0.2, 0.2);}
\DoxyCodeLine{00310 }
\DoxyCodeLine{00311     \mbox{\hyperlink{class_t_point_t}{TPointD}} center;}
\DoxyCodeLine{00312     \textcolor{keywordflow}{if} (circumCenter(center, m\_p0, m\_p1, m\_p2)) \{}
\DoxyCodeLine{00313       \textcolor{keywordtype}{double} radius = norm(center -\/ m\_p1);}
\DoxyCodeLine{00314       glBegin(GL\_LINE\_STRIP);}
\DoxyCodeLine{00315       \textcolor{keywordtype}{int} n = 100;}
\DoxyCodeLine{00316       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++) \{}
\DoxyCodeLine{00317         \textcolor{keywordtype}{double} t  = (double)i / n;}
\DoxyCodeLine{00318         \mbox{\hyperlink{class_t_point_t}{TPointD}} p = (1 -\/ t) * m\_p0 + t * m\_p2;}
\DoxyCodeLine{00319         p         = center + radius * normalize(p -\/ center);}
\DoxyCodeLine{00320         tglVertex(p);}
\DoxyCodeLine{00321       \}}
\DoxyCodeLine{00322       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++) \{}
\DoxyCodeLine{00323         \textcolor{keywordtype}{double} t  = (double)i / n;}
\DoxyCodeLine{00324         \mbox{\hyperlink{class_t_point_t}{TPointD}} p = (1 -\/ t) * m\_p2 + t * m\_p1;}
\DoxyCodeLine{00325         p         = center + radius * normalize(p -\/ center);}
\DoxyCodeLine{00326         tglVertex(p);}
\DoxyCodeLine{00327       \}}
\DoxyCodeLine{00328       glEnd();}
\DoxyCodeLine{00329     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00330       tglDrawSegment(m\_p0, m\_p1);}
\DoxyCodeLine{00331     \}}
\DoxyCodeLine{00332     color = m\_highlightedGadget == CurvePmGadget ? TPixel32(200, 100, 100)}
\DoxyCodeLine{00333                                                  : TPixel32::White;}
\DoxyCodeLine{00334     drawDot(m\_p2, r, color);}
\DoxyCodeLine{00335   \}}
\DoxyCodeLine{00336 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a4b2e5e0ee70b2396eba8c6f7259f7d2c}\label{class_shift_trace_tool_a4b2e5e0ee70b2396eba8c6f7259f7d2c}} 
\index{ShiftTraceTool@{ShiftTraceTool}!drawDot@{drawDot}}
\index{drawDot@{drawDot}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{drawDot()}{drawDot()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::draw\+Dot (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{center,  }\item[{double}]{r,  }\item[{const TPixel32 \&}]{color = {\ttfamily TPixel32\+:\+:White} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00221                                                     \{}
\DoxyCodeLine{00222   tglColor(color);}
\DoxyCodeLine{00223   tglDrawDisk(center, r);}
\DoxyCodeLine{00224   glColor3d(0.2, 0.2, 0.2);}
\DoxyCodeLine{00225   tglDrawCircle(center, r);}
\DoxyCodeLine{00226 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a887516af60026098f20cdc98e137e9c6}\label{class_shift_trace_tool_a887516af60026098f20cdc98e137e9c6}} 
\index{ShiftTraceTool@{ShiftTraceTool}!getCurrentGhostIndex@{getCurrentGhostIndex}}
\index{getCurrentGhostIndex@{getCurrentGhostIndex}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{getCurrentGhostIndex()}{getCurrentGhostIndex()}}
{\footnotesize\ttfamily int Shift\+Trace\+Tool\+::get\+Current\+Ghost\+Index (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00080 \{ \textcolor{keywordflow}{return} m\_ghostIndex; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_ac4ae96148da51a4373a16e789da6df78}\label{class_shift_trace_tool_ac4ae96148da51a4373a16e789da6df78}} 
\index{ShiftTraceTool@{ShiftTraceTool}!getCursorId@{getCursorId}}
\index{getCursorId@{getCursorId}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{getCursorId()}{getCursorId()}}
{\footnotesize\ttfamily int Shift\+Trace\+Tool\+::get\+Cursor\+Id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Returns the type of cursor used by the tool. 

\begin{DoxySeeAlso}{See also}
For a list of cursor ids \mbox{\hyperlink{}{cursor.\+h}} 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{class_t_tool_a1768a57b8b6d1480618fd923fad15f1d}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00576                                       \{}
\DoxyCodeLine{00577   \textcolor{keywordflow}{if} (m\_highlightedGadget == RotateGadget || m\_highlightedGadget == NoGadget)}
\DoxyCodeLine{00578     \textcolor{keywordflow}{return} ToolCursor::RotateCursor;}
\DoxyCodeLine{00579   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_highlightedGadget == ScaleGadget)}
\DoxyCodeLine{00580     \textcolor{keywordflow}{return} ToolCursor::ScaleCursor;}
\DoxyCodeLine{00581   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (isCurveGadget(m\_highlightedGadget))}
\DoxyCodeLine{00582     \textcolor{keywordflow}{return} ToolCursor::PinchCursor;}
\DoxyCodeLine{00583   \textcolor{keywordflow}{else}  \textcolor{comment}{// Curve Points, TranslateGadget, NoGadget\_InBox}}
\DoxyCodeLine{00584     \textcolor{keywordflow}{return} ToolCursor::MoveCursor;}
\DoxyCodeLine{00585 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a567360aa1e162d7774dd518a523bbf39}\label{class_shift_trace_tool_a567360aa1e162d7774dd518a523bbf39}} 
\index{ShiftTraceTool@{ShiftTraceTool}!getGadget@{getGadget}}
\index{getGadget@{getGadget}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{getGadget()}{getGadget()}}
{\footnotesize\ttfamily Shift\+Trace\+Tool\+::\+Gadget\+Id Shift\+Trace\+Tool\+::get\+Gadget (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{p }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00355                                                                  \{}
\DoxyCodeLine{00356   std::vector<std::pair<TPointD, GadgetId>> gadgets;}
\DoxyCodeLine{00357   gadgets.push\_back(std::make\_pair(m\_p0, CurveP0Gadget));}
\DoxyCodeLine{00358   gadgets.push\_back(std::make\_pair(m\_p1, CurveP1Gadget));}
\DoxyCodeLine{00359   gadgets.push\_back(std::make\_pair(m\_p2, CurvePmGadget));}
\DoxyCodeLine{00360   \mbox{\hyperlink{class_t_affine}{TAffine}} aff      = getGhostAff();}
\DoxyCodeLine{00361   \textcolor{keywordtype}{double} pixelSize = getPixelSize();}
\DoxyCodeLine{00362   \textcolor{keywordtype}{double} d         = 15 * pixelSize;  \textcolor{comment}{// offset for rotation handle}}
\DoxyCodeLine{00363   \textcolor{keywordflow}{if} (0 <= m\_ghostIndex \&\& m\_ghostIndex < 2) \{}
\DoxyCodeLine{00364     gadgets.push\_back(std::make\_pair(aff * m\_box.getP00(), ScaleGadget));}
\DoxyCodeLine{00365     gadgets.push\_back(std::make\_pair(aff * m\_box.getP01(), ScaleGadget));}
\DoxyCodeLine{00366     gadgets.push\_back(std::make\_pair(aff * m\_box.getP10(), ScaleGadget));}
\DoxyCodeLine{00367     gadgets.push\_back(std::make\_pair(aff * m\_box.getP11(), ScaleGadget));}
\DoxyCodeLine{00368     gadgets.push\_back(}
\DoxyCodeLine{00369         std::make\_pair(aff * m\_center[m\_ghostIndex], MoveCenterGadget));}
\DoxyCodeLine{00370   \}}
\DoxyCodeLine{00371   \textcolor{keywordtype}{int} k           = -\/1;}
\DoxyCodeLine{00372   \textcolor{keywordtype}{double} minDist2 = pow(10 * pixelSize, 2);}
\DoxyCodeLine{00373   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)gadgets.size(); i++) \{}
\DoxyCodeLine{00374     \textcolor{keywordtype}{double} d2 = norm2(gadgets[i].first -\/ p);}
\DoxyCodeLine{00375     \textcolor{keywordflow}{if} (d2 < minDist2) \{}
\DoxyCodeLine{00376       minDist2 = d2;}
\DoxyCodeLine{00377       k        = i;}
\DoxyCodeLine{00378     \}}
\DoxyCodeLine{00379   \}}
\DoxyCodeLine{00380   \textcolor{keywordflow}{if} (k >= 0) \textcolor{keywordflow}{return} gadgets[k].second;}
\DoxyCodeLine{00381 }
\DoxyCodeLine{00382   \textcolor{comment}{// rect-\/point}}
\DoxyCodeLine{00383   \textcolor{keywordflow}{if} (0 <= m\_ghostIndex \&\& m\_ghostIndex < 2) \{}
\DoxyCodeLine{00384     \mbox{\hyperlink{class_t_point_t}{TPointD}} q  = aff.\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}() * p;}
\DoxyCodeLine{00385     \textcolor{keywordtype}{double} \mbox{\hyperlink{structbig}{big}} = 1.0e6;}
\DoxyCodeLine{00386     \textcolor{keywordtype}{double} d = \mbox{\hyperlink{structbig}{big}}, x = 0, y = 0;}
\DoxyCodeLine{00387     \textcolor{keywordflow}{if} (m\_box.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} < q.x \&\& q.x < m\_box.x1) \{}
\DoxyCodeLine{00388       x         = q.x;}
\DoxyCodeLine{00389       \textcolor{keywordtype}{double} d0 = fabs(m\_box.y0 -\/ q.y);}
\DoxyCodeLine{00390       \textcolor{keywordtype}{double} d1 = fabs(m\_box.y1 -\/ q.y);}
\DoxyCodeLine{00391       \textcolor{keywordflow}{if} (d0 < d1) \{}
\DoxyCodeLine{00392         d = d0;}
\DoxyCodeLine{00393         y = m\_box.y0;}
\DoxyCodeLine{00394       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00395         d = d1;}
\DoxyCodeLine{00396         y = m\_box.y1;}
\DoxyCodeLine{00397       \}}
\DoxyCodeLine{00398     \}}
\DoxyCodeLine{00399     \textcolor{keywordflow}{if} (m\_box.y0 < q.y \&\& q.y < m\_box.y1) \{}
\DoxyCodeLine{00400       \textcolor{keywordtype}{double} d0 = fabs(m\_box.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} -\/ q.x);}
\DoxyCodeLine{00401       \textcolor{keywordtype}{double} d1 = fabs(m\_box.x1 -\/ q.x);}
\DoxyCodeLine{00402       \textcolor{keywordflow}{if} (d0 < d) \{}
\DoxyCodeLine{00403         d = d0;}
\DoxyCodeLine{00404         y = q.y;}
\DoxyCodeLine{00405         x = m\_box.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}};}
\DoxyCodeLine{00406       \}}
\DoxyCodeLine{00407       \textcolor{keywordflow}{if} (d1 < d) \{}
\DoxyCodeLine{00408         d = d1;}
\DoxyCodeLine{00409         y = q.y;}
\DoxyCodeLine{00410         x = m\_box.x1;}
\DoxyCodeLine{00411       \}}
\DoxyCodeLine{00412     \}}
\DoxyCodeLine{00413     \textcolor{keywordflow}{if} (d < \mbox{\hyperlink{structbig}{big}}) \{}
\DoxyCodeLine{00414       \mbox{\hyperlink{class_t_point_t}{TPointD}} pp = aff * \mbox{\hyperlink{class_t_point_t}{TPointD}}(x, y);}
\DoxyCodeLine{00415       \textcolor{keywordtype}{double} d   = norm(p -\/ pp);}
\DoxyCodeLine{00416       \textcolor{keywordflow}{if} (d < 10 * getPixelSize()) \{}
\DoxyCodeLine{00417         \textcolor{keywordflow}{if} (m\_box.contains(q))}
\DoxyCodeLine{00418           \textcolor{keywordflow}{return} TranslateGadget;}
\DoxyCodeLine{00419         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00420           \textcolor{keywordflow}{return} RotateGadget;}
\DoxyCodeLine{00421       \}}
\DoxyCodeLine{00422     \}}
\DoxyCodeLine{00423     \textcolor{keywordflow}{if} (m\_box.contains(q))}
\DoxyCodeLine{00424       \textcolor{keywordflow}{return} NoGadget\_InBox;}
\DoxyCodeLine{00425     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00426       \textcolor{keywordflow}{return} NoGadget;}
\DoxyCodeLine{00427   \}}
\DoxyCodeLine{00428   \textcolor{keywordflow}{return} NoGadget;}
\DoxyCodeLine{00429 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a7aff749dc42d1d772ee6682d28444663}\label{class_shift_trace_tool_a7aff749dc42d1d772ee6682d28444663}} 
\index{ShiftTraceTool@{ShiftTraceTool}!getGhostAff@{getGhostAff}}
\index{getGhostAff@{getGhostAff}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{getGhostAff()}{getGhostAff()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_affine}{TAffine}} Shift\+Trace\+Tool\+::get\+Ghost\+Aff (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00213                                     \{}
\DoxyCodeLine{00214   \textcolor{keywordflow}{if} (0 <= m\_ghostIndex \&\& m\_ghostIndex < 2)}
\DoxyCodeLine{00215     \textcolor{keywordflow}{return} m\_aff[m\_ghostIndex] * m\_dpiAff;}
\DoxyCodeLine{00216   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00217     \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_affine}{TAffine}}();}
\DoxyCodeLine{00218 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a63d6323a8fa3c0cd8b5d4a89edfb1223}\label{class_shift_trace_tool_a63d6323a8fa3c0cd8b5d4a89edfb1223}} 
\index{ShiftTraceTool@{ShiftTraceTool}!getToolType@{getToolType}}
\index{getToolType@{getToolType}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{getToolType()}{getToolType()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296c}{Tool\+Type}} Shift\+Trace\+Tool\+::get\+Tool\+Type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00048 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_tool_a391f099e6530ea54c71d81c9ee39296caa8f6293eab5817f82f74f031c0724f28}{GenericTool}}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a0b736f2800d55ba4a4060eb74075353e}\label{class_shift_trace_tool_a0b736f2800d55ba4a4060eb74075353e}} 
\index{ShiftTraceTool@{ShiftTraceTool}!isCurveGadget@{isCurveGadget}}
\index{isCurveGadget@{isCurveGadget}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{isCurveGadget()}{isCurveGadget()}}
{\footnotesize\ttfamily bool Shift\+Trace\+Tool\+::is\+Curve\+Gadget (\begin{DoxyParamCaption}\item[{Gadget\+Id}]{id }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00024                                                \{}
\DoxyCodeLine{00025     \textcolor{keywordflow}{return} CurveP0Gadget <= \textcolor{keywordtype}{id} \&\& \textcolor{keywordtype}{id} <= CurvePmGadget;}
\DoxyCodeLine{00026   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a88850e7af83e957b7131123352fb0c42}\label{class_shift_trace_tool_a88850e7af83e957b7131123352fb0c42}} 
\index{ShiftTraceTool@{ShiftTraceTool}!isEventAcceptable@{isEventAcceptable}}
\index{isEventAcceptable@{isEventAcceptable}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{isEventAcceptable()}{isEventAcceptable()}}
{\footnotesize\ttfamily bool Shift\+Trace\+Tool\+::is\+Event\+Acceptable (\begin{DoxyParamCaption}\item[{QEvent $\ast$}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00587                                                 \{}
\DoxyCodeLine{00588   \textcolor{comment}{// F1, F2 and F3 keys are used for flipping}}
\DoxyCodeLine{00589   QKeyEvent *keyEvent = \textcolor{keyword}{static\_cast<}QKeyEvent *\textcolor{keyword}{>}(e);}
\DoxyCodeLine{00590   \textcolor{keywordtype}{int} key             = keyEvent-\/>key();}
\DoxyCodeLine{00591   \textcolor{keywordflow}{return} (Qt::Key\_F1 <= key \&\& key <= Qt::Key\_F3);}
\DoxyCodeLine{00592 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a75f380a866f157f386ffeaae442d68ba}\label{class_shift_trace_tool_a75f380a866f157f386ffeaae442d68ba}} 
\index{ShiftTraceTool@{ShiftTraceTool}!leftButtonDown@{leftButtonDown}}
\index{leftButtonDown@{leftButtonDown}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDown()}{leftButtonDown()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::left\+Button\+Down (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00439                                                                             \{}
\DoxyCodeLine{00440   m\_gadget = m\_highlightedGadget;}
\DoxyCodeLine{00441   m\_oldPos = m\_startPos = pos;}
\DoxyCodeLine{00442 }
\DoxyCodeLine{00443   \textcolor{keywordtype}{bool} notify = \textcolor{keyword}{false};}
\DoxyCodeLine{00444 }
\DoxyCodeLine{00445   \textcolor{keywordflow}{if} (!e.isCtrlPressed() \&\&}
\DoxyCodeLine{00446       (m\_gadget == NoGadget || m\_gadget == NoGadget\_InBox)) \{}
\DoxyCodeLine{00447     \textcolor{keywordflow}{if} (m\_gadget == NoGadget\_InBox) \{}
\DoxyCodeLine{00448       m\_gadget = TranslateGadget;}
\DoxyCodeLine{00449     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00450       m\_gadget = RotateGadget;}
\DoxyCodeLine{00451     \}}
\DoxyCodeLine{00452 }
\DoxyCodeLine{00453     \textcolor{keywordtype}{int} row = getViewer()-\/>\mbox{\hyperlink{class_t_tool_1_1_viewer_aa68aee09530696a8996e835801ea59f2}{posToRow}}(e.\mbox{\hyperlink{class_t_mouse_event_a05a3f2378eb2179d121e2e46766916de}{m\_pos}}, 5.0, \textcolor{keyword}{false}, \textcolor{keyword}{true});}
\DoxyCodeLine{00454     \textcolor{keywordflow}{if} (row >= 0) \{}
\DoxyCodeLine{00455       \textcolor{keywordtype}{int} index         = -\/1;}
\DoxyCodeLine{00456       \mbox{\hyperlink{class_t_application}{TApplication}} *app = TTool::getApplication();}
\DoxyCodeLine{00457       \textcolor{keywordflow}{if} (app-\/>getCurrentFrame()-\/>isEditingScene()) \{}
\DoxyCodeLine{00458         \textcolor{keywordtype}{int} currentRow = \mbox{\hyperlink{class_t_tool_a85025fe6544609814a1672ded5847874}{getFrame}}();}
\DoxyCodeLine{00459         \textcolor{keywordflow}{if} (m\_row[0] >= 0 \&\& row < currentRow)}
\DoxyCodeLine{00460           index = 0;}
\DoxyCodeLine{00461         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_row[1] >= 0 \&\& row > currentRow)}
\DoxyCodeLine{00462           index = 1;}
\DoxyCodeLine{00463       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00464         \textcolor{keywordflow}{if} (m\_row[0] == row)}
\DoxyCodeLine{00465           index = 0;}
\DoxyCodeLine{00466         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_row[1] == row)}
\DoxyCodeLine{00467           index = 1;}
\DoxyCodeLine{00468       \}}
\DoxyCodeLine{00469 }
\DoxyCodeLine{00470       \textcolor{keywordflow}{if} (index >= 0) \{}
\DoxyCodeLine{00471         m\_ghostIndex = index;}
\DoxyCodeLine{00472         updateBox();}
\DoxyCodeLine{00473         m\_gadget            = TranslateGadget;}
\DoxyCodeLine{00474         m\_highlightedGadget = TranslateGadget;}
\DoxyCodeLine{00475         notify              = \textcolor{keyword}{true};}
\DoxyCodeLine{00476       \}}
\DoxyCodeLine{00477     \}}
\DoxyCodeLine{00478   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e.isCtrlPressed()) \{}
\DoxyCodeLine{00479     m\_gadget = NoGadget\_InBox;}
\DoxyCodeLine{00480   \}}
\DoxyCodeLine{00481 }
\DoxyCodeLine{00482   m\_oldAff = m\_aff[m\_ghostIndex];}
\DoxyCodeLine{00483   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00484 }
\DoxyCodeLine{00485   \textcolor{keywordflow}{if} (notify) \{}
\DoxyCodeLine{00486     TTool::getApplication()}
\DoxyCodeLine{00487         -\/>getCurrentTool()}
\DoxyCodeLine{00488         -\/>\mbox{\hyperlink{class_tool_handle_a39e34f1a30868bad11a629228b07bd40}{notifyToolChanged}}();  \textcolor{comment}{// Refreshes toolbar values}}
\DoxyCodeLine{00489   \}}
\DoxyCodeLine{00490 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_aa2452ed333075e9569ab7869a96fbea7}\label{class_shift_trace_tool_aa2452ed333075e9569ab7869a96fbea7}} 
\index{ShiftTraceTool@{ShiftTraceTool}!leftButtonDrag@{leftButtonDrag}}
\index{leftButtonDrag@{leftButtonDrag}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{leftButtonDrag()}{leftButtonDrag()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::left\+Button\+Drag (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00492                                                                             \{}
\DoxyCodeLine{00493   \textcolor{keywordflow}{if} (m\_gadget == NoGadget || m\_gadget == NoGadget\_InBox) \{}
\DoxyCodeLine{00494     \textcolor{keywordflow}{if} (norm(pos -\/ m\_oldPos) > 10 * getPixelSize()) \{}
\DoxyCodeLine{00495       m\_curveStatus = TwoPointsCurve;}
\DoxyCodeLine{00496       m\_p0          = m\_oldPos;}
\DoxyCodeLine{00497       m\_gadget      = CurveP1Gadget;}
\DoxyCodeLine{00498     \}}
\DoxyCodeLine{00499   \}}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501   \textcolor{keywordflow}{if} (isCurveGadget(m\_gadget)) \{}
\DoxyCodeLine{00502     \textcolor{keywordflow}{if} (m\_gadget == CurveP0Gadget)}
\DoxyCodeLine{00503       m\_p0 = pos;}
\DoxyCodeLine{00504     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_gadget == CurveP1Gadget)}
\DoxyCodeLine{00505       m\_p1 = pos;}
\DoxyCodeLine{00506     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00507       m\_p2 = pos;}
\DoxyCodeLine{00508     updateCurveAffs();}
\DoxyCodeLine{00509   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_gadget == RotateGadget) \{}
\DoxyCodeLine{00510     \mbox{\hyperlink{class_t_affine}{TAffine}} aff = getGhostAff();}
\DoxyCodeLine{00511     \mbox{\hyperlink{class_t_point_t}{TPointD}} c   = aff * m\_center[m\_ghostIndex];}
\DoxyCodeLine{00512     \mbox{\hyperlink{class_t_point_t}{TPointD}} a   = m\_oldPos -\/ c;}
\DoxyCodeLine{00513     \mbox{\hyperlink{class_t_point_t}{TPointD}} b   = pos -\/ c;}
\DoxyCodeLine{00514     m\_oldPos    = pos;}
\DoxyCodeLine{00515     \mbox{\hyperlink{class_t_point_t}{TPointD}} u   = normalize(a);}
\DoxyCodeLine{00516     \textcolor{keywordtype}{double} phi =}
\DoxyCodeLine{00517         atan2(-\/u.y * b.x + u.x * b.y, u.x * b.x + u.y * b.y) * 180.0 / 3.14153;}
\DoxyCodeLine{00518 }
\DoxyCodeLine{00519     \mbox{\hyperlink{class_t_point_t}{TPointD}} imgC = aff * m\_center[m\_ghostIndex];}
\DoxyCodeLine{00520 }
\DoxyCodeLine{00521     m\_aff[m\_ghostIndex] = \mbox{\hyperlink{class_t_rotation}{TRotation}}(imgC, phi) * m\_aff[m\_ghostIndex];}
\DoxyCodeLine{00522   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_gadget == MoveCenterGadget) \{}
\DoxyCodeLine{00523     \mbox{\hyperlink{class_t_affine}{TAffine}} aff   = getGhostAff().\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}();}
\DoxyCodeLine{00524     \mbox{\hyperlink{class_t_point_t}{TPointD}} delta = aff * pos -\/ aff * m\_oldPos;}
\DoxyCodeLine{00525     m\_oldPos      = pos;}
\DoxyCodeLine{00526     m\_center[m\_ghostIndex] += delta;}
\DoxyCodeLine{00527   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_gadget == TranslateGadget) \{}
\DoxyCodeLine{00528     \mbox{\hyperlink{class_t_point_t}{TPointD}} delta       = pos -\/ m\_oldPos;}
\DoxyCodeLine{00529     m\_oldPos            = pos;}
\DoxyCodeLine{00530     m\_aff[m\_ghostIndex] = \mbox{\hyperlink{class_t_translation}{TTranslation}}(delta) * m\_aff[m\_ghostIndex];}
\DoxyCodeLine{00531   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_gadget == ScaleGadget) \{}
\DoxyCodeLine{00532     \mbox{\hyperlink{class_t_affine}{TAffine}} aff  = getGhostAff();}
\DoxyCodeLine{00533     \mbox{\hyperlink{class_t_point_t}{TPointD}} c    = m\_center[m\_ghostIndex];}
\DoxyCodeLine{00534     \mbox{\hyperlink{class_t_point_t}{TPointD}} a    = aff.\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}() * m\_oldPos -\/ c;}
\DoxyCodeLine{00535     \mbox{\hyperlink{class_t_point_t}{TPointD}} b    = aff.\mbox{\hyperlink{class_t_affine_a570529b96b1ec5abc711aaa9aac09ff9}{inv}}() * pos -\/ c;}
\DoxyCodeLine{00536     \mbox{\hyperlink{class_t_point_t}{TPointD}} imgC = aff * m\_center[m\_ghostIndex];}
\DoxyCodeLine{00537 }
\DoxyCodeLine{00538     \textcolor{keywordflow}{if} (e.isShiftPressed())}
\DoxyCodeLine{00539       m\_aff[m\_ghostIndex] = \mbox{\hyperlink{class_t_scale}{TScale}}(imgC, b.x / a.x, b.y / a.y) * m\_oldAff;}
\DoxyCodeLine{00540     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00541       \textcolor{keywordtype}{double} scale        = std::max(b.x / a.x, b.y / a.y);}
\DoxyCodeLine{00542       m\_aff[m\_ghostIndex] = \mbox{\hyperlink{class_t_scale}{TScale}}(imgC, scale) * m\_oldAff;}
\DoxyCodeLine{00543     \}}
\DoxyCodeLine{00544   \}}
\DoxyCodeLine{00545 }
\DoxyCodeLine{00546   updateGhost();}
\DoxyCodeLine{00547   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00548 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a8dcb1b96f4e618ad30c55b7760af2a3b}\label{class_shift_trace_tool_a8dcb1b96f4e618ad30c55b7760af2a3b}} 
\index{ShiftTraceTool@{ShiftTraceTool}!leftButtonUp@{leftButtonUp}}
\index{leftButtonUp@{leftButtonUp}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{leftButtonUp()}{leftButtonUp()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::left\+Button\+Up (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00550                                                                          \{}
\DoxyCodeLine{00551   \textcolor{keywordflow}{if} (CurveP0Gadget <= m\_gadget \&\& m\_gadget <= CurvePmGadget) \{}
\DoxyCodeLine{00552     \textcolor{keywordflow}{if} (m\_curveStatus == TwoPointsCurve) \{}
\DoxyCodeLine{00553       m\_p2          = (m\_p0 + m\_p1) * 0.5;}
\DoxyCodeLine{00554       m\_curveStatus = ThreePointsCurve;}
\DoxyCodeLine{00555       updateCurveAffs();}
\DoxyCodeLine{00556       updateGhost();}
\DoxyCodeLine{00557 }
\DoxyCodeLine{00558       m\_center[0] = (m\_aff[0] * m\_dpiAff).inv() * m\_p2;}
\DoxyCodeLine{00559       m\_center[1] = (m\_aff[1] * m\_dpiAff).inv() * m\_p2;}
\DoxyCodeLine{00560     \}}
\DoxyCodeLine{00561   \}}
\DoxyCodeLine{00562   m\_gadget = NoGadget;}
\DoxyCodeLine{00563   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00564 }
\DoxyCodeLine{00565   TTool::getApplication()}
\DoxyCodeLine{00566       -\/>getCurrentTool()}
\DoxyCodeLine{00567       -\/>\mbox{\hyperlink{class_tool_handle_a39e34f1a30868bad11a629228b07bd40}{notifyToolChanged}}();  \textcolor{comment}{// Refreshes toolbar values}}
\DoxyCodeLine{00568 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a430543df8aa3eb1288d3a91a3176b93f}\label{class_shift_trace_tool_a430543df8aa3eb1288d3a91a3176b93f}} 
\index{ShiftTraceTool@{ShiftTraceTool}!mouseMove@{mouseMove}}
\index{mouseMove@{mouseMove}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{mouseMove()}{mouseMove()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::mouse\+Move (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_mouse_event}{TMouse\+Event}} \&}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00431                                                                        \{}
\DoxyCodeLine{00432   GadgetId highlightedGadget = getGadget(pos);}
\DoxyCodeLine{00433   \textcolor{keywordflow}{if} (highlightedGadget != m\_highlightedGadget) \{}
\DoxyCodeLine{00434     m\_highlightedGadget = highlightedGadget;}
\DoxyCodeLine{00435     \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00436   \}}
\DoxyCodeLine{00437 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a8917dd8559f3e6d9fa59ff3c462a99a8}\label{class_shift_trace_tool_a8917dd8559f3e6d9fa59ff3c462a99a8}} 
\index{ShiftTraceTool@{ShiftTraceTool}!onActivate@{onActivate}}
\index{onActivate@{onActivate}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{onActivate()}{onActivate()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::on\+Activate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback invoked whenever the tool activates. 



Reimplemented from \mbox{\hyperlink{class_t_tool_ac286a2681633b4db6106596b4f54e53b}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00338                                 \{}
\DoxyCodeLine{00339   m\_ghostIndex  = 0;}
\DoxyCodeLine{00340   m\_curveStatus = NoCurve;}
\DoxyCodeLine{00341   clearData();}
\DoxyCodeLine{00342   \mbox{\hyperlink{class_onion_skin_mask}{OnionSkinMask}} osm =}
\DoxyCodeLine{00343       TTool::getApplication()-\/>getCurrentOnionSkin()-\/>getOnionSkinMask();}
\DoxyCodeLine{00344   m\_aff[0]    = osm.getShiftTraceGhostAff(0);}
\DoxyCodeLine{00345   m\_aff[1]    = osm.getShiftTraceGhostAff(1);}
\DoxyCodeLine{00346   m\_center[0] = osm.getShiftTraceGhostCenter(0);}
\DoxyCodeLine{00347   m\_center[1] = osm.getShiftTraceGhostCenter(1);}
\DoxyCodeLine{00348 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a9c808812612a2b2372fb4fec4ffe7a4a}\label{class_shift_trace_tool_a9c808812612a2b2372fb4fec4ffe7a4a}} 
\index{ShiftTraceTool@{ShiftTraceTool}!onDeactivate@{onDeactivate}}
\index{onDeactivate@{onDeactivate}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{onDeactivate()}{onDeactivate()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::on\+Deactivate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for tool deactivation, includes tool switch. 



Reimplemented from \mbox{\hyperlink{class_t_tool_a00fee58728c1e12fb50846f47d7e9f5e}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00350                                   \{}
\DoxyCodeLine{00351   QAction *action = CommandManager::instance()-\/>getAction(\textcolor{stringliteral}{"{}MI\_EditShift"{}});}
\DoxyCodeLine{00352   action-\/>setChecked(\textcolor{keyword}{false});}
\DoxyCodeLine{00353 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a22a808ff50e75dde59daac45dbb7081d}\label{class_shift_trace_tool_a22a808ff50e75dde59daac45dbb7081d}} 
\index{ShiftTraceTool@{ShiftTraceTool}!onLeave@{onLeave}}
\index{onLeave@{onLeave}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{onLeave()}{onLeave()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::on\+Leave (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Callback for the mouse leaving the viewer area. 



Reimplemented from \mbox{\hyperlink{class_t_tool_af7fb05265a94131da081da654e271a22}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00594                              \{}
\DoxyCodeLine{00595   \mbox{\hyperlink{class_onion_skin_mask}{OnionSkinMask}} osm =}
\DoxyCodeLine{00596       TTool::getApplication()-\/>getCurrentOnionSkin()-\/>getOnionSkinMask();}
\DoxyCodeLine{00597   osm.clearGhostFlipKey();}
\DoxyCodeLine{00598   TTool::getApplication()-\/>getCurrentOnionSkin()-\/>setOnionSkinMask(osm);}
\DoxyCodeLine{00599 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a382cd777e8c033e878f038b1a5768573}\label{class_shift_trace_tool_a382cd777e8c033e878f038b1a5768573}} 
\index{ShiftTraceTool@{ShiftTraceTool}!reset@{reset}}
\index{reset@{reset}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::reset (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_tool}{TTool}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00202                            \{}
\DoxyCodeLine{00203   \textcolor{keywordtype}{int} ghostIndex = m\_ghostIndex;}
\DoxyCodeLine{00204   \mbox{\hyperlink{class_shift_trace_tool_a8917dd8559f3e6d9fa59ff3c462a99a8}{onActivate}}();}
\DoxyCodeLine{00205   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00206   m\_ghostIndex = ghostIndex;}
\DoxyCodeLine{00207 }
\DoxyCodeLine{00208   TTool::getApplication()}
\DoxyCodeLine{00209       -\/>getCurrentTool()}
\DoxyCodeLine{00210       -\/>\mbox{\hyperlink{class_tool_handle_a39e34f1a30868bad11a629228b07bd40}{notifyToolChanged}}();  \textcolor{comment}{// Refreshes toolbar values}}
\DoxyCodeLine{00211 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a3c0b35b8d25d7cc4db6f5389e94d7aa0}\label{class_shift_trace_tool_a3c0b35b8d25d7cc4db6f5389e94d7aa0}} 
\index{ShiftTraceTool@{ShiftTraceTool}!setCurrentGhostIndex@{setCurrentGhostIndex}}
\index{setCurrentGhostIndex@{setCurrentGhostIndex}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{setCurrentGhostIndex()}{setCurrentGhostIndex()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::set\+Current\+Ghost\+Index (\begin{DoxyParamCaption}\item[{int}]{index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00601                                                    \{}
\DoxyCodeLine{00602   m\_ghostIndex = index;}
\DoxyCodeLine{00603   updateBox();}
\DoxyCodeLine{00604   \mbox{\hyperlink{class_t_tool_a3e791336c642542c5648aa8ea86e2348}{invalidate}}();}
\DoxyCodeLine{00605 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_aa6f7f6159e36de9ae374e742db0e754c}\label{class_shift_trace_tool_aa6f7f6159e36de9ae374e742db0e754c}} 
\index{ShiftTraceTool@{ShiftTraceTool}!updateBox@{updateBox}}
\index{updateBox@{updateBox}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{updateBox()}{updateBox()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::update\+Box (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00076                                \{}
\DoxyCodeLine{00077   \textcolor{keywordflow}{if} (m\_ghostIndex < 0 || 2 <= m\_ghostIndex || m\_row[m\_ghostIndex] < 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00078 }
\DoxyCodeLine{00079   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img;}
\DoxyCodeLine{00080 }
\DoxyCodeLine{00081   \mbox{\hyperlink{class_t_application}{TApplication}} *app = TTool::getApplication();}
\DoxyCodeLine{00082   \textcolor{keywordflow}{if} (app-\/>getCurrentFrame()-\/>isEditingScene()) \{}
\DoxyCodeLine{00083     \textcolor{keywordtype}{int} col      = app-\/>getCurrentColumn()-\/>getColumnIndex();}
\DoxyCodeLine{00084     \textcolor{keywordtype}{int} row      = m\_row[m\_ghostIndex];}
\DoxyCodeLine{00085     \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh = app-\/>getCurrentXsheet()-\/>getXsheet();}
\DoxyCodeLine{00086 }
\DoxyCodeLine{00087     \mbox{\hyperlink{class_t_xsh_cell}{TXshCell}} cell       = xsh-\/>\mbox{\hyperlink{class_t_xsheet_a1ae81edf03bc7527176c84478c350f57}{getCell}}(row, col);}
\DoxyCodeLine{00088     \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl = cell.\mbox{\hyperlink{class_t_xsh_cell_a8898cc47eba24e59477bfba8e2511f1d}{getSimpleLevel}}();}
\DoxyCodeLine{00089     \textcolor{keywordflow}{if} (sl) \{}
\DoxyCodeLine{00090       m\_dpiAff = getDpiAffine(sl, cell.m\_frameId);}
\DoxyCodeLine{00091       img      = cell.\mbox{\hyperlink{class_t_xsh_cell_a20b623d308bc09b820ec6b116516f564}{getImage}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00092     \}}
\DoxyCodeLine{00093   \}}
\DoxyCodeLine{00094   \textcolor{comment}{// on editing level}}
\DoxyCodeLine{00095   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00096     \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *level = app-\/>getCurrentLevel()-\/>getLevel();}
\DoxyCodeLine{00097     \textcolor{keywordflow}{if} (!level) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00098     \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl = level-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}();}
\DoxyCodeLine{00099     \textcolor{keywordflow}{if} (!sl) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00100 }
\DoxyCodeLine{00101     \textcolor{keyword}{const} \mbox{\hyperlink{class_t_frame_id}{TFrameId}} \&ghostFid = sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_a07279a40ffad2c6ccc597c0a418f78fb}{index2fid}}(m\_row[m\_ghostIndex]);}
\DoxyCodeLine{00102     m\_dpiAff                 = getDpiAffine(sl, ghostFid);}
\DoxyCodeLine{00103     img                      = sl-\/>getFrame(ghostFid, \textcolor{keyword}{false});}
\DoxyCodeLine{00104   \}}
\DoxyCodeLine{00105 }
\DoxyCodeLine{00106   \textcolor{keywordflow}{if} (img) \{}
\DoxyCodeLine{00107     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri = img) \{}
\DoxyCodeLine{00108       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras = ri-\/>getRaster();}
\DoxyCodeLine{00109       m\_box        = (convert(ras-\/>getBounds()) -\/ ras-\/>getCenterD()) *}
\DoxyCodeLine{00110               ri-\/>getSubsampling();}
\DoxyCodeLine{00111     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} ti = img) \{}
\DoxyCodeLine{00112       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras = ti-\/>getRaster();}
\DoxyCodeLine{00113       m\_box        = (convert(ras-\/>getBounds()) -\/ ras-\/>getCenterD()) *}
\DoxyCodeLine{00114               ti-\/>getSubsampling();}
\DoxyCodeLine{00115     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img) \{}
\DoxyCodeLine{00116       m\_box = vi-\/>getBBox();}
\DoxyCodeLine{00117     \}}
\DoxyCodeLine{00118   \}}
\DoxyCodeLine{00119 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_aa89fcdb2a232b2f269cda4315cef4392}\label{class_shift_trace_tool_aa89fcdb2a232b2f269cda4315cef4392}} 
\index{ShiftTraceTool@{ShiftTraceTool}!updateCurveAffs@{updateCurveAffs}}
\index{updateCurveAffs@{updateCurveAffs}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{updateCurveAffs()}{updateCurveAffs()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::update\+Curve\+Affs (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00172                                      \{}
\DoxyCodeLine{00173   \textcolor{keywordflow}{if} (m\_curveStatus != ThreePointsCurve) \{}
\DoxyCodeLine{00174     m\_aff[0] = m\_aff[1] = \mbox{\hyperlink{class_t_affine}{TAffine}}();}
\DoxyCodeLine{00175   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00176     \textcolor{keywordtype}{double} phi0 = 0, phi1 = 0;}
\DoxyCodeLine{00177     \mbox{\hyperlink{class_t_point_t}{TPointD}} center;}
\DoxyCodeLine{00178     \textcolor{keywordflow}{if} (circumCenter(center, m\_p0, m\_p1, m\_p2)) \{}
\DoxyCodeLine{00179       \mbox{\hyperlink{class_t_point_t}{TPointD}} v0 = normalize(m\_p0 -\/ center);}
\DoxyCodeLine{00180       \mbox{\hyperlink{class_t_point_t}{TPointD}} v1 = normalize(m\_p1 -\/ center);}
\DoxyCodeLine{00181       \mbox{\hyperlink{class_t_point_t}{TPointD}} v2 = normalize(m\_p2 -\/ center);}
\DoxyCodeLine{00182       \mbox{\hyperlink{class_t_point_t}{TPointD}} u0(-\/v0.y, v0.x);}
\DoxyCodeLine{00183       \mbox{\hyperlink{class_t_point_t}{TPointD}} u1(-\/v1.y, v1.x);}
\DoxyCodeLine{00184       phi0 = atan2((v2 * u0), (v2 * v0)) * 180.0 / 3.1415;}
\DoxyCodeLine{00185       phi1 = atan2((v2 * u1), (v2 * v1)) * 180.0 / 3.1415;}
\DoxyCodeLine{00186     \}}
\DoxyCodeLine{00187     m\_aff[0] = \mbox{\hyperlink{class_t_translation}{TTranslation}}(m\_p2 -\/ m\_p0) * \mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_p0, phi0);}
\DoxyCodeLine{00188     m\_aff[1] = \mbox{\hyperlink{class_t_translation}{TTranslation}}(m\_p2 -\/ m\_p1) * \mbox{\hyperlink{class_t_rotation}{TRotation}}(m\_p1, phi1);}
\DoxyCodeLine{00189   \}}
\DoxyCodeLine{00190 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_a13b9430d14ba51b14a02349f8d275b1d}\label{class_shift_trace_tool_a13b9430d14ba51b14a02349f8d275b1d}} 
\index{ShiftTraceTool@{ShiftTraceTool}!updateData@{updateData}}
\index{updateData@{updateData}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{updateData()}{updateData()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::update\+Data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00121                                 \{}
\DoxyCodeLine{00122   m\_box = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00123   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; i++) m\_row[i] = -\/1;}
\DoxyCodeLine{00124   m\_dpiAff          = \mbox{\hyperlink{class_t_affine}{TAffine}}();}
\DoxyCodeLine{00125   \mbox{\hyperlink{class_t_application}{TApplication}} *app = TTool::getApplication();}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127   \mbox{\hyperlink{class_onion_skin_mask}{OnionSkinMask}} osm  = app-\/>getCurrentOnionSkin()-\/>getOnionSkinMask();}
\DoxyCodeLine{00128   \textcolor{keywordtype}{int} previousOffset = osm.getShiftTraceGhostFrameOffset(0);}
\DoxyCodeLine{00129   \textcolor{keywordtype}{int} forwardOffset  = osm.getShiftTraceGhostFrameOffset(1);}
\DoxyCodeLine{00130   \textcolor{comment}{// we must find the prev (m\_row[0]) and next (m\_row[1]) reference images}}
\DoxyCodeLine{00131   \textcolor{comment}{// (either might not exist)}}
\DoxyCodeLine{00132   \textcolor{comment}{// see also stage.cpp, StageBuilder::addCellWithOnionSkin}}
\DoxyCodeLine{00133   \textcolor{keywordflow}{if} (app-\/>getCurrentFrame()-\/>isEditingScene()) \{}
\DoxyCodeLine{00134     \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh  = app-\/>getCurrentXsheet()-\/>getXsheet();}
\DoxyCodeLine{00135     \textcolor{keywordtype}{int} row       = app-\/>getCurrentFrame()-\/>getFrame();}
\DoxyCodeLine{00136     \textcolor{keywordtype}{int} col       = app-\/>getCurrentColumn()-\/>getColumnIndex();}
\DoxyCodeLine{00137     \mbox{\hyperlink{class_t_xsh_cell}{TXshCell}} cell = xsh-\/>\mbox{\hyperlink{class_t_xsheet_a1ae81edf03bc7527176c84478c350f57}{getCell}}(row, col);}
\DoxyCodeLine{00138     \textcolor{keywordtype}{int} r;}
\DoxyCodeLine{00139     r = row + previousOffset;}
\DoxyCodeLine{00140     \textcolor{keywordflow}{if} (r >= 0 \&\& xsh-\/>\mbox{\hyperlink{class_t_xsheet_a1ae81edf03bc7527176c84478c350f57}{getCell}}(r, col) != cell \&\&}
\DoxyCodeLine{00141         (cell.\mbox{\hyperlink{class_t_xsh_cell_a8898cc47eba24e59477bfba8e2511f1d}{getSimpleLevel}}() == 0 ||}
\DoxyCodeLine{00142          xsh-\/>\mbox{\hyperlink{class_t_xsheet_a1ae81edf03bc7527176c84478c350f57}{getCell}}(r, col).\mbox{\hyperlink{class_t_xsh_cell_a8898cc47eba24e59477bfba8e2511f1d}{getSimpleLevel}}() == cell.\mbox{\hyperlink{class_t_xsh_cell_a8898cc47eba24e59477bfba8e2511f1d}{getSimpleLevel}}())) \{}
\DoxyCodeLine{00143       m\_row[0] = r;}
\DoxyCodeLine{00144     \}}
\DoxyCodeLine{00145 }
\DoxyCodeLine{00146     r = row + forwardOffset;}
\DoxyCodeLine{00147     \textcolor{keywordflow}{if} (r >= 0 \&\& xsh-\/>\mbox{\hyperlink{class_t_xsheet_a1ae81edf03bc7527176c84478c350f57}{getCell}}(r, col) != cell \&\&}
\DoxyCodeLine{00148         (cell.\mbox{\hyperlink{class_t_xsh_cell_a8898cc47eba24e59477bfba8e2511f1d}{getSimpleLevel}}() == 0 ||}
\DoxyCodeLine{00149          xsh-\/>\mbox{\hyperlink{class_t_xsheet_a1ae81edf03bc7527176c84478c350f57}{getCell}}(r, col).\mbox{\hyperlink{class_t_xsh_cell_a8898cc47eba24e59477bfba8e2511f1d}{getSimpleLevel}}() == cell.\mbox{\hyperlink{class_t_xsh_cell_a8898cc47eba24e59477bfba8e2511f1d}{getSimpleLevel}}())) \{}
\DoxyCodeLine{00150       m\_row[1] = r;}
\DoxyCodeLine{00151     \}}
\DoxyCodeLine{00152   \}}
\DoxyCodeLine{00153   \textcolor{comment}{// on editing level}}
\DoxyCodeLine{00154   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00155     \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *level = app-\/>getCurrentLevel()-\/>getLevel();}
\DoxyCodeLine{00156     \textcolor{keywordflow}{if} (level) \{}
\DoxyCodeLine{00157       \mbox{\hyperlink{class_t_xsh_simple_level}{TXshSimpleLevel}} *sl = level-\/>\mbox{\hyperlink{class_t_xsh_level_a023065559cff76164ecb6344c586ba27}{getSimpleLevel}}();}
\DoxyCodeLine{00158       \textcolor{keywordflow}{if} (sl) \{}
\DoxyCodeLine{00159         \mbox{\hyperlink{class_t_frame_id}{TFrameId}} fid = app-\/>getCurrentFrame()-\/>getFid();}
\DoxyCodeLine{00160         \textcolor{keywordtype}{int} row      = sl-\/>\mbox{\hyperlink{class_t_xsh_simple_level_af30a02239ef0900c095a0af366dea26a}{guessIndex}}(fid);}
\DoxyCodeLine{00161         m\_row[0]     = row + previousOffset;}
\DoxyCodeLine{00162         m\_row[1]     = row + forwardOffset;}
\DoxyCodeLine{00163       \}}
\DoxyCodeLine{00164     \}}
\DoxyCodeLine{00165   \}}
\DoxyCodeLine{00166   updateBox();}
\DoxyCodeLine{00167 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_shift_trace_tool_abc8784dea79e953068b652cf2261b925}\label{class_shift_trace_tool_abc8784dea79e953068b652cf2261b925}} 
\index{ShiftTraceTool@{ShiftTraceTool}!updateGhost@{updateGhost}}
\index{updateGhost@{updateGhost}!ShiftTraceTool@{ShiftTraceTool}}
\doxysubsubsection{\texorpdfstring{updateGhost()}{updateGhost()}}
{\footnotesize\ttfamily void Shift\+Trace\+Tool\+::update\+Ghost (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00192                                  \{}
\DoxyCodeLine{00193   \mbox{\hyperlink{class_onion_skin_mask}{OnionSkinMask}} osm =}
\DoxyCodeLine{00194       TTool::getApplication()-\/>getCurrentOnionSkin()-\/>getOnionSkinMask();}
\DoxyCodeLine{00195   osm.setShiftTraceGhostAff(0, m\_aff[0]);}
\DoxyCodeLine{00196   osm.setShiftTraceGhostAff(1, m\_aff[1]);}
\DoxyCodeLine{00197   osm.setShiftTraceGhostCenter(0, m\_center[0]);}
\DoxyCodeLine{00198   osm.setShiftTraceGhostCenter(1, m\_center[1]);}
\DoxyCodeLine{00199   TTool::getApplication()-\/>getCurrentOnionSkin()-\/>setOnionSkinMask(osm);}
\DoxyCodeLine{00200 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/tnztools/shifttracetool.\+h\item 
E\+:/opentoonz/toonz/sources/tnztools/shifttracetool.\+cpp\end{DoxyCompactItemize}
