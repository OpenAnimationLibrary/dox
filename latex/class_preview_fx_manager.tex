\hypertarget{class_preview_fx_manager}{}\doxysection{Preview\+Fx\+Manager Class Reference}
\label{class_preview_fx_manager}\index{PreviewFxManager@{PreviewFxManager}}


{\ttfamily \#include $<$previewfxmanager.\+h$>$}

Inheritance diagram for Preview\+Fx\+Manager\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_preview_fx_manager}
\end{center}
\end{figure}
\doxysubsection*{Signals}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_preview_fx_manager_a9b42e8da3aa5c3e5fbff0f550d233570}\label{class_preview_fx_manager_a9b42e8da3aa5c3e5fbff0f550d233570}} 
void {\bfseries started\+Frame} (unsigned long fx\+Id, \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} render\+Data)
\item 
\mbox{\Hypertarget{class_preview_fx_manager_a52184e69bb26182aa60c87ef25c8ee6d}\label{class_preview_fx_manager_a52184e69bb26182aa60c87ef25c8ee6d}} 
void {\bfseries rendered\+Frame} (unsigned long fx\+Id, \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} render\+Data)
\item 
\mbox{\Hypertarget{class_preview_fx_manager_a3e6b2668ed1fcc6e8e3b28c61771b059}\label{class_preview_fx_manager_a3e6b2668ed1fcc6e8e3b28c61771b059}} 
void {\bfseries refresh\+View\+Rects} (unsigned long fx\+Id)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$ \mbox{\hyperlink{class_preview_fx_manager_a5a633f9f858d2ea0e6ccee709d495b74}{show\+New\+Preview}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx, bool force\+Flipbook=false)
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a20c15e33d5294fb7644af987745d395b}{refresh\+View}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx)
\begin{DoxyCompactList}\small\item\em Updates the fx\textquotesingle{}s preview on the associated flipbooks\textquotesingle{} current views. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_preview_fx_manager_a6878f95e1fe7332a1b8654d9fe75e2a0}{detach}} (\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$flipbook)
\item 
void \mbox{\hyperlink{class_preview_fx_manager_ad87d57fda744ab77992cd27d16b938d9}{freeze}} (\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$flipbook)
\begin{DoxyCompactList}\small\item\em Freezes the specified flipbook. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_preview_fx_manager_a3a8064084ad56427682cbf63bda46708}{unfreeze}} (\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$flipbook)
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a3cf458cfc0955a610007cb537638d592}{reset}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx)
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a0e9f7dec7025ae3ab51734dbe8efe676}{reset}} (bool detach\+Flipbooks=true)
\begin{DoxyCompactList}\small\item\em Resets the \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} together with all internal rendering objects. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_preview_fx_manager_a76b7231f43b848e03de56425fe6d9e78}{reset}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx, int frame)
\item 
bool \mbox{\hyperlink{class_preview_fx_manager_a4156d45683027be3ba3f1d9bcb76641a}{is\+Sub\+Camera\+Active}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx)
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} $\ast$ \mbox{\hyperlink{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}{instance}} ()
\begin{DoxyCompactList}\small\item\em Returns the instance of the \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} object. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{class_preview_fx_manager_a69c365dff55ec1d15552c50a10961ea2}{suspend\+Rendering}} (bool suspend)
\end{DoxyCompactItemize}
\doxysubsection*{Protected Slots}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a85f16d9fc52b7f8aa1107820edc7c577}{on\+Level\+Changed}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_manager_accbd0bf1cf5db637b9061dbc2a351f5f}{on\+Fx\+Changed}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a8943baba2266000556d3ce8341d2f22b}{on\+Xsheet\+Changed}} ()
\item 
void \mbox{\hyperlink{class_preview_fx_manager_ab98667688dfdfa1ef71dcb1a21f094af}{on\+Object\+Changed}} (bool is\+Dragging)
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a6048e5a20b905a5f52f89e43a24c7c58}{on\+Started\+Frame}} (unsigned long fx\+Id, \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} render\+Data)
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a752299d7f319eb3b00d3e2f4b328f6a0}{on\+Rendered\+Frame}} (unsigned long fx\+Id, \mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}} render\+Data)
\item 
void \mbox{\hyperlink{class_preview_fx_manager_a5ff213fc7a8578c760139a1b3e8a58a7}{on\+Refresh\+View\+Rects}} (unsigned long id)
\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_preview_fx_manager_abe94a88f2ecb81d57a14b8fed98e91c7}{Preview\+Fx\+Instance}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Manages the \textquotesingle{}Preview Fx\textquotesingle{} requests and updates all contextually opened Flip\+Books when needed. The class provides the medium between the \textquotesingle{}Preview Fx\textquotesingle{} command and management of both Toonz rendering classes and Flipbooks. ~\newline
 ~\newline
The \mbox{\hyperlink{class_preview_fx_manager_a5a633f9f858d2ea0e6ccee709d495b74}{show\+New\+Preview()}} method invocation takes place when users activate the \textquotesingle{}Preview\textquotesingle{} command from the right-\/click menu of fxs in the schematic. It initializes a \mbox{\hyperlink{class_t_renderer}{TRenderer}} object and starts the render of passed fx over the preview properties range; at the same time, a new Flipbook is opened to visualize the images produced by the render process as frames are finalized. ~\newline
 ~\newline
The \mbox{\hyperlink{class_preview_fx_manager_a20c15e33d5294fb7644af987745d395b}{refresh\+View()}} command is available to update an fx\textquotesingle{}s view upon request (this is typically handled by flipbooks). The manager always renders the area strictly necessary to correctly update all flipbooks\textquotesingle{} current view; in particular, previously rendered portions of flipbook views are retained, and excluded from further calculations. ~\newline
Observe that invalidation signals coming from \mbox{\hyperlink{class_t_xsh_level_handle}{TXsh\+Level\+Handle}}, \mbox{\hyperlink{class_t_fx_handle}{TFx\+Handle}} and \mbox{\hyperlink{class_t_xsheet_handle}{TXsheet\+Handle}} classes are automatically intercepted to update all Flip\+Books created under the manager. ~\newline
 ~\newline
Additional \mbox{\hyperlink{class_preview_fx_manager_a3cf458cfc0955a610007cb537638d592}{reset()}} methods are available to clear the manager about a single fx or the whole scene\textquotesingle{}s fxs.

\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{class_flip_book}{Flip\+Book}}, \mbox{\hyperlink{class_t_xsh_level_handle}{TXsh\+Level\+Handle}}, \mbox{\hyperlink{class_t_fx_handle}{TFx\+Handle}}, \mbox{\hyperlink{class_t_xsheet_handle}{TXsheet\+Handle}} classes. 
\end{DoxySeeAlso}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_preview_fx_manager_a6878f95e1fe7332a1b8654d9fe75e2a0}\label{class_preview_fx_manager_a6878f95e1fe7332a1b8654d9fe75e2a0}} 
\index{PreviewFxManager@{PreviewFxManager}!detach@{detach}}
\index{detach@{detach}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{detach()}{detach()}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::detach (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$}]{flipbook }\end{DoxyParamCaption})}

Detaches the specified flipbook from the manager\textquotesingle{}s control. Optionally, the flipbooks may keep the already previewed images instead of discarding them -\/ however, observe that these images may be {\bfseries{cloned}} from the preview originals, in case some flipbook is still actively previewing the same fx. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01418                                                 \{}
\DoxyCodeLine{01419   \textcolor{comment}{// Retrieve its previewed fx}}
\DoxyCodeLine{01420   \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx(flipbook-\/>getPreviewedFx());}
\DoxyCodeLine{01421   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01422 }
\DoxyCodeLine{01423   \textcolor{comment}{// Search the flip among attached ones}}
\DoxyCodeLine{01424   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01425       m\_previewInstances.find(fx-\/>getIdentifier());}
\DoxyCodeLine{01426   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01427 }
\DoxyCodeLine{01428   \mbox{\hyperlink{class_preview_fx_instance}{PreviewFxInstance}} *previewInstance = it.value();}
\DoxyCodeLine{01429 }
\DoxyCodeLine{01430   \textcolor{comment}{// Detach the flipbook (does nothing if flipbook is frozen)}}
\DoxyCodeLine{01431   previewInstance-\/>detachFlipbook(flipbook);}
\DoxyCodeLine{01432 }
\DoxyCodeLine{01433   \textcolor{comment}{// Eventually, it could be in frozens; detach it from there too}}
\DoxyCodeLine{01434   std::set<FlipBook *> \&frozenFlips = previewInstance-\/>m\_frozenFlips;}
\DoxyCodeLine{01435 }
\DoxyCodeLine{01436   std::set<FlipBook *>::iterator jt = frozenFlips.find(flipbook);}
\DoxyCodeLine{01437   \textcolor{keywordflow}{if} (jt != frozenFlips.end()) \{}
\DoxyCodeLine{01438     flipbook-\/>clearCache();}
\DoxyCodeLine{01439     \textcolor{keyword}{delete} flipbook-\/>getProgressBarStatus();}
\DoxyCodeLine{01440     frozenFlips.erase(jt);}
\DoxyCodeLine{01441   \}}
\DoxyCodeLine{01442 }
\DoxyCodeLine{01443   \textcolor{comment}{// Finally, delete the preview instance if no flipbook (active or frozen)}}
\DoxyCodeLine{01444   \textcolor{comment}{// remain}}
\DoxyCodeLine{01445   \textcolor{keywordflow}{if} (previewInstance-\/>m\_flipbooks.empty() \&\&}
\DoxyCodeLine{01446       previewInstance-\/>m\_frozenFlips.empty()) \{}
\DoxyCodeLine{01447     \textcolor{keyword}{delete} it.value();}
\DoxyCodeLine{01448     m\_previewInstances.erase(it);}
\DoxyCodeLine{01449   \}}
\DoxyCodeLine{01450 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_ad87d57fda744ab77992cd27d16b938d9}\label{class_preview_fx_manager_ad87d57fda744ab77992cd27d16b938d9}} 
\index{PreviewFxManager@{PreviewFxManager}!freeze@{freeze}}
\index{freeze@{freeze}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{freeze()}{freeze()}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::freeze (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$}]{flipbook }\end{DoxyParamCaption})}



Freezes the specified flipbook. 

Observe that detached flipbooks which maintain the previewed images also maintain the internal reference to the previewed fx returned by the Flip\+Book\+::get\+Previewed\+Fx() method, so the flipbook may be re-\/attached (ie un-\/freezed) to the same preview fx. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01360                                                 \{}
\DoxyCodeLine{01361   \textcolor{comment}{// Retrieve its previewed fx}}
\DoxyCodeLine{01362   \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx(flipbook-\/>getPreviewedFx());}
\DoxyCodeLine{01363   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01364 }
\DoxyCodeLine{01365   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01366       m\_previewInstances.find(fx-\/>getIdentifier());}
\DoxyCodeLine{01367   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01368 }
\DoxyCodeLine{01369   \mbox{\hyperlink{class_preview_fx_instance}{PreviewFxInstance}} *previewInstance = it.value();}
\DoxyCodeLine{01370 }
\DoxyCodeLine{01371   \textcolor{comment}{// First off, detach the flipbook from the preview instance and}}
\DoxyCodeLine{01372   \textcolor{comment}{// insert it among the instance's frozen ones}}
\DoxyCodeLine{01373   previewInstance-\/>detachFlipbook(flipbook);}
\DoxyCodeLine{01374   previewInstance-\/>m\_frozenFlips.insert(flipbook);}
\DoxyCodeLine{01375 }
\DoxyCodeLine{01376   \textcolor{comment}{// Then, perform the level copy}}
\DoxyCodeLine{01377   \{}
\DoxyCodeLine{01378     std::string levelName(\textcolor{stringliteral}{"{}freezed"{}} + std::to\_string(flipbook-\/>getPoolIndex()) +}
\DoxyCodeLine{01379                           \textcolor{stringliteral}{"{}.noext"{}});}
\DoxyCodeLine{01380     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{01381 }
\DoxyCodeLine{01382     \textcolor{comment}{// Clone the preview images}}
\DoxyCodeLine{01383     \textcolor{keywordflow}{for} (i = previewInstance-\/>m\_start; i <= previewInstance-\/>m\_end;}
\DoxyCodeLine{01384          i += previewInstance-\/>m\_step) \{}
\DoxyCodeLine{01385       \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} cachedImage =}
\DoxyCodeLine{01386           TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_aea3ac2752efd6fa9689f5a7c1e895e41}{get}}(getCacheId(fx, i), \textcolor{keyword}{false});}
\DoxyCodeLine{01387       \textcolor{keywordflow}{if} (cachedImage)}
\DoxyCodeLine{01388         TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a124eae4cf370288f42c22b3477cb5163}{add}}(levelName + std::to\_string(i),}
\DoxyCodeLine{01389                                      cachedImage-\/>\mbox{\hyperlink{class_t_image_a3632b96b398057030a4adfe6917d2e28}{cloneImage}}());}
\DoxyCodeLine{01390     \}}
\DoxyCodeLine{01391 }
\DoxyCodeLine{01392     \textcolor{comment}{// Associate a level with the cached images}}
\DoxyCodeLine{01393     \mbox{\hyperlink{class_t_level_p}{TLevelP}} freezedLevel;}
\DoxyCodeLine{01394     freezedLevel-\/>setName(levelName);}
\DoxyCodeLine{01395     \textcolor{keywordflow}{for} (i = 0; i < previewInstance-\/>m\_level-\/>getFrameCount(); ++i)}
\DoxyCodeLine{01396       freezedLevel-\/>setFrame(\mbox{\hyperlink{class_t_frame_id}{TFrameId}}(i), 0);}
\DoxyCodeLine{01397     flipbook-\/>\mbox{\hyperlink{class_flip_book_ac70c72b88200e2821ea83f4273cb34e4}{setLevel}}(fx.getPointer(), previewInstance-\/>m\_xsheet.getPointer(),}
\DoxyCodeLine{01398                        freezedLevel.getPointer(), 0,}
\DoxyCodeLine{01399                        previewInstance-\/>m\_start + 1, previewInstance-\/>m\_end + 1,}
\DoxyCodeLine{01400                        previewInstance-\/>m\_step, flipbook-\/>getCurrentFrame(),}
\DoxyCodeLine{01401                        previewInstance-\/>m\_snd.getPointer());}
\DoxyCodeLine{01402 }
\DoxyCodeLine{01403     \textcolor{comment}{// Also, the associated PB must be cloned}}
\DoxyCodeLine{01404     std::vector<UCHAR> *newPBStatuses = \textcolor{keyword}{new} std::vector<UCHAR>;}
\DoxyCodeLine{01405     *newPBStatuses                    = previewInstance-\/>m\_pbStatus;}
\DoxyCodeLine{01406     flipbook-\/>setProgressBarStatus(newPBStatuses);}
\DoxyCodeLine{01407 }
\DoxyCodeLine{01408     \textcolor{comment}{// Traverse the PB: frames under rendering must be signed as uncompleted}}
\DoxyCodeLine{01409     std::vector<UCHAR>::iterator it;}
\DoxyCodeLine{01410     \textcolor{keywordflow}{for} (it = newPBStatuses-\/>begin(); it != newPBStatuses-\/>end(); ++it)}
\DoxyCodeLine{01411       \textcolor{keywordflow}{if} (*it == FlipSlider::PBFrameStarted)}
\DoxyCodeLine{01412         *it = FlipSlider::PBFrameNotStarted;}
\DoxyCodeLine{01413   \}}
\DoxyCodeLine{01414 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01153}{TImage\+Cache\+::add()}}, \mbox{\hyperlink{class_t_image_a3632b96b398057030a4adfe6917d2e28}{TImage\+::clone\+Image()}}, \mbox{\hyperlink{l01672}{TImage\+Cache\+::get()}}, and \mbox{\hyperlink{l01024}{Flip\+Book\+::set\+Level()}}.

\mbox{\Hypertarget{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}\label{class_preview_fx_manager_a540923ef1e799396ddf8bba11bb3c8c6}} 
\index{PreviewFxManager@{PreviewFxManager}!instance@{instance}}
\index{instance@{instance}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} $\ast$ Preview\+Fx\+Manager\+::instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Returns the instance of the \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} object. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01219                                              \{}
\DoxyCodeLine{01220   \textcolor{keyword}{static} \mbox{\hyperlink{class_preview_fx_manager}{PreviewFxManager}} \_instance;}
\DoxyCodeLine{01221   \textcolor{keywordflow}{return} \&\_instance;}
\DoxyCodeLine{01222 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a4156d45683027be3ba3f1d9bcb76641a}\label{class_preview_fx_manager_a4156d45683027be3ba3f1d9bcb76641a}} 
\index{PreviewFxManager@{PreviewFxManager}!isSubCameraActive@{isSubCameraActive}}
\index{isSubCameraActive@{isSubCameraActive}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{isSubCameraActive()}{isSubCameraActive()}}
{\footnotesize\ttfamily bool Preview\+Fx\+Manager\+::is\+Sub\+Camera\+Active (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}}]{fx }\end{DoxyParamCaption})}

return true if the preview fx instance for specified fx is with sub-\/camera activated 
\begin{DoxyCode}{0}
\DoxyCodeLine{01277                                                 \{}
\DoxyCodeLine{01278   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01279 }
\DoxyCodeLine{01280   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} fxId = fx-\/>getIdentifier();}
\DoxyCodeLine{01281   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01282       m\_previewInstances.find(fxId);}
\DoxyCodeLine{01283   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01284 }
\DoxyCodeLine{01285   \textcolor{keywordflow}{return} it.value()-\/>isSubCameraActive();}
\DoxyCodeLine{01286 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_accbd0bf1cf5db637b9061dbc2a351f5f}\label{class_preview_fx_manager_accbd0bf1cf5db637b9061dbc2a351f5f}} 
\index{PreviewFxManager@{PreviewFxManager}!onFxChanged@{onFxChanged}}
\index{onFxChanged@{onFxChanged}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{onFxChanged}{onFxChanged}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::on\+Fx\+Changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01475                                    \{}
\DoxyCodeLine{01476   \textcolor{comment}{// Examinate all RenderInstances for ancestors of current fx}}
\DoxyCodeLine{01477   \textcolor{keywordflow}{if} (m\_previewInstances.size()) \{}
\DoxyCodeLine{01478     \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a1d1d4b484617e7a938040554beca6282}{getCurrentFx}}()-\/>getFx();}
\DoxyCodeLine{01479 }
\DoxyCodeLine{01480     QMap<unsigned long, PreviewFxInstance *>::iterator it;}
\DoxyCodeLine{01481     \textcolor{keywordflow}{for} (it = m\_previewInstances.begin(); it != m\_previewInstances.end(); ++it)}
\DoxyCodeLine{01482     \textcolor{comment}{// if(areAncestorAndDescendant(it.value()-\/>m\_fx, fx))  //Currently not}}
\DoxyCodeLine{01483     \textcolor{comment}{// trespassing sub-\/xsheet boundaries}}
\DoxyCodeLine{01484     \{}
\DoxyCodeLine{01485       \textcolor{comment}{// in case the flipbook is frozen}}
\DoxyCodeLine{01486       \textcolor{keywordflow}{if} (it.value()-\/>m\_flipbooks.empty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01487       it.value()-\/>updateAliases();}
\DoxyCodeLine{01488       emit refreshViewRects(it.key());}
\DoxyCodeLine{01489       \textcolor{comment}{// it.value()-\/>refreshViewRects();}}
\DoxyCodeLine{01490     \}}
\DoxyCodeLine{01491   \}}
\DoxyCodeLine{01492 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a85f16d9fc52b7f8aa1107820edc7c577}\label{class_preview_fx_manager_a85f16d9fc52b7f8aa1107820edc7c577}} 
\index{PreviewFxManager@{PreviewFxManager}!onLevelChanged@{onLevelChanged}}
\index{onLevelChanged@{onLevelChanged}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{onLevelChanged}{onLevelChanged}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::on\+Level\+Changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01454                                       \{}
\DoxyCodeLine{01455   \textcolor{keywordflow}{if} (m\_previewInstances.size()) \{}
\DoxyCodeLine{01456     \textcolor{comment}{// Build the level name as an alias keyword. All cache images associated}}
\DoxyCodeLine{01457     \textcolor{comment}{// with an alias containing the level name will be updated.}}
\DoxyCodeLine{01458     \mbox{\hyperlink{class_t_xsh_level}{TXshLevel}} *xl = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_ad2923c9feaaa44ecd9cdd0fa029aa8aa}{getCurrentLevel}}()-\/>getLevel();}
\DoxyCodeLine{01459     std::string aliasKeyword;}
\DoxyCodeLine{01460     \mbox{\hyperlink{class_t_file_path}{TFilePath}} fp = xl-\/>\mbox{\hyperlink{class_t_xsh_level_ab8ffcf067cadf0e1c4081b54ffde249d}{getPath}}();}
\DoxyCodeLine{01461     aliasKeyword = ::to\_string(fp.\mbox{\hyperlink{class_t_file_path_a1437b0e0720e9258b622f68b6858e95d}{withType}}(\textcolor{stringliteral}{"{}"{}}));}
\DoxyCodeLine{01462 }
\DoxyCodeLine{01463     QMap<unsigned long, PreviewFxInstance *>::iterator it;}
\DoxyCodeLine{01464     \textcolor{keywordflow}{for} (it = m\_previewInstances.begin(); it != m\_previewInstances.end();}
\DoxyCodeLine{01465          ++it) \{}
\DoxyCodeLine{01466       it.value()-\/>updateAliasKeyword(aliasKeyword);}
\DoxyCodeLine{01467       emit refreshViewRects(it.key());}
\DoxyCodeLine{01468       \textcolor{comment}{// it.value()-\/>refreshViewRects();}}
\DoxyCodeLine{01469     \}}
\DoxyCodeLine{01470   \}}
\DoxyCodeLine{01471 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_ab98667688dfdfa1ef71dcb1a21f094af}\label{class_preview_fx_manager_ab98667688dfdfa1ef71dcb1a21f094af}} 
\index{PreviewFxManager@{PreviewFxManager}!onObjectChanged@{onObjectChanged}}
\index{onObjectChanged@{onObjectChanged}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{onObjectChanged}{onObjectChanged}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::on\+Object\+Changed (\begin{DoxyParamCaption}\item[{bool}]{is\+Dragging }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01517                                                       \{}
\DoxyCodeLine{01518   \textcolor{keywordflow}{if} (isDragging) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01519   \textcolor{comment}{// Update all rendered frames, if necessary}}
\DoxyCodeLine{01520   \textcolor{keywordflow}{if} (m\_previewInstances.size()) \{}
\DoxyCodeLine{01521     QMap<unsigned long, PreviewFxInstance *>::iterator it;}
\DoxyCodeLine{01522     \textcolor{keywordflow}{for} (it = m\_previewInstances.begin(); it != m\_previewInstances.end();}
\DoxyCodeLine{01523          ++it) \{}
\DoxyCodeLine{01524       \textcolor{comment}{// in case the flipbook is frozen}}
\DoxyCodeLine{01525       \textcolor{keywordflow}{if} (it.value()-\/>m\_flipbooks.empty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01526       it.value()-\/>updateFrameRange();}
\DoxyCodeLine{01527       it.value()-\/>updateFlipbookTitles();}
\DoxyCodeLine{01528       it.value()-\/>updateAliases();}
\DoxyCodeLine{01529       emit refreshViewRects(it.key());}
\DoxyCodeLine{01530       \textcolor{comment}{// it.value()-\/>refreshViewRects();}}
\DoxyCodeLine{01531     \}}
\DoxyCodeLine{01532   \}}
\DoxyCodeLine{01533 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a5ff213fc7a8578c760139a1b3e8a58a7}\label{class_preview_fx_manager_a5ff213fc7a8578c760139a1b3e8a58a7}} 
\index{PreviewFxManager@{PreviewFxManager}!onRefreshViewRects@{onRefreshViewRects}}
\index{onRefreshViewRects@{onRefreshViewRects}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{onRefreshViewRects}{onRefreshViewRects}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::on\+Refresh\+View\+Rects (\begin{DoxyParamCaption}\item[{unsigned long}]{id }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}

This slot is necessary to prevent problems with current implementation of the event-\/looping Preview\+Fx\+Instance\+::refresh\+View\+Rects function. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01306                                                           \{}
\DoxyCodeLine{01307   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01308       m\_previewInstances.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01309   \textcolor{keywordflow}{if} (it != m\_previewInstances.end()) it.value()-\/>refreshViewRects();}
\DoxyCodeLine{01310 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a752299d7f319eb3b00d3e2f4b328f6a0}\label{class_preview_fx_manager_a752299d7f319eb3b00d3e2f4b328f6a0}} 
\index{PreviewFxManager@{PreviewFxManager}!onRenderedFrame@{onRenderedFrame}}
\index{onRenderedFrame@{onRenderedFrame}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{onRenderedFrame}{onRenderedFrame}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::on\+Rendered\+Frame (\begin{DoxyParamCaption}\item[{unsigned long}]{fx\+Id,  }\item[{\mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}}}]{render\+Data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01664                                                                          \{}
\DoxyCodeLine{01665   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01666       m\_previewInstances.find(fxId);}
\DoxyCodeLine{01667   \textcolor{keywordflow}{if} (it != m\_previewInstances.end()) \{}
\DoxyCodeLine{01668     \textcolor{comment}{// Invoke the corresponding function. This happens in the MAIN THREAD}}
\DoxyCodeLine{01669     it.value()-\/>doOnRenderRasterCompleted(renderData);}
\DoxyCodeLine{01670   \}}
\DoxyCodeLine{01671 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a6048e5a20b905a5f52f89e43a24c7c58}\label{class_preview_fx_manager_a6048e5a20b905a5f52f89e43a24c7c58}} 
\index{PreviewFxManager@{PreviewFxManager}!onStartedFrame@{onStartedFrame}}
\index{onStartedFrame@{onStartedFrame}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{onStartedFrame}{onStartedFrame}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::on\+Started\+Frame (\begin{DoxyParamCaption}\item[{unsigned long}]{fx\+Id,  }\item[{\mbox{\hyperlink{struct_t_render_port_1_1_render_data}{TRender\+Port\+::\+Render\+Data}}}]{render\+Data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01652                                                                         \{}
\DoxyCodeLine{01653   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01654       m\_previewInstances.find(fxId);}
\DoxyCodeLine{01655   \textcolor{keywordflow}{if} (it != m\_previewInstances.end()) \{}
\DoxyCodeLine{01656     \textcolor{comment}{// Invoke the corresponding function. This happens in the MAIN THREAD}}
\DoxyCodeLine{01657     it.value()-\/>doOnRenderRasterStarted(renderData);}
\DoxyCodeLine{01658   \}}
\DoxyCodeLine{01659 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a8943baba2266000556d3ce8341d2f22b}\label{class_preview_fx_manager_a8943baba2266000556d3ce8341d2f22b}} 
\index{PreviewFxManager@{PreviewFxManager}!onXsheetChanged@{onXsheetChanged}}
\index{onXsheetChanged@{onXsheetChanged}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{onXsheetChanged}{onXsheetChanged}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::on\+Xsheet\+Changed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01496                                        \{}
\DoxyCodeLine{01497   \textcolor{comment}{// Update all rendered frames, if necessary}}
\DoxyCodeLine{01498   \textcolor{keywordflow}{if} (m\_previewInstances.size()) \{}
\DoxyCodeLine{01499     QMap<unsigned long, PreviewFxInstance *>::iterator it;}
\DoxyCodeLine{01500     \textcolor{keywordflow}{for} (it = m\_previewInstances.begin(); it != m\_previewInstances.end();}
\DoxyCodeLine{01501          ++it) \{}
\DoxyCodeLine{01502       \textcolor{comment}{// in case the flipbook is frozen}}
\DoxyCodeLine{01503       \textcolor{keywordflow}{if} (it.value()-\/>m\_flipbooks.empty()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01504       it.value()-\/>updateRenderSettings();}
\DoxyCodeLine{01505       it.value()-\/>updateCamera();}
\DoxyCodeLine{01506       it.value()-\/>updateFrameRange();}
\DoxyCodeLine{01507       it.value()-\/>updateFlipbookTitles();}
\DoxyCodeLine{01508       it.value()-\/>updateAliases();}
\DoxyCodeLine{01509       emit refreshViewRects(it.key());}
\DoxyCodeLine{01510       \textcolor{comment}{// it.value()-\/>refreshViewRects();}}
\DoxyCodeLine{01511     \}}
\DoxyCodeLine{01512   \}}
\DoxyCodeLine{01513 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a20c15e33d5294fb7644af987745d395b}\label{class_preview_fx_manager_a20c15e33d5294fb7644af987745d395b}} 
\index{PreviewFxManager@{PreviewFxManager}!refreshView@{refreshView}}
\index{refreshView@{refreshView}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{refreshView()}{refreshView()}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::refresh\+View (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}}]{fx }\end{DoxyParamCaption})}



Updates the fx\textquotesingle{}s preview on the associated flipbooks\textquotesingle{} current views. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01290                                           \{}
\DoxyCodeLine{01291   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01292 }
\DoxyCodeLine{01293   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} fxId = fx-\/>getIdentifier();}
\DoxyCodeLine{01294   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01295       m\_previewInstances.find(fxId);}
\DoxyCodeLine{01296   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01297 }
\DoxyCodeLine{01298   it.value()-\/>refreshViewRects();}
\DoxyCodeLine{01299 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a0e9f7dec7025ae3ab51734dbe8efe676}\label{class_preview_fx_manager_a0e9f7dec7025ae3ab51734dbe8efe676}} 
\index{PreviewFxManager@{PreviewFxManager}!reset@{reset}}
\index{reset@{reset}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::reset (\begin{DoxyParamCaption}\item[{bool}]{detach\+Flipbooks = {\ttfamily true} }\end{DoxyParamCaption})}



Resets the \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} together with all internal rendering objects. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01583                                                  \{}
\DoxyCodeLine{01584   \textcolor{comment}{// Hard copy the instances pointers}}
\DoxyCodeLine{01585   QMap<unsigned long, PreviewFxInstance *> previewInstances =}
\DoxyCodeLine{01586       m\_previewInstances;}
\DoxyCodeLine{01587 }
\DoxyCodeLine{01588   QMap<unsigned long, PreviewFxInstance *>::iterator it;}
\DoxyCodeLine{01589   \textcolor{keywordflow}{for} (it = previewInstances.begin(); it != previewInstances.end(); ++it) \{}
\DoxyCodeLine{01590     \textcolor{comment}{// Just like the above, stopRendering(true) event-\/LOOPS...}}
\DoxyCodeLine{01591     it.value()-\/>m\_renderer.stopRendering(\textcolor{keyword}{true});}
\DoxyCodeLine{01592 }
\DoxyCodeLine{01593     \textcolor{keywordflow}{if} (m\_previewInstances.find(it.key()) == m\_previewInstances.end()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01594 }
\DoxyCodeLine{01595     \textcolor{keywordflow}{if} (detachFlipbooks) \{}
\DoxyCodeLine{01596       \textcolor{comment}{// Reset all associated flipbooks}}
\DoxyCodeLine{01597       \mbox{\hyperlink{class_preview_fx_instance}{PreviewFxInstance}} *previewInstance = it.value();}
\DoxyCodeLine{01598 }
\DoxyCodeLine{01599       \textcolor{comment}{// Hard copy, since detach manipulates the original}}
\DoxyCodeLine{01600       std::set<FlipBook *> flipbooks = previewInstance-\/>m\_flipbooks;}
\DoxyCodeLine{01601 }
\DoxyCodeLine{01602       std::set<FlipBook *>::iterator jt;}
\DoxyCodeLine{01603       \textcolor{keywordflow}{for} (jt = flipbooks.begin(); jt != flipbooks.end(); ++jt) \{}
\DoxyCodeLine{01604         \textcolor{comment}{// Detach and reset the flipbook}}
\DoxyCodeLine{01605         (*jt)-\/>reset();  \textcolor{comment}{// The detachment happens in here}}
\DoxyCodeLine{01606       \}}
\DoxyCodeLine{01607 }
\DoxyCodeLine{01608       \textcolor{comment}{/*-\/ Frozen}}
\DoxyCodeLine{01609 \textcolor{comment}{       * Flipがひとつも無い場合には、この時点でpreviewInstanceが除外されている}}
\DoxyCodeLine{01610 \textcolor{comment}{       * -\/*/}}
\DoxyCodeLine{01611       \textcolor{keywordflow}{if} (m\_previewInstances.find(it.key()) == m\_previewInstances.end())}
\DoxyCodeLine{01612         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01613 }
\DoxyCodeLine{01614       \textcolor{comment}{// Same for frozen ones}}
\DoxyCodeLine{01615 }
\DoxyCodeLine{01616       \textcolor{keywordflow}{if} (!previewInstance-\/>m\_frozenFlips.empty() \&\&}
\DoxyCodeLine{01617           previewInstance-\/>m\_frozenFlips.size() < 20) \{}
\DoxyCodeLine{01618         std::set<FlipBook *> frozenFlips = previewInstance-\/>m\_frozenFlips;}
\DoxyCodeLine{01619         \textcolor{keywordflow}{for} (jt = frozenFlips.begin(); jt != frozenFlips.end(); ++jt) \{}
\DoxyCodeLine{01620           \textcolor{comment}{// Detach and reset the flipbook}}
\DoxyCodeLine{01621           (*jt)-\/>reset();  \textcolor{comment}{// The detachment happens in here}}
\DoxyCodeLine{01622         \}}
\DoxyCodeLine{01623       \}}
\DoxyCodeLine{01624 }
\DoxyCodeLine{01625       \textcolor{comment}{// The Preview instance should have been deleted at this point (due to}}
\DoxyCodeLine{01626       \textcolor{comment}{// flipbook detachments)}}
\DoxyCodeLine{01627       assert(m\_previewInstances.find(it.key()) == m\_previewInstances.end());}
\DoxyCodeLine{01628     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01629       it.value()-\/>reset();}
\DoxyCodeLine{01630       it.value()-\/>refreshViewRects();}
\DoxyCodeLine{01631     \}}
\DoxyCodeLine{01632   \}}
\DoxyCodeLine{01633 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a3cf458cfc0955a610007cb537638d592}\label{class_preview_fx_manager_a3cf458cfc0955a610007cb537638d592}} 
\index{PreviewFxManager@{PreviewFxManager}!reset@{reset}}
\index{reset@{reset}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::reset (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}}]{fx }\end{DoxyParamCaption})}

Resets the \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} for input fx. All previously rendered previews for it are cleared. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01539                                     \{}
\DoxyCodeLine{01540   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01541 }
\DoxyCodeLine{01542   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} fxId = fx-\/>getIdentifier();}
\DoxyCodeLine{01543   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01544       m\_previewInstances.find(fxId);}
\DoxyCodeLine{01545   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01546 }
\DoxyCodeLine{01547   it.value()-\/>m\_renderer.stopRendering(\textcolor{keyword}{true});}
\DoxyCodeLine{01548 }
\DoxyCodeLine{01549   \textcolor{comment}{// stopRendering(true) LOOPS and may destroy the preview instance. Recheck for}}
\DoxyCodeLine{01550   \textcolor{comment}{// its presence}}
\DoxyCodeLine{01551   it = m\_previewInstances.find(fxId);}
\DoxyCodeLine{01552   \textcolor{keywordflow}{if} (it != m\_previewInstances.end()) \{}
\DoxyCodeLine{01553     it.value()-\/>reset();}
\DoxyCodeLine{01554     it.value()-\/>refreshViewRects();}
\DoxyCodeLine{01555   \}}
\DoxyCodeLine{01556 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l01226}{show\+New\+Preview()}}.

\mbox{\Hypertarget{class_preview_fx_manager_a76b7231f43b848e03de56425fe6d9e78}\label{class_preview_fx_manager_a76b7231f43b848e03de56425fe6d9e78}} 
\index{PreviewFxManager@{PreviewFxManager}!reset@{reset}}
\index{reset@{reset}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::reset (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}}]{fx,  }\item[{int}]{frame }\end{DoxyParamCaption})}

Resets the \mbox{\hyperlink{class_preview_fx_manager}{Preview\+Fx\+Manager}} for input fx at frame. The previous rendered preview is cleared. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01560                                                \{}
\DoxyCodeLine{01561   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01562 }
\DoxyCodeLine{01563   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} fxId = fx-\/>getIdentifier();}
\DoxyCodeLine{01564   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01565       m\_previewInstances.find(fxId);}
\DoxyCodeLine{01566   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01567 }
\DoxyCodeLine{01568   \textcolor{keywordflow}{if} (it.value()-\/>m\_start > it.value()-\/>m\_end) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01569 }
\DoxyCodeLine{01570   it.value()-\/>m\_renderer.stopRendering(\textcolor{keyword}{true});}
\DoxyCodeLine{01571 }
\DoxyCodeLine{01572   \textcolor{comment}{// stopRendering(true) LOOPS and may destroy the preview instance. Recheck for}}
\DoxyCodeLine{01573   \textcolor{comment}{// its presence}}
\DoxyCodeLine{01574   it = m\_previewInstances.find(fxId);}
\DoxyCodeLine{01575   \textcolor{keywordflow}{if} (it != m\_previewInstances.end()) \{}
\DoxyCodeLine{01576     it.value()-\/>reset(frame);}
\DoxyCodeLine{01577     it.value()-\/>refreshViewRects();}
\DoxyCodeLine{01578   \}}
\DoxyCodeLine{01579 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a5a633f9f858d2ea0e6ccee709d495b74}\label{class_preview_fx_manager_a5a633f9f858d2ea0e6ccee709d495b74}} 
\index{PreviewFxManager@{PreviewFxManager}!showNewPreview@{showNewPreview}}
\index{showNewPreview@{showNewPreview}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{showNewPreview()}{showNewPreview()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$ Preview\+Fx\+Manager\+::show\+New\+Preview (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}}}]{fx,  }\item[{bool}]{force\+Flipbook = {\ttfamily false} }\end{DoxyParamCaption})}

Starts a preview instance for passed fx. If explicitly requested, a new flipbook is created to host the preview, otherwise the Preference settings are used. In the former case, the view refresh must be explicitly invoked using the \mbox{\hyperlink{class_preview_fx_manager_a20c15e33d5294fb7644af987745d395b}{refresh\+View()}} command, in order to allow changes of the flipbook\textquotesingle{}s view affine before it. The associated flipbook is returned, in case it has been created. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01226                                                                       \{}
\DoxyCodeLine{01227   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{01228 }
\DoxyCodeLine{01229   \textcolor{comment}{/*-\/-\/ fxIdは、Fxの作成ごとに１つずつインクリメントして割り振られる数字 -\/-\/*/}}
\DoxyCodeLine{01230   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} fxId                 = fx-\/>getIdentifier();}
\DoxyCodeLine{01231   \mbox{\hyperlink{class_preview_fx_instance}{PreviewFxInstance}} *previewInstance = 0;}
\DoxyCodeLine{01232 }
\DoxyCodeLine{01233   \textcolor{comment}{/*-\/-\/ PreviewFxInstanceをFxごとに作成する -\/-\/*/}}
\DoxyCodeLine{01234   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01235       m\_previewInstances.find(fxId);}
\DoxyCodeLine{01236   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \{}
\DoxyCodeLine{01237     \mbox{\hyperlink{class_t_xsheet}{TXsheet}} *xsh    = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_a13f509e753824cb0500787f68bb51a09}{getCurrentXsheet}}()-\/>getXsheet();}
\DoxyCodeLine{01238     previewInstance = \textcolor{keyword}{new} \mbox{\hyperlink{class_preview_fx_instance}{PreviewFxInstance}}(fx, xsh);}
\DoxyCodeLine{01239     m\_previewInstances.insert(fxId, previewInstance);}
\DoxyCodeLine{01240   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01241     previewInstance = it.value();}
\DoxyCodeLine{01242     \textcolor{comment}{/*-\/-\/ 以前PreviewしたことのあるFxを、再度Previewしたとき -\/-\/*/}}
\DoxyCodeLine{01243     \textcolor{keywordflow}{if} (!forceFlipbook \&\&}
\DoxyCodeLine{01244         !Preferences::instance()-\/>previewAlwaysOpenNewFlipEnabled()) \{}
\DoxyCodeLine{01245       \textcolor{comment}{// Search the first visible flipbook to be raised. If not found, add a new}}
\DoxyCodeLine{01246       \textcolor{comment}{// one.}}
\DoxyCodeLine{01247       \textcolor{comment}{/*-\/-\/}}
\DoxyCodeLine{01248 \textcolor{comment}{       * そのFxに関連付けられたFlipbookがあり、かつVisibleな場合は、reset()で再計算}}
\DoxyCodeLine{01249 \textcolor{comment}{       * -\/-\/*/}}
\DoxyCodeLine{01250       std::set<FlipBook *> \&flipbooks = previewInstance-\/>m\_flipbooks;}
\DoxyCodeLine{01251       std::set<FlipBook *>::iterator jt;}
\DoxyCodeLine{01252       \textcolor{keywordflow}{for} (jt = flipbooks.begin(); jt != flipbooks.end(); ++jt)}
\DoxyCodeLine{01253         \textcolor{keywordflow}{if} ((*jt)-\/>isVisible()) \{}
\DoxyCodeLine{01254           \mbox{\hyperlink{class_preview_fx_manager_a3cf458cfc0955a610007cb537638d592}{reset}}(fx);  \textcolor{comment}{// Also recalculate the preview}}
\DoxyCodeLine{01255           (*jt)-\/>parentWidget()-\/>raise();}
\DoxyCodeLine{01256           \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{01257         \}}
\DoxyCodeLine{01258     \}}
\DoxyCodeLine{01259   \}}
\DoxyCodeLine{01260 }
\DoxyCodeLine{01261   \mbox{\hyperlink{class_flip_book}{FlipBook}} *result = 0;}
\DoxyCodeLine{01262   \textcolor{comment}{/*-\/-\/ resultに必要なFlipbookを格納し、setLevelをする -\/-\/*/}}
\DoxyCodeLine{01263   previewInstance-\/>addFlipbook(result);}
\DoxyCodeLine{01264 }
\DoxyCodeLine{01265   \textcolor{comment}{/*-\/-\/ Flipbookのクローン時以外は forceFlipbookがfalse -\/-\/*/}}
\DoxyCodeLine{01266   \textcolor{keywordflow}{if} (!forceFlipbook) \textcolor{comment}{/*-\/-\/ startRenderを実行 -\/-\/*/}}
\DoxyCodeLine{01267     previewInstance-\/>refreshViewRects();}
\DoxyCodeLine{01268 }
\DoxyCodeLine{01269   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{01270 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00110}{TApp\+::get\+Current\+Xsheet()}}, \mbox{\hyperlink{l00215}{TApp\+::instance()}}, and \mbox{\hyperlink{l01539}{reset()}}.

\mbox{\Hypertarget{class_preview_fx_manager_a69c365dff55ec1d15552c50a10961ea2}\label{class_preview_fx_manager_a69c365dff55ec1d15552c50a10961ea2}} 
\index{PreviewFxManager@{PreviewFxManager}!suspendRendering@{suspendRendering}}
\index{suspendRendering@{suspendRendering}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{suspendRendering()}{suspendRendering()}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::suspend\+Rendering (\begin{DoxyParamCaption}\item[{bool}]{suspend }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

The suspend\+Rendering method allows suspension of the previewer\textquotesingle{}s rendering activity for safety purposes, typically related to the fact that no rendering process should actually be performed as the underlying scene is about to change or being destroyed. Upon suspension, further rendering requests are silently rejected -\/ and currently active ones are canceled and waited until they are no longer active. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01684                                                     \{}
\DoxyCodeLine{01685   suspendedRendering = suspend;}
\DoxyCodeLine{01686   \textcolor{keywordflow}{if} (suspend \&\& previewerInstance) \{}
\DoxyCodeLine{01687     QMap<unsigned long, PreviewFxInstance *>::iterator it;}
\DoxyCodeLine{01688     \textcolor{keywordflow}{for} (it = previewerInstance-\/>m\_previewInstances.begin();}
\DoxyCodeLine{01689          it != previewerInstance-\/>m\_previewInstances.end(); ++it) \{}
\DoxyCodeLine{01690       it.value()-\/>m\_renderer.stopRendering(\textcolor{keyword}{true});}
\DoxyCodeLine{01691     \}}
\DoxyCodeLine{01692   \}}
\DoxyCodeLine{01693 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_preview_fx_manager_a3a8064084ad56427682cbf63bda46708}\label{class_preview_fx_manager_a3a8064084ad56427682cbf63bda46708}} 
\index{PreviewFxManager@{PreviewFxManager}!unfreeze@{unfreeze}}
\index{unfreeze@{unfreeze}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{unfreeze()}{unfreeze()}}
{\footnotesize\ttfamily void Preview\+Fx\+Manager\+::unfreeze (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$}]{flipbook }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01314                                                   \{}
\DoxyCodeLine{01315   \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} fx(flipbook-\/>getPreviewedFx());}
\DoxyCodeLine{01316   \textcolor{keywordflow}{if} (!fx) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01317 }
\DoxyCodeLine{01318   QMap<unsigned long, PreviewFxInstance *>::iterator it =}
\DoxyCodeLine{01319       m\_previewInstances.find(fx-\/>getIdentifier());}
\DoxyCodeLine{01320   \textcolor{keywordflow}{if} (it == m\_previewInstances.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01321 }
\DoxyCodeLine{01322   \mbox{\hyperlink{class_preview_fx_instance}{PreviewFxInstance}} *previewInstance = it.value();}
\DoxyCodeLine{01323   std::set<FlipBook *> \&frozenFlips  = previewInstance-\/>m\_frozenFlips;}
\DoxyCodeLine{01324 }
\DoxyCodeLine{01325   std::set<FlipBook *>::iterator jt = frozenFlips.find(flipbook);}
\DoxyCodeLine{01326   \textcolor{keywordflow}{if} (jt == frozenFlips.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01327 }
\DoxyCodeLine{01328   \textcolor{comment}{// Re-\/attach to the preview instance}}
\DoxyCodeLine{01329   \{}
\DoxyCodeLine{01330     frozenFlips.erase(jt);}
\DoxyCodeLine{01331 }
\DoxyCodeLine{01332     \textcolor{comment}{// Before attaching, remove any old flipbook level from the cache}}
\DoxyCodeLine{01333     flipbook-\/>clearCache();}
\DoxyCodeLine{01334 }
\DoxyCodeLine{01335     \textcolor{comment}{// Also any associated pb status}}
\DoxyCodeLine{01336     \textcolor{keyword}{delete} flipbook-\/>getProgressBarStatus();}
\DoxyCodeLine{01337     flipbook-\/>setProgressBarStatus(NULL);}
\DoxyCodeLine{01338 }
\DoxyCodeLine{01339     previewInstance-\/>addFlipbook(flipbook);}
\DoxyCodeLine{01340 }
\DoxyCodeLine{01341     \textcolor{comment}{// recompute frames, if necessary (call the same process as}}
\DoxyCodeLine{01342     \textcolor{comment}{// PreviewFxManager::onXsheetChanged())}}
\DoxyCodeLine{01343     previewInstance-\/>updateRenderSettings();}
\DoxyCodeLine{01344     previewInstance-\/>updateCamera();}
\DoxyCodeLine{01345     previewInstance-\/>updateFrameRange();}
\DoxyCodeLine{01346     previewInstance-\/>updateFlipbookTitles();}
\DoxyCodeLine{01347     previewInstance-\/>updateAliases();}
\DoxyCodeLine{01348 }
\DoxyCodeLine{01349     previewInstance-\/>refreshViewRects();}
\DoxyCodeLine{01350   \}}
\DoxyCodeLine{01351 \}}

\end{DoxyCode}


\doxysubsection{Friends And Related Function Documentation}
\mbox{\Hypertarget{class_preview_fx_manager_abe94a88f2ecb81d57a14b8fed98e91c7}\label{class_preview_fx_manager_abe94a88f2ecb81d57a14b8fed98e91c7}} 
\index{PreviewFxManager@{PreviewFxManager}!PreviewFxInstance@{PreviewFxInstance}}
\index{PreviewFxInstance@{PreviewFxInstance}!PreviewFxManager@{PreviewFxManager}}
\doxysubsubsection{\texorpdfstring{PreviewFxInstance}{PreviewFxInstance}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{class_preview_fx_instance}{Preview\+Fx\+Instance}}\hspace{0.3cm}{\ttfamily [friend]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonz/previewfxmanager.\+h\item 
E\+:/opentoonz/toonz/sources/toonz/previewfxmanager.\+cpp\end{DoxyCompactItemize}
