\hypertarget{class_ffmpeg}{}\doxysection{Ffmpeg Class Reference}
\label{class_ffmpeg}\index{Ffmpeg@{Ffmpeg}}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_ffmpeg_a667179e020a27029ec04dede65eb5d1c}{create\+Intermediate\+Image}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&image, int frame\+Index)
\item 
void \mbox{\hyperlink{class_ffmpeg_aab09a0be7e8470b1e495d7dd64ee15cd}{run\+Ffmpeg}} (QString\+List pre\+IArgs, QString\+List post\+IArgs, bool includes\+In\+Path, bool includes\+Out\+Path, bool over\+Write\+Files)
\item 
\mbox{\Hypertarget{class_ffmpeg_a79a54923284b8f1e43cd7872464de79a}\label{class_ffmpeg_a79a54923284b8f1e43cd7872464de79a}} 
void {\bfseries run\+Ffmpeg} (QString\+List pre\+IArgs, QString\+List post\+IArgs, \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} path)
\item 
QString \mbox{\hyperlink{class_ffmpeg_a840b83b804dc3fe7cd9c39cfde7182a2}{run\+Ffprobe}} (QString\+List args)
\item 
void \mbox{\hyperlink{class_ffmpeg_a3fd392e56d59ad82a9f4e50e41b70d0f}{clean\+Up\+Files}} ()
\item 
void \mbox{\hyperlink{class_ffmpeg_a97bfa4634875cae54937194c77dec245}{add\+To\+Clean\+Up}} (QString)
\item 
void \mbox{\hyperlink{class_ffmpeg_a7e469302c5c0663a506f4f2d4cc9659b}{set\+Frame\+Rate}} (double fps)
\item 
void \mbox{\hyperlink{class_ffmpeg_a4bb8108e95a41c35421a804e66575664}{set\+Path}} (\mbox{\hyperlink{class_t_file_path}{TFile\+Path}} path)
\item 
void \mbox{\hyperlink{class_ffmpeg_ac298e4217eaf0a33c2e5355e06c9e376}{save\+Sound\+Track}} (\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$st)
\item 
bool \mbox{\hyperlink{class_ffmpeg_a916bf7ce282a41b1ea52270e43545bf2}{check\+Files\+Exist}} ()
\item 
double \mbox{\hyperlink{class_ffmpeg_a1c6db42fd1fade87b5924476b66f026a}{get\+Frame\+Rate}} ()
\item 
\mbox{\hyperlink{class_t_dimension_t}{TDimension}} \mbox{\hyperlink{class_ffmpeg_acc8206df1f7869cf203eb53aefc1307f}{get\+Size}} ()
\item 
int \mbox{\hyperlink{class_ffmpeg_ac29acc5563b0e01b3d1109a2481840d4}{get\+Frame\+Count}} ()
\item 
void \mbox{\hyperlink{class_ffmpeg_ad0badcc15aff8b0b9baa02ce7cf0ff80}{get\+Frames\+From\+Movie}} (int frame=-\/1)
\item 
\mbox{\hyperlink{class_t_raster_image_p}{TRaster\+ImageP}} \mbox{\hyperlink{class_ffmpeg_aea5e18425c5e39cc927b46da6c48670e}{get\+Image}} (int frame\+Index)
\item 
\mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \mbox{\hyperlink{class_ffmpeg_aeca74e9fd63377daa92a4085342fafbd}{get\+Ffmpeg\+Cache}} ()
\item 
\mbox{\hyperlink{structffmpeg_file_info}{ffmpeg\+File\+Info}} \mbox{\hyperlink{class_ffmpeg_ae591a73f641a124dab197d8d39914999}{get\+Info}} ()
\item 
void \mbox{\hyperlink{class_ffmpeg_af7cac242568bd38bc706a2f9b72d9597}{disable\+Precompute}} ()
\item 
int \mbox{\hyperlink{class_ffmpeg_a43d6e18536beca1619abca08fa7ee0dc}{get\+Gif\+Frame\+Count}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static bool \mbox{\hyperlink{class_ffmpeg_ac5b64e1d265071e913ec7104ad1acbf3}{check\+Ffmpeg}} ()
\item 
static bool \mbox{\hyperlink{class_ffmpeg_aee2f9d8ec644d892b156cf8264cb6e2d}{check\+Ffprobe}} ()
\item 
static bool \mbox{\hyperlink{class_ffmpeg_a735254401ea0de436e9bbc132fcdbf57}{check\+Format}} (std\+::string format)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_ffmpeg_a33134fbaeb6661f8adb907043a3d5651}\label{class_ffmpeg_a33134fbaeb6661f8adb907043a3d5651}} 
\index{Ffmpeg@{Ffmpeg}!Ffmpeg@{Ffmpeg}}
\index{Ffmpeg@{Ffmpeg}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{Ffmpeg()}{Ffmpeg()}}
{\footnotesize\ttfamily Ffmpeg\+::\+Ffmpeg (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00016                \{}
\DoxyCodeLine{00017   m\_ffmpegPath         = Preferences::instance()-\/>getFfmpegPath();}
\DoxyCodeLine{00018   m\_ffmpegTimeout      = Preferences::instance()-\/>getFfmpegTimeout() * 1000;}
\DoxyCodeLine{00019   std::string strPath  = m\_ffmpegPath.toStdString();}
\DoxyCodeLine{00020   m\_intermediateFormat = \textcolor{stringliteral}{"{}png"{}};}
\DoxyCodeLine{00021 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_adea5316394ee146d82412c4fc750ef0b}\label{class_ffmpeg_adea5316394ee146d82412c4fc750ef0b}} 
\index{Ffmpeg@{Ffmpeg}!````~Ffmpeg@{$\sim$Ffmpeg}}
\index{````~Ffmpeg@{$\sim$Ffmpeg}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{$\sim$Ffmpeg()}{~Ffmpeg()}}
{\footnotesize\ttfamily Ffmpeg\+::$\sim$\+Ffmpeg (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00022 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_ffmpeg_a97bfa4634875cae54937194c77dec245}\label{class_ffmpeg_a97bfa4634875cae54937194c77dec245}} 
\index{Ffmpeg@{Ffmpeg}!addToCleanUp@{addToCleanUp}}
\index{addToCleanUp@{addToCleanUp}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{addToCleanUp()}{addToCleanUp()}}
{\footnotesize\ttfamily void Ffmpeg\+::add\+To\+Clean\+Up (\begin{DoxyParamCaption}\item[{QString}]{path }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00508                                       \{}
\DoxyCodeLine{00509   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(path))) \{}
\DoxyCodeLine{00510     m\_cleanUpList.push\_back(path);}
\DoxyCodeLine{00511   \}}
\DoxyCodeLine{00512 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_ac5b64e1d265071e913ec7104ad1acbf3}\label{class_ffmpeg_ac5b64e1d265071e913ec7104ad1acbf3}} 
\index{Ffmpeg@{Ffmpeg}!checkFfmpeg@{checkFfmpeg}}
\index{checkFfmpeg@{checkFfmpeg}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{checkFfmpeg()}{checkFfmpeg()}}
{\footnotesize\ttfamily bool Ffmpeg\+::check\+Ffmpeg (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00024                          \{}
\DoxyCodeLine{00025   \textcolor{comment}{// check the user defined path in preferences first}}
\DoxyCodeLine{00026   QString path = Preferences::instance()-\/>getFfmpegPath() + \textcolor{stringliteral}{"{}/ffmpeg"{}};}
\DoxyCodeLine{00027 \textcolor{preprocessor}{\#if defined(\_WIN32)}}
\DoxyCodeLine{00028   path = path + \textcolor{stringliteral}{"{}.exe"{}};}
\DoxyCodeLine{00029 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(path))) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032   \textcolor{comment}{// check the OpenToonz root directory next}}
\DoxyCodeLine{00033   path = QDir::currentPath() + \textcolor{stringliteral}{"{}/ffmpeg"{}};}
\DoxyCodeLine{00034 \textcolor{preprocessor}{\#if defined(\_WIN32)}}
\DoxyCodeLine{00035   path = path + \textcolor{stringliteral}{"{}.exe"{}};}
\DoxyCodeLine{00036 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00037   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(path))) \{}
\DoxyCodeLine{00038     Preferences::instance()-\/>setValue(ffmpegPath, QDir::currentPath());}
\DoxyCodeLine{00039     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00040   \}}
\DoxyCodeLine{00041 }
\DoxyCodeLine{00042   \textcolor{comment}{// give up}}
\DoxyCodeLine{00043   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00044 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_aee2f9d8ec644d892b156cf8264cb6e2d}\label{class_ffmpeg_aee2f9d8ec644d892b156cf8264cb6e2d}} 
\index{Ffmpeg@{Ffmpeg}!checkFfprobe@{checkFfprobe}}
\index{checkFfprobe@{checkFfprobe}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{checkFfprobe()}{checkFfprobe()}}
{\footnotesize\ttfamily bool Ffmpeg\+::check\+Ffprobe (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00046                           \{}
\DoxyCodeLine{00047   \textcolor{comment}{// check the user defined path in preferences first}}
\DoxyCodeLine{00048   QString path = Preferences::instance()-\/>getFfmpegPath() + \textcolor{stringliteral}{"{}/ffprobe"{}};}
\DoxyCodeLine{00049 \textcolor{preprocessor}{\#if defined(\_WIN32)}}
\DoxyCodeLine{00050   path = path + \textcolor{stringliteral}{"{}.exe"{}};}
\DoxyCodeLine{00051 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00052   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(path))) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054   \textcolor{comment}{// check the OpenToonz root directory next}}
\DoxyCodeLine{00055   path = QDir::currentPath() + \textcolor{stringliteral}{"{}/ffprobe"{}};}
\DoxyCodeLine{00056 \textcolor{preprocessor}{\#if defined(\_WIN32)}}
\DoxyCodeLine{00057   path = path + \textcolor{stringliteral}{"{}.exe"{}};}
\DoxyCodeLine{00058 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00059   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(path))) \{}
\DoxyCodeLine{00060     Preferences::instance()-\/>setValue(ffmpegPath, QDir::currentPath());}
\DoxyCodeLine{00061     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00062   \}}
\DoxyCodeLine{00063 }
\DoxyCodeLine{00064   \textcolor{comment}{// give up}}
\DoxyCodeLine{00065   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00066 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a916bf7ce282a41b1ea52270e43545bf2}\label{class_ffmpeg_a916bf7ce282a41b1ea52270e43545bf2}} 
\index{Ffmpeg@{Ffmpeg}!checkFilesExist@{checkFilesExist}}
\index{checkFilesExist@{checkFilesExist}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{checkFilesExist()}{checkFilesExist()}}
{\footnotesize\ttfamily bool Ffmpeg\+::check\+Files\+Exist (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00261                              \{}
\DoxyCodeLine{00262   QString ffmpegCachePath = getFfmpegCache().getQString();}
\DoxyCodeLine{00263   QString tempPath = ffmpegCachePath + \textcolor{stringliteral}{"{}//"{}} + cleanPathSymbols() + \textcolor{stringliteral}{"{}In0001."{}} +}
\DoxyCodeLine{00264                      m\_intermediateFormat;}
\DoxyCodeLine{00265   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(tempPath))) \{}
\DoxyCodeLine{00266     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00267   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00268     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00269 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a735254401ea0de436e9bbc132fcdbf57}\label{class_ffmpeg_a735254401ea0de436e9bbc132fcdbf57}} 
\index{Ffmpeg@{Ffmpeg}!checkFormat@{checkFormat}}
\index{checkFormat@{checkFormat}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{checkFormat()}{checkFormat()}}
{\footnotesize\ttfamily bool Ffmpeg\+::check\+Format (\begin{DoxyParamCaption}\item[{std\+::string}]{format }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00068                                          \{}
\DoxyCodeLine{00069   QString path = Preferences::instance()-\/>getFfmpegPath() + \textcolor{stringliteral}{"{}/ffmpeg"{}};}
\DoxyCodeLine{00070 \textcolor{preprocessor}{\#if defined(\_WIN32)}}
\DoxyCodeLine{00071   path = path + \textcolor{stringliteral}{"{}.exe"{}};}
\DoxyCodeLine{00072 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00073   QStringList args;}
\DoxyCodeLine{00074   args << \textcolor{stringliteral}{"{}-\/formats"{}};}
\DoxyCodeLine{00075   QProcess ffmpeg;}
\DoxyCodeLine{00076   ffmpeg.start(path, args);}
\DoxyCodeLine{00077   ffmpeg.waitForFinished();}
\DoxyCodeLine{00078   QString results = ffmpeg.readAllStandardError();}
\DoxyCodeLine{00079   results += ffmpeg.readAllStandardOutput();}
\DoxyCodeLine{00080   ffmpeg.close();}
\DoxyCodeLine{00081   std::string strResults = results.toStdString();}
\DoxyCodeLine{00082   std::string::size\_type n;}
\DoxyCodeLine{00083   n = strResults.find(format);}
\DoxyCodeLine{00084   \textcolor{keywordflow}{if} (n != std::string::npos)}
\DoxyCodeLine{00085     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00086   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00087     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00088 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a3fd392e56d59ad82a9f4e50e41b70d0f}\label{class_ffmpeg_a3fd392e56d59ad82a9f4e50e41b70d0f}} 
\index{Ffmpeg@{Ffmpeg}!cleanUpFiles@{cleanUpFiles}}
\index{cleanUpFiles@{cleanUpFiles}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{cleanUpFiles()}{cleanUpFiles()}}
{\footnotesize\ttfamily void Ffmpeg\+::clean\+Up\+Files (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00514                           \{}
\DoxyCodeLine{00515   \textcolor{keywordflow}{for} (QString path : m\_cleanUpList) \{}
\DoxyCodeLine{00516     \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(path))) \{}
\DoxyCodeLine{00517       TSystem::deleteFile(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(path));}
\DoxyCodeLine{00518     \}}
\DoxyCodeLine{00519   \}}
\DoxyCodeLine{00520 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a667179e020a27029ec04dede65eb5d1c}\label{class_ffmpeg_a667179e020a27029ec04dede65eb5d1c}} 
\index{Ffmpeg@{Ffmpeg}!createIntermediateImage@{createIntermediateImage}}
\index{createIntermediateImage@{createIntermediateImage}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{createIntermediateImage()}{createIntermediateImage()}}
{\footnotesize\ttfamily void Ffmpeg\+::create\+Intermediate\+Image (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&}]{image,  }\item[{int}]{frame\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00104                                                                        \{}
\DoxyCodeLine{00105   m\_frameCount++;}
\DoxyCodeLine{00106   \textcolor{keywordflow}{if} (m\_frameNumberOffset == -\/1) m\_frameNumberOffset = frameIndex -\/ 1;}
\DoxyCodeLine{00107   QString tempPath = getFfmpegCache().getQString() + \textcolor{stringliteral}{"{}//"{}} +}
\DoxyCodeLine{00108                      QString::fromStdString(m\_path.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()) + \textcolor{stringliteral}{"{}tempOut"{}} +}
\DoxyCodeLine{00109                      QString::number(frameIndex -\/ m\_frameNumberOffset) + \textcolor{stringliteral}{"{}."{}} +}
\DoxyCodeLine{00110                      m\_intermediateFormat;}
\DoxyCodeLine{00111   std::string saveStatus = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00112   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} tempImage(img);}
\DoxyCodeLine{00113   \mbox{\hyperlink{class_t_raster_image}{TRasterImage}} *image = (\mbox{\hyperlink{class_t_raster_image}{TRasterImage}} *)tempImage-\/>\mbox{\hyperlink{class_t_image_a3632b96b398057030a4adfe6917d2e28}{cloneImage}}();}
\DoxyCodeLine{00114 }
\DoxyCodeLine{00115   m\_lx           = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>getLx();}
\DoxyCodeLine{00116   m\_ly           = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>getLy();}
\DoxyCodeLine{00117   m\_bpp          = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>getPixelSize();}
\DoxyCodeLine{00118   \textcolor{keywordtype}{int} totalBytes = m\_lx * m\_ly * m\_bpp;}
\DoxyCodeLine{00119   image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>yMirror();}
\DoxyCodeLine{00120 }
\DoxyCodeLine{00121   \textcolor{comment}{// lock raster to get data}}
\DoxyCodeLine{00122   image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>lock();}
\DoxyCodeLine{00123   \textcolor{keywordtype}{void} *buffin = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}();}
\DoxyCodeLine{00124   assert(buffin);}
\DoxyCodeLine{00125   \textcolor{keywordtype}{void} *buffer = malloc(totalBytes);}
\DoxyCodeLine{00126   memcpy(buffer, buffin, totalBytes);}
\DoxyCodeLine{00127 }
\DoxyCodeLine{00128   image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>unlock();}
\DoxyCodeLine{00129 }
\DoxyCodeLine{00130   \textcolor{comment}{// create QImage save format}}
\DoxyCodeLine{00131   QByteArray ba      = m\_intermediateFormat.toUpper().toLatin1();}
\DoxyCodeLine{00132   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *format = ba.data();}
\DoxyCodeLine{00133 }
\DoxyCodeLine{00134   QImage *qi = \textcolor{keyword}{new} QImage((uint8\_t *)buffer, m\_lx, m\_ly, QImage::Format\_ARGB32);}
\DoxyCodeLine{00135   qi-\/>save(tempPath, format, -\/1);}
\DoxyCodeLine{00136   free(buffer);}
\DoxyCodeLine{00137   m\_cleanUpList.push\_back(tempPath);}
\DoxyCodeLine{00138 }
\DoxyCodeLine{00139   \textcolor{keyword}{delete} qi;}
\DoxyCodeLine{00140   \textcolor{keyword}{delete} image;}
\DoxyCodeLine{00141 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_af7cac242568bd38bc706a2f9b72d9597}\label{class_ffmpeg_af7cac242568bd38bc706a2f9b72d9597}} 
\index{Ffmpeg@{Ffmpeg}!disablePrecompute@{disablePrecompute}}
\index{disablePrecompute@{disablePrecompute}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{disablePrecompute()}{disablePrecompute()}}
{\footnotesize\ttfamily void Ffmpeg\+::disable\+Precompute (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00522                                \{}
\DoxyCodeLine{00523   Preferences::instance()-\/>setPrecompute(\textcolor{keyword}{false});}
\DoxyCodeLine{00524 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_aeca74e9fd63377daa92a4085342fafbd}\label{class_ffmpeg_aeca74e9fd63377daa92a4085342fafbd}} 
\index{Ffmpeg@{Ffmpeg}!getFfmpegCache@{getFfmpegCache}}
\index{getFfmpegCache@{getFfmpegCache}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getFfmpegCache()}{getFfmpegCache()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} Ffmpeg\+::get\+Ffmpeg\+Cache (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00090                                  \{}
\DoxyCodeLine{00091   QString cacheRoot = ToonzFolder::getCacheRootFolder().getQString();}
\DoxyCodeLine{00092   \textcolor{keywordflow}{if} (!TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(cacheRoot + \textcolor{stringliteral}{"{}/ffmpeg"{}}))) \{}
\DoxyCodeLine{00093     TSystem::mkDir(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(cacheRoot + \textcolor{stringliteral}{"{}/ffmpeg"{}}));}
\DoxyCodeLine{00094   \}}
\DoxyCodeLine{00095   std::string ffmpegPath =}
\DoxyCodeLine{00096       \mbox{\hyperlink{class_t_file_path}{TFilePath}}(cacheRoot + \textcolor{stringliteral}{"{}/ffmpeg"{}}).getQString().toStdString();}
\DoxyCodeLine{00097   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_file_path}{TFilePath}}(cacheRoot + \textcolor{stringliteral}{"{}/ffmpeg"{}});}
\DoxyCodeLine{00098 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_ac29acc5563b0e01b3d1109a2481840d4}\label{class_ffmpeg_ac29acc5563b0e01b3d1109a2481840d4}} 
\index{Ffmpeg@{Ffmpeg}!getFrameCount@{getFrameCount}}
\index{getFrameCount@{getFrameCount}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getFrameCount()}{getFrameCount()}}
{\footnotesize\ttfamily int Ffmpeg\+::get\+Frame\+Count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00401                           \{}
\DoxyCodeLine{00402   \textcolor{comment}{// nb\_read\_frames from files may not be accurate. Let's calculate it based on}}
\DoxyCodeLine{00403   \textcolor{comment}{// r\_frame\_rate * duration}}
\DoxyCodeLine{00404   QStringList frameCountArgs;}
\DoxyCodeLine{00405   frameCountArgs << \textcolor{stringliteral}{"{}-\/v"{}};}
\DoxyCodeLine{00406   frameCountArgs << \textcolor{stringliteral}{"{}error"{}};}
\DoxyCodeLine{00407   frameCountArgs << \textcolor{stringliteral}{"{}-\/count\_frames"{}};}
\DoxyCodeLine{00408   frameCountArgs << \textcolor{stringliteral}{"{}-\/select\_streams"{}};}
\DoxyCodeLine{00409   frameCountArgs << \textcolor{stringliteral}{"{}v:0"{}};}
\DoxyCodeLine{00410   frameCountArgs << \textcolor{stringliteral}{"{}-\/show\_entries"{}};}
\DoxyCodeLine{00411   frameCountArgs << \textcolor{stringliteral}{"{}stream=duration"{}};}
\DoxyCodeLine{00412   frameCountArgs << \textcolor{stringliteral}{"{}-\/of"{}};}
\DoxyCodeLine{00413   frameCountArgs << \textcolor{stringliteral}{"{}default=nokey=1:noprint\_wrappers=1"{}};}
\DoxyCodeLine{00414   frameCountArgs << m\_path.getQString();}
\DoxyCodeLine{00415 }
\DoxyCodeLine{00416   QString frameResults = runFfprobe(frameCountArgs);}
\DoxyCodeLine{00417   m\_frameCount         = frameResults.toDouble() * getFrameRate();}
\DoxyCodeLine{00418 }
\DoxyCodeLine{00419   \textcolor{comment}{// if for some reason we don't have enough info to calculate it. Use the}}
\DoxyCodeLine{00420   \textcolor{comment}{// nb\_read\_frames}}
\DoxyCodeLine{00421   \textcolor{keywordflow}{if} (!m\_frameCount) \{}
\DoxyCodeLine{00422     frameCountArgs.clear();}
\DoxyCodeLine{00423     frameCountArgs << \textcolor{stringliteral}{"{}-\/v"{}};}
\DoxyCodeLine{00424     frameCountArgs << \textcolor{stringliteral}{"{}error"{}};}
\DoxyCodeLine{00425     frameCountArgs << \textcolor{stringliteral}{"{}-\/count\_frames"{}};}
\DoxyCodeLine{00426     frameCountArgs << \textcolor{stringliteral}{"{}-\/select\_streams"{}};}
\DoxyCodeLine{00427     frameCountArgs << \textcolor{stringliteral}{"{}v:0"{}};}
\DoxyCodeLine{00428     frameCountArgs << \textcolor{stringliteral}{"{}-\/show\_entries"{}};}
\DoxyCodeLine{00429     frameCountArgs << \textcolor{stringliteral}{"{}stream=nb\_read\_frames"{}};}
\DoxyCodeLine{00430     frameCountArgs << \textcolor{stringliteral}{"{}-\/of"{}};}
\DoxyCodeLine{00431     frameCountArgs << \textcolor{stringliteral}{"{}default=nokey=1:noprint\_wrappers=1"{}};}
\DoxyCodeLine{00432     frameCountArgs << m\_path.getQString();}
\DoxyCodeLine{00433 }
\DoxyCodeLine{00434     frameResults = runFfprobe(frameCountArgs);}
\DoxyCodeLine{00435     m\_frameCount = frameResults.toInt();}
\DoxyCodeLine{00436   \}}
\DoxyCodeLine{00437 }
\DoxyCodeLine{00438   \textcolor{keywordflow}{return} m\_frameCount;}
\DoxyCodeLine{00439 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a1c6db42fd1fade87b5924476b66f026a}\label{class_ffmpeg_a1c6db42fd1fade87b5924476b66f026a}} 
\index{Ffmpeg@{Ffmpeg}!getFrameRate@{getFrameRate}}
\index{getFrameRate@{getFrameRate}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getFrameRate()}{getFrameRate()}}
{\footnotesize\ttfamily double Ffmpeg\+::get\+Frame\+Rate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00334                             \{}
\DoxyCodeLine{00335   QStringList fpsArgs;}
\DoxyCodeLine{00336   \textcolor{keywordtype}{int} fpsNum = 0, fpsDen = 0;}
\DoxyCodeLine{00337   fpsArgs << \textcolor{stringliteral}{"{}-\/v"{}};}
\DoxyCodeLine{00338   fpsArgs << \textcolor{stringliteral}{"{}error"{}};}
\DoxyCodeLine{00339   fpsArgs << \textcolor{stringliteral}{"{}-\/select\_streams"{}};}
\DoxyCodeLine{00340   fpsArgs << \textcolor{stringliteral}{"{}v:0"{}};}
\DoxyCodeLine{00341   fpsArgs << \textcolor{stringliteral}{"{}-\/show\_entries"{}};}
\DoxyCodeLine{00342   fpsArgs << \textcolor{stringliteral}{"{}stream=r\_frame\_rate"{}};}
\DoxyCodeLine{00343   fpsArgs << \textcolor{stringliteral}{"{}-\/of"{}};}
\DoxyCodeLine{00344   fpsArgs << \textcolor{stringliteral}{"{}default=noprint\_wrappers=1:nokey=1"{}};}
\DoxyCodeLine{00345   fpsArgs << m\_path.getQString();}
\DoxyCodeLine{00346   QString fpsResults = runFfprobe(fpsArgs);}
\DoxyCodeLine{00347 }
\DoxyCodeLine{00348   QStringList fpsResultsList = fpsResults.split(\textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00349   \textcolor{keywordflow}{if} (fpsResultsList.size() > 1) \{}
\DoxyCodeLine{00350     fpsNum = fpsResultsList[0].toInt();}
\DoxyCodeLine{00351     fpsDen = fpsResultsList[1].toInt();}
\DoxyCodeLine{00352   \}}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354   \textcolor{comment}{// if for some reason we don't have enough info to calculate it. Use the}}
\DoxyCodeLine{00355   \textcolor{comment}{// avg\_frame\_rate}}
\DoxyCodeLine{00356   \textcolor{keywordflow}{if} (!fpsDen) \{}
\DoxyCodeLine{00357     fpsArgs.clear();}
\DoxyCodeLine{00358     fpsArgs << \textcolor{stringliteral}{"{}-\/v"{}};}
\DoxyCodeLine{00359     fpsArgs << \textcolor{stringliteral}{"{}error"{}};}
\DoxyCodeLine{00360     fpsArgs << \textcolor{stringliteral}{"{}-\/select\_streams"{}};}
\DoxyCodeLine{00361     fpsArgs << \textcolor{stringliteral}{"{}v:0"{}};}
\DoxyCodeLine{00362     fpsArgs << \textcolor{stringliteral}{"{}-\/show\_entries"{}};}
\DoxyCodeLine{00363     fpsArgs << \textcolor{stringliteral}{"{}stream=avg\_frame\_rate"{}};}
\DoxyCodeLine{00364     fpsArgs << \textcolor{stringliteral}{"{}-\/of"{}};}
\DoxyCodeLine{00365     fpsArgs << \textcolor{stringliteral}{"{}default=noprint\_wrappers=1:nokey=1"{}};}
\DoxyCodeLine{00366     fpsArgs << m\_path.getQString();}
\DoxyCodeLine{00367     QString fpsResults = runFfprobe(fpsArgs);}
\DoxyCodeLine{00368 }
\DoxyCodeLine{00369     fpsResultsList = fpsResults.split(\textcolor{stringliteral}{"{}/"{}});}
\DoxyCodeLine{00370     \textcolor{keywordflow}{if} (fpsResultsList.size() > 1) \{}
\DoxyCodeLine{00371       fpsNum = fpsResultsList[0].toInt();}
\DoxyCodeLine{00372       fpsDen = fpsResultsList[1].toInt();}
\DoxyCodeLine{00373     \}}
\DoxyCodeLine{00374   \}}
\DoxyCodeLine{00375 }
\DoxyCodeLine{00376   \textcolor{keywordflow}{if} (fpsDen > 0) \{}
\DoxyCodeLine{00377     m\_frameRate = (double)fpsNum / (\textcolor{keywordtype}{double})fpsDen;}
\DoxyCodeLine{00378   \}}
\DoxyCodeLine{00379   \textcolor{keywordflow}{return} m\_frameRate;}
\DoxyCodeLine{00380 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_ad0badcc15aff8b0b9baa02ce7cf0ff80}\label{class_ffmpeg_ad0badcc15aff8b0b9baa02ce7cf0ff80}} 
\index{Ffmpeg@{Ffmpeg}!getFramesFromMovie@{getFramesFromMovie}}
\index{getFramesFromMovie@{getFramesFromMovie}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getFramesFromMovie()}{getFramesFromMovie()}}
{\footnotesize\ttfamily void Ffmpeg\+::get\+Frames\+From\+Movie (\begin{DoxyParamCaption}\item[{int}]{frame = {\ttfamily -\/1} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00441                                          \{}
\DoxyCodeLine{00442   QString ffmpegCachePath = getFfmpegCache().getQString();}
\DoxyCodeLine{00443   QString tempPath        = ffmpegCachePath + \textcolor{stringliteral}{"{}//"{}} + cleanPathSymbols();}
\DoxyCodeLine{00444   std::string tmpPath     = tempPath.toStdString();}
\DoxyCodeLine{00445   QString tempName        = \textcolor{stringliteral}{"{}In\%04d."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00446   tempName                = tempPath + tempName;}
\DoxyCodeLine{00447   QString tempStart;}
\DoxyCodeLine{00448   \textcolor{keywordflow}{if} (frame == -\/1) \{}
\DoxyCodeLine{00449     tempStart = \textcolor{stringliteral}{"{}In0001."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00450     tempStart = tempPath + tempStart;}
\DoxyCodeLine{00451   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00452     QString number = QString(\textcolor{stringliteral}{"{}\%1"{}}).arg(frame, 4, 10, QChar(\textcolor{charliteral}{'0'}));}
\DoxyCodeLine{00453     tempStart      = tempPath + \textcolor{stringliteral}{"{}In"{}} + number + \textcolor{stringliteral}{"{}."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00454   \}}
\DoxyCodeLine{00455   QString tempBase = tempPath + \textcolor{stringliteral}{"{}In"{}};}
\DoxyCodeLine{00456   QString addToDelete;}
\DoxyCodeLine{00457   \textcolor{keywordflow}{if} (!TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(tempStart))) \{}
\DoxyCodeLine{00458     \textcolor{comment}{// for debugging}}
\DoxyCodeLine{00459     std::string strPath = tempName.toStdString();}
\DoxyCodeLine{00460 }
\DoxyCodeLine{00461     QStringList preIFrameArgs;}
\DoxyCodeLine{00462     QStringList postIFrameArgs;}
\DoxyCodeLine{00463     \textcolor{comment}{// frameArgs << "{}-\/accurate\_seek"{};}}
\DoxyCodeLine{00464     \textcolor{comment}{// frameArgs << "{}-\/ss"{};}}
\DoxyCodeLine{00465     \textcolor{comment}{// frameArgs << "{}0"{} + QString::number(frameIndex / m\_info-\/>m\_frameRate);}}
\DoxyCodeLine{00466     preIFrameArgs << \textcolor{stringliteral}{"{}-\/i"{}};}
\DoxyCodeLine{00467     preIFrameArgs << m\_path.getQString();}
\DoxyCodeLine{00468     postIFrameArgs << \textcolor{stringliteral}{"{}-\/y"{}};}
\DoxyCodeLine{00469     postIFrameArgs << \textcolor{stringliteral}{"{}-\/f"{}};}
\DoxyCodeLine{00470     postIFrameArgs << \textcolor{stringliteral}{"{}image2"{}};}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472     postIFrameArgs << tempName;}
\DoxyCodeLine{00473 }
\DoxyCodeLine{00474     runFfmpeg(preIFrameArgs, postIFrameArgs, \textcolor{keyword}{true}, \textcolor{keyword}{true}, \textcolor{keyword}{true});}
\DoxyCodeLine{00475 }
\DoxyCodeLine{00476     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i <= m\_frameCount; i++) \{}
\DoxyCodeLine{00477       QString number      = QString(\textcolor{stringliteral}{"{}\%1"{}}).arg(i, 4, 10, QChar(\textcolor{charliteral}{'0'}));}
\DoxyCodeLine{00478       addToDelete         = tempBase + number + \textcolor{stringliteral}{"{}."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00479       std::string delPath = addToDelete.toStdString();}
\DoxyCodeLine{00480       \textcolor{comment}{// addToCleanUp(addToDelete);}}
\DoxyCodeLine{00481     \}}
\DoxyCodeLine{00482   \}}
\DoxyCodeLine{00483 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a43d6e18536beca1619abca08fa7ee0dc}\label{class_ffmpeg_a43d6e18536beca1619abca08fa7ee0dc}} 
\index{Ffmpeg@{Ffmpeg}!getGifFrameCount@{getGifFrameCount}}
\index{getGifFrameCount@{getGifFrameCount}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getGifFrameCount()}{getGifFrameCount()}}
{\footnotesize\ttfamily int Ffmpeg\+::get\+Gif\+Frame\+Count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00490                              \{}
\DoxyCodeLine{00491   \textcolor{keywordtype}{int} frame               = 1;}
\DoxyCodeLine{00492   QString ffmpegCachePath = getFfmpegCache().getQString();}
\DoxyCodeLine{00493   QString tempPath        = ffmpegCachePath + \textcolor{stringliteral}{"{}//"{}} + cleanPathSymbols();}
\DoxyCodeLine{00494   std::string tmpPath     = tempPath.toStdString();}
\DoxyCodeLine{00495   QString tempName        = \textcolor{stringliteral}{"{}In\%04d."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00496   tempName                = tempPath + tempName;}
\DoxyCodeLine{00497   QString tempStart;}
\DoxyCodeLine{00498   tempStart = \textcolor{stringliteral}{"{}In0001."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00499   tempStart = tempPath + tempStart;}
\DoxyCodeLine{00500   \textcolor{keywordflow}{while} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(tempStart))) \{}
\DoxyCodeLine{00501     frame++;}
\DoxyCodeLine{00502     QString number = QString(\textcolor{stringliteral}{"{}\%1"{}}).arg(frame, 4, 10, QChar(\textcolor{charliteral}{'0'}));}
\DoxyCodeLine{00503     tempStart      = tempPath + \textcolor{stringliteral}{"{}In"{}} + number + \textcolor{stringliteral}{"{}."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00504   \}}
\DoxyCodeLine{00505   \textcolor{keywordflow}{return} frame -\/ 1;}
\DoxyCodeLine{00506 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_aea5e18425c5e39cc927b46da6c48670e}\label{class_ffmpeg_aea5e18425c5e39cc927b46da6c48670e}} 
\index{Ffmpeg@{Ffmpeg}!getImage@{getImage}}
\index{getImage@{getImage}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getImage()}{getImage()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_image_p}{TRaster\+ImageP}} Ffmpeg\+::get\+Image (\begin{DoxyParamCaption}\item[{int}]{frame\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00304                                              \{}
\DoxyCodeLine{00305   QString ffmpegCachePath = getFfmpegCache().getQString();}
\DoxyCodeLine{00306   QString tempPath        = ffmpegCachePath + \textcolor{stringliteral}{"{}//"{}} + cleanPathSymbols();}
\DoxyCodeLine{00307   std::string tmpPath     = tempPath.toStdString();}
\DoxyCodeLine{00308   \textcolor{comment}{// QString tempPath= m\_path.getQString();}}
\DoxyCodeLine{00309   QString number   = QString(\textcolor{stringliteral}{"{}\%1"{}}).arg(frameIndex, 4, 10, QChar(\textcolor{charliteral}{'0'}));}
\DoxyCodeLine{00310   QString tempName = \textcolor{stringliteral}{"{}In"{}} + number + \textcolor{stringliteral}{"{}.png"{}};}
\DoxyCodeLine{00311   tempName         = tempPath + tempName;}
\DoxyCodeLine{00312 }
\DoxyCodeLine{00313   \textcolor{comment}{// for debugging}}
\DoxyCodeLine{00314   std::string strPath = tempName.toStdString();}
\DoxyCodeLine{00315   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(tempName))) \{}
\DoxyCodeLine{00316     QImage *temp = \textcolor{keyword}{new} QImage(tempName, \textcolor{stringliteral}{"{}PNG"{}});}
\DoxyCodeLine{00317     \textcolor{keywordflow}{if} (temp) \{}
\DoxyCodeLine{00318       QImage tempToo = temp-\/>convertToFormat(QImage::Format\_ARGB32);}
\DoxyCodeLine{00319       \textcolor{keyword}{delete} temp;}
\DoxyCodeLine{00320       \textcolor{keyword}{const} UCHAR *bits = tempToo.bits();}
\DoxyCodeLine{00321 }
\DoxyCodeLine{00322       \mbox{\hyperlink{class_t_raster_p_t}{TRasterPT<TPixelRGBM32>}} ret;}
\DoxyCodeLine{00323       ret.create(m\_lx, m\_ly);}
\DoxyCodeLine{00324       ret-\/>lock();}
\DoxyCodeLine{00325       memcpy(ret-\/>getRawData(), bits, m\_lx * m\_ly * 4);}
\DoxyCodeLine{00326       ret-\/>unlock();}
\DoxyCodeLine{00327       ret-\/>yMirror();}
\DoxyCodeLine{00328       \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}}(ret);}
\DoxyCodeLine{00329     \}}
\DoxyCodeLine{00330   \}}
\DoxyCodeLine{00331   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}}();}
\DoxyCodeLine{00332 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_ae591a73f641a124dab197d8d39914999}\label{class_ffmpeg_ae591a73f641a124dab197d8d39914999}} 
\index{Ffmpeg@{Ffmpeg}!getInfo@{getInfo}}
\index{getInfo@{getInfo}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getInfo()}{getInfo()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structffmpeg_file_info}{ffmpeg\+File\+Info}} Ffmpeg\+::get\+Info (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00271                                \{}
\DoxyCodeLine{00272   QString ffmpegCachePath = getFfmpegCache().getQString();}
\DoxyCodeLine{00273   QString tempPath = ffmpegCachePath + \textcolor{stringliteral}{"{}//"{}} + cleanPathSymbols() + \textcolor{stringliteral}{"{}.txt"{}};}
\DoxyCodeLine{00274   \textcolor{keywordflow}{if} (QFile::exists(tempPath)) \{}
\DoxyCodeLine{00275     QFile infoText(tempPath);}
\DoxyCodeLine{00276     infoText.open(QIODevice::ReadOnly);}
\DoxyCodeLine{00277     QByteArray ba = infoText.readAll();}
\DoxyCodeLine{00278     infoText.close();}
\DoxyCodeLine{00279     QString text = QString::fromStdString(ba.toStdString());}
\DoxyCodeLine{00280     m\_lx         = text.split(\textcolor{stringliteral}{"{} "{}})[0].toInt();}
\DoxyCodeLine{00281     m\_ly         = text.split(\textcolor{stringliteral}{"{} "{}})[1].toInt();}
\DoxyCodeLine{00282     m\_frameRate  = text.split(\textcolor{stringliteral}{"{} "{}})[2].toDouble();}
\DoxyCodeLine{00283     m\_frameCount = text.split(\textcolor{stringliteral}{"{} "{}})[3].toInt();}
\DoxyCodeLine{00284   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00285     QFile infoText(tempPath);}
\DoxyCodeLine{00286     getSize();}
\DoxyCodeLine{00287     getFrameCount();}
\DoxyCodeLine{00288     getFrameRate();}
\DoxyCodeLine{00289     infoText.open(QIODevice::WriteOnly);}
\DoxyCodeLine{00290     std::string infoToWrite =}
\DoxyCodeLine{00291         std::to\_string(m\_lx) + \textcolor{stringliteral}{"{} "{}} + std::to\_string(m\_ly) + \textcolor{stringliteral}{"{} "{}} +}
\DoxyCodeLine{00292         std::to\_string(m\_frameRate) + \textcolor{stringliteral}{"{} "{}} + std::to\_string(m\_frameCount);}
\DoxyCodeLine{00293     \textcolor{keywordtype}{int} infoLength = infoToWrite.length();}
\DoxyCodeLine{00294     infoText.write(infoToWrite.c\_str(), infoLength);}
\DoxyCodeLine{00295     infoText.close();}
\DoxyCodeLine{00296   \}}
\DoxyCodeLine{00297   \mbox{\hyperlink{structffmpeg_file_info}{ffmpegFileInfo}} info;}
\DoxyCodeLine{00298   info.m\_lx         = m\_lx;}
\DoxyCodeLine{00299   info.m\_ly         = m\_ly;}
\DoxyCodeLine{00300   info.m\_frameRate  = m\_frameRate;}
\DoxyCodeLine{00301   info.m\_frameCount = m\_frameCount;}
\DoxyCodeLine{00302   \textcolor{keywordflow}{return} info;}
\DoxyCodeLine{00303 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_acc8206df1f7869cf203eb53aefc1307f}\label{class_ffmpeg_acc8206df1f7869cf203eb53aefc1307f}} 
\index{Ffmpeg@{Ffmpeg}!getSize@{getSize}}
\index{getSize@{getSize}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{getSize()}{getSize()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_dimension_t}{TDimension}} Ffmpeg\+::get\+Size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00382                            \{}
\DoxyCodeLine{00383   QStringList sizeArgs;}
\DoxyCodeLine{00384   sizeArgs << \textcolor{stringliteral}{"{}-\/v"{}};}
\DoxyCodeLine{00385   sizeArgs << \textcolor{stringliteral}{"{}error"{}};}
\DoxyCodeLine{00386   sizeArgs << \textcolor{stringliteral}{"{}-\/of"{}};}
\DoxyCodeLine{00387   sizeArgs << \textcolor{stringliteral}{"{}flat=s=\_"{}};}
\DoxyCodeLine{00388   sizeArgs << \textcolor{stringliteral}{"{}-\/select\_streams"{}};}
\DoxyCodeLine{00389   sizeArgs << \textcolor{stringliteral}{"{}v:0"{}};}
\DoxyCodeLine{00390   sizeArgs << \textcolor{stringliteral}{"{}-\/show\_entries"{}};}
\DoxyCodeLine{00391   sizeArgs << \textcolor{stringliteral}{"{}stream=height,width"{}};}
\DoxyCodeLine{00392   sizeArgs << m\_path.getQString();}
\DoxyCodeLine{00393 }
\DoxyCodeLine{00394   QString sizeResults = runFfprobe(sizeArgs);}
\DoxyCodeLine{00395   QStringList split   = sizeResults.split(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00396   m\_lx                = split[0].split(\textcolor{stringliteral}{"{}="{}})[1].toInt();}
\DoxyCodeLine{00397   m\_ly                = split[1].split(\textcolor{stringliteral}{"{}="{}})[1].toInt();}
\DoxyCodeLine{00398   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(m\_lx, m\_ly);}
\DoxyCodeLine{00399 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_aab09a0be7e8470b1e495d7dd64ee15cd}\label{class_ffmpeg_aab09a0be7e8470b1e495d7dd64ee15cd}} 
\index{Ffmpeg@{Ffmpeg}!runFfmpeg@{runFfmpeg}}
\index{runFfmpeg@{runFfmpeg}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{runFfmpeg()}{runFfmpeg()}}
{\footnotesize\ttfamily void Ffmpeg\+::run\+Ffmpeg (\begin{DoxyParamCaption}\item[{QString\+List}]{pre\+IArgs,  }\item[{QString\+List}]{post\+IArgs,  }\item[{bool}]{includes\+In\+Path,  }\item[{bool}]{includes\+Out\+Path,  }\item[{bool}]{over\+Write\+Files }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00145                                             \{}
\DoxyCodeLine{00146   QString tempName = \textcolor{stringliteral}{"{}//"{}} + QString::fromStdString(m\_path.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()) +}
\DoxyCodeLine{00147                      \textcolor{stringliteral}{"{}tempOut\%d."{}} + m\_intermediateFormat;}
\DoxyCodeLine{00148   tempName = getFfmpegCache().getQString() + tempName;}
\DoxyCodeLine{00149 }
\DoxyCodeLine{00150   QStringList args;}
\DoxyCodeLine{00151   args = args + preIArgs;}
\DoxyCodeLine{00152   \textcolor{keywordflow}{if} (!includesInPath) \{  \textcolor{comment}{// NOTE:  if including the in path, it needs to be in}}
\DoxyCodeLine{00153                           \textcolor{comment}{// the preIArgs argument.}}
\DoxyCodeLine{00154     args << \textcolor{stringliteral}{"{}-\/i"{}};}
\DoxyCodeLine{00155     args << tempName;}
\DoxyCodeLine{00156   \}}
\DoxyCodeLine{00157   \textcolor{keywordflow}{if} (m\_hasSoundTrack) args = args + m\_audioArgs;}
\DoxyCodeLine{00158   args = args + postIArgs;}
\DoxyCodeLine{00159   \textcolor{keywordflow}{if} (overWriteFiles \&\& !includesOutPath) \{  \textcolor{comment}{// if includesOutPath is true, you}}
\DoxyCodeLine{00160                                              \textcolor{comment}{// need to include the overwrite in}}
\DoxyCodeLine{00161                                              \textcolor{comment}{// your postIArgs.}}
\DoxyCodeLine{00162     args << \textcolor{stringliteral}{"{}-\/y"{}};}
\DoxyCodeLine{00163   \}}
\DoxyCodeLine{00164   \textcolor{keywordflow}{if} (!includesOutPath) \{}
\DoxyCodeLine{00165     args << m\_path.getQString();}
\DoxyCodeLine{00166   \}}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168   \textcolor{comment}{// write the file}}
\DoxyCodeLine{00169   QProcess ffmpeg;}
\DoxyCodeLine{00170   ffmpeg.start(m\_ffmpegPath + \textcolor{stringliteral}{"{}/ffmpeg"{}}, args);}
\DoxyCodeLine{00171   \textcolor{keywordflow}{if} (waitFfmpeg(ffmpeg)) \{}
\DoxyCodeLine{00172     QString results = ffmpeg.readAllStandardError();}
\DoxyCodeLine{00173     results += ffmpeg.readAllStandardOutput();}
\DoxyCodeLine{00174     \textcolor{keywordtype}{int} exitCode = ffmpeg.exitCode();}
\DoxyCodeLine{00175     std::string strResults = results.toStdString();}
\DoxyCodeLine{00176   \}}
\DoxyCodeLine{00177   ffmpeg.close();}
\DoxyCodeLine{00178 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a840b83b804dc3fe7cd9c39cfde7182a2}\label{class_ffmpeg_a840b83b804dc3fe7cd9c39cfde7182a2}} 
\index{Ffmpeg@{Ffmpeg}!runFfprobe@{runFfprobe}}
\index{runFfprobe@{runFfprobe}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{runFfprobe()}{runFfprobe()}}
{\footnotesize\ttfamily QString Ffmpeg\+::run\+Ffprobe (\begin{DoxyParamCaption}\item[{QString\+List}]{args }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00180                                            \{}
\DoxyCodeLine{00181   QProcess ffmpeg;}
\DoxyCodeLine{00182   ffmpeg.start(m\_ffmpegPath + \textcolor{stringliteral}{"{}/ffprobe"{}}, args);}
\DoxyCodeLine{00183   \textcolor{keywordflow}{if} (!waitFfmpeg(ffmpeg)) \{}
\DoxyCodeLine{00184     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error accessing ffprobe."{}});}
\DoxyCodeLine{00185   \}}
\DoxyCodeLine{00186   QString results = ffmpeg.readAllStandardError();}
\DoxyCodeLine{00187   results += ffmpeg.readAllStandardOutput();}
\DoxyCodeLine{00188   \textcolor{keywordtype}{int} exitCode = ffmpeg.exitCode();}
\DoxyCodeLine{00189   ffmpeg.close();}
\DoxyCodeLine{00190   \textcolor{comment}{// If the url cannot be opened or recognized as a multimedia file, ffprobe}}
\DoxyCodeLine{00191   \textcolor{comment}{// returns a positive exit code.}}
\DoxyCodeLine{00192   \textcolor{keywordflow}{if} (exitCode > 0) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, \textcolor{stringliteral}{"{}error reading info."{}});}
\DoxyCodeLine{00193   std::string strResults = results.toStdString();}
\DoxyCodeLine{00194   \textcolor{keywordflow}{return} results;}
\DoxyCodeLine{00195 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_ac298e4217eaf0a33c2e5355e06c9e376}\label{class_ffmpeg_ac298e4217eaf0a33c2e5355e06c9e376}} 
\index{Ffmpeg@{Ffmpeg}!saveSoundTrack@{saveSoundTrack}}
\index{saveSoundTrack@{saveSoundTrack}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{saveSoundTrack()}{saveSoundTrack()}}
{\footnotesize\ttfamily void Ffmpeg\+::save\+Sound\+Track (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$}]{st }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00225                                            \{}
\DoxyCodeLine{00226   m\_sampleRate    = st-\/>getSampleRate();}
\DoxyCodeLine{00227   m\_channelCount  = st-\/>getChannelCount();}
\DoxyCodeLine{00228   m\_bitsPerSample = st-\/>getBitPerSample();}
\DoxyCodeLine{00229   \textcolor{comment}{// LONG count = st-\/>getSampleCount();}}
\DoxyCodeLine{00230   \textcolor{keywordtype}{int} bufSize         = st-\/>getSampleCount() * st-\/>getSampleSize();}
\DoxyCodeLine{00231   \textcolor{keyword}{const} UCHAR *buffer = st-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00232 }
\DoxyCodeLine{00233   m\_audioPath = getFfmpegCache().getQString() + \textcolor{stringliteral}{"{}//"{}} +}
\DoxyCodeLine{00234                 QString::fromStdString(m\_path.\mbox{\hyperlink{class_t_file_path_af94f9b0aeceb6cdb980fa1789473503a}{getName}}()) + \textcolor{stringliteral}{"{}tempOut.raw"{}};}
\DoxyCodeLine{00235   m\_audioFormat = \textcolor{stringliteral}{"{}s"{}} + QString::number(m\_bitsPerSample);}
\DoxyCodeLine{00236   \textcolor{keywordflow}{if} (m\_bitsPerSample > 8) m\_audioFormat = m\_audioFormat + \textcolor{stringliteral}{"{}le"{}};}
\DoxyCodeLine{00237   std::string strPath = m\_audioPath.toStdString();}
\DoxyCodeLine{00238 }
\DoxyCodeLine{00239   QByteArray data;}
\DoxyCodeLine{00240   data.insert(0, (\textcolor{keywordtype}{char} *)buffer, bufSize);}
\DoxyCodeLine{00241 }
\DoxyCodeLine{00242   QFile file(m\_audioPath);}
\DoxyCodeLine{00243   file.open(QIODevice::WriteOnly);}
\DoxyCodeLine{00244   file.write(data);}
\DoxyCodeLine{00245   file.close();}
\DoxyCodeLine{00246   m\_hasSoundTrack = \textcolor{keyword}{true};}
\DoxyCodeLine{00247 }
\DoxyCodeLine{00248   m\_audioArgs << \textcolor{stringliteral}{"{}-\/f"{}};}
\DoxyCodeLine{00249   m\_audioArgs << m\_audioFormat;}
\DoxyCodeLine{00250   m\_audioArgs << \textcolor{stringliteral}{"{}-\/ar"{}};}
\DoxyCodeLine{00251   m\_audioArgs << QString::number(m\_sampleRate);}
\DoxyCodeLine{00252   m\_audioArgs << \textcolor{stringliteral}{"{}-\/ac"{}};}
\DoxyCodeLine{00253   m\_audioArgs << QString::number(m\_channelCount);}
\DoxyCodeLine{00254   m\_audioArgs << \textcolor{stringliteral}{"{}-\/i"{}};}
\DoxyCodeLine{00255   m\_audioArgs << m\_audioPath;}
\DoxyCodeLine{00256 }
\DoxyCodeLine{00257   \textcolor{comment}{// add file to framesWritten for cleanup}}
\DoxyCodeLine{00258   m\_cleanUpList.push\_back(m\_audioPath);}
\DoxyCodeLine{00259 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a7e469302c5c0663a506f4f2d4cc9659b}\label{class_ffmpeg_a7e469302c5c0663a506f4f2d4cc9659b}} 
\index{Ffmpeg@{Ffmpeg}!setFrameRate@{setFrameRate}}
\index{setFrameRate@{setFrameRate}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{setFrameRate()}{setFrameRate()}}
{\footnotesize\ttfamily void Ffmpeg\+::set\+Frame\+Rate (\begin{DoxyParamCaption}\item[{double}]{fps }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00100 \{ m\_frameRate = fps; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_ffmpeg_a4bb8108e95a41c35421a804e66575664}\label{class_ffmpeg_a4bb8108e95a41c35421a804e66575664}} 
\index{Ffmpeg@{Ffmpeg}!setPath@{setPath}}
\index{setPath@{setPath}!Ffmpeg@{Ffmpeg}}
\doxysubsubsection{\texorpdfstring{setPath()}{setPath()}}
{\footnotesize\ttfamily void Ffmpeg\+::set\+Path (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_file_path}{TFile\+Path}}}]{path }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00102 \{ m\_path = path; \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/image/ffmpeg/tiio\+\_\+ffmpeg.\+h\item 
E\+:/opentoonz/toonz/sources/image/ffmpeg/tiio\+\_\+ffmpeg.\+cpp\end{DoxyCompactItemize}
