\hypertarget{class_center_line_vectorizer}{}\doxysection{Center\+Line\+Vectorizer Class Reference}
\label{class_center_line_vectorizer}\index{CenterLineVectorizer@{CenterLineVectorizer}}
Inheritance diagram for Center\+Line\+Vectorizer\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_center_line_vectorizer}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_node}{Node}} $\ast$ \mbox{\hyperlink{class_center_line_vectorizer_aefe0ad76f88c5a267a18ef8663a11aaf}{find\+Other\+Side}} (\mbox{\hyperlink{class_node}{Node}} $\ast$node)
\item 
bool \mbox{\hyperlink{class_center_line_vectorizer_a84d22990d2965b24dd7acaf144a5198a}{test\+Other\+Side}} (\mbox{\hyperlink{class_node}{Node}} $\ast$na1, \mbox{\hyperlink{class_node}{Node}} $\ast$nb1, double \&start\+Dist2)
\item 
\mbox{\hyperlink{class_t_point_t}{TPointD}} \mbox{\hyperlink{class_center_line_vectorizer_a35b4481491e415a5ec4c959f14ca72b7}{compute\+Center}} (\mbox{\hyperlink{class_node}{Node}} $\ast$na, \mbox{\hyperlink{class_node}{Node}} $\ast$nb, double \&r)
\item 
\mbox{\Hypertarget{class_center_line_vectorizer_a2ec4c99ec49c1f60ef3ab7b2deddb2e7}\label{class_center_line_vectorizer_a2ec4c99ec49c1f60ef3ab7b2deddb2e7}} 
bool {\bfseries is\+Hole} (\mbox{\hyperlink{class_node}{Node}} $\ast$start\+Node)
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_aa8028bc5ca943c715d0e2e83b8c5f93b}{trace\+Line}} (\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$pix)
\item 
\mbox{\hyperlink{class_t_point_t}{TPoint}} \mbox{\hyperlink{class_center_line_vectorizer_a3653204fe174f3ee2e8e948fa4d98abd}{compute\+Gradient}} (\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$pix)
\item 
\mbox{\hyperlink{class_center_line_vectorizer_ac571134072897ccf4423f3735220f21a}{Center\+Line\+Vectorizer}} (const \mbox{\hyperlink{class_vectorizer_configuration}{Vectorizer\+Configuration}} \&configuration, \mbox{\hyperlink{class_t_palette}{TPalette}} $\ast$palette)
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a31d02653b419e608d1240880d373ce93}{clear\+Nodes}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_abb2eaeca611b945dae5496ef1578ab58}{create\+Nodes}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_adf8b684369a409bb3347c90d825c31e7}{clear\+Junctions}} ()
\item 
\mbox{\Hypertarget{class_center_line_vectorizer_a18d0a55d7aa6568610cc8074f7c8db90}\label{class_center_line_vectorizer_a18d0a55d7aa6568610cc8074f7c8db90}} 
void {\bfseries make\+Output\+Raster} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_ac876387fb568da716cf6889bbb1bd6fb}{make\+Data\+Raster}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&src)
\item 
\mbox{\Hypertarget{class_center_line_vectorizer_a495495a31a414962849bc2e927bcc5df}\label{class_center_line_vectorizer_a495495a31a414962849bc2e927bcc5df}} 
\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$ {\bfseries find\+Unvisited\+Ink\+Pixel} ()
\item 
bool \mbox{\hyperlink{class_center_line_vectorizer_a969e440077bf9a0c9809e63b937d6221}{link\+Next\+Proto\+Stroke}} (\mbox{\hyperlink{class_proto_stroke}{Proto\+Stroke}} $\ast$const dst\+Proto\+Stroke, \mbox{\hyperlink{class_junction}{Junction}} $\ast$const curr\+Junction, const int k)
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a8b6f195a993b2f2eb728f345730d35f8}{join\+Proto\+Strokes}} (\mbox{\hyperlink{class_proto_stroke}{Proto\+Stroke}} $\ast$const dst\+Proto\+Stroke)
\item 
\mbox{\Hypertarget{class_center_line_vectorizer_a7890f448caa3a69ad4c149eb2a8078a1}\label{class_center_line_vectorizer_a7890f448caa3a69ad4c149eb2a8078a1}} 
void {\bfseries resolve\+Unvisited\+Node} (\mbox{\hyperlink{class_node}{Node}} $\ast$node)
\item 
\mbox{\hyperlink{class_junction}{Junction}} $\ast$ \mbox{\hyperlink{class_center_line_vectorizer_aff37418e696de2fa49085d53c8f664e7}{merge\+Junctions}} (const std\+::list$<$ \mbox{\hyperlink{class_junction_merge}{Junction\+Merge}} $>$ \&junctions)
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a8a3d7d1cd895e3ffa710592f5e0f2ccb}{join\+Junctions}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a9d0f6aaf6c7e8e31820ff55df1af4ef6}{create\+Junction\+Polygon}} (\mbox{\hyperlink{class_junction}{Junction}} $\ast$junction)
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_aa0c75b40affba85bc1dcbf14d451dc03}{handle\+Links}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a385916cdd69ff0d1b0c0387566df51f9}{handle\+Junctions}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a31dc81993155e7526139b9ba23cfb8d3}{create\+Strokes}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a737d432f55b524213921db37dcccf4ac}{create\+Regions}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_affd8c8cd55bbd5511ec941d3e2eb3acc}{vectorize}} ()
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a64e746f48131a5fff831c84d8dd091c5}{init}} ()
\item 
\mbox{\hyperlink{class_node}{Node}} $\ast$ \mbox{\hyperlink{class_center_line_vectorizer_aec5e64a4ab988c590744c621e1fe4e94}{create\+Node}} (\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$pix)
\item 
void \mbox{\hyperlink{class_center_line_vectorizer_a65157f31162e7fc32420d5b4e62e51b2}{link}} (\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$pix, \mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$from, \mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$to)
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \mbox{\hyperlink{class_center_line_vectorizer_a5ad41dd6e5eca752f3ce3eba0a18a783}{m\+\_\+src}}
\item 
\mbox{\hyperlink{class_vectorizer_configuration}{Vectorizer\+Configuration}} \mbox{\hyperlink{class_center_line_vectorizer_a479dbf8f9aadd0aabf67ba52e50bfa36}{m\+\_\+configuration}}
\item 
\mbox{\hyperlink{class_t_raster_p_t}{Data\+RasterP}} \mbox{\hyperlink{class_center_line_vectorizer_a3d73af2fd7d369e0cfa6d4108f24639e}{m\+\_\+data\+Raster}}
\item 
\mbox{\hyperlink{classvector}{vector}}$<$ pair$<$ int, \mbox{\hyperlink{class_t_raster_p_t}{Data\+RasterP}} $>$ $>$ \mbox{\hyperlink{class_center_line_vectorizer_a41ad2fbcf51a61f6b95589953f020efe}{m\+\_\+data\+Raster\+Array}}
\item 
\mbox{\hyperlink{class_t_vector_image_p}{TVector\+ImageP}} \mbox{\hyperlink{class_center_line_vectorizer_a2c6992c280df0ee2ccac31a524faa247}{m\+\_\+vimage}}
\item 
\mbox{\hyperlink{classvector}{vector}}$<$ \mbox{\hyperlink{class_node}{Node}} $\ast$ $>$ \mbox{\hyperlink{class_center_line_vectorizer_aa6a4f544b2ccaf516d017ddc2f102605}{m\+\_\+nodes}}
\item 
\mbox{\hyperlink{classvector}{vector}}$<$ \mbox{\hyperlink{class_junction}{Junction}} $\ast$ $>$ \mbox{\hyperlink{class_center_line_vectorizer_a9fc61cc2459f73a30df52c1e63dcd45a}{m\+\_\+junctions}}
\item 
\mbox{\hyperlink{classvector}{vector}}$<$ \mbox{\hyperlink{class_junction_link}{Junction\+Link}} $>$ \mbox{\hyperlink{class_center_line_vectorizer_ae27f83ea716828cb95dabb942cc222ac}{m\+\_\+links}}
\item 
list$<$ \mbox{\hyperlink{class_proto_stroke}{Proto\+Stroke}} $>$ \mbox{\hyperlink{class_center_line_vectorizer_a33c730773e3ebeeab0285a058e8ccdff}{m\+\_\+proto\+Strokes}}
\item 
list$<$ \mbox{\hyperlink{class_proto_region}{Proto\+Region}} $>$ \mbox{\hyperlink{class_center_line_vectorizer_aabe35c50f2c12cdb4f398f863e884d7a}{m\+\_\+proto\+Regions}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_center_line_vectorizer_ac571134072897ccf4423f3735220f21a}\label{class_center_line_vectorizer_ac571134072897ccf4423f3735220f21a}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!CenterLineVectorizer@{CenterLineVectorizer}}
\index{CenterLineVectorizer@{CenterLineVectorizer}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{CenterLineVectorizer()}{CenterLineVectorizer()}}
{\footnotesize\ttfamily Center\+Line\+Vectorizer\+::\+Center\+Line\+Vectorizer (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_vectorizer_configuration}{Vectorizer\+Configuration}} \&}]{configuration,  }\item[{\mbox{\hyperlink{class_t_palette}{TPalette}} $\ast$}]{palette }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00277       : m\_configuration(configuration), m\_palette(palette) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a9d8ba95fae41919439996a973efd1206}\label{class_center_line_vectorizer_a9d8ba95fae41919439996a973efd1206}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!````~CenterLineVectorizer@{$\sim$CenterLineVectorizer}}
\index{````~CenterLineVectorizer@{$\sim$CenterLineVectorizer}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{$\sim$CenterLineVectorizer()}{~CenterLineVectorizer()}}
{\footnotesize\ttfamily Center\+Line\+Vectorizer\+::$\sim$\+Center\+Line\+Vectorizer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00464                                             \{}
\DoxyCodeLine{00465   clearNodes();}
\DoxyCodeLine{00466   clearJunctions();}
\DoxyCodeLine{00467 }
\DoxyCodeLine{00468 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{00469   m\_outlines.clear();}
\DoxyCodeLine{00470   m\_unvisitedNodes.clear();}
\DoxyCodeLine{00471   m\_junctionPolygons.clear();}
\DoxyCodeLine{00472 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00473 }
\DoxyCodeLine{00474   m\_links.clear();}
\DoxyCodeLine{00475   m\_protoStrokes.clear();}
\DoxyCodeLine{00476   m\_protoRegions.clear();}
\DoxyCodeLine{00477   \textcolor{comment}{// m\_protoHoles.clear();}}
\DoxyCodeLine{00478 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_center_line_vectorizer_adf8b684369a409bb3347c90d825c31e7}\label{class_center_line_vectorizer_adf8b684369a409bb3347c90d825c31e7}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!clearJunctions@{clearJunctions}}
\index{clearJunctions@{clearJunctions}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{clearJunctions()}{clearJunctions()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::clear\+Junctions (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00489                                           \{}
\DoxyCodeLine{00490   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_junctions.size(); i++) \textcolor{keyword}{delete} m\_junctions[i];}
\DoxyCodeLine{00491   m\_junctions.clear();}
\DoxyCodeLine{00492 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a31d02653b419e608d1240880d373ce93}\label{class_center_line_vectorizer_a31d02653b419e608d1240880d373ce93}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!clearNodes@{clearNodes}}
\index{clearNodes@{clearNodes}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{clearNodes()}{clearNodes()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::clear\+Nodes (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00482                                       \{}
\DoxyCodeLine{00483   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_nodes.size(); i++) \textcolor{keyword}{delete} m\_nodes[i];}
\DoxyCodeLine{00484   m\_nodes.clear();}
\DoxyCodeLine{00485 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a35b4481491e415a5ec4c959f14ca72b7}\label{class_center_line_vectorizer_a35b4481491e415a5ec4c959f14ca72b7}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!computeCenter@{computeCenter}}
\index{computeCenter@{computeCenter}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{computeCenter()}{computeCenter()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_point_t}{TPointD}} Center\+Line\+Vectorizer\+::compute\+Center (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_node}{Node}} $\ast$}]{na,  }\item[{\mbox{\hyperlink{class_node}{Node}} $\ast$}]{nb,  }\item[{double \&}]{r }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00807                                                                          \{}
\DoxyCodeLine{00808   \mbox{\hyperlink{class_t_point_t}{TPointD}} pa = convert(na-\/>m\_pixel-\/>m\_pos);}
\DoxyCodeLine{00809   \mbox{\hyperlink{class_t_point_t}{TPointD}} pb = convert(nb-\/>m\_pixel-\/>m\_pos);}
\DoxyCodeLine{00810   r          = THICKNESS\_LIMIT;}
\DoxyCodeLine{00811   \textcolor{keywordflow}{if} (pa == pb) \textcolor{keywordflow}{return} pa;}
\DoxyCodeLine{00812 }
\DoxyCodeLine{00813   \mbox{\hyperlink{class_t_point_t}{TPointD}} center((pa + pb) * 0.5);}
\DoxyCodeLine{00814   r = norm(pa -\/ pb) * 0.5;}
\DoxyCodeLine{00815   \textcolor{keywordflow}{return} center;}
\DoxyCodeLine{00816 }
\DoxyCodeLine{00817   \textcolor{comment}{/*    double vsum = 0.0;}}
\DoxyCodeLine{00818 \textcolor{comment}{  TPointD d = pa-\/pb;}}
\DoxyCodeLine{00819 \textcolor{comment}{  if(fabs(d.x)>fabs(d.y))}}
\DoxyCodeLine{00820 \textcolor{comment}{\{}}
\DoxyCodeLine{00821 \textcolor{comment}{          if(pa.x>pb.x) std::swap(pa,pb);}}
\DoxyCodeLine{00822 \textcolor{comment}{          for(int x = pa.x; x<=pb.x; x++)}}
\DoxyCodeLine{00823 \textcolor{comment}{          \{}}
\DoxyCodeLine{00824 \textcolor{comment}{                  int y = pa.y + (pb.y-\/pa.y)*(x-\/pa.x)/(pb.x-\/pa.x);}}
\DoxyCodeLine{00825 \textcolor{comment}{                  int v = 255-\/m\_dataRaster-\/>pixels(y)[x].m\_value;}}
\DoxyCodeLine{00826 \textcolor{comment}{                  center += v * TPointD(x,y);}}
\DoxyCodeLine{00827 \textcolor{comment}{                  vsum += v;}}
\DoxyCodeLine{00828 \textcolor{comment}{  \}}}
\DoxyCodeLine{00829 \textcolor{comment}{\}}}
\DoxyCodeLine{00830 \textcolor{comment}{  else}}
\DoxyCodeLine{00831 \textcolor{comment}{\{}}
\DoxyCodeLine{00832 \textcolor{comment}{          if(pa.y>pb.y) std::swap(pa,pb);}}
\DoxyCodeLine{00833 \textcolor{comment}{          for(int y = pa.y; y<=pb.y; y++)}}
\DoxyCodeLine{00834 \textcolor{comment}{          \{}}
\DoxyCodeLine{00835 \textcolor{comment}{                  int x = pa.x + (pb.x-\/pa.x)*(y-\/pa.y)/(pb.y-\/pa.y);}}
\DoxyCodeLine{00836 \textcolor{comment}{                  int v = 255-\/m\_dataRaster-\/>pixels(y)[x].m\_value;}}
\DoxyCodeLine{00837 \textcolor{comment}{                  center += v * TPointD(x,y);}}
\DoxyCodeLine{00838 \textcolor{comment}{                  vsum += v;}}
\DoxyCodeLine{00839 \textcolor{comment}{          \}}}
\DoxyCodeLine{00840 \textcolor{comment}{\}}}
\DoxyCodeLine{00841 \textcolor{comment}{  assert(vsum>0);}}
\DoxyCodeLine{00842 \textcolor{comment}{  r = 0.5*vsum/255.0;}}
\DoxyCodeLine{00843 \textcolor{comment}{  return center * (1/vsum);}}
\DoxyCodeLine{00844 \textcolor{comment}{*/}}
\DoxyCodeLine{00845 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a3653204fe174f3ee2e8e948fa4d98abd}\label{class_center_line_vectorizer_a3653204fe174f3ee2e8e948fa4d98abd}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!computeGradient@{computeGradient}}
\index{computeGradient@{computeGradient}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{computeGradient()}{computeGradient()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_point_t}{TPoint}} Center\+Line\+Vectorizer\+::compute\+Gradient (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$}]{pix }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00252                                          \{}
\DoxyCodeLine{00253     assert(m\_dataRaster);}
\DoxyCodeLine{00254     \textcolor{keyword}{const} \textcolor{keywordtype}{int} wrap = m\_dataRaster-\/>getWrap();}
\DoxyCodeLine{00255 }
\DoxyCodeLine{00256     \mbox{\hyperlink{class_t_point_t}{TPoint}} g(0, 0);}
\DoxyCodeLine{00257     \textcolor{keywordtype}{int} n, s, w, e, nw, sw, ne, se;}
\DoxyCodeLine{00258 }
\DoxyCodeLine{00259     w  = pix[-\/1].m\_value;}
\DoxyCodeLine{00260     nw = pix[-\/1 + wrap].m\_value;}
\DoxyCodeLine{00261     sw = pix[-\/1 -\/ wrap].m\_value;}
\DoxyCodeLine{00262 }
\DoxyCodeLine{00263     e  = pix[+1].m\_value;}
\DoxyCodeLine{00264     ne = pix[+1 + wrap].m\_value;}
\DoxyCodeLine{00265     se = pix[+1 -\/ wrap].m\_value;}
\DoxyCodeLine{00266 }
\DoxyCodeLine{00267     n = pix[+wrap].m\_value;}
\DoxyCodeLine{00268     s = pix[-\/wrap].m\_value;}
\DoxyCodeLine{00269 }
\DoxyCodeLine{00270     g.y = -\/sw + ne -\/ se + nw + 2 * (n -\/ s);}
\DoxyCodeLine{00271     g.x = -\/sw + ne + se -\/ nw + 2 * (e -\/ w);}
\DoxyCodeLine{00272     \textcolor{keywordflow}{return} g;}
\DoxyCodeLine{00273   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a9d0f6aaf6c7e8e31820ff55df1af4ef6}\label{class_center_line_vectorizer_a9d0f6aaf6c7e8e31820ff55df1af4ef6}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!createJunctionPolygon@{createJunctionPolygon}}
\index{createJunctionPolygon@{createJunctionPolygon}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{createJunctionPolygon()}{createJunctionPolygon()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::create\+Junction\+Polygon (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_junction}{Junction}} $\ast$}]{junction }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01852                                                                    \{}
\DoxyCodeLine{01853   \textcolor{comment}{// int size = junction-\/>m\_nodes.size();}}
\DoxyCodeLine{01854   \textcolor{comment}{//    std::sort(junction-\/>m\_nodes.begin(), junction-\/>m\_nodes.end(),}}
\DoxyCodeLine{01855   \textcolor{comment}{// CompareJunctionNodes(junction-\/>m\_center));}}
\DoxyCodeLine{01856   \textcolor{comment}{//    std::reverse(junction-\/>m\_nodes.begin(), junction-\/>m\_nodes.end());}}
\DoxyCodeLine{01857   \textcolor{comment}{// std::deque<Node*>::iterator it, it\_temp;}}
\DoxyCodeLine{01858   std::deque<Node *>::iterator it, it\_temp;}
\DoxyCodeLine{01859   \textcolor{keywordflow}{for} (it = junction-\/>m\_nodes.begin(); it != junction-\/>m\_nodes.end(); it++) \{}
\DoxyCodeLine{01860     \textcolor{keywordtype}{int} step = 0;}
\DoxyCodeLine{01861 }
\DoxyCodeLine{01862     \mbox{\hyperlink{class_node}{Node}} *currNode;}
\DoxyCodeLine{01863     \mbox{\hyperlink{class_node}{Node}} *otherNode;}
\DoxyCodeLine{01864 }
\DoxyCodeLine{01865     \textcolor{keywordflow}{if} (it + 1 == junction-\/>m\_nodes.end())}
\DoxyCodeLine{01866       otherNode = *junction-\/>m\_nodes.begin();}
\DoxyCodeLine{01867     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01868       otherNode = *(it + 1);}
\DoxyCodeLine{01869 }
\DoxyCodeLine{01870     \textcolor{comment}{/*      currNode = (*it)-\/>m\_prev;}}
\DoxyCodeLine{01871 \textcolor{comment}{    if(!currNode-\/>m\_visited)}}
\DoxyCodeLine{01872 \textcolor{comment}{    \{}}
\DoxyCodeLine{01873 \textcolor{comment}{            step=0;}}
\DoxyCodeLine{01874 \textcolor{comment}{            while(!currNode-\/>m\_visited \&\& currNode-\/>m\_junction != junction)}}
\DoxyCodeLine{01875 \textcolor{comment}{            \{}}
\DoxyCodeLine{01876 \textcolor{comment}{                    it = junction-\/>m\_nodes.insert(it+1, currNode);}}
\DoxyCodeLine{01877 \textcolor{comment}{                    currNode-\/>m\_visited = true;}}
\DoxyCodeLine{01878 \textcolor{comment}{                    currNode = currNode-\/>m\_prev;}}
\DoxyCodeLine{01879 \textcolor{comment}{                    ++step;}}
\DoxyCodeLine{01880 \textcolor{comment}{            \}}}
\DoxyCodeLine{01881 \textcolor{comment}{            if(currNode-\/>m\_junction != junction)}}
\DoxyCodeLine{01882 \textcolor{comment}{                    for(int i=0; i<step; ++i)}}
\DoxyCodeLine{01883 \textcolor{comment}{                    \{}}
\DoxyCodeLine{01884 \textcolor{comment}{                            currNode = currNode-\/>m\_next;}}
\DoxyCodeLine{01885 \textcolor{comment}{                            currNode-\/>m\_visited = false;}}
\DoxyCodeLine{01886 \textcolor{comment}{                            it = junction-\/>m\_nodes.erase(it);}}
\DoxyCodeLine{01887 \textcolor{comment}{                            -\/-\/it;}}
\DoxyCodeLine{01888 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01889 \textcolor{comment}{            else}}
\DoxyCodeLine{01890 \textcolor{comment}{            \{}}
\DoxyCodeLine{01891 \textcolor{comment}{                    if(currNode != otherNode)}}
\DoxyCodeLine{01892 \textcolor{comment}{                    \{}}
\DoxyCodeLine{01893 \textcolor{comment}{                            it\_temp = std::find(junction-\/>m\_nodes.begin(),}}
\DoxyCodeLine{01894 \textcolor{comment}{junction-\/>m\_nodes.end(),}}
\DoxyCodeLine{01895 \textcolor{comment}{currNode);}}
\DoxyCodeLine{01896 \textcolor{comment}{                            if(it+1 == junction-\/>m\_nodes.end())}}
\DoxyCodeLine{01897 \textcolor{comment}{                                    std::swap(*junction-\/>m\_nodes.begin(),}}
\DoxyCodeLine{01898 \textcolor{comment}{*it\_temp);}}
\DoxyCodeLine{01899 \textcolor{comment}{                            else}}
\DoxyCodeLine{01900 \textcolor{comment}{                                    std::swap(*(it+1), *it\_temp);}}
\DoxyCodeLine{01901 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01902 \textcolor{comment}{                    continue;}}
\DoxyCodeLine{01903 \textcolor{comment}{            \}}}
\DoxyCodeLine{01904 \textcolor{comment}{    \}}}
\DoxyCodeLine{01905 \textcolor{comment}{*/}}
\DoxyCodeLine{01906     currNode = (*it)-\/>m\_next;}
\DoxyCodeLine{01907     \textcolor{keywordflow}{if} (!currNode-\/>m\_visited) \{}
\DoxyCodeLine{01908       step = 0;}
\DoxyCodeLine{01909       \textcolor{keywordflow}{while} (!currNode-\/>m\_visited \&\& currNode-\/>m\_junction != junction) \{}
\DoxyCodeLine{01910         it                  = junction-\/>m\_nodes.insert(it + 1, currNode);}
\DoxyCodeLine{01911         currNode-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01912         currNode            = currNode-\/>m\_next;}
\DoxyCodeLine{01913         ++step;}
\DoxyCodeLine{01914       \}}
\DoxyCodeLine{01915       \textcolor{keywordflow}{if} (currNode-\/>m\_junction != junction)  \textcolor{comment}{//|| currNode != otherNode)}}
\DoxyCodeLine{01916         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < step; ++i) \{}
\DoxyCodeLine{01917           currNode            = currNode-\/>m\_prev;}
\DoxyCodeLine{01918           currNode-\/>m\_visited = \textcolor{keyword}{false};}
\DoxyCodeLine{01919           it                  = junction-\/>m\_nodes.erase(it);}
\DoxyCodeLine{01920           -\/-\/it;}
\DoxyCodeLine{01921         \}}
\DoxyCodeLine{01922       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01923         \textcolor{comment}{//              assert(*(it+1) == otherNode || (it+1 ==}}
\DoxyCodeLine{01924         \textcolor{comment}{// junction-\/>m\_nodes.end() \&\& *junction-\/>m\_nodes.begin() == otherNode)}}
\DoxyCodeLine{01925         \textcolor{comment}{// );}}
\DoxyCodeLine{01926         \textcolor{keywordflow}{if} (currNode != otherNode) \{}
\DoxyCodeLine{01927           \mbox{\hyperlink{class_node}{Node}} tempNode = *otherNode;}
\DoxyCodeLine{01928           *otherNode    = *currNode;}
\DoxyCodeLine{01929           *currNode     = tempNode;}
\DoxyCodeLine{01930           \textcolor{comment}{//                    it\_temp =}}
\DoxyCodeLine{01931           \textcolor{comment}{// std::find(junction-\/>m\_nodes.begin(),}}
\DoxyCodeLine{01932           \textcolor{comment}{// junction-\/>m\_nodes.end(), currNode);}}
\DoxyCodeLine{01933           \textcolor{comment}{//                    assert(it\_temp !=}}
\DoxyCodeLine{01934           \textcolor{comment}{// junction-\/>m\_nodes.end());}}
\DoxyCodeLine{01935           \textcolor{comment}{//                    if(it+1 ==}}
\DoxyCodeLine{01936           \textcolor{comment}{// junction-\/>m\_nodes.end())}}
\DoxyCodeLine{01937           \textcolor{comment}{//                        std::swap(*junction-\/>m\_nodes.begin(),}}
\DoxyCodeLine{01938           \textcolor{comment}{//*it\_temp);}}
\DoxyCodeLine{01939           \textcolor{comment}{//                    else}}
\DoxyCodeLine{01940           \textcolor{comment}{//                        std::swap(*(it+1),}}
\DoxyCodeLine{01941           \textcolor{comment}{//*it\_temp);}}
\DoxyCodeLine{01942         \}}
\DoxyCodeLine{01943         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01944       \}}
\DoxyCodeLine{01945     \}}
\DoxyCodeLine{01946   \}}
\DoxyCodeLine{01947 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_aec5e64a4ab988c590744c621e1fe4e94}\label{class_center_line_vectorizer_aec5e64a4ab988c590744c621e1fe4e94}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!createNode@{createNode}}
\index{createNode@{createNode}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{createNode()}{createNode()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_node}{Node}} $\ast$ Center\+Line\+Vectorizer\+::create\+Node (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$}]{pix }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01285                                                      \{}
\DoxyCodeLine{01286   \mbox{\hyperlink{class_node}{Node}} *node    = \textcolor{keyword}{new} \mbox{\hyperlink{class_node}{Node}}();}
\DoxyCodeLine{01287   node-\/>m\_pixel = pix;}
\DoxyCodeLine{01288   node-\/>m\_other = pix-\/>m\_node;}
\DoxyCodeLine{01289   pix-\/>m\_node   = node;}
\DoxyCodeLine{01290   m\_nodes.push\_back(node);}
\DoxyCodeLine{01291   \textcolor{keywordflow}{return} node;}
\DoxyCodeLine{01292 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_abb2eaeca611b945dae5496ef1578ab58}\label{class_center_line_vectorizer_abb2eaeca611b945dae5496ef1578ab58}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!createNodes@{createNodes}}
\index{createNodes@{createNodes}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{createNodes()}{createNodes()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::create\+Nodes (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01296 \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a737d432f55b524213921db37dcccf4ac}\label{class_center_line_vectorizer_a737d432f55b524213921db37dcccf4ac}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!createRegions@{createRegions}}
\index{createRegions@{createRegions}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{createRegions()}{createRegions()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::create\+Regions (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02418                                          \{}
\DoxyCodeLine{02419   std::list<ProtoRegion>::iterator it\_regions;}
\DoxyCodeLine{02420   \textcolor{keywordflow}{for} (it\_regions = m\_protoRegions.begin(); it\_regions != m\_protoRegions.end();}
\DoxyCodeLine{02421        it\_regions++) \{}
\DoxyCodeLine{02422     assert(it\_regions-\/>m\_points.size() > 4);}
\DoxyCodeLine{02423     \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke = \mbox{\hyperlink{class_t_stroke_a4d47a76de56f5a121aeae50098d6cc8f}{TStroke::interpolate}}(it\_regions-\/>m\_points, 0.1);}
\DoxyCodeLine{02424     stroke-\/>\mbox{\hyperlink{class_t_stroke_afa2c66ae11a70e68b3de3ce0b4cfb049}{setSelfLoop}}();}
\DoxyCodeLine{02425     stroke-\/>\mbox{\hyperlink{class_t_stroke_a33f59dfbed74b577700351eac8c2fc7b}{setStyle}}(m\_configuration.m\_strokeStyleId);}
\DoxyCodeLine{02426     m\_vimage-\/>addStroke(stroke);}
\DoxyCodeLine{02427 }
\DoxyCodeLine{02428     \textcolor{comment}{/*}}
\DoxyCodeLine{02429 \textcolor{comment}{    if(it\_regions-\/>m\_isConvex)}}
\DoxyCodeLine{02430 \textcolor{comment}{            m\_vimage-\/>fill(it\_regions-\/>m\_center, TPalette::DefaultStrokeStyle);}}
\DoxyCodeLine{02431 \textcolor{comment}{    else}}
\DoxyCodeLine{02432 \textcolor{comment}{    \{}}
\DoxyCodeLine{02433 \textcolor{comment}{            TPointD internalPoint;}}
\DoxyCodeLine{02434 \textcolor{comment}{            internalPoint = rotate90(it\_regions-\/>m\_points[1] -\/}}
\DoxyCodeLine{02435 \textcolor{comment}{it\_regions-\/>m\_points[0]);}}
\DoxyCodeLine{02436 \textcolor{comment}{            assert(norm2(internalPoint) != 0);}}
\DoxyCodeLine{02437 \textcolor{comment}{            normalize(internalPoint);}}
\DoxyCodeLine{02438 \textcolor{comment}{            internalPoint = internalPoint*0.001 + 0.5*(it\_regions-\/>m\_points[1] +}}
\DoxyCodeLine{02439 \textcolor{comment}{it\_regions-\/>m\_points[0]);}}
\DoxyCodeLine{02440 \textcolor{comment}{            m\_vimage-\/>fill(internalPoint, TPalette::DefaultStrokeStyle);}}
\DoxyCodeLine{02441 \textcolor{comment}{    \}*/}}
\DoxyCodeLine{02442   \}}
\DoxyCodeLine{02443 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a31dc81993155e7526139b9ba23cfb8d3}\label{class_center_line_vectorizer_a31dc81993155e7526139b9ba23cfb8d3}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!createStrokes@{createStrokes}}
\index{createStrokes@{createStrokes}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{createStrokes()}{createStrokes()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::create\+Strokes (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02341                                          \{}
\DoxyCodeLine{02342   std::list<ProtoStroke>::iterator it\_centerlines = m\_protoStrokes.begin();}
\DoxyCodeLine{02343   \textcolor{keywordflow}{for} (; it\_centerlines != m\_protoStrokes.end(); it\_centerlines++) \{}
\DoxyCodeLine{02344     \textcolor{keywordflow}{if} (!it\_centerlines-\/>m\_points.empty()) \{}
\DoxyCodeLine{02345       joinProtoStrokes(\&(*it\_centerlines));}
\DoxyCodeLine{02346       \textcolor{keywordflow}{if} (it\_centerlines-\/>m\_points.size() <= 1) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02347 }
\DoxyCodeLine{02348       std::vector<TThickPoint> points;}
\DoxyCodeLine{02349       std::deque<TThickPoint>::iterator it;}
\DoxyCodeLine{02350 }
\DoxyCodeLine{02351       \textcolor{keywordflow}{if} (m\_configuration.m\_smoothness > 0)  \textcolor{comment}{// gmt: prima era true}}
\DoxyCodeLine{02352       \{}
\DoxyCodeLine{02353         \textcolor{comment}{// gmt, 30-\/3-\/2006:}}
\DoxyCodeLine{02354         \textcolor{comment}{/*}}
\DoxyCodeLine{02355 \textcolor{comment}{        it = it\_centerlines-\/>m\_points.begin()+1;}}
\DoxyCodeLine{02356 \textcolor{comment}{        for(;;)}}
\DoxyCodeLine{02357 \textcolor{comment}{        \{}}
\DoxyCodeLine{02358 \textcolor{comment}{                if( it >=}}
\DoxyCodeLine{02359 \textcolor{comment}{        it\_centerlines-\/>m\_points.end()-\/(m\_configuration.m\_smoothness+1)) break;}}
\DoxyCodeLine{02360 \textcolor{comment}{                for(int j=0; j<m\_configuration.m\_smoothness;j++)}}
\DoxyCodeLine{02361 \textcolor{comment}{                        it = it\_centerlines-\/>m\_points.erase(it);}}
\DoxyCodeLine{02362 \textcolor{comment}{                ++it;}}
\DoxyCodeLine{02363 \textcolor{comment}{        \}}}
\DoxyCodeLine{02364 \textcolor{comment}{*/}}
\DoxyCodeLine{02365         \textcolor{comment}{// gmt. credo che l'idea sia di lasciare un punto e}}
\DoxyCodeLine{02366         \textcolor{comment}{// toglierne m\_configuration.m\_smoothness e cosi' via fino alla fine}}
\DoxyCodeLine{02367         \textcolor{comment}{// n.b. ho modificato il comportamento sugli eventuali ultimi punti}}
\DoxyCodeLine{02368         \textcolor{comment}{// (<m\_configuration.m\_smoothness) che prima venivano lasciati e adesso}}
\DoxyCodeLine{02369         \textcolor{comment}{// vengono tolti}}
\DoxyCodeLine{02370         std::deque<TThickPoint> \&points = it\_centerlines-\/>m\_points;}
\DoxyCodeLine{02371         it                              = points.begin();}
\DoxyCodeLine{02372         \textcolor{keywordflow}{for} (;;) \{}
\DoxyCodeLine{02373           \textcolor{keywordflow}{if} (it == points.end()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{02374           ++it;}
\DoxyCodeLine{02375           \textcolor{keywordtype}{int} maxD = std::distance(it, points.end());}
\DoxyCodeLine{02376           \textcolor{keywordtype}{int} d    = tmin(maxD, m\_configuration.m\_smoothness);}
\DoxyCodeLine{02377           \textcolor{keywordflow}{if} (d == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{02378           it = points.erase(it, it + d);}
\DoxyCodeLine{02379         \}}
\DoxyCodeLine{02380       \}}
\DoxyCodeLine{02381       it = it\_centerlines-\/>m\_points.begin();}
\DoxyCodeLine{02382       points.push\_back(*it);}
\DoxyCodeLine{02383       assert(it-\/>thick >= THICKNESS\_LIMIT);}
\DoxyCodeLine{02384       \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} old = *it;}
\DoxyCodeLine{02385       \textcolor{keywordflow}{for} (it++; it != it\_centerlines-\/>m\_points.end(); ++it) \{}
\DoxyCodeLine{02386         assert(it-\/>thick >= THICKNESS\_LIMIT);}
\DoxyCodeLine{02387         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} point(0.5 * (*it + old), 0.5 * (it-\/>thick + old.thick));}
\DoxyCodeLine{02388         points.push\_back(point);}
\DoxyCodeLine{02389         old = *it;}
\DoxyCodeLine{02390       \}}
\DoxyCodeLine{02391       points.push\_back(it\_centerlines-\/>m\_points.back());}
\DoxyCodeLine{02392 }
\DoxyCodeLine{02393       \textcolor{keywordtype}{int} n = points.size();}
\DoxyCodeLine{02394       \textcolor{keywordflow}{if} (n > 5) \{}
\DoxyCodeLine{02395         \textcolor{keywordtype}{double} *rr = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[n];}
\DoxyCodeLine{02396         \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{02397         \textcolor{keywordflow}{for} (i = 0; i < n; i++) rr[i] = points[i].thick;}
\DoxyCodeLine{02398         \textcolor{keywordflow}{for} (i            = 2; i < n -\/ 2; i++)}
\DoxyCodeLine{02399           points[i].thick = 0.8 * (1 / 5.0) * (\textcolor{comment}{/*rr[i-\/4]+rr[i-\/3]*/} +rr[i -\/ 2] +}
\DoxyCodeLine{02400                                                rr[i -\/ 1] + rr[i] + rr[i + 1] +}
\DoxyCodeLine{02401                                                rr[i + 2] \textcolor{comment}{/*+rr[i+3]+rr[i+4]*/});}
\DoxyCodeLine{02402         points[0].thick = points[1].thick =}
\DoxyCodeLine{02403             points[2].thick;  \textcolor{comment}{//=points[3].thick;//=points[4].thick;}}
\DoxyCodeLine{02404         points[n -\/ 1].thick = points[n -\/ 2].thick =}
\DoxyCodeLine{02405             points[n -\/ 3].thick;  \textcolor{comment}{//=points[n-\/4].thick;//=points[n-\/5].thick;}}
\DoxyCodeLine{02406         \textcolor{keyword}{delete}[] rr;}
\DoxyCodeLine{02407       \}}
\DoxyCodeLine{02408       \mbox{\hyperlink{class_t_stroke}{TStroke}} *stroke =}
\DoxyCodeLine{02409           \mbox{\hyperlink{class_t_stroke_a4d47a76de56f5a121aeae50098d6cc8f}{TStroke::interpolate}}(points, m\_configuration.m\_interpolationError);}
\DoxyCodeLine{02410       stroke-\/>\mbox{\hyperlink{class_t_stroke_a33f59dfbed74b577700351eac8c2fc7b}{setStyle}}(m\_configuration.m\_strokeStyleId);  \textcolor{comment}{// FirstUserStyle+2);}}
\DoxyCodeLine{02411       m\_vimage-\/>addStroke(stroke);}
\DoxyCodeLine{02412     \}}
\DoxyCodeLine{02413   \}}
\DoxyCodeLine{02414 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_aefe0ad76f88c5a267a18ef8663a11aaf}\label{class_center_line_vectorizer_aefe0ad76f88c5a267a18ef8663a11aaf}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!findOtherSide@{findOtherSide}}
\index{findOtherSide@{findOtherSide}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{findOtherSide()}{findOtherSide()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_node}{Node}} $\ast$ Center\+Line\+Vectorizer\+::find\+Other\+Side (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_node}{Node}} $\ast$}]{node }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00858                                                     \{}
\DoxyCodeLine{00859   \mbox{\hyperlink{class_data_pixel}{DataPixel}} *pix = node-\/>m\_pixel;}
\DoxyCodeLine{00860 }
\DoxyCodeLine{00861   \mbox{\hyperlink{class_t_point_t}{TPoint}} dir = -\/computeGradient(pix);}
\DoxyCodeLine{00862   \textcolor{keywordflow}{if} (dir == \mbox{\hyperlink{class_t_point_t}{TPoint}}(0, 0)) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00863   \mbox{\hyperlink{class_t_point_t}{TPoint}} d1(tsign(dir.x), 0), d2(0, tsign(dir.y));}
\DoxyCodeLine{00864   \textcolor{keywordtype}{int} num = abs(dir.y), den = abs(dir.x);}
\DoxyCodeLine{00865   \textcolor{keywordflow}{if} (num > den) \{}
\DoxyCodeLine{00866     std::swap(d1, d2);}
\DoxyCodeLine{00867     std::swap(num, den);}
\DoxyCodeLine{00868   \}}
\DoxyCodeLine{00869   \mbox{\hyperlink{class_t_point_t}{TPoint}} pos = pix-\/>m\_pos;}
\DoxyCodeLine{00870   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00871   \textcolor{keywordflow}{for} (i = 0;; i++) \{}
\DoxyCodeLine{00872     \mbox{\hyperlink{class_t_point_t}{TPoint}} q(pos.x + d1.x * i + d2.x * num * i / den,}
\DoxyCodeLine{00873              pos.y + d1.y * i + d2.y * num * i / den);}
\DoxyCodeLine{00874     \textcolor{comment}{// if (!m\_dataRaster-\/>getBounds().contains(q)) break;}}
\DoxyCodeLine{00875     \mbox{\hyperlink{class_data_pixel}{DataPixel}} *nextPix = m\_dataRaster-\/>pixels(q.y) + q.x;}
\DoxyCodeLine{00876     \textcolor{keywordflow}{if} (nextPix-\/>m\_ink == \textcolor{keyword}{false}) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00877     pix = nextPix;}
\DoxyCodeLine{00878   \}}
\DoxyCodeLine{00879   assert(pix);}
\DoxyCodeLine{00880   \textcolor{keywordflow}{if} (!pix-\/>m\_node) \{}
\DoxyCodeLine{00881     \textcolor{keyword}{const} \textcolor{keywordtype}{int} wrap = m\_dataRaster-\/>getWrap();}
\DoxyCodeLine{00882     \textcolor{keywordflow}{if} (pix[-\/1].m\_node)}
\DoxyCodeLine{00883       pix-\/-\/;}
\DoxyCodeLine{00884     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pix[1].m\_node)}
\DoxyCodeLine{00885       pix++;}
\DoxyCodeLine{00886     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pix[wrap].m\_node)}
\DoxyCodeLine{00887       pix += wrap;}
\DoxyCodeLine{00888     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pix[-\/wrap].m\_node)}
\DoxyCodeLine{00889       pix -\/= wrap;}
\DoxyCodeLine{00890     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00891       assert(0);}
\DoxyCodeLine{00892     \}}
\DoxyCodeLine{00893   \}}
\DoxyCodeLine{00894   \textcolor{keywordflow}{if} (!pix-\/>m\_node) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00895   \mbox{\hyperlink{class_node}{Node}} *q                                 = pix-\/>m\_node;}
\DoxyCodeLine{00896   \textcolor{keywordflow}{while} (q-\/>m\_pixel == 0 \&\& q-\/>m\_other) q = q-\/>m\_other;}
\DoxyCodeLine{00897   assert(q \&\& q-\/>m\_pixel == pix);}
\DoxyCodeLine{00898 }
\DoxyCodeLine{00899   \textcolor{keywordflow}{for} (i = 0; i < 5; i++) \{}
\DoxyCodeLine{00900     \textcolor{keywordflow}{if} (!q-\/>m\_prev) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00901     q = q-\/>m\_prev;}
\DoxyCodeLine{00902   \}}
\DoxyCodeLine{00903 }
\DoxyCodeLine{00904   \mbox{\hyperlink{class_node}{Node}} *best       = q;}
\DoxyCodeLine{00905   \textcolor{keywordtype}{double} bestDist2 = computeDistance2(q, node);}
\DoxyCodeLine{00906   \textcolor{keywordflow}{for} (i = 0; i < 10; i++) \{}
\DoxyCodeLine{00907     q = q-\/>m\_next;}
\DoxyCodeLine{00908     \textcolor{keywordflow}{if} (!q) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00909     \textcolor{keywordtype}{double} dist2 = computeDistance2(q, node);}
\DoxyCodeLine{00910     \textcolor{keywordflow}{if} (dist2 < bestDist2) \{}
\DoxyCodeLine{00911       bestDist2 = dist2;}
\DoxyCodeLine{00912       best      = q;}
\DoxyCodeLine{00913     \}}
\DoxyCodeLine{00914   \}}
\DoxyCodeLine{00915 }
\DoxyCodeLine{00916   \textcolor{keywordflow}{return} best;}
\DoxyCodeLine{00917 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a385916cdd69ff0d1b0c0387566df51f9}\label{class_center_line_vectorizer_a385916cdd69ff0d1b0c0387566df51f9}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!handleJunctions@{handleJunctions}}
\index{handleJunctions@{handleJunctions}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{handleJunctions()}{handleJunctions()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::handle\+Junctions (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02074                                            \{}
\DoxyCodeLine{02075   std::vector<Junction *>::iterator it\_junction = m\_junctions.begin();}
\DoxyCodeLine{02076   \textcolor{keywordflow}{for} (it\_junction = m\_junctions.begin(); it\_junction < m\_junctions.end();}
\DoxyCodeLine{02077        it\_junction++) \{}
\DoxyCodeLine{02078     \mbox{\hyperlink{class_junction}{Junction}} *currJunction = *it\_junction;}
\DoxyCodeLine{02079 }
\DoxyCodeLine{02080     \textcolor{keywordflow}{if} (currJunction-\/>m\_protoStrokes.empty()) \{}
\DoxyCodeLine{02081       std::deque<Node *>::iterator it\_node;}
\DoxyCodeLine{02082       \textcolor{keywordflow}{for} (it\_node = currJunction-\/>m\_nodes.begin();}
\DoxyCodeLine{02083            it\_node != currJunction-\/>m\_nodes.end(); ++it\_node) \{}
\DoxyCodeLine{02084         (*it\_node)-\/>m\_junction = 0;}
\DoxyCodeLine{02085         (*it\_node)-\/>m\_visited  = \textcolor{keyword}{false};}
\DoxyCodeLine{02086       \}}
\DoxyCodeLine{02087       \textcolor{keyword}{delete} currJunction;}
\DoxyCodeLine{02088       it\_junction = m\_junctions.erase(it\_junction);}
\DoxyCodeLine{02089       -\/-\/it\_junction;}
\DoxyCodeLine{02090       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02091     \}}
\DoxyCodeLine{02092 }
\DoxyCodeLine{02093     std::vector<ProtoStroke *>::iterator it;}
\DoxyCodeLine{02094 }
\DoxyCodeLine{02095     \textcolor{comment}{// set polygon center}}
\DoxyCodeLine{02096     \textcolor{comment}{/*      double size = currJunction-\/>m\_nodes.size();}}
\DoxyCodeLine{02097 \textcolor{comment}{    std::deque<Node*>::iterator it\_node;}}
\DoxyCodeLine{02098 \textcolor{comment}{    for(it\_node = currJunction-\/>m\_nodes.begin();}}
\DoxyCodeLine{02099 \textcolor{comment}{it\_node!=currJunction-\/>m\_nodes.end(); it\_node++)}}
\DoxyCodeLine{02100 \textcolor{comment}{    \{}}
\DoxyCodeLine{02101 \textcolor{comment}{            currJunction-\/>m\_center += convert( (*it\_node)-\/>m\_pixel-\/>m\_pos );}}
\DoxyCodeLine{02102 \textcolor{comment}{    \}}}
\DoxyCodeLine{02103 \textcolor{comment}{    currJunction-\/>m\_center = currJunction-\/>m\_center * (1/size);}}
\DoxyCodeLine{02104 \textcolor{comment}{}}
\DoxyCodeLine{02105 \textcolor{comment}{    size = currJunction-\/>m\_protoStrokes.size();}}
\DoxyCodeLine{02106 \textcolor{comment}{    if(size == 0)}}
\DoxyCodeLine{02107 \textcolor{comment}{    \{}}
\DoxyCodeLine{02108 \textcolor{comment}{            currJunction-\/>m\_center.thick = THICKNESS\_LIMIT;}}
\DoxyCodeLine{02109 \textcolor{comment}{            continue;}}
\DoxyCodeLine{02110 \textcolor{comment}{    \}}}
\DoxyCodeLine{02111 \textcolor{comment}{*/}}
\DoxyCodeLine{02112     \textcolor{keywordtype}{double} size = currJunction-\/>m\_protoStrokes.size();}
\DoxyCodeLine{02113     \textcolor{keywordflow}{for} (it = currJunction-\/>m\_protoStrokes.begin();}
\DoxyCodeLine{02114          it != currJunction-\/>m\_protoStrokes.end(); it++) \{}
\DoxyCodeLine{02115       \textcolor{keywordflow}{if} (((*it))-\/>m\_startJunction == currJunction \&\&}
\DoxyCodeLine{02116           (*it)-\/>m\_endJunction == currJunction) \{}
\DoxyCodeLine{02117         currJunction-\/>m\_center += 0.5 * (*it)-\/>m\_points.front();}
\DoxyCodeLine{02118         currJunction-\/>m\_center += 0.5 * (*it)-\/>m\_points.back();}
\DoxyCodeLine{02119       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (((*it))-\/>m\_startJunction == currJunction) \{}
\DoxyCodeLine{02120         currJunction-\/>m\_center += (*it)-\/>m\_points.front();}
\DoxyCodeLine{02121       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((*it)-\/>m\_endJunction == currJunction) \{}
\DoxyCodeLine{02122         currJunction-\/>m\_center += (*it)-\/>m\_points.back();}
\DoxyCodeLine{02123       \}}
\DoxyCodeLine{02124     \}}
\DoxyCodeLine{02125     currJunction-\/>m\_center = currJunction-\/>m\_center * (1 / size);}
\DoxyCodeLine{02126   \}}
\DoxyCodeLine{02127 }
\DoxyCodeLine{02128 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{02129   \textcolor{keywordtype}{int} j = 0;}
\DoxyCodeLine{02130   \textcolor{keywordflow}{for} (; j < (int)m\_nodes.size(); j++) \{}
\DoxyCodeLine{02131     \mbox{\hyperlink{class_node}{Node}} *node = m\_nodes[j];}
\DoxyCodeLine{02132     \textcolor{keywordflow}{if} (!node-\/>m\_visited \&\& node-\/>m\_pixel) \{}
\DoxyCodeLine{02133       m\_unvisitedNodes.push\_back(convert(node-\/>m\_pixel-\/>m\_pos));}
\DoxyCodeLine{02134       \textcolor{comment}{//            resolveUnvisitedNode(node);}}
\DoxyCodeLine{02135     \}}
\DoxyCodeLine{02136   \}}
\DoxyCodeLine{02137 }
\DoxyCodeLine{02138   \textcolor{keywordflow}{for} (j = 0; j < (int)m\_nodes.size(); j++) \{}
\DoxyCodeLine{02139     \mbox{\hyperlink{class_node}{Node}} *node = m\_nodes[j];}
\DoxyCodeLine{02140     \textcolor{comment}{//      assert(node-\/>m\_visited || !node-\/>m\_pixel);}}
\DoxyCodeLine{02141     \textcolor{keywordflow}{if} (node-\/>m\_pixel == 0 || node-\/>m\_flag) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02142     outputNodes(node);}
\DoxyCodeLine{02143   \}}
\DoxyCodeLine{02144 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02145 }
\DoxyCodeLine{02146   joinJunctions();}
\DoxyCodeLine{02147   \textcolor{comment}{//    return;}}
\DoxyCodeLine{02148   \textcolor{keywordflow}{for} (it\_junction = m\_junctions.begin(); it\_junction < m\_junctions.end();}
\DoxyCodeLine{02149        it\_junction++) \{}
\DoxyCodeLine{02150     \mbox{\hyperlink{class_junction}{Junction}} *currJunction = *it\_junction;}
\DoxyCodeLine{02151     \textcolor{keywordflow}{if} (currJunction-\/>m\_center.thick < 2 * THICKNESS\_LIMIT)}
\DoxyCodeLine{02152       currJunction-\/>m\_center.thick = 2 * THICKNESS\_LIMIT;}
\DoxyCodeLine{02153 }
\DoxyCodeLine{02154     std::vector<ProtoStroke *>::iterator it, it\_next;}
\DoxyCodeLine{02155 }
\DoxyCodeLine{02156     createJunctionPolygon(currJunction);}
\DoxyCodeLine{02157 }
\DoxyCodeLine{02158     currJunction-\/>m\_junctionOrder = currJunction-\/>m\_protoStrokes.size();}
\DoxyCodeLine{02159 }
\DoxyCodeLine{02160     \textcolor{keywordflow}{if} (currJunction-\/>m\_protoStrokes.size() == 3) \{}
\DoxyCodeLine{02161       std::vector<ProtoStroke *>::iterator it\_e =}
\DoxyCodeLine{02162           currJunction-\/>m\_protoStrokes.end();}
\DoxyCodeLine{02163       std::vector<ProtoStroke *>::iterator it\_candidate1 = it\_e,}
\DoxyCodeLine{02164                                            it\_candidate2 = it\_e;}
\DoxyCodeLine{02165       \textcolor{keywordtype}{int} candidate1\_k, candidate2\_k;}
\DoxyCodeLine{02166       \textcolor{keywordtype}{double} candidateProbability = JOIN\_LIMIT;}
\DoxyCodeLine{02167       \textcolor{keywordtype}{int} k, next\_k;}
\DoxyCodeLine{02168       \textcolor{keywordflow}{for} (it = currJunction-\/>m\_protoStrokes.begin(); it != it\_e; it++) \{}
\DoxyCodeLine{02169         \textcolor{keywordflow}{if} (((*it))-\/>m\_startJunction == currJunction)}
\DoxyCodeLine{02170           k = 0;}
\DoxyCodeLine{02171         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((*it)-\/>m\_endJunction == currJunction)}
\DoxyCodeLine{02172           k = 1;}
\DoxyCodeLine{02173         \textcolor{keywordflow}{else}}
\DoxyCodeLine{02174           assert(\textcolor{keyword}{false});}
\DoxyCodeLine{02175 }
\DoxyCodeLine{02176         \textcolor{keywordflow}{if} (isFalseBranch(k, *it, 0, currJunction-\/>m\_center)) \{}
\DoxyCodeLine{02177           currJunction-\/>m\_protoStrokes.erase(it);}
\DoxyCodeLine{02178           currJunction-\/>m\_locked = \textcolor{keyword}{true};}
\DoxyCodeLine{02179           \textcolor{keywordflow}{break};}
\DoxyCodeLine{02180         \}}
\DoxyCodeLine{02181 }
\DoxyCodeLine{02182         it\_next = it;}
\DoxyCodeLine{02183         it\_next++;}
\DoxyCodeLine{02184         \textcolor{keywordflow}{for} (; it\_next != it\_e; it\_next++) \{}
\DoxyCodeLine{02185           \textcolor{keywordtype}{double} probability;}
\DoxyCodeLine{02186           \textcolor{keywordflow}{if} (((*it\_next))-\/>m\_startJunction == currJunction)}
\DoxyCodeLine{02187             next\_k = 0;}
\DoxyCodeLine{02188           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((*it\_next)-\/>m\_endJunction == currJunction)}
\DoxyCodeLine{02189             next\_k = 1;}
\DoxyCodeLine{02190           \textcolor{keywordflow}{else}}
\DoxyCodeLine{02191             assert(\textcolor{keyword}{false});}
\DoxyCodeLine{02192 }
\DoxyCodeLine{02193           \textcolor{keywordflow}{if} (k == 0) \{}
\DoxyCodeLine{02194             \textcolor{keywordflow}{if} (next\_k == 0)}
\DoxyCodeLine{02195               probability = 1 -\/ norm2((*it)-\/>m\_startDirection +}
\DoxyCodeLine{02196                                       (*it\_next)-\/>m\_startDirection);}
\DoxyCodeLine{02197             \textcolor{keywordflow}{else}}
\DoxyCodeLine{02198               probability = 1 -\/ norm2((*it)-\/>m\_startDirection +}
\DoxyCodeLine{02199                                       (*it\_next)-\/>m\_endDirection);}
\DoxyCodeLine{02200           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02201             \textcolor{keywordflow}{if} (next\_k == 0)}
\DoxyCodeLine{02202               probability = 1 -\/ norm2((*it)-\/>m\_endDirection +}
\DoxyCodeLine{02203                                       (*it\_next)-\/>m\_startDirection);}
\DoxyCodeLine{02204             \textcolor{keywordflow}{else}}
\DoxyCodeLine{02205               probability =}
\DoxyCodeLine{02206                   1 -\/ norm2((*it)-\/>m\_endDirection + (*it\_next)-\/>m\_endDirection);}
\DoxyCodeLine{02207           \}}
\DoxyCodeLine{02208           \textcolor{keywordflow}{if} (probability > candidateProbability ||}
\DoxyCodeLine{02209               (*it)-\/>m\_points.size() < 3) \{}
\DoxyCodeLine{02210             candidateProbability = probability;}
\DoxyCodeLine{02211             it\_candidate1        = it;}
\DoxyCodeLine{02212             it\_candidate2        = it\_next;}
\DoxyCodeLine{02213             candidate1\_k         = k;}
\DoxyCodeLine{02214             candidate2\_k         = next\_k;}
\DoxyCodeLine{02215           \}}
\DoxyCodeLine{02216         \}}
\DoxyCodeLine{02217       \}}
\DoxyCodeLine{02218       \textcolor{keywordflow}{if} (currJunction-\/>m\_protoStrokes.size() == 3 \&\& it\_candidate1 != it\_e \&\&}
\DoxyCodeLine{02219           it\_candidate2 != it\_e) \{}
\DoxyCodeLine{02220         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} p1 = (candidate1\_k == 0)}
\DoxyCodeLine{02221                              ? (*it\_candidate1)-\/>m\_points.front()}
\DoxyCodeLine{02222                              : (*it\_candidate1)-\/>m\_points.back();}
\DoxyCodeLine{02223         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} p2 = (candidate2\_k == 0)}
\DoxyCodeLine{02224                              ? (*it\_candidate2)-\/>m\_points.front()}
\DoxyCodeLine{02225                              : (*it\_candidate2)-\/>m\_points.back();}
\DoxyCodeLine{02226         currJunction-\/>m\_center = 0.5 * (p1 + p2);}
\DoxyCodeLine{02227       \}}
\DoxyCodeLine{02228     \}}
\DoxyCodeLine{02229     \textcolor{keywordflow}{if} (\textcolor{keyword}{false} || currJunction-\/>m\_protoStrokes.size() == 2) \{}
\DoxyCodeLine{02230       \mbox{\hyperlink{class_t_point_t}{TPointD}} a1, a2, b1, b2;}
\DoxyCodeLine{02231 }
\DoxyCodeLine{02232       \textcolor{keywordflow}{if} (currJunction-\/>m\_protoStrokes[0]-\/>m\_startJunction == currJunction) \{}
\DoxyCodeLine{02233         a1 = currJunction-\/>m\_protoStrokes[0]-\/>m\_points.front();}
\DoxyCodeLine{02234         a2 = currJunction-\/>m\_protoStrokes[0]-\/>m\_startDirection -\/ a1;}
\DoxyCodeLine{02235       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02236         assert(currJunction-\/>m\_protoStrokes[0]-\/>m\_endJunction == currJunction);}
\DoxyCodeLine{02237         a1 = currJunction-\/>m\_protoStrokes[0]-\/>m\_points.back();}
\DoxyCodeLine{02238         a2 = currJunction-\/>m\_protoStrokes[0]-\/>m\_endDirection -\/ a1;}
\DoxyCodeLine{02239       \}}
\DoxyCodeLine{02240 }
\DoxyCodeLine{02241       \textcolor{keywordflow}{if} (currJunction-\/>m\_protoStrokes[1]-\/>m\_startJunction == currJunction) \{}
\DoxyCodeLine{02242         b1 = currJunction-\/>m\_protoStrokes[1]-\/>m\_points.front();}
\DoxyCodeLine{02243         b2 = currJunction-\/>m\_protoStrokes[1]-\/>m\_startDirection -\/ b1;}
\DoxyCodeLine{02244       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02245         assert(currJunction-\/>m\_protoStrokes[1]-\/>m\_endJunction == currJunction);}
\DoxyCodeLine{02246         b1 = currJunction-\/>m\_protoStrokes[1]-\/>m\_points.back();}
\DoxyCodeLine{02247         b2 = currJunction-\/>m\_protoStrokes[1]-\/>m\_endDirection -\/ b1;}
\DoxyCodeLine{02248       \}}
\DoxyCodeLine{02249 }
\DoxyCodeLine{02250 \textcolor{comment}{/*          TPointD intersection;}}
\DoxyCodeLine{02251 \textcolor{comment}{            RectIntersectionResult res;}}
\DoxyCodeLine{02252 \textcolor{comment}{            res = rectsIntersect(a1, a2, b1, b2, intersection);}}
\DoxyCodeLine{02253 \textcolor{comment}{//          assert(res == intersected);}}
\DoxyCodeLine{02254 \textcolor{comment}{            if( norm(intersection -\/ currJunction-\/>m\_center) < 5 \&\& res == }}
\DoxyCodeLine{02255 \textcolor{comment}{intersected)}}
\DoxyCodeLine{02256 \textcolor{comment}{            \{}}
\DoxyCodeLine{02257 \textcolor{comment}{                currJunction-\/>m\_center.x = intersection.x;}}
\DoxyCodeLine{02258 \textcolor{comment}{                currJunction-\/>m\_center.y = intersection.y;}}
\DoxyCodeLine{02259 \textcolor{comment}{            \}}}
\DoxyCodeLine{02260 \textcolor{comment}{*/}      \}}
\DoxyCodeLine{02261 }
\DoxyCodeLine{02262 \textcolor{keywordflow}{if} (\textcolor{keyword}{true} || currJunction-\/>m\_nodes.size() <= 12 || currJunction-\/>isConvex()) \{}
\DoxyCodeLine{02263   \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} junctionPoint(currJunction-\/>m\_center);}
\DoxyCodeLine{02264   \textcolor{keywordflow}{for} (it = currJunction-\/>m\_protoStrokes.begin();}
\DoxyCodeLine{02265        it != currJunction-\/>m\_protoStrokes.end(); it++) \{}
\DoxyCodeLine{02266     assert((*it)-\/>m\_startJunction == currJunction ||}
\DoxyCodeLine{02267            (*it)-\/>m\_endJunction == currJunction);}
\DoxyCodeLine{02268     \textcolor{keywordflow}{if} ((*it)-\/>m\_startJunction == currJunction) \{}
\DoxyCodeLine{02269       \mbox{\hyperlink{class_t_point_t}{TPointD}} deltaPoint = (*it)-\/>m\_points.front() -\/ junctionPoint;}
\DoxyCodeLine{02270       \textcolor{keywordtype}{double} deltaThick  = (*it)-\/>m\_points.front().thick -\/ junctionPoint.thick;}
\DoxyCodeLine{02271       \textcolor{keywordflow}{if} (norm2(deltaPoint) > 0.2) \{}
\DoxyCodeLine{02272         \textcolor{keywordflow}{if} (norm2(deltaPoint) > 2) \{}
\DoxyCodeLine{02273           (*it)-\/>m\_points.push\_front(}
\DoxyCodeLine{02274               \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(junctionPoint + 0.7 * deltaPoint,}
\DoxyCodeLine{02275                           junctionPoint.thick + 0.7 * deltaThick));}
\DoxyCodeLine{02276           (*it)-\/>m\_points.push\_front(}
\DoxyCodeLine{02277               \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(junctionPoint + 0.4 * deltaPoint,}
\DoxyCodeLine{02278                           junctionPoint.thick + 0.4 * deltaThick));}
\DoxyCodeLine{02279         \}}
\DoxyCodeLine{02280         (*it)-\/>m\_points.push\_front(}
\DoxyCodeLine{02281             \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(junctionPoint + 0.0 * deltaPoint,}
\DoxyCodeLine{02282                         junctionPoint.thick + 0.0 * deltaThick));}
\DoxyCodeLine{02283       \}}
\DoxyCodeLine{02284     \}}
\DoxyCodeLine{02285     \textcolor{keywordflow}{if} ((*it)-\/>m\_endJunction == currJunction) \{}
\DoxyCodeLine{02286       \mbox{\hyperlink{class_t_point_t}{TPointD}} deltaPoint = (*it)-\/>m\_points.back() -\/ junctionPoint;}
\DoxyCodeLine{02287       \textcolor{keywordtype}{double} deltaThick  = (*it)-\/>m\_points.back().thick -\/ junctionPoint.thick;}
\DoxyCodeLine{02288       \textcolor{keywordflow}{if} (norm2(deltaPoint) > 0.2) \{}
\DoxyCodeLine{02289         \textcolor{keywordflow}{if} (norm2(deltaPoint) > 2) \{}
\DoxyCodeLine{02290           (*it)-\/>m\_points.push\_back(}
\DoxyCodeLine{02291               \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(junctionPoint + 0.7 * deltaPoint,}
\DoxyCodeLine{02292                           junctionPoint.thick + 0.7 * deltaThick));}
\DoxyCodeLine{02293           (*it)-\/>m\_points.push\_back(}
\DoxyCodeLine{02294               \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(junctionPoint + 0.4 * deltaPoint,}
\DoxyCodeLine{02295                           junctionPoint.thick + 0.4 * deltaThick));}
\DoxyCodeLine{02296         \}}
\DoxyCodeLine{02297         (*it)-\/>m\_points.push\_back(}
\DoxyCodeLine{02298             \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(junctionPoint + 0.0 * deltaPoint,}
\DoxyCodeLine{02299                         junctionPoint.thick + 0.0 * deltaThick));}
\DoxyCodeLine{02300       \}}
\DoxyCodeLine{02301     \}}
\DoxyCodeLine{02302   \}}
\DoxyCodeLine{02303 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{02304   \mbox{\hyperlink{class_proto_region}{ProtoRegion}} region(currJunction-\/>isConvex());}
\DoxyCodeLine{02305   region.m\_center = currJunction-\/>m\_center;}
\DoxyCodeLine{02306 }
\DoxyCodeLine{02307   std::deque<Node *>::iterator it\_nodes;}
\DoxyCodeLine{02308   \textcolor{keywordflow}{for} (it\_nodes = currJunction-\/>m\_nodes.begin();}
\DoxyCodeLine{02309        it\_nodes != currJunction-\/>m\_nodes.end(); it\_nodes++)}
\DoxyCodeLine{02310     region.m\_points.push\_back(}
\DoxyCodeLine{02311         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(convert((*it\_nodes)-\/>m\_pixel-\/>m\_pos), 0.0));}
\DoxyCodeLine{02312 }
\DoxyCodeLine{02313   region.m\_points.push\_back(\mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(}
\DoxyCodeLine{02314       convert((*currJunction-\/>m\_nodes.begin())-\/>m\_pixel-\/>m\_pos), 0.0));}
\DoxyCodeLine{02315 }
\DoxyCodeLine{02316   m\_protoRegions.push\_back(region);}
\DoxyCodeLine{02317 }
\DoxyCodeLine{02318   \textcolor{keywordflow}{for} (it = currJunction-\/>m\_protoStrokes.begin();}
\DoxyCodeLine{02319        it != currJunction-\/>m\_protoStrokes.end(); it++) \{}
\DoxyCodeLine{02320     \textcolor{keywordflow}{if} ((*it)-\/>m\_startJunction == currJunction \&\&}
\DoxyCodeLine{02321         (*it)-\/>m\_endJunction == currJunction) \{}
\DoxyCodeLine{02322       \textcolor{keywordflow}{if} ((*it)-\/>m\_points.size() < 10) (*it)-\/>m\_points.clear();}
\DoxyCodeLine{02323     \}}
\DoxyCodeLine{02324 }
\DoxyCodeLine{02325     \textcolor{keywordflow}{if} ((*it)-\/>m\_startJunction == currJunction) \{}
\DoxyCodeLine{02326       (*it)-\/>m\_startJunction = 0;}
\DoxyCodeLine{02327     \}}
\DoxyCodeLine{02328     \textcolor{keywordflow}{if} ((*it)-\/>m\_endJunction == currJunction) \{}
\DoxyCodeLine{02329       (*it)-\/>m\_endJunction = 0;}
\DoxyCodeLine{02330     \}}
\DoxyCodeLine{02331   \}}
\DoxyCodeLine{02332   currJunction-\/>m\_protoStrokes.clear();}
\DoxyCodeLine{02333 \}}
\DoxyCodeLine{02334   \}}
\DoxyCodeLine{02335 }
\DoxyCodeLine{02336   \textcolor{comment}{// handleLinks();}}
\DoxyCodeLine{02337 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_aa0c75b40affba85bc1dcbf14d451dc03}\label{class_center_line_vectorizer_aa0c75b40affba85bc1dcbf14d451dc03}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!handleLinks@{handleLinks}}
\index{handleLinks@{handleLinks}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{handleLinks()}{handleLinks()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::handle\+Links (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01951                                        \{}
\DoxyCodeLine{01952   std::vector<JunctionLink>::iterator it\_links;}
\DoxyCodeLine{01953   \textcolor{keywordflow}{for} (it\_links = m\_links.begin(); it\_links != m\_links.end(); ++it\_links) \{}
\DoxyCodeLine{01954     \mbox{\hyperlink{class_proto_stroke}{ProtoStroke}} linkingProtoStroke;}
\DoxyCodeLine{01955 }
\DoxyCodeLine{01956     \textcolor{comment}{// initialize points}}
\DoxyCodeLine{01957     \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} p1 = it\_links-\/>m\_first-\/>m\_center;}
\DoxyCodeLine{01958     \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} p2 = it\_links-\/>m\_second-\/>m\_center -\/ p1;}
\DoxyCodeLine{01959     linkingProtoStroke.m\_points.push\_back(}
\DoxyCodeLine{01960         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(p1, JUNCTION\_THICKNESS\_RATIO * p1.thick));}
\DoxyCodeLine{01961     linkingProtoStroke.m\_points.push\_back(\mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(}
\DoxyCodeLine{01962         p1 + 0.5 * p2, JUNCTION\_THICKNESS\_RATIO * (p1.thick + 0.5 * p2.thick)));}
\DoxyCodeLine{01963     linkingProtoStroke.m\_points.push\_back(}
\DoxyCodeLine{01964         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(p1 + p2, JUNCTION\_THICKNESS\_RATIO * (p1.thick + p2.thick)));}
\DoxyCodeLine{01965 }
\DoxyCodeLine{01966     \textcolor{comment}{// initialize directions}}
\DoxyCodeLine{01967     setEndpointsDirections(linkingProtoStroke);}
\DoxyCodeLine{01968 }
\DoxyCodeLine{01969     \textcolor{comment}{// initialize junctions}}
\DoxyCodeLine{01970     \textcolor{comment}{/*      linkingProtoStroke.m\_startJunction = it\_links-\/>first;}}
\DoxyCodeLine{01971 \textcolor{comment}{    linkingProtoStroke.m\_endJunction = it\_links-\/>second;*/}}
\DoxyCodeLine{01972     m\_protoStrokes.push\_back(linkingProtoStroke);}
\DoxyCodeLine{01973     \textcolor{comment}{/*      it\_links-\/>first-\/>m\_protoStrokes.push\_back(\&m\_protoStrokes.back());}}
\DoxyCodeLine{01974 \textcolor{comment}{    it\_links-\/>second-\/>m\_protoStrokes.push\_back(\&m\_protoStrokes.back());*/}}
\DoxyCodeLine{01975   \}}
\DoxyCodeLine{01976 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a64e746f48131a5fff831c84d8dd091c5}\label{class_center_line_vectorizer_a64e746f48131a5fff831c84d8dd091c5}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!init@{init}}
\index{init@{init}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00725                                 \{}
\DoxyCodeLine{00726   \textcolor{keywordtype}{int} y;}
\DoxyCodeLine{00727 }
\DoxyCodeLine{00728   \textcolor{comment}{/*m\_links.clear();}}
\DoxyCodeLine{00729 \textcolor{comment}{  m\_protoStrokes.clear();}}
\DoxyCodeLine{00730 \textcolor{comment}{  m\_protoRegions.clear();}}
\DoxyCodeLine{00731 \textcolor{comment}{  clearNodes();}}
\DoxyCodeLine{00732 \textcolor{comment}{  clearJunctions();*/}}
\DoxyCodeLine{00733 }
\DoxyCodeLine{00734   \mbox{\hyperlink{class_t_raster_p_t}{DataRasterP}} dataRaster = m\_dataRaster;}
\DoxyCodeLine{00735   \textcolor{keyword}{const} \textcolor{keywordtype}{int} wrap         = dataRaster-\/>getWrap();}
\DoxyCodeLine{00736   \textcolor{keyword}{const} \textcolor{keywordtype}{int} delta[]      = \{-\/wrap -\/ 1, -\/wrap, -\/wrap + 1, 1,}
\DoxyCodeLine{00737                        wrap + 1,  wrap,  wrap -\/ 1,  -\/1\};}
\DoxyCodeLine{00738 }
\DoxyCodeLine{00739   \textcolor{keywordflow}{for} (y = 1; y < dataRaster-\/>getLy() -\/ 1; y++) \{}
\DoxyCodeLine{00740     \mbox{\hyperlink{class_data_pixel}{DataPixel}} *pix    = dataRaster-\/>pixels(y);}
\DoxyCodeLine{00741     \mbox{\hyperlink{class_data_pixel}{DataPixel}} *endPix = pix + dataRaster-\/>getLx() -\/ 1;}
\DoxyCodeLine{00742     pix++;}
\DoxyCodeLine{00743     \textcolor{keywordflow}{for} (pix++; pix < endPix; ++pix) \{}
\DoxyCodeLine{00744       \textcolor{keywordflow}{if} ((pix-\/>m\_ink == \textcolor{keyword}{false}) || (pix[-\/wrap].m\_ink \&\& pix[wrap].m\_ink \&\&}
\DoxyCodeLine{00745                                     pix[-\/1].m\_ink \&\& pix[1].m\_ink))}
\DoxyCodeLine{00746         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00747       \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00748       \textcolor{keywordflow}{for} (i = 0; i < 8; i++)}
\DoxyCodeLine{00749         \textcolor{keywordflow}{if} (pix[delta[i]].m\_ink \&\& pix[delta[(i + 1) \& 0x7]].m\_ink == \textcolor{keyword}{false})}
\DoxyCodeLine{00750           \textcolor{keywordflow}{break};}
\DoxyCodeLine{00751       \textcolor{keywordtype}{int} start = i;}
\DoxyCodeLine{00752       \textcolor{keywordflow}{if} (i == 8) \textcolor{keywordflow}{continue};  \textcolor{comment}{// punto isolato}}
\DoxyCodeLine{00753       \textcolor{keywordflow}{for} (;;) \{}
\DoxyCodeLine{00754         \textcolor{keywordtype}{int} j = (i + 1) \& 0x7;}
\DoxyCodeLine{00755         assert(i < 8 \&\& pix[delta[i]].m\_ink);}
\DoxyCodeLine{00756         assert(j < 8 \&\& pix[delta[j]].m\_ink == \textcolor{keyword}{false});}
\DoxyCodeLine{00757         \textcolor{keywordflow}{do}}
\DoxyCodeLine{00758           j = (j + 1) \& 0x7;}
\DoxyCodeLine{00759         \textcolor{keywordflow}{while} (pix[delta[j]].m\_ink == \textcolor{keyword}{false});}
\DoxyCodeLine{00760         assert(j < 8 \&\& pix[delta[j]].m\_ink);}
\DoxyCodeLine{00761         \textcolor{keywordflow}{if} (((i + 2) \& 0x7) != j || (i \& 1) == 0) \{}
\DoxyCodeLine{00762           \textcolor{comment}{// il bianco comprende anche un fianco}}
\DoxyCodeLine{00763           link(pix, pix + delta[i], pix + delta[j]);}
\DoxyCodeLine{00764         \}}
\DoxyCodeLine{00765         i = j;}
\DoxyCodeLine{00766         assert(i < 8);}
\DoxyCodeLine{00767         \textcolor{keywordflow}{while} (pix[delta[(i + 1) \& 0x7]].m\_ink) i = (i + 1) \& 0x7;}
\DoxyCodeLine{00768         assert(i < 8 \&\& pix[delta[i]].m\_ink);}
\DoxyCodeLine{00769         assert(pix[delta[(i + 1) \& 0x7]].m\_ink == \textcolor{keyword}{false});}
\DoxyCodeLine{00770         \textcolor{keywordflow}{if} (i == start) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00771       \}}
\DoxyCodeLine{00772     \}}
\DoxyCodeLine{00773   \}}
\DoxyCodeLine{00774 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a8a3d7d1cd895e3ffa710592f5e0f2ccb}\label{class_center_line_vectorizer_a8a3d7d1cd895e3ffa710592f5e0f2ccb}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!joinJunctions@{joinJunctions}}
\index{joinJunctions@{joinJunctions}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{joinJunctions()}{joinJunctions()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::join\+Junctions (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01685                                          \{}
\DoxyCodeLine{01686   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)m\_junctions.size(); i++) \{}
\DoxyCodeLine{01687     \mbox{\hyperlink{class_junction}{Junction}} *currJunction = m\_junctions[i];}
\DoxyCodeLine{01688 }
\DoxyCodeLine{01689     \textcolor{comment}{//      if(currJunction-\/>m\_nodes.size() <= 2) continue;}}
\DoxyCodeLine{01690 }
\DoxyCodeLine{01691     std::list<JunctionMerge> joinJunctions;}
\DoxyCodeLine{01692     joinJunctions.push\_back(\mbox{\hyperlink{class_junction_merge}{JunctionMerge}}(currJunction));}
\DoxyCodeLine{01693 }
\DoxyCodeLine{01694     \textcolor{comment}{//      std::sort(currJunction-\/>m\_nodes.begin(),}}
\DoxyCodeLine{01695     \textcolor{comment}{// currJunction-\/>m\_nodes.end());}}
\DoxyCodeLine{01696     std::deque<Node *>::iterator it;}
\DoxyCodeLine{01697     \textcolor{keywordflow}{for} (it = currJunction-\/>m\_nodes.begin(); it != currJunction-\/>m\_nodes.end();}
\DoxyCodeLine{01698          it++) \{}
\DoxyCodeLine{01699       \mbox{\hyperlink{class_node}{Node}} *currNode = *it;}
\DoxyCodeLine{01700       \mbox{\hyperlink{class_node}{Node}} *prevNode = *it;}
\DoxyCodeLine{01701       \mbox{\hyperlink{class_node}{Node}} *nextNode = *it;}
\DoxyCodeLine{01702       std::vector<JunctionLink>::iterator it\_link;}
\DoxyCodeLine{01703       \textcolor{keywordtype}{int} j;}
\DoxyCodeLine{01704       \textcolor{keywordflow}{for} (j = 0; \textcolor{keyword}{true}; ++j) \{}
\DoxyCodeLine{01705         prevNode            = prevNode-\/>m\_prev;}
\DoxyCodeLine{01706         prevNode-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01707         \textcolor{keywordflow}{if} (prevNode-\/>m\_junction != 0 \&\& prevNode-\/>m\_junction != currJunction) \{}
\DoxyCodeLine{01708           \textcolor{comment}{// double junctionMaxDist = 3.5*currJunction-\/>m\_center.thick;}}
\DoxyCodeLine{01709           it\_link = std::find(m\_links.begin(), m\_links.end(),}
\DoxyCodeLine{01710                               \mbox{\hyperlink{class_junction_link}{JunctionLink}}(currJunction, prevNode-\/>m\_junction));}
\DoxyCodeLine{01711           \textcolor{comment}{/*                    if( j >= 1*SEARCH\_WINDOW \&\&}}
\DoxyCodeLine{01712 \textcolor{comment}{                        norm(currJunction-\/>m\_center -\/ prevNode-\/>m\_junction-\/>m\_center) >= }}
\DoxyCodeLine{01713 \textcolor{comment}{junctionMaxDist)}}
\DoxyCodeLine{01714 \textcolor{comment}{                    \{}}
\DoxyCodeLine{01715 \textcolor{comment}{                        assert(false);}}
\DoxyCodeLine{01716 \textcolor{comment}{                        if(it\_link == m\_links.end())}}
\DoxyCodeLine{01717 \textcolor{comment}{                            m\_links.push\_back(JunctionLink(currJunction, prevNode-\/>m\_junction));}}
\DoxyCodeLine{01718 \textcolor{comment}{                        else}}
\DoxyCodeLine{01719 \textcolor{comment}{                            ++(it\_link-\/>m\_order);}}
\DoxyCodeLine{01720 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01721 \textcolor{comment}{                    else*/} \textcolor{keywordflow}{if} (it\_link == m\_links.end() \&\&}
\DoxyCodeLine{01722                                                    std::find(}
\DoxyCodeLine{01723                                                        joinJunctions.begin(),}
\DoxyCodeLine{01724                                                        joinJunctions.end(),}
\DoxyCodeLine{01725                                                        \mbox{\hyperlink{class_junction_merge}{JunctionMerge}}(}
\DoxyCodeLine{01726                                                            prevNode}
\DoxyCodeLine{01727                                                                -\/>m\_junction)) ==}
\DoxyCodeLine{01728                                                        joinJunctions.end()) \{}
\DoxyCodeLine{01729             joinJunctions.push\_back(}
\DoxyCodeLine{01730                 \mbox{\hyperlink{class_junction_merge}{JunctionMerge}}(prevNode-\/>m\_junction, currNode, prevNode, \textcolor{keyword}{false}));}
\DoxyCodeLine{01731           \}}
\DoxyCodeLine{01732         \}}
\DoxyCodeLine{01733         \textcolor{keywordflow}{if} (prevNode-\/>m\_visited) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01734       \}}
\DoxyCodeLine{01735       \textcolor{keywordflow}{for} (j = 0; \textcolor{keyword}{true}; ++j) \{}
\DoxyCodeLine{01736         nextNode            = nextNode-\/>m\_next;}
\DoxyCodeLine{01737         prevNode-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01738         \textcolor{keywordflow}{if} (nextNode-\/>m\_junction != 0 \&\& nextNode-\/>m\_junction != currJunction) \{}
\DoxyCodeLine{01739           \textcolor{comment}{// double junctionMaxDist = 3.5*currJunction-\/>m\_center.thick;}}
\DoxyCodeLine{01740           it\_link = std::find(m\_links.begin(), m\_links.end(),}
\DoxyCodeLine{01741                               \mbox{\hyperlink{class_junction_link}{JunctionLink}}(currJunction, nextNode-\/>m\_junction));}
\DoxyCodeLine{01742           \textcolor{comment}{/*                    if( j >= 1*SEARCH\_WINDOW \&\&}}
\DoxyCodeLine{01743 \textcolor{comment}{                        norm(currJunction-\/>m\_center -\/ nextNode-\/>m\_junction-\/>m\_center) >= }}
\DoxyCodeLine{01744 \textcolor{comment}{junctionMaxDist )}}
\DoxyCodeLine{01745 \textcolor{comment}{                    \{}}
\DoxyCodeLine{01746 \textcolor{comment}{                        assert(false);}}
\DoxyCodeLine{01747 \textcolor{comment}{                        if(it\_link == m\_links.end())}}
\DoxyCodeLine{01748 \textcolor{comment}{                            m\_links.push\_back(JunctionLink(currJunction, nextNode-\/>m\_junction));}}
\DoxyCodeLine{01749 \textcolor{comment}{                        else}}
\DoxyCodeLine{01750 \textcolor{comment}{                            ++(it\_link-\/>m\_order);}}
\DoxyCodeLine{01751 \textcolor{comment}{                    \}}}
\DoxyCodeLine{01752 \textcolor{comment}{                    else*/} \textcolor{keywordflow}{if} (it\_link == m\_links.end() \&\&}
\DoxyCodeLine{01753                                                    std::find(}
\DoxyCodeLine{01754                                                        joinJunctions.begin(),}
\DoxyCodeLine{01755                                                        joinJunctions.end(),}
\DoxyCodeLine{01756                                                        \mbox{\hyperlink{class_junction_merge}{JunctionMerge}}(}
\DoxyCodeLine{01757                                                            nextNode}
\DoxyCodeLine{01758                                                                -\/>m\_junction)) ==}
\DoxyCodeLine{01759                                                        joinJunctions.end()) \{}
\DoxyCodeLine{01760             joinJunctions.push\_back(}
\DoxyCodeLine{01761                 \mbox{\hyperlink{class_junction_merge}{JunctionMerge}}(nextNode-\/>m\_junction, currNode, nextNode, \textcolor{keyword}{true}));}
\DoxyCodeLine{01762           \}}
\DoxyCodeLine{01763         \}}
\DoxyCodeLine{01764         \textcolor{keywordflow}{if} (nextNode-\/>m\_visited) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01765       \}}
\DoxyCodeLine{01766     \}}
\DoxyCodeLine{01767     \textcolor{keywordflow}{if} (joinJunctions.size() > 1) \{}
\DoxyCodeLine{01768       \textcolor{comment}{// erase duplicate junctions}}
\DoxyCodeLine{01769       \textcolor{comment}{//            joinJunctions.sort();}}
\DoxyCodeLine{01770       \textcolor{comment}{//            std::sort(joinJunctions.begin(),}}
\DoxyCodeLine{01771       \textcolor{comment}{// joinJunctions.end());}}
\DoxyCodeLine{01772       \textcolor{comment}{//            std::list<JunctionMerge>::iterator it\_newEnd;}}
\DoxyCodeLine{01773       \textcolor{comment}{//            it\_newEnd = std::unique(joinJunctions.begin(),}}
\DoxyCodeLine{01774       \textcolor{comment}{// joinJunctions.end());}}
\DoxyCodeLine{01775       \textcolor{comment}{//            assert(it\_newEnd == joinJunctions.end());}}
\DoxyCodeLine{01776       \textcolor{comment}{//            joinJunctions.erase(it\_newEnd,}}
\DoxyCodeLine{01777       \textcolor{comment}{// joinJunctions.end());}}
\DoxyCodeLine{01778 }
\DoxyCodeLine{01779       \mbox{\hyperlink{class_junction}{Junction}} *newJunction = mergeJunctions(joinJunctions);}
\DoxyCodeLine{01780       assert(newJunction);}
\DoxyCodeLine{01781       m\_junctions.push\_back(newJunction);}
\DoxyCodeLine{01782     \}}
\DoxyCodeLine{01783     joinJunctions.clear();}
\DoxyCodeLine{01784   \}}
\DoxyCodeLine{01785 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a8b6f195a993b2f2eb728f345730d35f8}\label{class_center_line_vectorizer_a8b6f195a993b2f2eb728f345730d35f8}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!joinProtoStrokes@{joinProtoStrokes}}
\index{joinProtoStrokes@{joinProtoStrokes}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{joinProtoStrokes()}{joinProtoStrokes()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::join\+Proto\+Strokes (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_proto_stroke}{Proto\+Stroke}} $\ast$const}]{dst\+Proto\+Stroke }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01470                                                                              \{}
\DoxyCodeLine{01471   \textcolor{comment}{// std::deque<TThickPoint> \&dstPoints = dstProtoStroke-\/>m\_points;}}
\DoxyCodeLine{01472   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 2; k++) \{}
\DoxyCodeLine{01473     \textcolor{keywordflow}{for} (;;) \{}
\DoxyCodeLine{01474       \mbox{\hyperlink{class_junction}{Junction}} *currJunction;}
\DoxyCodeLine{01475       \textcolor{keywordflow}{if} (k == 0 \&\& !dstProtoStroke-\/>m\_startJunction)}
\DoxyCodeLine{01476         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01477       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (k == 0)}
\DoxyCodeLine{01478         currJunction = dstProtoStroke-\/>m\_startJunction;}
\DoxyCodeLine{01479       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!dstProtoStroke-\/>m\_endJunction)}
\DoxyCodeLine{01480         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01481       \textcolor{keywordflow}{else}}
\DoxyCodeLine{01482         currJunction = dstProtoStroke-\/>m\_endJunction;}
\DoxyCodeLine{01483 }
\DoxyCodeLine{01484       \textcolor{keywordflow}{if} (!linkNextProtoStroke(dstProtoStroke, currJunction, k)) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01485     \}}
\DoxyCodeLine{01486   \}}
\DoxyCodeLine{01487   std::vector<ProtoStroke *>::iterator it;}
\DoxyCodeLine{01488   \textcolor{keywordflow}{if} (dstProtoStroke-\/>m\_startJunction) \{}
\DoxyCodeLine{01489     it = std::find(dstProtoStroke-\/>m\_startJunction-\/>m\_protoStrokes.begin(),}
\DoxyCodeLine{01490                    dstProtoStroke-\/>m\_startJunction-\/>m\_protoStrokes.end(),}
\DoxyCodeLine{01491                    dstProtoStroke);}
\DoxyCodeLine{01492     \textcolor{keywordflow}{if} (it != dstProtoStroke-\/>m\_startJunction-\/>m\_protoStrokes.end())}
\DoxyCodeLine{01493       dstProtoStroke-\/>m\_startJunction-\/>m\_protoStrokes.erase(it);}
\DoxyCodeLine{01494     dstProtoStroke-\/>m\_startJunction = 0;}
\DoxyCodeLine{01495   \}}
\DoxyCodeLine{01496   \textcolor{keywordflow}{if} (dstProtoStroke-\/>m\_endJunction) \{}
\DoxyCodeLine{01497     it = std::find(dstProtoStroke-\/>m\_endJunction-\/>m\_protoStrokes.begin(),}
\DoxyCodeLine{01498                    dstProtoStroke-\/>m\_endJunction-\/>m\_protoStrokes.end(),}
\DoxyCodeLine{01499                    dstProtoStroke);}
\DoxyCodeLine{01500     \textcolor{keywordflow}{if} (it != dstProtoStroke-\/>m\_endJunction-\/>m\_protoStrokes.end())}
\DoxyCodeLine{01501       dstProtoStroke-\/>m\_endJunction-\/>m\_protoStrokes.erase(it);}
\DoxyCodeLine{01502     dstProtoStroke-\/>m\_endJunction = 0;}
\DoxyCodeLine{01503   \}}
\DoxyCodeLine{01504 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a65157f31162e7fc32420d5b4e62e51b2}\label{class_center_line_vectorizer_a65157f31162e7fc32420d5b4e62e51b2}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!link@{link}}
\index{link@{link}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{link()}{link()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::link (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$}]{pix,  }\item[{\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$}]{from,  }\item[{\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$}]{to }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00497                                                    \{}
\DoxyCodeLine{00498   \mbox{\hyperlink{class_node}{Node}} *srcNode = 0, *dstNode = 0, *node = 0;}
\DoxyCodeLine{00499   \mbox{\hyperlink{class_node}{Node}} *tmp;}
\DoxyCodeLine{00500   \textcolor{keywordflow}{for} (tmp = pix-\/>m\_node; tmp; tmp = tmp-\/>m\_other) \{}
\DoxyCodeLine{00501     \textcolor{keywordflow}{if} (tmp-\/>m\_pixel == 0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00502     \textcolor{keywordflow}{if} (tmp-\/>m\_prev \&\& tmp-\/>m\_prev-\/>m\_pixel == srcPix) \{}
\DoxyCodeLine{00503       assert(srcNode == 0);}
\DoxyCodeLine{00504       \textcolor{keywordflow}{if} (node) \{}
\DoxyCodeLine{00505         assert(node-\/>m\_next-\/>m\_pixel == dstPix);}
\DoxyCodeLine{00506         assert(node-\/>m\_prev == 0);}
\DoxyCodeLine{00507         node-\/>m\_prev        = tmp-\/>m\_prev;}
\DoxyCodeLine{00508         tmp-\/>m\_prev-\/>m\_next = node;}
\DoxyCodeLine{00509         tmp-\/>m\_next = tmp-\/>m\_prev = 0;}
\DoxyCodeLine{00510         tmp-\/>m\_pixel              = 0;}
\DoxyCodeLine{00511         \textcolor{keywordflow}{return};}
\DoxyCodeLine{00512       \}}
\DoxyCodeLine{00513       assert(tmp-\/>m\_next == 0);}
\DoxyCodeLine{00514       srcNode = tmp-\/>m\_prev;}
\DoxyCodeLine{00515       node    = tmp;}
\DoxyCodeLine{00516     \}}
\DoxyCodeLine{00517     \textcolor{keywordflow}{if} (tmp-\/>m\_next \&\& tmp-\/>m\_next-\/>m\_pixel == dstPix) \{}
\DoxyCodeLine{00518       assert(dstNode == 0);}
\DoxyCodeLine{00519       \textcolor{keywordflow}{if} (node) \{}
\DoxyCodeLine{00520         assert(node-\/>m\_prev-\/>m\_pixel == srcPix);}
\DoxyCodeLine{00521         assert(node-\/>m\_next == 0);}
\DoxyCodeLine{00522         node-\/>m\_next        = tmp-\/>m\_next;}
\DoxyCodeLine{00523         tmp-\/>m\_next-\/>m\_prev = node;}
\DoxyCodeLine{00524         tmp-\/>m\_next = tmp-\/>m\_prev = 0;}
\DoxyCodeLine{00525         tmp-\/>m\_pixel              = 0;}
\DoxyCodeLine{00526         \textcolor{keywordflow}{return};}
\DoxyCodeLine{00527       \}}
\DoxyCodeLine{00528       assert(tmp-\/>m\_prev == 0);}
\DoxyCodeLine{00529       dstNode = tmp-\/>m\_next;}
\DoxyCodeLine{00530       node    = tmp;}
\DoxyCodeLine{00531     \}}
\DoxyCodeLine{00532   \}}
\DoxyCodeLine{00533   \textcolor{keywordflow}{if} (!node) node       = createNode(pix);}
\DoxyCodeLine{00534   \textcolor{keywordflow}{if} (!srcNode) srcNode = createNode(srcPix);}
\DoxyCodeLine{00535   \textcolor{keywordflow}{if} (!dstNode) dstNode = createNode(dstPix);}
\DoxyCodeLine{00536 }
\DoxyCodeLine{00537   \textcolor{keywordflow}{if} (!node-\/>m\_next) \{}
\DoxyCodeLine{00538     node-\/>m\_next = dstNode;}
\DoxyCodeLine{00539     assert(dstNode-\/>m\_prev == 0);}
\DoxyCodeLine{00540     dstNode-\/>m\_prev = node;}
\DoxyCodeLine{00541   \}}
\DoxyCodeLine{00542   \textcolor{keywordflow}{if} (!node-\/>m\_prev) \{}
\DoxyCodeLine{00543     node-\/>m\_prev = srcNode;}
\DoxyCodeLine{00544     assert(srcNode-\/>m\_next == 0);}
\DoxyCodeLine{00545     srcNode-\/>m\_next = node;}
\DoxyCodeLine{00546   \}}
\DoxyCodeLine{00547 }
\DoxyCodeLine{00548   assert(node-\/>m\_next == dstNode);}
\DoxyCodeLine{00549   assert(node-\/>m\_prev == srcNode);}
\DoxyCodeLine{00550   assert(dstNode-\/>m\_prev == node);}
\DoxyCodeLine{00551   assert(srcNode-\/>m\_next == node);}
\DoxyCodeLine{00552 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a969e440077bf9a0c9809e63b937d6221}\label{class_center_line_vectorizer_a969e440077bf9a0c9809e63b937d6221}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!linkNextProtoStroke@{linkNextProtoStroke}}
\index{linkNextProtoStroke@{linkNextProtoStroke}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{linkNextProtoStroke()}{linkNextProtoStroke()}}
{\footnotesize\ttfamily bool Center\+Line\+Vectorizer\+::link\+Next\+Proto\+Stroke (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_proto_stroke}{Proto\+Stroke}} $\ast$const}]{dst\+Proto\+Stroke,  }\item[{\mbox{\hyperlink{class_junction}{Junction}} $\ast$const}]{curr\+Junction,  }\item[{const int}]{k }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01323                                                                             \{}
\DoxyCodeLine{01324   assert(dstProtoStroke);}
\DoxyCodeLine{01325   assert(currJunction);}
\DoxyCodeLine{01326   \textcolor{comment}{//    if(dstProtoStroke-\/>m\_startJunction == dstProtoStroke-\/>m\_endJunction)}}
\DoxyCodeLine{01327   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01328   \textcolor{keywordflow}{if} (k == 0 \&\& dstProtoStroke-\/>m\_startJunction-\/>m\_locked ||}
\DoxyCodeLine{01329       k == 1 \&\& dstProtoStroke-\/>m\_endJunction-\/>m\_locked)}
\DoxyCodeLine{01330     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01331 }
\DoxyCodeLine{01332   \mbox{\hyperlink{class_proto_stroke}{ProtoStroke}} *srcProtoStroke = 0;}
\DoxyCodeLine{01333   \mbox{\hyperlink{class_junction}{Junction}} *nextJunction      = 0;}
\DoxyCodeLine{01334 }
\DoxyCodeLine{01335   std::vector<ProtoStroke *>::iterator it;}
\DoxyCodeLine{01336   std::vector<ProtoStroke *>::iterator it\_e =}
\DoxyCodeLine{01337       currJunction-\/>m\_protoStrokes.end();}
\DoxyCodeLine{01338   std::vector<ProtoStroke *>::iterator it\_candidate = it\_e;}
\DoxyCodeLine{01339   \textcolor{keywordtype}{double} candidateProbability                       = JOIN\_LIMIT;}
\DoxyCodeLine{01340   \textcolor{keywordtype}{int} candidate\_k;}
\DoxyCodeLine{01341   \textcolor{keywordflow}{for} (it = currJunction-\/>m\_protoStrokes.begin(); it != it\_e; it++) \{}
\DoxyCodeLine{01342     \textcolor{comment}{// erase dstProtoStroke in currJunction}}
\DoxyCodeLine{01343     \textcolor{keywordflow}{if} (*it == dstProtoStroke) \{}
\DoxyCodeLine{01344       it   = currJunction-\/>m\_protoStrokes.erase(it);}
\DoxyCodeLine{01345       it\_e = currJunction-\/>m\_protoStrokes.end();}
\DoxyCodeLine{01346       \textcolor{keywordflow}{if} (candidateProbability == JOIN\_LIMIT) it\_candidate = it\_e;}
\DoxyCodeLine{01347       \textcolor{keywordflow}{if} (it == it\_e) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01348     \}}
\DoxyCodeLine{01349     \textcolor{keywordtype}{double} probability;}
\DoxyCodeLine{01350     \textcolor{keywordtype}{int} next\_k;}
\DoxyCodeLine{01351     \textcolor{keywordflow}{if} (((*it))-\/>m\_startJunction == currJunction)}
\DoxyCodeLine{01352       next\_k = 0;}
\DoxyCodeLine{01353     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((*it)-\/>m\_endJunction == currJunction)}
\DoxyCodeLine{01354       next\_k = 1;}
\DoxyCodeLine{01355     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01356       assert(\textcolor{keyword}{false});}
\DoxyCodeLine{01357 }
\DoxyCodeLine{01358     \textcolor{keywordflow}{if} (k == 0) \{}
\DoxyCodeLine{01359       \textcolor{keywordflow}{if} (next\_k == 0)}
\DoxyCodeLine{01360         probability = 1 -\/ norm2(dstProtoStroke-\/>m\_startDirection +}
\DoxyCodeLine{01361                                 (*it)-\/>m\_startDirection);}
\DoxyCodeLine{01362       \textcolor{keywordflow}{else}}
\DoxyCodeLine{01363         probability =}
\DoxyCodeLine{01364             1 -\/ norm2(dstProtoStroke-\/>m\_startDirection + (*it)-\/>m\_endDirection);}
\DoxyCodeLine{01365     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01366       \textcolor{keywordflow}{if} (next\_k == 0)}
\DoxyCodeLine{01367         probability =}
\DoxyCodeLine{01368             1 -\/ norm2(dstProtoStroke-\/>m\_endDirection + (*it)-\/>m\_startDirection);}
\DoxyCodeLine{01369       \textcolor{keywordflow}{else}}
\DoxyCodeLine{01370         probability =}
\DoxyCodeLine{01371             1 -\/ norm2(dstProtoStroke-\/>m\_endDirection + (*it)-\/>m\_endDirection);}
\DoxyCodeLine{01372     \}}
\DoxyCodeLine{01373 }
\DoxyCodeLine{01374     \textcolor{keywordflow}{if} (probability > candidateProbability ||}
\DoxyCodeLine{01375         \textcolor{comment}{//          currJunction-\/>m\_junctionOrder == 2 ||}}
\DoxyCodeLine{01376         (*it)-\/>m\_points.size() < 3) \{}
\DoxyCodeLine{01377       it\_candidate         = it;}
\DoxyCodeLine{01378       candidateProbability = probability;}
\DoxyCodeLine{01379       candidate\_k          = next\_k;}
\DoxyCodeLine{01380     \}}
\DoxyCodeLine{01381   \}}
\DoxyCodeLine{01382 }
\DoxyCodeLine{01383   \textcolor{keywordflow}{if} (it\_candidate == it\_e) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01384   srcProtoStroke = *it\_candidate;}
\DoxyCodeLine{01385   assert(srcProtoStroke);}
\DoxyCodeLine{01386 }
\DoxyCodeLine{01387   \textcolor{keywordflow}{if} ((*it\_candidate)-\/>m\_startJunction == (*it\_candidate)-\/>m\_endJunction)}
\DoxyCodeLine{01388     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01389   \textcolor{comment}{/*    if(k==0)}}
\DoxyCodeLine{01390 \textcolor{comment}{  \{}}
\DoxyCodeLine{01391 \textcolor{comment}{          if(   candidate\_k == 0 \&\& dstProtoStroke-\/>m\_startJunction ==}}
\DoxyCodeLine{01392 \textcolor{comment}{(*it\_candidate)-\/>m\_endJunction ||}}
\DoxyCodeLine{01393 \textcolor{comment}{                  candidate\_k == 1 \&\& dstProtoStroke-\/>m\_startJunction ==}}
\DoxyCodeLine{01394 \textcolor{comment}{(*it\_candidate)-\/>m\_startJunction    )}}
\DoxyCodeLine{01395 \textcolor{comment}{                  return false;}}
\DoxyCodeLine{01396 \textcolor{comment}{  \}}}
\DoxyCodeLine{01397 \textcolor{comment}{  else if(k==1)}}
\DoxyCodeLine{01398 \textcolor{comment}{  \{}}
\DoxyCodeLine{01399 \textcolor{comment}{          if(   candidate\_k == 0 \&\& dstProtoStroke-\/>m\_endJunction ==}}
\DoxyCodeLine{01400 \textcolor{comment}{(*it\_candidate)-\/>m\_endJunction ||}}
\DoxyCodeLine{01401 \textcolor{comment}{                  candidate\_k == 1 \&\& dstProtoStroke-\/>m\_endJunction ==}}
\DoxyCodeLine{01402 \textcolor{comment}{(*it\_candidate)-\/>m\_startJunction    )}}
\DoxyCodeLine{01403 \textcolor{comment}{                  return false;}}
\DoxyCodeLine{01404 \textcolor{comment}{  \}}}
\DoxyCodeLine{01405 \textcolor{comment}{*/}}
\DoxyCodeLine{01406   \textcolor{keywordflow}{if} (candidate\_k == 0)}
\DoxyCodeLine{01407     nextJunction = (*it\_candidate)-\/>m\_endJunction;}
\DoxyCodeLine{01408   \textcolor{keywordflow}{else}}
\DoxyCodeLine{01409     nextJunction = (*it\_candidate)-\/>m\_startJunction;}
\DoxyCodeLine{01410 }
\DoxyCodeLine{01411   \textcolor{keywordflow}{if} (k == 0) \{}
\DoxyCodeLine{01412     \textcolor{keywordflow}{if} (candidate\_k == 0) \{}
\DoxyCodeLine{01413       dstProtoStroke-\/>m\_points.insert(dstProtoStroke-\/>m\_points.begin(),}
\DoxyCodeLine{01414                                       srcProtoStroke-\/>m\_points.rbegin(),}
\DoxyCodeLine{01415                                       srcProtoStroke-\/>m\_points.rend());}
\DoxyCodeLine{01416     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01417       dstProtoStroke-\/>m\_points.insert(dstProtoStroke-\/>m\_points.begin(),}
\DoxyCodeLine{01418                                       srcProtoStroke-\/>m\_points.begin(),}
\DoxyCodeLine{01419                                       srcProtoStroke-\/>m\_points.end());}
\DoxyCodeLine{01420     \}}
\DoxyCodeLine{01421   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01422     \textcolor{keywordflow}{if} (candidate\_k == 0) \{}
\DoxyCodeLine{01423       dstProtoStroke-\/>m\_points.insert(dstProtoStroke-\/>m\_points.end(),}
\DoxyCodeLine{01424                                       srcProtoStroke-\/>m\_points.begin(),}
\DoxyCodeLine{01425                                       srcProtoStroke-\/>m\_points.end());}
\DoxyCodeLine{01426     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01427       dstProtoStroke-\/>m\_points.insert(dstProtoStroke-\/>m\_points.end(),}
\DoxyCodeLine{01428                                       srcProtoStroke-\/>m\_points.rbegin(),}
\DoxyCodeLine{01429                                       srcProtoStroke-\/>m\_points.rend());}
\DoxyCodeLine{01430     \}}
\DoxyCodeLine{01431   \}}
\DoxyCodeLine{01432 }
\DoxyCodeLine{01433   srcProtoStroke-\/>m\_points.clear();}
\DoxyCodeLine{01434   srcProtoStroke-\/>m\_startJunction = 0;}
\DoxyCodeLine{01435   srcProtoStroke-\/>m\_endJunction   = 0;}
\DoxyCodeLine{01436 }
\DoxyCodeLine{01437   \textcolor{comment}{// refresh currJunction}}
\DoxyCodeLine{01438   currJunction-\/>m\_protoStrokes.erase(it\_candidate);}
\DoxyCodeLine{01439 }
\DoxyCodeLine{01440   \textcolor{comment}{// refresh nextJunction}}
\DoxyCodeLine{01441   \textcolor{keywordflow}{if} (nextJunction) \{}
\DoxyCodeLine{01442     it = std::find(nextJunction-\/>m\_protoStrokes.begin(),}
\DoxyCodeLine{01443                    nextJunction-\/>m\_protoStrokes.end(), srcProtoStroke);}
\DoxyCodeLine{01444     assert(it != nextJunction-\/>m\_protoStrokes.end());}
\DoxyCodeLine{01445     nextJunction-\/>m\_protoStrokes.erase(it);}
\DoxyCodeLine{01446     nextJunction-\/>m\_protoStrokes.push\_back(dstProtoStroke);}
\DoxyCodeLine{01447   \}}
\DoxyCodeLine{01448 }
\DoxyCodeLine{01449   \textcolor{keywordflow}{if} (k == 0) \{}
\DoxyCodeLine{01450     dstProtoStroke-\/>m\_startJunction = nextJunction;}
\DoxyCodeLine{01451 }
\DoxyCodeLine{01452     \textcolor{keywordflow}{if} (candidate\_k == 0)}
\DoxyCodeLine{01453       dstProtoStroke-\/>m\_startDirection = srcProtoStroke-\/>m\_endDirection;}
\DoxyCodeLine{01454     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01455       dstProtoStroke-\/>m\_startDirection = srcProtoStroke-\/>m\_startDirection;}
\DoxyCodeLine{01456   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01457     dstProtoStroke-\/>m\_endJunction = nextJunction;}
\DoxyCodeLine{01458 }
\DoxyCodeLine{01459     \textcolor{keywordflow}{if} (candidate\_k == 0)}
\DoxyCodeLine{01460       dstProtoStroke-\/>m\_endDirection = srcProtoStroke-\/>m\_endDirection;}
\DoxyCodeLine{01461     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01462       dstProtoStroke-\/>m\_endDirection = srcProtoStroke-\/>m\_startDirection;}
\DoxyCodeLine{01463   \}}
\DoxyCodeLine{01464   \textcolor{keywordflow}{if} (!nextJunction) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01465   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01466 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_ac876387fb568da716cf6889bbb1bd6fb}\label{class_center_line_vectorizer_ac876387fb568da716cf6889bbb1bd6fb}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!makeDataRaster@{makeDataRaster}}
\index{makeDataRaster@{makeDataRaster}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{makeDataRaster()}{makeDataRaster()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::make\+Data\+Raster (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{src }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00566                                                              \{}
\DoxyCodeLine{00567   m\_vimage = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_vector_image}{TVectorImage}}();}
\DoxyCodeLine{00568   \textcolor{keywordflow}{if} (!src) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00569   m\_src = src;}
\DoxyCodeLine{00570 }
\DoxyCodeLine{00571   clearNodes();}
\DoxyCodeLine{00572   clearJunctions();}
\DoxyCodeLine{00573 }
\DoxyCodeLine{00574   \textcolor{keywordtype}{int} ii, x, y = 0;}
\DoxyCodeLine{00575   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} srcRGBM = (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}})m\_src;}
\DoxyCodeLine{00576   \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}} srcCM = (\mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}})m\_src;}
\DoxyCodeLine{00577   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} srcGR  = (\mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}})m\_src;}
\DoxyCodeLine{00578 }
\DoxyCodeLine{00579   \mbox{\hyperlink{class_t_raster_p_t}{DataRasterP}} dataRaster(m\_src-\/>getSize().lx + 2, m\_src-\/>getSize().ly + 2);}
\DoxyCodeLine{00580   \textcolor{keywordtype}{int} ly              = dataRaster-\/>getLy();}
\DoxyCodeLine{00581   \textcolor{keywordtype}{int} lx              = dataRaster-\/>getLx();}
\DoxyCodeLine{00582   \textcolor{keywordtype}{int} wrap            = dataRaster-\/>getWrap();}
\DoxyCodeLine{00583   \mbox{\hyperlink{class_data_pixel}{DataPixel}} *dataPix0 = dataRaster-\/>pixels(0);}
\DoxyCodeLine{00584   \mbox{\hyperlink{class_data_pixel}{DataPixel}} *dataPix1 = dataRaster-\/>pixels(0) + m\_src-\/>getLx() + 1;}
\DoxyCodeLine{00585   \textcolor{keywordflow}{for} (y = 0; y < ly; y++, dataPix0 += wrap, dataPix1 += wrap) \{}
\DoxyCodeLine{00586     dataPix0-\/>m\_pos.x = 0;}
\DoxyCodeLine{00587     dataPix1-\/>m\_pos.x = lx -\/ 1;}
\DoxyCodeLine{00588     dataPix0-\/>m\_pos.y = dataPix1-\/>m\_pos.y = y;}
\DoxyCodeLine{00589     dataPix0-\/>m\_value = dataPix1-\/>m\_value = 0;}
\DoxyCodeLine{00590     dataPix0-\/>m\_ink = dataPix1-\/>m\_ink = \textcolor{keyword}{false};}
\DoxyCodeLine{00591     dataPix0-\/>m\_node = dataPix1-\/>m\_node = 0;}
\DoxyCodeLine{00592   \}}
\DoxyCodeLine{00593   dataPix0 = dataRaster-\/>pixels(0);}
\DoxyCodeLine{00594   dataPix1 = dataRaster-\/>pixels(ly -\/ 1);}
\DoxyCodeLine{00595   \textcolor{keywordflow}{for} (x = 0; x < lx; x++, dataPix0++, dataPix1++) \{}
\DoxyCodeLine{00596     dataPix0-\/>m\_pos.x = dataPix1-\/>m\_pos.x = x;}
\DoxyCodeLine{00597     dataPix0-\/>m\_pos.y                     = 0;}
\DoxyCodeLine{00598     dataPix1-\/>m\_pos.y                     = ly -\/ 1;}
\DoxyCodeLine{00599     dataPix0-\/>m\_value = dataPix1-\/>m\_value = 0;}
\DoxyCodeLine{00600     dataPix0-\/>m\_ink = dataPix1-\/>m\_ink = \textcolor{keyword}{false};}
\DoxyCodeLine{00601     dataPix0-\/>m\_node = dataPix1-\/>m\_node = 0;}
\DoxyCodeLine{00602   \}}
\DoxyCodeLine{00603 }
\DoxyCodeLine{00604   \textcolor{keywordflow}{if} (srcRGBM) \{}
\DoxyCodeLine{00605     assert(m\_palette);}
\DoxyCodeLine{00606     \textcolor{keywordtype}{int} inkId = m\_palette-\/>\mbox{\hyperlink{class_t_palette_a43a27667c3b3583b2b3e1a9f307e7b42}{addStyle}}(m\_configuration.m\_inkColor);}
\DoxyCodeLine{00607 }
\DoxyCodeLine{00608     m\_dataRasterArray.push\_back(pair<int, DataRasterP>(inkId, dataRaster));}
\DoxyCodeLine{00609     \textcolor{keywordtype}{int} maxDistance2 =}
\DoxyCodeLine{00610         m\_configuration.\mbox{\hyperlink{class_vectorizer_configuration_a6c193af0fd43ebee088cb2adf28181ca}{m\_threshold}} * m\_configuration.\mbox{\hyperlink{class_vectorizer_configuration_a6c193af0fd43ebee088cb2adf28181ca}{m\_threshold}};}
\DoxyCodeLine{00611 }
\DoxyCodeLine{00612     \textcolor{keywordflow}{for} (y = 0; y < m\_src-\/>getLy(); y++) \{}
\DoxyCodeLine{00613       TPixel32 *inPix    = srcRGBM-\/>pixels(y);}
\DoxyCodeLine{00614       TPixel32 *inEndPix = inPix + srcRGBM-\/>getLx();}
\DoxyCodeLine{00615       \mbox{\hyperlink{class_data_pixel}{DataPixel}} *dataPix = dataRaster-\/>pixels(y + 1) + 1;}
\DoxyCodeLine{00616       x                  = 0;}
\DoxyCodeLine{00617       \textcolor{keywordflow}{while} (inPix < inEndPix) \{}
\DoxyCodeLine{00618         *dataPix      = \mbox{\hyperlink{class_data_pixel}{DataPixel}}();}
\DoxyCodeLine{00619         \textcolor{keywordtype}{int} distance2 = colorDistance2(m\_configuration.m\_inkColor, *inPix);}
\DoxyCodeLine{00620 }
\DoxyCodeLine{00621         \textcolor{comment}{// int value = (inPix-\/>r + 2*inPix-\/>g + inPix-\/>b)>>2;}}
\DoxyCodeLine{00622         \textcolor{keywordflow}{if} (y == 0 || y == m\_src-\/>getLy() -\/ 1 || x == 0 ||}
\DoxyCodeLine{00623             x == m\_src-\/>getLx() -\/ 1) \{}
\DoxyCodeLine{00624           dataPix-\/>m\_value = 255;}
\DoxyCodeLine{00625           dataPix-\/>m\_ink   = \textcolor{keyword}{false};}
\DoxyCodeLine{00626         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00627           dataPix-\/>m\_value = (inPix-\/>r + 2 * inPix-\/>g + inPix-\/>b) >> 2;}
\DoxyCodeLine{00628           dataPix-\/>m\_ink   = (distance2 < maxDistance2);}
\DoxyCodeLine{00629         \}}
\DoxyCodeLine{00630         dataPix-\/>m\_pos.x = x++;}
\DoxyCodeLine{00631         dataPix-\/>m\_pos.y = y;}
\DoxyCodeLine{00632         dataPix-\/>m\_node  = 0;}
\DoxyCodeLine{00633         \textcolor{comment}{// dataPix-\/>m\_index = index++;}}
\DoxyCodeLine{00634         inPix++;}
\DoxyCodeLine{00635         dataPix++;}
\DoxyCodeLine{00636       \}}
\DoxyCodeLine{00637     \}}
\DoxyCodeLine{00638   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (srcGR) \{}
\DoxyCodeLine{00639     assert(m\_palette);}
\DoxyCodeLine{00640     \textcolor{keywordtype}{int} inkId = m\_palette-\/>\mbox{\hyperlink{class_t_palette_a43a27667c3b3583b2b3e1a9f307e7b42}{addStyle}}(m\_configuration.m\_inkColor);}
\DoxyCodeLine{00641 }
\DoxyCodeLine{00642     m\_dataRasterArray.push\_back(pair<int, DataRasterP>(inkId, dataRaster));}
\DoxyCodeLine{00643     \textcolor{keywordtype}{int} threshold = m\_configuration.\mbox{\hyperlink{class_vectorizer_configuration_a6c193af0fd43ebee088cb2adf28181ca}{m\_threshold}};}
\DoxyCodeLine{00644 }
\DoxyCodeLine{00645     \textcolor{keywordflow}{for} (y = 0; y < m\_src-\/>getLy(); y++) \{}
\DoxyCodeLine{00646       \mbox{\hyperlink{class_t_pixel_g_r8}{TPixelGR8}} *inPix    = srcGR-\/>pixels(y);}
\DoxyCodeLine{00647       \mbox{\hyperlink{class_t_pixel_g_r8}{TPixelGR8}} *inEndPix = inPix + srcGR-\/>getLx();}
\DoxyCodeLine{00648       \mbox{\hyperlink{class_data_pixel}{DataPixel}} *dataPix  = dataRaster-\/>pixels(y + 1) + 1;}
\DoxyCodeLine{00649       x                   = 0;}
\DoxyCodeLine{00650       \textcolor{keywordflow}{while} (inPix < inEndPix) \{}
\DoxyCodeLine{00651         *dataPix = \mbox{\hyperlink{class_data_pixel}{DataPixel}}();}
\DoxyCodeLine{00652         \textcolor{comment}{// int distance2 = colorDistance2(m\_configuration.m\_inkColor, *inPix);}}
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654         \textcolor{comment}{// int value = (inPix-\/>r + 2*inPix-\/>g + inPix-\/>b)>>2;}}
\DoxyCodeLine{00655         \textcolor{keywordflow}{if} (y == 0 || y == m\_src-\/>getLy() -\/ 1 || x == 0 ||}
\DoxyCodeLine{00656             x == m\_src-\/>getLx() -\/ 1) \{}
\DoxyCodeLine{00657           dataPix-\/>m\_value = 255;}
\DoxyCodeLine{00658           dataPix-\/>m\_ink   = \textcolor{keyword}{false};}
\DoxyCodeLine{00659         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00660           dataPix-\/>m\_value = inPix-\/>value;}
\DoxyCodeLine{00661           dataPix-\/>m\_ink   = (inPix-\/>value < threshold);}
\DoxyCodeLine{00662         \}}
\DoxyCodeLine{00663         dataPix-\/>m\_pos.x = x++;}
\DoxyCodeLine{00664         dataPix-\/>m\_pos.y = y;}
\DoxyCodeLine{00665         dataPix-\/>m\_node  = 0;}
\DoxyCodeLine{00666         \textcolor{comment}{// dataPix-\/>m\_index = index++;}}
\DoxyCodeLine{00667         inPix++;}
\DoxyCodeLine{00668         dataPix++;}
\DoxyCodeLine{00669       \}}
\DoxyCodeLine{00670     \}}
\DoxyCodeLine{00671   \}}
\DoxyCodeLine{00672 }
\DoxyCodeLine{00673   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (srcCM) \{}
\DoxyCodeLine{00674     \textcolor{keywordtype}{int} currInk, nextInk = 0;}
\DoxyCodeLine{00675     \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{00676       \textcolor{keywordtype}{int} threshold =}
\DoxyCodeLine{00677           m\_configuration.\mbox{\hyperlink{class_vectorizer_configuration_a6c193af0fd43ebee088cb2adf28181ca}{m\_threshold}};  \textcolor{comment}{// tolerance: 1-\/>MAX thresh: 1-\/255}}
\DoxyCodeLine{00678       currInk = nextInk;}
\DoxyCodeLine{00679       nextInk = 0;}
\DoxyCodeLine{00680       m\_dataRasterArray.push\_back(pair<int, DataRasterP>(currInk, dataRaster));}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682       \textcolor{comment}{// inizializza la parte centrale}}
\DoxyCodeLine{00683       \textcolor{keywordflow}{for} (y = 0; y < srcCM-\/>getLy(); y++) \{}
\DoxyCodeLine{00684         \mbox{\hyperlink{class_t_pixel_c_m32}{TPixelCM32}} *inPix    = srcCM-\/>pixels(y);}
\DoxyCodeLine{00685         \mbox{\hyperlink{class_t_pixel_c_m32}{TPixelCM32}} *inEndPix = inPix + m\_src-\/>getLx();}
\DoxyCodeLine{00686         \mbox{\hyperlink{class_data_pixel}{DataPixel}} *dataPix   = dataRaster-\/>pixels(y + 1) + 1;}
\DoxyCodeLine{00687         x                    = 0;}
\DoxyCodeLine{00688         \textcolor{keywordflow}{while} (inPix < inEndPix) \{}
\DoxyCodeLine{00689           *dataPix  = \mbox{\hyperlink{class_data_pixel}{DataPixel}}();}
\DoxyCodeLine{00690           \textcolor{keywordtype}{int} value = inPix-\/>getTone();}
\DoxyCodeLine{00691           \textcolor{keywordflow}{if} (value < 255 \&\& !m\_configuration.m\_ignoreInkColors) \{}
\DoxyCodeLine{00692             \textcolor{keywordtype}{int} ink = inPix-\/>getInk();}
\DoxyCodeLine{00693             \textcolor{keywordflow}{if} (currInk == 0) \{}
\DoxyCodeLine{00694               currInk                        = ink;}
\DoxyCodeLine{00695               m\_dataRasterArray.back().first = ink;}
\DoxyCodeLine{00696             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ink != currInk) \{}
\DoxyCodeLine{00697               value = 255;}
\DoxyCodeLine{00698               \textcolor{keywordflow}{if} (nextInk == 0) \{}
\DoxyCodeLine{00699                 \textcolor{keywordflow}{for} (ii = 0; ii < (int)m\_dataRasterArray.size() -\/ 1; ii++)}
\DoxyCodeLine{00700                   \textcolor{keywordflow}{if} (m\_dataRasterArray[ii].first == ink) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00701                 \textcolor{keywordflow}{if} (ii == (\textcolor{keywordtype}{int})m\_dataRasterArray.size() -\/ 1) nextInk = ink;}
\DoxyCodeLine{00702               \}}
\DoxyCodeLine{00703             \}}
\DoxyCodeLine{00704           \}}
\DoxyCodeLine{00705           \textcolor{comment}{// TPixel col = m\_palette-\/>getStyle(inPix-\/>getInk())-\/>getMainColor();}}
\DoxyCodeLine{00706           dataPix-\/>m\_pos.x = x++;}
\DoxyCodeLine{00707           dataPix-\/>m\_pos.y = y;}
\DoxyCodeLine{00708           dataPix-\/>m\_value = value;}
\DoxyCodeLine{00709           dataPix-\/>m\_ink   = (value < threshold);}
\DoxyCodeLine{00710           dataPix-\/>m\_node  = 0;}
\DoxyCodeLine{00711           \textcolor{comment}{// dataPix-\/>m\_index = index++;}}
\DoxyCodeLine{00712           inPix++;}
\DoxyCodeLine{00713           dataPix++;}
\DoxyCodeLine{00714         \}}
\DoxyCodeLine{00715       \}}
\DoxyCodeLine{00716     \} \textcolor{keywordflow}{while} (nextInk != 0);}
\DoxyCodeLine{00717     \textcolor{keywordflow}{if} (m\_configuration.m\_ignoreInkColors) \{}
\DoxyCodeLine{00718       assert(m\_dataRasterArray.size() == 1);}
\DoxyCodeLine{00719       m\_dataRasterArray.back().first = 1;}
\DoxyCodeLine{00720     \}}
\DoxyCodeLine{00721   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00722     assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00723 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_aff37418e696de2fa49085d53c8f664e7}\label{class_center_line_vectorizer_aff37418e696de2fa49085d53c8f664e7}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!mergeJunctions@{mergeJunctions}}
\index{mergeJunctions@{mergeJunctions}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{mergeJunctions()}{mergeJunctions()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_junction}{Junction}} $\ast$ Center\+Line\+Vectorizer\+::merge\+Junctions (\begin{DoxyParamCaption}\item[{const std\+::list$<$ \mbox{\hyperlink{class_junction_merge}{Junction\+Merge}} $>$ \&}]{junctions }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01543                                              \{}
\DoxyCodeLine{01544   \mbox{\hyperlink{class_junction}{Junction}} *newJunction = \textcolor{keyword}{new} \mbox{\hyperlink{class_junction}{Junction}}();}
\DoxyCodeLine{01545 }
\DoxyCodeLine{01546   std::list<JunctionMerge>::const\_iterator it\_junction;}
\DoxyCodeLine{01547   std::deque<Node *>::iterator it\_startNode, it\_endNode;}
\DoxyCodeLine{01548 }
\DoxyCodeLine{01549   \textcolor{keywordflow}{for} (it\_junction = junctions.begin(); it\_junction != junctions.end();}
\DoxyCodeLine{01550        ++it\_junction) \{}
\DoxyCodeLine{01551     newJunction-\/>m\_center += it\_junction-\/>m\_junction-\/>m\_center;}
\DoxyCodeLine{01552 }
\DoxyCodeLine{01553     std::deque<Node *>::iterator it\_node;}
\DoxyCodeLine{01554     \textcolor{keywordflow}{if} (it\_junction-\/>m\_startNode == 0 \&\& it\_junction-\/>m\_endNode == 0) \{}
\DoxyCodeLine{01555       \textcolor{keywordflow}{for} (it\_node = it\_junction-\/>m\_junction-\/>m\_nodes.begin();}
\DoxyCodeLine{01556            it\_node != it\_junction-\/>m\_junction-\/>m\_nodes.end(); ++it\_node) \{}
\DoxyCodeLine{01557         (*it\_node)-\/>m\_junction = newJunction;}
\DoxyCodeLine{01558         newJunction-\/>m\_nodes.push\_back(*it\_node);}
\DoxyCodeLine{01559       \}}
\DoxyCodeLine{01560     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01561       \textcolor{comment}{//            if(}}
\DoxyCodeLine{01562       \textcolor{comment}{// isContained(it\_junction-\/>m\_junction-\/>m\_center, newJunction-\/>m\_nodes) )}}
\DoxyCodeLine{01563       \textcolor{comment}{// continue;}}
\DoxyCodeLine{01564       \textcolor{comment}{/*            if(}}
\DoxyCodeLine{01565 \textcolor{comment}{      it\_junction-\/>m\_junction-\/>m\_nodes.size() < 3)}}
\DoxyCodeLine{01566 \textcolor{comment}{      \{}}
\DoxyCodeLine{01567 \textcolor{comment}{              std::vector<ProtoStroke*>::iterator it\_protoStroke;}}
\DoxyCodeLine{01568 \textcolor{comment}{              bool ignoreJunction = false;}}
\DoxyCodeLine{01569 \textcolor{comment}{              for(it\_protoStroke =}}
\DoxyCodeLine{01570 \textcolor{comment}{      it\_junction-\/>m\_junction-\/>m\_protoStrokes.begin();}}
\DoxyCodeLine{01571 \textcolor{comment}{                      it\_protoStroke!=it\_junction-\/>m\_junction-\/>m\_protoStrokes.end();}}
\DoxyCodeLine{01572 \textcolor{comment}{                      ++it\_protoStroke)}}
\DoxyCodeLine{01573 \textcolor{comment}{              \{}}
\DoxyCodeLine{01574 \textcolor{comment}{                      if(   (*it\_protoStroke)-\/>m\_startJunction ==}}
\DoxyCodeLine{01575 \textcolor{comment}{      newJunction}}
\DoxyCodeLine{01576 \textcolor{comment}{      ||}}
\DoxyCodeLine{01577 \textcolor{comment}{                              (*it\_protoStroke)-\/>m\_endJunction == newJunction )}}
\DoxyCodeLine{01578 \textcolor{comment}{                      \{}}
\DoxyCodeLine{01579 \textcolor{comment}{                              ignoreJunction = true;}}
\DoxyCodeLine{01580 \textcolor{comment}{                              break;}}
\DoxyCodeLine{01581 \textcolor{comment}{                      \}}}
\DoxyCodeLine{01582 \textcolor{comment}{              \}}}
\DoxyCodeLine{01583 \textcolor{comment}{              if(ignoreJunction) continue;}}
\DoxyCodeLine{01584 \textcolor{comment}{      \}}}
\DoxyCodeLine{01585 \textcolor{comment}{*/}}
\DoxyCodeLine{01586 }
\DoxyCodeLine{01587       it\_startNode =}
\DoxyCodeLine{01588           std::find(newJunction-\/>m\_nodes.begin(), newJunction-\/>m\_nodes.end(),}
\DoxyCodeLine{01589                     it\_junction-\/>m\_startNode);}
\DoxyCodeLine{01590       assert(it\_startNode != newJunction-\/>m\_nodes.end());}
\DoxyCodeLine{01591       it\_endNode = std::find(it\_junction-\/>m\_junction-\/>m\_nodes.begin(),}
\DoxyCodeLine{01592                              it\_junction-\/>m\_junction-\/>m\_nodes.end(),}
\DoxyCodeLine{01593                              it\_junction-\/>m\_endNode);}
\DoxyCodeLine{01594       assert(it\_endNode != it\_junction-\/>m\_junction-\/>m\_nodes.end());}
\DoxyCodeLine{01595 }
\DoxyCodeLine{01596       \textcolor{keywordflow}{for} (it\_node = it\_junction-\/>m\_junction-\/>m\_nodes.begin();}
\DoxyCodeLine{01597            it\_node != it\_junction-\/>m\_junction-\/>m\_nodes.end(); ++it\_node) \{}
\DoxyCodeLine{01598         (*it\_node)-\/>m\_junction = newJunction;}
\DoxyCodeLine{01599       \}}
\DoxyCodeLine{01600 }
\DoxyCodeLine{01601       \textcolor{keywordflow}{if} (it\_junction-\/>m\_isNext) \{}
\DoxyCodeLine{01602         ++it\_startNode;}
\DoxyCodeLine{01603         newJunction-\/>m\_nodes.insert(}
\DoxyCodeLine{01604             it\_startNode, it\_junction-\/>m\_junction-\/>m\_nodes.begin(), it\_endNode);}
\DoxyCodeLine{01605         it\_startNode =}
\DoxyCodeLine{01606             std::find(newJunction-\/>m\_nodes.begin(), newJunction-\/>m\_nodes.end(),}
\DoxyCodeLine{01607                       it\_junction-\/>m\_startNode);}
\DoxyCodeLine{01608         assert(it\_startNode != newJunction-\/>m\_nodes.end());}
\DoxyCodeLine{01609         ++it\_startNode;}
\DoxyCodeLine{01610         newJunction-\/>m\_nodes.insert(it\_startNode, it\_endNode,}
\DoxyCodeLine{01611                                     it\_junction-\/>m\_junction-\/>m\_nodes.end());}
\DoxyCodeLine{01612       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01613         ++it\_endNode;}
\DoxyCodeLine{01614         newJunction-\/>m\_nodes.insert(}
\DoxyCodeLine{01615             it\_startNode, it\_junction-\/>m\_junction-\/>m\_nodes.begin(), it\_endNode);}
\DoxyCodeLine{01616         it\_startNode =}
\DoxyCodeLine{01617             std::find(newJunction-\/>m\_nodes.begin(), newJunction-\/>m\_nodes.end(),}
\DoxyCodeLine{01618                       it\_junction-\/>m\_startNode);}
\DoxyCodeLine{01619         assert(it\_startNode != newJunction-\/>m\_nodes.end());}
\DoxyCodeLine{01620         newJunction-\/>m\_nodes.insert(it\_startNode, it\_endNode,}
\DoxyCodeLine{01621                                     it\_junction-\/>m\_junction-\/>m\_nodes.end());}
\DoxyCodeLine{01622       \}}
\DoxyCodeLine{01623     \}}
\DoxyCodeLine{01624 }
\DoxyCodeLine{01625     std::vector<ProtoStroke *>::iterator it\_protoStroke;}
\DoxyCodeLine{01626     \textcolor{keywordflow}{for} (it\_protoStroke = it\_junction-\/>m\_junction-\/>m\_protoStrokes.begin();}
\DoxyCodeLine{01627          it\_protoStroke != it\_junction-\/>m\_junction-\/>m\_protoStrokes.end();}
\DoxyCodeLine{01628          ++it\_protoStroke) \{}
\DoxyCodeLine{01629       \textcolor{keywordflow}{if} ((*it\_protoStroke)-\/>m\_startJunction == it\_junction-\/>m\_junction) \{}
\DoxyCodeLine{01630         (*it\_protoStroke)-\/>m\_startJunction = newJunction;}
\DoxyCodeLine{01631         newJunction-\/>m\_protoStrokes.push\_back(*it\_protoStroke);}
\DoxyCodeLine{01632       \}}
\DoxyCodeLine{01633       \textcolor{keywordflow}{if} ((*it\_protoStroke)-\/>m\_endJunction == it\_junction-\/>m\_junction) \{}
\DoxyCodeLine{01634         (*it\_protoStroke)-\/>m\_endJunction = newJunction;}
\DoxyCodeLine{01635         newJunction-\/>m\_protoStrokes.push\_back(*it\_protoStroke);}
\DoxyCodeLine{01636       \}}
\DoxyCodeLine{01637     \}}
\DoxyCodeLine{01638 }
\DoxyCodeLine{01639     std::vector<JunctionLink>::iterator it\_links;}
\DoxyCodeLine{01640     \textcolor{keywordflow}{for} (it\_links = m\_links.begin(); it\_links != m\_links.end(); ++it\_links) \{}
\DoxyCodeLine{01641       \textcolor{keywordflow}{if} (it\_links-\/>m\_first == it\_junction-\/>m\_junction)}
\DoxyCodeLine{01642         it\_links-\/>m\_first = newJunction;}
\DoxyCodeLine{01643       \textcolor{keywordflow}{if} (it\_links-\/>m\_second == it\_junction-\/>m\_junction)}
\DoxyCodeLine{01644         it\_links-\/>m\_second = newJunction;}
\DoxyCodeLine{01645     \}}
\DoxyCodeLine{01646 }
\DoxyCodeLine{01647     \textcolor{comment}{// erase old junction}}
\DoxyCodeLine{01648     std::vector<Junction *>::iterator it;}
\DoxyCodeLine{01649     it = std::find(m\_junctions.begin(), m\_junctions.end(),}
\DoxyCodeLine{01650                    it\_junction-\/>m\_junction);}
\DoxyCodeLine{01651     assert(it != m\_junctions.end());}
\DoxyCodeLine{01652     \textcolor{keyword}{delete} it\_junction-\/>m\_junction;}
\DoxyCodeLine{01653     m\_junctions.erase(it);}
\DoxyCodeLine{01654   \}}
\DoxyCodeLine{01655   \textcolor{keywordtype}{double} size           = junctions.size();}
\DoxyCodeLine{01656   newJunction-\/>m\_center = newJunction-\/>m\_center * (1 / size);}
\DoxyCodeLine{01657 }
\DoxyCodeLine{01658   std::vector<ProtoStroke *>::iterator it\_protoStroke;}
\DoxyCodeLine{01659   \textcolor{keywordflow}{for} (it\_protoStroke = newJunction-\/>m\_protoStrokes.begin();}
\DoxyCodeLine{01660        it\_protoStroke != newJunction-\/>m\_protoStrokes.end(); ++it\_protoStroke) \{}
\DoxyCodeLine{01661     \textcolor{keywordflow}{if} ((*it\_protoStroke)-\/>m\_points.size() < 6 \&\&}
\DoxyCodeLine{01662         (*it\_protoStroke)-\/>m\_startJunction == newJunction \&\&}
\DoxyCodeLine{01663         (*it\_protoStroke)-\/>m\_endJunction == newJunction) \{}
\DoxyCodeLine{01664       (*it\_protoStroke)-\/>m\_points.clear();}
\DoxyCodeLine{01665       (*it\_protoStroke)-\/>m\_startJunction = (*it\_protoStroke)-\/>m\_endJunction = 0;}
\DoxyCodeLine{01666 }
\DoxyCodeLine{01667       \mbox{\hyperlink{class_proto_stroke}{ProtoStroke}} *protoStroke = *it\_protoStroke;}
\DoxyCodeLine{01668       \textcolor{keywordflow}{for} (;;) \{}
\DoxyCodeLine{01669         std::vector<ProtoStroke *>::iterator it;}
\DoxyCodeLine{01670         it = std::find(newJunction-\/>m\_protoStrokes.begin(),}
\DoxyCodeLine{01671                        newJunction-\/>m\_protoStrokes.end(), protoStroke);}
\DoxyCodeLine{01672         \textcolor{keywordflow}{if} (it == newJunction-\/>m\_protoStrokes.end()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01673         newJunction-\/>m\_protoStrokes.erase(it);}
\DoxyCodeLine{01674       \}}
\DoxyCodeLine{01675       \textcolor{keywordflow}{if} (newJunction-\/>m\_protoStrokes.empty()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01676       it\_protoStroke = newJunction-\/>m\_protoStrokes.begin();}
\DoxyCodeLine{01677     \}}
\DoxyCodeLine{01678   \}}
\DoxyCodeLine{01679 }
\DoxyCodeLine{01680   \textcolor{keywordflow}{return} newJunction;}
\DoxyCodeLine{01681 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_a84d22990d2965b24dd7acaf144a5198a}\label{class_center_line_vectorizer_a84d22990d2965b24dd7acaf144a5198a}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!testOtherSide@{testOtherSide}}
\index{testOtherSide@{testOtherSide}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{testOtherSide()}{testOtherSide()}}
{\footnotesize\ttfamily bool Center\+Line\+Vectorizer\+::test\+Other\+Side (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_node}{Node}} $\ast$}]{na1,  }\item[{\mbox{\hyperlink{class_node}{Node}} $\ast$}]{nb1,  }\item[{double \&}]{start\+Dist2 }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01003                                                              \{}
\DoxyCodeLine{01004   \textcolor{keywordflow}{if} (na1-\/>m\_pixel-\/>m\_pos == nb1-\/>m\_pixel-\/>m\_pos || na1-\/>m\_next == nb1 ||}
\DoxyCodeLine{01005       na1-\/>m\_prev == nb1 || na1-\/>m\_next-\/>m\_next == nb1 ||}
\DoxyCodeLine{01006       na1-\/>m\_prev-\/>m\_prev == nb1)}
\DoxyCodeLine{01007     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01008 }
\DoxyCodeLine{01009   \mbox{\hyperlink{class_node}{Node}} *na2 = na1-\/>m\_next;}
\DoxyCodeLine{01010   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < 3; ++i) \{}
\DoxyCodeLine{01011     na2       = na2-\/>m\_next;}
\DoxyCodeLine{01012     \mbox{\hyperlink{class_node}{Node}} *nb2 = findOtherSide(na2);}
\DoxyCodeLine{01013     \textcolor{keywordflow}{if} (nb2 == 0 \&\& i == 3) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01014     \textcolor{keywordflow}{if} (nb2 == 0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01015 }
\DoxyCodeLine{01016     \textcolor{keywordtype}{double} newStartDist2                       = computeDistance2(na2, nb2);}
\DoxyCodeLine{01017     \textcolor{keywordflow}{if} (newStartDist2 > startDist2) startDist2 = newStartDist2;}
\DoxyCodeLine{01018     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < 3 * i + 1; ++j) \{}
\DoxyCodeLine{01019       \textcolor{keywordflow}{if} (nb2 == nb1) \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01020       nb2 = nb2-\/>m\_next;}
\DoxyCodeLine{01021     \}}
\DoxyCodeLine{01022   \}}
\DoxyCodeLine{01023   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01024 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_aa8028bc5ca943c715d0e2e83b8c5f93b}\label{class_center_line_vectorizer_aa8028bc5ca943c715d0e2e83b8c5f93b}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!traceLine@{traceLine}}
\index{traceLine@{traceLine}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{traceLine()}{traceLine()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::trace\+Line (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_data_pixel}{Data\+Pixel}} $\ast$}]{pix }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01092                                                    \{}
\DoxyCodeLine{01093   \mbox{\hyperlink{class_junction}{Junction}} *startJunction = 0;}
\DoxyCodeLine{01094   \mbox{\hyperlink{class_junction}{Junction}} *endJunction   = 0;}
\DoxyCodeLine{01095   assert(m\_dataRaster);}
\DoxyCodeLine{01096   \textcolor{keyword}{const} \textcolor{keywordtype}{int} wrap = m\_dataRaster-\/>getWrap();}
\DoxyCodeLine{01097   \textcolor{comment}{//  TRect bounds = m\_dataRaster-\/>getBounds();}}
\DoxyCodeLine{01098   \textcolor{keywordflow}{if} (!pix-\/>m\_ink) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01099   \textcolor{keywordflow}{while} (pix-\/>m\_node == 0) pix -\/= wrap;}
\DoxyCodeLine{01100 }
\DoxyCodeLine{01101   \mbox{\hyperlink{class_node}{Node}} *node                                               = pix-\/>m\_node;}
\DoxyCodeLine{01102   \textcolor{keywordflow}{while} (node \&\& node-\/>m\_pixel == 0 \&\& node-\/>m\_other) node = node-\/>m\_other;}
\DoxyCodeLine{01103   assert(node \&\& node-\/>m\_pixel == pix);}
\DoxyCodeLine{01104 }
\DoxyCodeLine{01105   \mbox{\hyperlink{class_node}{Node}} *naa = node;}
\DoxyCodeLine{01106 }
\DoxyCodeLine{01107   \textcolor{keywordtype}{bool} isSamePixel;}
\DoxyCodeLine{01108   \textcolor{keywordflow}{if} (node-\/>m\_other \&\& node-\/>m\_other-\/>m\_pixel \&\&}
\DoxyCodeLine{01109       (node-\/>m\_pixel-\/>m\_pos == node-\/>m\_other-\/>m\_pixel-\/>m\_pos)) \{}
\DoxyCodeLine{01110     node        = node-\/>m\_other;}
\DoxyCodeLine{01111     isSamePixel = \textcolor{keyword}{true};}
\DoxyCodeLine{01112   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01113     node        = findOtherSide(node);}
\DoxyCodeLine{01114     isSamePixel = \textcolor{keyword}{false};}
\DoxyCodeLine{01115   \}}
\DoxyCodeLine{01116   \textcolor{keywordflow}{if} (node == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01117   \mbox{\hyperlink{class_node}{Node}} *nbb = node;}
\DoxyCodeLine{01118 }
\DoxyCodeLine{01119   \textcolor{keywordflow}{if} (naa-\/>m\_visited || nbb-\/>m\_visited) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01120 }
\DoxyCodeLine{01121   \textcolor{keywordtype}{double} startDist2 = computeDistance2(naa, nbb);}
\DoxyCodeLine{01122   \textcolor{keywordflow}{if} (startDist2 > 2000) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01123   \textcolor{keywordflow}{if} (startDist2 < THICKNESS\_LIMIT\_2) startDist2 = THICKNESS\_LIMIT\_2;}
\DoxyCodeLine{01124 }
\DoxyCodeLine{01125   \textcolor{comment}{// try to detect errors in findOtherSide}}
\DoxyCodeLine{01126   \textcolor{keywordflow}{if} (!isSamePixel \&\& !testOtherSide(naa, nbb, startDist2)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01127 }
\DoxyCodeLine{01128   \textcolor{keywordtype}{double} minDist2 = 0;}
\DoxyCodeLine{01129   \textcolor{keywordtype}{double} maxDist2 = startDist2 + 3.0;}
\DoxyCodeLine{01130   \textcolor{keywordflow}{if} (startDist2 > 36) \{}
\DoxyCodeLine{01131     minDist2 = startDist2 / 2;}
\DoxyCodeLine{01132     maxDist2 = startDist2 + 0.25 * startDist2;}
\DoxyCodeLine{01133   \}}
\DoxyCodeLine{01134   \textcolor{keywordflow}{if} (naa-\/>m\_next == nbb || naa-\/>m\_prev == nbb) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01135 }
\DoxyCodeLine{01136   naa-\/>m\_visited = nbb-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01137   std::deque<TThickPoint> dpoints;}
\DoxyCodeLine{01138 }
\DoxyCodeLine{01139   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < 2; k++) \{}
\DoxyCodeLine{01140     \mbox{\hyperlink{class_node}{Node}} *na = naa;}
\DoxyCodeLine{01141     \mbox{\hyperlink{class_node}{Node}} *nb = nbb;}
\DoxyCodeLine{01142 }
\DoxyCodeLine{01143     \textcolor{keywordflow}{for} (;;) \{}
\DoxyCodeLine{01144       \mbox{\hyperlink{class_t_point_t}{TPoint}} \&pa = na-\/>m\_pixel-\/>m\_pos;}
\DoxyCodeLine{01145       \mbox{\hyperlink{class_t_point_t}{TPoint}} \&pb = nb-\/>m\_pixel-\/>m\_pos;}
\DoxyCodeLine{01146       \mbox{\hyperlink{class_t_point_t}{TPoint}} ba  = pb -\/ pa;}
\DoxyCodeLine{01147 }
\DoxyCodeLine{01148       \mbox{\hyperlink{class_node}{Node}} *na1 = na-\/>m\_next;}
\DoxyCodeLine{01149       \mbox{\hyperlink{class_node}{Node}} *nb1 = nb-\/>m\_prev;}
\DoxyCodeLine{01150       \textcolor{comment}{// if (!na1 || !nb1) break;}}
\DoxyCodeLine{01151 }
\DoxyCodeLine{01152       \mbox{\hyperlink{class_t_point_t}{TPoint}} da = na1-\/>m\_pixel-\/>m\_pos -\/ pb;}
\DoxyCodeLine{01153       \mbox{\hyperlink{class_t_point_t}{TPoint}} db = nb1-\/>m\_pixel-\/>m\_pos -\/ pa;}
\DoxyCodeLine{01154 }
\DoxyCodeLine{01155       \textcolor{keywordflow}{if} (na1-\/>m\_junction || nb1-\/>m\_junction) \{}
\DoxyCodeLine{01156         na1-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01157         nb1-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01158         \mbox{\hyperlink{class_t_point_t}{TPointD}} p1;}
\DoxyCodeLine{01159         \textcolor{keywordflow}{if} (na1-\/>m\_junction \&\& nb1-\/>m\_junction) \{}
\DoxyCodeLine{01160           \textcolor{comment}{//                    assert(na1-\/>m\_junction ==}}
\DoxyCodeLine{01161           \textcolor{comment}{// nb1-\/>m\_junction);}}
\DoxyCodeLine{01162         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01163           \textcolor{keywordflow}{if} (na1-\/>m\_junction) \{}
\DoxyCodeLine{01164             p1              = convert(nb1-\/>m\_pixel-\/>m\_pos);}
\DoxyCodeLine{01165             nb1-\/>m\_junction = na1-\/>m\_junction;}
\DoxyCodeLine{01166             na1-\/>m\_junction-\/>m\_nodes.push\_front(nb1);}
\DoxyCodeLine{01167           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01168             p1              = convert(na1-\/>m\_pixel-\/>m\_pos);}
\DoxyCodeLine{01169             na1-\/>m\_junction = nb1-\/>m\_junction;}
\DoxyCodeLine{01170             nb1-\/>m\_junction-\/>m\_nodes.push\_back(na1);}
\DoxyCodeLine{01171           \}}
\DoxyCodeLine{01172         \}}
\DoxyCodeLine{01173         \textcolor{keywordtype}{double} r;}
\DoxyCodeLine{01174         \mbox{\hyperlink{class_t_point_t}{TPointD}} center;}
\DoxyCodeLine{01175         \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} point;}
\DoxyCodeLine{01176 }
\DoxyCodeLine{01177         center                     = computeCenter(na, nb, r);}
\DoxyCodeLine{01178         \textcolor{keywordflow}{if} (r < THICKNESS\_LIMIT) r = THICKNESS\_LIMIT;}
\DoxyCodeLine{01179         point                      = \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(center, r);}
\DoxyCodeLine{01180         \textcolor{keywordflow}{if} (k == 0)}
\DoxyCodeLine{01181           dpoints.push\_front(point);}
\DoxyCodeLine{01182         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01183           dpoints.push\_back(point);}
\DoxyCodeLine{01184 }
\DoxyCodeLine{01185         center                     = computeCenter(na1, nb1, r);}
\DoxyCodeLine{01186         \textcolor{keywordflow}{if} (r < THICKNESS\_LIMIT) r = THICKNESS\_LIMIT;}
\DoxyCodeLine{01187         point                      = \mbox{\hyperlink{class_t_thick_point}{TThickPoint}}(center, r);}
\DoxyCodeLine{01188         \textcolor{keywordflow}{if} (k == 0)}
\DoxyCodeLine{01189           dpoints.push\_front(point);}
\DoxyCodeLine{01190         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01191           dpoints.push\_back(point);}
\DoxyCodeLine{01192 }
\DoxyCodeLine{01193         \textcolor{keywordflow}{if} (k == 0)}
\DoxyCodeLine{01194           startJunction = na1-\/>m\_junction;}
\DoxyCodeLine{01195         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01196           endJunction = na1-\/>m\_junction;}
\DoxyCodeLine{01197 }
\DoxyCodeLine{01198         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01199       \}}
\DoxyCodeLine{01200 }
\DoxyCodeLine{01201       \textcolor{comment}{//            if(da*ba>-\/db*ba)}}
\DoxyCodeLine{01202       \textcolor{keywordflow}{if} (norm2(db) >= norm2(da)) \{}
\DoxyCodeLine{01203         \textcolor{keywordflow}{if} (na1-\/>m\_visited) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01204 }
\DoxyCodeLine{01205         na            = na1;}
\DoxyCodeLine{01206         na-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01207 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{01208         getOutPix(na-\/>m\_pixel) = TPixel32::Red;}
\DoxyCodeLine{01209 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01210       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01211         \textcolor{keywordflow}{if} (nb1-\/>m\_visited) \textcolor{keywordflow}{break};}
\DoxyCodeLine{01212 }
\DoxyCodeLine{01213         nb            = nb1;}
\DoxyCodeLine{01214         nb-\/>m\_visited = \textcolor{keyword}{true};}
\DoxyCodeLine{01215 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{01216         getOutPix(nb-\/>m\_pixel) = TPixel32::Green;}
\DoxyCodeLine{01217 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01218       \}}
\DoxyCodeLine{01219       \textcolor{keywordtype}{double} distance2                = computeDistance2(na, nb);}
\DoxyCodeLine{01220       \textcolor{keywordflow}{if} (distance2 < 0.25) distance2 = 0.25;}
\DoxyCodeLine{01221 }
\DoxyCodeLine{01222       \textcolor{keywordtype}{double} r;}
\DoxyCodeLine{01223       \mbox{\hyperlink{class_t_point_t}{TPointD}} center             = computeCenter(na, nb, r);}
\DoxyCodeLine{01224       \textcolor{keywordflow}{if} (r < THICKNESS\_LIMIT) r = THICKNESS\_LIMIT;}
\DoxyCodeLine{01225       \mbox{\hyperlink{class_t_thick_point}{TThickPoint}} point(center, r);}
\DoxyCodeLine{01226       \mbox{\hyperlink{class_t_point_t}{TPointI}} pos = convert(center);}
\DoxyCodeLine{01227       \textcolor{comment}{// TPixel32  *inPix = m\_src-\/>pixels(pos.y);}}
\DoxyCodeLine{01228       \textcolor{comment}{// inPix += pos.x;}}
\DoxyCodeLine{01229       \textcolor{comment}{// int value = (inPix-\/>r + 2*inPix-\/>g + inPix-\/>b)>>2;}}
\DoxyCodeLine{01230 }
\DoxyCodeLine{01231       \textcolor{keywordflow}{if} (distance2 > maxDist2 || distance2 < minDist2 || na-\/>m\_next == nb ||}
\DoxyCodeLine{01232           na-\/>m\_prev == nb}
\DoxyCodeLine{01233           \textcolor{comment}{//|| isJunction(na, nb)}}
\DoxyCodeLine{01234           \textcolor{comment}{//|| !(value<200)}}
\DoxyCodeLine{01235           ) \{}
\DoxyCodeLine{01236         \textcolor{keywordflow}{if} (na-\/>m\_next == nb || na-\/>m\_prev == nb || na-\/>m\_next-\/>m\_next == nb ||}
\DoxyCodeLine{01237             na-\/>m\_prev-\/>m\_prev == nb) \{}
\DoxyCodeLine{01238           \textcolor{keywordflow}{if} (k == 0) \{}
\DoxyCodeLine{01239             \textcolor{keywordflow}{if} (!dpoints.empty()) dpoints.pop\_front();}
\DoxyCodeLine{01240             \textcolor{keywordflow}{if} (!dpoints.empty()) dpoints.pop\_front();}
\DoxyCodeLine{01241           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01242             \textcolor{keywordflow}{if} (!dpoints.empty()) dpoints.pop\_back();}
\DoxyCodeLine{01243             \textcolor{keywordflow}{if} (!dpoints.empty()) dpoints.pop\_back();}
\DoxyCodeLine{01244           \}}
\DoxyCodeLine{01245         \}}
\DoxyCodeLine{01246         \textcolor{comment}{//              if(k==0) dpoints.push\_front(point);}}
\DoxyCodeLine{01247         \textcolor{comment}{//              else dpoints.push\_back(point);}}
\DoxyCodeLine{01248         na-\/>m\_junction = nb-\/>m\_junction = \textcolor{keyword}{new} \mbox{\hyperlink{class_junction}{Junction}}();}
\DoxyCodeLine{01249         na-\/>m\_junction-\/>m\_nodes.push\_back(nb);}
\DoxyCodeLine{01250         nb-\/>m\_junction-\/>m\_nodes.push\_back(na);}
\DoxyCodeLine{01251         m\_junctions.push\_back(na-\/>m\_junction);}
\DoxyCodeLine{01252 }
\DoxyCodeLine{01253         \textcolor{keywordflow}{if} (k == 0)}
\DoxyCodeLine{01254           startJunction = na-\/>m\_junction;}
\DoxyCodeLine{01255         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01256           endJunction = na-\/>m\_junction;}
\DoxyCodeLine{01257         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01258       \}}
\DoxyCodeLine{01259       \textcolor{keywordflow}{if} (k == 0)}
\DoxyCodeLine{01260         dpoints.push\_front(point);}
\DoxyCodeLine{01261       \textcolor{keywordflow}{else}}
\DoxyCodeLine{01262         dpoints.push\_back(point);}
\DoxyCodeLine{01263     \}}
\DoxyCodeLine{01264 }
\DoxyCodeLine{01265     std::swap(naa, nbb);}
\DoxyCodeLine{01266   \}}
\DoxyCodeLine{01267   \textcolor{keywordflow}{if} (dpoints.size() == 0)}
\DoxyCodeLine{01268     naa-\/>m\_visited = nbb-\/>m\_visited = \textcolor{keyword}{false};}
\DoxyCodeLine{01269   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01270     m\_protoStrokes.push\_back(\mbox{\hyperlink{class_proto_stroke}{ProtoStroke}}(dpoints.begin(), dpoints.end()));}
\DoxyCodeLine{01271     setEndpointsDirections(m\_protoStrokes.back());}
\DoxyCodeLine{01272     \textcolor{keywordflow}{if} (startJunction) \{}
\DoxyCodeLine{01273       m\_protoStrokes.back().m\_startJunction = startJunction;}
\DoxyCodeLine{01274       startJunction-\/>m\_protoStrokes.push\_back(\&m\_protoStrokes.back());}
\DoxyCodeLine{01275     \}}
\DoxyCodeLine{01276     \textcolor{keywordflow}{if} (endJunction) \{}
\DoxyCodeLine{01277       m\_protoStrokes.back().m\_endJunction = endJunction;}
\DoxyCodeLine{01278       endJunction-\/>m\_protoStrokes.push\_back(\&m\_protoStrokes.back());}
\DoxyCodeLine{01279     \}}
\DoxyCodeLine{01280   \}}
\DoxyCodeLine{01281 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_center_line_vectorizer_affd8c8cd55bbd5511ec941d3e2eb3acc}\label{class_center_line_vectorizer_affd8c8cd55bbd5511ec941d3e2eb3acc}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!vectorize@{vectorize}}
\index{vectorize@{vectorize}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{vectorize()}{vectorize()}}
{\footnotesize\ttfamily void Center\+Line\+Vectorizer\+::vectorize (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{02447                                      \{}
\DoxyCodeLine{02448   \textcolor{keywordtype}{int} j = 0;}
\DoxyCodeLine{02449 }
\DoxyCodeLine{02450   \textcolor{keywordflow}{for} (j = 0; j < (int)m\_nodes.size(); j++) \{}
\DoxyCodeLine{02451     \mbox{\hyperlink{class_node}{Node}} *node = m\_nodes[j];}
\DoxyCodeLine{02452     \textcolor{keywordflow}{if} (node-\/>m\_pixel == 0 || node-\/>m\_visited) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02453     traceLine(node-\/>m\_pixel);}
\DoxyCodeLine{02454   \}}
\DoxyCodeLine{02455 }
\DoxyCodeLine{02456   handleJunctions();}
\DoxyCodeLine{02457   createStrokes();}
\DoxyCodeLine{02458   createRegions();}
\DoxyCodeLine{02459 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_center_line_vectorizer_a479dbf8f9aadd0aabf67ba52e50bfa36}\label{class_center_line_vectorizer_a479dbf8f9aadd0aabf67ba52e50bfa36}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_configuration@{m\_configuration}}
\index{m\_configuration@{m\_configuration}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_configuration}{m\_configuration}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_vectorizer_configuration}{Vectorizer\+Configuration}} Center\+Line\+Vectorizer\+::m\+\_\+configuration}

\mbox{\Hypertarget{class_center_line_vectorizer_a3d73af2fd7d369e0cfa6d4108f24639e}\label{class_center_line_vectorizer_a3d73af2fd7d369e0cfa6d4108f24639e}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_dataRaster@{m\_dataRaster}}
\index{m\_dataRaster@{m\_dataRaster}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_dataRaster}{m\_dataRaster}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_p_t}{Data\+RasterP}} Center\+Line\+Vectorizer\+::m\+\_\+data\+Raster}

\mbox{\Hypertarget{class_center_line_vectorizer_a41ad2fbcf51a61f6b95589953f020efe}\label{class_center_line_vectorizer_a41ad2fbcf51a61f6b95589953f020efe}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_dataRasterArray@{m\_dataRasterArray}}
\index{m\_dataRasterArray@{m\_dataRasterArray}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_dataRasterArray}{m\_dataRasterArray}}
{\footnotesize\ttfamily \mbox{\hyperlink{classvector}{vector}}$<$pair$<$int, \mbox{\hyperlink{class_t_raster_p_t}{Data\+RasterP}}$>$ $>$ Center\+Line\+Vectorizer\+::m\+\_\+data\+Raster\+Array}

\mbox{\Hypertarget{class_center_line_vectorizer_a9fc61cc2459f73a30df52c1e63dcd45a}\label{class_center_line_vectorizer_a9fc61cc2459f73a30df52c1e63dcd45a}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_junctions@{m\_junctions}}
\index{m\_junctions@{m\_junctions}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_junctions}{m\_junctions}}
{\footnotesize\ttfamily \mbox{\hyperlink{classvector}{vector}}$<$\mbox{\hyperlink{class_junction}{Junction}} $\ast$$>$ Center\+Line\+Vectorizer\+::m\+\_\+junctions}

\mbox{\Hypertarget{class_center_line_vectorizer_ae27f83ea716828cb95dabb942cc222ac}\label{class_center_line_vectorizer_ae27f83ea716828cb95dabb942cc222ac}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_links@{m\_links}}
\index{m\_links@{m\_links}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_links}{m\_links}}
{\footnotesize\ttfamily \mbox{\hyperlink{classvector}{vector}}$<$\mbox{\hyperlink{class_junction_link}{Junction\+Link}}$>$ Center\+Line\+Vectorizer\+::m\+\_\+links}

\mbox{\Hypertarget{class_center_line_vectorizer_aa6a4f544b2ccaf516d017ddc2f102605}\label{class_center_line_vectorizer_aa6a4f544b2ccaf516d017ddc2f102605}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_nodes@{m\_nodes}}
\index{m\_nodes@{m\_nodes}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_nodes}{m\_nodes}}
{\footnotesize\ttfamily \mbox{\hyperlink{classvector}{vector}}$<$\mbox{\hyperlink{class_node}{Node}} $\ast$$>$ Center\+Line\+Vectorizer\+::m\+\_\+nodes}

\mbox{\Hypertarget{class_center_line_vectorizer_aabe35c50f2c12cdb4f398f863e884d7a}\label{class_center_line_vectorizer_aabe35c50f2c12cdb4f398f863e884d7a}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_protoRegions@{m\_protoRegions}}
\index{m\_protoRegions@{m\_protoRegions}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_protoRegions}{m\_protoRegions}}
{\footnotesize\ttfamily list$<$\mbox{\hyperlink{class_proto_region}{Proto\+Region}}$>$ Center\+Line\+Vectorizer\+::m\+\_\+proto\+Regions}

\mbox{\Hypertarget{class_center_line_vectorizer_a33c730773e3ebeeab0285a058e8ccdff}\label{class_center_line_vectorizer_a33c730773e3ebeeab0285a058e8ccdff}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_protoStrokes@{m\_protoStrokes}}
\index{m\_protoStrokes@{m\_protoStrokes}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_protoStrokes}{m\_protoStrokes}}
{\footnotesize\ttfamily list$<$\mbox{\hyperlink{class_proto_stroke}{Proto\+Stroke}}$>$ Center\+Line\+Vectorizer\+::m\+\_\+proto\+Strokes}

\mbox{\Hypertarget{class_center_line_vectorizer_a5ad41dd6e5eca752f3ce3eba0a18a783}\label{class_center_line_vectorizer_a5ad41dd6e5eca752f3ce3eba0a18a783}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_src@{m\_src}}
\index{m\_src@{m\_src}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_src}{m\_src}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} Center\+Line\+Vectorizer\+::m\+\_\+src}

\mbox{\Hypertarget{class_center_line_vectorizer_a2c6992c280df0ee2ccac31a524faa247}\label{class_center_line_vectorizer_a2c6992c280df0ee2ccac31a524faa247}} 
\index{CenterLineVectorizer@{CenterLineVectorizer}!m\_vimage@{m\_vimage}}
\index{m\_vimage@{m\_vimage}!CenterLineVectorizer@{CenterLineVectorizer}}
\doxysubsubsection{\texorpdfstring{m\_vimage}{m\_vimage}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_vector_image_p}{TVector\+ImageP}} Center\+Line\+Vectorizer\+::m\+\_\+vimage}



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonzlib/tcenterlinevectorizer\+Old.\+cpp\end{DoxyCompactItemize}
