\hypertarget{class_warp_fx}{}\doxysection{Warp\+Fx Class Reference}
\label{class_warp_fx}\index{WarpFx@{WarpFx}}
Inheritance diagram for Warp\+Fx\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=5.000000cm]{class_warp_fx}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_warp_fx_ab09038a540536624e29c0deb21b7aea1}{can\+Handle}} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame) override
\item 
bool \mbox{\hyperlink{class_warp_fx_a80d423d76ef4916f657982479aa6fd61}{do\+Get\+BBox}} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
void \mbox{\hyperlink{class_warp_fx_a76dc30bc33a687349207c8d33614e9c4}{do\+Dry\+Compute}} (\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
void \mbox{\hyperlink{class_warp_fx_a6c67b6311cefde2b391c373a05f9af8a}{do\+Compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\item 
int \mbox{\hyperlink{class_warp_fx_a8c86ae1851598e0502963b4fcd017103}{get\+Memory\+Requirement}} (const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) override
\end{DoxyCompactItemize}
\doxysubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} \mbox{\hyperlink{class_warp_fx_a476572a9189b209125d216a5df46ebd1}{m\+\_\+warped}}
\item 
\mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} \mbox{\hyperlink{class_warp_fx_ab4ecdf08cb91329d8669c44c37177738}{m\+\_\+warper}}
\item 
TDouble\+ParamP \mbox{\hyperlink{class_warp_fx_aeee7a3c6b627d1e8c15f2fde522f42c2}{m\+\_\+intensity}}
\item 
TDouble\+ParamP \mbox{\hyperlink{class_warp_fx_ad9d90d9a9fdb7ff09fbcd9306488f2de}{m\+\_\+grid\+Step}}
\item 
TBool\+ParamP \mbox{\hyperlink{class_warp_fx_ac263fcacb785ca574c6efcdce62e1ba6}{m\+\_\+sharpen}}
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_warp_fx_affd3f0cca2a798358126b33c95f3732a}\label{class_warp_fx_affd3f0cca2a798358126b33c95f3732a}} 
\index{WarpFx@{WarpFx}!WarpFx@{WarpFx}}
\index{WarpFx@{WarpFx}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{WarpFx()}{WarpFx()}}
{\footnotesize\ttfamily Warp\+Fx\+::\+Warp\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00022            : m\_intensity(20), m\_gridStep(2), m\_sharpen(\textcolor{keyword}{true}) \{}
\DoxyCodeLine{00023     \mbox{\hyperlink{class_t_fx_af0ccf8d65934ed9f7a62d3b45ee5f2b6}{addInputPort}}(\textcolor{stringliteral}{"{}Source"{}}, m\_warped);}
\DoxyCodeLine{00024     \mbox{\hyperlink{class_t_fx_af0ccf8d65934ed9f7a62d3b45ee5f2b6}{addInputPort}}(\textcolor{stringliteral}{"{}warper"{}}, m\_warper);}
\DoxyCodeLine{00025     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}intensity"{}}, m\_intensity);}
\DoxyCodeLine{00026     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}sensitivity"{}}, m\_gridStep);}
\DoxyCodeLine{00027     bindParam(\textcolor{keyword}{this}, \textcolor{stringliteral}{"{}sharpen"{}}, m\_sharpen);}
\DoxyCodeLine{00028 }
\DoxyCodeLine{00029     m\_intensity-\/>setValueRange(-\/1000, 1000);}
\DoxyCodeLine{00030     m\_gridStep-\/>setValueRange(2, 20);}
\DoxyCodeLine{00031   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_warp_fx_adb962c783e482865aa06da6e999e8d47}\label{class_warp_fx_adb962c783e482865aa06da6e999e8d47}} 
\index{WarpFx@{WarpFx}!````~WarpFx@{$\sim$WarpFx}}
\index{````~WarpFx@{$\sim$WarpFx}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{$\sim$WarpFx()}{~WarpFx()}}
{\footnotesize\ttfamily virtual Warp\+Fx\+::$\sim$\+Warp\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00032 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_warp_fx_ab09038a540536624e29c0deb21b7aea1}\label{class_warp_fx_ab09038a540536624e29c0deb21b7aea1}} 
\index{WarpFx@{WarpFx}!canHandle@{canHandle}}
\index{canHandle@{canHandle}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{canHandle()}{canHandle()}}
{\footnotesize\ttfamily bool Warp\+Fx\+::can\+Handle (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00036                                                                      \{}
\DoxyCodeLine{00037     \textcolor{keywordflow}{return} isAlmostIsotropic(info.m\_affine);}
\DoxyCodeLine{00038   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_warp_fx_a6c67b6311cefde2b391c373a05f9af8a}\label{class_warp_fx_a6c67b6311cefde2b391c373a05f9af8a}} 
\index{WarpFx@{WarpFx}!doCompute@{doCompute}}
\index{doCompute@{doCompute}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{doCompute()}{doCompute()}}
{\footnotesize\ttfamily void Warp\+Fx\+::do\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00114                                                        \{}
\DoxyCodeLine{00115     \textcolor{keywordtype}{bool} isWarped = m\_warped.isConnected();}
\DoxyCodeLine{00116     \textcolor{keywordtype}{bool} isWarper = m\_warper.isConnected();}
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118     \textcolor{keywordflow}{if} (!isWarped) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120     \textcolor{keywordflow}{if} (!isWarper) \{}
\DoxyCodeLine{00121       m\_warped-\/>compute(tile, frame, info);}
\DoxyCodeLine{00122       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00123     \}}
\DoxyCodeLine{00124     \textcolor{keywordflow}{if} (fabs(m\_intensity-\/>getValue(frame)) < 0.01) \{}
\DoxyCodeLine{00125       m\_warped-\/>compute(tile, frame, info);}
\DoxyCodeLine{00126       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00127     \}}
\DoxyCodeLine{00128 }
\DoxyCodeLine{00129     \textcolor{keywordtype}{int} shrink      = (info.m\_shrinkX + info.m\_shrinkY) / 2;}
\DoxyCodeLine{00130     \textcolor{keywordtype}{double} scale    = sqrt(fabs(info.m\_affine.det()));}
\DoxyCodeLine{00131     \textcolor{keywordtype}{double} gridStep = 1.5 * m\_gridStep-\/>getValue(frame);}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133     \textcolor{comment}{// NOTE: The gridStep is absorbed by the warper scale and the intensity -\/}}
\DoxyCodeLine{00134     \textcolor{comment}{// the former}}
\DoxyCodeLine{00135     \textcolor{comment}{// balancing the latter.}}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137     \mbox{\hyperlink{struct_warp_params}{WarpParams}} params;}
\DoxyCodeLine{00138     params.m\_intensity   = m\_intensity-\/>getValue(frame) / gridStep;}
\DoxyCodeLine{00139     params.m\_warperScale = scale * gridStep;}
\DoxyCodeLine{00140     params.m\_sharpen     = m\_sharpen-\/>getValue();}
\DoxyCodeLine{00141     params.m\_shrink      = shrink;}
\DoxyCodeLine{00142 }
\DoxyCodeLine{00143     \textcolor{comment}{// The warper is calculated with a fixed dpi. This makes sure that the}}
\DoxyCodeLine{00144     \textcolor{comment}{// lattice}}
\DoxyCodeLine{00145     \textcolor{comment}{// created for the warp does not depend on camera resolutions / affine}}
\DoxyCodeLine{00146     \textcolor{comment}{// scales.}}
\DoxyCodeLine{00147     \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} warperInfo(info);}
\DoxyCodeLine{00148     \textcolor{keywordtype}{double} warperScaleFactor = 1.0 / params.m\_warperScale;}
\DoxyCodeLine{00149     warperInfo.m\_affine      = \mbox{\hyperlink{class_t_scale}{TScale}}(warperScaleFactor) * info.m\_affine;}
\DoxyCodeLine{00150 }
\DoxyCodeLine{00151     \textcolor{comment}{// Retrieve tile's geometry}}
\DoxyCodeLine{00152     \mbox{\hyperlink{class_t_rect_t}{TRectD}} tileRect;}
\DoxyCodeLine{00153     \{}
\DoxyCodeLine{00154       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} tileRas = tile.getRaster();}
\DoxyCodeLine{00155       tileRect =}
\DoxyCodeLine{00156           \mbox{\hyperlink{class_t_rect_t}{TRectD}}(tile.m\_pos, \mbox{\hyperlink{class_t_dimension_t}{TDimensionD}}(tileRas-\/>getLx(), tileRas-\/>getLy()));}
\DoxyCodeLine{00157     \}}
\DoxyCodeLine{00158 }
\DoxyCodeLine{00159     \textcolor{comment}{// Build the compute rect}}
\DoxyCodeLine{00160     \mbox{\hyperlink{class_t_rect_t}{TRectD}} warpedBox, warpedComputeRect, tileComputeRect;}
\DoxyCodeLine{00161     m\_warped-\/>getBBox(frame, warpedBox, info);}
\DoxyCodeLine{00162 }
\DoxyCodeLine{00163     getWarpComputeRects(tileComputeRect, warpedComputeRect, warpedBox, tileRect,}
\DoxyCodeLine{00164                         params);}
\DoxyCodeLine{00165 }
\DoxyCodeLine{00166     \textcolor{keywordflow}{if} (tileComputeRect.getLx() <= 0 || tileComputeRect.getLy() <= 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00167     \textcolor{keywordflow}{if} (warpedComputeRect.getLx() <= 0 || warpedComputeRect.getLy() <= 0)}
\DoxyCodeLine{00168       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00169 }
\DoxyCodeLine{00170     \mbox{\hyperlink{class_t_rect_t}{TRectD}} warperComputeRect(\mbox{\hyperlink{class_t_scale}{TScale}}(warperScaleFactor) * tileComputeRect);}
\DoxyCodeLine{00171     \textcolor{keywordtype}{double} warperEnlargement = getWarperEnlargement(params);}
\DoxyCodeLine{00172     warperComputeRect        = warperComputeRect.enlarge(warperEnlargement);}
\DoxyCodeLine{00173     warperComputeRect.x0     = tfloor(warperComputeRect.x0);}
\DoxyCodeLine{00174     warperComputeRect.y0     = tfloor(warperComputeRect.y0);}
\DoxyCodeLine{00175     warperComputeRect.x1     = tceil(warperComputeRect.x1);}
\DoxyCodeLine{00176     warperComputeRect.y1     = tceil(warperComputeRect.y1);}
\DoxyCodeLine{00177 }
\DoxyCodeLine{00178     \textcolor{comment}{// Compute the warped tile}}
\DoxyCodeLine{00179     \mbox{\hyperlink{class_t_tile}{TTile}} tileIn;}
\DoxyCodeLine{00180     m\_warped-\/>allocateAndCompute(}
\DoxyCodeLine{00181         tileIn, warpedComputeRect.getP00(),}
\DoxyCodeLine{00182         \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(warpedComputeRect.getLx(), warpedComputeRect.getLy()),}
\DoxyCodeLine{00183         tile.getRaster(), frame, info);}
\DoxyCodeLine{00184 }
\DoxyCodeLine{00185     \textcolor{comment}{// Compute the warper tile}}
\DoxyCodeLine{00186     \mbox{\hyperlink{class_t_tile}{TTile}} tileWarper;}
\DoxyCodeLine{00187     m\_warper-\/>allocateAndCompute(}
\DoxyCodeLine{00188         tileWarper, warperComputeRect.getP00(),}
\DoxyCodeLine{00189         \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(warperComputeRect.getLx(), warperComputeRect.getLy()),}
\DoxyCodeLine{00190         tile.getRaster(), frame, warperInfo);}
\DoxyCodeLine{00191 }
\DoxyCodeLine{00192     \textcolor{comment}{// Warp}}
\DoxyCodeLine{00193     \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} rasIn     = tileIn.getRaster();}
\DoxyCodeLine{00194     \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} rasWarper = tileWarper.getRaster();}
\DoxyCodeLine{00195 }
\DoxyCodeLine{00196     \mbox{\hyperlink{class_t_point_t}{TPointD}} db;}
\DoxyCodeLine{00197     \mbox{\hyperlink{class_t_rect_t}{TRect}} rasComputeRectI(convert(tileComputeRect -\/ tileRect.getP00(), db));}
\DoxyCodeLine{00198     \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} tileRas = tile.getRaster()-\/>extract(rasComputeRectI);}
\DoxyCodeLine{00199 }
\DoxyCodeLine{00200     \mbox{\hyperlink{class_t_point_t}{TPointD}} rasInPos(warpedComputeRect.getP00() -\/ tileComputeRect.getP00());}
\DoxyCodeLine{00201     \mbox{\hyperlink{class_t_point_t}{TPointD}} warperPos(}
\DoxyCodeLine{00202         (\mbox{\hyperlink{class_t_scale}{TScale}}(params.m\_warperScale) * warperComputeRect.getP00()) -\/}
\DoxyCodeLine{00203         tileComputeRect.getP00());}
\DoxyCodeLine{00204     warp(tileRas, rasIn, rasWarper, rasInPos, warperPos, params);}
\DoxyCodeLine{00205   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_warp_fx_a76dc30bc33a687349207c8d33614e9c4}\label{class_warp_fx_a76dc30bc33a687349207c8d33614e9c4}} 
\index{WarpFx@{WarpFx}!doDryCompute@{doDryCompute}}
\index{doDryCompute@{doDryCompute}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{doDryCompute()}{doDryCompute()}}
{\footnotesize\ttfamily void Warp\+Fx\+::do\+Dry\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Declares the computation scheme of this fx for rendering optimization purposes. This is an important function of the Toonz rendering API, and should be reimplemented with the necessary care. The Toonz rendering process makes use of this function to enact most of the optimization steps about the fx computation, in particular fx caching. A correct implementation of this method should follow these rules\+:  The invocation of child node computations should be faithfully reproduced.  TRaster\+Fx\+::compute and TRaster\+Fx\+::allocate\+And\+Compute calls have to be translated to TRaster\+Fx\+::dry\+Compute calls.  This fx is intended for precomputation stage, so the hard rendering code should be skipped here. By default, this method raises a dry\+Compute call to each input port in increasing order, using the TRaster\+Fx\+::transform method to identify the tiles to be passed on input precomputation. 

Reimplemented from \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00065                                                           \{}
\DoxyCodeLine{00066     \textcolor{keywordtype}{bool} isWarped = m\_warped.isConnected();}
\DoxyCodeLine{00067     \textcolor{keywordtype}{bool} isWarper = m\_warper.isConnected();}
\DoxyCodeLine{00068     \textcolor{keywordflow}{if} (!isWarped) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00069     \textcolor{keywordflow}{if} (!isWarper || fabs(m\_intensity-\/>getValue(frame)) < 0.01) \{}
\DoxyCodeLine{00070       m\_warped-\/>dryCompute(rect, frame, info);}
\DoxyCodeLine{00071       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00072     \}}
\DoxyCodeLine{00073 }
\DoxyCodeLine{00074     \textcolor{keywordtype}{int} shrink      = (info.m\_shrinkX + info.m\_shrinkY) / 2;}
\DoxyCodeLine{00075     \textcolor{keywordtype}{double} scale    = sqrt(fabs(info.m\_affine.det()));}
\DoxyCodeLine{00076     \textcolor{keywordtype}{double} gridStep = 1.5 * m\_gridStep-\/>getValue(frame);}
\DoxyCodeLine{00077 }
\DoxyCodeLine{00078     \mbox{\hyperlink{struct_warp_params}{WarpParams}} params;}
\DoxyCodeLine{00079     params.m\_intensity   = m\_intensity-\/>getValue(frame) / gridStep;}
\DoxyCodeLine{00080     params.m\_warperScale = scale * gridStep;}
\DoxyCodeLine{00081     params.m\_sharpen     = m\_sharpen-\/>getValue();}
\DoxyCodeLine{00082     params.m\_shrink      = shrink;}
\DoxyCodeLine{00083 }
\DoxyCodeLine{00084     \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} warperInfo(info);}
\DoxyCodeLine{00085     \textcolor{keywordtype}{double} warperScaleFactor = 1.0 / params.m\_warperScale;}
\DoxyCodeLine{00086     warperInfo.m\_affine      = \mbox{\hyperlink{class_t_scale}{TScale}}(warperScaleFactor) * info.m\_affine;}
\DoxyCodeLine{00087 }
\DoxyCodeLine{00088     \mbox{\hyperlink{class_t_rect_t}{TRectD}} warpedBox, warpedComputeRect, tileComputeRect;}
\DoxyCodeLine{00089     m\_warped-\/>getBBox(frame, warpedBox, info);}
\DoxyCodeLine{00090 }
\DoxyCodeLine{00091     getWarpComputeRects(tileComputeRect, warpedComputeRect, warpedBox, rect,}
\DoxyCodeLine{00092                         params);}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094     \textcolor{keywordflow}{if} (tileComputeRect.getLx() <= 0 || tileComputeRect.getLy() <= 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00095     \textcolor{keywordflow}{if} (warpedComputeRect.getLx() <= 0 || warpedComputeRect.getLy() <= 0)}
\DoxyCodeLine{00096       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00097 }
\DoxyCodeLine{00098     \mbox{\hyperlink{class_t_point_t}{TPointD}} db;}
\DoxyCodeLine{00099     \mbox{\hyperlink{class_t_rect_t}{TRectD}} warperComputeRect(\mbox{\hyperlink{class_t_scale}{TScale}}(warperScaleFactor) * tileComputeRect);}
\DoxyCodeLine{00100     \textcolor{keywordtype}{double} warperEnlargement = getWarperEnlargement(params);}
\DoxyCodeLine{00101     warperComputeRect        = warperComputeRect.enlarge(warperEnlargement);}
\DoxyCodeLine{00102     warperComputeRect.x0     = tfloor(warperComputeRect.x0);}
\DoxyCodeLine{00103     warperComputeRect.y0     = tfloor(warperComputeRect.y0);}
\DoxyCodeLine{00104     warperComputeRect.x1     = tceil(warperComputeRect.x1);}
\DoxyCodeLine{00105     warperComputeRect.y1     = tceil(warperComputeRect.y1);}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107     m\_warped-\/>dryCompute(warpedComputeRect, frame, info);}
\DoxyCodeLine{00108     m\_warper-\/>dryCompute(warperComputeRect, frame, warperInfo);}
\DoxyCodeLine{00109   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00097}{TRender\+Settings\+::m\+\_\+affine}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_warp_fx_a80d423d76ef4916f657982479aa6fd61}\label{class_warp_fx_a80d423d76ef4916f657982479aa6fd61}} 
\index{WarpFx@{WarpFx}!doGetBBox@{doGetBBox}}
\index{doGetBBox@{doGetBBox}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{doGetBBox()}{doGetBBox()}}
{\footnotesize\ttfamily bool Warp\+Fx\+::do\+Get\+BBox (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{b\+Box,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00043                                                        \{}
\DoxyCodeLine{00044     \textcolor{keywordflow}{if} (m\_warped.isConnected()) \{}
\DoxyCodeLine{00045       \textcolor{keywordtype}{int} ret = m\_warped-\/>doGetBBox(frame, bBox, info);}
\DoxyCodeLine{00046 }
\DoxyCodeLine{00047       \textcolor{keywordflow}{if} (ret \&\& !bBox.\mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{isEmpty}}()) \{}
\DoxyCodeLine{00048         \textcolor{keywordflow}{if} (bBox != TConsts::infiniteRectD) \{}
\DoxyCodeLine{00049           \mbox{\hyperlink{struct_warp_params}{WarpParams}} params;}
\DoxyCodeLine{00050           params.m\_intensity = m\_intensity-\/>getValue(frame);}
\DoxyCodeLine{00051 }
\DoxyCodeLine{00052           bBox = bBox.enlarge(getWarpRadius(params));}
\DoxyCodeLine{00053         \}}
\DoxyCodeLine{00054         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00055       \}}
\DoxyCodeLine{00056     \}}
\DoxyCodeLine{00057 }
\DoxyCodeLine{00058     bBox = \mbox{\hyperlink{class_t_rect_t}{TRectD}}();}
\DoxyCodeLine{00059     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00060   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_warp_fx_a8c86ae1851598e0502963b4fcd017103}\label{class_warp_fx_a8c86ae1851598e0502963b4fcd017103}} 
\index{WarpFx@{WarpFx}!getMemoryRequirement@{getMemoryRequirement}}
\index{getMemoryRequirement@{getMemoryRequirement}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{getMemoryRequirement()}{getMemoryRequirement()}}
{\footnotesize\ttfamily int Warp\+Fx\+::get\+Memory\+Requirement (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Specifies the approximate size (in Mega\+Bytes) of the maximum allocation instance that this fx will need to perform in order to render the passed input. This method should be reimplemented in order to make the Toonz rendering process aware of the use of big raster memory chunks, at least. Observe that the passed tile geometry is implicitly {\itshape  already allocated \texorpdfstring{$<$}{<}\textbackslash{}i\texorpdfstring{$>$}{>} for the fx output. ~\newline
The default implementation returns 0, assuming that the passed implicit memory size is passed below in node computation without further allocation of resources. Fxs can reimplement this to -\/1 to explicitly disable the Toonz\textquotesingle{}s smart memory handling. ~\newline
 ~\newline
\begin{DoxyNote}{Note}
The rendering process ensures that the passed render settings are {\itshape handled} by the fx before this function is invoked -\/ do not waste code for it. 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRaster\+Fx\+::memory\+Size}} and TRaster\+Fx\+::can\+Handle methods. 
\end{DoxySeeAlso}
}

Reimplemented from \mbox{\hyperlink{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}{TRaster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00210                                                                  \{}
\DoxyCodeLine{00211     \textcolor{comment}{// return 0;   //For debug purpose}}
\DoxyCodeLine{00212 }
\DoxyCodeLine{00213     \textcolor{keywordtype}{int} shrink      = (info.m\_shrinkX + info.m\_shrinkY) / 2;}
\DoxyCodeLine{00214     \textcolor{keywordtype}{double} scale    = sqrt(fabs(info.m\_affine.det()));}
\DoxyCodeLine{00215     \textcolor{keywordtype}{double} gridStep = 1.5 * m\_gridStep-\/>getValue(frame);}
\DoxyCodeLine{00216 }
\DoxyCodeLine{00217     \mbox{\hyperlink{struct_warp_params}{WarpParams}} params;}
\DoxyCodeLine{00218     params.m\_intensity   = m\_intensity-\/>getValue(frame) / gridStep;}
\DoxyCodeLine{00219     params.m\_warperScale = scale * gridStep;}
\DoxyCodeLine{00220     params.m\_sharpen     = m\_sharpen-\/>getValue();}
\DoxyCodeLine{00221     params.m\_shrink      = shrink;}
\DoxyCodeLine{00222 }
\DoxyCodeLine{00223     \textcolor{keywordtype}{double} warperScaleFactor = 1.0 / params.m\_warperScale;}
\DoxyCodeLine{00224 }
\DoxyCodeLine{00225     \mbox{\hyperlink{class_t_rect_t}{TRectD}} warpedBox, warpedComputeRect, tileComputeRect;}
\DoxyCodeLine{00226     m\_warped-\/>getBBox(frame, warpedBox, info);}
\DoxyCodeLine{00227 }
\DoxyCodeLine{00228     getWarpComputeRects(tileComputeRect, warpedComputeRect, warpedBox, rect,}
\DoxyCodeLine{00229                         params);}
\DoxyCodeLine{00230 }
\DoxyCodeLine{00231     \mbox{\hyperlink{class_t_rect_t}{TRectD}} warperComputeRect(\mbox{\hyperlink{class_t_scale}{TScale}}(warperScaleFactor) * tileComputeRect);}
\DoxyCodeLine{00232     \textcolor{keywordtype}{double} warperEnlargement = getWarperEnlargement(params);}
\DoxyCodeLine{00233     warperComputeRect        = warperComputeRect.enlarge(warperEnlargement);}
\DoxyCodeLine{00234 }
\DoxyCodeLine{00235     \textcolor{keywordflow}{return} std::max(\mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRasterFx::memorySize}}(warpedComputeRect, info.m\_bpp),}
\DoxyCodeLine{00236                     \mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRasterFx::memorySize}}(warperComputeRect, info.m\_bpp));}
\DoxyCodeLine{00237   \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00560}{TRaster\+Fx\+::memory\+Size()}}.



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_warp_fx_ad9d90d9a9fdb7ff09fbcd9306488f2de}\label{class_warp_fx_ad9d90d9a9fdb7ff09fbcd9306488f2de}} 
\index{WarpFx@{WarpFx}!m\_gridStep@{m\_gridStep}}
\index{m\_gridStep@{m\_gridStep}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{m\_gridStep}{m\_gridStep}}
{\footnotesize\ttfamily TDouble\+ParamP Warp\+Fx\+::m\+\_\+grid\+Step\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_warp_fx_aeee7a3c6b627d1e8c15f2fde522f42c2}\label{class_warp_fx_aeee7a3c6b627d1e8c15f2fde522f42c2}} 
\index{WarpFx@{WarpFx}!m\_intensity@{m\_intensity}}
\index{m\_intensity@{m\_intensity}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{m\_intensity}{m\_intensity}}
{\footnotesize\ttfamily TDouble\+ParamP Warp\+Fx\+::m\+\_\+intensity\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_warp_fx_ac263fcacb785ca574c6efcdce62e1ba6}\label{class_warp_fx_ac263fcacb785ca574c6efcdce62e1ba6}} 
\index{WarpFx@{WarpFx}!m\_sharpen@{m\_sharpen}}
\index{m\_sharpen@{m\_sharpen}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{m\_sharpen}{m\_sharpen}}
{\footnotesize\ttfamily TBool\+ParamP Warp\+Fx\+::m\+\_\+sharpen\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_warp_fx_a476572a9189b209125d216a5df46ebd1}\label{class_warp_fx_a476572a9189b209125d216a5df46ebd1}} 
\index{WarpFx@{WarpFx}!m\_warped@{m\_warped}}
\index{m\_warped@{m\_warped}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{m\_warped}{m\_warped}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} Warp\+Fx\+::m\+\_\+warped\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{class_warp_fx_ab4ecdf08cb91329d8669c44c37177738}\label{class_warp_fx_ab4ecdf08cb91329d8669c44c37177738}} 
\index{WarpFx@{WarpFx}!m\_warper@{m\_warper}}
\index{m\_warper@{m\_warper}!WarpFx@{WarpFx}}
\doxysubsubsection{\texorpdfstring{m\_warper}{m\_warper}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_fx_port}{TRaster\+Fx\+Port}} Warp\+Fx\+::m\+\_\+warper\hspace{0.3cm}{\ttfamily [protected]}}



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/warpfx.\+cpp\end{DoxyCompactItemize}
