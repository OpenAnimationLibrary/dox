\hypertarget{class_t_level_writer_sprite}{}\doxysection{TLevel\+Writer\+Sprite Class Reference}
\label{class_t_level_writer_sprite}\index{TLevelWriterSprite@{TLevelWriterSprite}}
Inheritance diagram for TLevel\+Writer\+Sprite\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_level_writer_sprite}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_level_writer_sprite_a8b170602af18849128f7cf3596dadde2}{TLevel\+Writer\+Sprite}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\item 
void \mbox{\hyperlink{class_t_level_writer_sprite_a39716423760394fce06d154bb8c5db7e}{set\+Frame\+Rate}} (double fps) override
\item 
\mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} \mbox{\hyperlink{class_t_level_writer_sprite_a4ae49cfd956c8b8adbc28b0cdd452e05}{get\+Frame\+Writer}} (\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} fid) override
\item 
void \mbox{\hyperlink{class_t_level_writer_sprite_af414f77c45ee028c080da1e0258d1fd0}{save}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&image, int frame\+Index)
\item 
void \mbox{\hyperlink{class_t_level_writer_sprite_a9f3a20c81c31ef1abda2161f848c7025}{save\+Sound\+Track}} (\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$st) override
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ \mbox{\hyperlink{class_t_level_writer_sprite_ae0e957867bb6cc7c14e1cd22b6024636}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_level_writer_sprite_a8b170602af18849128f7cf3596dadde2}\label{class_t_level_writer_sprite_a8b170602af18849128f7cf3596dadde2}} 
\index{TLevelWriterSprite@{TLevelWriterSprite}!TLevelWriterSprite@{TLevelWriterSprite}}
\index{TLevelWriterSprite@{TLevelWriterSprite}!TLevelWriterSprite@{TLevelWriterSprite}}
\doxysubsubsection{\texorpdfstring{TLevelWriterSprite()}{TLevelWriterSprite()}}
{\footnotesize\ttfamily TLevel\+Writer\+Sprite\+::\+TLevel\+Writer\+Sprite (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{path,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00051     : \mbox{\hyperlink{class_t_level_writer}{TLevelWriter}}(path, winfo) \{}
\DoxyCodeLine{00052   \textcolor{keywordflow}{if} (!m\_properties) m\_properties = \textcolor{keyword}{new} \mbox{\hyperlink{class_tiio_1_1_sprite_writer_properties}{Tiio::SpriteWriterProperties}}();}
\DoxyCodeLine{00053   std::string scale = m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Scale"{}})-\/>getValueAsString();}
\DoxyCodeLine{00054   m\_scale           = QString::fromStdString(scale).toInt();}
\DoxyCodeLine{00055   std::string topPadding =}
\DoxyCodeLine{00056       m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Top Padding"{}})-\/>getValueAsString();}
\DoxyCodeLine{00057   m\_topPadding = QString::fromStdString(topPadding).toInt();}
\DoxyCodeLine{00058   std::string bottomPadding =}
\DoxyCodeLine{00059       m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Bottom Padding"{}})-\/>getValueAsString();}
\DoxyCodeLine{00060   m\_bottomPadding = QString::fromStdString(bottomPadding).toInt();}
\DoxyCodeLine{00061   std::string leftPadding =}
\DoxyCodeLine{00062       m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Left Padding"{}})-\/>getValueAsString();}
\DoxyCodeLine{00063   m\_leftPadding = QString::fromStdString(leftPadding).toInt();}
\DoxyCodeLine{00064   std::string rightPadding =}
\DoxyCodeLine{00065       m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Right Padding"{}})-\/>getValueAsString();}
\DoxyCodeLine{00066   m\_rightPadding = QString::fromStdString(rightPadding).toInt();}
\DoxyCodeLine{00067   m\_format       = QString::fromStdWString(}
\DoxyCodeLine{00068       ((\mbox{\hyperlink{class_t_enum_property}{TEnumProperty}} *)(m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Format"{}})))-\/>getValue());}
\DoxyCodeLine{00069   \mbox{\hyperlink{class_t_bool_property}{TBoolProperty}} *trim =}
\DoxyCodeLine{00070       (\mbox{\hyperlink{class_t_bool_property}{TBoolProperty}} *)m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Trim Empty Space"{}});}
\DoxyCodeLine{00071   m\_trim = trim-\/>getValue();}
\DoxyCodeLine{00072   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(m\_path)) TSystem::deleteFile(m\_path);}
\DoxyCodeLine{00073 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_sprite_a6aade530b649ee4e1e65f3060817a951}\label{class_t_level_writer_sprite_a6aade530b649ee4e1e65f3060817a951}} 
\index{TLevelWriterSprite@{TLevelWriterSprite}!````~TLevelWriterSprite@{$\sim$TLevelWriterSprite}}
\index{````~TLevelWriterSprite@{$\sim$TLevelWriterSprite}!TLevelWriterSprite@{TLevelWriterSprite}}
\doxysubsubsection{\texorpdfstring{$\sim$TLevelWriterSprite()}{~TLevelWriterSprite()}}
{\footnotesize\ttfamily TLevel\+Writer\+Sprite\+::$\sim$\+TLevel\+Writer\+Sprite (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00077                                         \{}
\DoxyCodeLine{00078   \textcolor{keywordtype}{int} finalWidth    = m\_right -\/ m\_left + 1;}
\DoxyCodeLine{00079   \textcolor{keywordtype}{int} finalHeight   = m\_bottom -\/ m\_top + 1;}
\DoxyCodeLine{00080   \textcolor{keywordtype}{int} resizedWidth  = finalWidth * m\_scale / 100;}
\DoxyCodeLine{00081   \textcolor{keywordtype}{int} resizedHeight = finalHeight * m\_scale / 100;}
\DoxyCodeLine{00082   \textcolor{keywordflow}{for} (QImage *image : m\_images) \{}
\DoxyCodeLine{00083     QImage \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}} = image-\/>copy(m\_left, m\_top, finalWidth, finalHeight);}
\DoxyCodeLine{00084     \textcolor{keywordflow}{if} (m\_scale != 100) \{}
\DoxyCodeLine{00085       \textcolor{keywordtype}{int} width  = (\mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}.width() * m\_scale) / 100;}
\DoxyCodeLine{00086       \textcolor{keywordtype}{int} height = (\mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}.height() * m\_scale) / 100;}
\DoxyCodeLine{00087       \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}       = \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}.scaled(width, height);}
\DoxyCodeLine{00088     \}}
\DoxyCodeLine{00089     m\_imagesResized.push\_back(copy);}
\DoxyCodeLine{00090   \}}
\DoxyCodeLine{00091   \textcolor{keywordflow}{for} (QImage *image : m\_images) \{}
\DoxyCodeLine{00092     \textcolor{keyword}{delete} image;}
\DoxyCodeLine{00093   \}}
\DoxyCodeLine{00094   m\_images.clear();}
\DoxyCodeLine{00095   \textcolor{keywordtype}{int} horizDim          = 1;}
\DoxyCodeLine{00096   \textcolor{keywordtype}{int} vertDim           = 1;}
\DoxyCodeLine{00097   \textcolor{keywordtype}{int} vertPadding       = m\_topPadding + m\_bottomPadding;}
\DoxyCodeLine{00098   \textcolor{keywordtype}{int} horizPadding      = m\_leftPadding + m\_rightPadding;}
\DoxyCodeLine{00099   \textcolor{keywordtype}{int} totalVertPadding  = 0;}
\DoxyCodeLine{00100   \textcolor{keywordtype}{int} totalHorizPadding = 0;}
\DoxyCodeLine{00101   \textcolor{keywordtype}{int} spriteSheetWidth;}
\DoxyCodeLine{00102   \textcolor{keywordtype}{int} spriteSheetHeight;}
\DoxyCodeLine{00103   \textcolor{keywordflow}{if} (m\_format == \textcolor{stringliteral}{"{}Grid"{}}) \{}
\DoxyCodeLine{00104     \textcolor{comment}{// Calculate Grid Size}}
\DoxyCodeLine{00105     \textcolor{keywordflow}{while} (horizDim * horizDim < m\_imagesResized.size()) horizDim++;}
\DoxyCodeLine{00106     totalHorizPadding = horizDim * horizPadding;}
\DoxyCodeLine{00107     spriteSheetWidth  = horizDim * resizedWidth + totalHorizPadding;}
\DoxyCodeLine{00108     vertDim           = horizDim;}
\DoxyCodeLine{00109     \textcolor{comment}{// Figure out if there is one row too many}}
\DoxyCodeLine{00110     \textcolor{comment}{// (Such as 6 images needs 3 x 2 grid)}}
\DoxyCodeLine{00111     \textcolor{keywordflow}{if} (vertDim * vertDim -\/ vertDim >= m\_imagesResized.size()) \{}
\DoxyCodeLine{00112       vertDim = vertDim -\/ 1;}
\DoxyCodeLine{00113     \}}
\DoxyCodeLine{00114     totalVertPadding  = vertDim * vertPadding;}
\DoxyCodeLine{00115     spriteSheetHeight = vertDim * resizedHeight + totalVertPadding;}
\DoxyCodeLine{00116   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_format == \textcolor{stringliteral}{"{}Vertical"{}}) \{}
\DoxyCodeLine{00117     spriteSheetWidth  = resizedWidth + horizPadding;}
\DoxyCodeLine{00118     spriteSheetHeight = m\_imagesResized.size() * (resizedHeight + vertPadding);}
\DoxyCodeLine{00119     vertDim           = m\_imagesResized.size();}
\DoxyCodeLine{00120   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_format == \textcolor{stringliteral}{"{}Horizontal"{}}) \{}
\DoxyCodeLine{00121     spriteSheetWidth  = m\_imagesResized.size() * (resizedWidth + horizPadding);}
\DoxyCodeLine{00122     spriteSheetHeight = resizedHeight + vertPadding;}
\DoxyCodeLine{00123     horizDim          = m\_imagesResized.size();}
\DoxyCodeLine{00124   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_format == \textcolor{stringliteral}{"{}Individual"{}}) \{}
\DoxyCodeLine{00125     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m\_imagesResized.size(); i++) \{}
\DoxyCodeLine{00126       QString path      = m\_path.getQString();}
\DoxyCodeLine{00127       QString newEnding = \textcolor{stringliteral}{"{}\_"{}} + QString::number(i) + \textcolor{stringliteral}{"{}.png"{}};}
\DoxyCodeLine{00128       path              = path.replace(\textcolor{stringliteral}{"{}.spritesheet"{}}, newEnding);}
\DoxyCodeLine{00129       m\_imagesResized[i].save(path, \textcolor{stringliteral}{"{}PNG"{}}, -\/1);}
\DoxyCodeLine{00130     \}}
\DoxyCodeLine{00131   \}}
\DoxyCodeLine{00132   \textcolor{keywordflow}{if} (m\_format != \textcolor{stringliteral}{"{}Individual"{}}) \{}
\DoxyCodeLine{00133     QImage spriteSheet = QImage(spriteSheetWidth, spriteSheetHeight,}
\DoxyCodeLine{00134                                 QImage::Format\_ARGB32\_Premultiplied);}
\DoxyCodeLine{00135     spriteSheet.fill(qRgba(0, 0, 0, 0));}
\DoxyCodeLine{00136     QPainter painter;}
\DoxyCodeLine{00137     painter.begin(\&spriteSheet);}
\DoxyCodeLine{00138     \textcolor{keywordtype}{int} row    = 0;}
\DoxyCodeLine{00139     \textcolor{keywordtype}{int} column = 0;}
\DoxyCodeLine{00140     \textcolor{keywordtype}{int} rowPadding;}
\DoxyCodeLine{00141     \textcolor{keywordtype}{int} columnPadding;}
\DoxyCodeLine{00142     \textcolor{keywordtype}{int} currentImage = 0;}
\DoxyCodeLine{00143     \textcolor{keywordflow}{while} (row < vertDim) \{}
\DoxyCodeLine{00144       \textcolor{keywordflow}{while} (column < horizDim) \{}
\DoxyCodeLine{00145         rowPadding    = m\_topPadding;}
\DoxyCodeLine{00146         columnPadding = m\_leftPadding;}
\DoxyCodeLine{00147         rowPadding += row * vertPadding;}
\DoxyCodeLine{00148         columnPadding += column * horizPadding;}
\DoxyCodeLine{00149         painter.drawImage(column * resizedWidth + columnPadding,}
\DoxyCodeLine{00150                           row * resizedHeight + rowPadding,}
\DoxyCodeLine{00151                           m\_imagesResized[currentImage]);}
\DoxyCodeLine{00152         currentImage++;}
\DoxyCodeLine{00153         column++;}
\DoxyCodeLine{00154         \textcolor{keywordflow}{if} (currentImage >= m\_imagesResized.size()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00155       \}}
\DoxyCodeLine{00156       column = 0;}
\DoxyCodeLine{00157       row++;}
\DoxyCodeLine{00158       \textcolor{keywordflow}{if} (currentImage >= m\_imagesResized.size()) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00159     \}}
\DoxyCodeLine{00160     painter.end();}
\DoxyCodeLine{00161     QString path = m\_path.getQString();}
\DoxyCodeLine{00162     path         = path.replace(\textcolor{stringliteral}{"{}.spritesheet"{}}, \textcolor{stringliteral}{"{}.png"{}});}
\DoxyCodeLine{00163     spriteSheet.save(path, \textcolor{stringliteral}{"{}PNG"{}}, -\/1);}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165     path = path.replace(\textcolor{stringliteral}{"{}.png"{}}, \textcolor{stringliteral}{"{}.txt"{}});}
\DoxyCodeLine{00166     QFile file(path);}
\DoxyCodeLine{00167     file.open(QIODevice::WriteOnly | QIODevice::Text);}
\DoxyCodeLine{00168     QTextStream out(\&file);}
\DoxyCodeLine{00169     out << \textcolor{stringliteral}{"{}Total Images: "{}} << m\_imagesResized.size() << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00170     out << \textcolor{stringliteral}{"{}Individual Image Width: "{}} << resizedWidth << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00171     out << \textcolor{stringliteral}{"{}Individual Image Height: "{}} << resizedHeight << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00172     out << \textcolor{stringliteral}{"{}Individual Image Width with Padding: "{}}}
\DoxyCodeLine{00173         << resizedWidth + horizPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00174     out << \textcolor{stringliteral}{"{}Individual Image Height with Padding: "{}}}
\DoxyCodeLine{00175         << resizedHeight + vertPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00176     out << \textcolor{stringliteral}{"{}Images Across: "{}} << horizDim << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00177     out << \textcolor{stringliteral}{"{}Images Down : "{}} << vertDim << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00178     out << \textcolor{stringliteral}{"{}Top Padding: "{}} << m\_topPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00179     out << \textcolor{stringliteral}{"{}Bottom Padding: "{}} << m\_bottomPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00180     out << \textcolor{stringliteral}{"{}Left Padding: "{}} << m\_leftPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00181     out << \textcolor{stringliteral}{"{}Right Padding: "{}} << m\_rightPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00182     out << \textcolor{stringliteral}{"{}Horizontal Space Between Images: "{}} << horizPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00183     out << \textcolor{stringliteral}{"{}Vertical Space Between Images: "{}} << vertPadding << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00184 }
\DoxyCodeLine{00185     file.close();}
\DoxyCodeLine{00186   \}}
\DoxyCodeLine{00187   m\_imagesResized.clear();}
\DoxyCodeLine{00188 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_level_writer_sprite_ae0e957867bb6cc7c14e1cd22b6024636}\label{class_t_level_writer_sprite_ae0e957867bb6cc7c14e1cd22b6024636}} 
\index{TLevelWriterSprite@{TLevelWriterSprite}!create@{create}}
\index{create@{create}!TLevelWriterSprite@{TLevelWriterSprite}}
\doxysubsubsection{\texorpdfstring{create()}{create()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ TLevel\+Writer\+Sprite\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{path,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00031                                                                             \{}
\DoxyCodeLine{00032     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_level_writer_sprite}{TLevelWriterSprite}}(path, winfo);}
\DoxyCodeLine{00033   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_sprite_a4ae49cfd956c8b8adbc28b0cdd452e05}\label{class_t_level_writer_sprite_a4ae49cfd956c8b8adbc28b0cdd452e05}} 
\index{TLevelWriterSprite@{TLevelWriterSprite}!getFrameWriter@{getFrameWriter}}
\index{getFrameWriter@{getFrameWriter}!TLevelWriterSprite@{TLevelWriterSprite}}
\doxysubsubsection{\texorpdfstring{getFrameWriter()}{getFrameWriter()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} TLevel\+Writer\+Sprite\+::get\+Frame\+Writer (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}}}]{fid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00192                                                              \{}
\DoxyCodeLine{00193   \textcolor{keywordflow}{if} (!fid.getLetter().isEmpty()) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_image_writer_p}{TImageWriterP}}(0);}
\DoxyCodeLine{00194   \textcolor{keywordtype}{int} index               = fid.getNumber();}
\DoxyCodeLine{00195   \mbox{\hyperlink{class_t_image_writer_sprite}{TImageWriterSprite}} *iwg = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_image_writer_sprite}{TImageWriterSprite}}(m\_path, index, \textcolor{keyword}{this});}
\DoxyCodeLine{00196   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_image_writer_p}{TImageWriterP}}(iwg);}
\DoxyCodeLine{00197 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_sprite_af414f77c45ee028c080da1e0258d1fd0}\label{class_t_level_writer_sprite_af414f77c45ee028c080da1e0258d1fd0}} 
\index{TLevelWriterSprite@{TLevelWriterSprite}!save@{save}}
\index{save@{save}!TLevelWriterSprite@{TLevelWriterSprite}}
\doxysubsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily void TLevel\+Writer\+Sprite\+::save (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&}]{image,  }\item[{int}]{frame\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00206                                                                 \{}
\DoxyCodeLine{00207   m\_frameIndexOrder.push\_back(frameIndex);}
\DoxyCodeLine{00208   std::sort(m\_frameIndexOrder.begin(), m\_frameIndexOrder.end());}
\DoxyCodeLine{00209   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} tempImage(img);}
\DoxyCodeLine{00210   \mbox{\hyperlink{class_t_raster_image}{TRasterImage}} *image = (\mbox{\hyperlink{class_t_raster_image}{TRasterImage}} *)tempImage-\/>\mbox{\hyperlink{class_t_image_a3632b96b398057030a4adfe6917d2e28}{cloneImage}}();}
\DoxyCodeLine{00211 }
\DoxyCodeLine{00212   m\_lx           = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>getLx();}
\DoxyCodeLine{00213   m\_ly           = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>getLy();}
\DoxyCodeLine{00214   \textcolor{keywordtype}{int} m\_bpp      = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>getPixelSize();}
\DoxyCodeLine{00215   \textcolor{keywordtype}{int} totalBytes = m\_lx * m\_ly * m\_bpp;}
\DoxyCodeLine{00216   image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>yMirror();}
\DoxyCodeLine{00217 }
\DoxyCodeLine{00218   \textcolor{comment}{// lock raster to get data}}
\DoxyCodeLine{00219   image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>lock();}
\DoxyCodeLine{00220   \textcolor{keywordtype}{void} *buffin = image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}();}
\DoxyCodeLine{00221   assert(buffin);}
\DoxyCodeLine{00222   \textcolor{keywordtype}{void} *buffer = malloc(totalBytes);}
\DoxyCodeLine{00223   memcpy(buffer, buffin, totalBytes);}
\DoxyCodeLine{00224 }
\DoxyCodeLine{00225   image-\/>\mbox{\hyperlink{class_t_raster_image_a1ebe3badeaf79a61ef63c89aacf03980}{getRaster}}()-\/>unlock();}
\DoxyCodeLine{00226 }
\DoxyCodeLine{00227   \textcolor{comment}{// create QImage save format}}
\DoxyCodeLine{00228   QString m\_intermediateFormat = \textcolor{stringliteral}{"{}png"{}};}
\DoxyCodeLine{00229   QByteArray ba                = m\_intermediateFormat.toUpper().toLatin1();}
\DoxyCodeLine{00230   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *format           = ba.data();}
\DoxyCodeLine{00231 }
\DoxyCodeLine{00232   QImage *qi = \textcolor{keyword}{new} QImage((uint8\_t *)buffer, m\_lx, m\_ly,}
\DoxyCodeLine{00233                           QImage::Format\_ARGB32\_Premultiplied);}
\DoxyCodeLine{00234 }
\DoxyCodeLine{00235   \textcolor{keywordtype}{int} l = qi-\/>width(), r = 0, t = qi-\/>height(), b = 0;}
\DoxyCodeLine{00236   \textcolor{keywordflow}{if} (m\_trim) \{}
\DoxyCodeLine{00237     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y = 0; y < qi-\/>height(); ++y) \{}
\DoxyCodeLine{00238       QRgb *row      = (QRgb *)qi-\/>scanLine(y);}
\DoxyCodeLine{00239       \textcolor{keywordtype}{bool} rowFilled = \textcolor{keyword}{false};}
\DoxyCodeLine{00240       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} x = 0; x < qi-\/>width(); ++x) \{}
\DoxyCodeLine{00241         \textcolor{keywordflow}{if} (qAlpha(row[x])) \{}
\DoxyCodeLine{00242           rowFilled = \textcolor{keyword}{true};}
\DoxyCodeLine{00243           r         = std::max(r, x);}
\DoxyCodeLine{00244           \textcolor{keywordflow}{if} (l > x) \{}
\DoxyCodeLine{00245             l = x;}
\DoxyCodeLine{00246             x = r;}
\DoxyCodeLine{00247           \}}
\DoxyCodeLine{00248         \}}
\DoxyCodeLine{00249       \}}
\DoxyCodeLine{00250       \textcolor{keywordflow}{if} (rowFilled) \{}
\DoxyCodeLine{00251         t = std::min(t, y);}
\DoxyCodeLine{00252         b = y;}
\DoxyCodeLine{00253       \}}
\DoxyCodeLine{00254     \}}
\DoxyCodeLine{00255   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00256     l = 0;}
\DoxyCodeLine{00257     r = qi-\/>width() -\/ 1;}
\DoxyCodeLine{00258     t = 0;}
\DoxyCodeLine{00259     b = qi-\/>height() -\/ 1;}
\DoxyCodeLine{00260   \}}
\DoxyCodeLine{00261   \textcolor{keywordflow}{if} (m\_firstPass) \{}
\DoxyCodeLine{00262     m\_firstPass = \textcolor{keyword}{false};}
\DoxyCodeLine{00263     m\_left      = l;}
\DoxyCodeLine{00264     m\_right     = r;}
\DoxyCodeLine{00265     m\_top       = t;}
\DoxyCodeLine{00266     m\_bottom    = b;}
\DoxyCodeLine{00267   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00268     \textcolor{keywordflow}{if} (l < m\_left) m\_left = l;}
\DoxyCodeLine{00269     \textcolor{keywordflow}{if} (r > m\_right) m\_right = r;}
\DoxyCodeLine{00270     \textcolor{keywordflow}{if} (t < m\_top) m\_top = t;}
\DoxyCodeLine{00271     \textcolor{keywordflow}{if} (b > m\_bottom) m\_bottom = b;}
\DoxyCodeLine{00272   \}}
\DoxyCodeLine{00273   QImage *newQi = \textcolor{keyword}{new} QImage(m\_lx, m\_ly, QImage::Format\_ARGB32\_Premultiplied);}
\DoxyCodeLine{00274   newQi-\/>fill(qRgba(0, 0, 0, 0));}
\DoxyCodeLine{00275   QPainter painter(newQi);}
\DoxyCodeLine{00276   painter.drawImage(QPoint(0, 0), *qi);}
\DoxyCodeLine{00277 }
\DoxyCodeLine{00278   \textcolor{comment}{// Make sure to order the images according to their frame index}}
\DoxyCodeLine{00279   \textcolor{comment}{// Not just what comes out first}}
\DoxyCodeLine{00280   std::vector<int>::iterator it;}
\DoxyCodeLine{00281   it = find(m\_frameIndexOrder.begin(), m\_frameIndexOrder.end(), frameIndex);}
\DoxyCodeLine{00282   \textcolor{keywordtype}{int} pos = std::distance(m\_frameIndexOrder.begin(), it);}
\DoxyCodeLine{00283 }
\DoxyCodeLine{00284   m\_images.insert(m\_images.begin() + pos, newQi);}
\DoxyCodeLine{00285   \textcolor{keyword}{delete} image;}
\DoxyCodeLine{00286   \textcolor{keyword}{delete} qi;}
\DoxyCodeLine{00287   free(buffer);}
\DoxyCodeLine{00288 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_sprite_a9f3a20c81c31ef1abda2161f848c7025}\label{class_t_level_writer_sprite_a9f3a20c81c31ef1abda2161f848c7025}} 
\index{TLevelWriterSprite@{TLevelWriterSprite}!saveSoundTrack@{saveSoundTrack}}
\index{saveSoundTrack@{saveSoundTrack}!TLevelWriterSprite@{TLevelWriterSprite}}
\doxysubsubsection{\texorpdfstring{saveSoundTrack()}{saveSoundTrack()}}
{\footnotesize\ttfamily void TLevel\+Writer\+Sprite\+::save\+Sound\+Track (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$}]{st }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00202 \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_sprite_a39716423760394fce06d154bb8c5db7e}\label{class_t_level_writer_sprite_a39716423760394fce06d154bb8c5db7e}} 
\index{TLevelWriterSprite@{TLevelWriterSprite}!setFrameRate@{setFrameRate}}
\index{setFrameRate@{setFrameRate}!TLevelWriterSprite@{TLevelWriterSprite}}
\doxysubsubsection{\texorpdfstring{setFrameRate()}{setFrameRate()}}
{\footnotesize\ttfamily void TLevel\+Writer\+Sprite\+::set\+Frame\+Rate (\begin{DoxyParamCaption}\item[{double}]{fps }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00200 \{\}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/image/sprite/tiio\+\_\+sprite.\+h\item 
E\+:/opentoonz/toonz/sources/image/sprite/tiio\+\_\+sprite.\+cpp\end{DoxyCompactItemize}
