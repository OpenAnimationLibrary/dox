\hypertarget{class_t_sound_track_reader_aiff}{}\doxysection{TSound\+Track\+Reader\+Aiff Class Reference}
\label{class_t_sound_track_reader_aiff}\index{TSoundTrackReaderAiff@{TSoundTrackReaderAiff}}


{\ttfamily \#include $<$tsio\+\_\+aiff.\+h$>$}

Inheritance diagram for TSound\+Track\+Reader\+Aiff\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_sound_track_reader_aiff}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_sound_track_reader_aiff_a56144cf1267c4bef2441a4db3787cd9b}{TSound\+Track\+Reader\+Aiff}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \mbox{\hyperlink{class_t_sound_track_reader_aiff_a0d513410058e6de6bfd4f85e95bbf8a6}{load}} () override
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_sound_track_reader}{TSound\+Track\+Reader}} $\ast$ \mbox{\hyperlink{class_t_sound_track_reader_aiff_a76003729d5ee946841985cf39f2642c5}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
The class \mbox{\hyperlink{class_t_sound_track_reader_aiff}{TSound\+Track\+Reader\+Aiff}} reads audio files having .aiff extension 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_sound_track_reader_aiff_a56144cf1267c4bef2441a4db3787cd9b}\label{class_t_sound_track_reader_aiff_a56144cf1267c4bef2441a4db3787cd9b}} 
\index{TSoundTrackReaderAiff@{TSoundTrackReaderAiff}!TSoundTrackReaderAiff@{TSoundTrackReaderAiff}}
\index{TSoundTrackReaderAiff@{TSoundTrackReaderAiff}!TSoundTrackReaderAiff@{TSoundTrackReaderAiff}}
\doxysubsubsection{\texorpdfstring{TSoundTrackReaderAiff()}{TSoundTrackReaderAiff()}}
{\footnotesize\ttfamily TSound\+Track\+Reader\+Aiff\+::\+TSound\+Track\+Reader\+Aiff (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00285     : \mbox{\hyperlink{class_t_sound_track_reader}{TSoundTrackReader}}(fp) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_track_reader_aiff_ac1df8aa34ef4f1c482e796ab9b655561}\label{class_t_sound_track_reader_aiff_ac1df8aa34ef4f1c482e796ab9b655561}} 
\index{TSoundTrackReaderAiff@{TSoundTrackReaderAiff}!````~TSoundTrackReaderAiff@{$\sim$TSoundTrackReaderAiff}}
\index{````~TSoundTrackReaderAiff@{$\sim$TSoundTrackReaderAiff}!TSoundTrackReaderAiff@{TSoundTrackReaderAiff}}
\doxysubsubsection{\texorpdfstring{$\sim$TSoundTrackReaderAiff()}{~TSoundTrackReaderAiff()}}
{\footnotesize\ttfamily TSound\+Track\+Reader\+Aiff\+::$\sim$\+TSound\+Track\+Reader\+Aiff (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00017 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_sound_track_reader_aiff_a76003729d5ee946841985cf39f2642c5}\label{class_t_sound_track_reader_aiff_a76003729d5ee946841985cf39f2642c5}} 
\index{TSoundTrackReaderAiff@{TSoundTrackReaderAiff}!create@{create}}
\index{create@{create}!TSoundTrackReaderAiff@{TSoundTrackReaderAiff}}
\doxysubsubsection{\texorpdfstring{create()}{create()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_sound_track_reader}{TSound\+Track\+Reader}} $\ast$ TSound\+Track\+Reader\+Aiff\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}

Returns a soundtrack reader able to read .aiff audio files 
\begin{DoxyCode}{0}
\DoxyCodeLine{00028                                                         \{}
\DoxyCodeLine{00029     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_reader_aiff}{TSoundTrackReaderAiff}}(fp);}
\DoxyCodeLine{00030   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_track_reader_aiff_a0d513410058e6de6bfd4f85e95bbf8a6}\label{class_t_sound_track_reader_aiff_a0d513410058e6de6bfd4f85e95bbf8a6}} 
\index{TSoundTrackReaderAiff@{TSoundTrackReaderAiff}!load@{load}}
\index{load@{load}!TSoundTrackReaderAiff@{TSoundTrackReaderAiff}}
\doxysubsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} TSound\+Track\+Reader\+Aiff\+::load (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Loads the .aiff audio file whose path has been specified in the constructor. It returns a TSound\+TrackP created from the audio file 

Implements \mbox{\hyperlink{class_t_sound_track_reader}{TSound\+Track\+Reader}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00289                                          \{}
\DoxyCodeLine{00290   \textcolor{keywordtype}{char} ckID[5];}
\DoxyCodeLine{00291   \textcolor{keywordtype}{char} formType[5];}
\DoxyCodeLine{00292   TINT32 ckSize;}
\DoxyCodeLine{00293 }
\DoxyCodeLine{00294   \mbox{\hyperlink{class_tifstream}{Tifstream}} is(m\_path);}
\DoxyCodeLine{00295 }
\DoxyCodeLine{00296   \textcolor{keywordflow}{if} (!is)}
\DoxyCodeLine{00297     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(L\textcolor{stringliteral}{"{}Unable to load the AIFF file "{}} + m\_path.getWideString() +}
\DoxyCodeLine{00298                      L\textcolor{stringliteral}{"{} : doesn't exist"{}});}
\DoxyCodeLine{00299 }
\DoxyCodeLine{00300   \textcolor{comment}{// legge il chunk ID}}
\DoxyCodeLine{00301   is.read((\textcolor{keywordtype}{char} *)\&ckID, \textcolor{keyword}{sizeof}(ckID) -\/ 1);}
\DoxyCodeLine{00302   ckID[4] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00303 }
\DoxyCodeLine{00304   \textcolor{comment}{// legge il chunk Size}}
\DoxyCodeLine{00305   is.read((\textcolor{keywordtype}{char} *)\&ckSize, \textcolor{keyword}{sizeof}(ckSize));}
\DoxyCodeLine{00306 }
\DoxyCodeLine{00307   \textcolor{keywordflow}{if} (TNZ\_LITTLE\_ENDIAN) ckSize = swapTINT32(ckSize);}
\DoxyCodeLine{00308 }
\DoxyCodeLine{00309   \textcolor{comment}{// legge il formType}}
\DoxyCodeLine{00310   is.read((\textcolor{keywordtype}{char} *)\&formType, \textcolor{keyword}{sizeof}(formType) -\/ 1);}
\DoxyCodeLine{00311   formType[4] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00312 }
\DoxyCodeLine{00313   \textcolor{comment}{// il formType DEVE essere uguale a "{}AIFF"{}}}
\DoxyCodeLine{00314   \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{string}(formType, 4) != \textcolor{stringliteral}{"{}AIFF"{}}))}
\DoxyCodeLine{00315     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}The AIFF file doesn't contain the AIFF form"{}});}
\DoxyCodeLine{00316 }
\DoxyCodeLine{00317   \mbox{\hyperlink{class_t_c_o_m_m_chunk}{TCOMMChunk}} *commChunk = 0;}
\DoxyCodeLine{00318   \mbox{\hyperlink{class_t_s_s_n_d_chunk}{TSSNDChunk}} *ssndChunk = 0;}
\DoxyCodeLine{00319 }
\DoxyCodeLine{00320   \textcolor{keywordflow}{while} (!is.eof()) \{}
\DoxyCodeLine{00321     \textcolor{keywordtype}{string} name;}
\DoxyCodeLine{00322     TINT32 length;}
\DoxyCodeLine{00323 }
\DoxyCodeLine{00324     \textcolor{keywordtype}{bool} ret = TAIFFChunk::readHeader(is, name, length);}
\DoxyCodeLine{00325 }
\DoxyCodeLine{00326     \textcolor{keywordflow}{if} (!ret) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00327 }
\DoxyCodeLine{00328     \textcolor{comment}{// legge solo i chunk che ci interessano, ossia COMM e SSND}}
\DoxyCodeLine{00329 }
\DoxyCodeLine{00330     \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"{}COMM"{}}) \{}
\DoxyCodeLine{00331       \textcolor{comment}{// legge i dati del chunk COMM}}
\DoxyCodeLine{00332       commChunk = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_c_o_m_m_chunk}{TCOMMChunk}}(\textcolor{stringliteral}{"{}COMM"{}}, length);}
\DoxyCodeLine{00333       commChunk-\/>read(is);}
\DoxyCodeLine{00334 }
\DoxyCodeLine{00335       \textcolor{comment}{// considera il byte di pad alla fine del chunk nel caso}}
\DoxyCodeLine{00336       \textcolor{comment}{// in cui la lunghezza di questi e' dispari}}
\DoxyCodeLine{00337       \textcolor{keywordflow}{if} (length \% 2) is.seekg((TINT32)is.tellg() + 1);}
\DoxyCodeLine{00338     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"{}SSND"{}}) \{}
\DoxyCodeLine{00339       \textcolor{comment}{// legge i dati del chunk SSND}}
\DoxyCodeLine{00340       ssndChunk = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_s_s_n_d_chunk}{TSSNDChunk}}(\textcolor{stringliteral}{"{}SSND"{}}, length);}
\DoxyCodeLine{00341       ssndChunk-\/>read(is);}
\DoxyCodeLine{00342 }
\DoxyCodeLine{00343       \textcolor{comment}{// considera il byte di pad alla fine del chunk nel caso}}
\DoxyCodeLine{00344       \textcolor{comment}{// in cui la lunghezza di questi e' dispari}}
\DoxyCodeLine{00345       \textcolor{keywordflow}{if} (length \% 2) is.seekg((TINT32)is.tellg() + 1);}
\DoxyCodeLine{00346     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00347       \textcolor{comment}{// spostati nello stream di un numero di byte pari a length}}
\DoxyCodeLine{00348       \textcolor{keywordflow}{if} (!(length \% 2))}
\DoxyCodeLine{00349         is.seekg((TINT32)is.tellg() + length);}
\DoxyCodeLine{00350       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00351         is.seekg((TINT32)is.tellg() + (TINT32)length + 1);}
\DoxyCodeLine{00352     \}}
\DoxyCodeLine{00353   \}}
\DoxyCodeLine{00354 }
\DoxyCodeLine{00355   \mbox{\hyperlink{class_t_sound_track}{TSoundTrack}} *track = 0;}
\DoxyCodeLine{00356 }
\DoxyCodeLine{00357   \textcolor{keywordflow}{if} (commChunk \&\& ssndChunk) \{}
\DoxyCodeLine{00358     \textcolor{keywordflow}{if} (commChunk-\/>m\_chans < 1)}
\DoxyCodeLine{00359       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}Invalid channels number in sound file"{}});}
\DoxyCodeLine{00360 }
\DoxyCodeLine{00361     \textcolor{keywordflow}{if} (commChunk-\/>m\_chans > 2)}
\DoxyCodeLine{00362       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}Unsupported channels number in sound file"{}});}
\DoxyCodeLine{00363 }
\DoxyCodeLine{00364     \textcolor{keywordflow}{switch} (commChunk-\/>m\_bitPerSample) \{}
\DoxyCodeLine{00365     \textcolor{keywordflow}{case} 8:}
\DoxyCodeLine{00366       \textcolor{keywordflow}{if} (commChunk-\/>m\_chans == 1)}
\DoxyCodeLine{00367         track = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_t}{TSoundTrackMono8Signed}}(commChunk-\/>m\_sampleRate, 1,}
\DoxyCodeLine{00368                                            (TINT32)commChunk-\/>m\_frames);}
\DoxyCodeLine{00369       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00370         track = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_t}{TSoundTrackStereo8Signed}}(commChunk-\/>m\_sampleRate, 2,}
\DoxyCodeLine{00371                                              (TINT32)commChunk-\/>m\_frames);}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373       memcpy((\textcolor{keywordtype}{void} *)track-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(),}
\DoxyCodeLine{00374              (\textcolor{keywordtype}{void} *)(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset),}
\DoxyCodeLine{00375              commChunk-\/>m\_frames * commChunk-\/>m\_chans);}
\DoxyCodeLine{00376       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378     \textcolor{keywordflow}{case} 16:}
\DoxyCodeLine{00379       \textcolor{keywordflow}{if} (commChunk-\/>m\_chans == 1)}
\DoxyCodeLine{00380         track = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_t}{TSoundTrackMono16}}(commChunk-\/>m\_sampleRate, 1,}
\DoxyCodeLine{00381                                       (TINT32)commChunk-\/>m\_frames);}
\DoxyCodeLine{00382       \textcolor{keywordflow}{else}  \textcolor{comment}{// due canali}}
\DoxyCodeLine{00383         track = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_t}{TSoundTrackStereo16}}(commChunk-\/>m\_sampleRate, 2,}
\DoxyCodeLine{00384                                         (TINT32)commChunk-\/>m\_frames);}
\DoxyCodeLine{00385 }
\DoxyCodeLine{00386       \textcolor{keywordflow}{if} (!TNZ\_LITTLE\_ENDIAN)}
\DoxyCodeLine{00387         memcpy((\textcolor{keywordtype}{void} *)track-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(),}
\DoxyCodeLine{00388                (\textcolor{keywordtype}{void} *)(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset),}
\DoxyCodeLine{00389                commChunk-\/>m\_frames * track-\/>getSampleSize());}
\DoxyCodeLine{00390       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00391         swapAndCopySamples(}
\DoxyCodeLine{00392             (\textcolor{keywordtype}{short} *)(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset),}
\DoxyCodeLine{00393             (\textcolor{keywordtype}{short} *)track-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(),}
\DoxyCodeLine{00394             (TINT32)(commChunk-\/>m\_frames * commChunk-\/>m\_chans));}
\DoxyCodeLine{00395       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00396 }
\DoxyCodeLine{00397     \textcolor{keywordflow}{case} 24:}
\DoxyCodeLine{00398       \textcolor{keywordflow}{if} (commChunk-\/>m\_chans == 1)}
\DoxyCodeLine{00399         track = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_t}{TSoundTrackMono24}}(commChunk-\/>m\_sampleRate, 1,}
\DoxyCodeLine{00400                                       (TINT32)commChunk-\/>m\_frames);}
\DoxyCodeLine{00401       \textcolor{keywordflow}{else}  \textcolor{comment}{// due canali}}
\DoxyCodeLine{00402         track = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_t}{TSoundTrackStereo24}}(commChunk-\/>m\_sampleRate, 2,}
\DoxyCodeLine{00403                                         (TINT32)commChunk-\/>m\_frames);}
\DoxyCodeLine{00404 }
\DoxyCodeLine{00405       \textcolor{keywordflow}{if} (!TNZ\_LITTLE\_ENDIAN) \{}
\DoxyCodeLine{00406         UCHAR *begin = (UCHAR *)track-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00407         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)(commChunk-\/>m\_frames * commChunk-\/>m\_chans);}
\DoxyCodeLine{00408              ++i) \{  \textcolor{comment}{// dovrebbe andare bene anche adesso}}
\DoxyCodeLine{00409           *(begin + 4 * i) = 0;}
\DoxyCodeLine{00410           *(begin + 4 * i + 1) =}
\DoxyCodeLine{00411               *(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset + 3 * i);}
\DoxyCodeLine{00412           *(begin + 4 * i + 2) =}
\DoxyCodeLine{00413               *(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset + 3 * i + 1);}
\DoxyCodeLine{00414           *(begin + 4 * i + 3) =}
\DoxyCodeLine{00415               *(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset + 3 * i + 2);}
\DoxyCodeLine{00416         \}}
\DoxyCodeLine{00417       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00418         UCHAR *begin = (UCHAR *)track-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00419         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)(commChunk-\/>m\_frames * commChunk-\/>m\_chans);}
\DoxyCodeLine{00420              ++i) \{}
\DoxyCodeLine{00421           *(begin + 4 * i) =}
\DoxyCodeLine{00422               *(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset + 3 * i + 2);}
\DoxyCodeLine{00423           *(begin + 4 * i + 1) =}
\DoxyCodeLine{00424               *(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset + 3 * i + 1);}
\DoxyCodeLine{00425           *(begin + 4 * i + 2) =}
\DoxyCodeLine{00426               *(ssndChunk-\/>m\_waveData.get() + ssndChunk-\/>m\_offset + 3 * i);}
\DoxyCodeLine{00427           *(begin + 4 * i + 3) = 0;}
\DoxyCodeLine{00428 }
\DoxyCodeLine{00429           \textcolor{comment}{/*}}
\DoxyCodeLine{00430 \textcolor{comment}{*(begin + 4*i) = 0;}}
\DoxyCodeLine{00431 \textcolor{comment}{*(begin + 4*i + 3) =}}
\DoxyCodeLine{00432 \textcolor{comment}{*(ssndChunk-\/>m\_waveData+ssndChunk-\/>m\_offset + 3*i + 2);}}
\DoxyCodeLine{00433 \textcolor{comment}{}}
\DoxyCodeLine{00434 \textcolor{comment}{// sono i due byte che vengono invertiti}}
\DoxyCodeLine{00435 \textcolor{comment}{*(begin + 4*i + 1) =}}
\DoxyCodeLine{00436 \textcolor{comment}{*(ssndChunk-\/>m\_waveData+ssndChunk-\/>m\_offset + 3*i + 1);}}
\DoxyCodeLine{00437 \textcolor{comment}{*(begin + 4*i + 2) =}}
\DoxyCodeLine{00438 \textcolor{comment}{*(ssndChunk-\/>m\_waveData+ssndChunk-\/>m\_offset + 3*i);}}
\DoxyCodeLine{00439 \textcolor{comment}{*/}}
\DoxyCodeLine{00440         \}}
\DoxyCodeLine{00441       \}}
\DoxyCodeLine{00442       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00443     \}}
\DoxyCodeLine{00444 }
\DoxyCodeLine{00445     \textcolor{keywordflow}{if} (commChunk) \textcolor{keyword}{delete} commChunk;}
\DoxyCodeLine{00446     \textcolor{keywordflow}{if} (ssndChunk) \textcolor{keyword}{delete} ssndChunk;}
\DoxyCodeLine{00447   \}}
\DoxyCodeLine{00448 }
\DoxyCodeLine{00449   \textcolor{keywordflow}{return} track;}
\DoxyCodeLine{00450 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00150}{TSound\+Track\+::get\+Raw\+Data()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/sound/aiff/tsio\+\_\+aiff.\+h\item 
E\+:/opentoonz/toonz/sources/sound/aiff/tsio\+\_\+aiff.\+cpp\end{DoxyCompactItemize}
