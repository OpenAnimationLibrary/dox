\hypertarget{class_t_raster_codec_lz4}{}\doxysection{TRaster\+Codec\+Lz4 Class Reference}
\label{class_t_raster_codec_lz4}\index{TRasterCodecLz4@{TRasterCodecLz4}}
Inheritance diagram for TRaster\+Codec\+Lz4\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_raster_codec_lz4}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_raster_codec_lz4_aab254738f17149bab25b6288df847bf3}{TRaster\+Codec\+Lz4}} (const std\+::string \&name, bool use\+Cache)
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \mbox{\hyperlink{class_t_raster_codec_lz4_ada0fc2cf62b521a4fb88b2dfe114abf1}{compress}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&in\+Ras, int alloc\+Unit, TINT32 \&out\+Data\+Size)
\item 
bool \mbox{\hyperlink{class_t_raster_codec_lz4_af68b2080eefe8befb8fad5a6d2478407}{decompress}} (const UCHAR $\ast$in\+Data, TINT32 in\+Data\+Size, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&out\+Ras, bool safe\+Mode)
\item 
void \mbox{\hyperlink{class_t_raster_codec_lz4_acbfa8d353d1a26c73c49664ca41a648c}{decompress}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&compressed\+Ras, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&out\+Ras)
\item 
void \mbox{\hyperlink{class_t_raster_codec_lz4_a0c924fe024b4a3c55b897c080e8c193b}{reset}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_raster_codec_lz4_aab254738f17149bab25b6288df847bf3}\label{class_t_raster_codec_lz4_aab254738f17149bab25b6288df847bf3}} 
\index{TRasterCodecLz4@{TRasterCodecLz4}!TRasterCodecLz4@{TRasterCodecLz4}}
\index{TRasterCodecLz4@{TRasterCodecLz4}!TRasterCodecLz4@{TRasterCodecLz4}}
\doxysubsubsection{\texorpdfstring{TRasterCodecLz4()}{TRasterCodecLz4()}}
{\footnotesize\ttfamily TRaster\+Codec\+Lz4\+::\+TRaster\+Codec\+Lz4 (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{name,  }\item[{bool}]{use\+Cache }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00381     : \mbox{\hyperlink{class_t_raster_codec}{TRasterCodec}}(name), m\_raster(), m\_useCache(useCache), m\_cacheId(\textcolor{stringliteral}{"{}"{}}) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_lz4_a84d4adf643a45b6da49f564840b22daa}\label{class_t_raster_codec_lz4_a84d4adf643a45b6da49f564840b22daa}} 
\index{TRasterCodecLz4@{TRasterCodecLz4}!````~TRasterCodecLz4@{$\sim$TRasterCodecLz4}}
\index{````~TRasterCodecLz4@{$\sim$TRasterCodecLz4}!TRasterCodecLz4@{TRasterCodecLz4}}
\doxysubsubsection{\texorpdfstring{$\sim$TRasterCodecLz4()}{~TRasterCodecLz4()}}
{\footnotesize\ttfamily TRaster\+Codec\+Lz4\+::$\sim$\+TRaster\+Codec\+Lz4 (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00385                                   \{}
\DoxyCodeLine{00386   \textcolor{keywordflow}{if} (m\_useCache)}
\DoxyCodeLine{00387     TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove}}(m\_cacheId);}
\DoxyCodeLine{00388   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00389     m\_raster = \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}}();}
\DoxyCodeLine{00390 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_raster_codec_lz4_ada0fc2cf62b521a4fb88b2dfe114abf1}\label{class_t_raster_codec_lz4_ada0fc2cf62b521a4fb88b2dfe114abf1}} 
\index{TRasterCodecLz4@{TRasterCodecLz4}!compress@{compress}}
\index{compress@{compress}!TRasterCodecLz4@{TRasterCodecLz4}}
\doxysubsubsection{\texorpdfstring{compress()}{compress()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} TRaster\+Codec\+Lz4\+::compress (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{in\+Ras,  }\item[{int}]{alloc\+Unit,  }\item[{TINT32 \&}]{out\+Data\+Size }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00443                                                         \{}
\DoxyCodeLine{00444   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} rasOut;}
\DoxyCodeLine{00445   UINT outSize = doCompress(inRas, allocUnit, rasOut);}
\DoxyCodeLine{00446   \textcolor{keywordflow}{if} (outSize == 0) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00447 }
\DoxyCodeLine{00448   UINT headerSize = \textcolor{keyword}{sizeof}(Header);}
\DoxyCodeLine{00449   \textcolor{keywordflow}{if} (TBigMemoryManager::instance()-\/>isActive() \&\&}
\DoxyCodeLine{00450       TBigMemoryManager::instance()-\/>getAvailableMemoryinKb() <}
\DoxyCodeLine{00451           ((outSize + headerSize) >> 10))}
\DoxyCodeLine{00452     \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00453 }
\DoxyCodeLine{00454   \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}} r8(outSize + headerSize, 1);}
\DoxyCodeLine{00455   r8-\/>lock();}
\DoxyCodeLine{00456   UCHAR *memoryChunk = r8-\/>getRawData();}
\DoxyCodeLine{00457   \textcolor{keywordflow}{if} (!memoryChunk) \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}();}
\DoxyCodeLine{00458   Header head(inRas);}
\DoxyCodeLine{00459 }
\DoxyCodeLine{00460   memcpy(memoryChunk, \&head, headerSize);}
\DoxyCodeLine{00461   UCHAR *tmp = memoryChunk + headerSize;}
\DoxyCodeLine{00462   rasOut-\/>lock();}
\DoxyCodeLine{00463   memcpy(tmp, rasOut-\/>getRawData(), outSize);}
\DoxyCodeLine{00464   r8-\/>unlock();}
\DoxyCodeLine{00465   rasOut-\/>unlock();}
\DoxyCodeLine{00466   outDataSize = outSize + headerSize;}
\DoxyCodeLine{00467   \textcolor{keywordflow}{return} r8;}
\DoxyCodeLine{00468 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_lz4_acbfa8d353d1a26c73c49664ca41a648c}\label{class_t_raster_codec_lz4_acbfa8d353d1a26c73c49664ca41a648c}} 
\index{TRasterCodecLz4@{TRasterCodecLz4}!decompress@{decompress}}
\index{decompress@{decompress}!TRasterCodecLz4@{TRasterCodecLz4}}
\doxysubsubsection{\texorpdfstring{decompress()}{decompress()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void TRaster\+Codec\+Lz4\+::decompress (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{compressed\+Ras,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{out\+Ras }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00520                                                    \{}
\DoxyCodeLine{00521   \textcolor{keywordtype}{int} headerSize = \textcolor{keyword}{sizeof}(Header);}
\DoxyCodeLine{00522 }
\DoxyCodeLine{00523   assert(compressedRas-\/>getLy() == 1 \&\& compressedRas-\/>getPixelSize() == 1);}
\DoxyCodeLine{00524   UINT inDataSize = compressedRas-\/>getLx();}
\DoxyCodeLine{00525 }
\DoxyCodeLine{00526   compressedRas-\/>lock();}
\DoxyCodeLine{00527 }
\DoxyCodeLine{00528   UCHAR *inData = compressedRas-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}();}
\DoxyCodeLine{00529   Header header(inData);}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531   \textcolor{keywordflow}{if} (!outRas) \{}
\DoxyCodeLine{00532     outRas = header.createRaster();}
\DoxyCodeLine{00533     \textcolor{keywordflow}{if} (!outRas) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00534   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00535     \textcolor{keywordflow}{if} (outRas-\/>getLx() != outRas-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}()) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00536   \}}
\DoxyCodeLine{00537 }
\DoxyCodeLine{00538   LZ4F\_decompressionContext\_t lz4dctx;}
\DoxyCodeLine{00539 }
\DoxyCodeLine{00540   LZ4F\_errorCode\_t err =}
\DoxyCodeLine{00541       LZ4F\_createDecompressionContext(\&lz4dctx, LZ4F\_VERSION);}
\DoxyCodeLine{00542   \textcolor{keywordflow}{if} (LZ4F\_isError(err)) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}compress... something goes bad"{}});}
\DoxyCodeLine{00543 }
\DoxyCodeLine{00544   \textcolor{keywordtype}{int} outDataSize = header.getRasterSize();}
\DoxyCodeLine{00545 }
\DoxyCodeLine{00546   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *mc = (\textcolor{keyword}{const} \textcolor{keywordtype}{char} *)(inData + headerSize);}
\DoxyCodeLine{00547   \textcolor{keywordtype}{size\_t} ds      = inDataSize -\/ headerSize;}
\DoxyCodeLine{00548 }
\DoxyCodeLine{00549   \textcolor{keywordtype}{size\_t} outSize = outDataSize;}
\DoxyCodeLine{00550   \textcolor{keywordtype}{char} *outData  = (\textcolor{keywordtype}{char} *)outRas-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}();}
\DoxyCodeLine{00551 }
\DoxyCodeLine{00552   outRas-\/>lock();}
\DoxyCodeLine{00553 }
\DoxyCodeLine{00554   \textcolor{comment}{// err = LZ4F\_decompress(lz4dctx, outData, \&outSize, mc, \&ds, NULL);}}
\DoxyCodeLine{00555   \textcolor{keywordtype}{bool} ok = lz4decompress(lz4dctx, outData, \&outSize, mc, ds);}
\DoxyCodeLine{00556   LZ4F\_freeDecompressionContext(lz4dctx);}
\DoxyCodeLine{00557 }
\DoxyCodeLine{00558   outRas-\/>unlock();}
\DoxyCodeLine{00559   compressedRas-\/>unlock();}
\DoxyCodeLine{00560 }
\DoxyCodeLine{00561   \textcolor{keywordflow}{if} (!ok) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}decompress... something goes bad"{}});}
\DoxyCodeLine{00562 }
\DoxyCodeLine{00563   assert(outSize == (\textcolor{keywordtype}{size\_t})outDataSize);}
\DoxyCodeLine{00564 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_lz4_af68b2080eefe8befb8fad5a6d2478407}\label{class_t_raster_codec_lz4_af68b2080eefe8befb8fad5a6d2478407}} 
\index{TRasterCodecLz4@{TRasterCodecLz4}!decompress@{decompress}}
\index{decompress@{decompress}!TRasterCodecLz4@{TRasterCodecLz4}}
\doxysubsubsection{\texorpdfstring{decompress()}{decompress()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool TRaster\+Codec\+Lz4\+::decompress (\begin{DoxyParamCaption}\item[{const UCHAR $\ast$}]{in\+Data,  }\item[{TINT32}]{in\+Data\+Size,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \&}]{out\+Ras,  }\item[{bool}]{safe\+Mode }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00473                                                                   \{}
\DoxyCodeLine{00474   \textcolor{keywordtype}{int} headerSize = \textcolor{keyword}{sizeof}(Header);}
\DoxyCodeLine{00475 }
\DoxyCodeLine{00476   Header *header = (Header *)inData;}
\DoxyCodeLine{00477   \textcolor{keywordflow}{if} (!outRas) \{}
\DoxyCodeLine{00478     outRas = header-\/>createRaster();}
\DoxyCodeLine{00479     \textcolor{keywordflow}{if} (!outRas) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00480   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00481     \textcolor{keywordflow}{if} (outRas-\/>getLx() != outRas-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}()) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}();}
\DoxyCodeLine{00482   \}}
\DoxyCodeLine{00483 }
\DoxyCodeLine{00484   LZ4F\_decompressionContext\_t lz4dctx;}
\DoxyCodeLine{00485 }
\DoxyCodeLine{00486   LZ4F\_errorCode\_t err =}
\DoxyCodeLine{00487       LZ4F\_createDecompressionContext(\&lz4dctx, LZ4F\_VERSION);}
\DoxyCodeLine{00488   \textcolor{keywordflow}{if} (LZ4F\_isError(err)) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}compress... something goes bad"{}});}
\DoxyCodeLine{00489 }
\DoxyCodeLine{00490   \textcolor{keywordtype}{int} outDataSize = header-\/>getRasterSize();}
\DoxyCodeLine{00491 }
\DoxyCodeLine{00492   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *mc = (\textcolor{keyword}{const} \textcolor{keywordtype}{char} *)(inData + headerSize);}
\DoxyCodeLine{00493   \textcolor{keywordtype}{size\_t} ds      = inDataSize -\/ headerSize;}
\DoxyCodeLine{00494 }
\DoxyCodeLine{00495   \textcolor{keywordtype}{size\_t} outSize = outDataSize;}
\DoxyCodeLine{00496   \textcolor{keywordtype}{char} *outData  = (\textcolor{keywordtype}{char} *)outRas-\/>\mbox{\hyperlink{class_t_raster_a5ce02b7e8a5b8b594863aa272d8dcdbc}{getRawData}}();}
\DoxyCodeLine{00497 }
\DoxyCodeLine{00498   outRas-\/>lock();}
\DoxyCodeLine{00499   \textcolor{comment}{// err = LZ4F\_decompress(lz4dctx, outData, \&outSize, mc, \&ds, NULL);}}
\DoxyCodeLine{00500   \textcolor{keywordtype}{bool} ok = lz4decompress(lz4dctx, outData, \&outSize, mc, ds);}
\DoxyCodeLine{00501   LZ4F\_freeDecompressionContext(lz4dctx);}
\DoxyCodeLine{00502   outRas-\/>unlock();}
\DoxyCodeLine{00503 }
\DoxyCodeLine{00504   \textcolor{keywordflow}{if} (!ok) \{}
\DoxyCodeLine{00505     \textcolor{keywordflow}{if} (safeMode)}
\DoxyCodeLine{00506       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00507     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00508       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}decompress... something goes bad"{}});}
\DoxyCodeLine{00509       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00510     \}}
\DoxyCodeLine{00511   \}}
\DoxyCodeLine{00512 }
\DoxyCodeLine{00513   assert(outSize == (\textcolor{keywordtype}{size\_t})outDataSize);}
\DoxyCodeLine{00514   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00515 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_codec_lz4_a0c924fe024b4a3c55b897c080e8c193b}\label{class_t_raster_codec_lz4_a0c924fe024b4a3c55b897c080e8c193b}} 
\index{TRasterCodecLz4@{TRasterCodecLz4}!reset@{reset}}
\index{reset@{reset}!TRasterCodecLz4@{TRasterCodecLz4}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily void TRaster\+Codec\+Lz4\+::reset (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00120                \{}
\DoxyCodeLine{00121     \textcolor{keywordflow}{if} (m\_useCache) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00122     m\_raster = \mbox{\hyperlink{class_t_raster_p_t}{TRasterGR8P}}();}
\DoxyCodeLine{00123   \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tcodec.\+h\item 
E\+:/opentoonz/toonz/sources/common/trasterimage/tcodec.\+cpp\end{DoxyCompactItemize}
