\hypertarget{class_bmp_writer}{}\doxysection{Bmp\+Writer Class Reference}
\label{class_bmp_writer}\index{BmpWriter@{BmpWriter}}
Inheritance diagram for Bmp\+Writer\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_bmp_writer}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_bmp_writer_ab623df01175bd887ac2f1f0dae4236c8}{open}} (FILE $\ast$file, const \mbox{\hyperlink{class_t_image_info}{TImage\+Info}} \&info) override
\item 
void \mbox{\hyperlink{class_bmp_writer_adc485c910f799b8340604b17e8c9255f}{flush}} () override
\item 
void \mbox{\hyperlink{class_bmp_writer_a207e97e8265a24dba6c2e262c6dac09d}{write\+Line}} (char $\ast$buffer) override
\item 
bool \mbox{\hyperlink{class_bmp_writer_a3283b7ddd1ed3149836a90fef58d0b3a}{write\+Alpha\+Supported}} () const override
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_bmp_writer_a4ca23ef85aa9fca23b72c3842edcdd0d}\label{class_bmp_writer_a4ca23ef85aa9fca23b72c3842edcdd0d}} 
\index{BmpWriter@{BmpWriter}!BmpWriter@{BmpWriter}}
\index{BmpWriter@{BmpWriter}!BmpWriter@{BmpWriter}}
\doxysubsubsection{\texorpdfstring{BmpWriter()}{BmpWriter()}}
{\footnotesize\ttfamily Bmp\+Writer\+::\+Bmp\+Writer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00608 : m\_chan(0) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bmp_writer_a1d25596502bd6182b2dd42f89f4e6e57}\label{class_bmp_writer_a1d25596502bd6182b2dd42f89f4e6e57}} 
\index{BmpWriter@{BmpWriter}!````~BmpWriter@{$\sim$BmpWriter}}
\index{````~BmpWriter@{$\sim$BmpWriter}!BmpWriter@{BmpWriter}}
\doxysubsubsection{\texorpdfstring{$\sim$BmpWriter()}{~BmpWriter()}}
{\footnotesize\ttfamily Bmp\+Writer\+::$\sim$\+Bmp\+Writer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00612 \{ \textcolor{keyword}{delete} m\_properties; \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_bmp_writer_adc485c910f799b8340604b17e8c9255f}\label{class_bmp_writer_adc485c910f799b8340604b17e8c9255f}} 
\index{BmpWriter@{BmpWriter}!flush@{flush}}
\index{flush@{flush}!BmpWriter@{BmpWriter}}
\doxysubsubsection{\texorpdfstring{flush()}{flush()}}
{\footnotesize\ttfamily void Bmp\+Writer\+::flush (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_tiio_1_1_writer}{Tiio\+::\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00598 \{ fflush(m\_chan); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bmp_writer_ab623df01175bd887ac2f1f0dae4236c8}\label{class_bmp_writer_ab623df01175bd887ac2f1f0dae4236c8}} 
\index{BmpWriter@{BmpWriter}!open@{open}}
\index{open@{open}!BmpWriter@{BmpWriter}}
\doxysubsubsection{\texorpdfstring{open()}{open()}}
{\footnotesize\ttfamily void Bmp\+Writer\+::open (\begin{DoxyParamCaption}\item[{FILE $\ast$}]{file,  }\item[{const \mbox{\hyperlink{class_t_image_info}{TImage\+Info}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_tiio_1_1_writer}{Tiio\+::\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00616                                                        \{}
\DoxyCodeLine{00617   m\_chan = file;}
\DoxyCodeLine{00618 }
\DoxyCodeLine{00619   m\_info = info;}
\DoxyCodeLine{00620   \textcolor{keywordtype}{int} lx = m\_info.\mbox{\hyperlink{class_t_image_info_afe82a2118ba303797b2c8a12b47b771d}{m\_lx}};}
\DoxyCodeLine{00621   \textcolor{keywordtype}{int} ly = m\_info.\mbox{\hyperlink{class_t_image_info_affef879628cc3843968c932e706541b6}{m\_ly}};}
\DoxyCodeLine{00622 }
\DoxyCodeLine{00623   \textcolor{keywordflow}{if} (!m\_properties) m\_properties = \textcolor{keyword}{new} \mbox{\hyperlink{class_tiio_1_1_bmp_writer_properties}{Tiio::BmpWriterProperties}}();}
\DoxyCodeLine{00624 }
\DoxyCodeLine{00625   \mbox{\hyperlink{class_t_enum_property}{TEnumProperty}} *p =}
\DoxyCodeLine{00626       (\mbox{\hyperlink{class_t_enum_property}{TEnumProperty}} *)(m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Bits Per Pixel"{}}));}
\DoxyCodeLine{00627   assert(p);}
\DoxyCodeLine{00628   std::string str = ::to\_string(p-\/>getValue());}
\DoxyCodeLine{00629   m\_bitPerPixel   = atoi(str.c\_str());}
\DoxyCodeLine{00630 }
\DoxyCodeLine{00631   \textcolor{keywordtype}{int} cmapSize                  = 0;}
\DoxyCodeLine{00632   std::vector<TPixel> *colormap = 0;}
\DoxyCodeLine{00633 }
\DoxyCodeLine{00634   \textcolor{keywordflow}{if} (m\_bitPerPixel == 8) \{}
\DoxyCodeLine{00635     \mbox{\hyperlink{class_t_pointer_property}{TPointerProperty}} *colormapProp =}
\DoxyCodeLine{00636         (\mbox{\hyperlink{class_t_pointer_property}{TPointerProperty}} *)(m\_properties-\/>\mbox{\hyperlink{class_t_property_group_afb08f3145e5f77da6f163cdc9decad2f}{getProperty}}(\textcolor{stringliteral}{"{}Colormap"{}}));}
\DoxyCodeLine{00637     \textcolor{keywordflow}{if} (colormapProp) \{}
\DoxyCodeLine{00638       colormap = (std::vector<TPixel> *)colormapProp-\/>getValue();}
\DoxyCodeLine{00639       cmapSize = colormap-\/>size();}
\DoxyCodeLine{00640     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00641       cmapSize = 256;}
\DoxyCodeLine{00642   \}}
\DoxyCodeLine{00643 }
\DoxyCodeLine{00644   assert(m\_bitPerPixel == 8 || m\_bitPerPixel == 24);}
\DoxyCodeLine{00645 }
\DoxyCodeLine{00646   \textcolor{keywordtype}{int} bytePerLine =}
\DoxyCodeLine{00647       ((lx * m\_bitPerPixel + 31) / 32) * (m\_bitPerPixel == 8 ? 1 : 4);}
\DoxyCodeLine{00648 }
\DoxyCodeLine{00649   \textcolor{keywordtype}{int} fileSize = 14                  \textcolor{comment}{// file header}}
\DoxyCodeLine{00650                  + 40                \textcolor{comment}{// info header}}
\DoxyCodeLine{00651                  + cmapSize * 4      \textcolor{comment}{// colormap size}}
\DoxyCodeLine{00652                  + bytePerLine * ly  \textcolor{comment}{// image size}}
\DoxyCodeLine{00653       ;}
\DoxyCodeLine{00654   \textcolor{keywordtype}{int} offset      = 14 + 40 + cmapSize * 4;}
\DoxyCodeLine{00655   \textcolor{keywordtype}{int} compression = 0;}
\DoxyCodeLine{00656   \textcolor{keywordtype}{int} imageSize   = bytePerLine * ly;}
\DoxyCodeLine{00657 }
\DoxyCodeLine{00658   putc(\textcolor{charliteral}{'B'}, m\_chan);}
\DoxyCodeLine{00659   putc(\textcolor{charliteral}{'M'}, m\_chan);  \textcolor{comment}{// BMP file magic number}}
\DoxyCodeLine{00660 }
\DoxyCodeLine{00661   putint(m\_chan, fileSize);}
\DoxyCodeLine{00662   putshort(m\_chan, 0);  \textcolor{comment}{// reserved1}}
\DoxyCodeLine{00663   putshort(m\_chan, 0);  \textcolor{comment}{// reserved2}}
\DoxyCodeLine{00664 }
\DoxyCodeLine{00665   putint(m\_chan, offset);  \textcolor{comment}{// offset from BOfile to BObitmap}}
\DoxyCodeLine{00666 }
\DoxyCodeLine{00667   putint(m\_chan, 40);               \textcolor{comment}{// size of bitmap info header}}
\DoxyCodeLine{00668   putint(m\_chan, m\_info.\mbox{\hyperlink{class_t_image_info_afe82a2118ba303797b2c8a12b47b771d}{m\_lx}});      \textcolor{comment}{// width}}
\DoxyCodeLine{00669   putint(m\_chan, m\_info.\mbox{\hyperlink{class_t_image_info_affef879628cc3843968c932e706541b6}{m\_ly}});      \textcolor{comment}{// height}}
\DoxyCodeLine{00670   putshort(m\_chan, 1);              \textcolor{comment}{// must be '1'}}
\DoxyCodeLine{00671   putshort(m\_chan, m\_bitPerPixel);  \textcolor{comment}{// 1,4,8, or 24}}
\DoxyCodeLine{00672   putint(m\_chan, compression);      \textcolor{comment}{// BMP\_BI\_RGB, BMP\_BI\_RLE8 or BMP\_BI\_RLE4}}
\DoxyCodeLine{00673   putint(m\_chan, imageSize);        \textcolor{comment}{// size of raw image data}}
\DoxyCodeLine{00674   putint(m\_chan, 0);                \textcolor{comment}{// dpi * 39"{} per meter}}
\DoxyCodeLine{00675   putint(m\_chan, 0);                \textcolor{comment}{// dpi * 39"{} per meter}}
\DoxyCodeLine{00676   putint(m\_chan, cmapSize);         \textcolor{comment}{// colors used in cmap}}
\DoxyCodeLine{00677   putint(m\_chan, 0);                \textcolor{comment}{// same as above}}
\DoxyCodeLine{00678 }
\DoxyCodeLine{00679   \textcolor{keywordflow}{if} (colormap)}
\DoxyCodeLine{00680     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)colormap-\/>size(); i++) \{}
\DoxyCodeLine{00681       putc((*colormap)[i].b, m\_chan);}
\DoxyCodeLine{00682       putc((*colormap)[i].g, m\_chan);}
\DoxyCodeLine{00683       putc((*colormap)[i].r, m\_chan);}
\DoxyCodeLine{00684       putc(0, m\_chan);}
\DoxyCodeLine{00685     \}}
\DoxyCodeLine{00686   \textcolor{keywordflow}{else}}
\DoxyCodeLine{00687     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < cmapSize; i++)  \textcolor{comment}{// palette!!}}
\DoxyCodeLine{00688     \{}
\DoxyCodeLine{00689       putc(i, m\_chan);}
\DoxyCodeLine{00690       putc(i, m\_chan);}
\DoxyCodeLine{00691       putc(i, m\_chan);}
\DoxyCodeLine{00692       putc(0, m\_chan);}
\DoxyCodeLine{00693     \}}
\DoxyCodeLine{00694 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bmp_writer_a3283b7ddd1ed3149836a90fef58d0b3a}\label{class_bmp_writer_a3283b7ddd1ed3149836a90fef58d0b3a}} 
\index{BmpWriter@{BmpWriter}!writeAlphaSupported@{writeAlphaSupported}}
\index{writeAlphaSupported@{writeAlphaSupported}!BmpWriter@{BmpWriter}}
\doxysubsubsection{\texorpdfstring{writeAlphaSupported()}{writeAlphaSupported()}}
{\footnotesize\ttfamily bool Bmp\+Writer\+::write\+Alpha\+Supported (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_tiio_1_1_writer}{Tiio\+::\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00603 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bmp_writer_a207e97e8265a24dba6c2e262c6dac09d}\label{class_bmp_writer_a207e97e8265a24dba6c2e262c6dac09d}} 
\index{BmpWriter@{BmpWriter}!writeLine@{writeLine}}
\index{writeLine@{writeLine}!BmpWriter@{BmpWriter}}
\doxysubsubsection{\texorpdfstring{writeLine()}{writeLine()}}
{\footnotesize\ttfamily void Bmp\+Writer\+::write\+Line (\begin{DoxyParamCaption}\item[{char $\ast$}]{buffer }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \mbox{\hyperlink{class_tiio_1_1_writer}{Tiio\+::\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00698                                       \{}
\DoxyCodeLine{00699   \textcolor{keywordtype}{int} lx = m\_info.\mbox{\hyperlink{class_t_image_info_afe82a2118ba303797b2c8a12b47b771d}{m\_lx}};}
\DoxyCodeLine{00700 }
\DoxyCodeLine{00701   \textcolor{keywordtype}{int} j;}
\DoxyCodeLine{00702 }
\DoxyCodeLine{00703   \textcolor{keywordflow}{switch} (m\_bitPerPixel) \{}
\DoxyCodeLine{00704   \textcolor{keywordflow}{case} 24: \{}
\DoxyCodeLine{00705     TPixel32 *pix = (TPixel32 *)buffer;}
\DoxyCodeLine{00706     \textcolor{keywordflow}{for} (j = 0; j < lx; j++) \{}
\DoxyCodeLine{00707       putc(pix-\/>b, m\_chan);}
\DoxyCodeLine{00708       putc(pix-\/>g, m\_chan);}
\DoxyCodeLine{00709       putc(pix-\/>r, m\_chan);}
\DoxyCodeLine{00710       ++pix;}
\DoxyCodeLine{00711     \}}
\DoxyCodeLine{00712     \textcolor{keywordtype}{int} bytes = lx * 3;}
\DoxyCodeLine{00713     \textcolor{keywordflow}{while} (bytes \& 3) \{}
\DoxyCodeLine{00714       putc(0, m\_chan);}
\DoxyCodeLine{00715       bytes++;}
\DoxyCodeLine{00716     \}}
\DoxyCodeLine{00717     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00718   \}}
\DoxyCodeLine{00719   \textcolor{keywordflow}{case} 8: \{}
\DoxyCodeLine{00720     \mbox{\hyperlink{class_t_pixel_g_r8}{TPixelGR8}} *pix = (\mbox{\hyperlink{class_t_pixel_g_r8}{TPixelGR8}} *)buffer;}
\DoxyCodeLine{00721     \textcolor{keywordflow}{for} (j = 0; j < lx; j++) \{}
\DoxyCodeLine{00722       putc(pix-\/>value, m\_chan);}
\DoxyCodeLine{00723       ++pix;}
\DoxyCodeLine{00724     \}}
\DoxyCodeLine{00725     \textcolor{keywordflow}{while} (lx \& 3) \{}
\DoxyCodeLine{00726       putc(0, m\_chan);}
\DoxyCodeLine{00727       lx++;}
\DoxyCodeLine{00728     \}}
\DoxyCodeLine{00729     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00730   \}}
\DoxyCodeLine{00731   \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00732     assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00733   \}}
\DoxyCodeLine{00734   ftell(m\_chan);}
\DoxyCodeLine{00735 \}}

\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/common/tiio/tiio\+\_\+bmp.\+cpp\end{DoxyCompactItemize}
