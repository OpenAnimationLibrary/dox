\hypertarget{class_t_offline_g_l}{}\doxysection{TOffline\+GL Class Reference}
\label{class_t_offline_g_l}\index{TOfflineGL@{TOfflineGL}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_offline_g_l_1_1_imp}{Imp}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
typedef std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{class_t_offline_g_l_1_1_imp}{Imp}} $>$ \mbox{\hyperlink{class_t_offline_g_l_a0cc89ceb03c20db99165f308d8124b1e}{Imp\+Generator}}(const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&dim, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{class_t_offline_g_l_1_1_imp}{Imp}} $>$ shared)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_offline_g_l_a24a9dbba50eeae9e3fe8339916507cea}{TOffline\+GL}} (\mbox{\hyperlink{class_t_dimension_t}{TDimension}} dim, const \mbox{\hyperlink{class_t_offline_g_l}{TOffline\+GL}} $\ast$shared=0)
\item 
\mbox{\hyperlink{class_t_offline_g_l_aebe531f164573e35dd1b06fcb2d5821d}{TOffline\+GL}} (const \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} \&raster, const \mbox{\hyperlink{class_t_offline_g_l}{TOffline\+GL}} $\ast$shared=0)
\item 
void \mbox{\hyperlink{class_t_offline_g_l_a231213963d8046d2b74b3fdea7c509b7}{make\+Current}} ()
\item 
void \mbox{\hyperlink{class_t_offline_g_l_a6c569d24babf7e223b5008b4f4db58b8}{done\+Current}} ()
\item 
void \mbox{\hyperlink{class_t_offline_g_l_ad88f7e9c062fe7200eb0a0132224804a}{init\+Matrix}} ()
\item 
void \mbox{\hyperlink{class_t_offline_g_l_a950ec9a4e01955be9272e2a58550d34e}{clear}} (TPixel32 color)
\item 
void \mbox{\hyperlink{class_t_offline_g_l_a43059d88648996c8862591dc412c943e}{draw}} (\mbox{\hyperlink{class_t_vector_image_p}{TVector\+ImageP}} image, const \mbox{\hyperlink{class_t_vector_render_data}{TVector\+Render\+Data}} \&rd, bool do\+Init\+Matrix=false)
\item 
void \mbox{\hyperlink{class_t_offline_g_l_ab7486ff100bbd82da6e13b0cfa354857}{draw}} (\mbox{\hyperlink{class_t_raster_image_p}{TRaster\+ImageP}} image, const \mbox{\hyperlink{class_t_affine}{TAffine}} \&aff, bool do\+Init\+Matrix=false)
\item 
void \mbox{\hyperlink{class_t_offline_g_l_ac4a7a46516c259e57457e89a56102dc7}{flush}} ()
\item 
\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} \mbox{\hyperlink{class_t_offline_g_l_a5c58fb1dc5004f96ab082191d248b7a9}{get\+Raster}} ()
\item 
void \mbox{\hyperlink{class_t_offline_g_l_a5375bd96ed7cb2f2bd8976420fdb0d8f}{get\+Raster}} (\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} raster)
\item 
void \mbox{\hyperlink{class_t_offline_g_l_a52cd40c8b38aafed6b0f3af6cf9a74b0}{get\+Raster}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} raster)
\item 
int \mbox{\hyperlink{class_t_offline_g_l_a1ad8b65eb4afe7c8c324d1d733a8ffb4}{get\+Lx}} () const
\item 
int \mbox{\hyperlink{class_t_offline_g_l_ac1dbc7621bc174e2815b344b1bfa26d5}{get\+Ly}} () const
\item 
\mbox{\hyperlink{class_t_dimension_t}{TDimension}} \mbox{\hyperlink{class_t_offline_g_l_a4a1c7cd7f4308da4762536382a232a78}{get\+Size}} () const
\item 
\mbox{\hyperlink{class_t_rect_t}{TRect}} \mbox{\hyperlink{class_t_offline_g_l_aff41a86e9d2f73249b01b396c5699540}{get\+Bounds}} () const
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static Imp\+Generator $\ast$ \mbox{\hyperlink{class_t_offline_g_l_ac7b1c335555c5deed95b684edb0a8f08}{define\+Imp\+Generator}} (Imp\+Generator $\ast$imp\+Generator)
\item 
static void \mbox{\hyperlink{class_t_offline_g_l_acdd926f3ac1043f45f2e885310739d49}{set\+Context\+Manager}} (\mbox{\hyperlink{class_t_g_l_context_manager}{TGLContext\+Manager}} $\ast$context\+Manager)
\item 
static \mbox{\hyperlink{class_t_offline_g_l}{TOffline\+GL}} $\ast$ \mbox{\hyperlink{class_t_offline_g_l_a47784ba1995ac4229906074594dabbe3}{get\+Stock}} (\mbox{\hyperlink{class_t_dimension_t}{TDimension}} dim)
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{class_t_offline_g_l_1_1_imp}{Imp}} $>$ \mbox{\hyperlink{class_t_offline_g_l_af68cd683b4dd6ad656505f90b373b992}{m\+\_\+imp}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Member Typedef Documentation}
\mbox{\Hypertarget{class_t_offline_g_l_a0cc89ceb03c20db99165f308d8124b1e}\label{class_t_offline_g_l_a0cc89ceb03c20db99165f308d8124b1e}} 
\index{TOfflineGL@{TOfflineGL}!ImpGenerator@{ImpGenerator}}
\index{ImpGenerator@{ImpGenerator}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{ImpGenerator}{ImpGenerator}}
{\footnotesize\ttfamily typedef std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{class_t_offline_g_l_1_1_imp}{Imp}} $>$ TOffline\+GL\+::\+Imp\+Generator(const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&dim, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{class_t_offline_g_l_1_1_imp}{Imp}} $>$ shared)}



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_offline_g_l_a24a9dbba50eeae9e3fe8339916507cea}\label{class_t_offline_g_l_a24a9dbba50eeae9e3fe8339916507cea}} 
\index{TOfflineGL@{TOfflineGL}!TOfflineGL@{TOfflineGL}}
\index{TOfflineGL@{TOfflineGL}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{TOfflineGL()}{TOfflineGL()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily TOffline\+GL\+::\+TOffline\+GL (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimension}}}]{dim,  }\item[{const \mbox{\hyperlink{class_t_offline_g_l}{TOffline\+GL}} $\ast$}]{shared = {\ttfamily 0} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00542                                                                : m\_imp(0) \{}
\DoxyCodeLine{00543 \textcolor{preprocessor}{\#if defined(LINUX) || defined(FREEBSD)}}
\DoxyCodeLine{00544   QMutexLocker locker(\&linuxImpMutex);}
\DoxyCodeLine{00545 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00546 }
\DoxyCodeLine{00547   \textcolor{comment}{/*}}
\DoxyCodeLine{00548 \textcolor{comment}{  元のコードは(別スレッドから呼び出すための) offline renderer を作って main}}
\DoxyCodeLine{00549 \textcolor{comment}{  thread に dispatch するという訳のわからないことをしていたが Q*GLContext は}}
\DoxyCodeLine{00550 \textcolor{comment}{  thread context を超えられないので直接生成してこのコンテキストで閉じる.}}
\DoxyCodeLine{00551 \textcolor{comment}{  別スレッドには dispatch しない.}}
\DoxyCodeLine{00552 \textcolor{comment}{*/}}
\DoxyCodeLine{00553   m\_imp = currentImpGenerator(dim, shared ? shared-\/>m\_imp : 0);}
\DoxyCodeLine{00554 }
\DoxyCodeLine{00555   initMatrix();}
\DoxyCodeLine{00556 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_aebe531f164573e35dd1b06fcb2d5821d}\label{class_t_offline_g_l_aebe531f164573e35dd1b06fcb2d5821d}} 
\index{TOfflineGL@{TOfflineGL}!TOfflineGL@{TOfflineGL}}
\index{TOfflineGL@{TOfflineGL}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{TOfflineGL()}{TOfflineGL()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily TOffline\+GL\+::\+TOffline\+GL (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} \&}]{raster,  }\item[{const \mbox{\hyperlink{class_t_offline_g_l}{TOffline\+GL}} $\ast$}]{shared = {\ttfamily 0} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00560                                                                          \{}
\DoxyCodeLine{00561 \textcolor{preprocessor}{\#if defined(LINUX) || defined(FREEBSD)}}
\DoxyCodeLine{00562   QMutexLocker locker(\&linuxImpMutex);}
\DoxyCodeLine{00563 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00564 }
\DoxyCodeLine{00565   \textcolor{comment}{// m\_imp = new Imp(raster-\/>getSize());}}
\DoxyCodeLine{00566 }
\DoxyCodeLine{00567   m\_imp = currentImpGenerator(raster-\/>getSize(), shared-\/>m\_imp);}
\DoxyCodeLine{00568 }
\DoxyCodeLine{00569   initMatrix();}
\DoxyCodeLine{00570 }
\DoxyCodeLine{00571   glRasterPos2d(0, 0);}
\DoxyCodeLine{00572   raster-\/>lock();}
\DoxyCodeLine{00573   glDrawPixels(raster-\/>getLx(), raster-\/>getLy(), GL\_BGRA\_EXT, GL\_UNSIGNED\_BYTE,}
\DoxyCodeLine{00574                raster-\/>getRawData());}
\DoxyCodeLine{00575   raster-\/>unlock();}
\DoxyCodeLine{00576 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a250936019efd155f80adfbeff0f3bd56}\label{class_t_offline_g_l_a250936019efd155f80adfbeff0f3bd56}} 
\index{TOfflineGL@{TOfflineGL}!````~TOfflineGL@{$\sim$TOfflineGL}}
\index{````~TOfflineGL@{$\sim$TOfflineGL}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{$\sim$TOfflineGL()}{~TOfflineGL()}}
{\footnotesize\ttfamily TOffline\+GL\+::$\sim$\+TOffline\+GL (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00580                         \{}
\DoxyCodeLine{00581   \textcolor{comment}{// delete m\_imp;}}
\DoxyCodeLine{00582 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_offline_g_l_a950ec9a4e01955be9272e2a58550d34e}\label{class_t_offline_g_l_a950ec9a4e01955be9272e2a58550d34e}} 
\index{TOfflineGL@{TOfflineGL}!clear@{clear}}
\index{clear@{clear}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{clear()}{clear()}}
{\footnotesize\ttfamily void TOffline\+GL\+::clear (\begin{DoxyParamCaption}\item[{TPixel32}]{color }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00644                                      \{}
\DoxyCodeLine{00645   \textcolor{keyword}{const} \textcolor{keywordtype}{double} maxValue = 255.0;}
\DoxyCodeLine{00646   makeCurrent();}
\DoxyCodeLine{00647   glClearColor((\textcolor{keywordtype}{double})color.r / maxValue, (\textcolor{keywordtype}{double})color.g / maxValue,}
\DoxyCodeLine{00648                (\textcolor{keywordtype}{double})color.b / maxValue, (\textcolor{keywordtype}{double})color.m / maxValue);}
\DoxyCodeLine{00649   glClear(GL\_COLOR\_BUFFER\_BIT);}
\DoxyCodeLine{00650 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_ac7b1c335555c5deed95b684edb0a8f08}\label{class_t_offline_g_l_ac7b1c335555c5deed95b684edb0a8f08}} 
\index{TOfflineGL@{TOfflineGL}!defineImpGenerator@{defineImpGenerator}}
\index{defineImpGenerator@{defineImpGenerator}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{defineImpGenerator()}{defineImpGenerator()}}
{\footnotesize\ttfamily TOffline\+GL\+::\+Imp\+Generator $\ast$ TOffline\+GL\+::define\+Imp\+Generator (\begin{DoxyParamCaption}\item[{TOffline\+GL\+::\+Imp\+Generator $\ast$}]{imp\+Generator }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00587                                           \{}
\DoxyCodeLine{00588   TOfflineGL::ImpGenerator *ret = currentImpGenerator;}
\DoxyCodeLine{00589   currentImpGenerator           = impGenerator;}
\DoxyCodeLine{00590   \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{00591 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a6c569d24babf7e223b5008b4f4db58b8}\label{class_t_offline_g_l_a6c569d24babf7e223b5008b4f4db58b8}} 
\index{TOfflineGL@{TOfflineGL}!doneCurrent@{doneCurrent}}
\index{doneCurrent@{doneCurrent}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{doneCurrent()}{doneCurrent()}}
{\footnotesize\ttfamily void TOffline\+GL\+::done\+Current (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00604                              \{}
\DoxyCodeLine{00605   m\_imp-\/>doneCurrent();}
\DoxyCodeLine{00606   \textcolor{keywordflow}{if} (currentContextManager) \{}
\DoxyCodeLine{00607     currentContextManager-\/>restore();}
\DoxyCodeLine{00608   \}}
\DoxyCodeLine{00609 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_ab7486ff100bbd82da6e13b0cfa354857}\label{class_t_offline_g_l_ab7486ff100bbd82da6e13b0cfa354857}} 
\index{TOfflineGL@{TOfflineGL}!draw@{draw}}
\index{draw@{draw}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void TOffline\+GL\+::draw (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_raster_image_p}{TRaster\+ImageP}}}]{image,  }\item[{const \mbox{\hyperlink{class_t_affine}{TAffine}} \&}]{aff,  }\item[{bool}]{do\+Init\+Matrix = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00678                                                                              \{}
\DoxyCodeLine{00679   makeCurrent();}
\DoxyCodeLine{00680 }
\DoxyCodeLine{00681   \textcolor{keywordflow}{if} (doInitMatrix) initMatrix();}
\DoxyCodeLine{00682 }
\DoxyCodeLine{00683   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32 = ri-\/>getRaster();}
\DoxyCodeLine{00684   \textcolor{keywordflow}{if} (!ras32) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00685 }
\DoxyCodeLine{00686   \textcolor{keywordtype}{int} lx = ras32-\/>getLx();}
\DoxyCodeLine{00687   \textcolor{keywordtype}{int} ly = ras32-\/>getLy();}
\DoxyCodeLine{00688   \textcolor{comment}{// lx e ly devono essere potenze di due}}
\DoxyCodeLine{00689   assert((lx \& (lx -\/ 1)) == 0);}
\DoxyCodeLine{00690   assert((ly \& (ly -\/ 1)) == 0);}
\DoxyCodeLine{00691 }
\DoxyCodeLine{00692   glPushMatrix();}
\DoxyCodeLine{00693   tglMultMatrix(aff);}
\DoxyCodeLine{00694 }
\DoxyCodeLine{00695   glTexParameterf(GL\_TEXTURE\_2D, GL\_TEXTURE\_WRAP\_S, GL\_REPEAT);}
\DoxyCodeLine{00696   glTexParameterf(GL\_TEXTURE\_2D, GL\_TEXTURE\_WRAP\_T, GL\_REPEAT);}
\DoxyCodeLine{00697   glTexParameterf(GL\_TEXTURE\_2D, GL\_TEXTURE\_MAG\_FILTER, GL\_LINEAR);}
\DoxyCodeLine{00698   glTexParameterf(GL\_TEXTURE\_2D, GL\_TEXTURE\_MIN\_FILTER, GL\_LINEAR);}
\DoxyCodeLine{00699 }
\DoxyCodeLine{00700   glTexEnvf(GL\_TEXTURE\_ENV, GL\_TEXTURE\_ENV\_MODE, GL\_DECAL);}
\DoxyCodeLine{00701 }
\DoxyCodeLine{00702   glEnable(GL\_TEXTURE\_2D);}
\DoxyCodeLine{00703 }
\DoxyCodeLine{00704   \textcolor{comment}{/*}}
\DoxyCodeLine{00705 \textcolor{comment}{TNZ\_MACHINE\_CHANNEL\_ORDER\_BGRM}}
\DoxyCodeLine{00706 \textcolor{comment}{TNZ\_MACHINE\_CHANNEL\_ORDER\_MBGR}}
\DoxyCodeLine{00707 \textcolor{comment}{TNZ\_MACHINE\_CHANNEL\_ORDER\_RGBM}}
\DoxyCodeLine{00708 \textcolor{comment}{TNZ\_MACHINE\_CHANNEL\_ORDER\_MRGB}}
\DoxyCodeLine{00709 \textcolor{comment}{*/}}
\DoxyCodeLine{00710 }
\DoxyCodeLine{00711   GLenum fmt = TGL\_FMT;}
\DoxyCodeLine{00712   \textcolor{comment}{/*}}
\DoxyCodeLine{00713 \textcolor{comment}{\#if defined(TNZ\_MACHINE\_CHANNEL\_ORDER\_BGRM)}}
\DoxyCodeLine{00714 \textcolor{comment}{GL\_BGRA\_EXT;}}
\DoxyCodeLine{00715 \textcolor{comment}{\#elif defined(TNZ\_MACHINE\_CHANNEL\_ORDER\_MBGR)}}
\DoxyCodeLine{00716 \textcolor{comment}{GL\_ABGR\_EXT;}}
\DoxyCodeLine{00717 \textcolor{comment}{\#elif defined(TNZ\_MACHINE\_CHANNEL\_ORDER\_RGBM)}}
\DoxyCodeLine{00718 \textcolor{comment}{GL\_RGBA;}}
\DoxyCodeLine{00719 \textcolor{comment}{\#elif defined(TNZ\_MACHINE\_CHANNEL\_ORDER\_MRGB)}}
\DoxyCodeLine{00720 \textcolor{comment}{\#warning "{}to do"{}}}
\DoxyCodeLine{00721 \textcolor{comment}{GL\_ABGR\_EXT;}}
\DoxyCodeLine{00722 \textcolor{comment}{\#else}}
\DoxyCodeLine{00723 \textcolor{comment}{Error  PLATFORM NOT SUPPORTED}}
\DoxyCodeLine{00724 \textcolor{comment}{\#endif}}
\DoxyCodeLine{00725 \textcolor{comment}{*/}}
\DoxyCodeLine{00726 }
\DoxyCodeLine{00727   \textcolor{comment}{// Generate a texture id and bind it.}}
\DoxyCodeLine{00728   GLuint texId;}
\DoxyCodeLine{00729   glGenTextures(1, \&texId);}
\DoxyCodeLine{00730 }
\DoxyCodeLine{00731   glBindTexture(GL\_TEXTURE\_2D, texId);}
\DoxyCodeLine{00732 }
\DoxyCodeLine{00733   glPixelStorei(GL\_UNPACK\_ROW\_LENGTH,}
\DoxyCodeLine{00734                 ras32-\/>getWrap() != ras32-\/>getLx() ? ras32-\/>getWrap() : 0);}
\DoxyCodeLine{00735 }
\DoxyCodeLine{00736   ras32-\/>lock();}
\DoxyCodeLine{00737 }
\DoxyCodeLine{00738   glTexImage2D(GL\_TEXTURE\_2D,  \textcolor{comment}{// target (is a 2D texture)}}
\DoxyCodeLine{00739                0,              \textcolor{comment}{// is one level only}}
\DoxyCodeLine{00740                GL\_RGB,         \textcolor{comment}{//  number of component of a pixel}}
\DoxyCodeLine{00741                lx,             \textcolor{comment}{// size width}}
\DoxyCodeLine{00742                ly,             \textcolor{comment}{//      height}}
\DoxyCodeLine{00743                0,              \textcolor{comment}{// size of a border}}
\DoxyCodeLine{00744                fmt,}
\DoxyCodeLine{00745                GL\_UNSIGNED\_BYTE,  \textcolor{comment}{//}}
\DoxyCodeLine{00746                ras32-\/>getRawData());}
\DoxyCodeLine{00747 }
\DoxyCodeLine{00748   ras32-\/>unlock();}
\DoxyCodeLine{00749 }
\DoxyCodeLine{00750   \textcolor{keywordtype}{double} halfWidth  = 0.5 * lx;}
\DoxyCodeLine{00751   \textcolor{keywordtype}{double} halfHeight = 0.5 * ly;}
\DoxyCodeLine{00752 }
\DoxyCodeLine{00753   \textcolor{keywordtype}{double} dpix = 1, dpiy = 1;}
\DoxyCodeLine{00754   ri-\/>getDpi(dpix, dpiy);}
\DoxyCodeLine{00755 }
\DoxyCodeLine{00756   \textcolor{keywordflow}{if} (dpix != 0 \&\& dpiy != 0) \{}
\DoxyCodeLine{00757     \textcolor{keywordtype}{double} unit = 100;}
\DoxyCodeLine{00758     halfWidth *= unit / dpix;}
\DoxyCodeLine{00759     halfHeight *= unit / dpiy;}
\DoxyCodeLine{00760   \}}
\DoxyCodeLine{00761 }
\DoxyCodeLine{00762   glBegin(GL\_QUAD\_STRIP);}
\DoxyCodeLine{00763   glTexCoord2d(0, 0);}
\DoxyCodeLine{00764   glVertex2d(-\/halfWidth, -\/halfHeight);}
\DoxyCodeLine{00765   glTexCoord2d(1, 0);}
\DoxyCodeLine{00766   glVertex2d(halfWidth, -\/halfHeight);}
\DoxyCodeLine{00767   glTexCoord2d(0, 1);}
\DoxyCodeLine{00768   glVertex2d(-\/halfWidth, halfHeight);}
\DoxyCodeLine{00769   glTexCoord2d(1, 1);}
\DoxyCodeLine{00770   glVertex2d(halfWidth, halfHeight);}
\DoxyCodeLine{00771   glEnd();}
\DoxyCodeLine{00772   glDisable(GL\_TEXTURE\_2D);}
\DoxyCodeLine{00773 }
\DoxyCodeLine{00774   glPopMatrix();}
\DoxyCodeLine{00775   glPixelStorei(GL\_UNPACK\_ROW\_LENGTH, 0);}
\DoxyCodeLine{00776 }
\DoxyCodeLine{00777   \textcolor{comment}{// Delete texture}}
\DoxyCodeLine{00778   glDeleteTextures(1, \&texId);}
\DoxyCodeLine{00779 }
\DoxyCodeLine{00780   glFlush();}
\DoxyCodeLine{00781 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a43059d88648996c8862591dc412c943e}\label{class_t_offline_g_l_a43059d88648996c8862591dc412c943e}} 
\index{TOfflineGL@{TOfflineGL}!draw@{draw}}
\index{draw@{draw}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{draw()}{draw()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void TOffline\+GL\+::draw (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_vector_image_p}{TVector\+ImageP}}}]{image,  }\item[{const \mbox{\hyperlink{class_t_vector_render_data}{TVector\+Render\+Data}} \&}]{rd,  }\item[{bool}]{do\+Init\+Matrix = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00655                                          \{}
\DoxyCodeLine{00656   checkErrorsByGL;}
\DoxyCodeLine{00657   makeCurrent();}
\DoxyCodeLine{00658   checkErrorsByGL;}
\DoxyCodeLine{00659 }
\DoxyCodeLine{00660   \textcolor{keywordflow}{if} (doInitMatrix) \{}
\DoxyCodeLine{00661     initMatrix();}
\DoxyCodeLine{00662     checkErrorsByGL;}
\DoxyCodeLine{00663   \}}
\DoxyCodeLine{00664 }
\DoxyCodeLine{00665   \textcolor{keywordflow}{if} (image) \{}
\DoxyCodeLine{00666     checkErrorsByGL;}
\DoxyCodeLine{00667     tglDraw(rd, image.getPointer());}
\DoxyCodeLine{00668     checkErrorsByGL;}
\DoxyCodeLine{00669   \}}
\DoxyCodeLine{00670 }
\DoxyCodeLine{00671   checkErrorsByGL;}
\DoxyCodeLine{00672   glFlush();}
\DoxyCodeLine{00673   checkErrorsByGL;}
\DoxyCodeLine{00674 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_ac4a7a46516c259e57457e89a56102dc7}\label{class_t_offline_g_l_ac4a7a46516c259e57457e89a56102dc7}} 
\index{TOfflineGL@{TOfflineGL}!flush@{flush}}
\index{flush@{flush}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{flush()}{flush()}}
{\footnotesize\ttfamily void TOffline\+GL\+::flush (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00785                        \{}
\DoxyCodeLine{00786   makeCurrent();}
\DoxyCodeLine{00787   glFlush();}
\DoxyCodeLine{00788 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_aff41a86e9d2f73249b01b396c5699540}\label{class_t_offline_g_l_aff41a86e9d2f73249b01b396c5699540}} 
\index{TOfflineGL@{TOfflineGL}!getBounds@{getBounds}}
\index{getBounds@{getBounds}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getBounds()}{getBounds()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_rect_t}{TRect}} TOffline\+GL\+::get\+Bounds (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00084 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_rect_t}{TRect}}(0, 0, getLx() -\/ 1, getLy() -\/ 1); \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a1ad8b65eb4afe7c8c324d1d733a8ffb4}\label{class_t_offline_g_l_a1ad8b65eb4afe7c8c324d1d733a8ffb4}} 
\index{TOfflineGL@{TOfflineGL}!getLx@{getLx}}
\index{getLx@{getLx}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getLx()}{getLx()}}
{\footnotesize\ttfamily int TOffline\+GL\+::get\+Lx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00836 \{ \textcolor{keywordflow}{return} m\_imp-\/>getLx(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_ac1dbc7621bc174e2815b344b1bfa26d5}\label{class_t_offline_g_l_ac1dbc7621bc174e2815b344b1bfa26d5}} 
\index{TOfflineGL@{TOfflineGL}!getLy@{getLy}}
\index{getLy@{getLy}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getLy()}{getLy()}}
{\footnotesize\ttfamily int TOffline\+GL\+::get\+Ly (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00840 \{ \textcolor{keywordflow}{return} m\_imp-\/>getLy(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a5c58fb1dc5004f96ab082191d248b7a9}\label{class_t_offline_g_l_a5c58fb1dc5004f96ab082191d248b7a9}} 
\index{TOfflineGL@{TOfflineGL}!getRaster@{getRaster}}
\index{getRaster@{getRaster}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getRaster()}{getRaster()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} TOffline\+GL\+::get\+Raster (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00828                                  \{}
\DoxyCodeLine{00829   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} raster(getLx(), getLy());}
\DoxyCodeLine{00830   m\_imp-\/>getRaster(raster);}
\DoxyCodeLine{00831   \textcolor{keywordflow}{return} raster;}
\DoxyCodeLine{00832 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a5375bd96ed7cb2f2bd8976420fdb0d8f}\label{class_t_offline_g_l_a5375bd96ed7cb2f2bd8976420fdb0d8f}} 
\index{TOfflineGL@{TOfflineGL}!getRaster@{getRaster}}
\index{getRaster@{getRaster}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getRaster()}{getRaster()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily void TOffline\+GL\+::get\+Raster (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}}}]{raster }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00792                                             \{}
\DoxyCodeLine{00793   assert(raster-\/>getLx() <= getLx() \&\& raster-\/>getLy() <= getLy());}
\DoxyCodeLine{00794   \textcolor{keywordflow}{if} (raster-\/>getWrap() == raster-\/>getLx()) \{}
\DoxyCodeLine{00795     m\_imp-\/>getRaster(raster);}
\DoxyCodeLine{00796   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00797     \textcolor{comment}{// There are 2 possible solutions: use glReadPixels multiple times for each}}
\DoxyCodeLine{00798     \textcolor{comment}{// row of input raster,}}
\DoxyCodeLine{00799     \textcolor{comment}{// OR allocate a new contiguous buffer, use glReadPixels once, and then}}
\DoxyCodeLine{00800     \textcolor{comment}{// memcpy each row.}}
\DoxyCodeLine{00801     \textcolor{comment}{// It actually seems that the *latter* is actually the fastest solution,}}
\DoxyCodeLine{00802     \textcolor{comment}{// although it requires}}
\DoxyCodeLine{00803     \textcolor{comment}{// allocating a temporary buffer of the same size of the requested raster...}}
\DoxyCodeLine{00804     \textcolor{comment}{// I also could not actually manage to make the former work -\/ the code}}
\DoxyCodeLine{00805     \textcolor{comment}{// seemed right but results were weird...}}
\DoxyCodeLine{00806     \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32(raster-\/>getSize());}
\DoxyCodeLine{00807     m\_imp-\/>getRaster(ras32);}
\DoxyCodeLine{00808     \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{TRop::copy}}(raster, ras32);}
\DoxyCodeLine{00809   \}}
\DoxyCodeLine{00810 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a52cd40c8b38aafed6b0f3af6cf9a74b0}\label{class_t_offline_g_l_a52cd40c8b38aafed6b0f3af6cf9a74b0}} 
\index{TOfflineGL@{TOfflineGL}!getRaster@{getRaster}}
\index{getRaster@{getRaster}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getRaster()}{getRaster()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily void TOffline\+GL\+::get\+Raster (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}}]{raster }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00814                                           \{}
\DoxyCodeLine{00815   assert(raster-\/>getLx() <= getLx() \&\& raster-\/>getLy() <= getLy());}
\DoxyCodeLine{00816   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32 = raster;}
\DoxyCodeLine{00817   \textcolor{keywordflow}{if} (ras32 \&\& (raster-\/>\mbox{\hyperlink{class_t_raster_a760946b6cb48d7414f90cd421078912c}{getWrap}}() == raster-\/>getLx())) \{}
\DoxyCodeLine{00818     m\_imp-\/>getRaster(ras32);}
\DoxyCodeLine{00819   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00820     ras32 = \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}}(raster-\/>getSize());}
\DoxyCodeLine{00821     m\_imp-\/>getRaster(ras32);}
\DoxyCodeLine{00822     \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{TRop::copy}}(raster, ras32);}
\DoxyCodeLine{00823   \}}
\DoxyCodeLine{00824 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a4a1c7cd7f4308da4762536382a232a78}\label{class_t_offline_g_l_a4a1c7cd7f4308da4762536382a232a78}} 
\index{TOfflineGL@{TOfflineGL}!getSize@{getSize}}
\index{getSize@{getSize}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getSize()}{getSize()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_dimension_t}{TDimension}} TOffline\+GL\+::get\+Size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00083 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(getLx(), getLy()); \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a47784ba1995ac4229906074594dabbe3}\label{class_t_offline_g_l_a47784ba1995ac4229906074594dabbe3}} 
\index{TOfflineGL@{TOfflineGL}!getStock@{getStock}}
\index{getStock@{getStock}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{getStock()}{getStock()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_offline_g_l}{TOffline\+GL}} $\ast$ TOffline\+GL\+::get\+Stock (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimension}}}]{dim }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00899                                                      \{}
\DoxyCodeLine{00900   \textcolor{keywordflow}{return} OglStock::instance()-\/>get(dim);}
\DoxyCodeLine{00901 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_ad88f7e9c062fe7200eb0a0132224804a}\label{class_t_offline_g_l_ad88f7e9c062fe7200eb0a0132224804a}} 
\index{TOfflineGL@{TOfflineGL}!initMatrix@{initMatrix}}
\index{initMatrix@{initMatrix}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{initMatrix()}{initMatrix()}}
{\footnotesize\ttfamily void TOffline\+GL\+::init\+Matrix (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00613                             \{}
\DoxyCodeLine{00614   m\_imp-\/>makeCurrent();}
\DoxyCodeLine{00615 }
\DoxyCodeLine{00616   \textcolor{comment}{// cfr. help: OpenGL/Programming tip/OpenGL Correctness Tips}}
\DoxyCodeLine{00617   glViewport(0, 0, m\_imp-\/>getLx(), m\_imp-\/>getLy());}
\DoxyCodeLine{00618   glMatrixMode(GL\_PROJECTION);}
\DoxyCodeLine{00619   glLoadIdentity();}
\DoxyCodeLine{00620   gluOrtho2D(0, m\_imp-\/>getLx(), 0, m\_imp-\/>getLy());}
\DoxyCodeLine{00621   glMatrixMode(GL\_MODELVIEW);}
\DoxyCodeLine{00622   glLoadIdentity();}
\DoxyCodeLine{00623   \textcolor{comment}{// glTranslatef(0.375, 0.375, 0.0);    //WRONG}}
\DoxyCodeLine{00624 }
\DoxyCodeLine{00625   \textcolor{comment}{/*  (From Daniele)}}
\DoxyCodeLine{00626 \textcolor{comment}{}}
\DoxyCodeLine{00627 \textcolor{comment}{Quoting from the aforementioned source:}}
\DoxyCodeLine{00628 \textcolor{comment}{}}
\DoxyCodeLine{00629 \textcolor{comment}{"{}An optimum compromise that allows all primitives to be specified at integer}}
\DoxyCodeLine{00630 \textcolor{comment}{positions, while still ensuring predictable rasterization, is to translate x}}
\DoxyCodeLine{00631 \textcolor{comment}{and y by 0.375, as shown in the following code sample. Such a translation}}
\DoxyCodeLine{00632 \textcolor{comment}{keeps polygon and pixel image edges safely away from the centers of pixels,}}
\DoxyCodeLine{00633 \textcolor{comment}{while moving line vertices close enough to the pixel centers"{}}}
\DoxyCodeLine{00634 \textcolor{comment}{}}
\DoxyCodeLine{00635 \textcolor{comment}{NOTE: This is not an acceptable excuse in our case -\/ as we're NOT USING}}
\DoxyCodeLine{00636 \textcolor{comment}{    INTEGER COORDINATES ONLY. OpenGL has all the rights to render pixels}}
\DoxyCodeLine{00637 \textcolor{comment}{    at integer coordinates across the neighbouring 4 pixels -\/ and their}}
\DoxyCodeLine{00638 \textcolor{comment}{    (0.5, 0.5) translations at the EXACT screen pixel.}}
\DoxyCodeLine{00639 \textcolor{comment}{*/}}
\DoxyCodeLine{00640 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_a231213963d8046d2b74b3fdea7c509b7}\label{class_t_offline_g_l_a231213963d8046d2b74b3fdea7c509b7}} 
\index{TOfflineGL@{TOfflineGL}!makeCurrent@{makeCurrent}}
\index{makeCurrent@{makeCurrent}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{makeCurrent()}{makeCurrent()}}
{\footnotesize\ttfamily void TOffline\+GL\+::make\+Current (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00595                              \{}
\DoxyCodeLine{00596   \textcolor{keywordflow}{if} (currentContextManager) currentContextManager-\/>store();}
\DoxyCodeLine{00597   \textcolor{comment}{// Tutto il codice è stato spostato dentro Imp}}
\DoxyCodeLine{00598   m\_imp-\/>makeCurrent();}
\DoxyCodeLine{00599   assert(glGetError() == GL\_NO\_ERROR);}
\DoxyCodeLine{00600 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_offline_g_l_acdd926f3ac1043f45f2e885310739d49}\label{class_t_offline_g_l_acdd926f3ac1043f45f2e885310739d49}} 
\index{TOfflineGL@{TOfflineGL}!setContextManager@{setContextManager}}
\index{setContextManager@{setContextManager}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{setContextManager()}{setContextManager()}}
{\footnotesize\ttfamily void TOffline\+GL\+::set\+Context\+Manager (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_g_l_context_manager}{TGLContext\+Manager}} $\ast$}]{context\+Manager }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00051                                                                     \{}
\DoxyCodeLine{00052   currentContextManager = contextManager;}
\DoxyCodeLine{00053   \textcolor{keywordflow}{if} (contextManager) contextManager-\/>store();}
\DoxyCodeLine{00054 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_t_offline_g_l_af68cd683b4dd6ad656505f90b373b992}\label{class_t_offline_g_l_af68cd683b4dd6ad656505f90b373b992}} 
\index{TOfflineGL@{TOfflineGL}!m\_imp@{m\_imp}}
\index{m\_imp@{m\_imp}!TOfflineGL@{TOfflineGL}}
\doxysubsubsection{\texorpdfstring{m\_imp}{m\_imp}}
{\footnotesize\ttfamily std\+::shared\+\_\+ptr$<$\mbox{\hyperlink{class_t_offline_g_l_1_1_imp}{Imp}}$>$ TOffline\+GL\+::m\+\_\+imp}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tofflinegl.\+h\item 
E\+:/opentoonz/toonz/sources/common/tvrender/tofflinegl.\+cpp\end{DoxyCompactItemize}
