\hypertarget{class_jpg_exif_reader}{}\doxysection{Jpg\+Exif\+Reader Class Reference}
\label{class_jpg_exif_reader}\index{JpgExifReader@{JpgExifReader}}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_jpg_exif_reader_ae82d3c10cab641a79bf965ac0cc19af7}{process\+\_\+\+EXIF}} (unsigned char $\ast$Exif\+Section, unsigned int length)
\item 
void \mbox{\hyperlink{class_jpg_exif_reader_ac9286403fe889c565d4f082c7ebe935f}{Process\+Exif\+Dir}} (unsigned char $\ast$Dir\+Start, unsigned char $\ast$Offset\+Base, unsigned Exif\+Length, int Nesting\+Level)
\item 
bool \mbox{\hyperlink{class_jpg_exif_reader_a4f214ededf23b8674b07e37141045e91}{contains\+Resolution}} ()
\item 
float \mbox{\hyperlink{class_jpg_exif_reader_a24115464980759d7f094fa4afb8a7db5}{get\+XResolution}} ()
\item 
float \mbox{\hyperlink{class_jpg_exif_reader_a46749c2e3343777965b0f042e66f009c}{get\+YResolution}} ()
\item 
int \mbox{\hyperlink{class_jpg_exif_reader_a3786f875bf824caae0da2ee3b5944212}{get\+Resolution\+Unit}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_jpg_exif_reader_a4f214ededf23b8674b07e37141045e91}\label{class_jpg_exif_reader_a4f214ededf23b8674b07e37141045e91}} 
\index{JpgExifReader@{JpgExifReader}!containsResolution@{containsResolution}}
\index{containsResolution@{containsResolution}!JpgExifReader@{JpgExifReader}}
\doxysubsubsection{\texorpdfstring{containsResolution()}{containsResolution()}}
{\footnotesize\ttfamily bool Jpg\+Exif\+Reader\+::contains\+Resolution (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00133 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_image_info}{ImageInfo}}.xResolution != 0.0; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_jpg_exif_reader_a3786f875bf824caae0da2ee3b5944212}\label{class_jpg_exif_reader_a3786f875bf824caae0da2ee3b5944212}} 
\index{JpgExifReader@{JpgExifReader}!getResolutionUnit@{getResolutionUnit}}
\index{getResolutionUnit@{getResolutionUnit}!JpgExifReader@{JpgExifReader}}
\doxysubsubsection{\texorpdfstring{getResolutionUnit()}{getResolutionUnit()}}
{\footnotesize\ttfamily int Jpg\+Exif\+Reader\+::get\+Resolution\+Unit (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00136 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_image_info}{ImageInfo}}.ResolutionUnit; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_jpg_exif_reader_a24115464980759d7f094fa4afb8a7db5}\label{class_jpg_exif_reader_a24115464980759d7f094fa4afb8a7db5}} 
\index{JpgExifReader@{JpgExifReader}!getXResolution@{getXResolution}}
\index{getXResolution@{getXResolution}!JpgExifReader@{JpgExifReader}}
\doxysubsubsection{\texorpdfstring{getXResolution()}{getXResolution()}}
{\footnotesize\ttfamily float Jpg\+Exif\+Reader\+::get\+XResolution (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00134 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_image_info}{ImageInfo}}.xResolution; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_jpg_exif_reader_a46749c2e3343777965b0f042e66f009c}\label{class_jpg_exif_reader_a46749c2e3343777965b0f042e66f009c}} 
\index{JpgExifReader@{JpgExifReader}!getYResolution@{getYResolution}}
\index{getYResolution@{getYResolution}!JpgExifReader@{JpgExifReader}}
\doxysubsubsection{\texorpdfstring{getYResolution()}{getYResolution()}}
{\footnotesize\ttfamily float Jpg\+Exif\+Reader\+::get\+YResolution (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00135 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_image_info}{ImageInfo}}.yResolution; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_jpg_exif_reader_ae82d3c10cab641a79bf965ac0cc19af7}\label{class_jpg_exif_reader_ae82d3c10cab641a79bf965ac0cc19af7}} 
\index{JpgExifReader@{JpgExifReader}!process\_EXIF@{process\_EXIF}}
\index{process\_EXIF@{process\_EXIF}!JpgExifReader@{JpgExifReader}}
\doxysubsubsection{\texorpdfstring{process\_EXIF()}{process\_EXIF()}}
{\footnotesize\ttfamily void Jpg\+Exif\+Reader\+::process\+\_\+\+EXIF (\begin{DoxyParamCaption}\item[{unsigned char $\ast$}]{Exif\+Section,  }\item[{unsigned int}]{length }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00410                                                       \{}
\DoxyCodeLine{00411   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} FirstOffset;}
\DoxyCodeLine{00412 }
\DoxyCodeLine{00413 \textcolor{preprocessor}{\#ifdef ReadAllTags}}
\DoxyCodeLine{00414   FocalplaneXRes       = 0;}
\DoxyCodeLine{00415   FocalplaneUnits      = 0;}
\DoxyCodeLine{00416   ExifImageWidth       = 0;}
\DoxyCodeLine{00417   NumOrientations      = 0;}
\DoxyCodeLine{00418   DirWithThumbnailPtrs = NULL;}
\DoxyCodeLine{00419 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00420 }
\DoxyCodeLine{00421   \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}Exif header \%u bytes long\(\backslash\)n"{}}, length);}
\DoxyCodeLine{00422 }
\DoxyCodeLine{00423   \{  \textcolor{comment}{// Check the EXIF header component}}
\DoxyCodeLine{00424     \textcolor{keyword}{static} uchar ExifHeader[] = \textcolor{stringliteral}{"{}Exif\(\backslash\)0\(\backslash\)0"{}};}
\DoxyCodeLine{00425     \textcolor{keywordflow}{if} (memcmp(ExifSection + 2, ExifHeader, 6)) \{}
\DoxyCodeLine{00426       std::cout << \textcolor{stringliteral}{"{}Incorrect Exif header"{}} << std::endl;}
\DoxyCodeLine{00427       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00428     \}}
\DoxyCodeLine{00429   \}}
\DoxyCodeLine{00430 }
\DoxyCodeLine{00431   \textcolor{keywordflow}{if} (memcmp(ExifSection + 8, \textcolor{stringliteral}{"{}II"{}}, 2) == 0) \{}
\DoxyCodeLine{00432     \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}Exif section in Intel order\(\backslash\)n"{}});}
\DoxyCodeLine{00433     MotorolaOrder = 0;}
\DoxyCodeLine{00434   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00435     \textcolor{keywordflow}{if} (memcmp(ExifSection + 8, \textcolor{stringliteral}{"{}MM"{}}, 2) == 0) \{}
\DoxyCodeLine{00436       \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}Exif section in Motorola order\(\backslash\)n"{}});}
\DoxyCodeLine{00437       MotorolaOrder = 1;}
\DoxyCodeLine{00438     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00439       std::cout << \textcolor{stringliteral}{"{}Invalid Exif alignment marker."{}} << std::endl;}
\DoxyCodeLine{00440       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00441     \}}
\DoxyCodeLine{00442   \}}
\DoxyCodeLine{00443 }
\DoxyCodeLine{00444   \textcolor{comment}{// Check the next value for correctness.}}
\DoxyCodeLine{00445   \textcolor{keywordflow}{if} (Get16u(ExifSection + 10) != 0x2a) \{}
\DoxyCodeLine{00446     std::cout << \textcolor{stringliteral}{"{}Invalid Exif start (1)"{}} << std::endl;}
\DoxyCodeLine{00447     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00448   \}}
\DoxyCodeLine{00449 }
\DoxyCodeLine{00450   FirstOffset = Get32u(ExifSection + 12);}
\DoxyCodeLine{00451   \textcolor{keywordflow}{if} (FirstOffset < 8 || FirstOffset > 16) \{}
\DoxyCodeLine{00452     \textcolor{keywordflow}{if} (FirstOffset < 16 || FirstOffset > length -\/ 16) \{}
\DoxyCodeLine{00453       std::cout << \textcolor{stringliteral}{"{}invalid offset for first Exif IFD value"{}} << std::endl;}
\DoxyCodeLine{00454       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00455     \}}
\DoxyCodeLine{00456     \textcolor{comment}{// Usually set to 8, but other values valid too.}}
\DoxyCodeLine{00457     std::cout << \textcolor{stringliteral}{"{}Suspicious offset of first Exif IFD value"{}} << std::endl;}
\DoxyCodeLine{00458   \}}
\DoxyCodeLine{00459 }
\DoxyCodeLine{00460   \textcolor{comment}{// First directory starts 16 bytes in.  All offset are relative to 8 bytes in.}}
\DoxyCodeLine{00461   ProcessExifDir(ExifSection + 8 + FirstOffset, ExifSection + 8, length -\/ 8, 0);}
\DoxyCodeLine{00462 }
\DoxyCodeLine{00463 \textcolor{preprocessor}{\#ifdef ReadAllTags}}
\DoxyCodeLine{00464   \mbox{\hyperlink{class_image_info}{ImageInfo}}.ThumbnailAtEnd =}
\DoxyCodeLine{00465       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ThumbnailOffset >= \mbox{\hyperlink{class_image_info}{ImageInfo}}.LargestExifOffset ? TRUE : FALSE;}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467   \textcolor{keywordflow}{if} (DumpExifMap) \{}
\DoxyCodeLine{00468     \textcolor{keywordtype}{unsigned} a, b;}
\DoxyCodeLine{00469     printf(\textcolor{stringliteral}{"{}Map: \%05d-\/ End of exif\(\backslash\)n"{}}, length -\/ 8);}
\DoxyCodeLine{00470     \textcolor{keywordflow}{for} (a = 0; a < length -\/ 8; a += 10) \{}
\DoxyCodeLine{00471       printf(\textcolor{stringliteral}{"{}Map: \%05d "{}}, a);}
\DoxyCodeLine{00472       \textcolor{keywordflow}{for} (b = 0; b < 10; b++) printf(\textcolor{stringliteral}{"{} \%02x"{}}, *(ExifSection + 8 + a + b));}
\DoxyCodeLine{00473       printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00474     \}}
\DoxyCodeLine{00475   \}}
\DoxyCodeLine{00476 }
\DoxyCodeLine{00477   \textcolor{comment}{// Compute the CCD width, in millimeters.}}
\DoxyCodeLine{00478   \textcolor{keywordflow}{if} (FocalplaneXRes != 0 \&\& ExifImageWidth != 0) \{}
\DoxyCodeLine{00479     \textcolor{comment}{// Note: With some cameras, its not possible to compute this correctly}}
\DoxyCodeLine{00480     \textcolor{comment}{// because}}
\DoxyCodeLine{00481     \textcolor{comment}{// they don't adjust the indicated focal plane resolution units when using}}
\DoxyCodeLine{00482     \textcolor{comment}{// less}}
\DoxyCodeLine{00483     \textcolor{comment}{// than maximum resolution, so the CCDWidth value comes out too small.}}
\DoxyCodeLine{00484     \textcolor{comment}{// Nothing}}
\DoxyCodeLine{00485     \textcolor{comment}{// that Jhad can do about it -\/ its a camera problem.}}
\DoxyCodeLine{00486     \mbox{\hyperlink{class_image_info}{ImageInfo}}.CCDWidth =}
\DoxyCodeLine{00487         (float)(ExifImageWidth * FocalplaneUnits / FocalplaneXRes);}
\DoxyCodeLine{00488 }
\DoxyCodeLine{00489     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.FocalLength \&\& \mbox{\hyperlink{class_image_info}{ImageInfo}}.FocalLength35mmEquiv == 0) \{}
\DoxyCodeLine{00490       \textcolor{comment}{// Compute 35 mm equivalent focal length based on sensor geometry if we}}
\DoxyCodeLine{00491       \textcolor{comment}{// haven't}}
\DoxyCodeLine{00492       \textcolor{comment}{// already got it explicitly from a tag.}}
\DoxyCodeLine{00493       \mbox{\hyperlink{class_image_info}{ImageInfo}}.FocalLength35mmEquiv =}
\DoxyCodeLine{00494           (int)(\mbox{\hyperlink{class_image_info}{ImageInfo}}.FocalLength / \mbox{\hyperlink{class_image_info}{ImageInfo}}.CCDWidth * 36 + 0.5);}
\DoxyCodeLine{00495     \}}
\DoxyCodeLine{00496   \}}
\DoxyCodeLine{00497 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00498 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_jpg_exif_reader_ac9286403fe889c565d4f082c7ebe935f}\label{class_jpg_exif_reader_ac9286403fe889c565d4f082c7ebe935f}} 
\index{JpgExifReader@{JpgExifReader}!ProcessExifDir@{ProcessExifDir}}
\index{ProcessExifDir@{ProcessExifDir}!JpgExifReader@{JpgExifReader}}
\doxysubsubsection{\texorpdfstring{ProcessExifDir()}{ProcessExifDir()}}
{\footnotesize\ttfamily void Jpg\+Exif\+Reader\+::\+Process\+Exif\+Dir (\begin{DoxyParamCaption}\item[{unsigned char $\ast$}]{Dir\+Start,  }\item[{unsigned char $\ast$}]{Offset\+Base,  }\item[{unsigned}]{Exif\+Length,  }\item[{int}]{Nesting\+Level }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00505                                                                           \{}
\DoxyCodeLine{00506   \textcolor{keywordtype}{int} de;}
\DoxyCodeLine{00507   \textcolor{keywordtype}{int} a;}
\DoxyCodeLine{00508   \textcolor{keywordtype}{int} NumDirEntries;}
\DoxyCodeLine{00509   \textcolor{keywordtype}{unsigned} ThumbnailOffset = 0;}
\DoxyCodeLine{00510   \textcolor{keywordtype}{unsigned} ThumbnailSize   = 0;}
\DoxyCodeLine{00511   \textcolor{keywordtype}{char} IndentString[25];}
\DoxyCodeLine{00512 }
\DoxyCodeLine{00513   \textcolor{keywordflow}{if} (NestingLevel > 4) \{}
\DoxyCodeLine{00514     std::cout << \textcolor{stringliteral}{"{}Maximum Exif directory nesting exceeded (corrupt Exif header)"{}}}
\DoxyCodeLine{00515               << std::endl;}
\DoxyCodeLine{00516     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00517   \}}
\DoxyCodeLine{00518 }
\DoxyCodeLine{00519   memset(IndentString, \textcolor{charliteral}{' '}, 25);}
\DoxyCodeLine{00520   IndentString[NestingLevel * 4] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00521 }
\DoxyCodeLine{00522   NumDirEntries = Get16u(DirStart);}
\DoxyCodeLine{00523 \textcolor{preprocessor}{\#define DIR\_ENTRY\_ADDR(Start, Entry) (Start + 2 + 12 * (Entry))}}
\DoxyCodeLine{00524 }
\DoxyCodeLine{00525   \{}
\DoxyCodeLine{00526     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *DirEnd;}
\DoxyCodeLine{00527     DirEnd = DIR\_ENTRY\_ADDR(DirStart, NumDirEntries);}
\DoxyCodeLine{00528     \textcolor{keywordflow}{if} (DirEnd + 4 > (OffsetBase + ExifLength)) \{}
\DoxyCodeLine{00529       \textcolor{keywordflow}{if} (DirEnd + 2 == OffsetBase + ExifLength ||}
\DoxyCodeLine{00530           DirEnd == OffsetBase + ExifLength) \{}
\DoxyCodeLine{00531         \textcolor{comment}{// Version 1.3 of jhead would truncate a bit too much.}}
\DoxyCodeLine{00532         \textcolor{comment}{// This also caught later on as well.}}
\DoxyCodeLine{00533       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00534         std::cout << \textcolor{stringliteral}{"{}Illegally sized Exif subdirectory ("{}} << NumDirEntries}
\DoxyCodeLine{00535                   << \textcolor{stringliteral}{"{}entries)"{}} << std::endl;}
\DoxyCodeLine{00536         \textcolor{keywordflow}{return};}
\DoxyCodeLine{00537       \}}
\DoxyCodeLine{00538     \}}
\DoxyCodeLine{00539     \textcolor{keywordflow}{if} (DumpExifMap) \{}
\DoxyCodeLine{00540       printf(\textcolor{stringliteral}{"{}Map: \%05u-\/\%05u: Directory\(\backslash\)n"{}}, (\textcolor{keywordtype}{int})(DirStart -\/ OffsetBase),}
\DoxyCodeLine{00541              (\textcolor{keywordtype}{int})(DirEnd + 4 -\/ OffsetBase));}
\DoxyCodeLine{00542     \}}
\DoxyCodeLine{00543   \}}
\DoxyCodeLine{00544 }
\DoxyCodeLine{00545   \textcolor{keywordflow}{if} (ShowTags) \{}
\DoxyCodeLine{00546     printf(\textcolor{stringliteral}{"{}(dir has \%d entries)\(\backslash\)n"{}}, NumDirEntries);}
\DoxyCodeLine{00547   \}}
\DoxyCodeLine{00548 }
\DoxyCodeLine{00549   \textcolor{keywordflow}{for} (de = 0; de < NumDirEntries; de++) \{}
\DoxyCodeLine{00550     \textcolor{keywordtype}{int} Tag, Format, Components;}
\DoxyCodeLine{00551     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *ValuePtr;}
\DoxyCodeLine{00552     \textcolor{keywordtype}{int} ByteCount;}
\DoxyCodeLine{00553     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *DirEntry;}
\DoxyCodeLine{00554     DirEntry = DIR\_ENTRY\_ADDR(DirStart, de);}
\DoxyCodeLine{00555 }
\DoxyCodeLine{00556     Tag        = Get16u(DirEntry);}
\DoxyCodeLine{00557     Format     = Get16u(DirEntry + 2);}
\DoxyCodeLine{00558     Components = Get32u(DirEntry + 4);}
\DoxyCodeLine{00559 }
\DoxyCodeLine{00560     \textcolor{keywordflow}{if} ((Format -\/ 1) >= NUM\_FORMATS) \{}
\DoxyCodeLine{00561       \textcolor{comment}{// (-\/1) catches illegal zero case as unsigned underflows to positive}}
\DoxyCodeLine{00562       \textcolor{comment}{// large.}}
\DoxyCodeLine{00563       std::cout << \textcolor{stringliteral}{"{}Illegal number format "{}} << Format << \textcolor{stringliteral}{"{} for tag "{}} << Tag}
\DoxyCodeLine{00564                 << \textcolor{stringliteral}{"{} in Exif"{}} << std::endl;}
\DoxyCodeLine{00565       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00566     \}}
\DoxyCodeLine{00567 }
\DoxyCodeLine{00568     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})Components > 0x10000) \{}
\DoxyCodeLine{00569       std::cout << \textcolor{stringliteral}{"{}Too many components "{}} << Components << \textcolor{stringliteral}{"{} for tag "{}} << Tag}
\DoxyCodeLine{00570                 << \textcolor{stringliteral}{"{} in Exif"{}};}
\DoxyCodeLine{00571       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00572     \}}
\DoxyCodeLine{00573 }
\DoxyCodeLine{00574     ByteCount = Components * BytesPerFormat[Format];}
\DoxyCodeLine{00575 }
\DoxyCodeLine{00576     \textcolor{keywordflow}{if} (ByteCount > 4) \{}
\DoxyCodeLine{00577       \textcolor{keywordtype}{unsigned} OffsetVal;}
\DoxyCodeLine{00578       OffsetVal = Get32u(DirEntry + 8);}
\DoxyCodeLine{00579       \textcolor{comment}{// If its bigger than 4 bytes, the dir entry contains an offset.}}
\DoxyCodeLine{00580       \textcolor{keywordflow}{if} (OffsetVal + ByteCount > ExifLength) \{}
\DoxyCodeLine{00581         \textcolor{comment}{// Bogus pointer offset and / or bytecount value}}
\DoxyCodeLine{00582         std::cout << \textcolor{stringliteral}{"{}Illegal value pointer for tag "{}} << Tag << \textcolor{stringliteral}{"{} in Exif"{}};}
\DoxyCodeLine{00583         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00584       \}}
\DoxyCodeLine{00585       ValuePtr = OffsetBase + OffsetVal;}
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587 \textcolor{preprocessor}{\#ifdef ReadAllTags}}
\DoxyCodeLine{00588       \textcolor{keywordflow}{if} (OffsetVal > \mbox{\hyperlink{class_image_info}{ImageInfo}}.LargestExifOffset) \{}
\DoxyCodeLine{00589         \mbox{\hyperlink{class_image_info}{ImageInfo}}.LargestExifOffset = OffsetVal;}
\DoxyCodeLine{00590       \}}
\DoxyCodeLine{00591 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00592 }
\DoxyCodeLine{00593       \textcolor{keywordflow}{if} (DumpExifMap) \{}
\DoxyCodeLine{00594         printf(\textcolor{stringliteral}{"{}Map: \%05u-\/\%05u:   Data for tag \%04x\(\backslash\)n"{}}, OffsetVal,}
\DoxyCodeLine{00595                OffsetVal + ByteCount, Tag);}
\DoxyCodeLine{00596       \}}
\DoxyCodeLine{00597     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00598       \textcolor{comment}{// 4 bytes or less and value is in the dir entry itself}}
\DoxyCodeLine{00599       ValuePtr = DirEntry + 8;}
\DoxyCodeLine{00600     \}}
\DoxyCodeLine{00601 }
\DoxyCodeLine{00602 \textcolor{preprocessor}{\#ifdef ReadAllTags}}
\DoxyCodeLine{00603     \textcolor{keywordflow}{if} (Tag == TAG\_MAKER\_NOTE) \{}
\DoxyCodeLine{00604       \textcolor{keywordflow}{if} (ShowTags) \{}
\DoxyCodeLine{00605         printf(\textcolor{stringliteral}{"{}\%s    Maker note: "{}}, IndentString);}
\DoxyCodeLine{00606       \}}
\DoxyCodeLine{00607       \textcolor{comment}{// ProcessMakerNote(ValuePtr, ByteCount, OffsetBase, ExifLength);}}
\DoxyCodeLine{00608       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00609     \}}
\DoxyCodeLine{00610 }
\DoxyCodeLine{00611     \textcolor{keywordflow}{if} (ShowTags) \{}
\DoxyCodeLine{00612       \textcolor{comment}{// Show tag name}}
\DoxyCodeLine{00613       \textcolor{keywordflow}{for} (a = 0;; a++) \{}
\DoxyCodeLine{00614         \textcolor{keywordflow}{if} (a >= TAG\_TABLE\_SIZE) \{}
\DoxyCodeLine{00615           printf(\textcolor{stringliteral}{"{}\%s    Unknown Tag \%04x Value = "{}}, IndentString, Tag);}
\DoxyCodeLine{00616           \textcolor{keywordflow}{break};}
\DoxyCodeLine{00617         \}}
\DoxyCodeLine{00618         \textcolor{keywordflow}{if} (TagTable[a].Tag == Tag) \{}
\DoxyCodeLine{00619           printf(\textcolor{stringliteral}{"{}\%s    \%s = "{}}, IndentString, TagTable[a].Desc);}
\DoxyCodeLine{00620           \textcolor{keywordflow}{break};}
\DoxyCodeLine{00621         \}}
\DoxyCodeLine{00622       \}}
\DoxyCodeLine{00623 }
\DoxyCodeLine{00624       \textcolor{comment}{// Show tag value.}}
\DoxyCodeLine{00625       \textcolor{keywordflow}{switch} (Format) \{}
\DoxyCodeLine{00626       \textcolor{keywordflow}{case} FMT\_BYTE:}
\DoxyCodeLine{00627         \textcolor{keywordflow}{if} (ByteCount > 1) \{}
\DoxyCodeLine{00628           printf(\textcolor{stringliteral}{"{}\%.*ls\(\backslash\)n"{}}, ByteCount / 2, (\textcolor{keywordtype}{wchar\_t} *)ValuePtr);}
\DoxyCodeLine{00629         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00630           PrintFormatNumber(ValuePtr, Format, ByteCount);}
\DoxyCodeLine{00631           printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00632         \}}
\DoxyCodeLine{00633         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00634 }
\DoxyCodeLine{00635       \textcolor{keywordflow}{case} FMT\_UNDEFINED:}
\DoxyCodeLine{00636         \textcolor{comment}{// Undefined is typically an ascii string.}}
\DoxyCodeLine{00637 }
\DoxyCodeLine{00638       \textcolor{keywordflow}{case} FMT\_STRING:}
\DoxyCodeLine{00639         \textcolor{comment}{// String arrays printed without function call (different from int}}
\DoxyCodeLine{00640         \textcolor{comment}{// arrays)}}
\DoxyCodeLine{00641         \{}
\DoxyCodeLine{00642           \textcolor{keywordtype}{int} NoPrint = 0;}
\DoxyCodeLine{00643           printf(\textcolor{stringliteral}{"{}\(\backslash\)"{}"{}});}
\DoxyCodeLine{00644           \textcolor{keywordflow}{for} (a = 0; a < ByteCount; a++) \{}
\DoxyCodeLine{00645             \textcolor{keywordflow}{if} (ValuePtr[a] >= 32) \{}
\DoxyCodeLine{00646               putchar(ValuePtr[a]);}
\DoxyCodeLine{00647               NoPrint = 0;}
\DoxyCodeLine{00648             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00649               \textcolor{comment}{// Avoiding indicating too many unprintable characters of}}
\DoxyCodeLine{00650               \textcolor{comment}{// proprietary}}
\DoxyCodeLine{00651               \textcolor{comment}{// bits of binary information this program may not know how to}}
\DoxyCodeLine{00652               \textcolor{comment}{// parse.}}
\DoxyCodeLine{00653               \textcolor{keywordflow}{if} (!NoPrint \&\& a != ByteCount -\/ 1) \{}
\DoxyCodeLine{00654                 putchar(\textcolor{charliteral}{'?'});}
\DoxyCodeLine{00655                 NoPrint = 1;}
\DoxyCodeLine{00656               \}}
\DoxyCodeLine{00657             \}}
\DoxyCodeLine{00658           \}}
\DoxyCodeLine{00659           printf(\textcolor{stringliteral}{"{}\(\backslash\)"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00660         \}}
\DoxyCodeLine{00661         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00662 }
\DoxyCodeLine{00663       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00664         \textcolor{comment}{// Handle arrays of numbers later (will there ever be?)}}
\DoxyCodeLine{00665         PrintFormatNumber(ValuePtr, Format, ByteCount);}
\DoxyCodeLine{00666         printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00667       \}}
\DoxyCodeLine{00668     \}}
\DoxyCodeLine{00669 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00670     \textcolor{comment}{// Extract useful components of tag}}
\DoxyCodeLine{00671     \textcolor{keywordflow}{switch} (Tag) \{}
\DoxyCodeLine{00672 \textcolor{preprocessor}{\#ifdef ReadAllTags}}
\DoxyCodeLine{00673     \textcolor{keywordflow}{case} TAG\_MAKE:}
\DoxyCodeLine{00674       strncpy(\mbox{\hyperlink{class_image_info}{ImageInfo}}.CameraMake, (\textcolor{keywordtype}{char} *)ValuePtr,}
\DoxyCodeLine{00675               ByteCount < 31 ? ByteCount : 31);}
\DoxyCodeLine{00676       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00677 }
\DoxyCodeLine{00678     \textcolor{keywordflow}{case} TAG\_MODEL:}
\DoxyCodeLine{00679       strncpy(\mbox{\hyperlink{class_image_info}{ImageInfo}}.CameraModel, (\textcolor{keywordtype}{char} *)ValuePtr,}
\DoxyCodeLine{00680               ByteCount < 39 ? ByteCount : 39);}
\DoxyCodeLine{00681       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00682 }
\DoxyCodeLine{00683     \textcolor{keywordflow}{case} TAG\_DATETIME\_ORIGINAL:}
\DoxyCodeLine{00684       \textcolor{comment}{// If we get a DATETIME\_ORIGINAL, we use that one.}}
\DoxyCodeLine{00685       strncpy(\mbox{\hyperlink{class_image_info}{ImageInfo}}.DateTime, (\textcolor{keywordtype}{char} *)ValuePtr, 19);}
\DoxyCodeLine{00686       \textcolor{comment}{// Fallthru...}}
\DoxyCodeLine{00687 }
\DoxyCodeLine{00688     \textcolor{keywordflow}{case} TAG\_DATETIME\_DIGITIZED:}
\DoxyCodeLine{00689     \textcolor{keywordflow}{case} TAG\_DATETIME:}
\DoxyCodeLine{00690       \textcolor{keywordflow}{if} (!isdigit(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}\textcolor{keyword}{>}(\mbox{\hyperlink{class_image_info}{ImageInfo}}.DateTime[0]))) \{}
\DoxyCodeLine{00691         \textcolor{comment}{// If we don't already have a DATETIME\_ORIGINAL, use whatever}}
\DoxyCodeLine{00692         \textcolor{comment}{// time fields we may have.}}
\DoxyCodeLine{00693         strncpy(\mbox{\hyperlink{class_image_info}{ImageInfo}}.DateTime, (\textcolor{keywordtype}{char} *)ValuePtr, 19);}
\DoxyCodeLine{00694       \}}
\DoxyCodeLine{00695 }
\DoxyCodeLine{00696       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.numDateTimeTags >= MAX\_DATE\_COPIES) \{}
\DoxyCodeLine{00697         std::cout << \textcolor{stringliteral}{"{}More than "{}} << MAX\_DATE\_COPIES}
\DoxyCodeLine{00698                   << \textcolor{stringliteral}{"{} date fields in Exif.  This is nuts"{}} << std::endl;}
\DoxyCodeLine{00699         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00700       \}}
\DoxyCodeLine{00701       \mbox{\hyperlink{class_image_info}{ImageInfo}}.DateTimeOffsets[\mbox{\hyperlink{class_image_info}{ImageInfo}}.numDateTimeTags++] =}
\DoxyCodeLine{00702           (\textcolor{keywordtype}{char} *)ValuePtr -\/ (\textcolor{keywordtype}{char} *)OffsetBase;}
\DoxyCodeLine{00703       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00704 }
\DoxyCodeLine{00705     \textcolor{keywordflow}{case} TAG\_WINXP\_COMMENT:}
\DoxyCodeLine{00706       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.Comments[0]) \{  \textcolor{comment}{// We already have a jpeg comment.}}
\DoxyCodeLine{00707         \textcolor{comment}{// Already have a comment (probably windows comment), skip this one.}}
\DoxyCodeLine{00708         \textcolor{keywordflow}{if} (ShowTags)}
\DoxyCodeLine{00709           printf(\textcolor{stringliteral}{"{}Windows XP comment and other comment in header\(\backslash\)n"{}});}
\DoxyCodeLine{00710         \textcolor{keywordflow}{break};  \textcolor{comment}{// Already have a windows comment, skip this one.}}
\DoxyCodeLine{00711       \}}
\DoxyCodeLine{00712 }
\DoxyCodeLine{00713       \textcolor{keywordflow}{if} (ByteCount > 1) \{}
\DoxyCodeLine{00714         \textcolor{keywordflow}{if} (ByteCount > MAX\_COMMENT\_SIZE) ByteCount = MAX\_COMMENT\_SIZE;}
\DoxyCodeLine{00715         memcpy(\mbox{\hyperlink{class_image_info}{ImageInfo}}.Comments, ValuePtr, ByteCount);}
\DoxyCodeLine{00716         \mbox{\hyperlink{class_image_info}{ImageInfo}}.CommentWidthchars = ByteCount / 2;}
\DoxyCodeLine{00717       \}}
\DoxyCodeLine{00718       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00719 }
\DoxyCodeLine{00720     \textcolor{keywordflow}{case} TAG\_USERCOMMENT:}
\DoxyCodeLine{00721       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.Comments[0]) \{  \textcolor{comment}{// We already have a jpeg comment.}}
\DoxyCodeLine{00722         \textcolor{comment}{// Already have a comment (probably windows comment), skip this one.}}
\DoxyCodeLine{00723         \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}Multiple comments in exif header\(\backslash\)n"{}});}
\DoxyCodeLine{00724         \textcolor{keywordflow}{break};  \textcolor{comment}{// Already have a windows comment, skip this one.}}
\DoxyCodeLine{00725       \}}
\DoxyCodeLine{00726 }
\DoxyCodeLine{00727       \textcolor{comment}{// Comment is often padded with trailing spaces.  Remove these first.}}
\DoxyCodeLine{00728       \textcolor{keywordflow}{for} (a = ByteCount;;) \{}
\DoxyCodeLine{00729         a-\/-\/;}
\DoxyCodeLine{00730         \textcolor{keywordflow}{if} ((ValuePtr)[a] == \textcolor{charliteral}{' '}) \{}
\DoxyCodeLine{00731           (ValuePtr)[a] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00732         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00733           \textcolor{keywordflow}{break};}
\DoxyCodeLine{00734         \}}
\DoxyCodeLine{00735         \textcolor{keywordflow}{if} (a == 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{00736       \}}
\DoxyCodeLine{00737 }
\DoxyCodeLine{00738       \textcolor{comment}{// Copy the comment}}
\DoxyCodeLine{00739       \{}
\DoxyCodeLine{00740         \textcolor{keywordtype}{int} msiz = ExifLength -\/ (ValuePtr -\/ OffsetBase);}
\DoxyCodeLine{00741         \textcolor{keywordflow}{if} (msiz > ByteCount) msiz = ByteCount;}
\DoxyCodeLine{00742         \textcolor{keywordflow}{if} (msiz > MAX\_COMMENT\_SIZE -\/ 1) msiz = MAX\_COMMENT\_SIZE -\/ 1;}
\DoxyCodeLine{00743         \textcolor{keywordflow}{if} (msiz > 5 \&\& memcmp(ValuePtr, \textcolor{stringliteral}{"{}ASCII"{}}, 5) == 0) \{}
\DoxyCodeLine{00744           \textcolor{keywordflow}{for} (a = 5; a < 10 \&\& a < msiz; a++) \{}
\DoxyCodeLine{00745             \textcolor{keywordtype}{int} c = (ValuePtr)[a];}
\DoxyCodeLine{00746             \textcolor{keywordflow}{if} (c != \textcolor{charliteral}{'\(\backslash\)0'} \&\& c != \textcolor{charliteral}{' '}) \{}
\DoxyCodeLine{00747               strncpy(\mbox{\hyperlink{class_image_info}{ImageInfo}}.Comments, (\textcolor{keywordtype}{char} *)ValuePtr + a, msiz -\/ a);}
\DoxyCodeLine{00748               \textcolor{keywordflow}{break};}
\DoxyCodeLine{00749             \}}
\DoxyCodeLine{00750           \}}
\DoxyCodeLine{00751         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00752           strncpy(\mbox{\hyperlink{class_image_info}{ImageInfo}}.Comments, (\textcolor{keywordtype}{char} *)ValuePtr, msiz);}
\DoxyCodeLine{00753         \}}
\DoxyCodeLine{00754       \}}
\DoxyCodeLine{00755       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00756 }
\DoxyCodeLine{00757     \textcolor{keywordflow}{case} TAG\_FNUMBER:}
\DoxyCodeLine{00758       \textcolor{comment}{// Simplest way of expressing aperture, so I trust it the most.}}
\DoxyCodeLine{00759       \textcolor{comment}{// (overwrite previously computd value if there is one)}}
\DoxyCodeLine{00760       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ApertureFNumber = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00761       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00762 }
\DoxyCodeLine{00763     \textcolor{keywordflow}{case} TAG\_APERTURE:}
\DoxyCodeLine{00764     \textcolor{keywordflow}{case} TAG\_MAXAPERTURE:}
\DoxyCodeLine{00765       \textcolor{comment}{// More relevant info always comes earlier, so only use this field if we}}
\DoxyCodeLine{00766       \textcolor{comment}{// don't}}
\DoxyCodeLine{00767       \textcolor{comment}{// have appropriate aperture information yet.}}
\DoxyCodeLine{00768       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.ApertureFNumber == 0) \{}
\DoxyCodeLine{00769         \mbox{\hyperlink{class_image_info}{ImageInfo}}.ApertureFNumber =}
\DoxyCodeLine{00770             (float)exp(ConvertAnyFormat(ValuePtr, Format) * log(2) * 0.5);}
\DoxyCodeLine{00771       \}}
\DoxyCodeLine{00772       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00773 }
\DoxyCodeLine{00774     \textcolor{keywordflow}{case} TAG\_FOCALLENGTH:}
\DoxyCodeLine{00775       \textcolor{comment}{// Nice digital cameras actually save the focal length as a function}}
\DoxyCodeLine{00776       \textcolor{comment}{// of how farthey are zoomed in.}}
\DoxyCodeLine{00777       \mbox{\hyperlink{class_image_info}{ImageInfo}}.FocalLength = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00778       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00779 }
\DoxyCodeLine{00780     \textcolor{keywordflow}{case} TAG\_SUBJECT\_DISTANCE:}
\DoxyCodeLine{00781       \textcolor{comment}{// Inidcates the distacne the autofocus camera is focused to.}}
\DoxyCodeLine{00782       \textcolor{comment}{// Tends to be less accurate as distance increases.}}
\DoxyCodeLine{00783       \mbox{\hyperlink{class_image_info}{ImageInfo}}.Distance = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00784       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00785 }
\DoxyCodeLine{00786     \textcolor{keywordflow}{case} TAG\_EXPOSURETIME:}
\DoxyCodeLine{00787       \textcolor{comment}{// Simplest way of expressing exposure time, so I trust it most.}}
\DoxyCodeLine{00788       \textcolor{comment}{// (overwrite previously computd value if there is one)}}
\DoxyCodeLine{00789       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ExposureTime = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00790       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00791 }
\DoxyCodeLine{00792     \textcolor{keywordflow}{case} TAG\_SHUTTERSPEED:}
\DoxyCodeLine{00793       \textcolor{comment}{// More complicated way of expressing exposure time, so only use}}
\DoxyCodeLine{00794       \textcolor{comment}{// this value if we don't already have it from somewhere else.}}
\DoxyCodeLine{00795       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.ExposureTime == 0) \{}
\DoxyCodeLine{00796         \mbox{\hyperlink{class_image_info}{ImageInfo}}.ExposureTime =}
\DoxyCodeLine{00797             (float)(1 / exp(ConvertAnyFormat(ValuePtr, Format) * log(2)));}
\DoxyCodeLine{00798       \}}
\DoxyCodeLine{00799       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00800 }
\DoxyCodeLine{00801     \textcolor{keywordflow}{case} TAG\_FLASH:}
\DoxyCodeLine{00802       \mbox{\hyperlink{class_image_info}{ImageInfo}}.FlashUsed = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00803       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00804 }
\DoxyCodeLine{00805     \textcolor{keywordflow}{case} TAG\_ORIENTATION:}
\DoxyCodeLine{00806       \textcolor{keywordflow}{if} (NumOrientations >= 2) \{}
\DoxyCodeLine{00807         \textcolor{comment}{// Can have another orientation tag for the thumbnail, but if there's}}
\DoxyCodeLine{00808         \textcolor{comment}{// a third one, things are strange.}}
\DoxyCodeLine{00809         std::cout << \textcolor{stringliteral}{"{}More than two orientation in Exif"{}} << std::endl;}
\DoxyCodeLine{00810         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00811       \}}
\DoxyCodeLine{00812       OrientationPtr[NumOrientations]       = ValuePtr;}
\DoxyCodeLine{00813       OrientationNumFormat[NumOrientations] = Format;}
\DoxyCodeLine{00814       \textcolor{keywordflow}{if} (NumOrientations == 0) \{}
\DoxyCodeLine{00815         \mbox{\hyperlink{class_image_info}{ImageInfo}}.Orientation = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00816       \}}
\DoxyCodeLine{00817       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.Orientation < 0 || \mbox{\hyperlink{class_image_info}{ImageInfo}}.Orientation > 8) \{}
\DoxyCodeLine{00818         std::cout << \textcolor{stringliteral}{"{}Undefined rotation value "{}} << \mbox{\hyperlink{class_image_info}{ImageInfo}}.Orientation}
\DoxyCodeLine{00819                   << \textcolor{stringliteral}{"{} in Exif"{}} << std::endl;}
\DoxyCodeLine{00820       \}}
\DoxyCodeLine{00821       NumOrientations += 1;}
\DoxyCodeLine{00822       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00823 }
\DoxyCodeLine{00824     \textcolor{keywordflow}{case} TAG\_PIXEL\_Y\_DIMENSION:}
\DoxyCodeLine{00825     \textcolor{keywordflow}{case} TAG\_PIXEL\_X\_DIMENSION:}
\DoxyCodeLine{00826       \textcolor{comment}{// Use largest of height and width to deal with images that have been}}
\DoxyCodeLine{00827       \textcolor{comment}{// rotated to portrait format.}}
\DoxyCodeLine{00828       a = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00829       \textcolor{keywordflow}{if} (ExifImageWidth < a) ExifImageWidth = a;}
\DoxyCodeLine{00830       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00831 }
\DoxyCodeLine{00832     \textcolor{keywordflow}{case} TAG\_FOCAL\_PLANE\_XRES:}
\DoxyCodeLine{00833       FocalplaneXRes = ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00834       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00835 }
\DoxyCodeLine{00836     \textcolor{keywordflow}{case} TAG\_FOCAL\_PLANE\_UNITS:}
\DoxyCodeLine{00837       \textcolor{keywordflow}{switch} ((\textcolor{keywordtype}{int})ConvertAnyFormat(ValuePtr, Format)) \{}
\DoxyCodeLine{00838       \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{00839         FocalplaneUnits = 25.4;}
\DoxyCodeLine{00840         \textcolor{keywordflow}{break};  \textcolor{comment}{// inch}}
\DoxyCodeLine{00841       \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{00842         \textcolor{comment}{// According to the information I was using, 2 means meters.}}
\DoxyCodeLine{00843         \textcolor{comment}{// But looking at the Cannon powershot's files, inches is the only}}
\DoxyCodeLine{00844         \textcolor{comment}{// sensible value.}}
\DoxyCodeLine{00845         FocalplaneUnits = 25.4;}
\DoxyCodeLine{00846         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00847 }
\DoxyCodeLine{00848       \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{00849         FocalplaneUnits = 10;}
\DoxyCodeLine{00850         \textcolor{keywordflow}{break};  \textcolor{comment}{// centimeter}}
\DoxyCodeLine{00851       \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{00852         FocalplaneUnits = 1;}
\DoxyCodeLine{00853         \textcolor{keywordflow}{break};  \textcolor{comment}{// millimeter}}
\DoxyCodeLine{00854       \textcolor{keywordflow}{case} 5:}
\DoxyCodeLine{00855         FocalplaneUnits = .001;}
\DoxyCodeLine{00856         \textcolor{keywordflow}{break};  \textcolor{comment}{// micrometer}}
\DoxyCodeLine{00857       \}}
\DoxyCodeLine{00858       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00859 }
\DoxyCodeLine{00860     \textcolor{keywordflow}{case} TAG\_EXPOSURE\_BIAS:}
\DoxyCodeLine{00861       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ExposureBias = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00862       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00863 }
\DoxyCodeLine{00864     \textcolor{keywordflow}{case} TAG\_WHITEBALANCE:}
\DoxyCodeLine{00865       \mbox{\hyperlink{class_image_info}{ImageInfo}}.Whitebalance = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00866       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00867 }
\DoxyCodeLine{00868     \textcolor{keywordflow}{case} TAG\_LIGHT\_SOURCE:}
\DoxyCodeLine{00869       \mbox{\hyperlink{class_image_info}{ImageInfo}}.LightSource = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00870       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00871 }
\DoxyCodeLine{00872     \textcolor{keywordflow}{case} TAG\_METERING\_MODE:}
\DoxyCodeLine{00873       \mbox{\hyperlink{class_image_info}{ImageInfo}}.MeteringMode = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00874       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00875 }
\DoxyCodeLine{00876     \textcolor{keywordflow}{case} TAG\_EXPOSURE\_PROGRAM:}
\DoxyCodeLine{00877       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ExposureProgram = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00878       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00879 }
\DoxyCodeLine{00880     \textcolor{keywordflow}{case} TAG\_EXPOSURE\_INDEX:}
\DoxyCodeLine{00881       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.ISOequivalent == 0) \{}
\DoxyCodeLine{00882         \textcolor{comment}{// Exposure index and ISO equivalent are often used interchangeably,}}
\DoxyCodeLine{00883         \textcolor{comment}{// so we will do the same in jhead.}}
\DoxyCodeLine{00884         \textcolor{comment}{// http://photography.about.com/library/glossary/bldef\_ei.htm}}
\DoxyCodeLine{00885         \mbox{\hyperlink{class_image_info}{ImageInfo}}.ISOequivalent = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00886       \}}
\DoxyCodeLine{00887       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00888 }
\DoxyCodeLine{00889     \textcolor{keywordflow}{case} TAG\_EXPOSURE\_MODE:}
\DoxyCodeLine{00890       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ExposureMode = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00891       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00892 }
\DoxyCodeLine{00893     \textcolor{keywordflow}{case} TAG\_ISO\_EQUIVALENT:}
\DoxyCodeLine{00894       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ISOequivalent = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00895       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00896 }
\DoxyCodeLine{00897     \textcolor{keywordflow}{case} TAG\_DIGITALZOOMRATIO:}
\DoxyCodeLine{00898       \mbox{\hyperlink{class_image_info}{ImageInfo}}.DigitalZoomRatio = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00899       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00900 }
\DoxyCodeLine{00901     \textcolor{keywordflow}{case} TAG\_THUMBNAIL\_OFFSET:}
\DoxyCodeLine{00902       ThumbnailOffset      = (unsigned)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00903       DirWithThumbnailPtrs = DirStart;}
\DoxyCodeLine{00904       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00905 }
\DoxyCodeLine{00906     \textcolor{keywordflow}{case} TAG\_THUMBNAIL\_LENGTH:}
\DoxyCodeLine{00907       ThumbnailSize = (unsigned)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00908       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ThumbnailSizeOffset = ValuePtr -\/ OffsetBase;}
\DoxyCodeLine{00909       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00910 }
\DoxyCodeLine{00911     \textcolor{keywordflow}{case} TAG\_EXIF\_OFFSET:}
\DoxyCodeLine{00912       \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}\%s    Exif Dir:"{}}, IndentString);}
\DoxyCodeLine{00913 }
\DoxyCodeLine{00914     \textcolor{keywordflow}{case} TAG\_INTEROP\_OFFSET:}
\DoxyCodeLine{00915       \textcolor{keywordflow}{if} (Tag == TAG\_INTEROP\_OFFSET \&\& ShowTags)}
\DoxyCodeLine{00916         printf(\textcolor{stringliteral}{"{}\%s    Interop Dir:"{}}, IndentString);}
\DoxyCodeLine{00917       \{}
\DoxyCodeLine{00918         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *SubdirStart;}
\DoxyCodeLine{00919         SubdirStart = OffsetBase + Get32u(ValuePtr);}
\DoxyCodeLine{00920         \textcolor{keywordflow}{if} (SubdirStart < OffsetBase || SubdirStart > OffsetBase + ExifLength) \{}
\DoxyCodeLine{00921           std::cout << \textcolor{stringliteral}{"{}Illegal Exif or interop ofset directory link"{}}}
\DoxyCodeLine{00922                     << std::endl;}
\DoxyCodeLine{00923         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00924           ProcessExifDir(SubdirStart, OffsetBase, ExifLength, NestingLevel + 1);}
\DoxyCodeLine{00925         \}}
\DoxyCodeLine{00926         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00927       \}}
\DoxyCodeLine{00928       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00929 }
\DoxyCodeLine{00930     \textcolor{keywordflow}{case} TAG\_GPSINFO:}
\DoxyCodeLine{00931       \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}\%s    GPS info dir:"{}}, IndentString);}
\DoxyCodeLine{00932       \{}
\DoxyCodeLine{00933         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *SubdirStart;}
\DoxyCodeLine{00934         SubdirStart = OffsetBase + Get32u(ValuePtr);}
\DoxyCodeLine{00935         \textcolor{keywordflow}{if} (SubdirStart < OffsetBase || SubdirStart > OffsetBase + ExifLength) \{}
\DoxyCodeLine{00936           std::cout << \textcolor{stringliteral}{"{}Illegal GPS directory link in Exif"{}} << std::endl;}
\DoxyCodeLine{00937         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00938           \textcolor{comment}{// ProcessGpsInfo(SubdirStart, OffsetBase, ExifLength);}}
\DoxyCodeLine{00939         \}}
\DoxyCodeLine{00940         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00941       \}}
\DoxyCodeLine{00942       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944     \textcolor{keywordflow}{case} TAG\_FOCALLENGTH\_35MM:}
\DoxyCodeLine{00945       \textcolor{comment}{// The focal length equivalent 35 mm is a 2.2 tag (defined as of April}}
\DoxyCodeLine{00946       \textcolor{comment}{// 2002)}}
\DoxyCodeLine{00947       \textcolor{comment}{// if its present, use it to compute equivalent focal length instead of}}
\DoxyCodeLine{00948       \textcolor{comment}{// computing it from sensor geometry and actual focal length.}}
\DoxyCodeLine{00949       \mbox{\hyperlink{class_image_info}{ImageInfo}}.FocalLength35mmEquiv =}
\DoxyCodeLine{00950           (unsigned)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00951       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00952 }
\DoxyCodeLine{00953     \textcolor{keywordflow}{case} TAG\_DISTANCE\_RANGE:}
\DoxyCodeLine{00954       \textcolor{comment}{// Three possible standard values:}}
\DoxyCodeLine{00955       \textcolor{comment}{//   1 = macro, 2 = close, 3 = distant}}
\DoxyCodeLine{00956       \mbox{\hyperlink{class_image_info}{ImageInfo}}.DistanceRange = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00957       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00958 }
\DoxyCodeLine{00959 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00960 }
\DoxyCodeLine{00961     \textcolor{keywordflow}{case} TAG\_X\_RESOLUTION:}
\DoxyCodeLine{00962       \textcolor{keywordflow}{if} (NestingLevel ==}
\DoxyCodeLine{00963           0) \{  \textcolor{comment}{// Only use the values from the top level directory}}
\DoxyCodeLine{00964         \mbox{\hyperlink{class_image_info}{ImageInfo}}.xResolution = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00965         \textcolor{comment}{// if yResolution has not been set, use the value of xResolution}}
\DoxyCodeLine{00966         \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.yResolution == 0.0)}
\DoxyCodeLine{00967           \mbox{\hyperlink{class_image_info}{ImageInfo}}.yResolution = \mbox{\hyperlink{class_image_info}{ImageInfo}}.xResolution;}
\DoxyCodeLine{00968       \}}
\DoxyCodeLine{00969       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00970 }
\DoxyCodeLine{00971     \textcolor{keywordflow}{case} TAG\_Y\_RESOLUTION:}
\DoxyCodeLine{00972       \textcolor{keywordflow}{if} (NestingLevel ==}
\DoxyCodeLine{00973           0) \{  \textcolor{comment}{// Only use the values from the top level directory}}
\DoxyCodeLine{00974         \mbox{\hyperlink{class_image_info}{ImageInfo}}.yResolution = (float)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00975         \textcolor{comment}{// if xResolution has not been set, use the value of yResolution}}
\DoxyCodeLine{00976         \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_info}{ImageInfo}}.xResolution == 0.0)}
\DoxyCodeLine{00977           \mbox{\hyperlink{class_image_info}{ImageInfo}}.xResolution = \mbox{\hyperlink{class_image_info}{ImageInfo}}.yResolution;}
\DoxyCodeLine{00978       \}}
\DoxyCodeLine{00979       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00980 }
\DoxyCodeLine{00981     \textcolor{keywordflow}{case} TAG\_RESOLUTION\_UNIT:}
\DoxyCodeLine{00982       \textcolor{keywordflow}{if} (NestingLevel ==}
\DoxyCodeLine{00983           0) \{  \textcolor{comment}{// Only use the values from the top level directory}}
\DoxyCodeLine{00984         \mbox{\hyperlink{class_image_info}{ImageInfo}}.ResolutionUnit = (int)ConvertAnyFormat(ValuePtr, Format);}
\DoxyCodeLine{00985       \}}
\DoxyCodeLine{00986       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00987     \}}
\DoxyCodeLine{00988   \}}
\DoxyCodeLine{00989 }
\DoxyCodeLine{00990 \textcolor{preprocessor}{\#ifdef ReadAllTags}}
\DoxyCodeLine{00991   \{}
\DoxyCodeLine{00992     \textcolor{comment}{// In addition to linking to subdirectories via exif tags,}}
\DoxyCodeLine{00993     \textcolor{comment}{// there's also a potential link to another directory at the end of each}}
\DoxyCodeLine{00994     \textcolor{comment}{// directory.  this has got to be the result of a committee!}}
\DoxyCodeLine{00995     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *SubdirStart;}
\DoxyCodeLine{00996     \textcolor{keywordtype}{unsigned} Offset;}
\DoxyCodeLine{00997 }
\DoxyCodeLine{00998     \textcolor{keywordflow}{if} (DIR\_ENTRY\_ADDR(DirStart, NumDirEntries) + 4 <=}
\DoxyCodeLine{00999         OffsetBase + ExifLength) \{}
\DoxyCodeLine{01000       Offset = Get32u(DirStart + 2 + 12 * NumDirEntries);}
\DoxyCodeLine{01001       \textcolor{keywordflow}{if} (Offset) \{}
\DoxyCodeLine{01002         SubdirStart = OffsetBase + Offset;}
\DoxyCodeLine{01003         \textcolor{keywordflow}{if} (SubdirStart > OffsetBase + ExifLength || SubdirStart < OffsetBase) \{}
\DoxyCodeLine{01004           \textcolor{keywordflow}{if} (SubdirStart > OffsetBase \&\&}
\DoxyCodeLine{01005               SubdirStart < OffsetBase + ExifLength + 20) \{}
\DoxyCodeLine{01006             \textcolor{comment}{// Jhead 1.3 or earlier would crop the whole directory!}}
\DoxyCodeLine{01007             \textcolor{comment}{// As Jhead produces this form of format incorrectness,}}
\DoxyCodeLine{01008             \textcolor{comment}{// I'll just let it pass silently}}
\DoxyCodeLine{01009             \textcolor{keywordflow}{if} (ShowTags)}
\DoxyCodeLine{01010               printf(\textcolor{stringliteral}{"{}Thumbnail removed with Jhead 1.3 or earlier\(\backslash\)n"{}});}
\DoxyCodeLine{01011           \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01012             std::cout << \textcolor{stringliteral}{"{}Illegal subdirectory link in Exif header"{}}}
\DoxyCodeLine{01013                       << std::endl;}
\DoxyCodeLine{01014           \}}
\DoxyCodeLine{01015         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01016           \textcolor{keywordflow}{if} (SubdirStart <= OffsetBase + ExifLength) \{}
\DoxyCodeLine{01017             \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}\%s    Continued directory "{}}, IndentString);}
\DoxyCodeLine{01018             ProcessExifDir(SubdirStart, OffsetBase, ExifLength,}
\DoxyCodeLine{01019                            NestingLevel + 1);}
\DoxyCodeLine{01020           \}}
\DoxyCodeLine{01021         \}}
\DoxyCodeLine{01022         \textcolor{keywordflow}{if} (Offset > \mbox{\hyperlink{class_image_info}{ImageInfo}}.LargestExifOffset) \{}
\DoxyCodeLine{01023           \mbox{\hyperlink{class_image_info}{ImageInfo}}.LargestExifOffset = Offset;}
\DoxyCodeLine{01024         \}}
\DoxyCodeLine{01025       \}}
\DoxyCodeLine{01026     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01027       \textcolor{comment}{// The exif header ends before the last next directory pointer.}}
\DoxyCodeLine{01028     \}}
\DoxyCodeLine{01029   \}}
\DoxyCodeLine{01030 }
\DoxyCodeLine{01031   \textcolor{keywordflow}{if} (ThumbnailOffset) \{}
\DoxyCodeLine{01032     \mbox{\hyperlink{class_image_info}{ImageInfo}}.ThumbnailAtEnd = FALSE;}
\DoxyCodeLine{01033 }
\DoxyCodeLine{01034     \textcolor{keywordflow}{if} (DumpExifMap) \{}
\DoxyCodeLine{01035       printf(\textcolor{stringliteral}{"{}Map: \%05d-\/\%05d: Thumbnail\(\backslash\)n"{}}, ThumbnailOffset,}
\DoxyCodeLine{01036              ThumbnailOffset + ThumbnailSize);}
\DoxyCodeLine{01037     \}}
\DoxyCodeLine{01038 }
\DoxyCodeLine{01039     \textcolor{keywordflow}{if} (ThumbnailOffset <= ExifLength) \{}
\DoxyCodeLine{01040       \textcolor{keywordflow}{if} (ThumbnailSize > ExifLength -\/ ThumbnailOffset) \{}
\DoxyCodeLine{01041         \textcolor{comment}{// If thumbnail extends past exif header, only save the part that}}
\DoxyCodeLine{01042         \textcolor{comment}{// actually exists.  Canon's EOS viewer utility will do this -\/ the}}
\DoxyCodeLine{01043         \textcolor{comment}{// thumbnail extracts ok with this hack.}}
\DoxyCodeLine{01044         ThumbnailSize = ExifLength -\/ ThumbnailOffset;}
\DoxyCodeLine{01045         \textcolor{keywordflow}{if} (ShowTags) printf(\textcolor{stringliteral}{"{}Thumbnail incorrectly placed in header\(\backslash\)n"{}});}
\DoxyCodeLine{01046       \}}
\DoxyCodeLine{01047       \textcolor{comment}{// The thumbnail pointer appears to be valid.  Store it.}}
\DoxyCodeLine{01048       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ThumbnailOffset = ThumbnailOffset;}
\DoxyCodeLine{01049       \mbox{\hyperlink{class_image_info}{ImageInfo}}.ThumbnailSize   = ThumbnailSize;}
\DoxyCodeLine{01050 }
\DoxyCodeLine{01051       \textcolor{keywordflow}{if} (ShowTags) \{}
\DoxyCodeLine{01052         printf(\textcolor{stringliteral}{"{}Thumbnail size: \%u bytes\(\backslash\)n"{}}, ThumbnailSize);}
\DoxyCodeLine{01053       \}}
\DoxyCodeLine{01054     \}}
\DoxyCodeLine{01055   \}}
\DoxyCodeLine{01056 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01057 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tiio\+\_\+jpg\+\_\+exif.\+h\item 
E\+:/opentoonz/toonz/sources/common/tiio/tiio\+\_\+jpg\+\_\+exif.\+cpp\end{DoxyCompactItemize}
