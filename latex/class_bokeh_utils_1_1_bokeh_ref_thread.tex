\hypertarget{class_bokeh_utils_1_1_bokeh_ref_thread}{}\doxysection{Bokeh\+Utils\+::Bokeh\+Ref\+Thread Class Reference}
\label{class_bokeh_utils_1_1_bokeh_ref_thread}\index{BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}}
Inheritance diagram for Bokeh\+Utils\+::Bokeh\+Ref\+Thread\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_bokeh_utils_1_1_bokeh_ref_thread}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_bokeh_utils_1_1_bokeh_ref_thread_a372706a9117f803bcae30406e347a72d}{Bokeh\+Ref\+Thread}} (int channel, kiss\+\_\+fft\+\_\+cpx $\ast$fftcpx\+\_\+channel\+\_\+before, kiss\+\_\+fft\+\_\+cpx $\ast$fftcpx\+\_\+channel, kiss\+\_\+fft\+\_\+cpx $\ast$fftcpx\+\_\+alpha, kiss\+\_\+fft\+\_\+cpx $\ast$fftcpx\+\_\+iris, \mbox{\hyperlink{structdouble4}{double4}} $\ast$result\+\_\+buff, kiss\+\_\+fftnd\+\_\+cfg kissfft\+\_\+plan\+\_\+fwd, kiss\+\_\+fftnd\+\_\+cfg kissfft\+\_\+plan\+\_\+bkwd, \mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} \&dim)
\item 
void \mbox{\hyperlink{class_bokeh_utils_1_1_bokeh_ref_thread_a7772f46b1d56c00ed7a47ee521c773e1}{run}} () override
\item 
bool \mbox{\hyperlink{class_bokeh_utils_1_1_bokeh_ref_thread_a288aad52873dbb2c7e7b8ca152924425}{is\+Finished}} ()
\item 
void \mbox{\hyperlink{class_bokeh_utils_1_1_bokeh_ref_thread_a5b9ab192e5f802f511531976527f72cb}{terminate\+Thread}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_bokeh_utils_1_1_bokeh_ref_thread_a372706a9117f803bcae30406e347a72d}\label{class_bokeh_utils_1_1_bokeh_ref_thread_a372706a9117f803bcae30406e347a72d}} 
\index{BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}!BokehRefThread@{BokehRefThread}}
\index{BokehRefThread@{BokehRefThread}!BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}}
\doxysubsubsection{\texorpdfstring{BokehRefThread()}{BokehRefThread()}}
{\footnotesize\ttfamily Bokeh\+Utils\+::\+Bokeh\+Ref\+Thread\+::\+Bokeh\+Ref\+Thread (\begin{DoxyParamCaption}\item[{int}]{channel,  }\item[{kiss\+\_\+fft\+\_\+cpx $\ast$}]{fftcpx\+\_\+channel\+\_\+before,  }\item[{kiss\+\_\+fft\+\_\+cpx $\ast$}]{fftcpx\+\_\+channel,  }\item[{kiss\+\_\+fft\+\_\+cpx $\ast$}]{fftcpx\+\_\+alpha,  }\item[{kiss\+\_\+fft\+\_\+cpx $\ast$}]{fftcpx\+\_\+iris,  }\item[{\mbox{\hyperlink{structdouble4}{double4}} $\ast$}]{result\+\_\+buff,  }\item[{kiss\+\_\+fftnd\+\_\+cfg}]{kissfft\+\_\+plan\+\_\+fwd,  }\item[{kiss\+\_\+fftnd\+\_\+cfg}]{kissfft\+\_\+plan\+\_\+bkwd,  }\item[{\mbox{\hyperlink{class_t_dimension_t}{TDimensionI}} \&}]{dim }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00318     : m\_channel(channel)}
\DoxyCodeLine{00319     , m\_fftcpx\_channel\_before(fftcpx\_channel\_before)}
\DoxyCodeLine{00320     , m\_fftcpx\_channel(fftcpx\_channel)}
\DoxyCodeLine{00321     , m\_fftcpx\_alpha(fftcpx\_alpha)}
\DoxyCodeLine{00322     , m\_fftcpx\_iris(fftcpx\_iris)}
\DoxyCodeLine{00323     , m\_result\_buff(result\_buff)}
\DoxyCodeLine{00324     , m\_kissfft\_plan\_fwd(kissfft\_plan\_fwd)}
\DoxyCodeLine{00325     , m\_kissfft\_plan\_bkwd(kissfft\_plan\_bkwd)}
\DoxyCodeLine{00326     , m\_dim(dim)}
\DoxyCodeLine{00327     , m\_finished(\textcolor{keyword}{false})}
\DoxyCodeLine{00328     , m\_isTerminated(\textcolor{keyword}{false}) \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_bokeh_utils_1_1_bokeh_ref_thread_a288aad52873dbb2c7e7b8ca152924425}\label{class_bokeh_utils_1_1_bokeh_ref_thread_a288aad52873dbb2c7e7b8ca152924425}} 
\index{BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}!isFinished@{isFinished}}
\index{isFinished@{isFinished}!BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}}
\doxysubsubsection{\texorpdfstring{isFinished()}{isFinished()}}
{\footnotesize\ttfamily bool Bokeh\+Utils\+::\+Bokeh\+Ref\+Thread\+::is\+Finished (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00111 \{ \textcolor{keywordflow}{return} m\_finished; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bokeh_utils_1_1_bokeh_ref_thread_a7772f46b1d56c00ed7a47ee521c773e1}\label{class_bokeh_utils_1_1_bokeh_ref_thread_a7772f46b1d56c00ed7a47ee521c773e1}} 
\index{BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}!run@{run}}
\index{run@{run}!BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}}
\doxysubsubsection{\texorpdfstring{run()}{run()}}
{\footnotesize\ttfamily void Bokeh\+Utils\+::\+Bokeh\+Ref\+Thread\+::run (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00332                                    \{}
\DoxyCodeLine{00333   \textcolor{comment}{// execute channel fft}}
\DoxyCodeLine{00334   kiss\_fftnd(m\_kissfft\_plan\_fwd, m\_fftcpx\_channel\_before, m\_fftcpx\_channel);}
\DoxyCodeLine{00335 }
\DoxyCodeLine{00336   \textcolor{comment}{// cancel check}}
\DoxyCodeLine{00337   \textcolor{keywordflow}{if} (m\_isTerminated) \{}
\DoxyCodeLine{00338     m\_finished = \textcolor{keyword}{true};}
\DoxyCodeLine{00339     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00340   \}}
\DoxyCodeLine{00341 }
\DoxyCodeLine{00342   \textcolor{keywordtype}{int} size = m\_dim.lx * m\_dim.ly;}
\DoxyCodeLine{00343 }
\DoxyCodeLine{00344   \textcolor{comment}{// multiply filter}}
\DoxyCodeLine{00345   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < size; i++) \{}
\DoxyCodeLine{00346     \textcolor{keywordtype}{float} re, im;}
\DoxyCodeLine{00347     re = m\_fftcpx\_channel[i].r * m\_fftcpx\_iris[i].r -\/}
\DoxyCodeLine{00348          m\_fftcpx\_channel[i].i * m\_fftcpx\_iris[i].i;}
\DoxyCodeLine{00349     im = m\_fftcpx\_channel[i].r * m\_fftcpx\_iris[i].i +}
\DoxyCodeLine{00350          m\_fftcpx\_iris[i].r * m\_fftcpx\_channel[i].i;}
\DoxyCodeLine{00351     m\_fftcpx\_channel[i].r = re;}
\DoxyCodeLine{00352     m\_fftcpx\_channel[i].i = im;}
\DoxyCodeLine{00353   \}}
\DoxyCodeLine{00354   \textcolor{comment}{// execute invert fft}}
\DoxyCodeLine{00355   kiss\_fftnd(m\_kissfft\_plan\_bkwd, m\_fftcpx\_channel, m\_fftcpx\_channel\_before);}
\DoxyCodeLine{00356 }
\DoxyCodeLine{00357   \textcolor{comment}{// cancel check}}
\DoxyCodeLine{00358   \textcolor{keywordflow}{if} (m\_isTerminated) \{}
\DoxyCodeLine{00359     m\_finished = \textcolor{keyword}{true};}
\DoxyCodeLine{00360     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00361   \}}
\DoxyCodeLine{00362 }
\DoxyCodeLine{00363   \textcolor{comment}{// pixels with smaller index : normal composite exposure value}}
\DoxyCodeLine{00364   \textcolor{comment}{// pixels with the same or larger index : replace exposure value}}
\DoxyCodeLine{00365   \mbox{\hyperlink{structdouble4}{double4}}* result\_p = m\_result\_buff;}
\DoxyCodeLine{00366   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < size; i++, result\_p++) \{}
\DoxyCodeLine{00367     \textcolor{comment}{// modify fft coordinate to normal}}
\DoxyCodeLine{00368     \textcolor{keywordtype}{int} coord = getCoord(i, m\_dim.lx, m\_dim.ly);}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370     \textcolor{keywordtype}{double} alpha = (double)m\_fftcpx\_alpha[coord].r / (\textcolor{keywordtype}{double})size;}
\DoxyCodeLine{00371     \textcolor{comment}{// ignore transpalent pixels}}
\DoxyCodeLine{00372     \textcolor{keywordflow}{if} (alpha < 0.00001) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00373 }
\DoxyCodeLine{00374     \textcolor{keywordtype}{double} exposure = (double)m\_fftcpx\_channel\_before[coord].r / (\textcolor{keywordtype}{double})size;}
\DoxyCodeLine{00375 }
\DoxyCodeLine{00376     \textcolor{comment}{// in case of using upper layer at all}}
\DoxyCodeLine{00377     \textcolor{keywordflow}{if} (alpha >= 1.0 || (m\_channel == 0 \&\& (*result\_p).x == 0.0) ||}
\DoxyCodeLine{00378         (m\_channel == 1 \&\& (*result\_p).y == 0.0) ||}
\DoxyCodeLine{00379         (m\_channel == 2 \&\& (*result\_p).z == 0.0)) \{}
\DoxyCodeLine{00380       \textcolor{comment}{// set exposure}}
\DoxyCodeLine{00381       \textcolor{keywordflow}{if} (m\_channel == 0)  \textcolor{comment}{// R}}
\DoxyCodeLine{00382         (*result\_p).x = exposure;}
\DoxyCodeLine{00383       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_channel == 1)  \textcolor{comment}{// G}}
\DoxyCodeLine{00384         (*result\_p).y = exposure;}
\DoxyCodeLine{00385       \textcolor{keywordflow}{else}  \textcolor{comment}{// B}}
\DoxyCodeLine{00386         (*result\_p).z = exposure;}
\DoxyCodeLine{00387     \}}
\DoxyCodeLine{00388     \textcolor{comment}{// in case of compositing both layers}}
\DoxyCodeLine{00389     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00390       \textcolor{keywordflow}{if} (m\_channel == 0)  \textcolor{comment}{// R}}
\DoxyCodeLine{00391       \{}
\DoxyCodeLine{00392         (*result\_p).x *= 1.0 -\/ alpha;}
\DoxyCodeLine{00393         (*result\_p).x += exposure;}
\DoxyCodeLine{00394       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_channel == 1)  \textcolor{comment}{// G}}
\DoxyCodeLine{00395       \{}
\DoxyCodeLine{00396         (*result\_p).y *= 1.0 -\/ alpha;}
\DoxyCodeLine{00397         (*result\_p).y += exposure;}
\DoxyCodeLine{00398       \} \textcolor{keywordflow}{else}  \textcolor{comment}{// B}}
\DoxyCodeLine{00399       \{}
\DoxyCodeLine{00400         (*result\_p).z *= 1.0 -\/ alpha;}
\DoxyCodeLine{00401         (*result\_p).z += exposure;}
\DoxyCodeLine{00402       \}}
\DoxyCodeLine{00403     \}}
\DoxyCodeLine{00404   \}}
\DoxyCodeLine{00405   m\_finished = \textcolor{keyword}{true};}
\DoxyCodeLine{00406 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_bokeh_utils_1_1_bokeh_ref_thread_a5b9ab192e5f802f511531976527f72cb}\label{class_bokeh_utils_1_1_bokeh_ref_thread_a5b9ab192e5f802f511531976527f72cb}} 
\index{BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}!terminateThread@{terminateThread}}
\index{terminateThread@{terminateThread}!BokehUtils::BokehRefThread@{BokehUtils::BokehRefThread}}
\doxysubsubsection{\texorpdfstring{terminateThread()}{terminateThread()}}
{\footnotesize\ttfamily void Bokeh\+Utils\+::\+Bokeh\+Ref\+Thread\+::terminate\+Thread (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00112 \{ m\_isTerminated = \textcolor{keyword}{true}; \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+bokeh\+\_\+util.\+h\item 
E\+:/opentoonz/toonz/sources/stdfx/iwa\+\_\+bokeh\+\_\+util.\+cpp\end{DoxyCompactItemize}
