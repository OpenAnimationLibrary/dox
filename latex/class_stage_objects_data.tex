\hypertarget{class_stage_objects_data}{}\doxysection{Stage\+Objects\+Data Class Reference}
\label{class_stage_objects_data}\index{StageObjectsData@{StageObjectsData}}


{\ttfamily \#include $<$stageobjectsdata.\+h$>$}

Inheritance diagram for Stage\+Objects\+Data\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_stage_objects_data}
\end{center}
\end{figure}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Fx\+Flags} \{ {\bfseries e\+Do\+Clone} = 0x1
, {\bfseries e\+Reset\+Fx\+Dag\+Positions}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_stage_objects_data}{Stage\+Objects\+Data}} $\ast$ \mbox{\hyperlink{class_stage_objects_data_ae6eb30476a37d63ea3d24da98a9096db}{clone}} () const override
\item 
bool \mbox{\hyperlink{class_stage_objects_data_aa75db1ed8c5cd0412cb353126684b1b1}{is\+Empty}} () const
\item 
void \mbox{\hyperlink{class_stage_objects_data_ab1bf651aeb67ce71d2deb874e3d37e26}{store\+Objects}} (const std\+::vector$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ \&ids, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsheet, int fx\+Flags)
\item 
void \mbox{\hyperlink{class_stage_objects_data_a64d285aa4bb0f00d17e0f659e1d28ae3}{store\+Columns}} (const std\+::set$<$ int $>$ \&column\+Indexes, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsheet, int fx\+Flags)
\begin{DoxyCompactList}\small\item\em Overloaded function, stores the specified columns in the supplied xsheet. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_stage_objects_data_ab4716c1e39e02f7ae4ef25a4f670b6b6}{store\+Fxs}} (const std\+::set$<$ \mbox{\hyperlink{class_t_fx}{TFx}} $\ast$ $>$ \&fxs, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsheet, int fx\+Flags)
\begin{DoxyCompactList}\small\item\em Stores the specified fxs from the xsheet. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_stage_objects_data_acbffc8f0eafc04b34b5247bf1e21fdcf}{store\+Column\+Fxs}} (const std\+::set$<$ int $>$ \&column\+Indexes, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsh, int fx\+Flags)
\item 
void \mbox{\hyperlink{class_stage_objects_data_a8273a597f1714f536f9170af58a0e4d7}{store\+Splines}} (const std\+::list$<$ int $>$ \&spline\+Ids, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsh, int fx\+Flags)
\item 
bool \mbox{\hyperlink{class_stage_objects_data_adfa93a60503a86ad264f0538d933f161}{check\+Circular\+References}} (\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsheet) const
\item 
std\+::vector$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ \mbox{\hyperlink{class_stage_objects_data_acb1ab2a0891bd82400614e2b81f0ce0e}{restore\+Objects}} (std\+::set$<$ int $>$ \&column\+Indices, std\+::list$<$ int $>$ \&restored\+Splin\+Ids, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsheet, int fx\+Flags, const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos=TConst\+::nowhere) const
\item 
std\+::vector$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ \mbox{\hyperlink{class_stage_objects_data_aa77025146e667bad54d703cba383657a}{restore\+Objects}} (std\+::set$<$ int $>$ \&column\+Indices, std\+::list$<$ int $>$ \&restored\+Splin\+Ids, \mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$xsheet, int fx\+Flags, QMap$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}}, \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ \&id\+Table, QMap$<$ \mbox{\hyperlink{class_t_fx}{TFx}} $\ast$, \mbox{\hyperlink{class_t_fx}{TFx}} $\ast$ $>$ \&fx\+Table, const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos=TConst\+::nowhere) const
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\mbox{\hyperlink{class_stage_objects_data}{Stage\+Objects\+Data}} is the class used to store multiple schematic stage object\textquotesingle{}s relational data. 

\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{class_stage_objects_data_a460fd4a40aed983184fcd08cccbdbdfa}\label{class_stage_objects_data_a460fd4a40aed983184fcd08cccbdbdfa}} 
\index{StageObjectsData@{StageObjectsData}!FxFlags@{FxFlags}}
\index{FxFlags@{FxFlags}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{FxFlags}{FxFlags}}
{\footnotesize\ttfamily enum Stage\+Objects\+Data\+::\+Fx\+Flags}


\begin{DoxyCode}{0}
\DoxyCodeLine{00074                \{}
\DoxyCodeLine{00075     eDoClone = 0x1,  \textcolor{comment}{// Clones sensible stored data}}
\DoxyCodeLine{00076     eResetFxDagPositions =}
\DoxyCodeLine{00077         0x2  \textcolor{comment}{// Accepts default positions for newly created FX objects}}
\DoxyCodeLine{00078   \};}

\end{DoxyCode}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_stage_objects_data_aaff2602db90592562cd6ac03daa18bbc}\label{class_stage_objects_data_aaff2602db90592562cd6ac03daa18bbc}} 
\index{StageObjectsData@{StageObjectsData}!StageObjectsData@{StageObjectsData}}
\index{StageObjectsData@{StageObjectsData}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{StageObjectsData()}{StageObjectsData()}}
{\footnotesize\ttfamily Stage\+Objects\+Data\+::\+Stage\+Objects\+Data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00533 : \mbox{\hyperlink{class_dv_mime_data}{DvMimeData}}() \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_objects_data_acbdddc24d355716acb335cfcc05c9e98}\label{class_stage_objects_data_acbdddc24d355716acb335cfcc05c9e98}} 
\index{StageObjectsData@{StageObjectsData}!````~StageObjectsData@{$\sim$StageObjectsData}}
\index{````~StageObjectsData@{$\sim$StageObjectsData}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{$\sim$StageObjectsData()}{~StageObjectsData()}}
{\footnotesize\ttfamily Stage\+Objects\+Data\+::$\sim$\+Stage\+Objects\+Data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00537                                     \{}
\DoxyCodeLine{00538   \textcolor{keywordtype}{int} i, elementsCount = m\_elements.size();}
\DoxyCodeLine{00539   \textcolor{keywordflow}{for} (i = 0; i < elementsCount; ++i) \textcolor{keyword}{delete} m\_elements[i];}
\DoxyCodeLine{00540 }
\DoxyCodeLine{00541   \textcolor{keywordflow}{for} (i = 0; i < m\_splines.size(); ++i) \textcolor{keyword}{delete} m\_splines[i];}
\DoxyCodeLine{00542 }
\DoxyCodeLine{00543   std::set<TFx *>::iterator it;}
\DoxyCodeLine{00544   \textcolor{keywordflow}{for} (it = m\_fxs.begin(); it != m\_fxs.end(); ++it) \{}
\DoxyCodeLine{00545     \mbox{\hyperlink{class_t_fx}{TFx}} *fx = *it;}
\DoxyCodeLine{00546     \textcolor{keywordflow}{if} (fx) fx-\/>release();}
\DoxyCodeLine{00547   \}}
\DoxyCodeLine{00548 }
\DoxyCodeLine{00549   \textcolor{keywordflow}{for} (it = m\_terminalFxs.begin(); it != m\_terminalFxs.end(); ++it) \{}
\DoxyCodeLine{00550     \mbox{\hyperlink{class_t_fx}{TFx}} *fx = *it;}
\DoxyCodeLine{00551     \textcolor{keywordflow}{if} (fx) fx-\/>release();}
\DoxyCodeLine{00552   \}}
\DoxyCodeLine{00553 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_stage_objects_data_adfa93a60503a86ad264f0538d933f161}\label{class_stage_objects_data_adfa93a60503a86ad264f0538d933f161}} 
\index{StageObjectsData@{StageObjectsData}!checkCircularReferences@{checkCircularReferences}}
\index{checkCircularReferences@{checkCircularReferences}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{checkCircularReferences()}{checkCircularReferences()}}
{\footnotesize\ttfamily bool Stage\+Objects\+Data\+::check\+Circular\+References (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsheet }\end{DoxyParamCaption}) const}

Scans the stored column elements to verify if the specified xsheet is a sub-\/xsheet in of them (thus creating an impossible \textquotesingle{}\textbackslash{}it\{circular reference\}\textquotesingle{}). 
\begin{DoxyCode}{0}
\DoxyCodeLine{00557                                                                  \{}
\DoxyCodeLine{00558   \textcolor{keywordtype}{int} i, elementsCount = m\_elements.size();}
\DoxyCodeLine{00559   \textcolor{keywordflow}{for} (i = 0; i < elementsCount; ++i) \{}
\DoxyCodeLine{00560     \mbox{\hyperlink{class_t_column_data_element}{TColumnDataElement}} *columnElement =}
\DoxyCodeLine{00561         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_column_data_element}{TColumnDataElement}} *\textcolor{keyword}{>}(m\_elements[i]);}
\DoxyCodeLine{00562     \textcolor{keywordflow}{if} (!columnElement) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00563 }
\DoxyCodeLine{00564     \textcolor{keywordflow}{if} (xsh-\/>checkCircularReferences(columnElement-\/>m\_column.getPointer()))}
\DoxyCodeLine{00565       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00566   \}}
\DoxyCodeLine{00567 }
\DoxyCodeLine{00568   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00569 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01583}{TXsheet\+::check\+Circular\+References()}}.

\mbox{\Hypertarget{class_stage_objects_data_ae6eb30476a37d63ea3d24da98a9096db}\label{class_stage_objects_data_ae6eb30476a37d63ea3d24da98a9096db}} 
\index{StageObjectsData@{StageObjectsData}!clone@{clone}}
\index{clone@{clone}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{clone()}{clone()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_stage_objects_data}{Stage\+Objects\+Data}} $\ast$ Stage\+Objects\+Data\+::clone (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Clones this object. \begin{DoxyNote}{Note}
Clones stored fxs, columns, etc. too. 
\end{DoxyNote}


Implements \mbox{\hyperlink{class_dv_mime_data}{Dv\+Mime\+Data}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00573                                                 \{}
\DoxyCodeLine{00574   \mbox{\hyperlink{class_stage_objects_data}{StageObjectsData}} *data = \textcolor{keyword}{new} \mbox{\hyperlink{class_stage_objects_data}{StageObjectsData}}();}
\DoxyCodeLine{00575 }
\DoxyCodeLine{00576   \textcolor{comment}{// Clone each element (the new data gets ownership)}}
\DoxyCodeLine{00577   \textcolor{keywordtype}{int} i, elementsCount = m\_elements.size();}
\DoxyCodeLine{00578   \textcolor{keywordflow}{for} (i = 0; i < elementsCount; ++i)}
\DoxyCodeLine{00579     data-\/>m\_elements.append(m\_elements[i]-\/>clone());}
\DoxyCodeLine{00580 }
\DoxyCodeLine{00581   \textcolor{comment}{// Clone each spline (the new data gets ownership)}}
\DoxyCodeLine{00582   \textcolor{keywordflow}{for} (i = 0; i < m\_splines.size(); ++i)}
\DoxyCodeLine{00583     data-\/>m\_splines.append(m\_splines[i]-\/>clone());}
\DoxyCodeLine{00584 }
\DoxyCodeLine{00585   \textcolor{comment}{// Same for internal fxs}}
\DoxyCodeLine{00586   std::map<TFx *, TFx *> fxTable;  \textcolor{comment}{// And trace the pairings with the originals}}
\DoxyCodeLine{00587   std::set<TFx *>::const\_iterator it;}
\DoxyCodeLine{00588   \textcolor{keywordflow}{for} (it = m\_fxs.begin(); it != m\_fxs.end(); ++it) \{}
\DoxyCodeLine{00589     \mbox{\hyperlink{class_t_fx}{TFx}} *fxOrig = *it;}
\DoxyCodeLine{00590     assert(fxOrig);}
\DoxyCodeLine{00591     assert(fxTable.count(fxOrig) == 0);}
\DoxyCodeLine{00592 }
\DoxyCodeLine{00593     \mbox{\hyperlink{class_t_fx}{TFx}} *fx = fxOrig-\/>clone(\textcolor{keyword}{false});}
\DoxyCodeLine{00594     fx-\/>getAttributes()-\/>setId(fxOrig-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{00595     fx-\/>getAttributes()-\/>passiveCacheDataIdx() = -\/1;}
\DoxyCodeLine{00596     fx-\/>setName(fxOrig-\/>getName());}
\DoxyCodeLine{00597     fx-\/>setFxId(fxOrig-\/>getFxId());}
\DoxyCodeLine{00598 }
\DoxyCodeLine{00599     fxTable[fxOrig] = fx;}
\DoxyCodeLine{00600     fx-\/>addRef();}
\DoxyCodeLine{00601     data-\/>m\_fxs.insert(fx);}
\DoxyCodeLine{00602   \}}
\DoxyCodeLine{00603 }
\DoxyCodeLine{00604   \textcolor{comment}{// Same with terminals}}
\DoxyCodeLine{00605   \textcolor{keywordflow}{for} (it = m\_terminalFxs.begin(); it != m\_terminalFxs.end(); ++it) \{}
\DoxyCodeLine{00606     \mbox{\hyperlink{class_t_fx}{TFx}} *fxOrig = *it;}
\DoxyCodeLine{00607     assert(fxOrig);}
\DoxyCodeLine{00608 }
\DoxyCodeLine{00609     \textcolor{comment}{// If the fx was not already cloned above, do it now}}
\DoxyCodeLine{00610     \mbox{\hyperlink{class_t_fx}{TFx}} *fx = searchFx(fxTable, fxOrig);}
\DoxyCodeLine{00611     \textcolor{keywordflow}{if} (!fx) \{}
\DoxyCodeLine{00612       fx = fxOrig-\/>clone(\textcolor{keyword}{false});}
\DoxyCodeLine{00613       fx-\/>getAttributes()-\/>setId(fxOrig-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{00614       fx-\/>getAttributes()-\/>passiveCacheDataIdx() = -\/1;}
\DoxyCodeLine{00615       fx-\/>setName(fxOrig-\/>getName());}
\DoxyCodeLine{00616       fx-\/>setFxId(fxOrig-\/>getFxId());}
\DoxyCodeLine{00617       fxTable[fxOrig] = fx;}
\DoxyCodeLine{00618     \}}
\DoxyCodeLine{00619 }
\DoxyCodeLine{00620     fx-\/>addRef();}
\DoxyCodeLine{00621     data-\/>m\_terminalFxs.insert(fx);}
\DoxyCodeLine{00622   \}}
\DoxyCodeLine{00623 }
\DoxyCodeLine{00624   \textcolor{keywordflow}{if} (!fxTable.empty())}
\DoxyCodeLine{00625     updateFxLinks(fxTable);  \textcolor{comment}{// Applies the traced map pairings to every fx}}
\DoxyCodeLine{00626                              \textcolor{comment}{// descendant of each fx stored in the map.}}
\DoxyCodeLine{00627 }
\DoxyCodeLine{00628   \textcolor{comment}{// WARNING: m\_fxsTable is NOT COPIED / CLONED !!}}
\DoxyCodeLine{00629 }
\DoxyCodeLine{00630   \textcolor{keywordflow}{return} data;}
\DoxyCodeLine{00631 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_objects_data_aa75db1ed8c5cd0412cb353126684b1b1}\label{class_stage_objects_data_aa75db1ed8c5cd0412cb353126684b1b1}} 
\index{StageObjectsData@{StageObjectsData}!isEmpty@{isEmpty}}
\index{isEmpty@{isEmpty}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{isEmpty()}{isEmpty()}}
{\footnotesize\ttfamily bool Stage\+Objects\+Data\+::is\+Empty (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00088 \{ \textcolor{keywordflow}{return} m\_elements.isEmpty() \&\& m\_splines.isEmpty(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_objects_data_acb1ab2a0891bd82400614e2b81f0ce0e}\label{class_stage_objects_data_acb1ab2a0891bd82400614e2b81f0ce0e}} 
\index{StageObjectsData@{StageObjectsData}!restoreObjects@{restoreObjects}}
\index{restoreObjects@{restoreObjects}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{restoreObjects()}{restoreObjects()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily std\+::vector$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ Stage\+Objects\+Data\+::restore\+Objects (\begin{DoxyParamCaption}\item[{std\+::set$<$ int $>$ \&}]{column\+Indices,  }\item[{std\+::list$<$ int $>$ \&}]{restored\+Splin\+Ids,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsheet,  }\item[{int}]{fx\+Flags,  }\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos = {\ttfamily TConst\+:\+:nowhere} }\end{DoxyParamCaption}) const}

Restores the stored objects in the supplied xsheet, inserting columns with the specified indices. In case there are more stored columns than specified column indices, the remaining columns are inserted right after the last specified index. Returns the inserted stage object identifiers and updates the column\+Indices with all the newly inserted column indices. Additional flags support \mbox{\hyperlink{class_t_xsh_column}{TXsh\+Column}} cloning before insertion. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00919                                            \{}
\DoxyCodeLine{00920   QMap<TStageObjectId, TStageObjectId> idTable;}
\DoxyCodeLine{00921   QMap<TFx *, TFx *> fxTable;}
\DoxyCodeLine{00922   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_stage_objects_data_acb1ab2a0891bd82400614e2b81f0ce0e}{restoreObjects}}(columnIndices, restoredSpline, xsh, fxFlags, idTable,}
\DoxyCodeLine{00923                         fxTable, pos);}
\DoxyCodeLine{00924 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00917}{restore\+Objects()}}.



Referenced by \mbox{\hyperlink{l00917}{restore\+Objects()}}.

\mbox{\Hypertarget{class_stage_objects_data_aa77025146e667bad54d703cba383657a}\label{class_stage_objects_data_aa77025146e667bad54d703cba383657a}} 
\index{StageObjectsData@{StageObjectsData}!restoreObjects@{restoreObjects}}
\index{restoreObjects@{restoreObjects}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{restoreObjects()}{restoreObjects()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily std\+::vector$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ Stage\+Objects\+Data\+::restore\+Objects (\begin{DoxyParamCaption}\item[{std\+::set$<$ int $>$ \&}]{column\+Indices,  }\item[{std\+::list$<$ int $>$ \&}]{restored\+Splin\+Ids,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsheet,  }\item[{int}]{fx\+Flags,  }\item[{QMap$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}}, \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ \&}]{id\+Table,  }\item[{QMap$<$ \mbox{\hyperlink{class_t_fx}{TFx}} $\ast$, \mbox{\hyperlink{class_t_fx}{TFx}} $\ast$ $>$ \&}]{fx\+Table,  }\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos = {\ttfamily TConst\+:\+:nowhere} }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00932                                                            \{}
\DoxyCodeLine{00933   \textcolor{keywordtype}{bool} doClone             = (fxFlags \& eDoClone);}
\DoxyCodeLine{00934   \textcolor{keywordtype}{bool} resetFxDagPositions = (fxFlags \& eResetFxDagPositions);}
\DoxyCodeLine{00935 }
\DoxyCodeLine{00936   \textcolor{comment}{// QMap<TStageObjectId, TStageObjectId>}}
\DoxyCodeLine{00937   \textcolor{comment}{//    idTable;                     // Trace stored/restored id pairings}}
\DoxyCodeLine{00938   \textcolor{comment}{// std::map<TFx *, TFx *> fxTable;  // Same for fxs here}}
\DoxyCodeLine{00939   std::vector<TStageObjectId> restoredIds;}
\DoxyCodeLine{00940 }
\DoxyCodeLine{00941   std::set<int>::iterator idxt = columnIndices.begin();}
\DoxyCodeLine{00942   \textcolor{keywordtype}{int} index                    = -\/1;  \textcolor{comment}{// The actual column insertion index}}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944   \textcolor{keywordtype}{int} i, elementsCount = m\_elements.size();}
\DoxyCodeLine{00945   \textcolor{keywordflow}{for} (i = 0; i < elementsCount; ++i) \{}
\DoxyCodeLine{00946     \mbox{\hyperlink{class_t_stage_object_data_element}{TStageObjectDataElement}} *element = m\_elements[i];}
\DoxyCodeLine{00947 }
\DoxyCodeLine{00948     \mbox{\hyperlink{class_t_camera_data_element}{TCameraDataElement}} *cameraElement =}
\DoxyCodeLine{00949         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_camera_data_element}{TCameraDataElement}} *\textcolor{keyword}{>}(element);}
\DoxyCodeLine{00950     \mbox{\hyperlink{class_t_column_data_element}{TColumnDataElement}} *columnElement =}
\DoxyCodeLine{00951         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_column_data_element}{TColumnDataElement}} *\textcolor{keyword}{>}(element);}
\DoxyCodeLine{00952 }
\DoxyCodeLine{00953     \textcolor{comment}{// Restore the object depending on its specific type}}
\DoxyCodeLine{00954     \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} restoredId = TStageObjectId::NoneId;}
\DoxyCodeLine{00955 }
\DoxyCodeLine{00956     \textcolor{keywordflow}{if} (!cameraElement \&\& !columnElement)}
\DoxyCodeLine{00957       restoredId = element-\/>\mbox{\hyperlink{class_t_stage_object_data_element_abbd9e7886bc0abfb3334cde40434d08b}{restoreObject}}(xsh, pos != TConst::nowhere);}
\DoxyCodeLine{00958     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (cameraElement)}
\DoxyCodeLine{00959       restoredId = cameraElement-\/>\mbox{\hyperlink{class_t_camera_data_element_aa85bc2f75f09af52dd966d571e956d6a}{restoreCamera}}(xsh, pos != TConst::nowhere);}
\DoxyCodeLine{00960     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (columnElement) \{}
\DoxyCodeLine{00961       \textcolor{comment}{// Build the column insertion index}}
\DoxyCodeLine{00962       \textcolor{keywordflow}{if} (idxt != columnIndices.end())}
\DoxyCodeLine{00963         index = *idxt++;}
\DoxyCodeLine{00964       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00965         ++index;}
\DoxyCodeLine{00966         columnIndices.insert(index);}
\DoxyCodeLine{00967       \}}
\DoxyCodeLine{00968 }
\DoxyCodeLine{00969       \textcolor{comment}{// Restore the column element}}
\DoxyCodeLine{00970       restoredId = columnElement-\/>\mbox{\hyperlink{class_t_column_data_element_a22322066607671d817d6fd36c34e7d6c}{restoreColumn}}(xsh, index, fxFlags,}
\DoxyCodeLine{00971                                                 pos != TConst::nowhere);}
\DoxyCodeLine{00972 }
\DoxyCodeLine{00973       \mbox{\hyperlink{class_fx_dag}{FxDag}} *fxDag = xsh-\/>getFxDag();}
\DoxyCodeLine{00974 }
\DoxyCodeLine{00975       \mbox{\hyperlink{class_t_xsh_column}{TXshColumn}} *column       = columnElement-\/>m\_column.getPointer();}
\DoxyCodeLine{00976       \mbox{\hyperlink{class_t_xsh_column}{TXshColumn}} *pastedColumn = xsh-\/>getColumn(index);}
\DoxyCodeLine{00977 }
\DoxyCodeLine{00978       \mbox{\hyperlink{class_t_fx}{TFx}} *fx       = column-\/>getFx();}
\DoxyCodeLine{00979       \mbox{\hyperlink{class_t_fx}{TFx}} *pastedFx = pastedColumn-\/>getFx();}
\DoxyCodeLine{00980 }
\DoxyCodeLine{00981       \textcolor{keywordflow}{if} (fx \&\& pastedFx) fxTable[fx] = pastedFx;}
\DoxyCodeLine{00982 }
\DoxyCodeLine{00983       \textcolor{comment}{// Enforce the correct terminality. Added columns are terminal by default.}}
\DoxyCodeLine{00984       \textcolor{keywordtype}{bool} terminal = (fx \&\& (m\_terminalFxs.count(fx) > 0));}
\DoxyCodeLine{00985       \textcolor{keywordflow}{if} (!terminal) fxDag-\/>getTerminalFxs()-\/>removeFx(pastedFx);}
\DoxyCodeLine{00986 }
\DoxyCodeLine{00987       \textcolor{comment}{// In case we've cloned a zerary fx column, update the actual fx's data}}
\DoxyCodeLine{00988       \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_zerary_fx_column}{TXshZeraryFxColumn}} *zc =}
\DoxyCodeLine{00989               \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_xsh_zerary_fx_column}{TXshZeraryFxColumn}} *\textcolor{keyword}{>}(pastedColumn)) \{}
\DoxyCodeLine{00990         \mbox{\hyperlink{class_t_zerary_column_fx}{TZeraryColumnFx}} *zfx = zc-\/>getZeraryColumnFx();}
\DoxyCodeLine{00991         \mbox{\hyperlink{class_t_fx}{TFx}} *zeraryFx        = zfx-\/>getZeraryFx();}
\DoxyCodeLine{00992         \textcolor{keywordflow}{if} (zeraryFx) \{}
\DoxyCodeLine{00993           \textcolor{keywordflow}{if} (doClone) \{}
\DoxyCodeLine{00994             \textcolor{comment}{// if the fx has not unique name then let  assignUniqueId() set the}}
\DoxyCodeLine{00995             \textcolor{comment}{// default name}}
\DoxyCodeLine{00996             \textcolor{keywordflow}{if} (zeraryFx-\/>getName() == zeraryFx-\/>getFxId())}
\DoxyCodeLine{00997               zeraryFx-\/>setName(L\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00998             fxDag-\/>assignUniqueId(zeraryFx);}
\DoxyCodeLine{00999           \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{01000             fxDag-\/>updateFxIdTable(zeraryFx);}
\DoxyCodeLine{01001           \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_xsh_zerary_fx_column}{TXshZeraryFxColumn}} *orig\_zc =}
\DoxyCodeLine{01002                   \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_xsh_zerary_fx_column}{TXshZeraryFxColumn}} *\textcolor{keyword}{>}(column)) \{}
\DoxyCodeLine{01003             \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_t_fx}{TFx}} *origZeraryFx = orig\_zc-\/>getZeraryColumnFx()-\/>getZeraryFx())}
\DoxyCodeLine{01004               fxTable[origZeraryFx] = zeraryFx;}
\DoxyCodeLine{01005           \}}
\DoxyCodeLine{01006         \}}
\DoxyCodeLine{01007       \}}
\DoxyCodeLine{01008     \}}
\DoxyCodeLine{01009 }
\DoxyCodeLine{01010     \textcolor{comment}{// Remember stored/restored stage object pairings}}
\DoxyCodeLine{01011     idTable[element-\/>\mbox{\hyperlink{class_t_stage_object_data_element_a9f717b885c1f0debcfe2930268a06361}{m\_params}}-\/>m\_id] = restoredId;}
\DoxyCodeLine{01012     restoredIds.push\_back(restoredId);}
\DoxyCodeLine{01013   \}}
\DoxyCodeLine{01014 }
\DoxyCodeLine{01015   \textcolor{comment}{// Apply stage object-\/parental relationships}}
\DoxyCodeLine{01016   \textcolor{keywordflow}{for} (i = 0; i < elementsCount; ++i) \{}
\DoxyCodeLine{01017     \mbox{\hyperlink{class_t_stage_object_data_element}{TStageObjectDataElement}} *element = m\_elements[i];}
\DoxyCodeLine{01018 }
\DoxyCodeLine{01019     \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} \textcolor{keywordtype}{id}       = element-\/>\mbox{\hyperlink{class_t_stage_object_data_element_a9f717b885c1f0debcfe2930268a06361}{m\_params}}-\/>m\_id;}
\DoxyCodeLine{01020     \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} parentId = element-\/>\mbox{\hyperlink{class_t_stage_object_data_element_a9f717b885c1f0debcfe2930268a06361}{m\_params}}-\/>m\_parentId;}
\DoxyCodeLine{01021 }
\DoxyCodeLine{01022     \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} pastedId       = idTable[id];}
\DoxyCodeLine{01023     \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} pastedParentId = parentId;}
\DoxyCodeLine{01024 }
\DoxyCodeLine{01025     \textcolor{comment}{// if the parent object is not restored, redirect to the table}}
\DoxyCodeLine{01026     QMap<TStageObjectId, TStageObjectId>::iterator it = idTable.find(parentId);}
\DoxyCodeLine{01027     pastedParentId =}
\DoxyCodeLine{01028         (it == idTable.end()) ? TStageObjectId::TableId : it.value();}
\DoxyCodeLine{01029 }
\DoxyCodeLine{01030     xsh-\/>setStageObjectParent(pastedId, pastedParentId);}
\DoxyCodeLine{01031     \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *pastedObj = xsh-\/>getStageObject(pastedId);}
\DoxyCodeLine{01032 }
\DoxyCodeLine{01033     \textcolor{comment}{// Shouldn't these be done outside ?}}
\DoxyCodeLine{01034     pastedObj-\/>\mbox{\hyperlink{class_t_stage_object_a8478e56c447b15faeda7365de0fd15ea}{setHandle}}(element-\/>\mbox{\hyperlink{class_t_stage_object_data_element_a9f717b885c1f0debcfe2930268a06361}{m\_params}}-\/>m\_handle);}
\DoxyCodeLine{01035     pastedObj-\/>\mbox{\hyperlink{class_t_stage_object_a8c8e56d26f94b5b655e2e3246ff66ec5}{setParentHandle}}(element-\/>\mbox{\hyperlink{class_t_stage_object_data_element_a9f717b885c1f0debcfe2930268a06361}{m\_params}}-\/>m\_parentHandle);}
\DoxyCodeLine{01036   \}}
\DoxyCodeLine{01037 }
\DoxyCodeLine{01038   \textcolor{comment}{// Iterate stored fxs}}
\DoxyCodeLine{01039   std::set<TFx *>::const\_iterator fxt, end = m\_fxs.end();}
\DoxyCodeLine{01040   \textcolor{keywordflow}{for} (fxt = m\_fxs.begin(); fxt != end; ++fxt) \{}
\DoxyCodeLine{01041     \mbox{\hyperlink{class_t_fx}{TFx}} *fxOrig = *fxt, *fx = fxOrig;}
\DoxyCodeLine{01042 }
\DoxyCodeLine{01043     \textcolor{comment}{// Only NOT COLUMN fxs -\/ ie internal fxs}}
\DoxyCodeLine{01044     \textcolor{keywordflow}{if} (fxTable.find(fxOrig) != fxTable.end()) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01045 }
\DoxyCodeLine{01046     \textcolor{comment}{// Internal fxs}}
\DoxyCodeLine{01047 }
\DoxyCodeLine{01048     \textcolor{keywordflow}{if} (doClone) \{}
\DoxyCodeLine{01049       fx = fxOrig-\/>clone(\textcolor{keyword}{false});}
\DoxyCodeLine{01050       \textcolor{comment}{// if the fx has not unique name then let assignUniqueId() set the default}}
\DoxyCodeLine{01051       \textcolor{comment}{// name}}
\DoxyCodeLine{01052       \textcolor{keywordflow}{if} (fx-\/>getName() == fx-\/>getFxId()) fx-\/>setName(L\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{01053       fx-\/>getAttributes()-\/>setId(fxOrig-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{01054       fx-\/>getAttributes()-\/>passiveCacheDataIdx() = -\/1;}
\DoxyCodeLine{01055 }
\DoxyCodeLine{01056       \textcolor{keywordflow}{if} (resetFxDagPositions)}
\DoxyCodeLine{01057         fx-\/>getAttributes()-\/>setDagNodePos(TConst::nowhere);}
\DoxyCodeLine{01058 }
\DoxyCodeLine{01059       xsh-\/>getFxDag()-\/>assignUniqueId(}
\DoxyCodeLine{01060           fx);  \textcolor{comment}{// For now, dragging columns always increment fxid.}}
\DoxyCodeLine{01061                 \textcolor{comment}{// Could it be more adaptive, avoiding increment}}
\DoxyCodeLine{01062                 \textcolor{comment}{// if it is not necessary?}}
\DoxyCodeLine{01063     \}}
\DoxyCodeLine{01064 }
\DoxyCodeLine{01065     fxTable[fxOrig] = fx;}
\DoxyCodeLine{01066 }
\DoxyCodeLine{01067     \textcolor{comment}{// Insert the passed fx in the xsheet}}
\DoxyCodeLine{01068     \mbox{\hyperlink{class_t_output_fx}{TOutputFx}} *outFx = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_output_fx}{TOutputFx}} *\textcolor{keyword}{>}(fx);}
\DoxyCodeLine{01069     \textcolor{keywordflow}{if} (!outFx)}
\DoxyCodeLine{01070       xsh-\/>getFxDag()-\/>getInternalFxs()-\/>addFx(fx);}
\DoxyCodeLine{01071     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01072       xsh-\/>getFxDag()-\/>addOutputFx(outFx);}
\DoxyCodeLine{01073 }
\DoxyCodeLine{01074     \textcolor{keywordflow}{if} (m\_terminalFxs.count(fxOrig) > 0)}
\DoxyCodeLine{01075       xsh-\/>getFxDag()-\/>getTerminalFxs()-\/>addFx(fx);}
\DoxyCodeLine{01076 }
\DoxyCodeLine{01077     \textcolor{keywordflow}{if} (!doClone) \{}
\DoxyCodeLine{01078       \textcolor{comment}{// Err.... don't remember. Inquire further? :|}}
\DoxyCodeLine{01079       \textcolor{keywordtype}{int} fxTypeCount = xsh-\/>getFxDag()-\/>getFxTypeCount(fx);}
\DoxyCodeLine{01080 }
\DoxyCodeLine{01081       \textcolor{keywordtype}{int} maxFxTypeId = std::max(fxTypeCount, fx-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{01082       xsh-\/>getFxDag()-\/>updateFxTypeTable(fx, maxFxTypeId);}
\DoxyCodeLine{01083       xsh-\/>getFxDag()-\/>updateFxIdTable(fx);}
\DoxyCodeLine{01084     \}}
\DoxyCodeLine{01085 }
\DoxyCodeLine{01086     \textcolor{keywordtype}{bool} isLinked = (fxOrig-\/>getLinkedFx() != fxOrig);}
\DoxyCodeLine{01087     \textcolor{keywordflow}{if} (isLinked) \{}
\DoxyCodeLine{01088       \textcolor{keywordflow}{if} (m\_fxs.find(fxOrig-\/>getLinkedFx()) == m\_fxs.end())}
\DoxyCodeLine{01089         fx-\/>linkParams(fxOrig-\/>getLinkedFx());}
\DoxyCodeLine{01090       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01091         \mbox{\hyperlink{class_t_fx}{TFx}} *linkedFx, *oldLinkedFx = fxOrig-\/>getLinkedFx();}
\DoxyCodeLine{01092         \textcolor{keywordflow}{if} (doClone) \{}
\DoxyCodeLine{01093           \textcolor{comment}{// Clone the linked fx too}}
\DoxyCodeLine{01094           linkedFx = fx-\/>clone(\textcolor{keyword}{false});}
\DoxyCodeLine{01095           linkedFx-\/>linkParams(fx);}
\DoxyCodeLine{01096 }
\DoxyCodeLine{01097           \textcolor{comment}{// if the fx has not unique name then let assignUniqueId() set the}}
\DoxyCodeLine{01098           \textcolor{comment}{// default name}}
\DoxyCodeLine{01099           \textcolor{keywordflow}{if} (linkedFx-\/>getName() == linkedFx-\/>getFxId())}
\DoxyCodeLine{01100             linkedFx-\/>setName(L\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{01101           linkedFx-\/>getAttributes()-\/>setId(}
\DoxyCodeLine{01102               oldLinkedFx-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{01103           linkedFx-\/>getAttributes()-\/>passiveCacheDataIdx() = -\/1;}
\DoxyCodeLine{01104 }
\DoxyCodeLine{01105           \textcolor{keywordflow}{if} (resetFxDagPositions)}
\DoxyCodeLine{01106             linkedFx-\/>getAttributes()-\/>setDagNodePos(TConst::nowhere);}
\DoxyCodeLine{01107           \textcolor{keywordflow}{else}}
\DoxyCodeLine{01108             linkedFx-\/>getAttributes()-\/>setDagNodePos(}
\DoxyCodeLine{01109                 oldLinkedFx-\/>getAttributes()-\/>getDagNodePos());}
\DoxyCodeLine{01110 }
\DoxyCodeLine{01111           xsh-\/>getFxDag()-\/>assignUniqueId(linkedFx);}
\DoxyCodeLine{01112         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{01113           linkedFx = oldLinkedFx;}
\DoxyCodeLine{01114 }
\DoxyCodeLine{01115         fxTable[oldLinkedFx] = linkedFx;}
\DoxyCodeLine{01116 }
\DoxyCodeLine{01117         xsh-\/>getFxDag()-\/>getInternalFxs()-\/>addFx(linkedFx);}
\DoxyCodeLine{01118         \textcolor{keywordflow}{if} (m\_terminalFxs.count(oldLinkedFx) > 0)}
\DoxyCodeLine{01119           xsh-\/>getFxDag()-\/>getTerminalFxs()-\/>addFx(linkedFx);}
\DoxyCodeLine{01120 }
\DoxyCodeLine{01121         \textcolor{keywordflow}{if} (!doClone) \{}
\DoxyCodeLine{01122           \textcolor{keywordtype}{int} fxTypeCount = xsh-\/>getFxDag()-\/>getFxTypeCount(linkedFx);}
\DoxyCodeLine{01123           \textcolor{keywordtype}{int} maxFxTypeId =}
\DoxyCodeLine{01124               std::max(fxTypeCount, linkedFx-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{01125           xsh-\/>getFxDag()-\/>updateFxTypeTable(linkedFx, maxFxTypeId);}
\DoxyCodeLine{01126           xsh-\/>getFxDag()-\/>updateFxIdTable(linkedFx);}
\DoxyCodeLine{01127         \}}
\DoxyCodeLine{01128       \}}
\DoxyCodeLine{01129     \}}
\DoxyCodeLine{01130   \}}
\DoxyCodeLine{01131 }
\DoxyCodeLine{01132   \textcolor{comment}{// Update the link, like in functions above}}
\DoxyCodeLine{01133   \textcolor{keywordflow}{if} (!fxTable.empty() \&\& doClone) updateFxLinks(fxTable.toStdMap());}
\DoxyCodeLine{01134 }
\DoxyCodeLine{01135   \textcolor{comment}{// Paste any associated spline (not stored im m\_splines)}}
\DoxyCodeLine{01136   std::map<TStageObjectSpline *, TStageObjectSpline *> splines;}
\DoxyCodeLine{01137   \textcolor{keywordflow}{for} (i = 0; i < (int)restoredIds.size(); ++i) \{}
\DoxyCodeLine{01138     \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} \textcolor{keywordtype}{id} = restoredIds[i];}
\DoxyCodeLine{01139     \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj = xsh-\/>getStageObject(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01140 }
\DoxyCodeLine{01141     \mbox{\hyperlink{class_t_stage_object_spline}{TStageObjectSpline}} *spline = obj-\/>\mbox{\hyperlink{class_t_stage_object_a425cb2dbcefe6ba4e288e1e8bdd16f72}{getSpline}}();}
\DoxyCodeLine{01142     \textcolor{keywordflow}{if} (!spline) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01143 }
\DoxyCodeLine{01144     \mbox{\hyperlink{class_t_stage_object_tree}{TStageObjectTree}} *objTree = xsh-\/>getStageObjectTree();}
\DoxyCodeLine{01145     \textcolor{keywordflow}{if} (objTree-\/>\mbox{\hyperlink{class_t_stage_object_tree_ad7fbf2fc5bdf3d4d009978775c90ec26}{containsSpline}}(}
\DoxyCodeLine{01146             spline))  \textcolor{comment}{// No need to add it if it's already there}}
\DoxyCodeLine{01147       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01148 }
\DoxyCodeLine{01149     std::map<TStageObjectSpline *, TStageObjectSpline *>::iterator it =}
\DoxyCodeLine{01150         splines.find(spline);}
\DoxyCodeLine{01151     \textcolor{keywordflow}{if} (it != splines.end()) \{}
\DoxyCodeLine{01152       \textcolor{comment}{// Seems that multiple objects can have the same spline...}}
\DoxyCodeLine{01153       \textcolor{comment}{// BTW, shouldn't this case stop at the continue before ?}}
\DoxyCodeLine{01154       obj-\/>\mbox{\hyperlink{class_t_stage_object_a43d90987cedca57a03e277d6140ada14}{setSpline}}(it-\/>second);}
\DoxyCodeLine{01155       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01156     \}}
\DoxyCodeLine{01157 }
\DoxyCodeLine{01158     \textcolor{comment}{// The spline was not found. Clone and add it to the xsheet}}
\DoxyCodeLine{01159     \mbox{\hyperlink{class_t_stage_object_spline}{TStageObjectSpline}} *newSpline = spline-\/>clone();  \textcolor{comment}{// Not checking doClone ?}}
\DoxyCodeLine{01160     objTree-\/>\mbox{\hyperlink{class_t_stage_object_tree_a9aa6e0ceb11a90941b988223bf4a405b}{assignUniqueSplineId}}(newSpline);}
\DoxyCodeLine{01161     objTree-\/>\mbox{\hyperlink{class_t_stage_object_tree_a5ccbb69161f93632ce7408dfb58bb8be}{insertSpline}}(newSpline);}
\DoxyCodeLine{01162     obj-\/>\mbox{\hyperlink{class_t_stage_object_a43d90987cedca57a03e277d6140ada14}{setSpline}}(newSpline);}
\DoxyCodeLine{01163 }
\DoxyCodeLine{01164     splines[spline] = newSpline;}
\DoxyCodeLine{01165   \}}
\DoxyCodeLine{01166 }
\DoxyCodeLine{01167   \textcolor{comment}{// paste stored path}}
\DoxyCodeLine{01168   QList<TSplineDataElement *>::const\_iterator splinIt;}
\DoxyCodeLine{01169   \textcolor{keywordflow}{for} (splinIt = m\_splines.begin(); splinIt != m\_splines.end(); ++splinIt) \{}
\DoxyCodeLine{01170     \mbox{\hyperlink{class_t_stage_object_tree}{TStageObjectTree}} *objTree    = xsh-\/>getStageObjectTree();}
\DoxyCodeLine{01171     \mbox{\hyperlink{class_t_spline_data_element}{TSplineDataElement}} *splineEl = *splinIt;}
\DoxyCodeLine{01172     \mbox{\hyperlink{class_t_stage_object_spline}{TStageObjectSpline}} *spline   = splineEl-\/>restoreSpline(fxFlags);}
\DoxyCodeLine{01173     \textcolor{keywordflow}{if} (doClone) objTree-\/>\mbox{\hyperlink{class_t_stage_object_tree_a9aa6e0ceb11a90941b988223bf4a405b}{assignUniqueSplineId}}(spline);}
\DoxyCodeLine{01174     objTree-\/>\mbox{\hyperlink{class_t_stage_object_tree_a5ccbb69161f93632ce7408dfb58bb8be}{insertSpline}}(spline);}
\DoxyCodeLine{01175     restoredSpline.push\_back(spline-\/>getId());}
\DoxyCodeLine{01176   \}}
\DoxyCodeLine{01177 }
\DoxyCodeLine{01178   xsh-\/>updateFrameCount();}
\DoxyCodeLine{01179 }
\DoxyCodeLine{01180   \textcolor{keywordflow}{if} (pos != TConst::nowhere) \{}
\DoxyCodeLine{01181     \textcolor{comment}{// Update objects positions depending on the externally supplied pos}}
\DoxyCodeLine{01182 }
\DoxyCodeLine{01183     \mbox{\hyperlink{class_t_point_t}{TPointD}} middlePos;}
\DoxyCodeLine{01184     \textcolor{keywordtype}{int} count = 0;}
\DoxyCodeLine{01185 }
\DoxyCodeLine{01186     \textcolor{keywordflow}{for} (i = 0; i < (int)restoredIds.size(); ++i) \{}
\DoxyCodeLine{01187       \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} \textcolor{keywordtype}{id} = restoredIds[i];}
\DoxyCodeLine{01188       \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj = xsh-\/>getStageObject(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01189 }
\DoxyCodeLine{01190       \mbox{\hyperlink{class_t_point_t}{TPointD}} oldPos = obj-\/>\mbox{\hyperlink{class_t_stage_object_a4d0ba923b8e950e754d1ca45af0819fc}{getDagNodePos}}();}
\DoxyCodeLine{01191       \textcolor{keywordflow}{if} (oldPos == TConst::nowhere) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01192 }
\DoxyCodeLine{01193       middlePos += oldPos;}
\DoxyCodeLine{01194       ++count;}
\DoxyCodeLine{01195     \}}
\DoxyCodeLine{01196 }
\DoxyCodeLine{01197     middlePos      = \mbox{\hyperlink{class_t_point_t}{TPointD}}(middlePos.x / count, middlePos.y / count);}
\DoxyCodeLine{01198     \mbox{\hyperlink{class_t_point_t}{TPointD}} offset = pos -\/ middlePos;}
\DoxyCodeLine{01199 }
\DoxyCodeLine{01200     \textcolor{keywordflow}{for} (i = 0; i < (int)restoredIds.size(); ++i) \{}
\DoxyCodeLine{01201       \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} \textcolor{keywordtype}{id} = restoredIds[i];}
\DoxyCodeLine{01202       \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj = xsh-\/>getStageObject(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01203 }
\DoxyCodeLine{01204       \mbox{\hyperlink{class_t_point_t}{TPointD}} oldPos = obj-\/>\mbox{\hyperlink{class_t_stage_object_a4d0ba923b8e950e754d1ca45af0819fc}{getDagNodePos}}();}
\DoxyCodeLine{01205       \textcolor{keywordflow}{if} (oldPos == TConst::nowhere) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01206 }
\DoxyCodeLine{01207       obj-\/>\mbox{\hyperlink{class_t_stage_object_a64e318fa720c638b27abe8cd4f2c9494}{setDagNodePos}}(oldPos + offset);}
\DoxyCodeLine{01208     \}}
\DoxyCodeLine{01209   \}}
\DoxyCodeLine{01210 }
\DoxyCodeLine{01211   \textcolor{comment}{// reset grammers for all parameters of pasted stage objects and fxs}}
\DoxyCodeLine{01212   \textcolor{comment}{// or they fails to refer to other parameters via expression}}
\DoxyCodeLine{01213   \textcolor{comment}{// if they are pasted in different xsheet}}
\DoxyCodeLine{01214   \mbox{\hyperlink{class_t_syntax_1_1_grammar}{TSyntax::Grammar}} *grammer = xsh-\/>getStageObjectTree()-\/>getGrammar();}
\DoxyCodeLine{01215   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \textcolor{keywordtype}{id} : restoredIds) \{}
\DoxyCodeLine{01216     \mbox{\hyperlink{class_t_stage_object}{TStageObject}} *obj = xsh-\/>getStageObject(\textcolor{keywordtype}{id});}
\DoxyCodeLine{01217     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} c = 0; c != TStageObject::T\_ChannelCount; ++c)}
\DoxyCodeLine{01218       obj-\/>\mbox{\hyperlink{class_t_stage_object_ae4cf64f5085310a14074ceb54d2b5177}{getParam}}((\mbox{\hyperlink{class_t_stage_object_ac7a60ddc803173dc7591f784577cb439}{TStageObject::Channel}})c)-\/>setGrammar(grammer);}
\DoxyCodeLine{01219     \textcolor{keywordflow}{if} (\textcolor{keyword}{const} \mbox{\hyperlink{class_t_smart_pointer_t}{PlasticSkeletonDeformationP}} \&sd =}
\DoxyCodeLine{01220             obj-\/>\mbox{\hyperlink{class_t_stage_object_af2c5d9f172e73e4cb09b769700df3acb}{getPlasticSkeletonDeformation}}())}
\DoxyCodeLine{01221       sd-\/>setGrammar(grammer);}
\DoxyCodeLine{01222   \}}
\DoxyCodeLine{01223   QMap<TFx *, TFx *>::const\_iterator it;}
\DoxyCodeLine{01224   \textcolor{keywordflow}{for} (it = fxTable.constBegin(); it != fxTable.constEnd(); ++it) \{}
\DoxyCodeLine{01225     setGrammerToParams(it.value()-\/>getParams(), grammer);}
\DoxyCodeLine{01226   \}}
\DoxyCodeLine{01227 }
\DoxyCodeLine{01228   \textcolor{keywordflow}{return} restoredIds;}
\DoxyCodeLine{01229 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_stage_objects_data_acbffc8f0eafc04b34b5247bf1e21fdcf}\label{class_stage_objects_data_acbffc8f0eafc04b34b5247bf1e21fdcf}} 
\index{StageObjectsData@{StageObjectsData}!storeColumnFxs@{storeColumnFxs}}
\index{storeColumnFxs@{storeColumnFxs}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{storeColumnFxs()}{storeColumnFxs()}}
{\footnotesize\ttfamily void Stage\+Objects\+Data\+::store\+Column\+Fxs (\begin{DoxyParamCaption}\item[{const std\+::set$<$ int $>$ \&}]{column\+Indexes,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsh,  }\item[{int}]{fx\+Flags }\end{DoxyParamCaption})}

Stores the column fxs \textbackslash{}it\{and their upstream fxs\} associated to the specified column indices, {\bfseries{without}} storing the columns stage objects. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00808                                                                  \{}
\DoxyCodeLine{00809   \textcolor{keywordtype}{bool} doClone             = (fxFlags \& eDoClone);}
\DoxyCodeLine{00810   \textcolor{keywordtype}{bool} resetFxDagPositions = (fxFlags \& eResetFxDagPositions);}
\DoxyCodeLine{00811 }
\DoxyCodeLine{00812   std::set<TFx *> internalFxs;}
\DoxyCodeLine{00813   xsh-\/>\mbox{\hyperlink{class_t_xsheet_adc7c74cce346abf3699bb250eb17a9c2}{getFxDag}}()-\/>getInternalFxs()-\/>getFxs(internalFxs);}
\DoxyCodeLine{00814 }
\DoxyCodeLine{00815   \textcolor{comment}{// Iterate internal fxs (note: columns NOT included)}}
\DoxyCodeLine{00816   \textcolor{comment}{// NOTE: Could this be too heavy ? Shouldn't we travel upstream from given}}
\DoxyCodeLine{00817   \textcolor{comment}{// column fxs?}}
\DoxyCodeLine{00818   std::set<TFx *>::iterator it;}
\DoxyCodeLine{00819   \textcolor{keywordflow}{for} (it = internalFxs.begin(); it != internalFxs.end(); ++it) \{}
\DoxyCodeLine{00820     \mbox{\hyperlink{class_t_fx}{TFx}} *fxOrig = *it, *fx = fxOrig;}
\DoxyCodeLine{00821 }
\DoxyCodeLine{00822     \textcolor{keywordflow}{if} (m\_fxTable.find(fx) != m\_fxTable.end())  \textcolor{comment}{// If already treated}}
\DoxyCodeLine{00823       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00824 }
\DoxyCodeLine{00825     \textcolor{keywordflow}{if} (canGenerate(m\_originalColumnFxs,}
\DoxyCodeLine{00826                     fx) != CanGenerate)  \textcolor{comment}{// If not completely in the upstream}}
\DoxyCodeLine{00827       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00828 }
\DoxyCodeLine{00829     \textcolor{keywordflow}{if} (doClone) \{}
\DoxyCodeLine{00830       \textcolor{comment}{// Clone the fx if required}}
\DoxyCodeLine{00831       fx = fxOrig-\/>clone(\textcolor{keyword}{false});}
\DoxyCodeLine{00832 }
\DoxyCodeLine{00833       fx-\/>setName(fxOrig-\/>getName());}
\DoxyCodeLine{00834       fx-\/>getAttributes()-\/>setId(fxOrig-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{00835       fx-\/>getAttributes()-\/>passiveCacheDataIdx() = -\/1;}
\DoxyCodeLine{00836 }
\DoxyCodeLine{00837       \textcolor{keywordflow}{if} (resetFxDagPositions)}
\DoxyCodeLine{00838         fx-\/>getAttributes()-\/>setDagNodePos(TConst::nowhere);}
\DoxyCodeLine{00839     \}}
\DoxyCodeLine{00840 }
\DoxyCodeLine{00841     m\_fxTable[fxOrig] = fx;}
\DoxyCodeLine{00842     fx-\/>addRef();}
\DoxyCodeLine{00843     m\_fxs.insert(fx);}
\DoxyCodeLine{00844 }
\DoxyCodeLine{00845     \textcolor{keywordflow}{if} (isColumnSelectionTerminalFx(fxOrig, xsh-\/>\mbox{\hyperlink{class_t_xsheet_adc7c74cce346abf3699bb250eb17a9c2}{getFxDag}}()-\/>getTerminalFxs(),}
\DoxyCodeLine{00846                                     m\_originalColumnFxs)) \{}
\DoxyCodeLine{00847       fx-\/>addRef();}
\DoxyCodeLine{00848       m\_terminalFxs.insert(fx);}
\DoxyCodeLine{00849     \}}
\DoxyCodeLine{00850 }
\DoxyCodeLine{00851     \textcolor{keywordflow}{if} (fxOrig-\/>getLinkedFx() != fxOrig)  \textcolor{comment}{// Linked fx}}
\DoxyCodeLine{00852     \{}
\DoxyCodeLine{00853       \textcolor{keywordflow}{if} (canGenerate(m\_originalColumnFxs, fxOrig-\/>getLinkedFx()) !=}
\DoxyCodeLine{00854           CanGenerate)}
\DoxyCodeLine{00855         fx-\/>linkParams(fxOrig-\/>getLinkedFx());}
\DoxyCodeLine{00856       \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00857         \textcolor{comment}{// Insert the linked fx directly here}}
\DoxyCodeLine{00858         \mbox{\hyperlink{class_t_fx}{TFx}} *linkedFx, *oldLinkedFx = fxOrig-\/>getLinkedFx();}
\DoxyCodeLine{00859         \textcolor{keywordflow}{if} (doClone) \{}
\DoxyCodeLine{00860           linkedFx = fx-\/>clone(\textcolor{keyword}{false});  \textcolor{comment}{// Not oldLinkedFx-\/>clone() ?}}
\DoxyCodeLine{00861           linkedFx-\/>linkParams(fx);}
\DoxyCodeLine{00862 }
\DoxyCodeLine{00863           linkedFx-\/>setName(oldLinkedFx-\/>getName());}
\DoxyCodeLine{00864           linkedFx-\/>getAttributes()-\/>setId(}
\DoxyCodeLine{00865               oldLinkedFx-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{00866           linkedFx-\/>getAttributes()-\/>passiveCacheDataIdx() = -\/1;}
\DoxyCodeLine{00867 }
\DoxyCodeLine{00868           \textcolor{keywordflow}{if} (resetFxDagPositions)}
\DoxyCodeLine{00869             fx-\/>getAttributes()-\/>setDagNodePos(TConst::nowhere);  \textcolor{comment}{// Here too ?}}
\DoxyCodeLine{00870 }
\DoxyCodeLine{00871           xsh-\/>\mbox{\hyperlink{class_t_xsheet_adc7c74cce346abf3699bb250eb17a9c2}{getFxDag}}()-\/>assignUniqueId(linkedFx);}
\DoxyCodeLine{00872         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00873           linkedFx = oldLinkedFx;}
\DoxyCodeLine{00874 }
\DoxyCodeLine{00875         m\_fxTable[oldLinkedFx] = linkedFx;}
\DoxyCodeLine{00876         linkedFx-\/>addRef();}
\DoxyCodeLine{00877         m\_fxs.insert(linkedFx);}
\DoxyCodeLine{00878 }
\DoxyCodeLine{00879         \textcolor{keywordflow}{if} (xsh-\/>\mbox{\hyperlink{class_t_xsheet_adc7c74cce346abf3699bb250eb17a9c2}{getFxDag}}()-\/>getTerminalFxs()-\/>containsFx(}
\DoxyCodeLine{00880                 fx-\/>getLinkedFx()))  \textcolor{comment}{// Here too -\/ isATerminal ?}}
\DoxyCodeLine{00881         \{}
\DoxyCodeLine{00882           linkedFx-\/>addRef();}
\DoxyCodeLine{00883           m\_terminalFxs.insert(linkedFx);}
\DoxyCodeLine{00884         \}}
\DoxyCodeLine{00885       \}}
\DoxyCodeLine{00886     \}}
\DoxyCodeLine{00887   \}}
\DoxyCodeLine{00888 }
\DoxyCodeLine{00889   \textcolor{comment}{// Like in the functions above, update links}}
\DoxyCodeLine{00890   \textcolor{keywordflow}{if} (!m\_fxTable.empty() \&\& doClone) updateFxLinks(m\_fxTable);}
\DoxyCodeLine{00891 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01564}{TXsheet\+::get\+Fx\+Dag()}}.

\mbox{\Hypertarget{class_stage_objects_data_a64d285aa4bb0f00d17e0f659e1d28ae3}\label{class_stage_objects_data_a64d285aa4bb0f00d17e0f659e1d28ae3}} 
\index{StageObjectsData@{StageObjectsData}!storeColumns@{storeColumns}}
\index{storeColumns@{storeColumns}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{storeColumns()}{storeColumns()}}
{\footnotesize\ttfamily void Stage\+Objects\+Data\+::store\+Columns (\begin{DoxyParamCaption}\item[{const std\+::set$<$ int $>$ \&}]{column\+Indexes,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsheet,  }\item[{int}]{fx\+Flags }\end{DoxyParamCaption})}



Overloaded function, stores the specified columns in the supplied xsheet. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00708                                                                \{}
\DoxyCodeLine{00709   std::vector<TStageObjectId> ids;}
\DoxyCodeLine{00710 }
\DoxyCodeLine{00711   std::set<int>::const\_iterator it;}
\DoxyCodeLine{00712   \textcolor{keywordflow}{for} (it = columnIndexes.begin(); it != columnIndexes.end(); ++it)}
\DoxyCodeLine{00713     ids.push\_back(TStageObjectId::ColumnId(*it));}
\DoxyCodeLine{00714 }
\DoxyCodeLine{00715   \mbox{\hyperlink{class_stage_objects_data_ab1bf651aeb67ce71d2deb874e3d37e26}{storeObjects}}(ids, xsh, fxFlags);}
\DoxyCodeLine{00716 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00635}{store\+Objects()}}.

\mbox{\Hypertarget{class_stage_objects_data_ab4716c1e39e02f7ae4ef25a4f670b6b6}\label{class_stage_objects_data_ab4716c1e39e02f7ae4ef25a4f670b6b6}} 
\index{StageObjectsData@{StageObjectsData}!storeFxs@{storeFxs}}
\index{storeFxs@{storeFxs}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{storeFxs()}{storeFxs()}}
{\footnotesize\ttfamily void Stage\+Objects\+Data\+::store\+Fxs (\begin{DoxyParamCaption}\item[{const std\+::set$<$ \mbox{\hyperlink{class_t_fx}{TFx}} $\ast$ $>$ \&}]{fxs,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsheet,  }\item[{int}]{fx\+Flags }\end{DoxyParamCaption})}



Stores the specified fxs from the xsheet. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00721                                              \{}
\DoxyCodeLine{00722   \textcolor{keywordtype}{bool} doClone             = (fxFlags \& eDoClone);}
\DoxyCodeLine{00723   \textcolor{keywordtype}{bool} resetFxDagPositions = (fxFlags \& eResetFxDagPositions);}
\DoxyCodeLine{00724 }
\DoxyCodeLine{00725   \mbox{\hyperlink{class_t_fx_set}{TFxSet}} *terminalFxs = xsh-\/>getFxDag()-\/>getTerminalFxs();}
\DoxyCodeLine{00726 }
\DoxyCodeLine{00727   \textcolor{comment}{// Traverse specified fxs}}
\DoxyCodeLine{00728   std::set<TFx *>::const\_iterator it;}
\DoxyCodeLine{00729   \textcolor{keywordflow}{for} (it = fxs.begin(); it != fxs.end(); ++it) \{}
\DoxyCodeLine{00730     \mbox{\hyperlink{class_t_fx}{TFx}} *fxOrig = *it, *fx = fxOrig;}
\DoxyCodeLine{00731 }
\DoxyCodeLine{00732     \textcolor{keywordflow}{if} (doClone) \{}
\DoxyCodeLine{00733       \textcolor{comment}{// If required, clone them}}
\DoxyCodeLine{00734       fx = fxOrig-\/>clone(\textcolor{keyword}{false});}
\DoxyCodeLine{00735 }
\DoxyCodeLine{00736       fx-\/>setName(fxOrig-\/>getName());}
\DoxyCodeLine{00737       fx-\/>getAttributes()-\/>setId(fxOrig-\/>getAttributes()-\/>getId());}
\DoxyCodeLine{00738       fx-\/>getAttributes()-\/>passiveCacheDataIdx() = -\/1;}
\DoxyCodeLine{00739 }
\DoxyCodeLine{00740       \textcolor{keywordflow}{if} (resetFxDagPositions)}
\DoxyCodeLine{00741         fx-\/>getAttributes()-\/>setDagNodePos(TConst::nowhere);}
\DoxyCodeLine{00742     \}}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00744     \textcolor{comment}{// Store them (and the original/clone pairing even if not cloning)}}
\DoxyCodeLine{00745     m\_fxTable[fxOrig] = fx;}
\DoxyCodeLine{00746     fx-\/>addRef();}
\DoxyCodeLine{00747     m\_fxs.insert(fx);}
\DoxyCodeLine{00748 }
\DoxyCodeLine{00749     \textcolor{comment}{// Find out if the fx is a terminal one in the selection. If so, store it}}
\DoxyCodeLine{00750     \textcolor{comment}{// there too.}}
\DoxyCodeLine{00751     \textcolor{keywordtype}{bool} isTerminal = \textcolor{keyword}{true};}
\DoxyCodeLine{00752     \textcolor{keywordflow}{if} (!terminalFxs-\/>containsFx(}
\DoxyCodeLine{00753             fxOrig))  \textcolor{comment}{// If it's terminal in the xsheet, no doubt}}
\DoxyCodeLine{00754     \{}
\DoxyCodeLine{00755       \textcolor{comment}{// Otherwise, check terminality with respect to the selection}}
\DoxyCodeLine{00756       \textcolor{keywordtype}{int} i, outputConnectionsCount = fxOrig-\/>getOutputConnectionCount();}
\DoxyCodeLine{00757       \textcolor{keywordflow}{for} (i = 0; i < outputConnectionsCount; ++i) \{}
\DoxyCodeLine{00758         \mbox{\hyperlink{class_t_fx}{TFx}} *outputFx = fxOrig-\/>getOutputConnection(i)-\/>getOwnerFx();}
\DoxyCodeLine{00759         \textcolor{keywordflow}{if} (outputFx \&\& fxs.count(outputFx) > 0) \{}
\DoxyCodeLine{00760           isTerminal = \textcolor{keyword}{false};}
\DoxyCodeLine{00761           \textcolor{keywordflow}{break};}
\DoxyCodeLine{00762         \}}
\DoxyCodeLine{00763       \}}
\DoxyCodeLine{00764     \}}
\DoxyCodeLine{00765 }
\DoxyCodeLine{00766     \textcolor{comment}{// Well, excluding true TOutputFxs...}}
\DoxyCodeLine{00767     \mbox{\hyperlink{class_t_output_fx}{TOutputFx}} *outFx = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_t_output_fx}{TOutputFx}} *\textcolor{keyword}{>}(fx);}
\DoxyCodeLine{00768     \textcolor{keywordflow}{if} (isTerminal \&\& !outFx) \{}
\DoxyCodeLine{00769       fx-\/>addRef();}
\DoxyCodeLine{00770       m\_terminalFxs.insert(fx);}
\DoxyCodeLine{00771     \}}
\DoxyCodeLine{00772   \}}
\DoxyCodeLine{00773 }
\DoxyCodeLine{00774   \textcolor{comment}{// Updating terminality of the column fxs too!}}
\DoxyCodeLine{00775   \textcolor{comment}{// WARNING: This requires that storeObjects() is invoked BEFORE this !}}
\DoxyCodeLine{00776   \textcolor{keywordflow}{for} (it = m\_originalColumnFxs.begin(); it != m\_originalColumnFxs.end();}
\DoxyCodeLine{00777        ++it) \{}
\DoxyCodeLine{00778     \mbox{\hyperlink{class_t_fx}{TFx}} *fxOrig = *it;}
\DoxyCodeLine{00779 }
\DoxyCodeLine{00780     \textcolor{keywordtype}{bool} isTerminal = \textcolor{keyword}{true};}
\DoxyCodeLine{00781     \textcolor{keywordflow}{if} (!terminalFxs-\/>containsFx(fxOrig)) \{}
\DoxyCodeLine{00782       \textcolor{keywordtype}{int} i, outputConnectionsCount = fxOrig-\/>getOutputConnectionCount();}
\DoxyCodeLine{00783       \textcolor{keywordflow}{for} (i = 0; i < outputConnectionsCount; ++i) \{}
\DoxyCodeLine{00784         \mbox{\hyperlink{class_t_fx}{TFx}} *outputFx = fxOrig-\/>getOutputConnection(i)-\/>getOwnerFx();}
\DoxyCodeLine{00785         \textcolor{keywordflow}{if} (outputFx \&\& fxs.count(outputFx) > 0) \{}
\DoxyCodeLine{00786           isTerminal = \textcolor{keyword}{false};}
\DoxyCodeLine{00787           \textcolor{keywordflow}{break};}
\DoxyCodeLine{00788         \}}
\DoxyCodeLine{00789       \}}
\DoxyCodeLine{00790     \}}
\DoxyCodeLine{00791 }
\DoxyCodeLine{00792     \textcolor{keywordflow}{if} (isTerminal) \{}
\DoxyCodeLine{00793       \mbox{\hyperlink{class_t_fx}{TFx}} *fx = m\_fxTable[fxOrig];}
\DoxyCodeLine{00794 }
\DoxyCodeLine{00795       fx-\/>addRef();}
\DoxyCodeLine{00796       m\_terminalFxs.insert(fx);}
\DoxyCodeLine{00797     \}}
\DoxyCodeLine{00798   \}}
\DoxyCodeLine{00799 }
\DoxyCodeLine{00800   \textcolor{keywordflow}{if} (!m\_fxTable.empty() \&\& doClone)}
\DoxyCodeLine{00801     updateFxLinks(m\_fxTable);  \textcolor{comment}{// Apply original/clone pairings}}
\DoxyCodeLine{00802                                \textcolor{comment}{// to fx relatives}}
\DoxyCodeLine{00803 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01564}{TXsheet\+::get\+Fx\+Dag()}}.

\mbox{\Hypertarget{class_stage_objects_data_ab1bf651aeb67ce71d2deb874e3d37e26}\label{class_stage_objects_data_ab1bf651aeb67ce71d2deb874e3d37e26}} 
\index{StageObjectsData@{StageObjectsData}!storeObjects@{storeObjects}}
\index{storeObjects@{storeObjects}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{storeObjects()}{storeObjects()}}
{\footnotesize\ttfamily void Stage\+Objects\+Data\+::store\+Objects (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ \mbox{\hyperlink{class_t_stage_object_id}{TStage\+Object\+Id}} $>$ \&}]{ids,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsheet,  }\item[{int}]{fx\+Flags }\end{DoxyParamCaption})}

Stores the xsheet\textquotesingle{}s specified stage objects (be them cameras, columns, pegbars or else). Additional flags support \mbox{\hyperlink{class_t_xsh_column}{TXsh\+Column}} cloning for columns. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00636                                                                \{}
\DoxyCodeLine{00637   assert(}
\DoxyCodeLine{00638       m\_fxTable.empty());  \textcolor{comment}{// Should be enforced OUTSIDE. Track implicit uses.}}
\DoxyCodeLine{00639   m\_fxTable.clear();       \textcolor{comment}{// TO BE REMOVED}}
\DoxyCodeLine{00640 }
\DoxyCodeLine{00641   \textcolor{keywordtype}{int} i, objCount = ids.size();}
\DoxyCodeLine{00642 }
\DoxyCodeLine{00643   \textcolor{comment}{// Discriminate sensible stage object types (ie cameras and columns from the}}
\DoxyCodeLine{00644   \textcolor{comment}{// rest).}}
\DoxyCodeLine{00645   \textcolor{comment}{// Store them in a map, ordered by object index.}}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647   std::map<int, TStageObjectId> cameraIds, columnIds, pegbarIds;}
\DoxyCodeLine{00648   \textcolor{keywordflow}{for} (i = 0; i < objCount; ++i) \{}
\DoxyCodeLine{00649     \mbox{\hyperlink{class_t_stage_object_id}{TStageObjectId}} \textcolor{keywordtype}{id} = ids[i];}
\DoxyCodeLine{00650     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id}.isColumn())}
\DoxyCodeLine{00651       columnIds[\textcolor{keywordtype}{id}.getIndex()] = id;}
\DoxyCodeLine{00652     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id}.isPegbar())}
\DoxyCodeLine{00653       pegbarIds[\textcolor{keywordtype}{id}.getIndex()] = id;}
\DoxyCodeLine{00654     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id}.isCamera())}
\DoxyCodeLine{00655       cameraIds[\textcolor{keywordtype}{id}.getIndex()] = id;}
\DoxyCodeLine{00656   \}}
\DoxyCodeLine{00657 }
\DoxyCodeLine{00658   \textcolor{comment}{// Store a suitable object for each}}
\DoxyCodeLine{00659   std::map<int, TStageObjectId>::iterator it;}
\DoxyCodeLine{00660   \textcolor{keywordflow}{for} (it = cameraIds.begin(); it != cameraIds.end(); ++it) \{}
\DoxyCodeLine{00661     \textcolor{comment}{// Cameras}}
\DoxyCodeLine{00662     \mbox{\hyperlink{class_t_camera_data_element}{TCameraDataElement}} *cameraElement = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_camera_data_element}{TCameraDataElement}}();}
\DoxyCodeLine{00663     cameraElement-\/>\mbox{\hyperlink{class_t_camera_data_element_ae13b97f7ae052f164de7b710ad3bcd25}{storeCamera}}(it-\/>second, xsh);}
\DoxyCodeLine{00664     m\_elements.append(cameraElement);}
\DoxyCodeLine{00665   \}}
\DoxyCodeLine{00666 }
\DoxyCodeLine{00667   \textcolor{keywordflow}{for} (it = pegbarIds.begin(); it != pegbarIds.end(); ++it) \{}
\DoxyCodeLine{00668     \textcolor{comment}{// Pegbars (includes curves)}}
\DoxyCodeLine{00669     \mbox{\hyperlink{class_t_stage_object_data_element}{TStageObjectDataElement}} *objElement = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_stage_object_data_element}{TStageObjectDataElement}}();}
\DoxyCodeLine{00670     objElement-\/>\mbox{\hyperlink{class_t_stage_object_data_element_a7e8d6e78c296ce85d47c99a2a65ae4ff}{storeObject}}(it-\/>second, xsh);}
\DoxyCodeLine{00671     m\_elements.append(objElement);}
\DoxyCodeLine{00672   \}}
\DoxyCodeLine{00673 }
\DoxyCodeLine{00674   \textcolor{keywordflow}{for} (it = columnIds.begin(); it != columnIds.end(); ++it) \{}
\DoxyCodeLine{00675     \textcolor{comment}{// Columns}}
\DoxyCodeLine{00676     \textcolor{keywordtype}{int} colIndex = it-\/>second.getIndex();}
\DoxyCodeLine{00677 }
\DoxyCodeLine{00678     \mbox{\hyperlink{class_t_xsh_column}{TXshColumn}} *column = xsh-\/>getColumn(colIndex);}
\DoxyCodeLine{00679     \textcolor{keywordflow}{if} (!column) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00680 }
\DoxyCodeLine{00681     \mbox{\hyperlink{class_t_column_data_element}{TColumnDataElement}} *columnElement = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_column_data_element}{TColumnDataElement}}();}
\DoxyCodeLine{00682     columnElement-\/>\mbox{\hyperlink{class_t_column_data_element_afbaf55c99399765b5d42b257cb9802c1}{storeColumn}}(xsh, colIndex, fxFlags);}
\DoxyCodeLine{00683     m\_elements.append(columnElement);}
\DoxyCodeLine{00684 }
\DoxyCodeLine{00685     \mbox{\hyperlink{class_t_xsh_column}{TXshColumn}} *copiedColumn = columnElement-\/>m\_column.getPointer();}
\DoxyCodeLine{00686     \textcolor{keywordflow}{if} (column-\/>getFx() \&\& copiedColumn-\/>getFx()) \{}
\DoxyCodeLine{00687       \textcolor{comment}{// Store column fx pairings (even if the originals are not cloned)}}
\DoxyCodeLine{00688       m\_fxTable[column-\/>getFx()] = copiedColumn-\/>getFx();}
\DoxyCodeLine{00689       m\_originalColumnFxs.insert(column-\/>getFx());}
\DoxyCodeLine{00690     \}}
\DoxyCodeLine{00691   \}}
\DoxyCodeLine{00692 }
\DoxyCodeLine{00693   \textcolor{comment}{// Insert terminal fxs}}
\DoxyCodeLine{00694   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \textcolor{keyword}{const} \&e : m\_originalColumnFxs) \{}
\DoxyCodeLine{00695     \textcolor{keywordflow}{if} (isColumnSelectionTerminalFx(e, xsh-\/>getFxDag()-\/>getTerminalFxs(),}
\DoxyCodeLine{00696                                     m\_originalColumnFxs)) \{}
\DoxyCodeLine{00697       \mbox{\hyperlink{class_t_fx}{TFx}} *fx = m\_fxTable[e];}
\DoxyCodeLine{00698 }
\DoxyCodeLine{00699       fx-\/>addRef();}
\DoxyCodeLine{00700       m\_terminalFxs.insert(fx);}
\DoxyCodeLine{00701     \}}
\DoxyCodeLine{00702   \}}
\DoxyCodeLine{00703 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01418}{TXsheet\+::get\+Column()}}, \mbox{\hyperlink{l01564}{TXsheet\+::get\+Fx\+Dag()}}, \mbox{\hyperlink{l00428}{TCamera\+Data\+Element\+::store\+Camera()}}, \mbox{\hyperlink{l00298}{TColumn\+Data\+Element\+::store\+Column()}}, and \mbox{\hyperlink{l00189}{TStage\+Object\+Data\+Element\+::store\+Object()}}.



Referenced by \mbox{\hyperlink{l00707}{store\+Columns()}}.

\mbox{\Hypertarget{class_stage_objects_data_a8273a597f1714f536f9170af58a0e4d7}\label{class_stage_objects_data_a8273a597f1714f536f9170af58a0e4d7}} 
\index{StageObjectsData@{StageObjectsData}!storeSplines@{storeSplines}}
\index{storeSplines@{storeSplines}!StageObjectsData@{StageObjectsData}}
\doxysubsubsection{\texorpdfstring{storeSplines()}{storeSplines()}}
{\footnotesize\ttfamily void Stage\+Objects\+Data\+::store\+Splines (\begin{DoxyParamCaption}\item[{const std\+::list$<$ int $>$ \&}]{spline\+Ids,  }\item[{\mbox{\hyperlink{class_t_xsheet}{TXsheet}} $\ast$}]{xsh,  }\item[{int}]{fx\+Flags }\end{DoxyParamCaption})}

Stores the splines identified by the {\bfseries{spline\+Ids}} NOTE\+: a spline will be stored only if no \mbox{\hyperlink{class_t_stage_object}{TStage\+Object}} is connected to it, or if no \mbox{\hyperlink{class_t_stage_object}{TStage\+Object}} connected is stored by this \mbox{\hyperlink{class_stage_objects_data}{Stage\+Objects\+Data}}. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00896                                                                \{}
\DoxyCodeLine{00897   std::list<int>::const\_iterator it;}
\DoxyCodeLine{00898   \textcolor{keywordflow}{for} (it = splineIds.begin(); it != splineIds.end(); ++it) \{}
\DoxyCodeLine{00899     \mbox{\hyperlink{class_t_stage_object_spline}{TStageObjectSpline}} *spline = xsh-\/>\mbox{\hyperlink{class_t_xsheet_a5dc925584e35e1678f5678b79c470959}{getStageObjectTree}}()-\/>\mbox{\hyperlink{class_t_stage_object_tree_a13bf3fb9c8a1d9d7579c0c9358aaa2c9}{getSplineById}}(*it);}
\DoxyCodeLine{00900     \textcolor{keywordtype}{int} j;}
\DoxyCodeLine{00901     \textcolor{keywordtype}{bool} skipSpline = \textcolor{keyword}{false};}
\DoxyCodeLine{00902     \textcolor{keywordflow}{for} (j = 0; j < m\_elements.size(); j++) \{}
\DoxyCodeLine{00903       \mbox{\hyperlink{class_t_stage_object_data_element}{TStageObjectDataElement}} *element = m\_elements[j];}
\DoxyCodeLine{00904       \textcolor{keywordflow}{if} (spline == element-\/>\mbox{\hyperlink{class_t_stage_object_data_element_a9f717b885c1f0debcfe2930268a06361}{m\_params}}-\/>m\_spline) \{}
\DoxyCodeLine{00905         skipSpline = \textcolor{keyword}{true};}
\DoxyCodeLine{00906         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00907       \}}
\DoxyCodeLine{00908     \}}
\DoxyCodeLine{00909     \textcolor{keywordflow}{if} (skipSpline) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00910     \mbox{\hyperlink{class_t_spline_data_element}{TSplineDataElement}} *splineElement = \textcolor{keyword}{new} \mbox{\hyperlink{class_t_spline_data_element}{TSplineDataElement}}();}
\DoxyCodeLine{00911     splineElement-\/>storeSpline(spline, fxFlags);}
\DoxyCodeLine{00912     m\_splines.append(splineElement);}
\DoxyCodeLine{00913   \}}
\DoxyCodeLine{00914 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00573}{TStage\+Object\+Tree\+::get\+Spline\+By\+Id()}}, \mbox{\hyperlink{l00549}{TXsheet\+::get\+Stage\+Object\+Tree()}}, and \mbox{\hyperlink{l00148}{TStage\+Object\+Data\+Element\+::m\+\_\+params}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/toonzqt/stageobjectsdata.\+h\item 
E\+:/opentoonz/toonz/sources/toonzqt/stageobjectsdata.\+cpp\end{DoxyCompactItemize}
