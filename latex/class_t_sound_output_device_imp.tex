\hypertarget{class_t_sound_output_device_imp}{}\doxysection{TSound\+Output\+Device\+Imp Class Reference}
\label{class_t_sound_output_device_imp}\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
Inheritance diagram for TSound\+Output\+Device\+Imp\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_t_sound_output_device_imp}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_a56a01713a12a7fb1fb363a17cb55d26d}{do\+Open\+Device}} (const \mbox{\hyperlink{class_t_sound_track_format}{TSound\+Track\+Format}} \&format)
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_ab58a3da6f623a3a1ffa51cd0dd6a6037}{do\+Play}} (WAVEHDR $\ast$whdr, const \mbox{\hyperlink{class_t_sound_track_format}{TSound\+Track\+Format}} format)
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_ad4fe1efd71cc92b860f6a9b741eb3c44}{do\+Close\+Device}} ()
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_a751763a6d12ad0e1b9b18603097516d6}{verify\+Rate}} ()
\item 
void \mbox{\hyperlink{class_t_sound_output_device_imp_ad4c7c260d66b010decceec8d79b79a7a}{insert\+All\+Rate}} ()
\item 
double \mbox{\hyperlink{class_t_sound_output_device_imp_a3ee0c52b637f0b27875fd64079a583fa}{get\+Volume}} ()
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_a5ea30fecad9f9939508c7d70b439bc3a}{is\+Looping}} ()
\item 
void \mbox{\hyperlink{class_t_sound_output_device_imp_ade03674a9115d59efa34083efea8b0bc}{prepare\+Volume}} (double x)
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_abe0197ff251f54584b348498a7c8e708}{is\+Playing}} ()
\item 
void \mbox{\hyperlink{class_t_sound_output_device_imp_a3a3c98a66b9d963d18cadd1975ba00e2}{set\+Volume}} (double x)
\item 
void \mbox{\hyperlink{class_t_sound_output_device_imp_a0e04241232c7f81165bf74df1cee2d4f}{set\+Looping}} (bool x)
\item 
void \mbox{\hyperlink{class_t_sound_output_device_imp_a93cf4f5131a972a7510885a0790e202e}{stop}} ()
\item 
void \mbox{\hyperlink{class_t_sound_output_device_imp_a891ddbb1f94c5cadec69a20e5830914e}{play}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \&st, TINT32 s0, TINT32 s1, bool loop, bool scrubbing)
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
HWAVEOUT \mbox{\hyperlink{class_t_sound_output_device_imp_aa70cd91f92721e4c6f266b30052a3973}{m\+\_\+wout}}
\item 
\mbox{\hyperlink{class_wavehdr_queue}{Wavehdr\+Queue}} $\ast$ \mbox{\hyperlink{class_t_sound_output_device_imp_a6d9f3c85e03717de0c091fc1310d8e94}{m\+\_\+whdr\+Queue}}
\item 
\mbox{\hyperlink{class_t_sound_track_format}{TSound\+Track\+Format}} \mbox{\hyperlink{class_t_sound_output_device_imp_ae65cb176fe77b1f1f9238e3e6f2e190f}{m\+\_\+current\+Format}}
\item 
std\+::set$<$ int $>$ \mbox{\hyperlink{class_t_sound_output_device_imp_a081f4b37394ee951133d84baaf0c2efc}{m\+\_\+supported\+Rate}}
\item 
\mbox{\hyperlink{class_t_thread_1_1_mutex}{TThread\+::\+Mutex}} \mbox{\hyperlink{class_t_sound_output_device_imp_a1c79ce54e278c3d7842f702ea5348244}{m\+\_\+mutex}}
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_a916e2f593ecb0f273e7e12d178251927}{m\+\_\+stopped}}
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_affb6695bd76a73f7f758cf8d669f9b72}{m\+\_\+is\+Playing}}
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_a978dc04fb87f52ada2694f014848f5c6}{m\+\_\+looped}}
\item 
bool \mbox{\hyperlink{class_t_sound_output_device_imp_a8963088a52fab41ce3b9c28a8a429338}{m\+\_\+scrubbing}}
\item 
std\+::set$<$ \mbox{\hyperlink{class_t_sound_output_device_listener}{TSound\+Output\+Device\+Listener}} $\ast$ $>$ \mbox{\hyperlink{class_t_sound_output_device_imp_a53ed3236be1dc617cd57ae40e0e45d77}{m\+\_\+listeners}}
\item 
DWORD \mbox{\hyperlink{class_t_sound_output_device_imp_a2dd720dbe485a537464984ae871bd0de}{m\+\_\+notify\+Thread\+Id}}
\item 
HANDLE \mbox{\hyperlink{class_t_sound_output_device_imp_ac0ff0af1229de568358e1a0d946bab41}{m\+\_\+close\+Device}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_sound_output_device_imp_ab5208990617ec3c6d3f78e0588f711e4}\label{class_t_sound_output_device_imp_ab5208990617ec3c6d3f78e0588f711e4}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{TSoundOutputDeviceImp()}{TSoundOutputDeviceImp()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily TSound\+Output\+Device\+Imp\+::\+TSound\+Output\+Device\+Imp (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00467     : m\_stopped(\textcolor{keyword}{true})}
\DoxyCodeLine{00468     , m\_isPlaying(\textcolor{keyword}{false})}
\DoxyCodeLine{00469     , m\_looped(\textcolor{keyword}{false})}
\DoxyCodeLine{00470     , m\_scrubbing(\textcolor{keyword}{false})}
\DoxyCodeLine{00471     , m\_wout(0) \{}
\DoxyCodeLine{00472   m\_whdrQueue = \textcolor{keyword}{new} \mbox{\hyperlink{class_wavehdr_queue}{WavehdrQueue}}(\textcolor{keyword}{this}, 4);}
\DoxyCodeLine{00473 }
\DoxyCodeLine{00474   insertAllRate();}
\DoxyCodeLine{00475   \textcolor{keywordflow}{if} (!verifyRate())}
\DoxyCodeLine{00476     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_sound_device_exception}{TSoundDeviceException}}(TSoundDeviceException::FailedInit,}
\DoxyCodeLine{00477                                 \textcolor{stringliteral}{"{}Unable to verify supported rates"{}});}
\DoxyCodeLine{00478 }
\DoxyCodeLine{00479   m\_closeDevice = CreateEvent(NULL,   \textcolor{comment}{// no security attributes}}
\DoxyCodeLine{00480                               FALSE,  \textcolor{comment}{// auto-\/reset event}}
\DoxyCodeLine{00481                               FALSE,  \textcolor{comment}{// initial state is not signaled}}
\DoxyCodeLine{00482                               NULL);  \textcolor{comment}{// object not named}}
\DoxyCodeLine{00483 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a37bd0cd0ecac1361ed47d4d2ccfc22ab}\label{class_t_sound_output_device_imp_a37bd0cd0ecac1361ed47d4d2ccfc22ab}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!````~TSoundOutputDeviceImp@{$\sim$TSoundOutputDeviceImp}}
\index{````~TSoundOutputDeviceImp@{$\sim$TSoundOutputDeviceImp}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{$\sim$TSoundOutputDeviceImp()}{~TSoundOutputDeviceImp()}}
{\footnotesize\ttfamily TSound\+Output\+Device\+Imp\+::$\sim$\+TSound\+Output\+Device\+Imp (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00487 \{ \textcolor{keyword}{delete} m\_whdrQueue; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_ab5208990617ec3c6d3f78e0588f711e4}\label{class_t_sound_output_device_imp_ab5208990617ec3c6d3f78e0588f711e4}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{TSoundOutputDeviceImp()}{TSoundOutputDeviceImp()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily TSound\+Output\+Device\+Imp\+::\+TSound\+Output\+Device\+Imp (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00040                          :}
\DoxyCodeLine{00041     m\_mutex(QMutex::Recursive),}
\DoxyCodeLine{00042     m\_volume(0.5),}
\DoxyCodeLine{00043     m\_looping(\textcolor{keyword}{false}),}
\DoxyCodeLine{00044     m\_bytesSent(0),}
\DoxyCodeLine{00045     m\_bufferIndex(0),}
\DoxyCodeLine{00046     m\_audioBuffer()}
\DoxyCodeLine{00047   \{ \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_sound_output_device_imp_ad4fe1efd71cc92b860f6a9b741eb3c44}\label{class_t_sound_output_device_imp_ad4fe1efd71cc92b860f6a9b741eb3c44}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!doCloseDevice@{doCloseDevice}}
\index{doCloseDevice@{doCloseDevice}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{doCloseDevice()}{doCloseDevice()}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::do\+Close\+Device (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00536                                           \{}
\DoxyCodeLine{00537   TThread::MutexLocker sl(\&m\_mutex);}
\DoxyCodeLine{00538   \textcolor{keywordflow}{if} (m\_wout) \{}
\DoxyCodeLine{00539     MMRESULT ret = waveOutReset(m\_wout);}
\DoxyCodeLine{00540     \textcolor{keywordflow}{if} (ret != MMSYSERR\_NOERROR) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00541     ret = waveOutClose(m\_wout);}
\DoxyCodeLine{00542     \textcolor{keywordflow}{if} (ret != MMSYSERR\_NOERROR) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00543     m\_wout      = 0;}
\DoxyCodeLine{00544     m\_stopped   = \textcolor{keyword}{true};}
\DoxyCodeLine{00545     m\_isPlaying = \textcolor{keyword}{false};}
\DoxyCodeLine{00546     m\_looped    = \textcolor{keyword}{false};}
\DoxyCodeLine{00547   \}}
\DoxyCodeLine{00548 }
\DoxyCodeLine{00549   PostThreadMessage(m\_notifyThreadId, WM\_QUIT, 0, 0);}
\DoxyCodeLine{00550   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00551 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a56a01713a12a7fb1fb363a17cb55d26d}\label{class_t_sound_output_device_imp_a56a01713a12a7fb1fb363a17cb55d26d}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!doOpenDevice@{doOpenDevice}}
\index{doOpenDevice@{doOpenDevice}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{doOpenDevice()}{doOpenDevice()}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::do\+Open\+Device (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_sound_track_format}{TSound\+Track\+Format}} \&}]{format }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00491                                                                         \{}
\DoxyCodeLine{00492   WAVEFORMATEX wf;}
\DoxyCodeLine{00493   wf.wFormatTag      = WAVE\_FORMAT\_PCM;}
\DoxyCodeLine{00494   wf.nChannels       = format.m\_channelCount;}
\DoxyCodeLine{00495   wf.nSamplesPerSec  = format.m\_sampleRate;}
\DoxyCodeLine{00496   wf.wBitsPerSample  = format.m\_bitPerSample;}
\DoxyCodeLine{00497   wf.nBlockAlign     = (wf.nChannels * wf.wBitsPerSample) >> 3;}
\DoxyCodeLine{00498   wf.nAvgBytesPerSec = wf.nSamplesPerSec * wf.nBlockAlign;}
\DoxyCodeLine{00499   wf.cbSize          = 0;}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501   TThread::MutexLocker sl(\&m\_mutex);}
\DoxyCodeLine{00502   CloseHandle(CreateThread(NULL, 0, MyWaveOutCallbackThread, (LPVOID)\textcolor{keyword}{this}, 0,}
\DoxyCodeLine{00503                            \&m\_notifyThreadId));}
\DoxyCodeLine{00504 }
\DoxyCodeLine{00505   MMRESULT ret;}
\DoxyCodeLine{00506   \textcolor{keywordflow}{if} ((ret = waveOutOpen(\&m\_wout, WAVE\_MAPPER, \&wf, (DWORD)m\_notifyThreadId,}
\DoxyCodeLine{00507                          (DWORD)\textcolor{keyword}{this}, CALLBACK\_THREAD)) != MMSYSERR\_NOERROR) \{}
\DoxyCodeLine{00508     \textcolor{keywordflow}{while} (!PostThreadMessage(m\_notifyThreadId, WM\_QUIT, 0, 0))}
\DoxyCodeLine{00509       ;}
\DoxyCodeLine{00510   \}}
\DoxyCodeLine{00511   \textcolor{keywordflow}{if} (ret != MMSYSERR\_NOERROR) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00512 }
\DoxyCodeLine{00513   \textcolor{keywordflow}{if} (ret != MMSYSERR\_NOERROR) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00514   m\_currentFormat = format;}
\DoxyCodeLine{00515   \textcolor{keywordflow}{return} (ret == MMSYSERR\_NOERROR);}
\DoxyCodeLine{00516 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_ab58a3da6f623a3a1ffa51cd0dd6a6037}\label{class_t_sound_output_device_imp_ab58a3da6f623a3a1ffa51cd0dd6a6037}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!doPlay@{doPlay}}
\index{doPlay@{doPlay}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{doPlay()}{doPlay()}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::do\+Play (\begin{DoxyParamCaption}\item[{WAVEHDR $\ast$}]{whdr,  }\item[{const \mbox{\hyperlink{class_t_sound_track_format}{TSound\+Track\+Format}}}]{format }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00521                                                                    \{}
\DoxyCodeLine{00522   TThread::MutexLocker sl(\&m\_mutex);}
\DoxyCodeLine{00523   \textcolor{keywordflow}{if} (!m\_wout || (m\_wout \&\& m\_currentFormat != format)) doOpenDevice(format);}
\DoxyCodeLine{00524 }
\DoxyCodeLine{00525   MMRESULT ret;}
\DoxyCodeLine{00526   ret = waveOutWrite(m\_wout, whdr, \textcolor{keyword}{sizeof}(WAVEHDR));}
\DoxyCodeLine{00527   \textcolor{keywordflow}{if} (ret != MMSYSERR\_NOERROR) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00528   m\_stopped   = \textcolor{keyword}{false};}
\DoxyCodeLine{00529   m\_isPlaying = \textcolor{keyword}{true};}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00532 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a3ee0c52b637f0b27875fd64079a583fa}\label{class_t_sound_output_device_imp_a3ee0c52b637f0b27875fd64079a583fa}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!getVolume@{getVolume}}
\index{getVolume@{getVolume}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{getVolume()}{getVolume()}}
{\footnotesize\ttfamily double TSound\+Output\+Device\+Imp\+::get\+Volume (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00090                      \{}
\DoxyCodeLine{00091     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00092     \textcolor{keywordflow}{return} m\_volume;}
\DoxyCodeLine{00093   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_ad4c7c260d66b010decceec8d79b79a7a}\label{class_t_sound_output_device_imp_ad4c7c260d66b010decceec8d79b79a7a}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!insertAllRate@{insertAllRate}}
\index{insertAllRate@{insertAllRate}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{insertAllRate()}{insertAllRate()}}
{\footnotesize\ttfamily void TSound\+Output\+Device\+Imp\+::insert\+All\+Rate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00555                                           \{}
\DoxyCodeLine{00556   m\_supportedRate.insert(8000);}
\DoxyCodeLine{00557   m\_supportedRate.insert(11025);}
\DoxyCodeLine{00558   m\_supportedRate.insert(16000);}
\DoxyCodeLine{00559   m\_supportedRate.insert(22050);}
\DoxyCodeLine{00560   m\_supportedRate.insert(32000);}
\DoxyCodeLine{00561   m\_supportedRate.insert(44100);}
\DoxyCodeLine{00562   m\_supportedRate.insert(48000);}
\DoxyCodeLine{00563 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a5ea30fecad9f9939508c7d70b439bc3a}\label{class_t_sound_output_device_imp_a5ea30fecad9f9939508c7d70b439bc3a}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!isLooping@{isLooping}}
\index{isLooping@{isLooping}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{isLooping()}{isLooping()}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::is\+Looping (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00095                    \{}
\DoxyCodeLine{00096     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00097     \textcolor{keywordflow}{return} m\_looping;}
\DoxyCodeLine{00098   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_abe0197ff251f54584b348498a7c8e708}\label{class_t_sound_output_device_imp_abe0197ff251f54584b348498a7c8e708}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!isPlaying@{isPlaying}}
\index{isPlaying@{isPlaying}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{isPlaying()}{isPlaying()}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::is\+Playing (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00105                    \{}
\DoxyCodeLine{00106     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00107     \textcolor{keywordflow}{return} m\_audioOutput}
\DoxyCodeLine{00108         \&\& m\_buffer.size()}
\DoxyCodeLine{00109         \&\& ( isLooping()}
\DoxyCodeLine{00110           || m\_bufferIndex < m\_buffer.size()}
\DoxyCodeLine{00111           \textcolor{comment}{/*|| m\_audioOutput-\/>state() == QAudio::ActiveState*/} );}
\DoxyCodeLine{00112   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a891ddbb1f94c5cadec69a20e5830914e}\label{class_t_sound_output_device_imp_a891ddbb1f94c5cadec69a20e5830914e}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!play@{play}}
\index{play@{play}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{play()}{play()}}
{\footnotesize\ttfamily void TSound\+Output\+Device\+Imp\+::play (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \&}]{st,  }\item[{TINT32}]{s0,  }\item[{TINT32}]{s1,  }\item[{bool}]{loop,  }\item[{bool}]{scrubbing }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00152                                                                                      \{}
\DoxyCodeLine{00153     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00154 }
\DoxyCodeLine{00155     QAudioFormat format;}
\DoxyCodeLine{00156     format.setSampleSize(st-\/>getBitPerSample());}
\DoxyCodeLine{00157     format.setCodec(\textcolor{stringliteral}{"{}audio/pcm"{}});}
\DoxyCodeLine{00158     format.setChannelCount(st-\/>getChannelCount());}
\DoxyCodeLine{00159     format.setByteOrder(QAudioFormat::LittleEndian);}
\DoxyCodeLine{00160     format.setSampleType( st-\/>\mbox{\hyperlink{class_t_sound_track_aa58db0cee313f7174bc023e295b701a9}{getFormat}}().m\_signedSample}
\DoxyCodeLine{00161                         ? QAudioFormat::SignedInt}
\DoxyCodeLine{00162                         : QAudioFormat::UnSignedInt );}
\DoxyCodeLine{00163     format.setSampleRate(st-\/>getSampleRate());}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165     QAudioDeviceInfo info(QAudioDeviceInfo::defaultOutputDevice());}
\DoxyCodeLine{00166     \textcolor{keywordflow}{if} (!info.isFormatSupported((format)))}
\DoxyCodeLine{00167       format = info.nearestFormat(format);}
\DoxyCodeLine{00168 }
\DoxyCodeLine{00169     qint64 totalPacketCount = s1 -\/ s0;}
\DoxyCodeLine{00170     qint64 fileByteCount    = (s1 -\/ s0)*st-\/>getSampleSize();}
\DoxyCodeLine{00171     m\_buffer.resize(fileByteCount);}
\DoxyCodeLine{00172     memcpy(m\_buffer.data(), st-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}() + s0*st-\/>getSampleSize(), fileByteCount);}
\DoxyCodeLine{00173     m\_bufferIndex = 0;}
\DoxyCodeLine{00174 }
\DoxyCodeLine{00175     m\_looping = loop;}
\DoxyCodeLine{00176     \textcolor{keywordflow}{if} (!m\_audioOutput || m\_audioOutput-\/>format() != format) \{}
\DoxyCodeLine{00177       \textcolor{keywordflow}{if} (m\_audioOutput) m\_audioOutput-\/>stop();}
\DoxyCodeLine{00178       m\_audioOutput = \textcolor{keyword}{new} QAudioOutput(format);}
\DoxyCodeLine{00179       m\_audioOutput-\/>setVolume(m\_volume);}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181       \textcolor{comment}{// audio buffer size}}
\DoxyCodeLine{00182       qint64 audioBufferSize = format.bytesForDuration(100000);}
\DoxyCodeLine{00183       m\_audioOutput-\/>setBufferSize(audioBufferSize);}
\DoxyCodeLine{00184       m\_audioOutput-\/>setNotifyInterval(50);}
\DoxyCodeLine{00185       QObject::connect(m\_audioOutput.data(), \&QAudioOutput::notify, [=]()\{ sendBuffer(); \});}
\DoxyCodeLine{00186 }
\DoxyCodeLine{00187       reset();}
\DoxyCodeLine{00188     \}\textcolor{comment}{/* audio buffer too small, so optimization not uses}}
\DoxyCodeLine{00189 \textcolor{comment}{    else \{}}
\DoxyCodeLine{00190 \textcolor{comment}{      // if less than 0.1 sec of data in audio buffer,}}
\DoxyCodeLine{00191 \textcolor{comment}{      // then just sent next portion of data}}
\DoxyCodeLine{00192 \textcolor{comment}{      // else reset audio buffer before}}
\DoxyCodeLine{00193 \textcolor{comment}{      qint64 sentUSecs = format.durationForBytes(m\_bytesSent);}}
\DoxyCodeLine{00194 \textcolor{comment}{      qint64 processedUSecs = m\_audioOutput-\/>processedUSecs();}}
\DoxyCodeLine{00195 \textcolor{comment}{      if (sentUSecs -\/ processedUSecs > 100000ll)}}
\DoxyCodeLine{00196 \textcolor{comment}{        reset();}}
\DoxyCodeLine{00197 \textcolor{comment}{    \}}}
\DoxyCodeLine{00198 \textcolor{comment}{    */}}
\DoxyCodeLine{00199 }
\DoxyCodeLine{00200     sendBuffer();}
\DoxyCodeLine{00201   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_ade03674a9115d59efa34083efea8b0bc}\label{class_t_sound_output_device_imp_ade03674a9115d59efa34083efea8b0bc}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!prepareVolume@{prepareVolume}}
\index{prepareVolume@{prepareVolume}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{prepareVolume()}{prepareVolume()}}
{\footnotesize\ttfamily void TSound\+Output\+Device\+Imp\+::prepare\+Volume (\begin{DoxyParamCaption}\item[{double}]{x }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00100                                \{}
\DoxyCodeLine{00101     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00102     m\_volume = x;}
\DoxyCodeLine{00103   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a0e04241232c7f81165bf74df1cee2d4f}\label{class_t_sound_output_device_imp_a0e04241232c7f81165bf74df1cee2d4f}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!setLooping@{setLooping}}
\index{setLooping@{setLooping}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{setLooping()}{setLooping()}}
{\footnotesize\ttfamily void TSound\+Output\+Device\+Imp\+::set\+Looping (\begin{DoxyParamCaption}\item[{bool}]{x }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00120                           \{}
\DoxyCodeLine{00121     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00122     \textcolor{keywordflow}{if} (m\_looping != x) \{}
\DoxyCodeLine{00123       m\_looping = x;}
\DoxyCodeLine{00124       \textcolor{keywordflow}{if} (m\_audioOutput) \{}
\DoxyCodeLine{00125         \textcolor{comment}{/* audio buffer too small, so optimization not uses}}
\DoxyCodeLine{00126 \textcolor{comment}{        qint64 bufferSize = m\_buffer.size();}}
\DoxyCodeLine{00127 \textcolor{comment}{        if (!m\_looping \&\& bufferSize > 0) \{}}
\DoxyCodeLine{00128 \textcolor{comment}{          qint64 processedBytes =}}
\DoxyCodeLine{00129 \textcolor{comment}{            m\_audioOutput-\/>format().bytesForDuration(}}
\DoxyCodeLine{00130 \textcolor{comment}{              m\_audioOutput-\/>processedUSecs() );}}
\DoxyCodeLine{00131 \textcolor{comment}{          qint64 extraBytesSend = m\_bytesSent -\/ processedBytes;}}
\DoxyCodeLine{00132 \textcolor{comment}{          if (extraBytesSend > m\_bufferIndex) \{}}
\DoxyCodeLine{00133 \textcolor{comment}{            // remove extra loops from audio buffer}}
\DoxyCodeLine{00134 \textcolor{comment}{            m\_bufferIndex -\/= extraBytesSend \% bufferSize;}}
\DoxyCodeLine{00135 \textcolor{comment}{            if (m\_bufferIndex < 0) m\_bufferIndex += bufferSize;}}
\DoxyCodeLine{00136 \textcolor{comment}{            reset();}}
\DoxyCodeLine{00137 \textcolor{comment}{          \}}}
\DoxyCodeLine{00138 \textcolor{comment}{        \}}}
\DoxyCodeLine{00139 \textcolor{comment}{        */}}
\DoxyCodeLine{00140         sendBuffer();}
\DoxyCodeLine{00141       \}}
\DoxyCodeLine{00142     \}}
\DoxyCodeLine{00143   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a3a3c98a66b9d963d18cadd1975ba00e2}\label{class_t_sound_output_device_imp_a3a3c98a66b9d963d18cadd1975ba00e2}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!setVolume@{setVolume}}
\index{setVolume@{setVolume}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{setVolume()}{setVolume()}}
{\footnotesize\ttfamily void TSound\+Output\+Device\+Imp\+::set\+Volume (\begin{DoxyParamCaption}\item[{double}]{x }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00114                            \{}
\DoxyCodeLine{00115     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00116     m\_volume = x;}
\DoxyCodeLine{00117     \textcolor{keywordflow}{if} (m\_audioOutput) m\_audioOutput-\/>setVolume(m\_volume);}
\DoxyCodeLine{00118   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a93cf4f5131a972a7510885a0790e202e}\label{class_t_sound_output_device_imp_a93cf4f5131a972a7510885a0790e202e}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!stop@{stop}}
\index{stop@{stop}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily void TSound\+Output\+Device\+Imp\+::stop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00145               \{}
\DoxyCodeLine{00146     QMutexLocker lock(\&m\_mutex);}
\DoxyCodeLine{00147     \textcolor{comment}{//reset(); audio buffer too small, so optimization not uses}}
\DoxyCodeLine{00148     m\_buffer.clear();}
\DoxyCodeLine{00149     m\_bufferIndex = 0;}
\DoxyCodeLine{00150   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_output_device_imp_a751763a6d12ad0e1b9b18603097516d6}\label{class_t_sound_output_device_imp_a751763a6d12ad0e1b9b18603097516d6}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!verifyRate@{verifyRate}}
\index{verifyRate@{verifyRate}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{verifyRate()}{verifyRate()}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::verify\+Rate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00567                                        \{}
\DoxyCodeLine{00568   std::set<int>::iterator it;}
\DoxyCodeLine{00569 }
\DoxyCodeLine{00570   \textcolor{keywordflow}{for} (it = m\_supportedRate.begin(); it != m\_supportedRate.end();) \{}
\DoxyCodeLine{00571     MMRESULT ret;}
\DoxyCodeLine{00572     WAVEFORMATEX wf;}
\DoxyCodeLine{00573 }
\DoxyCodeLine{00574     wf.wFormatTag      = WAVE\_FORMAT\_PCM;}
\DoxyCodeLine{00575     wf.nChannels       = 1;}
\DoxyCodeLine{00576     wf.nSamplesPerSec  = *it;}
\DoxyCodeLine{00577     wf.wBitsPerSample  = 8;}
\DoxyCodeLine{00578     wf.nBlockAlign     = (wf.nChannels * wf.wBitsPerSample) >> 3;}
\DoxyCodeLine{00579     wf.nAvgBytesPerSec = wf.nSamplesPerSec * wf.nBlockAlign;}
\DoxyCodeLine{00580     wf.cbSize          = 0;}
\DoxyCodeLine{00581 }
\DoxyCodeLine{00582     ret = waveOutOpen(NULL, WAVE\_MAPPER, \&wf, NULL, NULL, WAVE\_FORMAT\_QUERY);}
\DoxyCodeLine{00583 }
\DoxyCodeLine{00584     \textcolor{keywordflow}{if} (ret == MMSYSERR\_NOERROR) \{}
\DoxyCodeLine{00585       ++it;}
\DoxyCodeLine{00586       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00587     \}}
\DoxyCodeLine{00588     \textcolor{keywordflow}{if} (ret == WAVERR\_BADFORMAT)}
\DoxyCodeLine{00589       it = m\_supportedRate.erase(it);}
\DoxyCodeLine{00590     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00591       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00592   \}}
\DoxyCodeLine{00593   \textcolor{keywordflow}{if} (m\_supportedRate.end() == m\_supportedRate.begin()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00594 }
\DoxyCodeLine{00595   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00596 \}}

\end{DoxyCode}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{class_t_sound_output_device_imp_ac0ff0af1229de568358e1a0d946bab41}\label{class_t_sound_output_device_imp_ac0ff0af1229de568358e1a0d946bab41}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_closeDevice@{m\_closeDevice}}
\index{m\_closeDevice@{m\_closeDevice}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_closeDevice}{m\_closeDevice}}
{\footnotesize\ttfamily HANDLE TSound\+Output\+Device\+Imp\+::m\+\_\+close\+Device}

\mbox{\Hypertarget{class_t_sound_output_device_imp_ae65cb176fe77b1f1f9238e3e6f2e190f}\label{class_t_sound_output_device_imp_ae65cb176fe77b1f1f9238e3e6f2e190f}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_currentFormat@{m\_currentFormat}}
\index{m\_currentFormat@{m\_currentFormat}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_currentFormat}{m\_currentFormat}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_sound_track_format}{TSound\+Track\+Format}} TSound\+Output\+Device\+Imp\+::m\+\_\+current\+Format}

\mbox{\Hypertarget{class_t_sound_output_device_imp_affb6695bd76a73f7f758cf8d669f9b72}\label{class_t_sound_output_device_imp_affb6695bd76a73f7f758cf8d669f9b72}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_isPlaying@{m\_isPlaying}}
\index{m\_isPlaying@{m\_isPlaying}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_isPlaying}{m\_isPlaying}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::m\+\_\+is\+Playing}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a53ed3236be1dc617cd57ae40e0e45d77}\label{class_t_sound_output_device_imp_a53ed3236be1dc617cd57ae40e0e45d77}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_listeners@{m\_listeners}}
\index{m\_listeners@{m\_listeners}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_listeners}{m\_listeners}}
{\footnotesize\ttfamily std\+::set$<$ \mbox{\hyperlink{class_t_sound_output_device_listener}{TSound\+Output\+Device\+Listener}} $\ast$ $>$ TSound\+Output\+Device\+Imp\+::m\+\_\+listeners}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a978dc04fb87f52ada2694f014848f5c6}\label{class_t_sound_output_device_imp_a978dc04fb87f52ada2694f014848f5c6}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_looped@{m\_looped}}
\index{m\_looped@{m\_looped}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_looped}{m\_looped}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::m\+\_\+looped}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a1c79ce54e278c3d7842f702ea5348244}\label{class_t_sound_output_device_imp_a1c79ce54e278c3d7842f702ea5348244}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_mutex@{m\_mutex}}
\index{m\_mutex@{m\_mutex}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_mutex}{m\_mutex}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_thread_1_1_mutex}{TThread\+::\+Mutex}} TSound\+Output\+Device\+Imp\+::m\+\_\+mutex}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a2dd720dbe485a537464984ae871bd0de}\label{class_t_sound_output_device_imp_a2dd720dbe485a537464984ae871bd0de}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_notifyThreadId@{m\_notifyThreadId}}
\index{m\_notifyThreadId@{m\_notifyThreadId}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_notifyThreadId}{m\_notifyThreadId}}
{\footnotesize\ttfamily DWORD TSound\+Output\+Device\+Imp\+::m\+\_\+notify\+Thread\+Id}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a8963088a52fab41ce3b9c28a8a429338}\label{class_t_sound_output_device_imp_a8963088a52fab41ce3b9c28a8a429338}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_scrubbing@{m\_scrubbing}}
\index{m\_scrubbing@{m\_scrubbing}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_scrubbing}{m\_scrubbing}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::m\+\_\+scrubbing}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a916e2f593ecb0f273e7e12d178251927}\label{class_t_sound_output_device_imp_a916e2f593ecb0f273e7e12d178251927}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_stopped@{m\_stopped}}
\index{m\_stopped@{m\_stopped}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_stopped}{m\_stopped}}
{\footnotesize\ttfamily bool TSound\+Output\+Device\+Imp\+::m\+\_\+stopped}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a081f4b37394ee951133d84baaf0c2efc}\label{class_t_sound_output_device_imp_a081f4b37394ee951133d84baaf0c2efc}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_supportedRate@{m\_supportedRate}}
\index{m\_supportedRate@{m\_supportedRate}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_supportedRate}{m\_supportedRate}}
{\footnotesize\ttfamily std\+::set$<$int$>$ TSound\+Output\+Device\+Imp\+::m\+\_\+supported\+Rate}

\mbox{\Hypertarget{class_t_sound_output_device_imp_a6d9f3c85e03717de0c091fc1310d8e94}\label{class_t_sound_output_device_imp_a6d9f3c85e03717de0c091fc1310d8e94}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_whdrQueue@{m\_whdrQueue}}
\index{m\_whdrQueue@{m\_whdrQueue}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_whdrQueue}{m\_whdrQueue}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_wavehdr_queue}{Wavehdr\+Queue}}$\ast$ TSound\+Output\+Device\+Imp\+::m\+\_\+whdr\+Queue}

\mbox{\Hypertarget{class_t_sound_output_device_imp_aa70cd91f92721e4c6f266b30052a3973}\label{class_t_sound_output_device_imp_aa70cd91f92721e4c6f266b30052a3973}} 
\index{TSoundOutputDeviceImp@{TSoundOutputDeviceImp}!m\_wout@{m\_wout}}
\index{m\_wout@{m\_wout}!TSoundOutputDeviceImp@{TSoundOutputDeviceImp}}
\doxysubsubsection{\texorpdfstring{m\_wout}{m\_wout}}
{\footnotesize\ttfamily HWAVEOUT TSound\+Output\+Device\+Imp\+::m\+\_\+wout}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/common/tsound/tsound\+\_\+nt.\+cpp\item 
E\+:/opentoonz/toonz/sources/common/tsound/tsound\+\_\+qt.\+cpp\end{DoxyCompactItemize}
