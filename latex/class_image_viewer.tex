\hypertarget{class_image_viewer}{}\doxysection{Image\+Viewer Class Reference}
\label{class_image_viewer}\index{ImageViewer@{ImageViewer}}


The \mbox{\hyperlink{class_image_viewer}{Image\+Viewer}} class provides to view an image.  


Inheritance diagram for Image\+Viewer\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_image_viewer}
\end{center}
\end{figure}
\doxysubsection*{Public Slots}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_image_viewer_ae72f79ae8b4bae6b1bdfc94022414be3}{update\+Image\+Viewer}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a1dc088198a0839240e14a624dc77043b}{reset\+View}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a8acb0c934a9dc97be7f456e2ea4e8e74}{fit\+View}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a4f26f765f12d2feff9f3d11452be54b4}{show\+Histogram}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a1a1aa26cb294de9d191411352d3d6c14}{swap\+Compared}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a0bbac27221577b3644eb2a0be761640f}{on\+Context\+About\+To\+Be\+Destroyed}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_ac455bcbc5ebc2c8dd7c32ceca85d1b62}{on\+Preference\+Changed}} (const QString \&pref\+Name)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_image_viewer_a1dd752c3edc1aa2f9f8663d0f2583216}{Image\+Viewer}} (QWidget $\ast$parent, \mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$flipbook, bool show\+Histogram)
\item 
void \mbox{\hyperlink{class_image_viewer_a25d0c3880d457fbfb8aef8dbdac5f3e5}{set\+Is\+Color\+Model}} (bool is\+Color\+Model)
\item 
bool \mbox{\hyperlink{class_image_viewer_afc21f7d424db53f0b81a03e2c7fed524}{is\+Color\+Model}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_abd5a4c3961e00f3fac5193d971ad0650}{set\+Visual}} (const \mbox{\hyperlink{class_image_painter_1_1_visual_settings}{Image\+Painter\+::\+Visual\+Settings}} \&settings)
\item 
void \mbox{\hyperlink{class_image_viewer_af514a3d90ce0f99a9217874bb3ef95dc}{set\+Image}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} image)
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \mbox{\hyperlink{class_image_viewer_af80b9641df537a1bf3b0c98f2c431420}{get\+Image}} ()
\item 
\mbox{\hyperlink{class_t_affine}{TAffine}} \mbox{\hyperlink{class_image_viewer_ad3ae5a695b9e5ec53364d657d6f51e07}{get\+View\+Aff}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a4ec516026bd15dc6c7c0154ea9070c00}{set\+View\+Aff}} (\mbox{\hyperlink{class_t_affine}{TAffine}} view\+Aff)
\item 
\mbox{\hyperlink{class_t_affine}{TAffine}} \mbox{\hyperlink{class_image_viewer_a5f412d451a497d7c346c04c89d3c8865}{get\+Img\+To\+Widget\+Affine}} (const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&img\+Bounds) const
\begin{DoxyCompactList}\small\item\em Returns the affine transform from image reference to widget\textquotesingle{}s pixel one. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_t_affine}{TAffine}} \mbox{\hyperlink{class_image_viewer_a60f9f5a22c83e6f2f15b4e7a224047d3}{get\+Img\+To\+Widget\+Affine}} () const
\item 
void \mbox{\hyperlink{class_image_viewer_ad85948c9cf34353112cb7d4b2e117a81}{set\+Histogram\+Title}} (QString level\+Name)
\item 
void \mbox{\hyperlink{class_image_viewer_a08439b4de1e9dbe8107c7d6d0ca05ba2}{set\+Histogram\+Enable}} (bool enable)
\item 
void \mbox{\hyperlink{class_image_viewer_a5510dd98281795f946aa0f9a0ec9a060}{hide\+Histogram}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_ae32677b4e8710e66a535bfabd9bfd84d}{zoom\+Qt}} (bool forward, bool reset)
\item 
void \mbox{\hyperlink{class_image_viewer_a2b9b55471bdccb502526c7e5573c4775}{reset\+Zoom}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_ab3f2e0f11a0e98019187c0aab85f0e6e}{set\+Is\+Remaking\+Preview\+Fx}} (bool on)
\item 
bool \mbox{\hyperlink{class_image_viewer_adddffa737d898a47a37e6566b5f9bbf0}{is\+Remaking\+Preview\+Fx}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_aaad0ef7fa1fb0ed91e36026e5e520e6d}{adapt\+View}} (const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&img\+Rect, const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&view\+Rect)
\item 
void \mbox{\hyperlink{class_image_viewer_a459f7ae77903ec1f288cc46853c0bb36}{adapt\+View}} (const QRect \&viewer\+Rect)
\item 
void \mbox{\hyperlink{class_image_viewer_a406dda31710bdc8b6fad7c95312cffff}{do\+Swap\+Buffers}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a35353ea99a3bfe729648c6f06928f4f4}{change\+Swap\+Behavior}} (bool enable)
\item 
void \mbox{\hyperlink{class_image_viewer_ac52c145b068ed3527496a0045a911188}{invalidate\+Comp\+Histo}} ()
\item 
void \mbox{\hyperlink{class_image_viewer_a05c8912b53633fd251c30da998d2082f}{set\+Timer\+And\+Target\+Instant}} (QElapsed\+Timer $\ast$timer, qint64 target)
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{class_image_viewer_ac75bc3d9cc31cfed77ee667b9b76543c}{context\+Menu\+Event}} (QContext\+Menu\+Event $\ast$event) override
\item 
void \mbox{\hyperlink{class_image_viewer_acf92fe62a79015b6b9948e1f724dbb6a}{initialize\+GL}} () override
\item 
void \mbox{\hyperlink{class_image_viewer_ae1ce6245e214b9cc4f065699b312e3fb}{resize\+GL}} (int width, int height) override
\item 
void \mbox{\hyperlink{class_image_viewer_a2edbf42c08020efed6eaf23f0dbf56cf}{paint\+GL}} () override
\item 
void \mbox{\hyperlink{class_image_viewer_ab465328eb07b6ceef99d9ec471d4fbc2}{show\+Event}} (QShow\+Event $\ast$) override
\item 
void \mbox{\hyperlink{class_image_viewer_a50d7077526fd7d10817a460fc98a1458}{hide\+Event}} (QHide\+Event $\ast$) override
\item 
void \mbox{\hyperlink{class_image_viewer_a2b7cdb5e8e09f7090f47933a6008b9d2}{mouse\+Move\+Event}} (QMouse\+Event $\ast$event) override
\item 
void \mbox{\hyperlink{class_image_viewer_ae7372584cca321456fd2b29794e69c00}{mouse\+Press\+Event}} (QMouse\+Event $\ast$event) override
\item 
void \mbox{\hyperlink{class_image_viewer_a62cdfb855b556cec0fff8ec46a4f27f5}{mouse\+Release\+Event}} (QMouse\+Event $\ast$event) override
\item 
void \mbox{\hyperlink{class_image_viewer_aa0e59973f96d412a056f3dea158c76c8}{key\+Press\+Event}} (QKey\+Event $\ast$event) override
\item 
void \mbox{\hyperlink{class_image_viewer_a5c9350c1cfbac2cd51a2c8cb2b61b5eb}{mouse\+Double\+Click\+Event}} (QMouse\+Event $\ast$event) override
\item 
void \mbox{\hyperlink{class_image_viewer_afa10c8e25017a6e4efc3b017f40e5a6e}{wheel\+Event}} (QWheel\+Event $\ast$) override
\item 
void \mbox{\hyperlink{class_image_viewer_a574ebcd95b038e59de03f0bb6e6a9dd2}{pan\+Qt}} (const QPoint \&delta)
\item 
void \mbox{\hyperlink{class_image_viewer_a4b00ca265e005c2de288ac04858e46cd}{zoom\+Qt}} (const QPoint \&center, double factor)
\item 
void \mbox{\hyperlink{class_image_viewer_a6d19df8eb374f916b259213729b34dbd}{drag\+Compare}} (const QPoint \&dp)
\item 
void \mbox{\hyperlink{class_image_viewer_afa60f2e0498eca8a566b89a3ff199294}{tablet\+Event}} (QTablet\+Event $\ast$e) override
\item 
void \mbox{\hyperlink{class_image_viewer_a05adf92e840fa8abb104d668c0ed68c5}{touch\+Event}} (QTouch\+Event $\ast$e, int type)
\item 
void \mbox{\hyperlink{class_image_viewer_aba700519a34c72294def6f5137b198c8}{gesture\+Event}} (QGesture\+Event $\ast$e)
\item 
bool \mbox{\hyperlink{class_image_viewer_a2aabe840fa48d58f2f480f9d0ab493f4}{event}} (QEvent $\ast$e) override
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The \mbox{\hyperlink{class_image_viewer}{Image\+Viewer}} class provides to view an image. 

Inherits {\bfseries{QOpen\+GLWidget}}.

The object allows also to manage pan and zoom event. It\textquotesingle{}s possible to set a color mask TRop\+::\+Color\+Mask to image view. 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_image_viewer_a1dd752c3edc1aa2f9f8663d0f2583216}\label{class_image_viewer_a1dd752c3edc1aa2f9f8663d0f2583216}} 
\index{ImageViewer@{ImageViewer}!ImageViewer@{ImageViewer}}
\index{ImageViewer@{ImageViewer}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{ImageViewer()}{ImageViewer()}}
{\footnotesize\ttfamily Image\+Viewer\+::\+Image\+Viewer (\begin{DoxyParamCaption}\item[{QWidget $\ast$}]{parent,  }\item[{\mbox{\hyperlink{class_flip_book}{Flip\+Book}} $\ast$}]{flipbook,  }\item[{bool}]{show\+Histogram }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00212     : \mbox{\hyperlink{class_g_l_widget_for_high_dpi}{GLWidgetForHighDpi}}(parent)}
\DoxyCodeLine{00213     , m\_pressedMousePos(0, 0)}
\DoxyCodeLine{00214     , m\_mouseButton(Qt::NoButton)}
\DoxyCodeLine{00215     , m\_draggingZoomSelection(\textcolor{keyword}{false})}
\DoxyCodeLine{00216     , m\_image()}
\DoxyCodeLine{00217     , m\_FPS(0)}
\DoxyCodeLine{00218     , m\_viewAff()}
\DoxyCodeLine{00219     , m\_pos(0, 0)}
\DoxyCodeLine{00220     , m\_visualSettings()}
\DoxyCodeLine{00221     , m\_compareSettings()}
\DoxyCodeLine{00222     , m\_isHistogramEnable(showHistogram)}
\DoxyCodeLine{00223     , m\_flipbook(flipbook)}
\DoxyCodeLine{00224     , m\_isColorModel(\textcolor{keyword}{false})}
\DoxyCodeLine{00225     , m\_histogramPopup(0)}
\DoxyCodeLine{00226     , m\_isRemakingPreviewFx(\textcolor{keyword}{false})}
\DoxyCodeLine{00227     , m\_rectRGBPick(\textcolor{keyword}{false})}
\DoxyCodeLine{00228     , m\_firstImage(\textcolor{keyword}{true})}
\DoxyCodeLine{00229     , m\_timer(\textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{00230   m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_ab6461a28653bae19432d998149564b43}{m\_sceneProperties}} =}
\DoxyCodeLine{00231       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene()-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}();}
\DoxyCodeLine{00232   m\_visualSettings.m\_drawExternalBG = \textcolor{keyword}{true};}
\DoxyCodeLine{00233   setAttribute(Qt::WA\_KeyCompression);}
\DoxyCodeLine{00234   setFocusPolicy(Qt::StrongFocus);}
\DoxyCodeLine{00235 }
\DoxyCodeLine{00236   setMouseTracking(\textcolor{keyword}{true});}
\DoxyCodeLine{00237 }
\DoxyCodeLine{00238   setAttribute(Qt::WA\_AcceptTouchEvents);}
\DoxyCodeLine{00239   grabGesture(Qt::SwipeGesture);}
\DoxyCodeLine{00240   grabGesture(Qt::PanGesture);}
\DoxyCodeLine{00241   grabGesture(Qt::PinchGesture);}
\DoxyCodeLine{00242 }
\DoxyCodeLine{00243   \textcolor{keywordflow}{if} (m\_isHistogramEnable)}
\DoxyCodeLine{00244     m\_histogramPopup = \textcolor{keyword}{new} \mbox{\hyperlink{class_histogram_popup}{HistogramPopup}}(tr(\textcolor{stringliteral}{"{}Flipbook Histogram"{}}));}
\DoxyCodeLine{00245 }
\DoxyCodeLine{00246   \textcolor{keywordflow}{if} (Preferences::instance()-\/>isColorCalibrationEnabled())}
\DoxyCodeLine{00247     m\_lutCalibrator = \textcolor{keyword}{new} \mbox{\hyperlink{class_lut_calibrator}{LutCalibrator}}();}
\DoxyCodeLine{00248 }
\DoxyCodeLine{00249   \textcolor{keywordflow}{if} (Preferences::instance()-\/>is30bitDisplayEnabled())}
\DoxyCodeLine{00250     setTextureFormat(TGL\_TexFmt10);}
\DoxyCodeLine{00251 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_afe2b04078dd9112aad6b104f1ac60359}\label{class_image_viewer_afe2b04078dd9112aad6b104f1ac60359}} 
\index{ImageViewer@{ImageViewer}!````~ImageViewer@{$\sim$ImageViewer}}
\index{````~ImageViewer@{$\sim$ImageViewer}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{$\sim$ImageViewer()}{~ImageViewer()}}
{\footnotesize\ttfamily Image\+Viewer\+::$\sim$\+Image\+Viewer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00389                           \{}
\DoxyCodeLine{00390   \textcolor{comment}{// iwsw commented out temporarily}}
\DoxyCodeLine{00391   \textcolor{comment}{/*}}
\DoxyCodeLine{00392 \textcolor{comment}{  if (m\_ghibli3DLutUtil)}}
\DoxyCodeLine{00393 \textcolor{comment}{  \{}}
\DoxyCodeLine{00394 \textcolor{comment}{          m\_ghibli3DLutUtil-\/>onEnd();}}
\DoxyCodeLine{00395 \textcolor{comment}{          delete m\_ghibli3DLutUtil;}}
\DoxyCodeLine{00396 \textcolor{comment}{  \}}}
\DoxyCodeLine{00397 \textcolor{comment}{  */}}
\DoxyCodeLine{00398   \textcolor{keywordflow}{if} (m\_fbo) \textcolor{keyword}{delete} m\_fbo;}
\DoxyCodeLine{00399 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_image_viewer_a459f7ae77903ec1f288cc46853c0bb36}\label{class_image_viewer_a459f7ae77903ec1f288cc46853c0bb36}} 
\index{ImageViewer@{ImageViewer}!adaptView@{adaptView}}
\index{adaptView@{adaptView}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{adaptView()}{adaptView()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Image\+Viewer\+::adapt\+View (\begin{DoxyParamCaption}\item[{const QRect \&}]{geom\+Rect }\end{DoxyParamCaption})}

Adapts image viewer\textquotesingle{}s affine to display the passed viewer rect at maximized ratio 
\begin{DoxyCode}{0}
\DoxyCodeLine{01384                                                  \{}
\DoxyCodeLine{01385   \textcolor{keywordflow}{if} (!m\_image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01386 }
\DoxyCodeLine{01387   \textcolor{comment}{// Retrieve the rect in image reference and call the associated adaptView}}
\DoxyCodeLine{01388   \mbox{\hyperlink{class_t_rect_t}{TRect}} imgBounds(getImageBounds(m\_image));}
\DoxyCodeLine{01389   \mbox{\hyperlink{class_t_rect_t}{TRectD}} imgBoundsD(imgBounds.x0, imgBounds.y0, imgBounds.x1 + 1,}
\DoxyCodeLine{01390                     imgBounds.y1 + 1);}
\DoxyCodeLine{01391 }
\DoxyCodeLine{01392   \mbox{\hyperlink{class_t_rect_t}{TRectD}} geomRectD(geomRect.left(), geomRect.top(), geomRect.right() + 1,}
\DoxyCodeLine{01393                    geomRect.bottom() + 1);}
\DoxyCodeLine{01394   \mbox{\hyperlink{class_t_rect_t}{TRectD}} viewRectD(\mbox{\hyperlink{class_image_viewer_a5f412d451a497d7c346c04c89d3c8865}{getImgToWidgetAffine}}().inv() * geomRectD);}
\DoxyCodeLine{01395   \mbox{\hyperlink{class_t_rect_t}{TRect}} viewRect(tfloor(viewRectD.x0), tfloor(viewRectD.y0),}
\DoxyCodeLine{01396                  tceil(viewRectD.x1) -\/ 1, tceil(viewRectD.y1) -\/ 1);}
\DoxyCodeLine{01397 }
\DoxyCodeLine{01398   \mbox{\hyperlink{class_image_viewer_aaad0ef7fa1fb0ed91e36026e5e520e6d}{adaptView}}(imgBounds, viewRect);}
\DoxyCodeLine{01399 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01362}{adapt\+View()}}, \mbox{\hyperlink{l01345}{get\+Img\+To\+Widget\+Affine()}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_image_viewer_aaad0ef7fa1fb0ed91e36026e5e520e6d}\label{class_image_viewer_aaad0ef7fa1fb0ed91e36026e5e520e6d}} 
\index{ImageViewer@{ImageViewer}!adaptView@{adaptView}}
\index{adaptView@{adaptView}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{adaptView()}{adaptView()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Image\+Viewer\+::adapt\+View (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{img\+Rect,  }\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{view\+Rect }\end{DoxyParamCaption})}

Adapts image viewer\textquotesingle{}s affine to display the passed image rect at maximized ratio 
\begin{DoxyCode}{0}
\DoxyCodeLine{01362                                                                        \{}
\DoxyCodeLine{01363   QRect viewerRect(rect());}
\DoxyCodeLine{01364 }
\DoxyCodeLine{01365   \textcolor{keywordflow}{if} (viewerRect.isEmpty()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01366 }
\DoxyCodeLine{01367   \textcolor{keywordtype}{double} imageScale = std::min(viewerRect.width() / (\textcolor{keywordtype}{double})viewRect.getLx(),}
\DoxyCodeLine{01368                                viewerRect.height() / (\textcolor{keywordtype}{double})viewRect.getLy());}
\DoxyCodeLine{01369 }
\DoxyCodeLine{01370   \mbox{\hyperlink{class_t_point_t}{TPointD}} viewRectCenter((viewRect.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} + viewRect.x1 + 1) * 0.5,}
\DoxyCodeLine{01371                          (viewRect.y0 + viewRect.y1 + 1) * 0.5);}
\DoxyCodeLine{01372   \mbox{\hyperlink{class_t_point_t}{TPointD}} imgRectCenter((imgRect.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} + imgRect.x1 + 1) * 0.5,}
\DoxyCodeLine{01373                         (imgRect.y0 + imgRect.y1 + 1) * 0.5);}
\DoxyCodeLine{01374 }
\DoxyCodeLine{01375   \mbox{\hyperlink{class_t_affine}{TAffine}} newViewAff(\mbox{\hyperlink{class_t_scale}{TScale}}(imageScale, imageScale) *}
\DoxyCodeLine{01376                      \mbox{\hyperlink{class_t_translation}{TTranslation}}(imgRectCenter -\/ viewRectCenter));}
\DoxyCodeLine{01377   setViewAff(newViewAff);}
\DoxyCodeLine{01378 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.



Referenced by \mbox{\hyperlink{l01384}{adapt\+View()}}, and \mbox{\hyperlink{l01206}{mouse\+Release\+Event()}}.

\mbox{\Hypertarget{class_image_viewer_a35353ea99a3bfe729648c6f06928f4f4}\label{class_image_viewer_a35353ea99a3bfe729648c6f06928f4f4}} 
\index{ImageViewer@{ImageViewer}!changeSwapBehavior@{changeSwapBehavior}}
\index{changeSwapBehavior@{changeSwapBehavior}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{changeSwapBehavior()}{changeSwapBehavior()}}
{\footnotesize\ttfamily void Image\+Viewer\+::change\+Swap\+Behavior (\begin{DoxyParamCaption}\item[{bool}]{enable }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01403                                                 \{}
\DoxyCodeLine{01404   \textcolor{comment}{// do nothing for now as setUpdateBehavior is not available with QGLWidget}}
\DoxyCodeLine{01405   \textcolor{comment}{// setUpdateBehavior(enable ? PartialUpdate : NoPartialUpdate);}}
\DoxyCodeLine{01406 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ac75bc3d9cc31cfed77ee667b9b76543c}\label{class_image_viewer_ac75bc3d9cc31cfed77ee667b9b76543c}} 
\index{ImageViewer@{ImageViewer}!contextMenuEvent@{contextMenuEvent}}
\index{contextMenuEvent@{contextMenuEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{contextMenuEvent()}{contextMenuEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::context\+Menu\+Event (\begin{DoxyParamCaption}\item[{QContext\+Menu\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00255                                                            \{}
\DoxyCodeLine{00256   QAction *action;}
\DoxyCodeLine{00257 }
\DoxyCodeLine{00258   \textcolor{keywordflow}{if} (m\_isColorModel) \{}
\DoxyCodeLine{00259     \textcolor{keyword}{event}-\/>ignore();}
\DoxyCodeLine{00260     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00261   \}}
\DoxyCodeLine{00262 }
\DoxyCodeLine{00263   QMenu *menu = \textcolor{keyword}{new} QMenu(\textcolor{keyword}{this});}
\DoxyCodeLine{00264 }
\DoxyCodeLine{00265   \textcolor{keywordflow}{if} (m\_flipbook) \{}
\DoxyCodeLine{00266     \textcolor{keywordflow}{if} (m\_flipbook-\/>getPreviewedFx()) \{}
\DoxyCodeLine{00267       \textcolor{keywordflow}{if} (!(windowState() \& Qt::WindowFullScreen)) \{}
\DoxyCodeLine{00268         action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Clone Preview"{}}));}
\DoxyCodeLine{00269         action-\/>setShortcut(QKeySequence(}
\DoxyCodeLine{00270             CommandManager::instance()-\/>getKeyFromId(MI\_ClonePreview)));}
\DoxyCodeLine{00271         connect(action, SIGNAL(triggered()), m\_flipbook, SLOT(clonePreview()));}
\DoxyCodeLine{00272       \}}
\DoxyCodeLine{00273 }
\DoxyCodeLine{00274       \textcolor{keywordflow}{if} (m\_flipbook-\/>isFreezed()) \{}
\DoxyCodeLine{00275         action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Unfreeze Preview"{}}));}
\DoxyCodeLine{00276         action-\/>setShortcut(QKeySequence(}
\DoxyCodeLine{00277             CommandManager::instance()-\/>getKeyFromId(MI\_FreezePreview)));}
\DoxyCodeLine{00278         connect(action, SIGNAL(triggered()), m\_flipbook,}
\DoxyCodeLine{00279                 SLOT(unfreezePreview()));}
\DoxyCodeLine{00280       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00281         action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Freeze Preview"{}}));}
\DoxyCodeLine{00282         action-\/>setShortcut(QKeySequence(}
\DoxyCodeLine{00283             CommandManager::instance()-\/>getKeyFromId(MI\_FreezePreview)));}
\DoxyCodeLine{00284         connect(action, SIGNAL(triggered()), m\_flipbook, SLOT(freezePreview()));}
\DoxyCodeLine{00285       \}}
\DoxyCodeLine{00286 }
\DoxyCodeLine{00287       action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Regenerate Preview"{}}));}
\DoxyCodeLine{00288       action-\/>setShortcut(QKeySequence(}
\DoxyCodeLine{00289           CommandManager::instance()-\/>getKeyFromId(MI\_RegeneratePreview)));}
\DoxyCodeLine{00290       connect(action, SIGNAL(triggered()), m\_flipbook, SLOT(regenerate()));}
\DoxyCodeLine{00291 }
\DoxyCodeLine{00292       action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Regenerate Frame Preview"{}}));}
\DoxyCodeLine{00293       action-\/>setShortcut(QKeySequence(}
\DoxyCodeLine{00294           CommandManager::instance()-\/>getKeyFromId(MI\_RegenerateFramePr)));}
\DoxyCodeLine{00295       connect(action, SIGNAL(triggered()), m\_flipbook, SLOT(regenerateFrame()));}
\DoxyCodeLine{00296 }
\DoxyCodeLine{00297       menu-\/>addSeparator();}
\DoxyCodeLine{00298     \}}
\DoxyCodeLine{00299 }
\DoxyCodeLine{00300     action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Load / Append Images"{}}));}
\DoxyCodeLine{00301     connect(action, SIGNAL(triggered()), m\_flipbook, SLOT(loadImages()));}
\DoxyCodeLine{00302 }
\DoxyCodeLine{00303     \textcolor{comment}{// history of the loaded paths of flipbook}}
\DoxyCodeLine{00304     action = CommandManager::instance()-\/>getAction(MI\_LoadRecentImage);}
\DoxyCodeLine{00305     menu-\/>addAction(action);}
\DoxyCodeLine{00306     action-\/>setParent(m\_flipbook);}
\DoxyCodeLine{00307 }
\DoxyCodeLine{00308     menu-\/>addSeparator();}
\DoxyCodeLine{00309   \}}
\DoxyCodeLine{00310 }
\DoxyCodeLine{00311   QAction *reset = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Reset View"{}}));}
\DoxyCodeLine{00312   reset-\/>setShortcut(}
\DoxyCodeLine{00313       QKeySequence(CommandManager::instance()-\/>getKeyFromId(V\_ViewReset)));}
\DoxyCodeLine{00314   connect(reset, SIGNAL(triggered()), SLOT(resetView()));}
\DoxyCodeLine{00315 }
\DoxyCodeLine{00316   QAction *fit = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Fit To Window"{}}));}
\DoxyCodeLine{00317   fit-\/>setShortcut(}
\DoxyCodeLine{00318       QKeySequence(CommandManager::instance()-\/>getKeyFromId(V\_ZoomFit)));}
\DoxyCodeLine{00319   connect(fit, SIGNAL(triggered()), SLOT(fitView()));}
\DoxyCodeLine{00320 }
\DoxyCodeLine{00321   \textcolor{keywordflow}{if} (m\_flipbook) \{}
\DoxyCodeLine{00322 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00323     \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_image_utils_1_1_full_screen_widget}{ImageUtils::FullScreenWidget}} *fsWidget =}
\DoxyCodeLine{00324             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{class_image_utils_1_1_full_screen_widget}{ImageUtils::FullScreenWidget}} *\textcolor{keyword}{>}(parentWidget())) \{}
\DoxyCodeLine{00325       \textcolor{keywordtype}{bool} isFullScreen = (fsWidget-\/>windowState() \& Qt::WindowFullScreen) != 0;}
\DoxyCodeLine{00326 }
\DoxyCodeLine{00327       action = menu-\/>addAction(isFullScreen ? tr(\textcolor{stringliteral}{"{}Exit Full Screen Mode"{}})}
\DoxyCodeLine{00328                                             : tr(\textcolor{stringliteral}{"{}Full Screen Mode"{}}));}
\DoxyCodeLine{00329 }
\DoxyCodeLine{00330       action-\/>setShortcut(QKeySequence(}
\DoxyCodeLine{00331           CommandManager::instance()-\/>getKeyFromId(V\_ShowHideFullScreen)));}
\DoxyCodeLine{00332       connect(action, SIGNAL(triggered()), fsWidget, SLOT(toggleFullScreen()));}
\DoxyCodeLine{00333     \}}
\DoxyCodeLine{00334 }
\DoxyCodeLine{00335 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00336 }
\DoxyCodeLine{00337     \textcolor{keywordtype}{bool} addedSep = \textcolor{keyword}{false};}
\DoxyCodeLine{00338 }
\DoxyCodeLine{00339     \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\&}
\DoxyCodeLine{00340         visibleRegion().contains(event-\/>pos() * getDevPixRatio())) \{}
\DoxyCodeLine{00341       menu-\/>addSeparator();}
\DoxyCodeLine{00342       addedSep = \textcolor{keyword}{true};}
\DoxyCodeLine{00343       action   = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Show Histogram"{}}));}
\DoxyCodeLine{00344       connect(action, SIGNAL(triggered()), SLOT(showHistogram()));}
\DoxyCodeLine{00345     \}}
\DoxyCodeLine{00346 }
\DoxyCodeLine{00347     \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_af46b586bd61bf70e606713bee68c3aad}{m\_doCompare}}) \{}
\DoxyCodeLine{00348       \textcolor{keywordflow}{if} (!addedSep) \{}
\DoxyCodeLine{00349         menu-\/>addSeparator();}
\DoxyCodeLine{00350         addedSep = \textcolor{keyword}{true};}
\DoxyCodeLine{00351       \}}
\DoxyCodeLine{00352       action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Swap Compared Images"{}}));}
\DoxyCodeLine{00353       connect(action, SIGNAL(triggered()), SLOT(swapCompared()));}
\DoxyCodeLine{00354     \}}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00356     \textcolor{keywordflow}{if} (m\_flipbook-\/>isSavable()) \{}
\DoxyCodeLine{00357       \textcolor{keywordflow}{if} (!addedSep) menu-\/>addSeparator();}
\DoxyCodeLine{00358       action = menu-\/>addAction(tr(\textcolor{stringliteral}{"{}Save Images"{}}));}
\DoxyCodeLine{00359       connect(action, SIGNAL(triggered()), m\_flipbook, SLOT(saveImages()));}
\DoxyCodeLine{00360     \}}
\DoxyCodeLine{00361   \}}
\DoxyCodeLine{00362 }
\DoxyCodeLine{00363   menu-\/>exec(event-\/>globalPos());}
\DoxyCodeLine{00364 }
\DoxyCodeLine{00365   \textcolor{keywordflow}{if} (m\_flipbook) \{}
\DoxyCodeLine{00366     action = CommandManager::instance()-\/>getAction(MI\_LoadRecentImage);}
\DoxyCodeLine{00367     action-\/>setParent(0);}
\DoxyCodeLine{00368   \}}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370   \textcolor{keyword}{delete} menu;}
\DoxyCodeLine{00371   update();}
\DoxyCodeLine{00372 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a406dda31710bdc8b6fad7c95312cffff}\label{class_image_viewer_a406dda31710bdc8b6fad7c95312cffff}} 
\index{ImageViewer@{ImageViewer}!doSwapBuffers@{doSwapBuffers}}
\index{doSwapBuffers@{doSwapBuffers}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{doSwapBuffers()}{doSwapBuffers()}}
{\footnotesize\ttfamily void Image\+Viewer\+::do\+Swap\+Buffers (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01401 \{ glFlush(); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a6d19df8eb374f916b259213729b34dbd}\label{class_image_viewer_a6d19df8eb374f916b259213729b34dbd}} 
\index{ImageViewer@{ImageViewer}!dragCompare@{dragCompare}}
\index{dragCompare@{dragCompare}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{dragCompare()}{dragCompare()}}
{\footnotesize\ttfamily void Image\+Viewer\+::drag\+Compare (\begin{DoxyParamCaption}\item[{const QPoint \&}]{dp }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00737                                               \{}
\DoxyCodeLine{00738   \textcolor{keywordflow}{if} (m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}})}
\DoxyCodeLine{00739     m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_ac544bac665ef86ee2ef3cfc214e89430}{m\_compareX}} += ((double)dp.x()) / width();}
\DoxyCodeLine{00740   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}})}
\DoxyCodeLine{00741     m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_aef7ad2a36c8fe81f397f225df3fc1095}{m\_compareY}} -\/= ((double)dp.y()) / height();}
\DoxyCodeLine{00742 }
\DoxyCodeLine{00743   m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_ac544bac665ef86ee2ef3cfc214e89430}{m\_compareX}} = tcrop(m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_ac544bac665ef86ee2ef3cfc214e89430}{m\_compareX}}, 0.0, 1.0);}
\DoxyCodeLine{00744   m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_aef7ad2a36c8fe81f397f225df3fc1095}{m\_compareY}} = tcrop(m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_aef7ad2a36c8fe81f397f225df3fc1095}{m\_compareY}}, 0.0, 1.0);}
\DoxyCodeLine{00745 }
\DoxyCodeLine{00746   update();}
\DoxyCodeLine{00747 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a2aabe840fa48d58f2f480f9d0ab493f4}\label{class_image_viewer_a2aabe840fa48d58f2f480f9d0ab493f4}} 
\index{ImageViewer@{ImageViewer}!event@{event}}
\index{event@{event}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{event()}{event()}}
{\footnotesize\ttfamily bool Image\+Viewer\+::event (\begin{DoxyParamCaption}\item[{QEvent $\ast$}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01582                                  \{}
\DoxyCodeLine{01583   \textcolor{comment}{/*}}
\DoxyCodeLine{01584 \textcolor{comment}{  switch (e-\/>type()) \{}}
\DoxyCodeLine{01585 \textcolor{comment}{  case QEvent::TabletPress: \{}}
\DoxyCodeLine{01586 \textcolor{comment}{  QTabletEvent *te = static\_cast<QTabletEvent *>(e);}}
\DoxyCodeLine{01587 \textcolor{comment}{  qDebug() << "{}[event] TabletPress: pointerType("{} << te-\/>pointerType()}}
\DoxyCodeLine{01588 \textcolor{comment}{  << "{}) device("{} << te-\/>device() << "{})"{};}}
\DoxyCodeLine{01589 \textcolor{comment}{  \} break;}}
\DoxyCodeLine{01590 \textcolor{comment}{  case QEvent::TabletRelease:}}
\DoxyCodeLine{01591 \textcolor{comment}{  qDebug() << "{}[event] TabletRelease"{};}}
\DoxyCodeLine{01592 \textcolor{comment}{  break;}}
\DoxyCodeLine{01593 \textcolor{comment}{  case QEvent::TouchBegin:}}
\DoxyCodeLine{01594 \textcolor{comment}{  qDebug() << "{}[event] TouchBegin"{};}}
\DoxyCodeLine{01595 \textcolor{comment}{  break;}}
\DoxyCodeLine{01596 \textcolor{comment}{  case QEvent::TouchEnd:}}
\DoxyCodeLine{01597 \textcolor{comment}{  qDebug() << "{}[event] TouchEnd"{};}}
\DoxyCodeLine{01598 \textcolor{comment}{  break;}}
\DoxyCodeLine{01599 \textcolor{comment}{  case QEvent::TouchCancel:}}
\DoxyCodeLine{01600 \textcolor{comment}{  qDebug() << "{}[event] TouchCancel"{};}}
\DoxyCodeLine{01601 \textcolor{comment}{  break;}}
\DoxyCodeLine{01602 \textcolor{comment}{  case QEvent::MouseButtonPress:}}
\DoxyCodeLine{01603 \textcolor{comment}{  qDebug() << "{}[event] MouseButtonPress"{};}}
\DoxyCodeLine{01604 \textcolor{comment}{  break;}}
\DoxyCodeLine{01605 \textcolor{comment}{  case QEvent::MouseButtonDblClick:}}
\DoxyCodeLine{01606 \textcolor{comment}{  qDebug() << "{}[event] MouseButtonDblClick"{};}}
\DoxyCodeLine{01607 \textcolor{comment}{  break;}}
\DoxyCodeLine{01608 \textcolor{comment}{  case QEvent::MouseButtonRelease:}}
\DoxyCodeLine{01609 \textcolor{comment}{  qDebug() << "{}[event] MouseButtonRelease"{};}}
\DoxyCodeLine{01610 \textcolor{comment}{  break;}}
\DoxyCodeLine{01611 \textcolor{comment}{  case QEvent::Gesture:}}
\DoxyCodeLine{01612 \textcolor{comment}{  qDebug() << "{}[event] Gesture"{};}}
\DoxyCodeLine{01613 \textcolor{comment}{  break;}}
\DoxyCodeLine{01614 \textcolor{comment}{  default:}}
\DoxyCodeLine{01615 \textcolor{comment}{  break;}}
\DoxyCodeLine{01616 \textcolor{comment}{  \}}}
\DoxyCodeLine{01617 \textcolor{comment}{  */}}
\DoxyCodeLine{01618 }
\DoxyCodeLine{01619   \textcolor{keywordflow}{if} (e-\/>type() == QEvent::Gesture \&\& CommandManager::instance()}
\DoxyCodeLine{01620                                           -\/>getAction(MI\_TouchGestureControl)}
\DoxyCodeLine{01621                                           -\/>isChecked()) \{}
\DoxyCodeLine{01622     gestureEvent(\textcolor{keyword}{static\_cast<}QGestureEvent *\textcolor{keyword}{>}(e));}
\DoxyCodeLine{01623     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01624   \}}
\DoxyCodeLine{01625   \textcolor{keywordflow}{if} ((e-\/>type() == QEvent::TouchBegin || e-\/>type() == QEvent::TouchEnd ||}
\DoxyCodeLine{01626        e-\/>type() == QEvent::TouchCancel || e-\/>type() == QEvent::TouchUpdate) \&\&}
\DoxyCodeLine{01627       CommandManager::instance()}
\DoxyCodeLine{01628           -\/>getAction(MI\_TouchGestureControl)}
\DoxyCodeLine{01629           -\/>isChecked()) \{}
\DoxyCodeLine{01630     touchEvent(\textcolor{keyword}{static\_cast<}QTouchEvent *\textcolor{keyword}{>}(e), e-\/>type());}
\DoxyCodeLine{01631     m\_gestureActive = \textcolor{keyword}{true};}
\DoxyCodeLine{01632     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01633   \}}
\DoxyCodeLine{01634   \textcolor{keywordflow}{return} GLWidgetForHighDpi::event(e);}
\DoxyCodeLine{01635 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a8acb0c934a9dc97be7f456e2ea4e8e74}\label{class_image_viewer_a8acb0c934a9dc97be7f456e2ea4e8e74}} 
\index{ImageViewer@{ImageViewer}!fitView@{fitView}}
\index{fitView@{fitView}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{fitView}{fitView}}
{\footnotesize\ttfamily void Image\+Viewer\+::fit\+View (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01319                           \{}
\DoxyCodeLine{01320   \textcolor{keywordflow}{if} (!m\_image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01321   \mbox{\hyperlink{class_t_rect_t}{TRect}} imgBounds(getImageBounds(m\_image));}
\DoxyCodeLine{01322   \mbox{\hyperlink{class_image_viewer_aaad0ef7fa1fb0ed91e36026e5e520e6d}{adaptView}}(imgBounds, imgBounds);}
\DoxyCodeLine{01323 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_aba700519a34c72294def6f5137b198c8}\label{class_image_viewer_aba700519a34c72294def6f5137b198c8}} 
\index{ImageViewer@{ImageViewer}!gestureEvent@{gestureEvent}}
\index{gestureEvent@{gestureEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{gestureEvent()}{gestureEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::gesture\+Event (\begin{DoxyParamCaption}\item[{QGesture\+Event $\ast$}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01479                                                \{}
\DoxyCodeLine{01480   \textcolor{comment}{// qDebug() << "{}[gestureEvent]"{};}}
\DoxyCodeLine{01481   m\_gestureActive = \textcolor{keyword}{false};}
\DoxyCodeLine{01482   \textcolor{keywordflow}{if} (QGesture *swipe = e-\/>gesture(Qt::SwipeGesture)) \{}
\DoxyCodeLine{01483     m\_gestureActive = \textcolor{keyword}{true};}
\DoxyCodeLine{01484   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (QGesture *pan = e-\/>gesture(Qt::PanGesture)) \{}
\DoxyCodeLine{01485     m\_gestureActive = \textcolor{keyword}{true};}
\DoxyCodeLine{01486   \}}
\DoxyCodeLine{01487   \textcolor{keywordflow}{if} (QGesture *pinch = e-\/>gesture(Qt::PinchGesture)) \{}
\DoxyCodeLine{01488     QPinchGesture *gesture = \textcolor{keyword}{static\_cast<}QPinchGesture *\textcolor{keyword}{>}(pinch);}
\DoxyCodeLine{01489     QPinchGesture::ChangeFlags changeFlags = gesture-\/>changeFlags();}
\DoxyCodeLine{01490     QPoint firstCenter                     = gesture-\/>centerPoint().toPoint();}
\DoxyCodeLine{01491     \textcolor{keywordflow}{if} (m\_touchDevice == QTouchDevice::TouchScreen)}
\DoxyCodeLine{01492       firstCenter = mapFromGlobal(firstCenter);}
\DoxyCodeLine{01493 }
\DoxyCodeLine{01494     \textcolor{keywordflow}{if} (gesture-\/>state() == Qt::GestureStarted) \{}
\DoxyCodeLine{01495       m\_gestureActive = \textcolor{keyword}{true};}
\DoxyCodeLine{01496     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (gesture-\/>state() == Qt::GestureFinished) \{}
\DoxyCodeLine{01497       m\_gestureActive = \textcolor{keyword}{false};}
\DoxyCodeLine{01498       m\_zooming       = \textcolor{keyword}{false};}
\DoxyCodeLine{01499       m\_scaleFactor   = 0.0;}
\DoxyCodeLine{01500     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01501       \textcolor{keywordflow}{if} (changeFlags \& QPinchGesture::ScaleFactorChanged) \{}
\DoxyCodeLine{01502         \textcolor{keywordtype}{double} scaleFactor = gesture-\/>scaleFactor();}
\DoxyCodeLine{01503         \textcolor{comment}{// the scale factor makes for too sensitive scaling}}
\DoxyCodeLine{01504         \textcolor{comment}{// divide the change in half}}
\DoxyCodeLine{01505         \textcolor{keywordflow}{if} (scaleFactor > 1) \{}
\DoxyCodeLine{01506           \textcolor{keywordtype}{double} decimalValue = scaleFactor -\/ 1;}
\DoxyCodeLine{01507           decimalValue /= 1.5;}
\DoxyCodeLine{01508           scaleFactor = 1 + decimalValue;}
\DoxyCodeLine{01509         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (scaleFactor < 1) \{}
\DoxyCodeLine{01510           \textcolor{keywordtype}{double} decimalValue = 1 -\/ scaleFactor;}
\DoxyCodeLine{01511           decimalValue /= 1.5;}
\DoxyCodeLine{01512           scaleFactor = 1 -\/ decimalValue;}
\DoxyCodeLine{01513         \}}
\DoxyCodeLine{01514         \textcolor{keywordflow}{if} (!m\_zooming) \{}
\DoxyCodeLine{01515           \textcolor{keywordtype}{double} delta = scaleFactor -\/ 1;}
\DoxyCodeLine{01516           m\_scaleFactor += delta;}
\DoxyCodeLine{01517           \textcolor{keywordflow}{if} (m\_scaleFactor > .2 || m\_scaleFactor < -\/.2) \{}
\DoxyCodeLine{01518             m\_zooming = \textcolor{keyword}{true};}
\DoxyCodeLine{01519           \}}
\DoxyCodeLine{01520         \}}
\DoxyCodeLine{01521         \textcolor{keywordflow}{if} (m\_zooming) \{}
\DoxyCodeLine{01522           \textcolor{keyword}{const} QPoint center(}
\DoxyCodeLine{01523               firstCenter.x() * getDevPixRatio() -\/ width() / 2,}
\DoxyCodeLine{01524               -\/firstCenter.y() * getDevPixRatio() + height() / 2);}
\DoxyCodeLine{01525           zoomQt(center, scaleFactor);}
\DoxyCodeLine{01526           m\_panning = \textcolor{keyword}{false};}
\DoxyCodeLine{01527         \}}
\DoxyCodeLine{01528         m\_gestureActive = \textcolor{keyword}{true};}
\DoxyCodeLine{01529       \}}
\DoxyCodeLine{01530 }
\DoxyCodeLine{01531       \textcolor{keywordflow}{if} (changeFlags \& QPinchGesture::CenterPointChanged) \{}
\DoxyCodeLine{01532         QPointF centerDelta = (gesture-\/>centerPoint() * getDevPixRatio()) -\/}
\DoxyCodeLine{01533                               (gesture-\/>lastCenterPoint() * getDevPixRatio());}
\DoxyCodeLine{01534         \textcolor{keywordflow}{if} (centerDelta.manhattanLength() > 1) \{}
\DoxyCodeLine{01535           \textcolor{comment}{// panQt(centerDelta.toPoint());}}
\DoxyCodeLine{01536         \}}
\DoxyCodeLine{01537         m\_gestureActive = \textcolor{keyword}{true};}
\DoxyCodeLine{01538       \}}
\DoxyCodeLine{01539     \}}
\DoxyCodeLine{01540   \}}
\DoxyCodeLine{01541   e-\/>accept();}
\DoxyCodeLine{01542 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_af80b9641df537a1bf3b0c98f2c431420}\label{class_image_viewer_af80b9641df537a1bf3b0c98f2c431420}} 
\index{ImageViewer@{ImageViewer}!getImage@{getImage}}
\index{getImage@{getImage}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{getImage()}{getImage()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} Image\+Viewer\+::get\+Image (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Return current image viewer. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00108 \{ \textcolor{keywordflow}{return} m\_image; \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00287}{Color\+Model\+Viewer\+::pick()}}.

\mbox{\Hypertarget{class_image_viewer_a60f9f5a22c83e6f2f15b4e7a224047d3}\label{class_image_viewer_a60f9f5a22c83e6f2f15b4e7a224047d3}} 
\index{ImageViewer@{ImageViewer}!getImgToWidgetAffine@{getImgToWidgetAffine}}
\index{getImgToWidgetAffine@{getImgToWidgetAffine}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{getImgToWidgetAffine()}{getImgToWidgetAffine()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_affine}{TAffine}} Image\+Viewer\+::get\+Img\+To\+Widget\+Affine (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{01337                                                 \{}
\DoxyCodeLine{01338   assert(m\_image);}
\DoxyCodeLine{01339   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_image_viewer_a5f412d451a497d7c346c04c89d3c8865}{getImgToWidgetAffine}}(getImageBoundsD(m\_image));}
\DoxyCodeLine{01340 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a5f412d451a497d7c346c04c89d3c8865}\label{class_image_viewer_a5f412d451a497d7c346c04c89d3c8865}} 
\index{ImageViewer@{ImageViewer}!getImgToWidgetAffine@{getImgToWidgetAffine}}
\index{getImgToWidgetAffine@{getImgToWidgetAffine}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{getImgToWidgetAffine()}{getImgToWidgetAffine()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_affine}{TAffine}} Image\+Viewer\+::get\+Img\+To\+Widget\+Affine (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{img\+Bounds }\end{DoxyParamCaption}) const}



Returns the affine transform from image reference to widget\textquotesingle{}s pixel one. 


\begin{DoxyCode}{0}
\DoxyCodeLine{01345                                                                   \{}
\DoxyCodeLine{01346   \mbox{\hyperlink{class_t_point_t}{TPointD}} geomCenter((geom.x0 + geom.x1) * 0.5, (geom.y0 + geom.y1) * 0.5);}
\DoxyCodeLine{01347 }
\DoxyCodeLine{01348   QRect widGeom(rect());}
\DoxyCodeLine{01349 }
\DoxyCodeLine{01350   \mbox{\hyperlink{class_t_point_t}{TPointD}} viewerCenter((widGeom.left() + widGeom.right() + 1) * 0.5,}
\DoxyCodeLine{01351                        (widGeom.top() + widGeom.bottom() + 1) * 0.5);}
\DoxyCodeLine{01352 }
\DoxyCodeLine{01353   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_affine}{TAffine}}(\mbox{\hyperlink{class_t_affine}{TAffine}}(1.0, 0.0, 0.0, 0.0, -\/1.0, height()) *}
\DoxyCodeLine{01354                  \mbox{\hyperlink{class_t_translation}{TTranslation}}(viewerCenter) * m\_viewAff *}
\DoxyCodeLine{01355                  \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/geomCenter));}
\DoxyCodeLine{01356 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01345}{get\+Img\+To\+Widget\+Affine()}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.



Referenced by \mbox{\hyperlink{l01968}{Flip\+Book\+::adapt\+Geometry\+For\+Full\+Preview()}}, \mbox{\hyperlink{l01384}{adapt\+View()}}, and \mbox{\hyperlink{l01345}{get\+Img\+To\+Widget\+Affine()}}.

\mbox{\Hypertarget{class_image_viewer_ad3ae5a695b9e5ec53364d657d6f51e07}\label{class_image_viewer_ad3ae5a695b9e5ec53364d657d6f51e07}} 
\index{ImageViewer@{ImageViewer}!getViewAff@{getViewAff}}
\index{getViewAff@{getViewAff}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{getViewAff()}{getViewAff()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_affine}{TAffine}} Image\+Viewer\+::get\+View\+Aff (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Return current viewer matrix transformation. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00110 \{ \textcolor{keywordflow}{return} m\_viewAff; \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l01996}{Flip\+Book\+::adapt\+Wid\+Geometry()}}, and \mbox{\hyperlink{l00287}{Color\+Model\+Viewer\+::pick()}}.

\mbox{\Hypertarget{class_image_viewer_a50d7077526fd7d10817a460fc98a1458}\label{class_image_viewer_a50d7077526fd7d10817a460fc98a1458}} 
\index{ImageViewer@{ImageViewer}!hideEvent@{hideEvent}}
\index{hideEvent@{hideEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{hideEvent()}{hideEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::hide\+Event (\begin{DoxyParamCaption}\item[{QHide\+Event $\ast$}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00817                                         \{}
\DoxyCodeLine{00818   \mbox{\hyperlink{class_t_scene_handle}{TSceneHandle}} *sceneHandle = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}();}
\DoxyCodeLine{00819   \textcolor{keywordflow}{if} (sceneHandle) sceneHandle-\/>disconnect(\textcolor{keyword}{this});}
\DoxyCodeLine{00820 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a5510dd98281795f946aa0f9a0ec9a060}\label{class_image_viewer_a5510dd98281795f946aa0f9a0ec9a060}} 
\index{ImageViewer@{ImageViewer}!hideHistogram@{hideHistogram}}
\index{hideHistogram@{hideHistogram}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{hideHistogram()}{hideHistogram()}}
{\footnotesize\ttfamily void Image\+Viewer\+::hide\+Histogram (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

If histogram popup exist and is open, it is set to default and is hidden. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00444                                 \{}
\DoxyCodeLine{00445   \textcolor{keywordflow}{if} (!m\_isHistogramEnable) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00446   m\_histogramPopup-\/>setImage(\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}());}
\DoxyCodeLine{00447   \textcolor{keywordflow}{if} (m\_histogramPopup-\/>isVisible()) \{}
\DoxyCodeLine{00448     m\_histogramPopup-\/>hide();}
\DoxyCodeLine{00449     m\_histogramPopup-\/>setTitle(tr(\textcolor{stringliteral}{"{}Flipbook Histogram"{}}));}
\DoxyCodeLine{00450   \}}
\DoxyCodeLine{00451 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_acf92fe62a79015b6b9948e1f724dbb6a}\label{class_image_viewer_acf92fe62a79015b6b9948e1f724dbb6a}} 
\index{ImageViewer@{ImageViewer}!initializeGL@{initializeGL}}
\index{initializeGL@{initializeGL}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{initializeGL()}{initializeGL()}}
{\footnotesize\ttfamily void Image\+Viewer\+::initialize\+GL (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00455                                \{}
\DoxyCodeLine{00456   initializeOpenGLFunctions();}
\DoxyCodeLine{00457 }
\DoxyCodeLine{00458   \textcolor{comment}{// to be computed once through the software}}
\DoxyCodeLine{00459   \textcolor{keywordflow}{if} (m\_lutCalibrator \&\& !m\_lutCalibrator-\/>isInitialized()) \{}
\DoxyCodeLine{00460     m\_lutCalibrator-\/>initialize();}
\DoxyCodeLine{00461     connect(context(), SIGNAL(aboutToBeDestroyed()), \textcolor{keyword}{this},}
\DoxyCodeLine{00462             SLOT(onContextAboutToBeDestroyed()));}
\DoxyCodeLine{00463   \}}
\DoxyCodeLine{00464 }
\DoxyCodeLine{00465   \textcolor{comment}{// glClearColor(1.0,1.0,1.0,1);}}
\DoxyCodeLine{00466   glClear(GL\_COLOR\_BUFFER\_BIT);}
\DoxyCodeLine{00467 }
\DoxyCodeLine{00468   \textcolor{keywordflow}{if} (m\_firstInitialized)}
\DoxyCodeLine{00469     m\_firstInitialized = \textcolor{keyword}{false};}
\DoxyCodeLine{00470   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00471     resizeGL(width(), height());}
\DoxyCodeLine{00472     update();}
\DoxyCodeLine{00473   \}}
\DoxyCodeLine{00474 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ac52c145b068ed3527496a0045a911188}\label{class_image_viewer_ac52c145b068ed3527496a0045a911188}} 
\index{ImageViewer@{ImageViewer}!invalidateCompHisto@{invalidateCompHisto}}
\index{invalidateCompHisto@{invalidateCompHisto}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{invalidateCompHisto()}{invalidateCompHisto()}}
{\footnotesize\ttfamily void Image\+Viewer\+::invalidate\+Comp\+Histo (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01410                                       \{}
\DoxyCodeLine{01411   \textcolor{keywordflow}{if} (!m\_isHistogramEnable || !m\_histogramPopup) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01412   m\_histogramPopup-\/>invalidateCompHisto();}
\DoxyCodeLine{01413 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_afc21f7d424db53f0b81a03e2c7fed524}\label{class_image_viewer_afc21f7d424db53f0b81a03e2c7fed524}} 
\index{ImageViewer@{ImageViewer}!isColorModel@{isColorModel}}
\index{isColorModel@{isColorModel}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{isColorModel()}{isColorModel()}}
{\footnotesize\ttfamily bool Image\+Viewer\+::is\+Color\+Model (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00103 \{ \textcolor{keywordflow}{return} m\_isColorModel; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_adddffa737d898a47a37e6566b5f9bbf0}\label{class_image_viewer_adddffa737d898a47a37e6566b5f9bbf0}} 
\index{ImageViewer@{ImageViewer}!isRemakingPreviewFx@{isRemakingPreviewFx}}
\index{isRemakingPreviewFx@{isRemakingPreviewFx}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{isRemakingPreviewFx()}{isRemakingPreviewFx()}}
{\footnotesize\ttfamily bool Image\+Viewer\+::is\+Remaking\+Preview\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00131 \{ \textcolor{keywordflow}{return} m\_isRemakingPreviewFx; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_aa0e59973f96d412a056f3dea158c76c8}\label{class_image_viewer_aa0e59973f96d412a056f3dea158c76c8}} 
\index{ImageViewer@{ImageViewer}!keyPressEvent@{keyPressEvent}}
\index{keyPressEvent@{keyPressEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{keyPressEvent()}{keyPressEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::key\+Press\+Event (\begin{DoxyParamCaption}\item[{QKey\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01417                                                 \{}
\DoxyCodeLine{01418   \textcolor{keywordflow}{if} (FlipZoomer(\textcolor{keyword}{this}).exec(event)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01419 }
\DoxyCodeLine{01420   ImageViewerShortcutReceiver(m\_flipbook).exec(event);}
\DoxyCodeLine{01421 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a5c9350c1cfbac2cd51a2c8cb2b61b5eb}\label{class_image_viewer_a5c9350c1cfbac2cd51a2c8cb2b61b5eb}} 
\index{ImageViewer@{ImageViewer}!mouseDoubleClickEvent@{mouseDoubleClickEvent}}
\index{mouseDoubleClickEvent@{mouseDoubleClickEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{mouseDoubleClickEvent()}{mouseDoubleClickEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::mouse\+Double\+Click\+Event (\begin{DoxyParamCaption}\item[{QMouse\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01130                                                           \{}
\DoxyCodeLine{01131   \textcolor{keywordflow}{if} (!m\_image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01132   \textcolor{comment}{// qDebug() << "{}[mouseDoubleClickEvent]"{};}}
\DoxyCodeLine{01133   \textcolor{keywordflow}{if} (m\_gestureActive \&\& !m\_stylusUsed) \{}
\DoxyCodeLine{01134     m\_gestureActive = \textcolor{keyword}{false};}
\DoxyCodeLine{01135     fitView();}
\DoxyCodeLine{01136     \textcolor{keywordflow}{return};}
\DoxyCodeLine{01137   \}}
\DoxyCodeLine{01138 }
\DoxyCodeLine{01139   \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a9f828dd6214db63baf8c86d2b7c039ef}{m\_defineLoadbox}} \&\& m\_flipbook) \{}
\DoxyCodeLine{01140     m\_flipbook-\/>setLoadbox(\mbox{\hyperlink{class_t_rect_t}{TRect}}());}
\DoxyCodeLine{01141     update();}
\DoxyCodeLine{01142     \textcolor{keyword}{event}-\/>ignore();}
\DoxyCodeLine{01143   \}}
\DoxyCodeLine{01144 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a2b7cdb5e8e09f7090f47933a6008b9d2}\label{class_image_viewer_a2b7cdb5e8e09f7090f47933a6008b9d2}} 
\index{ImageViewer@{ImageViewer}!mouseMoveEvent@{mouseMoveEvent}}
\index{mouseMoveEvent@{mouseMoveEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{mouseMoveEvent()}{mouseMoveEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::mouse\+Move\+Event (\begin{DoxyParamCaption}\item[{QMouse\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}

If middle button is pressed pan the image. Update current mouse position. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00825                                                    \{}
\DoxyCodeLine{00826   \textcolor{keywordflow}{if} (!m\_image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00827 }
\DoxyCodeLine{00828   \textcolor{keywordflow}{if} (m\_gestureActive \&\& m\_touchDevice == QTouchDevice::TouchScreen \&\&}
\DoxyCodeLine{00829       !m\_stylusUsed) \{}
\DoxyCodeLine{00830     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00831   \}}
\DoxyCodeLine{00832 }
\DoxyCodeLine{00833   QPoint curQPos = \textcolor{keyword}{event}-\/>pos() * getDevPixRatio();}
\DoxyCodeLine{00834 }
\DoxyCodeLine{00835   \mbox{\hyperlink{class_t_point_t}{TPoint}} curPos = \mbox{\hyperlink{class_t_point_t}{TPoint}}(curQPos.x(), curQPos.y());}
\DoxyCodeLine{00836 }
\DoxyCodeLine{00837   \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a9f828dd6214db63baf8c86d2b7c039ef}{m\_defineLoadbox}} \&\& m\_flipbook) \{}
\DoxyCodeLine{00838     \textcolor{keywordflow}{if} (m\_mouseButton == Qt::LeftButton)}
\DoxyCodeLine{00839       updateLoadbox(curPos);}
\DoxyCodeLine{00840     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_mouseButton == Qt::MidButton)}
\DoxyCodeLine{00841       \mbox{\hyperlink{class_image_viewer_a574ebcd95b038e59de03f0bb6e6a9dd2}{panQt}}(curQPos -\/ m\_pos);}
\DoxyCodeLine{00842     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00843       updateCursor(curPos);}
\DoxyCodeLine{00844     update();}
\DoxyCodeLine{00845     \textcolor{keyword}{event}-\/>ignore();}
\DoxyCodeLine{00846     m\_pos = curQPos;}
\DoxyCodeLine{00847     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00848   \}}
\DoxyCodeLine{00849 }
\DoxyCodeLine{00850   \textcolor{comment}{// setting the cursors}}
\DoxyCodeLine{00851   \textcolor{keywordflow}{if} (!m\_isColorModel) \{}
\DoxyCodeLine{00852     \textcolor{comment}{// when the histogram window is opened, switch to the RGB picker tool}}
\DoxyCodeLine{00853     \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\& m\_histogramPopup-\/>isVisible())}
\DoxyCodeLine{00854       setToolCursor(\textcolor{keyword}{this}, ToolCursor::PickerRGB);}
\DoxyCodeLine{00855     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00856       setCursor(Qt::ArrowCursor);}
\DoxyCodeLine{00857   \}}
\DoxyCodeLine{00858 }
\DoxyCodeLine{00859   \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_af46b586bd61bf70e606713bee68c3aad}{m\_doCompare}} \&\& m\_mouseButton == Qt::NoButton) \{}
\DoxyCodeLine{00860     \textcolor{keywordflow}{if} (fabs(curPos.x -\/ width() * m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_ac544bac665ef86ee2ef3cfc214e89430}{m\_compareX}}) < 20)}
\DoxyCodeLine{00861       setToolCursor(\textcolor{keyword}{this}, ToolCursor::ScaleHCursor);}
\DoxyCodeLine{00862     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (fabs((height() -\/ curPos.y) -\/}
\DoxyCodeLine{00863                   height() * m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_aef7ad2a36c8fe81f397f225df3fc1095}{m\_compareY}}) < 20)}
\DoxyCodeLine{00864       setToolCursor(\textcolor{keyword}{this}, ToolCursor::ScaleVCursor);}
\DoxyCodeLine{00865   \}}
\DoxyCodeLine{00866 }
\DoxyCodeLine{00867   \textcolor{keywordflow}{if} (m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}} || m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}})}
\DoxyCodeLine{00868     dragCompare(curQPos -\/ m\_pos);}
\DoxyCodeLine{00869   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_mouseButton == Qt::MidButton)}
\DoxyCodeLine{00870     \mbox{\hyperlink{class_image_viewer_a574ebcd95b038e59de03f0bb6e6a9dd2}{panQt}}(curQPos -\/ m\_pos);}
\DoxyCodeLine{00871 }
\DoxyCodeLine{00872   m\_pos = curQPos;}
\DoxyCodeLine{00873 }
\DoxyCodeLine{00874   \textcolor{comment}{// pick the color if the histogram popup is opened}}
\DoxyCodeLine{00875   \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\& m\_histogramPopup-\/>isVisible() \&\& !m\_isColorModel) \{}
\DoxyCodeLine{00876     \textcolor{comment}{// Rect Pick}}
\DoxyCodeLine{00877     \textcolor{keywordflow}{if} (m\_mouseButton == Qt::LeftButton \&\&}
\DoxyCodeLine{00878         (event-\/>modifiers() \& Qt::ControlModifier)) \{}
\DoxyCodeLine{00879       \textcolor{keywordflow}{if} (!m\_rectRGBPick \&\& !m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a9f828dd6214db63baf8c86d2b7c039ef}{m\_defineLoadbox}} \&\&}
\DoxyCodeLine{00880           (abs(m\_pos.x() -\/ m\_pressedMousePos.x) > 10 ||}
\DoxyCodeLine{00881            abs(m\_pos.y() -\/ m\_pressedMousePos.y) > 10) \&\&}
\DoxyCodeLine{00882           !(m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}} ||}
\DoxyCodeLine{00883             m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}}) \&\&}
\DoxyCodeLine{00884           m\_flipbook)}
\DoxyCodeLine{00885         m\_rectRGBPick = \textcolor{keyword}{true};}
\DoxyCodeLine{00886 }
\DoxyCodeLine{00887       \textcolor{keywordflow}{if} (m\_rectRGBPick) \{}
\DoxyCodeLine{00888         update();}
\DoxyCodeLine{00889         \textcolor{comment}{// do not pick vector image while dragging as a portion of the red}}
\DoxyCodeLine{00890         \textcolor{comment}{// rubber band may affect the result}}
\DoxyCodeLine{00891         \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img = getPickedImage(m\_pos);}
\DoxyCodeLine{00892         \textcolor{keywordflow}{if} (img \&\& img-\/>\mbox{\hyperlink{class_t_image_acab19efe21f788a8016f0604c4c71912}{raster}}()) rectPickColor();}
\DoxyCodeLine{00893       \}}
\DoxyCodeLine{00894     \}}
\DoxyCodeLine{00895 }
\DoxyCodeLine{00896     update();}
\DoxyCodeLine{00897     pickColor(event);}
\DoxyCodeLine{00898     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00899   \}}
\DoxyCodeLine{00900 }
\DoxyCodeLine{00901   \textcolor{keywordflow}{if} (m\_mouseButton == Qt::LeftButton \&\& !m\_isColorModel \&\&}
\DoxyCodeLine{00902       (event-\/>modifiers() \& Qt::AltModifier)) \{}
\DoxyCodeLine{00903     \textcolor{keywordflow}{if} (!m\_draggingZoomSelection \&\& !m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a9f828dd6214db63baf8c86d2b7c039ef}{m\_defineLoadbox}} \&\&}
\DoxyCodeLine{00904         (abs(m\_pos.x() -\/ m\_pressedMousePos.x) > 10 ||}
\DoxyCodeLine{00905          abs(m\_pos.y() -\/ m\_pressedMousePos.y) > 10) \&\&}
\DoxyCodeLine{00906         !(m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}} ||}
\DoxyCodeLine{00907           m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}}) \&\&}
\DoxyCodeLine{00908         m\_flipbook)}
\DoxyCodeLine{00909       m\_draggingZoomSelection = \textcolor{keyword}{true};}
\DoxyCodeLine{00910 }
\DoxyCodeLine{00911     \textcolor{keywordflow}{if} (m\_draggingZoomSelection) update();}
\DoxyCodeLine{00912   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00913     m\_draggingZoomSelection = \textcolor{keyword}{false};}
\DoxyCodeLine{00914 }
\DoxyCodeLine{00915   \textcolor{keywordflow}{if} (m\_isColorModel \&\& m\_mouseButton == Qt::LeftButton) \{}
\DoxyCodeLine{00916     \textcolor{keyword}{event}-\/>ignore();}
\DoxyCodeLine{00917   \}}
\DoxyCodeLine{00918 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00084}{Image\+Painter\+::\+Compare\+Settings\+::m\+\_\+compareX}}, \mbox{\hyperlink{l00086}{Image\+Painter\+::\+Compare\+Settings\+::m\+\_\+compareY}}, \mbox{\hyperlink{l00059}{Image\+Painter\+::\+Visual\+Settings\+::m\+\_\+define\+Loadbox}}, \mbox{\hyperlink{l00058}{Image\+Painter\+::\+Visual\+Settings\+::m\+\_\+do\+Compare}}, \mbox{\hyperlink{l00089}{Image\+Painter\+::\+Compare\+Settings\+::m\+\_\+drag\+CompareX}}, \mbox{\hyperlink{l00091}{Image\+Painter\+::\+Compare\+Settings\+::m\+\_\+drag\+CompareY}}, \mbox{\hyperlink{l00666}{pan\+Qt()}}, and \mbox{\hyperlink{l00077}{TImage\+::raster()}}.

\mbox{\Hypertarget{class_image_viewer_ae7372584cca321456fd2b29794e69c00}\label{class_image_viewer_ae7372584cca321456fd2b29794e69c00}} 
\index{ImageViewer@{ImageViewer}!mousePressEvent@{mousePressEvent}}
\index{mousePressEvent@{mousePressEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{mousePressEvent()}{mousePressEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::mouse\+Press\+Event (\begin{DoxyParamCaption}\item[{QMouse\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01148                                                     \{}
\DoxyCodeLine{01149   \textcolor{keywordflow}{if} (!m\_image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01150 }
\DoxyCodeLine{01151   \textcolor{comment}{// qDebug() << "{}[mousePressEvent]"{};}}
\DoxyCodeLine{01152   \textcolor{keywordflow}{if} (m\_gestureActive \&\& m\_touchDevice == QTouchDevice::TouchScreen \&\&}
\DoxyCodeLine{01153       !m\_stylusUsed) \{}
\DoxyCodeLine{01154     \textcolor{keywordflow}{return};}
\DoxyCodeLine{01155   \}}
\DoxyCodeLine{01156 }
\DoxyCodeLine{01157   m\_pos                   = \textcolor{keyword}{event}-\/>pos() * getDevPixRatio();}
\DoxyCodeLine{01158   m\_pressedMousePos       = \mbox{\hyperlink{class_t_point_t}{TPoint}}(m\_pos.x(), m\_pos.y());}
\DoxyCodeLine{01159   m\_mouseButton           = \textcolor{keyword}{event}-\/>button();}
\DoxyCodeLine{01160   m\_draggingZoomSelection = \textcolor{keyword}{false};}
\DoxyCodeLine{01161 }
\DoxyCodeLine{01162   QPointF winPosMousePos = \textcolor{keyword}{event}-\/>windowPos() * getDevPixRatio() -\/ m\_pos;}
\DoxyCodeLine{01163   m\_winPosMousePosOffset = \mbox{\hyperlink{class_t_point_t}{TPointD}}(winPosMousePos.x(), winPosMousePos.y());}
\DoxyCodeLine{01164 }
\DoxyCodeLine{01165   \textcolor{keywordflow}{if} (m\_mouseButton != Qt::LeftButton) \{}
\DoxyCodeLine{01166     \textcolor{keyword}{event}-\/>ignore();}
\DoxyCodeLine{01167     \textcolor{keywordflow}{return};}
\DoxyCodeLine{01168   \}}
\DoxyCodeLine{01169   \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a9f828dd6214db63baf8c86d2b7c039ef}{m\_defineLoadbox}} \&\& m\_flipbook)}
\DoxyCodeLine{01170     m\_dragType = getDragType(}
\DoxyCodeLine{01171         m\_pressedMousePos,}
\DoxyCodeLine{01172         convert(\mbox{\hyperlink{class_image_viewer_a5f412d451a497d7c346c04c89d3c8865}{getImgToWidgetAffine}}() * convert(m\_flipbook-\/>getLoadbox())));}
\DoxyCodeLine{01173   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_af46b586bd61bf70e606713bee68c3aad}{m\_doCompare}}) \{}
\DoxyCodeLine{01174     \textcolor{keywordflow}{if} (fabs(m\_pos.x() -\/ width() * m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_ac544bac665ef86ee2ef3cfc214e89430}{m\_compareX}}) < 20) \{}
\DoxyCodeLine{01175       m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}} = \textcolor{keyword}{true};}
\DoxyCodeLine{01176       m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}} = \textcolor{keyword}{false};}
\DoxyCodeLine{01177       m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_aef7ad2a36c8fe81f397f225df3fc1095}{m\_compareY}}     = ImagePainter::DefaultCompareValue;}
\DoxyCodeLine{01178       update();}
\DoxyCodeLine{01179     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (fabs((height() -\/ m\_pos.y()) -\/}
\DoxyCodeLine{01180                     height() * m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_aef7ad2a36c8fe81f397f225df3fc1095}{m\_compareY}}) < 20) \{}
\DoxyCodeLine{01181       m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}} = \textcolor{keyword}{true};}
\DoxyCodeLine{01182       m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}} = \textcolor{keyword}{false};}
\DoxyCodeLine{01183       m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_ac544bac665ef86ee2ef3cfc214e89430}{m\_compareX}}     = ImagePainter::DefaultCompareValue;}
\DoxyCodeLine{01184       update();}
\DoxyCodeLine{01185     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{01186       m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}} = m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}} =}
\DoxyCodeLine{01187           \textcolor{keyword}{false};}
\DoxyCodeLine{01188   \}}
\DoxyCodeLine{01189 }
\DoxyCodeLine{01190   \textcolor{comment}{// pick color and throw it to the style editor}}
\DoxyCodeLine{01191   \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\& m\_histogramPopup-\/>isVisible() \&\& !m\_isColorModel \&\&}
\DoxyCodeLine{01192       !(event-\/>modifiers() \& Qt::ControlModifier))  \textcolor{comment}{// if ctrl button is}}
\DoxyCodeLine{01193                                                     \textcolor{comment}{// pressed, which means}}
\DoxyCodeLine{01194                                                     \textcolor{comment}{// rectangular pick}}
\DoxyCodeLine{01195   \{}
\DoxyCodeLine{01196     update();}
\DoxyCodeLine{01197     pickColor(event, \textcolor{keyword}{true});}
\DoxyCodeLine{01198   \}}
\DoxyCodeLine{01199 }
\DoxyCodeLine{01200   \textcolor{keyword}{event}-\/>ignore();}
\DoxyCodeLine{01201 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a62cdfb855b556cec0fff8ec46a4f27f5}\label{class_image_viewer_a62cdfb855b556cec0fff8ec46a4f27f5}} 
\index{ImageViewer@{ImageViewer}!mouseReleaseEvent@{mouseReleaseEvent}}
\index{mouseReleaseEvent@{mouseReleaseEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{mouseReleaseEvent()}{mouseReleaseEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::mouse\+Release\+Event (\begin{DoxyParamCaption}\item[{QMouse\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}

Reset current mouse position and current mouse button event. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01206                                                       \{}
\DoxyCodeLine{01207   \textcolor{keywordflow}{if} (!m\_image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01208   \textcolor{keywordflow}{if} (m\_draggingZoomSelection \&\& !m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a9f828dd6214db63baf8c86d2b7c039ef}{m\_defineLoadbox}}) \{}
\DoxyCodeLine{01209     m\_draggingZoomSelection = \textcolor{keyword}{false};}
\DoxyCodeLine{01210 }
\DoxyCodeLine{01211     \textcolor{keywordtype}{int} left, right, top, bottom;}
\DoxyCodeLine{01212     \textcolor{keywordflow}{if} (m\_pos.x() < m\_pressedMousePos.x)}
\DoxyCodeLine{01213       left = m\_pos.x(), right = m\_pressedMousePos.x;}
\DoxyCodeLine{01214     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01215       right = m\_pos.x(), left = m\_pressedMousePos.x;}
\DoxyCodeLine{01216     \textcolor{keywordflow}{if} (m\_pos.y() < m\_pressedMousePos.y)}
\DoxyCodeLine{01217       top = m\_pos.y(), bottom = m\_pressedMousePos.y;}
\DoxyCodeLine{01218     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01219       bottom = m\_pos.y(), top = m\_pressedMousePos.y;}
\DoxyCodeLine{01220 }
\DoxyCodeLine{01221     \mbox{\hyperlink{class_image_viewer_aaad0ef7fa1fb0ed91e36026e5e520e6d}{adaptView}}(QRect(QPoint(left, top), QPoint(right, bottom)));}
\DoxyCodeLine{01222   \}}
\DoxyCodeLine{01223 }
\DoxyCodeLine{01224   \textcolor{keywordflow}{if} (m\_rectRGBPick) \{}
\DoxyCodeLine{01225     \textcolor{comment}{// pick color in the rectangular region}}
\DoxyCodeLine{01226     rectPickColor(\textcolor{keyword}{true});}
\DoxyCodeLine{01227     \textcolor{comment}{// release the flag}}
\DoxyCodeLine{01228     m\_rectRGBPick = \textcolor{keyword}{false};}
\DoxyCodeLine{01229     update();}
\DoxyCodeLine{01230   \}}
\DoxyCodeLine{01231 }
\DoxyCodeLine{01232   m\_pos                            = QPoint(0, 0);}
\DoxyCodeLine{01233   m\_mouseButton                    = Qt::NoButton;}
\DoxyCodeLine{01234   m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a5c7c87c21fafb25dc1ba31ac6574397f}{m\_dragCompareX}} = m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_a3458a525867577308cefaf2d33f6639b}{m\_dragCompareY}} = \textcolor{keyword}{false};}
\DoxyCodeLine{01235 }
\DoxyCodeLine{01236   m\_gestureActive = \textcolor{keyword}{false};}
\DoxyCodeLine{01237   m\_zooming       = \textcolor{keyword}{false};}
\DoxyCodeLine{01238   m\_panning       = \textcolor{keyword}{false};}
\DoxyCodeLine{01239   m\_stylusUsed    = \textcolor{keyword}{false};}
\DoxyCodeLine{01240 }
\DoxyCodeLine{01241   \textcolor{keyword}{event}-\/>ignore();}
\DoxyCodeLine{01242 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l01362}{adapt\+View()}}, \mbox{\hyperlink{l00059}{Image\+Painter\+::\+Visual\+Settings\+::m\+\_\+define\+Loadbox}}, \mbox{\hyperlink{l00089}{Image\+Painter\+::\+Compare\+Settings\+::m\+\_\+drag\+CompareX}}, and \mbox{\hyperlink{l00091}{Image\+Painter\+::\+Compare\+Settings\+::m\+\_\+drag\+CompareY}}.

\mbox{\Hypertarget{class_image_viewer_a0bbac27221577b3644eb2a0be761640f}\label{class_image_viewer_a0bbac27221577b3644eb2a0be761640f}} 
\index{ImageViewer@{ImageViewer}!onContextAboutToBeDestroyed@{onContextAboutToBeDestroyed}}
\index{onContextAboutToBeDestroyed@{onContextAboutToBeDestroyed}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{onContextAboutToBeDestroyed}{onContextAboutToBeDestroyed}}
{\footnotesize\ttfamily void Image\+Viewer\+::on\+Context\+About\+To\+Be\+Destroyed (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01425                                               \{}
\DoxyCodeLine{01426   \textcolor{keywordflow}{if} (!m\_lutCalibrator) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01427   makeCurrent();}
\DoxyCodeLine{01428   m\_lutCalibrator-\/>cleanup();}
\DoxyCodeLine{01429   doneCurrent();}
\DoxyCodeLine{01430   disconnect(context(), SIGNAL(aboutToBeDestroyed()), \textcolor{keyword}{this},}
\DoxyCodeLine{01431              SLOT(onContextAboutToBeDestroyed()));}
\DoxyCodeLine{01432 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ac455bcbc5ebc2c8dd7c32ceca85d1b62}\label{class_image_viewer_ac455bcbc5ebc2c8dd7c32ceca85d1b62}} 
\index{ImageViewer@{ImageViewer}!onPreferenceChanged@{onPreferenceChanged}}
\index{onPreferenceChanged@{onPreferenceChanged}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{onPreferenceChanged}{onPreferenceChanged}}
{\footnotesize\ttfamily void Image\+Viewer\+::on\+Preference\+Changed (\begin{DoxyParamCaption}\item[{const QString \&}]{pref\+Name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01436                                                              \{}
\DoxyCodeLine{01437   \textcolor{keywordflow}{if} (prefName == \textcolor{stringliteral}{"{}ColorCalibration"{}}) \{}
\DoxyCodeLine{01438     \textcolor{keywordflow}{if} (Preferences::instance()-\/>isColorCalibrationEnabled()) \{}
\DoxyCodeLine{01439       \textcolor{comment}{// if the window is so shriked that the gl widget is empty,}}
\DoxyCodeLine{01440       \textcolor{comment}{// showEvent can be called before creating the context.}}
\DoxyCodeLine{01441       \textcolor{keywordflow}{if} (!context()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01442       makeCurrent();}
\DoxyCodeLine{01443       \textcolor{keywordflow}{if} (!m\_lutCalibrator)}
\DoxyCodeLine{01444         m\_lutCalibrator = \textcolor{keyword}{new} \mbox{\hyperlink{class_lut_calibrator}{LutCalibrator}}();}
\DoxyCodeLine{01445       \textcolor{keywordflow}{else}}
\DoxyCodeLine{01446         m\_lutCalibrator-\/>cleanup();}
\DoxyCodeLine{01447       m\_lutCalibrator-\/>initialize();}
\DoxyCodeLine{01448       connect(context(), SIGNAL(aboutToBeDestroyed()), \textcolor{keyword}{this},}
\DoxyCodeLine{01449               SLOT(onContextAboutToBeDestroyed()));}
\DoxyCodeLine{01450       \textcolor{keywordflow}{if} (m\_lutCalibrator-\/>isValid() \&\& !m\_fbo) \{}
\DoxyCodeLine{01451         \textcolor{keywordflow}{if} (Preferences::instance()-\/>is30bitDisplayEnabled()) \{}
\DoxyCodeLine{01452           QOpenGLFramebufferObjectFormat format;}
\DoxyCodeLine{01453           format.setInternalTextureFormat(TGL\_TexFmt10);}
\DoxyCodeLine{01454           m\_fbo = \textcolor{keyword}{new} QOpenGLFramebufferObject(width(), height(), format);}
\DoxyCodeLine{01455         \} \textcolor{keywordflow}{else}  \textcolor{comment}{// normally, initialize with GL\_RGBA8 format}}
\DoxyCodeLine{01456           m\_fbo = \textcolor{keyword}{new} QOpenGLFramebufferObject(width(), height());}
\DoxyCodeLine{01457       \}}
\DoxyCodeLine{01458       doneCurrent();}
\DoxyCodeLine{01459     \}}
\DoxyCodeLine{01460     update();}
\DoxyCodeLine{01461   \}}
\DoxyCodeLine{01462 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a2edbf42c08020efed6eaf23f0dbf56cf}\label{class_image_viewer_a2edbf42c08020efed6eaf23f0dbf56cf}} 
\index{ImageViewer@{ImageViewer}!paintGL@{paintGL}}
\index{paintGL@{paintGL}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{paintGL()}{paintGL()}}
{\footnotesize\ttfamily void Image\+Viewer\+::paint\+GL (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00507                           \{}
\DoxyCodeLine{00508   initializeOpenGLFunctions();}
\DoxyCodeLine{00509   \textcolor{keywordflow}{if} (m\_lutCalibrator \&\& m\_lutCalibrator-\/>isValid()) m\_fbo-\/>bind();}
\DoxyCodeLine{00510 }
\DoxyCodeLine{00511   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} viewerSize(width(), height());}
\DoxyCodeLine{00512   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = m\_viewAff;}
\DoxyCodeLine{00513 }
\DoxyCodeLine{00514   \textcolor{comment}{// if (!m\_visualSettings.m\_defineLoadbox \&\& m\_flipbook \&\&}}
\DoxyCodeLine{00515   \textcolor{comment}{// m\_flipbook-\/>getLoadbox()!=TRect())}}
\DoxyCodeLine{00516   \textcolor{comment}{//  offs =}}
\DoxyCodeLine{00517   \textcolor{comment}{//  convert(m\_flipbook-\/>getLoadbox().getP00())-\/TPointD(m\_flipbook-\/>getImageSize().lx/2.0,}}
\DoxyCodeLine{00518   \textcolor{comment}{//  m\_flipbook-\/>getImageSize().ly/2.0);}}
\DoxyCodeLine{00519 }
\DoxyCodeLine{00520   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} imageSize;}
\DoxyCodeLine{00521   \mbox{\hyperlink{class_t_rect_t}{TRect}} loadbox;}
\DoxyCodeLine{00522 }
\DoxyCodeLine{00523   \textcolor{keywordflow}{if} (m\_flipbook) \{}
\DoxyCodeLine{00524     QString title =}
\DoxyCodeLine{00525         (!m\_image)}
\DoxyCodeLine{00526             ? m\_flipbook-\/>getTitle() + tr(\textcolor{stringliteral}{"{}  ::  Zoom : "{}}) +}
\DoxyCodeLine{00527                   QString::number(tround(sqrt(m\_viewAff.det()) * 100)) + \textcolor{stringliteral}{"{} \%"{}}}
\DoxyCodeLine{00528             : m\_flipbook-\/>getLevelZoomTitle() + tr(\textcolor{stringliteral}{"{}  ::  Zoom : "{}}) +}
\DoxyCodeLine{00529                   QString::number(tround(sqrt(m\_viewAff.det()) * 100)) + \textcolor{stringliteral}{"{} \%"{}};}
\DoxyCodeLine{00530     m\_flipbook-\/>parentWidget()-\/>setWindowTitle(title);}
\DoxyCodeLine{00531     imageSize = m\_flipbook-\/>getImageSize();}
\DoxyCodeLine{00532     \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a1f71f1efab191eb50dd82ce0f099dda0}{m\_useLoadbox}} \&\& m\_flipbook-\/>getLoadbox() != \mbox{\hyperlink{class_t_rect_t}{TRect}}())}
\DoxyCodeLine{00533       loadbox = m\_flipbook-\/>getLoadbox();}
\DoxyCodeLine{00534   \}}
\DoxyCodeLine{00535   m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_ab6461a28653bae19432d998149564b43}{m\_sceneProperties}} =}
\DoxyCodeLine{00536       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene()-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}();}
\DoxyCodeLine{00537   \textcolor{comment}{// enable checks only in the color model}}
\DoxyCodeLine{00538   m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_aa5cb3950ff8ee132a7869d7b433d6938}{m\_useChecks}} = m\_isColorModel;}
\DoxyCodeLine{00539   ImagePainter::paintImage(m\_image, imageSize, viewerSize, aff,}
\DoxyCodeLine{00540                            m\_visualSettings, m\_compareSettings, loadbox);}
\DoxyCodeLine{00541 }
\DoxyCodeLine{00542   \textcolor{comment}{// when fx parameter is modified with showing the fx preview,}}
\DoxyCodeLine{00543   \textcolor{comment}{// a flipbook shows a red border line before the rendered result is shown.}}
\DoxyCodeLine{00544   \textcolor{keywordflow}{if} (m\_isRemakingPreviewFx) \{}
\DoxyCodeLine{00545     glPushMatrix();}
\DoxyCodeLine{00546     glLoadIdentity();}
\DoxyCodeLine{00547     glColor3d(1.0, 0.0, 0.0);}
\DoxyCodeLine{00548 }
\DoxyCodeLine{00549     glBegin(GL\_LINE\_LOOP);}
\DoxyCodeLine{00550     glVertex2d(5, 5);}
\DoxyCodeLine{00551     glVertex2d(5, height() -\/ 5);}
\DoxyCodeLine{00552     glVertex2d(width() -\/ 5, height() -\/ 5);}
\DoxyCodeLine{00553     glVertex2d(width() -\/ 5, 5);}
\DoxyCodeLine{00554     glEnd();}
\DoxyCodeLine{00555 }
\DoxyCodeLine{00556     glBegin(GL\_LINE\_LOOP);}
\DoxyCodeLine{00557     glVertex2d(10, 10);}
\DoxyCodeLine{00558     glVertex2d(10, height() -\/ 10);}
\DoxyCodeLine{00559     glVertex2d(width() -\/ 10, height() -\/ 10);}
\DoxyCodeLine{00560     glVertex2d(width() -\/ 10, 10);}
\DoxyCodeLine{00561     glEnd();}
\DoxyCodeLine{00562     glPopMatrix();}
\DoxyCodeLine{00563   \}}
\DoxyCodeLine{00564 }
\DoxyCodeLine{00565   \textcolor{keywordflow}{if} (!m\_image) \{}
\DoxyCodeLine{00566     \textcolor{keywordflow}{if} (m\_lutCalibrator \&\& m\_lutCalibrator-\/>isValid())}
\DoxyCodeLine{00567       m\_lutCalibrator-\/>onEndDraw(m\_fbo);}
\DoxyCodeLine{00568     \textcolor{keywordflow}{if} (m\_timer \&\& m\_timer-\/>isValid()) \{}
\DoxyCodeLine{00569       qint64 currentInstant = m\_timer-\/>nsecsElapsed();}
\DoxyCodeLine{00570       \textcolor{keywordflow}{while} (currentInstant < m\_targetInstant) \{}
\DoxyCodeLine{00571         currentInstant = m\_timer-\/>nsecsElapsed();}
\DoxyCodeLine{00572       \}}
\DoxyCodeLine{00573     \}}
\DoxyCodeLine{00574     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00575   \}}
\DoxyCodeLine{00576 }
\DoxyCodeLine{00577   \textcolor{keywordflow}{if} (safeAreaToggle.getStatus() \&\& !m\_isColorModel) \{}
\DoxyCodeLine{00578     \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} rimg = (\mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}})m\_image;}
\DoxyCodeLine{00579     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vimg = (\mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}})m\_image;}
\DoxyCodeLine{00580     \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} timg  = (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}})m\_image;}
\DoxyCodeLine{00581     \mbox{\hyperlink{class_t_rect_t}{TRect}} bbox;}
\DoxyCodeLine{00582 }
\DoxyCodeLine{00583     \mbox{\hyperlink{class_t_point_t}{TPointD}} centerD;}
\DoxyCodeLine{00584     \mbox{\hyperlink{class_t_rect_t}{TRect}} bounds;}
\DoxyCodeLine{00585     \textcolor{keywordflow}{if} (rimg) \{}
\DoxyCodeLine{00586       centerD = rimg-\/>getRaster()-\/>getCenterD();}
\DoxyCodeLine{00587       bounds  = rimg-\/>getRaster()-\/>getBounds();}
\DoxyCodeLine{00588     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (timg) \{}
\DoxyCodeLine{00589       centerD = timg-\/>getRaster()-\/>getCenterD();}
\DoxyCodeLine{00590       bounds  = timg-\/>getRaster()-\/>getBounds();}
\DoxyCodeLine{00591     \}}
\DoxyCodeLine{00592 }
\DoxyCodeLine{00593     \textcolor{keywordflow}{if} (!vimg) \{}
\DoxyCodeLine{00594       \mbox{\hyperlink{class_t_affine}{TAffine}} aff = \mbox{\hyperlink{class_t_translation}{TTranslation}}(viewerSize.lx * 0.5, viewerSize.ly * 0.5) *}
\DoxyCodeLine{00595                     m\_viewAff * \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/centerD);}
\DoxyCodeLine{00596       \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox = aff * \mbox{\hyperlink{class_t_rect_t}{TRectD}}(0, 0, bounds.getLx() -\/ 1, bounds.getLy() -\/ 1);}
\DoxyCodeLine{00597       drawSafeArea(bbox);}
\DoxyCodeLine{00598     \}}
\DoxyCodeLine{00599   \}}
\DoxyCodeLine{00600   \mbox{\hyperlink{class_t_point_t}{TPoint}} fromPos, toPos;}
\DoxyCodeLine{00601 }
\DoxyCodeLine{00602   \textcolor{keywordflow}{if} (m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_a9f828dd6214db63baf8c86d2b7c039ef}{m\_defineLoadbox}} \&\& m\_flipbook) \{}
\DoxyCodeLine{00603     \mbox{\hyperlink{class_t_rect_t}{TRect}} loadbox =}
\DoxyCodeLine{00604         convert(\mbox{\hyperlink{class_image_viewer_a5f412d451a497d7c346c04c89d3c8865}{getImgToWidgetAffine}}() * convert(m\_flipbook-\/>getLoadbox()));}
\DoxyCodeLine{00605     \textcolor{keywordflow}{if} (loadbox != \mbox{\hyperlink{class_t_rect_t}{TRect}}()) \{}
\DoxyCodeLine{00606       \mbox{\hyperlink{class_t_point_t}{TPoint}} p00 = loadbox.getP00();}
\DoxyCodeLine{00607       \mbox{\hyperlink{class_t_point_t}{TPoint}} p11 = loadbox.getP11();}
\DoxyCodeLine{00608       fromPos =}
\DoxyCodeLine{00609           \mbox{\hyperlink{class_t_point_t}{TPoint}}(p00.x -\/ width() * 0.5,}
\DoxyCodeLine{00610                  height() * 0.5 -\/ p00.y);  \textcolor{comment}{// m\_flipbook-\/>getLoadbox().getP00();}}
\DoxyCodeLine{00611       toPos =}
\DoxyCodeLine{00612           \mbox{\hyperlink{class_t_point_t}{TPoint}}(p11.x -\/ width() * 0.5,}
\DoxyCodeLine{00613                  height() * 0.5 -\/ p11.y);  \textcolor{comment}{// m\_flipbook-\/>getLoadbox().getP11();}}
\DoxyCodeLine{00614     \}}
\DoxyCodeLine{00615   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_draggingZoomSelection || m\_rectRGBPick) \{}
\DoxyCodeLine{00616     fromPos = \mbox{\hyperlink{class_t_point_t}{TPoint}}(m\_pressedMousePos.x -\/ width() * 0.5,}
\DoxyCodeLine{00617                      height() * 0.5 -\/ m\_pressedMousePos.y);}
\DoxyCodeLine{00618     toPos   = \mbox{\hyperlink{class_t_point_t}{TPoint}}(m\_pos.x() -\/ width() * 0.5, height() * 0.5 -\/ m\_pos.y());}
\DoxyCodeLine{00619   \}}
\DoxyCodeLine{00620   \textcolor{keywordflow}{if} (fromPos != \mbox{\hyperlink{class_t_point_t}{TPoint}}() || toPos != \mbox{\hyperlink{class_t_point_t}{TPoint}}()) \{}
\DoxyCodeLine{00621     \textcolor{keywordflow}{if} (m\_rectRGBPick) \{}
\DoxyCodeLine{00622       tglColor(TPixel32::Red);}
\DoxyCodeLine{00623       \textcolor{comment}{// TODO: glLineStipple is deprecated in the latest OpenGL. Need to be}}
\DoxyCodeLine{00624       \textcolor{comment}{// replaced. (shun\_iwasawa 2015/12/25)}}
\DoxyCodeLine{00625       glLineStipple(1, 0x3F33);}
\DoxyCodeLine{00626       glEnable(GL\_LINE\_STIPPLE);}
\DoxyCodeLine{00627 }
\DoxyCodeLine{00628       glBegin(GL\_LINE\_STRIP);}
\DoxyCodeLine{00629       \textcolor{comment}{// do not draw the rect around the mouse cursor}}
\DoxyCodeLine{00630       \textcolor{keywordtype}{int} margin = (fromPos.y < toPos.y) ? -\/3 : 3;}
\DoxyCodeLine{00631       glVertex2i(toPos.x, toPos.y + margin);}
\DoxyCodeLine{00632       glVertex2i(toPos.x, fromPos.y);}
\DoxyCodeLine{00633       glVertex2i(fromPos.x, fromPos.y);}
\DoxyCodeLine{00634       glVertex2i(fromPos.x, toPos.y);}
\DoxyCodeLine{00635       margin = (fromPos.x < toPos.x) ? -\/3 : 3;}
\DoxyCodeLine{00636       glVertex2i(toPos.x + margin, toPos.y);}
\DoxyCodeLine{00637       glEnd();}
\DoxyCodeLine{00638       glDisable(GL\_LINE\_STIPPLE);}
\DoxyCodeLine{00639     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00640       tglColor(m\_draggingZoomSelection ? TPixel32::Red : TPixel32::Blue);}
\DoxyCodeLine{00641       glBegin(GL\_LINE\_STRIP);}
\DoxyCodeLine{00642       glVertex2i(fromPos.x, fromPos.y);}
\DoxyCodeLine{00643       glVertex2i(fromPos.x, toPos.y);}
\DoxyCodeLine{00644       glVertex2i(toPos.x, toPos.y);}
\DoxyCodeLine{00645       glVertex2i(toPos.x, fromPos.y);}
\DoxyCodeLine{00646       glVertex2i(fromPos.x, fromPos.y);}
\DoxyCodeLine{00647       glEnd();}
\DoxyCodeLine{00648     \}}
\DoxyCodeLine{00649   \}}
\DoxyCodeLine{00650 }
\DoxyCodeLine{00651   \textcolor{keywordflow}{if} (m\_lutCalibrator \&\& m\_lutCalibrator-\/>isValid())}
\DoxyCodeLine{00652     m\_lutCalibrator-\/>onEndDraw(m\_fbo);}
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654   \textcolor{comment}{// wait to achieve precise fps}}
\DoxyCodeLine{00655   \textcolor{keywordflow}{if} (m\_timer \&\& m\_timer-\/>isValid()) \{}
\DoxyCodeLine{00656     qint64 currentInstant = m\_timer-\/>nsecsElapsed();}
\DoxyCodeLine{00657     \textcolor{keywordflow}{while} (currentInstant < m\_targetInstant) \{}
\DoxyCodeLine{00658       currentInstant = m\_timer-\/>nsecsElapsed();}
\DoxyCodeLine{00659     \}}
\DoxyCodeLine{00660   \}}
\DoxyCodeLine{00661 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a574ebcd95b038e59de03f0bb6e6a9dd2}\label{class_image_viewer_a574ebcd95b038e59de03f0bb6e6a9dd2}} 
\index{ImageViewer@{ImageViewer}!panQt@{panQt}}
\index{panQt@{panQt}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{panQt()}{panQt()}}
{\footnotesize\ttfamily void Image\+Viewer\+::pan\+Qt (\begin{DoxyParamCaption}\item[{const QPoint \&}]{delta }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Add to current transformation matrix a {\bfseries{delta}} translation. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00666                                            \{}
\DoxyCodeLine{00667   \textcolor{keywordflow}{if} (delta == QPoint()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00668 }
\DoxyCodeLine{00669   \textcolor{comment}{// stop panning when the image is at the edge of window}}
\DoxyCodeLine{00670   QPoint delta\_(delta.x(), delta.y());}
\DoxyCodeLine{00671 }
\DoxyCodeLine{00672   \mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}} timg  = (\mbox{\hyperlink{class_t_toonz_image_p}{TToonzImageP}})m\_image;}
\DoxyCodeLine{00673   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} rimg = (\mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}})m\_image;}
\DoxyCodeLine{00674   \textcolor{keywordflow}{if} (timg || rimg) \{}
\DoxyCodeLine{00675     \textcolor{keywordtype}{bool} isXPlus = delta.x() > 0;}
\DoxyCodeLine{00676     \textcolor{keywordtype}{bool} isYPlus = delta.y() > 0;}
\DoxyCodeLine{00677 }
\DoxyCodeLine{00678     \mbox{\hyperlink{class_t_dimension_t}{TDimension}} imgSize((timg) ? timg-\/>getSize() : rimg-\/>getRaster()-\/>getSize());}
\DoxyCodeLine{00679     \textcolor{keywordtype}{int} subSampling = (timg) ? timg-\/>getSubsampling() : rimg-\/>getSubsampling();}
\DoxyCodeLine{00680 }
\DoxyCodeLine{00681     \mbox{\hyperlink{class_t_point_t}{TPointD}} cornerPos = \mbox{\hyperlink{class_t_point_t}{TPointD}}(imgSize.lx * ((isXPlus) ? -\/1 : 1),}
\DoxyCodeLine{00682                                 imgSize.ly * ((isYPlus) ? 1 : -\/1)) *}
\DoxyCodeLine{00683                         (0.5 / (double)subSampling);}
\DoxyCodeLine{00684     cornerPos = m\_viewAff * cornerPos;}
\DoxyCodeLine{00685 }
\DoxyCodeLine{00686     \textcolor{keywordflow}{if} ((cornerPos.x > 0) == isXPlus) delta\_.setX(0);}
\DoxyCodeLine{00687     \textcolor{keywordflow}{if} ((cornerPos.y < 0) == isYPlus) delta\_.setY(0);}
\DoxyCodeLine{00688   \}}
\DoxyCodeLine{00689 }
\DoxyCodeLine{00690   setViewAff(\mbox{\hyperlink{class_t_translation}{TTranslation}}(delta\_.x(), -\/delta\_.y()) * m\_viewAff);}
\DoxyCodeLine{00691 }
\DoxyCodeLine{00692   update();}
\DoxyCodeLine{00693 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00825}{mouse\+Move\+Event()}}.

\mbox{\Hypertarget{class_image_viewer_a1dc088198a0839240e14a624dc77043b}\label{class_image_viewer_a1dc088198a0839240e14a624dc77043b}} 
\index{ImageViewer@{ImageViewer}!resetView@{resetView}}
\index{resetView@{resetView}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{resetView}{resetView}}
{\footnotesize\ttfamily void Image\+Viewer\+::reset\+View (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01315 \{ zoomQt(\textcolor{keyword}{false}, \textcolor{keyword}{true}); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a2b9b55471bdccb502526c7e5573c4775}\label{class_image_viewer_a2b9b55471bdccb502526c7e5573c4775}} 
\index{ImageViewer@{ImageViewer}!resetZoom@{resetZoom}}
\index{resetZoom@{resetZoom}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{resetZoom()}{resetZoom()}}
{\footnotesize\ttfamily void Image\+Viewer\+::reset\+Zoom (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00729                             \{}
\DoxyCodeLine{00730   \textcolor{keywordtype}{double} oldZoomScale = sqrt(m\_viewAff.det());}
\DoxyCodeLine{00731   setViewAff(\mbox{\hyperlink{class_t_scale}{TScale}}(1.0 / oldZoomScale) * m\_viewAff);}
\DoxyCodeLine{00732   update();}
\DoxyCodeLine{00733 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ae1ce6245e214b9cc4f065699b312e3fb}\label{class_image_viewer_ae1ce6245e214b9cc4f065699b312e3fb}} 
\index{ImageViewer@{ImageViewer}!resizeGL@{resizeGL}}
\index{resizeGL@{resizeGL}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{resizeGL()}{resizeGL()}}
{\footnotesize\ttfamily void Image\+Viewer\+::resize\+GL (\begin{DoxyParamCaption}\item[{int}]{width,  }\item[{int}]{height }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00478                                        \{}
\DoxyCodeLine{00479   w *= getDevPixRatio();}
\DoxyCodeLine{00480   h *= getDevPixRatio();}
\DoxyCodeLine{00481   glViewport(0, 0, w, h);}
\DoxyCodeLine{00482   glMatrixMode(GL\_PROJECTION);}
\DoxyCodeLine{00483   glLoadIdentity();}
\DoxyCodeLine{00484   \textcolor{keywordtype}{double} nearPlane   = 100;}
\DoxyCodeLine{00485   \textcolor{keywordtype}{double} farPlane    = 2500;}
\DoxyCodeLine{00486   \textcolor{keywordtype}{double} centerPlane = 1100;}
\DoxyCodeLine{00487   glOrtho(0, w, 0, h, -\/4000, 4000);}
\DoxyCodeLine{00488   glMatrixMode(GL\_MODELVIEW);}
\DoxyCodeLine{00489   glLoadIdentity();}
\DoxyCodeLine{00490   glTranslatef(0.375, 0.375, 0.0);}
\DoxyCodeLine{00491   glTranslated(w * 0.5, h * 0.5, 0);}
\DoxyCodeLine{00492 }
\DoxyCodeLine{00493   \textcolor{comment}{// remake fbo with new size}}
\DoxyCodeLine{00494   \textcolor{keywordflow}{if} (m\_lutCalibrator \&\& m\_lutCalibrator-\/>isValid()) \{}
\DoxyCodeLine{00495     \textcolor{keywordflow}{if} (m\_fbo) \textcolor{keyword}{delete} m\_fbo;}
\DoxyCodeLine{00496     \textcolor{keywordflow}{if} (Preferences::instance()-\/>is30bitDisplayEnabled()) \{}
\DoxyCodeLine{00497       QOpenGLFramebufferObjectFormat format;}
\DoxyCodeLine{00498       format.setInternalTextureFormat(TGL\_TexFmt10);}
\DoxyCodeLine{00499       m\_fbo = \textcolor{keyword}{new} QOpenGLFramebufferObject(w, h, format);}
\DoxyCodeLine{00500     \} \textcolor{keywordflow}{else}  \textcolor{comment}{// normally, initialize with GL\_RGBA8 format}}
\DoxyCodeLine{00501       m\_fbo = \textcolor{keyword}{new} QOpenGLFramebufferObject(w, h);}
\DoxyCodeLine{00502   \}}
\DoxyCodeLine{00503 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a08439b4de1e9dbe8107c7d6d0ca05ba2}\label{class_image_viewer_a08439b4de1e9dbe8107c7d6d0ca05ba2}} 
\index{ImageViewer@{ImageViewer}!setHistogramEnable@{setHistogramEnable}}
\index{setHistogramEnable@{setHistogramEnable}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setHistogramEnable()}{setHistogramEnable()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+Histogram\+Enable (\begin{DoxyParamCaption}\item[{bool}]{enable }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00436                                                 \{}
\DoxyCodeLine{00437   m\_isHistogramEnable = enable;}
\DoxyCodeLine{00438   \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\& !m\_histogramPopup)}
\DoxyCodeLine{00439     m\_histogramPopup = \textcolor{keyword}{new} \mbox{\hyperlink{class_histogram_popup}{HistogramPopup}}(tr(\textcolor{stringliteral}{"{}Flipbook Histogram"{}}));}
\DoxyCodeLine{00440 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ad85948c9cf34353112cb7d4b2e117a81}\label{class_image_viewer_ad85948c9cf34353112cb7d4b2e117a81}} 
\index{ImageViewer@{ImageViewer}!setHistogramTitle@{setHistogramTitle}}
\index{setHistogramTitle@{setHistogramTitle}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setHistogramTitle()}{setHistogramTitle()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+Histogram\+Title (\begin{DoxyParamCaption}\item[{QString}]{level\+Name }\end{DoxyParamCaption})}

If histogram popup exist and is open set its title to \char`\"{}\+Histogram\+: level name\char`\"{} if level Name is not empty. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00428                                                      \{}
\DoxyCodeLine{00429   \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\& m\_histogramPopup-\/>isVisible()) \{}
\DoxyCodeLine{00430     QString histogramTitle = QString(\textcolor{stringliteral}{"{}Histogram  ::  "{}}) + levelName;}
\DoxyCodeLine{00431     m\_histogramPopup-\/>setTitle(histogramTitle);}
\DoxyCodeLine{00432   \}}
\DoxyCodeLine{00433 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l01024}{Flip\+Book\+::set\+Level()}}.

\mbox{\Hypertarget{class_image_viewer_af514a3d90ce0f99a9217874bb3ef95dc}\label{class_image_viewer_af514a3d90ce0f99a9217874bb3ef95dc}} 
\index{ImageViewer@{ImageViewer}!setImage@{setImage}}
\index{setImage@{setImage}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setImage()}{setImage()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}}}]{image }\end{DoxyParamCaption})}

Set current image to {\bfseries{image}} and update. If \mbox{\hyperlink{class_histogram}{Histogram}} is visible set its image. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00405                                         \{}
\DoxyCodeLine{00406   m\_image = image;}
\DoxyCodeLine{00407 }
\DoxyCodeLine{00408   \textcolor{keywordflow}{if} (m\_image \&\& m\_firstImage) \{}
\DoxyCodeLine{00409     m\_firstImage = \textcolor{keyword}{false};}
\DoxyCodeLine{00410     fitView();}
\DoxyCodeLine{00411     \textcolor{comment}{// when the viewer size is large enough, limit the zoom ratio to 100\% so}}
\DoxyCodeLine{00412     \textcolor{comment}{// that the image is shown in actual pixel size without jaggies due to}}
\DoxyCodeLine{00413     \textcolor{comment}{// resampling.}}
\DoxyCodeLine{00414     \textcolor{keywordflow}{if} (fabs(m\_viewAff.det()) > 1.0) resetView();}
\DoxyCodeLine{00415   \}}
\DoxyCodeLine{00416 }
\DoxyCodeLine{00417   \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\& m\_histogramPopup-\/>isVisible())}
\DoxyCodeLine{00418     m\_histogramPopup-\/>setImage(image);}
\DoxyCodeLine{00419 }
\DoxyCodeLine{00420   \textcolor{comment}{// make sure to redraw the frame here.}}
\DoxyCodeLine{00421   \textcolor{comment}{// repaint() does NOT immediately redraw the frame for QOpenGLWidget}}
\DoxyCodeLine{00422   update();}
\DoxyCodeLine{00423   \textcolor{keywordflow}{if} (!isColorModel()) qApp-\/>processEvents();}
\DoxyCodeLine{00424 \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00504}{Color\+Model\+Viewer\+::load\+Current\+Frame()}}, \mbox{\hyperlink{l01671}{Flip\+Book\+::on\+Draw\+Frame()}}, and \mbox{\hyperlink{l00029}{Color\+Model\+Viewer\+::reset\+Image\+Viewer()}}.

\mbox{\Hypertarget{class_image_viewer_a25d0c3880d457fbfb8aef8dbdac5f3e5}\label{class_image_viewer_a25d0c3880d457fbfb8aef8dbdac5f3e5}} 
\index{ImageViewer@{ImageViewer}!setIsColorModel@{setIsColorModel}}
\index{setIsColorModel@{setIsColorModel}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setIsColorModel()}{setIsColorModel()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+Is\+Color\+Model (\begin{DoxyParamCaption}\item[{bool}]{is\+Color\+Model }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00102 \{ m\_isColorModel = isColorModel; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ab3f2e0f11a0e98019187c0aab85f0e6e}\label{class_image_viewer_ab3f2e0f11a0e98019187c0aab85f0e6e}} 
\index{ImageViewer@{ImageViewer}!setIsRemakingPreviewFx@{setIsRemakingPreviewFx}}
\index{setIsRemakingPreviewFx@{setIsRemakingPreviewFx}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setIsRemakingPreviewFx()}{setIsRemakingPreviewFx()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+Is\+Remaking\+Preview\+Fx (\begin{DoxyParamCaption}\item[{bool}]{on }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00127                                        \{}
\DoxyCodeLine{00128     m\_isRemakingPreviewFx = on;}
\DoxyCodeLine{00129     update();}
\DoxyCodeLine{00130   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a05c8912b53633fd251c30da998d2082f}\label{class_image_viewer_a05c8912b53633fd251c30da998d2082f}} 
\index{ImageViewer@{ImageViewer}!setTimerAndTargetInstant@{setTimerAndTargetInstant}}
\index{setTimerAndTargetInstant@{setTimerAndTargetInstant}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setTimerAndTargetInstant()}{setTimerAndTargetInstant()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+Timer\+And\+Target\+Instant (\begin{DoxyParamCaption}\item[{QElapsed\+Timer $\ast$}]{timer,  }\item[{qint64}]{target }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00140                                                                      \{}
\DoxyCodeLine{00141     m\_timer         = timer;}
\DoxyCodeLine{00142     m\_targetInstant = target;}
\DoxyCodeLine{00143   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a4ec516026bd15dc6c7c0154ea9070c00}\label{class_image_viewer_a4ec516026bd15dc6c7c0154ea9070c00}} 
\index{ImageViewer@{ImageViewer}!setViewAff@{setViewAff}}
\index{setViewAff@{setViewAff}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setViewAff()}{setViewAff()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+View\+Aff (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_affine}{TAffine}}}]{view\+Aff }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01305                                             \{}
\DoxyCodeLine{01306   m\_viewAff = viewAff;}
\DoxyCodeLine{01307   update();}
\DoxyCodeLine{01308   \textcolor{keywordflow}{if} (m\_flipbook \&\& m\_flipbook-\/>getPreviewedFx())}
\DoxyCodeLine{01309     \textcolor{comment}{// Update the observable fx region}}
\DoxyCodeLine{01310     m\_flipbook-\/>schedulePreviewedFxUpdate();}
\DoxyCodeLine{01311 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_abd5a4c3961e00f3fac5193d971ad0650}\label{class_image_viewer_abd5a4c3961e00f3fac5193d971ad0650}} 
\index{ImageViewer@{ImageViewer}!setVisual@{setVisual}}
\index{setVisual@{setVisual}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{setVisual()}{setVisual()}}
{\footnotesize\ttfamily void Image\+Viewer\+::set\+Visual (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_image_painter_1_1_visual_settings}{Image\+Painter\+::\+Visual\+Settings}} \&}]{settings }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00376                                                                       \{}
\DoxyCodeLine{00377   \textcolor{keywordflow}{if} (m\_isHistogramEnable \&\& m\_histogramPopup \&\&}
\DoxyCodeLine{00378       settings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_af46b586bd61bf70e606713bee68c3aad}{m\_doCompare}} != m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_af46b586bd61bf70e606713bee68c3aad}{m\_doCompare}}) \{}
\DoxyCodeLine{00379     m\_histogramPopup-\/>setShowCompare(settings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_af46b586bd61bf70e606713bee68c3aad}{m\_doCompare}});}
\DoxyCodeLine{00380   \}}
\DoxyCodeLine{00381   m\_visualSettings = settings;}
\DoxyCodeLine{00382   m\_visualSettings.\mbox{\hyperlink{class_image_painter_1_1_visual_settings_ab6461a28653bae19432d998149564b43}{m\_sceneProperties}} =}
\DoxyCodeLine{00383       \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}()-\/>getScene()-\/>\mbox{\hyperlink{class_toonz_scene_a8ef96fedc17d7def810ac419b0939254}{getProperties}}();}
\DoxyCodeLine{00384   m\_visualSettings.m\_drawExternalBG = \textcolor{keyword}{true};}
\DoxyCodeLine{00385 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ab465328eb07b6ceef99d9ec471d4fbc2}\label{class_image_viewer_ab465328eb07b6ceef99d9ec471d4fbc2}} 
\index{ImageViewer@{ImageViewer}!showEvent@{showEvent}}
\index{showEvent@{showEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{showEvent()}{showEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::show\+Event (\begin{DoxyParamCaption}\item[{QShow\+Event $\ast$}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00807                                         \{}
\DoxyCodeLine{00808   \mbox{\hyperlink{class_t_scene_handle}{TSceneHandle}} *sceneHandle = \mbox{\hyperlink{class_t_app_a24088f8647d5d9447fcec6b9b9bbf9eb}{TApp::instance}}()-\/>\mbox{\hyperlink{class_t_app_abbbf1fae564e9e510826eda4f6637d20}{getCurrentScene}}();}
\DoxyCodeLine{00809   \textcolor{keywordtype}{bool} ret = connect(sceneHandle, SIGNAL(preferenceChanged(\textcolor{keyword}{const} QString \&)),}
\DoxyCodeLine{00810                      \textcolor{keyword}{this}, SLOT(onPreferenceChanged(\textcolor{keyword}{const} QString \&)));}
\DoxyCodeLine{00811   onPreferenceChanged(\textcolor{stringliteral}{"{}ColorCalibration"{}});}
\DoxyCodeLine{00812   assert(ret);}
\DoxyCodeLine{00813 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a4f26f765f12d2feff9f3d11452be54b4}\label{class_image_viewer_a4f26f765f12d2feff9f3d11452be54b4}} 
\index{ImageViewer@{ImageViewer}!showHistogram@{showHistogram}}
\index{showHistogram@{showHistogram}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{showHistogram}{showHistogram}}
{\footnotesize\ttfamily void Image\+Viewer\+::show\+Histogram (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01764                                 \{}
\DoxyCodeLine{01765   \textcolor{keywordflow}{if} (!m\_isHistogramEnable) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01766   \textcolor{keywordflow}{if} (m\_histogramPopup-\/>isVisible())}
\DoxyCodeLine{01767     m\_histogramPopup-\/>raise();}
\DoxyCodeLine{01768   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{01769     m\_histogramPopup-\/>setImage(\mbox{\hyperlink{class_image_viewer_af80b9641df537a1bf3b0c98f2c431420}{getImage}}());}
\DoxyCodeLine{01770     m\_histogramPopup-\/>show();}
\DoxyCodeLine{01771   \}}
\DoxyCodeLine{01772 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a1a1aa26cb294de9d191411352d3d6c14}\label{class_image_viewer_a1a1aa26cb294de9d191411352d3d6c14}} 
\index{ImageViewer@{ImageViewer}!swapCompared@{swapCompared}}
\index{swapCompared@{swapCompared}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{swapCompared}{swapCompared}}
{\footnotesize\ttfamily void Image\+Viewer\+::swap\+Compared (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01298                                \{}
\DoxyCodeLine{01299   m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_afe3ed555ed9a43177446841f0978e58c}{m\_swapCompared}} = !m\_compareSettings.\mbox{\hyperlink{class_image_painter_1_1_compare_settings_afe3ed555ed9a43177446841f0978e58c}{m\_swapCompared}};}
\DoxyCodeLine{01300   update();}
\DoxyCodeLine{01301 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_afa60f2e0498eca8a566b89a3ff199294}\label{class_image_viewer_afa60f2e0498eca8a566b89a3ff199294}} 
\index{ImageViewer@{ImageViewer}!tabletEvent@{tabletEvent}}
\index{tabletEvent@{tabletEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{tabletEvent()}{tabletEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::tablet\+Event (\begin{DoxyParamCaption}\item[{QTablet\+Event $\ast$}]{e }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01466                                              \{}
\DoxyCodeLine{01467   \textcolor{comment}{// qDebug() << "{}[tabletEvent]"{};}}
\DoxyCodeLine{01468   \textcolor{keywordflow}{if} (e-\/>type() == QTabletEvent::TabletPress) \{}
\DoxyCodeLine{01469     m\_stylusUsed = e-\/>pointerType() ? true : \textcolor{keyword}{false};}
\DoxyCodeLine{01470   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e-\/>type() == QTabletEvent::TabletRelease) \{}
\DoxyCodeLine{01471     m\_stylusUsed = \textcolor{keyword}{false};}
\DoxyCodeLine{01472   \}}
\DoxyCodeLine{01473 }
\DoxyCodeLine{01474   e-\/>accept();}
\DoxyCodeLine{01475 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a05adf92e840fa8abb104d668c0ed68c5}\label{class_image_viewer_a05adf92e840fa8abb104d668c0ed68c5}} 
\index{ImageViewer@{ImageViewer}!touchEvent@{touchEvent}}
\index{touchEvent@{touchEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{touchEvent()}{touchEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::touch\+Event (\begin{DoxyParamCaption}\item[{QTouch\+Event $\ast$}]{e,  }\item[{int}]{type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{01544                                                      \{}
\DoxyCodeLine{01545   \textcolor{comment}{// qDebug() << "{}[touchEvent]"{};}}
\DoxyCodeLine{01546   \textcolor{keywordflow}{if} (type == QEvent::TouchBegin) \{}
\DoxyCodeLine{01547     m\_touchActive   = \textcolor{keyword}{true};}
\DoxyCodeLine{01548     m\_firstPanPoint = e-\/>touchPoints().at(0).pos();}
\DoxyCodeLine{01549     \textcolor{comment}{// obtain device type}}
\DoxyCodeLine{01550     m\_touchDevice = e-\/>device()-\/>type();}
\DoxyCodeLine{01551   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_touchActive) \{}
\DoxyCodeLine{01552     \textcolor{comment}{// touchpads must have 2 finger panning for tools and navigation to be}}
\DoxyCodeLine{01553     \textcolor{comment}{// functional on other devices, 1 finger panning is preferred}}
\DoxyCodeLine{01554     \textcolor{keywordflow}{if} ((e-\/>touchPoints().count() == 2 \&\&}
\DoxyCodeLine{01555          m\_touchDevice == QTouchDevice::TouchPad) ||}
\DoxyCodeLine{01556         (e-\/>touchPoints().count() == 1 \&\&}
\DoxyCodeLine{01557          m\_touchDevice == QTouchDevice::TouchScreen)) \{}
\DoxyCodeLine{01558       QTouchEvent::TouchPoint panPoint = e-\/>touchPoints().at(0);}
\DoxyCodeLine{01559       \textcolor{keywordflow}{if} (!m\_panning) \{}
\DoxyCodeLine{01560         QPointF deltaPoint = panPoint.pos() -\/ m\_firstPanPoint;}
\DoxyCodeLine{01561         \textcolor{comment}{// minimize accidental and jerky zooming/rotating during 2 finger}}
\DoxyCodeLine{01562         \textcolor{comment}{// panning}}
\DoxyCodeLine{01563         \textcolor{keywordflow}{if} ((deltaPoint.manhattanLength() > 100) \&\& !m\_zooming) \{}
\DoxyCodeLine{01564           m\_panning = \textcolor{keyword}{true};}
\DoxyCodeLine{01565         \}}
\DoxyCodeLine{01566       \}}
\DoxyCodeLine{01567       \textcolor{keywordflow}{if} (m\_panning) \{}
\DoxyCodeLine{01568         QPoint curPos      = panPoint.pos().toPoint() * getDevPixRatio();}
\DoxyCodeLine{01569         QPoint lastPos     = panPoint.lastPos().toPoint() * getDevPixRatio();}
\DoxyCodeLine{01570         QPoint centerDelta = curPos -\/ lastPos;}
\DoxyCodeLine{01571         \mbox{\hyperlink{class_image_viewer_a574ebcd95b038e59de03f0bb6e6a9dd2}{panQt}}(centerDelta);}
\DoxyCodeLine{01572       \}}
\DoxyCodeLine{01573     \}}
\DoxyCodeLine{01574   \}}
\DoxyCodeLine{01575   \textcolor{keywordflow}{if} (type == QEvent::TouchEnd || type == QEvent::TouchCancel) \{}
\DoxyCodeLine{01576     m\_touchActive = \textcolor{keyword}{false};}
\DoxyCodeLine{01577     m\_panning     = \textcolor{keyword}{false};}
\DoxyCodeLine{01578   \}}
\DoxyCodeLine{01579   e-\/>accept();}
\DoxyCodeLine{01580 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ae72f79ae8b4bae6b1bdfc94022414be3}\label{class_image_viewer_ae72f79ae8b4bae6b1bdfc94022414be3}} 
\index{ImageViewer@{ImageViewer}!updateImageViewer@{updateImageViewer}}
\index{updateImageViewer@{updateImageViewer}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{updateImageViewer}{updateImageViewer}}
{\footnotesize\ttfamily void Image\+Viewer\+::update\+Image\+Viewer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [slot]}}

Update image viewer, reset current matrix transformation, current position and update view. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01329                                     \{}
\DoxyCodeLine{01330   setViewAff(\mbox{\hyperlink{class_t_affine}{TAffine}}());}
\DoxyCodeLine{01331   m\_pos = QPoint(0, 0);}
\DoxyCodeLine{01332   update();}
\DoxyCodeLine{01333 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_afa10c8e25017a6e4efc3b017f40e5a6e}\label{class_image_viewer_afa10c8e25017a6e4efc3b017f40e5a6e}} 
\index{ImageViewer@{ImageViewer}!wheelEvent@{wheelEvent}}
\index{wheelEvent@{wheelEvent}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{wheelEvent()}{wheelEvent()}}
{\footnotesize\ttfamily void Image\+Viewer\+::wheel\+Event (\begin{DoxyParamCaption}\item[{QWheel\+Event $\ast$}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}}

Apply zoom. 
\begin{DoxyCode}{0}
\DoxyCodeLine{01247                                                \{}
\DoxyCodeLine{01248   \textcolor{keywordflow}{if} (!m\_image) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01249   \textcolor{keywordflow}{if} (event-\/>orientation() == Qt::Horizontal) \textcolor{keywordflow}{return};}
\DoxyCodeLine{01250   \textcolor{keywordtype}{int} delta = 0;}
\DoxyCodeLine{01251   \textcolor{keywordflow}{switch} (event-\/>source()) \{}
\DoxyCodeLine{01252   \textcolor{keywordflow}{case} Qt::MouseEventNotSynthesized: \{}
\DoxyCodeLine{01253     \textcolor{keywordflow}{if} (event-\/>modifiers() \& Qt::AltModifier)}
\DoxyCodeLine{01254       delta = \textcolor{keyword}{event}-\/>angleDelta().x();}
\DoxyCodeLine{01255     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01256       delta = \textcolor{keyword}{event}-\/>angleDelta().y();}
\DoxyCodeLine{01257     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01258   \}}
\DoxyCodeLine{01259 }
\DoxyCodeLine{01260   \textcolor{keywordflow}{case} Qt::MouseEventSynthesizedBySystem: \{}
\DoxyCodeLine{01261     QPoint numPixels  = \textcolor{keyword}{event}-\/>pixelDelta();}
\DoxyCodeLine{01262     QPoint numDegrees = \textcolor{keyword}{event}-\/>angleDelta() / 8;}
\DoxyCodeLine{01263     \textcolor{keywordflow}{if} (!numPixels.isNull()) \{}
\DoxyCodeLine{01264       delta = \textcolor{keyword}{event}-\/>pixelDelta().y();}
\DoxyCodeLine{01265     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!numDegrees.isNull()) \{}
\DoxyCodeLine{01266       QPoint numSteps = numDegrees / 15;}
\DoxyCodeLine{01267       delta           = numSteps.y();}
\DoxyCodeLine{01268     \}}
\DoxyCodeLine{01269     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01270   \}}
\DoxyCodeLine{01271 }
\DoxyCodeLine{01272   \textcolor{keywordflow}{default}:  \textcolor{comment}{// Qt::MouseEventSynthesizedByQt,}}
\DoxyCodeLine{01273             \textcolor{comment}{// Qt::MouseEventSynthesizedByApplication}}
\DoxyCodeLine{01274   \{}
\DoxyCodeLine{01275     std::cout << \textcolor{stringliteral}{"{}not supported event: Qt::MouseEventSynthesizedByQt, "{}}}
\DoxyCodeLine{01276                  \textcolor{stringliteral}{"{}Qt::MouseEventSynthesizedByApplication"{}}}
\DoxyCodeLine{01277               << std::endl;}
\DoxyCodeLine{01278     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01279   \}}
\DoxyCodeLine{01280 }
\DoxyCodeLine{01281   \}  \textcolor{comment}{// end switch}}
\DoxyCodeLine{01282 }
\DoxyCodeLine{01283   \textcolor{keywordflow}{if} (abs(delta) > 0) \{}
\DoxyCodeLine{01284     \textcolor{keywordflow}{if} ((m\_gestureActive == \textcolor{keyword}{true} \&\&}
\DoxyCodeLine{01285          m\_touchDevice == QTouchDevice::TouchScreen) ||}
\DoxyCodeLine{01286         m\_gestureActive == \textcolor{keyword}{false}) \{}
\DoxyCodeLine{01287       \textcolor{keywordtype}{int} delta = \textcolor{keyword}{event}-\/>delta() > 0 ? 120 : -\/120;}
\DoxyCodeLine{01288       QPoint center(event-\/>pos().x() * getDevPixRatio() -\/ width() / 2,}
\DoxyCodeLine{01289                     -\/event-\/>pos().y() * getDevPixRatio() + height() / 2);}
\DoxyCodeLine{01290       zoomQt(center, exp(0.001 * delta));}
\DoxyCodeLine{01291     \}}
\DoxyCodeLine{01292   \}}
\DoxyCodeLine{01293   \textcolor{keyword}{event}-\/>accept();}
\DoxyCodeLine{01294 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_ae32677b4e8710e66a535bfabd9bfd84d}\label{class_image_viewer_ae32677b4e8710e66a535bfabd9bfd84d}} 
\index{ImageViewer@{ImageViewer}!zoomQt@{zoomQt}}
\index{zoomQt@{zoomQt}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{zoomQt()}{zoomQt()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void Image\+Viewer\+::zoom\+Qt (\begin{DoxyParamCaption}\item[{bool}]{forward,  }\item[{bool}]{reset }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00713                                                  \{}
\DoxyCodeLine{00714   \textcolor{keywordtype}{double} scale2 = m\_viewAff.det();}
\DoxyCodeLine{00715   \textcolor{keywordflow}{if} (reset)}
\DoxyCodeLine{00716     setViewAff(\mbox{\hyperlink{class_t_affine}{TAffine}}());}
\DoxyCodeLine{00717   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (((scale2 < 100000 || !forward) \&\&}
\DoxyCodeLine{00718             (scale2 > 0.001 * 0.05 || forward))) \{}
\DoxyCodeLine{00719     \textcolor{keywordtype}{double} oldZoomScale = sqrt(scale2);}
\DoxyCodeLine{00720     \textcolor{keywordtype}{double} zoomScale =}
\DoxyCodeLine{00721         reset ? 1 : ImageUtils::getQuantizedZoomFactor(oldZoomScale, forward);}
\DoxyCodeLine{00722     setViewAff(\mbox{\hyperlink{class_t_scale}{TScale}}(zoomScale / oldZoomScale) * m\_viewAff);}
\DoxyCodeLine{00723   \}}
\DoxyCodeLine{00724   update();}
\DoxyCodeLine{00725 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_viewer_a4b00ca265e005c2de288ac04858e46cd}\label{class_image_viewer_a4b00ca265e005c2de288ac04858e46cd}} 
\index{ImageViewer@{ImageViewer}!zoomQt@{zoomQt}}
\index{zoomQt@{zoomQt}!ImageViewer@{ImageViewer}}
\doxysubsubsection{\texorpdfstring{zoomQt()}{zoomQt()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void Image\+Viewer\+::zoom\+Qt (\begin{DoxyParamCaption}\item[{const QPoint \&}]{center,  }\item[{double}]{factor }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Add to current transformation matrix a {\bfseries{center}} translation matched with a scale of factor {\bfseries{factor}}. Apply a zoom of factor {\bfseries{factor}} with center {\bfseries{center}}. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00701                                                             \{}
\DoxyCodeLine{00702   \textcolor{keywordflow}{if} (factor == 1.0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00703   \mbox{\hyperlink{class_t_point_t}{TPointD}} delta(center.x(), center.y());}
\DoxyCodeLine{00704   \textcolor{keywordtype}{double} scale2 = fabs(m\_viewAff.det());}
\DoxyCodeLine{00705   \textcolor{keywordflow}{if} ((scale2 < 100000 || factor < 1) \&\& (scale2 > 0.001 * 0.05 || factor > 1))}
\DoxyCodeLine{00706     setViewAff(\mbox{\hyperlink{class_t_translation}{TTranslation}}(delta) * \mbox{\hyperlink{class_t_scale}{TScale}}(factor) * \mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/delta) *}
\DoxyCodeLine{00707                m\_viewAff);}
\DoxyCodeLine{00708   update();}
\DoxyCodeLine{00709 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonz/imageviewer.\+h\item 
E\+:/opentoonz/toonz/sources/toonz/flipbook.\+cpp\item 
E\+:/opentoonz/toonz/sources/toonz/imageviewer.\+cpp\end{DoxyCompactItemize}
