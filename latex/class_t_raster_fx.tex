\hypertarget{class_t_raster_fx}{}\doxysection{TRaster\+Fx Class Reference}
\label{class_t_raster_fx}\index{TRasterFx@{TRasterFx}}


\mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}} is the base class for any {\itshape renderable} Toonz Fx.  




{\ttfamily \#include $<$trasterfx.\+h$>$}

Inheritance diagram for TRaster\+Fx\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=12.000000cm]{class_t_raster_fx}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_raster_fx_1_1_t_raster_fx_imp}{TRaster\+Fx\+Imp}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_t_raster_fx_ac58262d55adc20dcb0c958e880137a21}\label{class_t_raster_fx_ac58262d55adc20dcb0c958e880137a21}} 
virtual bool {\bfseries get\+BBox} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, TPixel32 \&bg\+Color)=0
\item 
virtual string \mbox{\hyperlink{class_t_raster_fx_a418764f08eb81c99e2fe41ee5373bb00}{get\+Name}} () const =0
\item 
\mbox{\Hypertarget{class_t_raster_fx_ae08e05b327b9f8d7495c441ebd8b8c56}\label{class_t_raster_fx_ae08e05b327b9f8d7495c441ebd8b8c56}} 
virtual \mbox{\hyperlink{class_t_rect_t}{TRect}} {\bfseries get\+Invalid\+Rect} (const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&max)=0
\item 
\mbox{\Hypertarget{class_t_raster_fx_a1dc95fbde2b7140ac54135e33c01e5c7}\label{class_t_raster_fx_a1dc95fbde2b7140ac54135e33c01e5c7}} 
virtual void {\bfseries compute} (double frame, const \mbox{\hyperlink{class_t_tile}{TTile}} \&tile)=0
\item 
\mbox{\Hypertarget{class_t_raster_fx_a49f55c7b6b883dbd6d02a031a591f419}\label{class_t_raster_fx_a49f55c7b6b883dbd6d02a031a591f419}} 
virtual void {\bfseries allocate\+And\+Compute} (double frame, const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} size, const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, \mbox{\hyperlink{class_t_tile}{TTile}} \&tile)
\item 
virtual void \mbox{\hyperlink{class_t_raster_fx_a5fccf6fecdbbb98455d33acbb582988d}{compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)
\begin{DoxyCompactList}\small\item\em This method supplies the actual fx rendering code. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_t_raster_fx_a2bd69304bd2844a2f86ec9a7eaaa5c52}{allocate\+And\+Compute}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&pos, const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&size, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} template\+Ras, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)
\item 
\mbox{\Hypertarget{class_t_raster_fx_a01dce2fac7e36c93d64cb6ba29000246}\label{class_t_raster_fx_a01dce2fac7e36c93d64cb6ba29000246}} 
virtual bool {\bfseries do\+Get\+BBox} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)=0
\item 
bool \mbox{\hyperlink{class_t_raster_fx_a22e94baf54def35e72cdae9dfad73704}{get\+BBox}} (double frame, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&b\+Box, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)
\item 
virtual bool \mbox{\hyperlink{class_t_raster_fx_a8722381a4f84859d2035378948a72d17}{is\+Cachable}} () const
\item 
virtual void \mbox{\hyperlink{class_t_raster_fx_a40efd762c22290b1f040e01c15e827f5}{transform}} (double frame, int port, const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect\+On\+Output, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info\+On\+Output, \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect\+On\+Input, \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info\+On\+Input)
\item 
\mbox{\Hypertarget{class_t_raster_fx_a8b9d5abe767b616993bed76a66a73f78}\label{class_t_raster_fx_a8b9d5abe767b616993bed76a66a73f78}} 
virtual bool {\bfseries can\+Handle} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame)=0
\item 
virtual \mbox{\hyperlink{class_t_affine}{TAffine}} \mbox{\hyperlink{class_t_raster_fx_a7c1e13b0ee0b12e8ec68635ff63929b8}{handled\+Affine}} (const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info, double frame)
\item 
void \mbox{\hyperlink{class_t_raster_fx_ad45ee43c85f31849ac94e6e40670370d}{enable\+Cache}} (bool on)
\item 
bool \mbox{\hyperlink{class_t_raster_fx_add147daf17a488a33642c56cdf0e8106}{is\+Cache\+Enabled}} () const
\item 
std\+::string \mbox{\hyperlink{class_t_raster_fx_a00bb0d71ea6fda6d9831208ae13b7b0c}{get\+Alias}} (double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info) const override
\item 
virtual void \mbox{\hyperlink{class_t_raster_fx_a97f2968efddd99e15ea69175b81dc99c}{dry\+Compute}} (\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)
\item 
virtual int \mbox{\hyperlink{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}{get\+Memory\+Requirement}} (const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)
\item 
virtual bool \mbox{\hyperlink{class_t_raster_fx_a4bf5504dcf9844a9cfd34e15fa7fce91}{allow\+User\+Cache\+On\+Port}} (int port)
\item 
virtual bool \mbox{\hyperlink{class_t_raster_fx_a350ef810c2ded7b9b51136b73b360f92}{is\+Plugin}} () const
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \mbox{\hyperlink{class_t_raster_fx_aa3b4de5084cd904e75ca997b0d6f868d}{apply\+Affine}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile\+Out, const \mbox{\hyperlink{class_t_tile}{TTile}} \&tile\+In, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)
\item 
static int \mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{memory\+Size}} (const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, int bpp)
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_t_raster_fx_a663b3a7cb1fca6545b39c7379d84580f}\label{class_t_raster_fx_a663b3a7cb1fca6545b39c7379d84580f}} 
virtual void {\bfseries do\+Compute} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&settings)=0
\item 
virtual void \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{do\+Dry\+Compute}} (\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&rect, double frame, const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&info)
\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_raster_fx_ad4c398a7398254cce6efd752d45a2c30}{Fx\+Resource\+Builder}}
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
\mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}} is the base class for any {\itshape renderable} Toonz Fx. 

A standard Toonz Fx is roughly composed of 2 parts\+: one providing the necessary interface for access by a GUI interface (covered by the \mbox{\hyperlink{class_t_fx}{TFx}} class, which this class inherits), the other for the actual computation of the fx -\/ which is the focus of the \mbox{\hyperlink{class_t_raster_fx}{TRaster\+Fx}} interface. ~\newline
~\newline
 So, the essential part of this class lies in the compute() and do\+Compute() methods that are invoked to perform an fx computation. The former method is the publicly accessed one, while the latter is the one that fx writers must reimplement to supply their rendering code. ~\newline
 The allocate\+And\+Compute() method can be used to automatically allocate the tile to be rendered right before invoking compute(). ~\newline
~\newline
 The dry\+Compute() / \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{do\+Dry\+Compute()}} methods are required by Toonz to perform predictive caching in order to minimize needless recomputations of the same fx. Fx writers must reimplement \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{do\+Dry\+Compute()}} to mimic the behaviour of do\+Compute() in terms of compute() invocations for children fx nodes. Those compute() invocations must be replaced with dry\+Compute(). ~\newline
~\newline
 The get\+BBox() / do\+Get\+BBox() methods are used to obtain the geometry of the maximal output that an fx can produce with similar inputs to compute(). Again, do\+Compute() is the method to reimplement by subclasses. Observe that, unlike do\+Compute() and \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{do\+Dry\+Compute()}}, in this case the affine supplied with the render settings must be {\bfseries{ignored}} (see the method itself for further details). ~\newline
~\newline
 The can\+Handle() / handled\+Affine() methods are used by the compute() function to separate the part of an affine that the do\+Compute() can apply to the result on its own from the rest (which is automatically applied on the fx result using TRaster\+Fx\+::apply\+Affine() ). Note that every Toonz fx should be able to handle at least the scale part of an affine (applying TRaster\+Fx\+::apply\+Affine() on image enlargements typically hampers image quality). ~\newline
~\newline
 Further methods whose reimplementation depends on the fx itself are get\+Alias(), which must return a string uniquely descripting a rendered object, and \mbox{\hyperlink{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}{get\+Memory\+Requirement()}} to declare the amount of memory that will be used by the fx. 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_raster_fx_a6ae4fcf3471ed8d4f5608be2c751c50c}\label{class_t_raster_fx_a6ae4fcf3471ed8d4f5608be2c751c50c}} 
\index{TRasterFx@{TRasterFx}!TRasterFx@{TRasterFx}}
\index{TRasterFx@{TRasterFx}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{TRasterFx()}{TRasterFx()}}
{\footnotesize\ttfamily TRaster\+Fx\+::\+TRaster\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00076 \{\};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a6f5d7782e05ecd3ccfa83f4b882caf6c}\label{class_t_raster_fx_a6f5d7782e05ecd3ccfa83f4b882caf6c}} 
\index{TRasterFx@{TRasterFx}!````~TRasterFx@{$\sim$TRasterFx}}
\index{````~TRasterFx@{$\sim$TRasterFx}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{$\sim$TRasterFx()}{~TRasterFx()}}
{\footnotesize\ttfamily TRaster\+Fx\+::$\sim$\+TRaster\+Fx (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00077 \{\};}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_raster_fx_a2bd69304bd2844a2f86ec9a7eaaa5c52}\label{class_t_raster_fx_a2bd69304bd2844a2f86ec9a7eaaa5c52}} 
\index{TRasterFx@{TRasterFx}!allocateAndCompute@{allocateAndCompute}}
\index{allocateAndCompute@{allocateAndCompute}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{allocateAndCompute()}{allocateAndCompute()}}
{\footnotesize\ttfamily void TRaster\+Fx\+::allocate\+And\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{const \mbox{\hyperlink{class_t_point_t}{TPointD}} \&}]{pos,  }\item[{const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&}]{size,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}}]{template\+Ras,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})}

This is an overloaded member function that deals with the allocation of an input tile before invoking the TRaster\+Fx\+::compute method on it. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00762                                                                               \{}
\DoxyCodeLine{00763   \textcolor{keywordflow}{if} (templateRas) \{}
\DoxyCodeLine{00764     \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras32(templateRas);}
\DoxyCodeLine{00765     \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} ras64(templateRas);}
\DoxyCodeLine{00766     templateRas = 0;  \textcolor{comment}{// Release the reference to templateRas before allocation}}
\DoxyCodeLine{00767 }
\DoxyCodeLine{00768     \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} tileRas;}
\DoxyCodeLine{00769     \textcolor{keywordflow}{if} (ras32)}
\DoxyCodeLine{00770       tileRas = \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}}(size.lx, size.ly);}
\DoxyCodeLine{00771     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ras64)}
\DoxyCodeLine{00772       tileRas = \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}}(size.lx, size.ly);}
\DoxyCodeLine{00773     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00774       assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00775       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00776     \}}
\DoxyCodeLine{00777 }
\DoxyCodeLine{00778     tile.setRaster(tileRas);}
\DoxyCodeLine{00779   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00780     \textcolor{keywordflow}{if} (info.m\_bpp == 32) \{}
\DoxyCodeLine{00781       \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} tileRas(size.lx, size.ly);}
\DoxyCodeLine{00782       tile.setRaster(tileRas);}
\DoxyCodeLine{00783     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (info.m\_bpp == 64) \{}
\DoxyCodeLine{00784       \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}} tileRas(size.lx, size.ly);}
\DoxyCodeLine{00785       tile.setRaster(tileRas);}
\DoxyCodeLine{00786     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00787       assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00788   \}}
\DoxyCodeLine{00789 }
\DoxyCodeLine{00790   tile.m\_pos = pos;}
\DoxyCodeLine{00791   compute(tile, frame, info);}
\DoxyCodeLine{00792 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a4bf5504dcf9844a9cfd34e15fa7fce91}\label{class_t_raster_fx_a4bf5504dcf9844a9cfd34e15fa7fce91}} 
\index{TRasterFx@{TRasterFx}!allowUserCacheOnPort@{allowUserCacheOnPort}}
\index{allowUserCacheOnPort@{allowUserCacheOnPort}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{allowUserCacheOnPort()}{allowUserCacheOnPort()}}
{\footnotesize\ttfamily virtual bool TRaster\+Fx\+::allow\+User\+Cache\+On\+Port (\begin{DoxyParamCaption}\item[{int}]{port }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00292 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{true}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_aa3b4de5084cd904e75ca997b0d6f868d}\label{class_t_raster_fx_aa3b4de5084cd904e75ca997b0d6f868d}} 
\index{TRasterFx@{TRasterFx}!applyAffine@{applyAffine}}
\index{applyAffine@{applyAffine}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{applyAffine()}{applyAffine()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} TRaster\+Fx\+::apply\+Affine (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile\+Out,  }\item[{const \mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile\+In,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00945                                                              \{}
\DoxyCodeLine{00946   \mbox{\hyperlink{class_t_affine}{TAffine}} aff = info.m\_affine;}
\DoxyCodeLine{00947 }
\DoxyCodeLine{00948   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} src\_ras = tileIn.getRaster();}
\DoxyCodeLine{00949   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} dst\_ras = tileOut.getRaster();}
\DoxyCodeLine{00950 }
\DoxyCodeLine{00951   \textcolor{keywordflow}{if} (aff.\mbox{\hyperlink{class_t_affine_a012fb9d5c24054c15ed5c047acbcbd2c}{isTranslation}}()) \{}
\DoxyCodeLine{00952     \textcolor{comment}{// Check the tile origins' fractionary displacement}}
\DoxyCodeLine{00953     \mbox{\hyperlink{class_t_point_t}{TPointD}} diff(tileOut.m\_pos -\/ tileIn.m\_pos -\/ \mbox{\hyperlink{class_t_point_t}{TPointD}}(aff.a13, aff.a23));}
\DoxyCodeLine{00954     \textcolor{keywordtype}{double} fracX = diff.x -\/ tfloor(diff.x);}
\DoxyCodeLine{00955     \textcolor{keywordtype}{double} fracY = diff.y -\/ tfloor(diff.y);}
\DoxyCodeLine{00956 }
\DoxyCodeLine{00957     \textcolor{keywordflow}{if} ((fracX < 0.01 || fracX > 0.99) \&\& (fracY < 0.01 || fracY > 0.99)) \{}
\DoxyCodeLine{00958       \textcolor{comment}{// Just copy part of tileIn into tileOut}}
\DoxyCodeLine{00959       \mbox{\hyperlink{class_t_rect_t}{TRect}} geomIn(src\_ras-\/>getBounds());}
\DoxyCodeLine{00960       \mbox{\hyperlink{class_t_rect_t}{TRect}} geomOut(dst\_ras-\/>getBounds());}
\DoxyCodeLine{00961       \mbox{\hyperlink{class_t_point_t}{TPoint}} diffI(convert(diff));}
\DoxyCodeLine{00962       geomIn -\/= diffI;}
\DoxyCodeLine{00963       geomOut += diffI;}
\DoxyCodeLine{00964       geomIn *= dst\_ras-\/>getBounds();}
\DoxyCodeLine{00965       geomOut *= src\_ras-\/>getBounds();}
\DoxyCodeLine{00966 }
\DoxyCodeLine{00967       \textcolor{keywordflow}{if} (geomIn.isEmpty()) \textcolor{keywordflow}{return} dst\_ras;}
\DoxyCodeLine{00968 }
\DoxyCodeLine{00969       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} rasIn(src\_ras-\/>extract(geomOut));}
\DoxyCodeLine{00970       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} rasOut(dst\_ras-\/>extract(geomIn));}
\DoxyCodeLine{00971       \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{TRop::copy}}(rasOut, rasIn);}
\DoxyCodeLine{00972 }
\DoxyCodeLine{00973       \textcolor{keywordflow}{return} dst\_ras;}
\DoxyCodeLine{00974     \}}
\DoxyCodeLine{00975   \}}
\DoxyCodeLine{00976 }
\DoxyCodeLine{00977   \mbox{\hyperlink{class_t_rect_t}{TRectD}} rectIn  = myConvert(src\_ras-\/>getBounds()) + tileIn.m\_pos;}
\DoxyCodeLine{00978   \mbox{\hyperlink{class_t_rect_t}{TRectD}} rectOut = myConvert(dst\_ras-\/>getBounds()) + tileOut.m\_pos;}
\DoxyCodeLine{00979 }
\DoxyCodeLine{00980   \mbox{\hyperlink{class_t_rect_t}{TRectD}} rectInAfter = aff * myConvert(src\_ras-\/>getBounds());}
\DoxyCodeLine{00981   \mbox{\hyperlink{class_t_affine}{TAffine}} rasterAff  = \mbox{\hyperlink{class_t_translation}{TTranslation}}((aff * rectIn).getP00() -\/ rectOut.getP00() -\/}
\DoxyCodeLine{00982                                    rectInAfter.getP00()) *}
\DoxyCodeLine{00983                       aff;}
\DoxyCodeLine{00984 }
\DoxyCodeLine{00985   \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168}{TRop::ResampleFilterType}} qual;}
\DoxyCodeLine{00986   \textcolor{keywordflow}{switch} (info.m\_quality) \{}
\DoxyCodeLine{00987   \textcolor{keywordflow}{case} \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0a6f0e34f8c8c4543c5da7179c62ab0b88}{TRenderSettings::StandardResampleQuality}}:}
\DoxyCodeLine{00988     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168af59a8bad64d2b117020f864efd67b2b5}{TRop::Triangle}};}
\DoxyCodeLine{00989     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00990   \textcolor{keywordflow}{case} \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0a6952c5da808e112dd5eaa9eac54a885d}{TRenderSettings::ImprovedResampleQuality}}:}
\DoxyCodeLine{00991     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a8142bce9410b8ca2682b7f41d0fe1cda}{TRop::Hann2}};}
\DoxyCodeLine{00992     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00993   \textcolor{keywordflow}{case} \mbox{\hyperlink{class_t_render_settings_a272419f50105b7567c1e915f75a891d0ae5f4cd9e884f5249d73c37edbc4d3c6d}{TRenderSettings::HighResampleQuality}}:}
\DoxyCodeLine{00994     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168adbd720438a66e557e65a1419610d9ef9}{TRop::Hamming3}};}
\DoxyCodeLine{00995     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00996   \textcolor{keywordflow}{case} TRenderSettings::Triangle\_FilterResampleQuality:}
\DoxyCodeLine{00997     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168af59a8bad64d2b117020f864efd67b2b5}{TRop::Triangle}};}
\DoxyCodeLine{00998     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00999   \textcolor{keywordflow}{case} TRenderSettings::Mitchell\_FilterResampleQuality:}
\DoxyCodeLine{01000     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168adaa7b87b985724e085f7281d2817dfb6}{TRop::Mitchell}};}
\DoxyCodeLine{01001     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01002   \textcolor{keywordflow}{case} TRenderSettings::Cubic5\_FilterResampleQuality:}
\DoxyCodeLine{01003     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a5299db768d5b5c8554907b73a6075ce1}{TRop::Cubic5}};}
\DoxyCodeLine{01004     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01005   \textcolor{keywordflow}{case} TRenderSettings::Cubic75\_FilterResampleQuality:}
\DoxyCodeLine{01006     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168ad232a671a97d1958fa9caa4696f3efa7}{TRop::Cubic75}};}
\DoxyCodeLine{01007     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01008   \textcolor{keywordflow}{case} TRenderSettings::Cubic1\_FilterResampleQuality:}
\DoxyCodeLine{01009     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a4932c6c099d4f68848d72736be6f321e}{TRop::Cubic1}};}
\DoxyCodeLine{01010     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01011   \textcolor{keywordflow}{case} TRenderSettings::Hann2\_FilterResampleQuality:}
\DoxyCodeLine{01012     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a8142bce9410b8ca2682b7f41d0fe1cda}{TRop::Hann2}};}
\DoxyCodeLine{01013     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01014   \textcolor{keywordflow}{case} TRenderSettings::Hann3\_FilterResampleQuality:}
\DoxyCodeLine{01015     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168ad1a6a213a56880e3be5f9df4632a903d}{TRop::Hann3}};}
\DoxyCodeLine{01016     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01017   \textcolor{keywordflow}{case} TRenderSettings::Hamming2\_FilterResampleQuality:}
\DoxyCodeLine{01018     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168ad74259f9d68bb2918533b70790355a6c}{TRop::Hamming2}};}
\DoxyCodeLine{01019     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01020   \textcolor{keywordflow}{case} TRenderSettings::Hamming3\_FilterResampleQuality:}
\DoxyCodeLine{01021     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168adbd720438a66e557e65a1419610d9ef9}{TRop::Hamming3}};}
\DoxyCodeLine{01022     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01023   \textcolor{keywordflow}{case} TRenderSettings::Lanczos2\_FilterResampleQuality:}
\DoxyCodeLine{01024     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a4e7a2bc406cecb691f8f0d5fa1d9d84c}{TRop::Lanczos2}};}
\DoxyCodeLine{01025     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01026   \textcolor{keywordflow}{case} TRenderSettings::Lanczos3\_FilterResampleQuality:}
\DoxyCodeLine{01027     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a5fef44f41eda4cbf63092b0634616095}{TRop::Lanczos3}};}
\DoxyCodeLine{01028     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01029   \textcolor{keywordflow}{case} TRenderSettings::Gauss\_FilterResampleQuality:}
\DoxyCodeLine{01030     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a6fd64688f6f661bd7c76dee932d048ca}{TRop::Gauss}};}
\DoxyCodeLine{01031     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01032   \textcolor{keywordflow}{case} TRenderSettings::ClosestPixel\_FilterResampleQuality:}
\DoxyCodeLine{01033     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a92694e20fb1c18f7987cda447d4553ff}{TRop::ClosestPixel}};}
\DoxyCodeLine{01034     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01035   \textcolor{keywordflow}{case} TRenderSettings::Bilinear\_FilterResampleQuality:}
\DoxyCodeLine{01036     qual = \mbox{\hyperlink{namespace_t_rop_a2780cb0189f5717b67b6aca3f5471168a152d46ac03e804c799ed08f703eeeb4e}{TRop::Bilinear}};}
\DoxyCodeLine{01037     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01038   \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01039     assert(\textcolor{keyword}{false});}
\DoxyCodeLine{01040   \}}
\DoxyCodeLine{01041 }
\DoxyCodeLine{01042   \mbox{\hyperlink{namespace_t_rop_a5e39bc748039afe42001ba44f2d2a073}{TRop::resample}}(dst\_ras, src\_ras, rasterAff, qual);}
\DoxyCodeLine{01043 }
\DoxyCodeLine{01044   \textcolor{keywordflow}{return} dst\_ras;}
\DoxyCodeLine{01045 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a5fccf6fecdbbb98455d33acbb582988d}\label{class_t_raster_fx_a5fccf6fecdbbb98455d33acbb582988d}} 
\index{TRasterFx@{TRasterFx}!compute@{compute}}
\index{compute@{compute}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{compute()}{compute()}}
{\footnotesize\ttfamily void TRaster\+Fx\+::compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



This method supplies the actual fx rendering code. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00799                                                      \{}
\DoxyCodeLine{00800   \textcolor{comment}{// If the render was aborted, avoid everything}}
\DoxyCodeLine{00801   \textcolor{comment}{// if(TRenderer::instance().isAborted(TRenderer::renderId()))}}
\DoxyCodeLine{00802   \textcolor{comment}{//  throw TException("{}Render canceled"{});}}
\DoxyCodeLine{00803 }
\DoxyCodeLine{00804   \textcolor{keywordflow}{if} (checkActiveTimeRegion() \&\& !getActiveTimeRegion().contains(frame)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00805 }
\DoxyCodeLine{00806   \textcolor{keywordflow}{if} (!getAttributes()-\/>isEnabled() || !m\_rasFxImp-\/>isEnabled()) \{}
\DoxyCodeLine{00807     \textcolor{keywordflow}{if} (getInputPortCount() == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00808 }
\DoxyCodeLine{00809     \mbox{\hyperlink{class_t_fx_port}{TFxPort}} *port = getInputPort(0);}
\DoxyCodeLine{00810 }
\DoxyCodeLine{00811     \textcolor{comment}{// la porta 0 non deve essere una porta di controllo}}
\DoxyCodeLine{00812     assert(port-\/>isaControlPort() == \textcolor{keyword}{false});}
\DoxyCodeLine{00813 }
\DoxyCodeLine{00814     \textcolor{keywordflow}{if} (port-\/>isConnected()) \{}
\DoxyCodeLine{00815       \mbox{\hyperlink{class_t_raster_fx_p}{TRasterFxP}}(port-\/>getFx())-\/>compute(tile, frame, info);}
\DoxyCodeLine{00816       \textcolor{keywordflow}{return};}
\DoxyCodeLine{00817     \}}
\DoxyCodeLine{00818 }
\DoxyCodeLine{00819     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00820   \}}
\DoxyCodeLine{00821 }
\DoxyCodeLine{00822   \textcolor{comment}{// If the input tile has a fractionary position, it is passed to the}}
\DoxyCodeLine{00823   \textcolor{comment}{// rendersettings' accumulated affine. At the same time, the integer part of}}
\DoxyCodeLine{00824   \textcolor{comment}{// such affine is transferred to the tile.}}
\DoxyCodeLine{00825   \mbox{\hyperlink{class_t_point_t}{TPoint}} intTilePos(tfloor(tile.m\_pos.x), tfloor(tile.m\_pos.y));}
\DoxyCodeLine{00826   \mbox{\hyperlink{class_t_point_t}{TPointD}} fracTilePos(tile.m\_pos.x -\/ intTilePos.x, tile.m\_pos.y -\/ intTilePos.y);}
\DoxyCodeLine{00827   \mbox{\hyperlink{class_t_point_t}{TPointD}} fracInfoTranslation(info.m\_affine.a13 -\/ fracTilePos.x,}
\DoxyCodeLine{00828                               info.m\_affine.a23 -\/ fracTilePos.y);}
\DoxyCodeLine{00829   \mbox{\hyperlink{class_t_point_t}{TPoint}} intInfoTranslation(tfloor(fracInfoTranslation.x),}
\DoxyCodeLine{00830                             tfloor(fracInfoTranslation.y));}
\DoxyCodeLine{00831   \mbox{\hyperlink{class_t_point_t}{TPointD}} newTilePos(intTilePos.x -\/ intInfoTranslation.x,}
\DoxyCodeLine{00832                      intTilePos.y -\/ intInfoTranslation.y);}
\DoxyCodeLine{00833   \textcolor{comment}{/*-\/-\/ 入力タイルの位置が、小数値を持っていた場合 -\/-\/*/}}
\DoxyCodeLine{00834   \textcolor{keywordflow}{if} (tile.m\_pos != newTilePos) \{}
\DoxyCodeLine{00835     \textcolor{comment}{/*-\/-\/ RenderSettingsのaffine行列に位置ずれを足しこむ -\/-\/*/}}
\DoxyCodeLine{00836     \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} newInfo(info);}
\DoxyCodeLine{00837     newInfo.m\_affine.a13 = fracInfoTranslation.x -\/ intInfoTranslation.x;}
\DoxyCodeLine{00838     newInfo.m\_affine.a23 = fracInfoTranslation.y -\/ intInfoTranslation.y;}
\DoxyCodeLine{00839     \textcolor{comment}{/*-\/-\/ タイルの位置は整数値にする -\/-\/*/}}
\DoxyCodeLine{00840     \mbox{\hyperlink{class_t_point_t}{TPointD}} oldPos(tile.m\_pos);}
\DoxyCodeLine{00841     tile.m\_pos = newTilePos;}
\DoxyCodeLine{00842 }
\DoxyCodeLine{00843     compute(tile, frame, newInfo);}
\DoxyCodeLine{00844 }
\DoxyCodeLine{00845     tile.m\_pos = oldPos;}
\DoxyCodeLine{00846     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00847   \}}
\DoxyCodeLine{00848 }
\DoxyCodeLine{00849   \textcolor{keywordtype}{bool} canHandleAffine =}
\DoxyCodeLine{00850       canHandle(info, frame) || (handledAffine(info, frame) == info.m\_affine);}
\DoxyCodeLine{00851   \textcolor{keywordflow}{if} (!info.m\_affine.isIdentity() \&\& !canHandleAffine) \{}
\DoxyCodeLine{00852     \mbox{\hyperlink{class_tr_fx}{TrFx}} *transformerFx = \textcolor{keyword}{new} \mbox{\hyperlink{class_tr_fx}{TrFx}};}
\DoxyCodeLine{00853     \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} locker(transformerFx);}
\DoxyCodeLine{00854     transformerFx-\/>setFx(\textcolor{keyword}{this});}
\DoxyCodeLine{00855     transformerFx-\/>compute(tile, frame, info);}
\DoxyCodeLine{00856     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00857   \}}
\DoxyCodeLine{00858 }
\DoxyCodeLine{00859   \textcolor{comment}{// Retrieve tile's geometry}}
\DoxyCodeLine{00860   \mbox{\hyperlink{class_t_rect_t}{TRectD}} tilePlacement = myConvert(tile.getRaster()-\/>getBounds()) + tile.m\_pos;}
\DoxyCodeLine{00861 }
\DoxyCodeLine{00862   \textcolor{comment}{// Build the fx result alias (in other words, its name)}}
\DoxyCodeLine{00863   std::string alias = getAlias(frame, info) + \textcolor{stringliteral}{"{}["{}} + ::traduce(info.m\_affine) +}
\DoxyCodeLine{00864                       \textcolor{stringliteral}{"{}]["{}} + std::to\_string(info.m\_bpp) +}
\DoxyCodeLine{00865                       \textcolor{stringliteral}{"{}]"{}};  \textcolor{comment}{// To be moved below}}
\DoxyCodeLine{00866 }
\DoxyCodeLine{00867   \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox;}
\DoxyCodeLine{00868   getBBox(frame, bbox, info);}
\DoxyCodeLine{00869   enlargeToI(bbox);}
\DoxyCodeLine{00870 }
\DoxyCodeLine{00871   \mbox{\hyperlink{class_t_rect_t}{TRectD}} interestingRect(tilePlacement * bbox);}
\DoxyCodeLine{00872   \textcolor{keywordflow}{if} (myIsEmpty(interestingRect)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00873 }
\DoxyCodeLine{00874   \textcolor{comment}{// Extract the interesting tile from requested one}}
\DoxyCodeLine{00875   \mbox{\hyperlink{class_t_tile}{TTile}} interestingTile;}
\DoxyCodeLine{00876   interestingTile.m\_pos = interestingRect.getP00();}
\DoxyCodeLine{00877   \mbox{\hyperlink{class_t_rect_t}{TRect}} interestingRectI(myConvert(interestingRect -\/ tilePlacement.getP00()));}
\DoxyCodeLine{00878   interestingTile.setRaster(tile.getRaster()-\/>extract(interestingRectI));}
\DoxyCodeLine{00879 }
\DoxyCodeLine{00880 \textcolor{preprocessor}{\#ifdef DIAGNOSTICS}}
\DoxyCodeLine{00881 }
\DoxyCodeLine{00882   \textcolor{comment}{// 1. Push fx name on call stack}}
\DoxyCodeLine{00883   QString fxName = QString::fromStdString(\mbox{\hyperlink{class_t_persist_aec66a1276b484a94a48e7e3e45be525e}{getDeclaration}}()-\/>getId());}
\DoxyCodeLine{00884 }
\DoxyCodeLine{00885   DIAGNOSTICS\_PUSH(\textcolor{stringliteral}{"{}FName"{}}, fxName);}
\DoxyCodeLine{00886   DIAGNOSTICS\_THRSET(\textcolor{stringliteral}{"{}FComputeTime"{}}, 0);}
\DoxyCodeLine{00887 }
\DoxyCodeLine{00888   \mbox{\hyperlink{class_t_stop_watch}{TStopWatch}} sw;}
\DoxyCodeLine{00889   sw.\mbox{\hyperlink{class_t_stop_watch_a81eefb8cd2dc776cc31799973be063a8}{start}}();}
\DoxyCodeLine{00890 }
\DoxyCodeLine{00891 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00892 }
\DoxyCodeLine{00893   \textcolor{comment}{// Invoke the fx-\/specific computation process}}
\DoxyCodeLine{00894   \mbox{\hyperlink{class_fx_resource_builder}{FxResourceBuilder}} rBuilder(alias, \textcolor{keyword}{this}, info, frame);}
\DoxyCodeLine{00895   rBuilder.build(interestingTile);}
\DoxyCodeLine{00896 }
\DoxyCodeLine{00897 \textcolor{preprocessor}{\#ifdef DIAGNOSTICS}}
\DoxyCodeLine{00898   sw.stop();}
\DoxyCodeLine{00899 }
\DoxyCodeLine{00900   QString countsStr(\textcolor{stringliteral}{"{}\#ftimes.txt | 4. "{}} + fxName + \textcolor{stringliteral}{"{} | 4. Calls count"{}});}
\DoxyCodeLine{00901   QString fxStr(\textcolor{stringliteral}{"{}fcum\_4. "{}} + fxName);}
\DoxyCodeLine{00902 }
\DoxyCodeLine{00903   \textcolor{keywordtype}{long} computeTime      = DIAGNOSTICS\_THRGET(\textcolor{stringliteral}{"{}FComputeTime"{}});}
\DoxyCodeLine{00904   \textcolor{keywordtype}{long} fxTime           = sw.\mbox{\hyperlink{class_t_stop_watch_a0c8ade9d86862151c7f151394c04b0f8}{getTotalTime}}();}
\DoxyCodeLine{00905   \textcolor{keywordtype}{long} fxCumulativeTime = DIAGNOSTICS\_GLOGET(fxStr);}
\DoxyCodeLine{00906   \textcolor{keywordtype}{long} count            = DIAGNOSTICS\_GET(countsStr);}
\DoxyCodeLine{00907 }
\DoxyCodeLine{00908   \textcolor{comment}{// 2. Add this time to fx time, and subtract it from parent time}}
\DoxyCodeLine{00909   DIAGNOSTICS\_GLOADD(fxStr, computeTime);}
\DoxyCodeLine{00910   DIAGNOSTICS\_ADD(countsStr, 1);}
\DoxyCodeLine{00911   DIAGNOSTICS\_SET(\textcolor{stringliteral}{"{}\#ftimes.txt | 4. "{}} + fxName + \textcolor{stringliteral}{"{} | 3. Mean time"{}},}
\DoxyCodeLine{00912                   (fxCumulativeTime + computeTime) / (count + 1));}
\DoxyCodeLine{00913 }
\DoxyCodeLine{00914   DIAGNOSTICS\_POP(\textcolor{stringliteral}{"{}FName"{}}, 1);}
\DoxyCodeLine{00915   QString parentFxName = DIAGNOSTICS\_STACKGET(\textcolor{stringliteral}{"{}FName"{}});}
\DoxyCodeLine{00916   \textcolor{keywordflow}{if} (!parentFxName.isEmpty())}
\DoxyCodeLine{00917     DIAGNOSTICS\_GLOADD(\textcolor{stringliteral}{"{}fcum\_4. "{}} + parentFxName, -\/fxTime);}
\DoxyCodeLine{00918 }
\DoxyCodeLine{00919   DIAGNOSTICS\_GLOADD(\textcolor{stringliteral}{"{}fcum\_03. Cached Fxs Retrieval"{}}, fxTime -\/ computeTime);}
\DoxyCodeLine{00920 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00921 }
\DoxyCodeLine{00922 \textcolor{preprocessor}{\#ifdef WRITEIMAGES}}
\DoxyCodeLine{00923   \textcolor{keyword}{static} \textcolor{keywordtype}{int} iCount = 0;}
\DoxyCodeLine{00924   QString qPath(\textcolor{stringliteral}{"{}C:\(\backslash\)\(\backslash\)butta\(\backslash\)\(\backslash\)image\_"{}} +}
\DoxyCodeLine{00925                 QString::number(++iCount).rightJustified(3, \textcolor{charliteral}{'0'}) + \textcolor{stringliteral}{"{}.tif"{}});}
\DoxyCodeLine{00926   TImageWriter::save(\mbox{\hyperlink{class_t_file_path}{TFilePath}}(qPath.toStdWString()), tile.getRaster());}
\DoxyCodeLine{00927 }
\DoxyCodeLine{00928   \textcolor{keywordflow}{if} (iCount >= 35) \textcolor{keywordtype}{int} aa = 1;}
\DoxyCodeLine{00929 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00930 }
\DoxyCodeLine{00931   \textcolor{comment}{/*}}
\DoxyCodeLine{00932 \textcolor{comment}{return;}}
\DoxyCodeLine{00933 \textcolor{comment}{}}
\DoxyCodeLine{00934 \textcolor{comment}{tryCanceled:}}
\DoxyCodeLine{00935 \textcolor{comment}{}}
\DoxyCodeLine{00936 \textcolor{comment}{//if(TRenderer::instance().isAborted(TRenderer::renderId()))}}
\DoxyCodeLine{00937 \textcolor{comment}{//  throw TException("{}Render canceled"{});}}
\DoxyCodeLine{00938 \textcolor{comment}{;}}
\DoxyCodeLine{00939 \textcolor{comment}{*/}}
\DoxyCodeLine{00940 \}}

\end{DoxyCode}


References \mbox{\hyperlink{class_t_persist_aec66a1276b484a94a48e7e3e45be525e}{TPersist\+::get\+Declaration()}}, \mbox{\hyperlink{l00293}{TStop\+Watch\+::get\+Total\+Time()}}, \mbox{\hyperlink{l00097}{TRender\+Settings\+::m\+\_\+affine}}, and \mbox{\hyperlink{l00105}{TStop\+Watch\+::start()}}.

\mbox{\Hypertarget{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}\label{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}} 
\index{TRasterFx@{TRasterFx}!doDryCompute@{doDryCompute}}
\index{doDryCompute@{doDryCompute}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{doDryCompute()}{doDryCompute()}}
{\footnotesize\ttfamily void TRaster\+Fx\+::do\+Dry\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}

Declares the computation scheme of this fx for rendering optimization purposes. This is an important function of the Toonz rendering API, and should be reimplemented with the necessary care. The Toonz rendering process makes use of this function to enact most of the optimization steps about the fx computation, in particular fx caching. A correct implementation of this method should follow these rules\+:  The invocation of child node computations should be faithfully reproduced.  TRaster\+Fx\+::compute and TRaster\+Fx\+::allocate\+And\+Compute calls have to be translated to TRaster\+Fx\+::dry\+Compute calls.  This fx is intended for precomputation stage, so the hard rendering code should be skipped here. By default, this method raises a dry\+Compute call to each input port in increasing order, using the TRaster\+Fx\+::transform method to identify the tiles to be passed on input precomputation. 

Reimplemented in \mbox{\hyperlink{class_t_image_combination_fx_a1402008b4b34379c20177ba5cbf359be}{TImage\+Combination\+Fx}}, \mbox{\hyperlink{class_in_fx_a4dfb8c38b89ebf150ea0d1a2df7afe90}{In\+Fx}}, \mbox{\hyperlink{class_out_fx_ae0eb486b5bfa2f4cc21f70080ab62030}{Out\+Fx}}, \mbox{\hyperlink{class_atop_fx_ace86be0cf7a4516f41457ae06d339ae8}{Atop\+Fx}}, \mbox{\hyperlink{class_t_macro_fx_af5ed549461420d9c6b6c116281456994}{TMacro\+Fx}}, \mbox{\hyperlink{class_plastic_deformer_fx_a9846057d45b92c1305acfa554fd3eeaa}{Plastic\+Deformer\+Fx}}, \mbox{\hyperlink{class_t_level_column_fx_afb64a21bd74502fa219e12d50f1f51e5}{TLevel\+Column\+Fx}}, \mbox{\hyperlink{class_backlit_fx_a5fcd467ce8dbc2d321b0f86332de2bc4}{Backlit\+Fx}}, \mbox{\hyperlink{class_body_high_light_fx_a9244d035d81eb7fdaf9e04bf991df774}{Body\+High\+Light\+Fx}}, \mbox{\hyperlink{class_corner_pin_fx_a718aa2730f22802c08124c443f71b824}{Corner\+Pin\+Fx}}, \mbox{\hyperlink{class_despeckle_fx_a1277ffe5f9573956530211c00439be77}{Despeckle\+Fx}}, \mbox{\hyperlink{class_external_palette_fx_a0ba8cad2b12692fb0679e7d0ffb68c86}{External\+Palette\+Fx}}, \mbox{\hyperlink{class_glow_fx_afea7656eaf477533b81f1c67ba96b60f}{Glow\+Fx}}, \mbox{\hyperlink{class_iwa___tiled_particles_fx_a97e3b24405d0a651f7b63515bc2e9d96}{Iwa\+\_\+\+Tiled\+Particles\+Fx}}, \mbox{\hyperlink{class_linear_wave_fx_a79e2e86e7daa5931fef7d91c4195386c}{Linear\+Wave\+Fx}}, \mbox{\hyperlink{class_local_blur_fx_a0fca6fd9a0346dd29afdf421b8fa5ad2}{Local\+Blur\+Fx}}, \mbox{\hyperlink{class_palette_filter_fx_a09c01c9a1597a19830464268d9a8d5c3}{Palette\+Filter\+Fx}}, \mbox{\hyperlink{class_particles_fx_a7fe4ea0a886ccc94e6b180a9abef51d0}{Particles\+Fx}}, \mbox{\hyperlink{class_random_wave_fx_aae67a9abbc50a8175fe2f189422e96c0}{Random\+Wave\+Fx}}, \mbox{\hyperlink{class_base_raylit_fx_af751b6df9ae5352455a0ee458db47516}{Base\+Raylit\+Fx}}, \mbox{\hyperlink{class_ripple_fx_ac15cec7644c8a627170e9e8273e75e93}{Ripple\+Fx}}, \mbox{\hyperlink{class_texture_fx_a5ca4e08cd18f74f761d6cc46fa012ae2}{Texture\+Fx}}, \mbox{\hyperlink{class_warp_fx_a76dc30bc33a687349207c8d33614e9c4}{Warp\+Fx}}, \mbox{\hyperlink{class_tr_fx_a364162db95c9bebd916b708d2c58e89f}{Tr\+Fx}}, \mbox{\hyperlink{class_time_shuffle_fx_a34d922f813a604b8929453c035f1f82c}{Time\+Shuffle\+Fx}}, \mbox{\hyperlink{class_art_contour_fx_a78949c24a0ffc0b0036e108d9cc59b19}{Art\+Contour\+Fx}}, \mbox{\hyperlink{class_erode_dilate_fx_ae26050bfdb5648014958dd587bdfaf41}{Erode\+Dilate\+Fx}}, \mbox{\hyperlink{class_free_distort_base_fx_ad8535b2f6559d5915f71b86c5ed14576}{Free\+Distort\+Base\+Fx}}, \mbox{\hyperlink{class_kaleido_fx_a5fc884b34ca8059b24f998658f9c9dc2}{Kaleido\+Fx}}, \mbox{\hyperlink{class_mosaic_fx_aad60e0d90a897f8fdadced230021e328}{Mosaic\+Fx}}, \mbox{\hyperlink{class_shader_fx_ab214f59f210598fc184655909ea1d42a}{Shader\+Fx}}, and \mbox{\hyperlink{class_t_blend_fore_back_raster_fx_a35fa961bd90b21f7484a71ff83519c71}{TBlend\+Fore\+Back\+Raster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00738                                                           \{}
\DoxyCodeLine{00739   \textcolor{keywordtype}{int} inputPortCount = getInputPortCount();}
\DoxyCodeLine{00740   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < inputPortCount; ++i) \{}
\DoxyCodeLine{00741     \mbox{\hyperlink{class_t_fx_port}{TFxPort}} *port = getInputPort(i);}
\DoxyCodeLine{00742     \textcolor{keywordflow}{if} (port-\/>isConnected()) \{}
\DoxyCodeLine{00743       \mbox{\hyperlink{class_t_rect_t}{TRectD}} rectOnInput;}
\DoxyCodeLine{00744       \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} infoOnInput;}
\DoxyCodeLine{00745 }
\DoxyCodeLine{00746       \mbox{\hyperlink{class_t_raster_fx_p}{TRasterFxP}} fx = port-\/>getFx();}
\DoxyCodeLine{00747       transform(frame, i, rect, info, rectOnInput, infoOnInput);}
\DoxyCodeLine{00748 }
\DoxyCodeLine{00749       \textcolor{keywordflow}{if} (!myIsEmpty(rectOnInput))}
\DoxyCodeLine{00750         fx-\/>dryCompute(rectOnInput, frame, infoOnInput);}
\DoxyCodeLine{00751     \}}
\DoxyCodeLine{00752   \}}
\DoxyCodeLine{00753 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a97f2968efddd99e15ea69175b81dc99c}\label{class_t_raster_fx_a97f2968efddd99e15ea69175b81dc99c}} 
\index{TRasterFx@{TRasterFx}!dryCompute@{dryCompute}}
\index{dryCompute@{dryCompute}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{dryCompute()}{dryCompute()}}
{\footnotesize\ttfamily void TRaster\+Fx\+::dry\+Compute (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00628                                                         \{}
\DoxyCodeLine{00629   \textcolor{keywordflow}{if} (checkActiveTimeRegion() \&\& !getActiveTimeRegion().contains(frame)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00630 }
\DoxyCodeLine{00631   \textcolor{keywordflow}{if} (!getAttributes()-\/>isEnabled() || !m\_rasFxImp-\/>isEnabled()) \{}
\DoxyCodeLine{00632     \textcolor{keywordflow}{if} (getInputPortCount() == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00633 }
\DoxyCodeLine{00634     \mbox{\hyperlink{class_t_fx_port}{TFxPort}} *port = getInputPort(getPreferredInputPort());}
\DoxyCodeLine{00635 }
\DoxyCodeLine{00636     \textcolor{keywordflow}{if} (port-\/>isConnected())}
\DoxyCodeLine{00637       \mbox{\hyperlink{class_t_raster_fx_p}{TRasterFxP}}(port-\/>getFx())-\/>dryCompute(rect, frame, info);}
\DoxyCodeLine{00638 }
\DoxyCodeLine{00639     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00640   \}}
\DoxyCodeLine{00641 }
\DoxyCodeLine{00642   \textcolor{comment}{// If the input tile has a fractionary position, it is passed to the}}
\DoxyCodeLine{00643   \textcolor{comment}{// rendersettings' accumulated affine.}}
\DoxyCodeLine{00644   \mbox{\hyperlink{class_t_point_t}{TPoint}} intTilePos(tfloor(rect.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}), tfloor(rect.y0));}
\DoxyCodeLine{00645   \mbox{\hyperlink{class_t_point_t}{TPointD}} fracTilePos(rect.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} -\/ intTilePos.x, rect.y0 -\/ intTilePos.y);}
\DoxyCodeLine{00646   \mbox{\hyperlink{class_t_point_t}{TPointD}} fracInfoTranslation(info.m\_affine.a13 -\/ fracTilePos.x,}
\DoxyCodeLine{00647                               info.m\_affine.a23 -\/ fracTilePos.y);}
\DoxyCodeLine{00648   \mbox{\hyperlink{class_t_point_t}{TPoint}} intInfoTranslation(tfloor(fracInfoTranslation.x),}
\DoxyCodeLine{00649                             tfloor(fracInfoTranslation.y));}
\DoxyCodeLine{00650   \mbox{\hyperlink{class_t_point_t}{TPointD}} newTilePos(intTilePos.x -\/ intInfoTranslation.x,}
\DoxyCodeLine{00651                      intTilePos.y -\/ intInfoTranslation.y);}
\DoxyCodeLine{00652 }
\DoxyCodeLine{00653   \textcolor{keywordflow}{if} (rect.getP00() != newTilePos) \{}
\DoxyCodeLine{00654     \mbox{\hyperlink{class_t_render_settings}{TRenderSettings}} newInfo(info);}
\DoxyCodeLine{00655     newInfo.m\_affine.a13 = fracInfoTranslation.x -\/ intInfoTranslation.x;}
\DoxyCodeLine{00656     newInfo.m\_affine.a23 = fracInfoTranslation.y -\/ intInfoTranslation.y;}
\DoxyCodeLine{00657 }
\DoxyCodeLine{00658     \mbox{\hyperlink{class_t_rect_t}{TRectD}} newRect(newTilePos, rect.getSize());}
\DoxyCodeLine{00659 }
\DoxyCodeLine{00660     dryCompute(newRect, frame, newInfo);}
\DoxyCodeLine{00661     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00662   \}}
\DoxyCodeLine{00663 }
\DoxyCodeLine{00664   \textcolor{comment}{// If the fx can't handle the whole affine passed with the TRenderSettings,}}
\DoxyCodeLine{00665   \textcolor{comment}{// the part}}
\DoxyCodeLine{00666   \textcolor{comment}{// of it that the fx can't handle is retained and applied by an affine}}
\DoxyCodeLine{00667   \textcolor{comment}{// transformer fx (TrFx)}}
\DoxyCodeLine{00668   \textcolor{comment}{// after the node has been computed.}}
\DoxyCodeLine{00669   \textcolor{keywordtype}{bool} canHandleAffine =}
\DoxyCodeLine{00670       canHandle(info, frame) || (handledAffine(info, frame) == info.m\_affine);}
\DoxyCodeLine{00671   \textcolor{keywordflow}{if} (!info.m\_affine.isIdentity() \&\& !canHandleAffine) \{}
\DoxyCodeLine{00672     \mbox{\hyperlink{class_tr_fx}{TrFx}} *transformerFx = \textcolor{keyword}{new} \mbox{\hyperlink{class_tr_fx}{TrFx}};}
\DoxyCodeLine{00673     \mbox{\hyperlink{class_t_smart_pointer_t}{TFxP}} locker(transformerFx);}
\DoxyCodeLine{00674     transformerFx-\/>setFx(\textcolor{keyword}{this});}
\DoxyCodeLine{00675     transformerFx-\/>dryCompute(rect, frame, info);}
\DoxyCodeLine{00676     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00677   \}}
\DoxyCodeLine{00678 }
\DoxyCodeLine{00679   std::string alias = getAlias(frame, info) + \textcolor{stringliteral}{"{}["{}} + ::traduce(info.m\_affine) +}
\DoxyCodeLine{00680                       \textcolor{stringliteral}{"{}]["{}} + std::to\_string(info.m\_bpp) + \textcolor{stringliteral}{"{}]"{}};}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682   \textcolor{keywordtype}{int} renderStatus =}
\DoxyCodeLine{00683       \mbox{\hyperlink{class_t_renderer_a93afee3c1ce8ff2b753a05fa0fe3dc9d}{TRenderer::instance}}().getRenderStatus(\mbox{\hyperlink{class_t_renderer_ab120ad7931abf8858c10459d66f4c659}{TRenderer::renderId}}());}
\DoxyCodeLine{00684   \mbox{\hyperlink{class_t_fx_cache_manager}{TFxCacheManager}} *cacheManager = TFxCacheManager::instance();}
\DoxyCodeLine{00685 }
\DoxyCodeLine{00686   \textcolor{keywordflow}{if} (renderStatus == TRenderer::FIRSTRUN) \{}
\DoxyCodeLine{00687     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox;}
\DoxyCodeLine{00688     \textcolor{comment}{// ret = getBBox... puo' darsi che l'enlarge del trFx (o naturale del bbox)}}
\DoxyCodeLine{00689     \textcolor{comment}{// faccia}}
\DoxyCodeLine{00690     \textcolor{comment}{// diventare TRectD() non vuoto!!}}
\DoxyCodeLine{00691     getBBox(frame, bbox, info);}
\DoxyCodeLine{00692     enlargeToI(bbox);}
\DoxyCodeLine{00693 }
\DoxyCodeLine{00694     \mbox{\hyperlink{class_t_rect_t}{TRectD}} interestingRect(rect * bbox);}
\DoxyCodeLine{00695     \textcolor{keywordflow}{if} (myIsEmpty(interestingRect)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00696 }
\DoxyCodeLine{00697     \textcolor{comment}{// Declare the tile to the tiles manager}}
\DoxyCodeLine{00698     ResourceBuilder::declareResource(alias, \textcolor{keyword}{this}, interestingRect, frame, info);}
\DoxyCodeLine{00699 }
\DoxyCodeLine{00700     \mbox{\hyperlink{class_t_raster_fx_a47ec31d2d4c3a066cd6744fb8c80edf2}{doDryCompute}}(interestingRect, frame, info);}
\DoxyCodeLine{00701   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00702     \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox;}
\DoxyCodeLine{00703     getBBox(frame, bbox, info);}
\DoxyCodeLine{00704     enlargeToI(bbox);}
\DoxyCodeLine{00705 }
\DoxyCodeLine{00706     \mbox{\hyperlink{class_t_rect_t}{TRectD}} interestingRect(rect * bbox);}
\DoxyCodeLine{00707     \textcolor{keywordflow}{if} (myIsEmpty(interestingRect)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00708 }
\DoxyCodeLine{00709     \textcolor{comment}{// Invoke the fx-\/specific simulation process}}
\DoxyCodeLine{00710     \mbox{\hyperlink{class_fx_resource_builder}{FxResourceBuilder}} rBuilder(alias, \textcolor{keyword}{this}, info, frame);}
\DoxyCodeLine{00711     rBuilder.simBuild(interestingRect);}
\DoxyCodeLine{00712   \}}
\DoxyCodeLine{00713 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_ad45ee43c85f31849ac94e6e40670370d}\label{class_t_raster_fx_ad45ee43c85f31849ac94e6e40670370d}} 
\index{TRasterFx@{TRasterFx}!enableCache@{enableCache}}
\index{enableCache@{enableCache}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{enableCache()}{enableCache()}}
{\footnotesize\ttfamily void TRaster\+Fx\+::enable\+Cache (\begin{DoxyParamCaption}\item[{bool}]{on }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{01053 \{ m\_rasFxImp-\/>enableCache(on); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a00bb0d71ea6fda6d9831208ae13b7b0c}\label{class_t_raster_fx_a00bb0d71ea6fda6d9831208ae13b7b0c}} 
\index{TRasterFx@{TRasterFx}!getAlias@{getAlias}}
\index{getAlias@{getAlias}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{getAlias()}{getAlias()}}
{\footnotesize\ttfamily std\+::string TRaster\+Fx\+::get\+Alias (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_fx}{TFx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00598                                                                    \{}
\DoxyCodeLine{00599   std::string alias = getFxType();}
\DoxyCodeLine{00600   alias += \textcolor{stringliteral}{"{}["{}};}
\DoxyCodeLine{00601 }
\DoxyCodeLine{00602   \textcolor{comment}{// alias degli effetti connessi alle porte di input separati da virgole}}
\DoxyCodeLine{00603   \textcolor{comment}{// una porta non connessa da luogo a un alias vuoto (stringa vuota)}}
\DoxyCodeLine{00604   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00605   \textcolor{keywordflow}{for} (i = 0; i < getInputPortCount(); i++) \{}
\DoxyCodeLine{00606     \mbox{\hyperlink{class_t_fx_port}{TFxPort}} *port = getInputPort(i);}
\DoxyCodeLine{00607     \textcolor{keywordflow}{if} (port-\/>isConnected()) \{}
\DoxyCodeLine{00608       \mbox{\hyperlink{class_t_raster_fx_p}{TRasterFxP}} ifx = port-\/>getFx();}
\DoxyCodeLine{00609       assert(ifx);}
\DoxyCodeLine{00610       alias += ifx-\/>getAlias(frame, info);}
\DoxyCodeLine{00611     \}}
\DoxyCodeLine{00612     alias += \textcolor{stringliteral}{"{},"{}};}
\DoxyCodeLine{00613   \}}
\DoxyCodeLine{00614 }
\DoxyCodeLine{00615   \textcolor{comment}{// alias dei valori dei parametri dell'effetto al frame dato}}
\DoxyCodeLine{00616   \textcolor{keywordflow}{for} (i = 0; i < getParams()-\/>getParamCount(); i++) \{}
\DoxyCodeLine{00617     \mbox{\hyperlink{class_t_param}{TParam}} *param = getParams()-\/>getParam(i);}
\DoxyCodeLine{00618     alias += param-\/>\mbox{\hyperlink{class_t_param_a8dd575552e05b174775f3c67fdf357cd}{getName}}() + \textcolor{stringliteral}{"{}="{}} + param-\/>\mbox{\hyperlink{class_t_param_a0b535b9277ba29bd778a67ba8efc91e6}{getValueAlias}}(frame, 3);}
\DoxyCodeLine{00619   \}}
\DoxyCodeLine{00620 }
\DoxyCodeLine{00621   alias += \textcolor{stringliteral}{"{}]"{}};}
\DoxyCodeLine{00622   \textcolor{keywordflow}{return} alias;}
\DoxyCodeLine{00623 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a22e94baf54def35e72cdae9dfad73704}\label{class_t_raster_fx_a22e94baf54def35e72cdae9dfad73704}} 
\index{TRasterFx@{TRasterFx}!getBBox@{getBBox}}
\index{getBBox@{getBBox}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{getBBox()}{getBBox()}}
{\footnotesize\ttfamily bool TRaster\+Fx\+::get\+BBox (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{b\+Box,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00542                                                      \{}
\DoxyCodeLine{00543   \textcolor{keywordtype}{bool} ret = doGetBBox(frame, bBox, info);}
\DoxyCodeLine{00544   bBox     = info.m\_affine * bBox;}
\DoxyCodeLine{00545   enlargeToI(bBox);}
\DoxyCodeLine{00546   \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{00547 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}\label{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}} 
\index{TRasterFx@{TRasterFx}!getMemoryRequirement@{getMemoryRequirement}}
\index{getMemoryRequirement@{getMemoryRequirement}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{getMemoryRequirement()}{getMemoryRequirement()}}
{\footnotesize\ttfamily int TRaster\+Fx\+::get\+Memory\+Requirement (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{double}]{frame,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

Specifies the approximate size (in Mega\+Bytes) of the maximum allocation instance that this fx will need to perform in order to render the passed input. This method should be reimplemented in order to make the Toonz rendering process aware of the use of big raster memory chunks, at least. Observe that the passed tile geometry is implicitly {\itshape  already allocated \texorpdfstring{$<$}{<}\textbackslash{}i\texorpdfstring{$>$}{>} for the fx output. ~\newline
The default implementation returns 0, assuming that the passed implicit memory size is passed below in node computation without further allocation of resources. Fxs can reimplement this to -\/1 to explicitly disable the Toonz\textquotesingle{}s smart memory handling. ~\newline
 ~\newline
\begin{DoxyNote}{Note}
The rendering process ensures that the passed render settings are {\itshape handled} by the fx before this function is invoked -\/ do not waste code for it. 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}{TRaster\+Fx\+::memory\+Size}} and TRaster\+Fx\+::can\+Handle methods. 
\end{DoxySeeAlso}
}

Reimplemented in \mbox{\hyperlink{class_backlit_fx_acfd611c0c6d5d011896cb11a6450f8e1}{Backlit\+Fx}}, \mbox{\hyperlink{class_t_image_combination_fx_aea24345305011eb1a73a0314083119e6}{TImage\+Combination\+Fx}}, \mbox{\hyperlink{class_in_fx_a6d443101b7dfd968589cd4b98cf5c053}{In\+Fx}}, \mbox{\hyperlink{class_out_fx_a175cd9c95e3b870c953eb86674bbf340}{Out\+Fx}}, \mbox{\hyperlink{class_atop_fx_a8722bc3760b30dcff43a5d0344afc440}{Atop\+Fx}}, \mbox{\hyperlink{class_t_level_column_fx_a9fdb94fea2a9dd488b5cf99120096e1e}{TLevel\+Column\+Fx}}, \mbox{\hyperlink{class_backlit_fx_a111f89a878a7f88f5ed585551acb2198}{Backlit\+Fx}}, \mbox{\hyperlink{class_blur_fx_ae09ff2ed379654983d1562893ee9e3b5}{Blur\+Fx}}, \mbox{\hyperlink{class_body_high_light_fx_a284a6fb488fff20b0baa62fdca799264}{Body\+High\+Light\+Fx}}, \mbox{\hyperlink{class_color_emboss_fx_a901919b272b07f70cbc4eb954dcbf417}{Color\+Emboss\+Fx}}, \mbox{\hyperlink{class_corner_pin_fx_a1e89a7a5bea8b11835242f92332b6c85}{Corner\+Pin\+Fx}}, \mbox{\hyperlink{class_emboss_fx_a92868100619fd4e6666e4aed2411ab79}{Emboss\+Fx}}, \mbox{\hyperlink{class_erode_dilate_fx_ada282fe1cb5b0a5f5192fc43f4e2a9ab}{Erode\+Dilate\+Fx}}, \mbox{\hyperlink{class_free_distort_base_fx_a3767c7c4eeca091bb9d5a4d32fcded03}{Free\+Distort\+Base\+Fx}}, \mbox{\hyperlink{class_glow_fx_a466926f826b5bebca54e45cb14e48888}{Glow\+Fx}}, \mbox{\hyperlink{classino__blur_a9dd25105ee0f515f0ffbb0a07aeb62be}{ino\+\_\+blur}}, \mbox{\hyperlink{classino__fog_a88015771eaab8a0a27248867133d62fe}{ino\+\_\+fog}}, \mbox{\hyperlink{classino__maxmin_abbc2c926c8e91a131a6fe56accc0b97d}{ino\+\_\+maxmin}}, \mbox{\hyperlink{classino__median_adbc55c3e7c028f808659c870a4270514}{ino\+\_\+median}}, \mbox{\hyperlink{classino__median__filter_a02ffc2e25babe652e0a2c5393777890e}{ino\+\_\+median\+\_\+filter}}, \mbox{\hyperlink{classino__motion__blur_ae26bc9475fb7b9e059e755a9a6ee46f1}{ino\+\_\+motion\+\_\+blur}}, \mbox{\hyperlink{classino__motion__wind_a53db6a66897a2da18ed6582bf6ce8551}{ino\+\_\+motion\+\_\+wind}}, \mbox{\hyperlink{classino__radial__blur_a653c66d240d64eb4376bfb066f78dc74}{ino\+\_\+radial\+\_\+blur}}, \mbox{\hyperlink{classino__spin__blur_a328b185ad7f699c3175ae9c65bdb5827}{ino\+\_\+spin\+\_\+blur}}, \mbox{\hyperlink{classino__warp__hv_ac55389dbf2ded41668838c310c3a3237}{ino\+\_\+warp\+\_\+hv}}, \mbox{\hyperlink{class_iwa___tile_fx_a87b38a301bb74db280e6bca6e161a7d8}{Iwa\+\_\+\+Tile\+Fx}}, \mbox{\hyperlink{class_kaleido_fx_ac2ecc7d6826b574cacdb2f8b4cb5cd88}{Kaleido\+Fx}}, \mbox{\hyperlink{class_linear_wave_fx_a36ae809ad2f281e42ccc789bc292cca7}{Linear\+Wave\+Fx}}, \mbox{\hyperlink{class_local_blur_fx_af16e61b79fb86f12c8bf10947b3fe383}{Local\+Blur\+Fx}}, \mbox{\hyperlink{class_local_transparency_fx_a348e83530abf0f439ee7111b6db97b1e}{Local\+Transparency\+Fx}}, \mbox{\hyperlink{class_mosaic_fx_aa972785e248c0a1a39ddb1a379679050}{Mosaic\+Fx}}, \mbox{\hyperlink{class_directional_blur_base_fx_a0cdf1a5d12768ba1cb17e9af183e47be}{Directional\+Blur\+Base\+Fx}}, \mbox{\hyperlink{class_nothing_fx_a3212c236f9c4d121f7c251e19a61ca77}{Nothing\+Fx}}, \mbox{\hyperlink{class_perlin_noise_fx_a511fca5d1bdb5a3d845d8e8f989ccec6}{Perlin\+Noise\+Fx}}, \mbox{\hyperlink{class_radial_blur_fx_a1d3b8dec71f020b3b17e455b8a5316e0}{Radial\+Blur\+Fx}}, \mbox{\hyperlink{class_random_wave_fx_ae1c9de1e3d1c47342732c6f56e4e2ecf}{Random\+Wave\+Fx}}, \mbox{\hyperlink{class_base_raylit_fx_adb02361005bd4ea3d63b6b6d088183e3}{Base\+Raylit\+Fx}}, \mbox{\hyperlink{class_ripple_fx_a65c7490575a586d6a481ef9782cd0854}{Ripple\+Fx}}, \mbox{\hyperlink{class_spin_blur_fx_a6cd41a9761c1c16c9bd96305c73cf8da}{Spin\+Blur\+Fx}}, \mbox{\hyperlink{class_texture_fx_a00ee46fbc1a6559137244b9da7cb93e5}{Texture\+Fx}}, \mbox{\hyperlink{class_tile_fx_a0a66e4b5ad39655cca54d028de2e6fe3}{Tile\+Fx}}, \mbox{\hyperlink{class_warp_fx_a8c86ae1851598e0502963b4fcd017103}{Warp\+Fx}}, \mbox{\hyperlink{class_tr_fx_a469db40f5b3df41f51c25095c956aa4d}{Tr\+Fx}}, \mbox{\hyperlink{class_raster_fx_plugin_host_a804999455cc1b3ba2134fd582e6f5768}{Raster\+Fx\+Plugin\+Host}}, and \mbox{\hyperlink{class_t_blend_fore_back_raster_fx_a970912a66678e6a31e508fa3b75d3e61}{TBlend\+Fore\+Back\+Raster\+Fx}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00591                                                                  \{}
\DoxyCodeLine{00592   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00593 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a418764f08eb81c99e2fe41ee5373bb00}\label{class_t_raster_fx_a418764f08eb81c99e2fe41ee5373bb00}} 
\index{TRasterFx@{TRasterFx}!getName@{getName}}
\index{getName@{getName}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{getName()}{getName()}}
{\footnotesize\ttfamily virtual string TRaster\+Fx\+::get\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [pure virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_fx}{TFx}}.

\mbox{\Hypertarget{class_t_raster_fx_a7c1e13b0ee0b12e8ec68635ff63929b8}\label{class_t_raster_fx_a7c1e13b0ee0b12e8ec68635ff63929b8}} 
\index{TRasterFx@{TRasterFx}!handledAffine@{handledAffine}}
\index{handledAffine@{handledAffine}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{handledAffine()}{handledAffine()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_affine}{TAffine}} TRaster\+Fx\+::handled\+Affine (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info,  }\item[{double}]{frame }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00531                                                                           \{}
\DoxyCodeLine{00532   \textcolor{keywordflow}{return} (info.m\_affine.a11 == info.m\_affine.a22 \&\& info.m\_affine.a12 == 0 \&\&}
\DoxyCodeLine{00533           info.m\_affine.a21 == 0 \&\& info.m\_affine.a13 == 0 \&\&}
\DoxyCodeLine{00534           info.m\_affine.a23 == 0)}
\DoxyCodeLine{00535              ? info.m\_affine}
\DoxyCodeLine{00536              : \mbox{\hyperlink{class_t_scale}{TScale}}(norm2(info.m\_affine));}
\DoxyCodeLine{00537 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a8722381a4f84859d2035378948a72d17}\label{class_t_raster_fx_a8722381a4f84859d2035378948a72d17}} 
\index{TRasterFx@{TRasterFx}!isCachable@{isCachable}}
\index{isCachable@{isCachable}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{isCachable()}{isCachable()}}
{\footnotesize\ttfamily virtual bool TRaster\+Fx\+::is\+Cachable (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00260 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{true}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_add147daf17a488a33642c56cdf0e8106}\label{class_t_raster_fx_add147daf17a488a33642c56cdf0e8106}} 
\index{TRasterFx@{TRasterFx}!isCacheEnabled@{isCacheEnabled}}
\index{isCacheEnabled@{isCacheEnabled}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{isCacheEnabled()}{isCacheEnabled()}}
{\footnotesize\ttfamily bool TRaster\+Fx\+::is\+Cache\+Enabled (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{01049 \{ \textcolor{keywordflow}{return} m\_rasFxImp-\/>m\_cacheEnabled; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a350ef810c2ded7b9b51136b73b360f92}\label{class_t_raster_fx_a350ef810c2ded7b9b51136b73b360f92}} 
\index{TRasterFx@{TRasterFx}!isPlugin@{isPlugin}}
\index{isPlugin@{isPlugin}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{isPlugin()}{isPlugin()}}
{\footnotesize\ttfamily virtual bool TRaster\+Fx\+::is\+Plugin (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00294 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}\label{class_t_raster_fx_a909a7afa779121b6caef5093da6447b0}} 
\index{TRasterFx@{TRasterFx}!memorySize@{memorySize}}
\index{memorySize@{memorySize}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{memorySize()}{memorySize()}}
{\footnotesize\ttfamily int TRaster\+Fx\+::memory\+Size (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect,  }\item[{int}]{bpp }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Returns the size (MB) of a tile with passed specs. It can be used to supply the \mbox{\hyperlink{class_t_raster_fx_af8eb991c9756f4fb2e48d9f96cbacfba}{TRaster\+Fx\+::get\+Memory\+Requirement}} info. If rect is empty, returns 0. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00560                                                      \{}
\DoxyCodeLine{00561   \textcolor{keywordflow}{if} (rect.x1 <= rect.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}} || rect.y1 <= rect.y0) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00562 }
\DoxyCodeLine{00563   \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})(rect.getLx() + 1) * (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})(rect.getLy() + 1) *}
\DoxyCodeLine{00564              (bpp >> 3) >>}
\DoxyCodeLine{00565          20;}
\DoxyCodeLine{00566 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.



Referenced by \mbox{\hyperlink{l00154}{Backlit\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00065}{TImage\+Combination\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00525}{In\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00593}{Out\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00672}{Atop\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00123}{Blur\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00527}{Body\+High\+Light\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00224}{Color\+Emboss\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00639}{Corner\+Pin\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00211}{Emboss\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00131}{Erode\+Dilate\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00799}{Free\+Distort\+Base\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00336}{Glow\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00073}{ino\+\_\+blur\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00073}{ino\+\_\+fog\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00083}{ino\+\_\+maxmin\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00073}{ino\+\_\+median\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00058}{ino\+\_\+median\+\_\+filter\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00124}{ino\+\_\+motion\+\_\+blur\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00152}{ino\+\_\+motion\+\_\+wind\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00121}{ino\+\_\+radial\+\_\+blur\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00105}{ino\+\_\+spin\+\_\+blur\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00090}{ino\+\_\+warp\+\_\+hv\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00162}{Iwa\+\_\+\+Tile\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00269}{Kaleido\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00225}{Linear\+Wave\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00419}{Local\+Blur\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00186}{Local\+Transparency\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00463}{Mosaic\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00570}{Directional\+Blur\+Base\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00250}{Perlin\+Noise\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00304}{Radial\+Blur\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00258}{Random\+Wave\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00112}{Base\+Raylit\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00246}{Ripple\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00345}{Spin\+Blur\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00260}{Texture\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00117}{Tile\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00209}{Warp\+Fx\+::get\+Memory\+Requirement()}}, \mbox{\hyperlink{l00301}{Tr\+Fx\+::get\+Memory\+Requirement()}}, and \mbox{\hyperlink{l00094}{TBlend\+Fore\+Back\+Raster\+Fx\+::get\+Memory\+Requirement()}}.

\mbox{\Hypertarget{class_t_raster_fx_a40efd762c22290b1f040e01c15e827f5}\label{class_t_raster_fx_a40efd762c22290b1f040e01c15e827f5}} 
\index{TRasterFx@{TRasterFx}!transform@{transform}}
\index{transform@{transform}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{transform()}{transform()}}
{\footnotesize\ttfamily void TRaster\+Fx\+::transform (\begin{DoxyParamCaption}\item[{double}]{frame,  }\item[{int}]{port,  }\item[{const \mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect\+On\+Output,  }\item[{const \mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info\+On\+Output,  }\item[{\mbox{\hyperlink{class_t_rect_t}{TRectD}} \&}]{rect\+On\+Input,  }\item[{\mbox{\hyperlink{class_t_render_settings}{TRender\+Settings}} \&}]{info\+On\+Input }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00553                                                                              \{}
\DoxyCodeLine{00554   rectOnInput = rectOnOutput;}
\DoxyCodeLine{00555   infoOnInput = infoOnOutput;}
\DoxyCodeLine{00556 \}}

\end{DoxyCode}


\doxysubsection{Friends And Related Function Documentation}
\mbox{\Hypertarget{class_t_raster_fx_ad4c398a7398254cce6efd752d45a2c30}\label{class_t_raster_fx_ad4c398a7398254cce6efd752d45a2c30}} 
\index{TRasterFx@{TRasterFx}!FxResourceBuilder@{FxResourceBuilder}}
\index{FxResourceBuilder@{FxResourceBuilder}!TRasterFx@{TRasterFx}}
\doxysubsubsection{\texorpdfstring{FxResourceBuilder}{FxResourceBuilder}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{class_fx_resource_builder}{Fx\+Resource\+Builder}}\hspace{0.3cm}{\ttfamily [friend]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tfxdef.\+h\item 
E\+:/opentoonz/toonz/sources/include/trasterfx.\+h\item 
E\+:/opentoonz/toonz/sources/tnzbase/trasterfx.\+cpp\end{DoxyCompactItemize}
