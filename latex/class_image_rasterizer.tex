\hypertarget{class_image_rasterizer}{}\doxysection{Image\+Rasterizer Class Reference}
\label{class_image_rasterizer}\index{ImageRasterizer@{ImageRasterizer}}
Inheritance diagram for Image\+Rasterizer\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_image_rasterizer}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_image_rasterizer_ab4b12b03168f51ea46841b089b4895d0}{is\+Image\+Compatible}} (int im\+Flags, void $\ast$ext\+Data) override
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{class_image_rasterizer_af732c68efc056ce07b406d54c76c5426}{get\+Info}} (\mbox{\hyperlink{class_t_image_info}{TImage\+Info}} \&info, int im\+Flags, void $\ast$ext\+Data) override
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \mbox{\hyperlink{class_image_rasterizer_a0071f9f6e68c94091336e92042a03e6c}{build}} (int im\+Flags, void $\ast$ext\+Data) override
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_image_rasterizer_ae0dade76a445c777a8a486c262f9e226}\label{class_image_rasterizer_ae0dade76a445c777a8a486c262f9e226}} 
\index{ImageRasterizer@{ImageRasterizer}!ImageRasterizer@{ImageRasterizer}}
\index{ImageRasterizer@{ImageRasterizer}!ImageRasterizer@{ImageRasterizer}}
\doxysubsubsection{\texorpdfstring{ImageRasterizer()}{ImageRasterizer()}}
{\footnotesize\ttfamily Image\+Rasterizer\+::\+Image\+Rasterizer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00087 \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_rasterizer_a1306c616f1085389ff9e08406904fb48}\label{class_image_rasterizer_a1306c616f1085389ff9e08406904fb48}} 
\index{ImageRasterizer@{ImageRasterizer}!````~ImageRasterizer@{$\sim$ImageRasterizer}}
\index{````~ImageRasterizer@{$\sim$ImageRasterizer}!ImageRasterizer@{ImageRasterizer}}
\doxysubsubsection{\texorpdfstring{$\sim$ImageRasterizer()}{~ImageRasterizer()}}
{\footnotesize\ttfamily Image\+Rasterizer\+::$\sim$\+Image\+Rasterizer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00088 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_image_rasterizer_a0071f9f6e68c94091336e92042a03e6c}\label{class_image_rasterizer_a0071f9f6e68c94091336e92042a03e6c}} 
\index{ImageRasterizer@{ImageRasterizer}!build@{build}}
\index{build@{build}!ImageRasterizer@{ImageRasterizer}}
\doxysubsubsection{\texorpdfstring{build()}{build()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} Image\+Rasterizer\+::build (\begin{DoxyParamCaption}\item[{int}]{im\+Flags,  }\item[{void $\ast$}]{ext\+Data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}

Builds the image as specified by the supplied control flags and external data. 

Implements \mbox{\hyperlink{class_image_builder_ac009ac3e258ce6f020d729987c40ec4c}{Image\+Builder}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00250                                                          \{}
\DoxyCodeLine{00251   assert(!(imFlags \&}
\DoxyCodeLine{00252            \string~(ImageManager::dontPutInCache | ImageManager::forceRebuild)));}
\DoxyCodeLine{00253 }
\DoxyCodeLine{00254   \mbox{\hyperlink{class_t_dimension_t}{TDimension}} d(10, 10);}
\DoxyCodeLine{00255   \mbox{\hyperlink{class_t_point_t}{TPoint}} off(0, 0);}
\DoxyCodeLine{00256 }
\DoxyCodeLine{00257   \textcolor{comment}{// Fetch image}}
\DoxyCodeLine{00258   assert(extData);}
\DoxyCodeLine{00259   \mbox{\hyperlink{struct_image_loader_1_1_build_ext_data}{ImageLoader::BuildExtData}} *data = (\mbox{\hyperlink{struct_image_loader_1_1_build_ext_data}{ImageLoader::BuildExtData}} *)extData;}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261   \textcolor{keyword}{const} std::string \&srcImgId = data-\/>\mbox{\hyperlink{struct_image_loader_1_1_build_ext_data_a7f49ea5b9a78fc465ff712eeabc7f4f0}{m\_sl}}-\/>getImageId(data-\/>\mbox{\hyperlink{struct_image_loader_1_1_build_ext_data_a20e6641a270ec24a687a734e9fb449c1}{m\_fid}});}
\DoxyCodeLine{00262 }
\DoxyCodeLine{00263   \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} img = ImageManager::instance()-\/>\mbox{\hyperlink{class_image_manager_a534298d4e7278e9e42764965e2389576}{getImage}}(srcImgId, imFlags, extData);}
\DoxyCodeLine{00264   \textcolor{keywordflow}{if} (img) \{}
\DoxyCodeLine{00265     \mbox{\hyperlink{class_t_vector_image_p}{TVectorImageP}} vi = img;}
\DoxyCodeLine{00266     \textcolor{keywordflow}{if} (vi) \{}
\DoxyCodeLine{00267       \mbox{\hyperlink{class_t_rect_t}{TRectD}} bbox = vi-\/>getBBox();}
\DoxyCodeLine{00268 }
\DoxyCodeLine{00269       d   = \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(tceil(bbox.getLx()) + 1, tceil(bbox.getLy()) + 1);}
\DoxyCodeLine{00270       off = \mbox{\hyperlink{class_t_point_t}{TPoint}}((\textcolor{keywordtype}{int})bbox.\mbox{\hyperlink{class_t_rect_t_ac008cbc625f50d8b3c180c8eb2594cdb}{x0}}, (\textcolor{keywordtype}{int})bbox.y0);}
\DoxyCodeLine{00271 }
\DoxyCodeLine{00272       \mbox{\hyperlink{class_t_palette}{TPalette}} *vpalette = vi-\/>getPalette();}
\DoxyCodeLine{00273       \mbox{\hyperlink{class_t_vector_render_data}{TVectorRenderData}} rd(\mbox{\hyperlink{class_t_translation}{TTranslation}}(-\/off.x, -\/off.y), \mbox{\hyperlink{class_t_rect_t}{TRect}}(\mbox{\hyperlink{class_t_point_t}{TPoint}}(0, 0), d),}
\DoxyCodeLine{00274                            vpalette, 0, \textcolor{keyword}{true}, \textcolor{keyword}{true});}
\DoxyCodeLine{00275 }
\DoxyCodeLine{00276       \textcolor{comment}{// this is too slow.}}
\DoxyCodeLine{00277       \{}
\DoxyCodeLine{00278         QSurfaceFormat format;}
\DoxyCodeLine{00279         format.setProfile(QSurfaceFormat::CompatibilityProfile);}
\DoxyCodeLine{00280 }
\DoxyCodeLine{00281         std::unique\_ptr<QOffscreenSurface> surface(\textcolor{keyword}{new} QOffscreenSurface());}
\DoxyCodeLine{00282         surface-\/>setFormat(format);}
\DoxyCodeLine{00283         surface-\/>create();}
\DoxyCodeLine{00284 }
\DoxyCodeLine{00285         \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras(d);}
\DoxyCodeLine{00286 }
\DoxyCodeLine{00287         glPushAttrib(GL\_ALL\_ATTRIB\_BITS);}
\DoxyCodeLine{00288         glMatrixMode(GL\_MODELVIEW), glPushMatrix();}
\DoxyCodeLine{00289         glMatrixMode(GL\_PROJECTION), glPushMatrix();}
\DoxyCodeLine{00290         \{}
\DoxyCodeLine{00291           std::unique\_ptr<QOpenGLFramebufferObject> fb(}
\DoxyCodeLine{00292               \textcolor{keyword}{new} QOpenGLFramebufferObject(d.lx, d.ly));}
\DoxyCodeLine{00293 }
\DoxyCodeLine{00294           fb-\/>bind();}
\DoxyCodeLine{00295 }
\DoxyCodeLine{00296           glViewport(0, 0, d.lx, d.ly);}
\DoxyCodeLine{00297           glClearColor(0, 0, 0, 0);}
\DoxyCodeLine{00298           glClear(GL\_COLOR\_BUFFER\_BIT);}
\DoxyCodeLine{00299 }
\DoxyCodeLine{00300           glMatrixMode(GL\_PROJECTION);}
\DoxyCodeLine{00301           glLoadIdentity();}
\DoxyCodeLine{00302           gluOrtho2D(0, d.lx, 0, d.ly);}
\DoxyCodeLine{00303 }
\DoxyCodeLine{00304           glMatrixMode(GL\_MODELVIEW);}
\DoxyCodeLine{00305           glLoadIdentity();}
\DoxyCodeLine{00306           glTranslatef(0.375, 0.375, 0.0);}
\DoxyCodeLine{00307 }
\DoxyCodeLine{00308           tglDraw(rd, vi.getPointer());}
\DoxyCodeLine{00309 }
\DoxyCodeLine{00310           glFlush();}
\DoxyCodeLine{00311 }
\DoxyCodeLine{00312           QImage img =}
\DoxyCodeLine{00313               fb-\/>toImage().scaled(QSize(d.lx, d.ly), Qt::IgnoreAspectRatio,}
\DoxyCodeLine{00314                                    Qt::SmoothTransformation);}
\DoxyCodeLine{00315 }
\DoxyCodeLine{00316           \textcolor{keywordtype}{int} wrap      = ras-\/>getLx() * \textcolor{keyword}{sizeof}(TPixel32);}
\DoxyCodeLine{00317           uchar *srcPix = img.bits();}
\DoxyCodeLine{00318           uchar *dstPix = ras-\/>getRawData() + wrap * (d.ly -\/ 1);}
\DoxyCodeLine{00319           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} y = 0; y < d.ly; y++) \{}
\DoxyCodeLine{00320             memcpy(dstPix, srcPix, wrap);}
\DoxyCodeLine{00321             dstPix -\/= wrap;}
\DoxyCodeLine{00322             srcPix += wrap;}
\DoxyCodeLine{00323           \}}
\DoxyCodeLine{00324           fb-\/>release();}
\DoxyCodeLine{00325         \}}
\DoxyCodeLine{00326         glMatrixMode(GL\_MODELVIEW), glPopMatrix();}
\DoxyCodeLine{00327         glMatrixMode(GL\_PROJECTION), glPopMatrix();}
\DoxyCodeLine{00328 }
\DoxyCodeLine{00329         glPopAttrib();}
\DoxyCodeLine{00330 }
\DoxyCodeLine{00331         \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} ri = \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}}(ras);}
\DoxyCodeLine{00332         ri-\/>setOffset(off + ras-\/>getCenter());}
\DoxyCodeLine{00333 }
\DoxyCodeLine{00334         assert(glGetError() == 0);}
\DoxyCodeLine{00335 }
\DoxyCodeLine{00336         \textcolor{keywordflow}{return} ri;}
\DoxyCodeLine{00337       \}}
\DoxyCodeLine{00338     \}}
\DoxyCodeLine{00339   \}}
\DoxyCodeLine{00340 }
\DoxyCodeLine{00341   \textcolor{comment}{// Error case: return a dummy image (is it really required?)}}
\DoxyCodeLine{00342 }
\DoxyCodeLine{00343   \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}} ras(d);}
\DoxyCodeLine{00344   ras-\/>fill(TPixel32(127, 0, 127, 127));}
\DoxyCodeLine{00345 }
\DoxyCodeLine{00346   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}}(ras);}
\DoxyCodeLine{00347 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00310}{Image\+Manager\+::get\+Image()}}, \mbox{\hyperlink{l00036}{Image\+Loader\+::\+Build\+Ext\+Data\+::m\+\_\+fid}}, \mbox{\hyperlink{l00034}{Image\+Loader\+::\+Build\+Ext\+Data\+::m\+\_\+sl}}, and \mbox{\hyperlink{l00557}{TRect\+T$<$ T $>$\+::x0}}.

\mbox{\Hypertarget{class_image_rasterizer_af732c68efc056ce07b406d54c76c5426}\label{class_image_rasterizer_af732c68efc056ce07b406d54c76c5426}} 
\index{ImageRasterizer@{ImageRasterizer}!getInfo@{getInfo}}
\index{getInfo@{getInfo}!ImageRasterizer@{ImageRasterizer}}
\doxysubsubsection{\texorpdfstring{getInfo()}{getInfo()}}
{\footnotesize\ttfamily bool Image\+Rasterizer\+::get\+Info (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_image_info}{TImage\+Info}} \&}]{info,  }\item[{int}]{im\+Flags,  }\item[{void $\ast$}]{ext\+Data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}

Returns the image infos as specified by the supplied control flags and external data. 

Implements \mbox{\hyperlink{class_image_builder_a16613d50918a7b59ba67ba8bc6dab8ff}{Image\+Builder}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00243                                                                           \{}
\DoxyCodeLine{00244   assert(\textcolor{keyword}{false});  \textcolor{comment}{// None should get these... in case, TODO}}
\DoxyCodeLine{00245   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00246 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_image_rasterizer_ab4b12b03168f51ea46841b089b4895d0}\label{class_image_rasterizer_ab4b12b03168f51ea46841b089b4895d0}} 
\index{ImageRasterizer@{ImageRasterizer}!isImageCompatible@{isImageCompatible}}
\index{isImageCompatible@{isImageCompatible}!ImageRasterizer@{ImageRasterizer}}
\doxysubsubsection{\texorpdfstring{isImageCompatible()}{isImageCompatible()}}
{\footnotesize\ttfamily bool Image\+Rasterizer\+::is\+Image\+Compatible (\begin{DoxyParamCaption}\item[{int}]{im\+Flags,  }\item[{void $\ast$}]{ext\+Data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Returns whether any currently cached image is compatible with requested specifications, Returning true prevents Image\+Builder\+::build() invocations, fetching the cached data instead. The default implementation returns true if m\+\_\+info has positive m\+\_\+lx and m\+\_\+ly. 

Reimplemented from \mbox{\hyperlink{class_image_builder_a23048fae4829baddc1869516df7f58ce}{Image\+Builder}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00090 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{true}; \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonzlib/imagebuilders.\+h\item 
E\+:/opentoonz/toonz/sources/toonzlib/imagebuilders.\+cpp\end{DoxyCompactItemize}
