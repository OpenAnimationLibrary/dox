\hypertarget{class_t_service}{}\doxysection{TService Class Reference}
\label{class_t_service}\index{TService@{TService}}
Inheritance diagram for TService\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_t_service}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_service_1_1_imp}{Imp}}
\end{DoxyCompactItemize}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Status} \{ \newline
{\bfseries Stopped} = 1
, {\bfseries Start\+Pending}
, {\bfseries Stop\+Pending}
, {\bfseries Running}
, \newline
{\bfseries Continue\+Pending}
, {\bfseries Pause\+Pending}
, {\bfseries Paused}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_service_ad3e210f34d081899163c976dabf4bf77}{TService}} (const std\+::string \&name, const std\+::string \&display\+Name)
\item 
void \mbox{\hyperlink{class_t_service_a8f067848ccd109b3296e8defb5ff8ad9}{set\+Status}} (Status status, long exit\+Code, long wait\+Hint)
\item 
std\+::string \mbox{\hyperlink{class_t_service_a57766a70801b63efcb9f0bbf96c8620a}{get\+Name}} () const
\item 
std\+::string \mbox{\hyperlink{class_t_service_a2414141e4c49be4cfe2c0b2cede354ed}{get\+Display\+Name}} () const
\item 
void \mbox{\hyperlink{class_t_service_a44dba7dac5d20ba85ec7c8eeae89e440}{run}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]}, bool console=false)
\item 
\mbox{\Hypertarget{class_t_service_a99233e525608dd6c5d79b75e397d7403}\label{class_t_service_a99233e525608dd6c5d79b75e397d7403}} 
virtual void {\bfseries on\+Start} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})=0
\item 
\mbox{\Hypertarget{class_t_service_a4d417d435981fbb033533f2a3e3387ad}\label{class_t_service_a4d417d435981fbb033533f2a3e3387ad}} 
virtual void {\bfseries on\+Stop} ()=0
\item 
bool \mbox{\hyperlink{class_t_service_ade9924fefa1088b1ebe512ce53db61fa}{is\+Running\+As\+Console\+App}} () const
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_service}{TService}} $\ast$ \mbox{\hyperlink{class_t_service_a85e8d39c43a3ebfc0c8a8f14b29c671c}{instance}} ()
\item 
static void \mbox{\hyperlink{class_t_service_a1ee95128f52d583342ea71fa025dca72}{start}} (const std\+::string \&name)
\item 
static void \mbox{\hyperlink{class_t_service_a454d7140d21fdaea825bda4c50f6368c}{stop}} (const std\+::string \&name)
\item 
static void \mbox{\hyperlink{class_t_service_a70597290a54aa941ee0f4f34061f2fa6}{install}} (const std\+::string \&name, const std\+::string \&display\+Name, const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&app\+Path)
\item 
static void \mbox{\hyperlink{class_t_service_af6ea884223e02e43a4d1ec51d494cf5b}{remove}} (const std\+::string \&name)
\item 
static void \mbox{\hyperlink{class_t_service_aeff993fac81e5cf415e0e72f602e7848}{add\+To\+Message\+Log}} (const std\+::string \&msg)
\item 
static void \mbox{\hyperlink{class_t_service_a59ecc6852f2e267a13cbbccf0ac97cad}{add\+To\+Message\+Log}} (const QString \&msg)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{class_t_service_ac1c12362d43528f60d18a9569b9ada1a}\label{class_t_service_ac1c12362d43528f60d18a9569b9ada1a}} 
\index{TService@{TService}!Status@{Status}}
\index{Status@{Status}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{Status}{Status}}
{\footnotesize\ttfamily enum TService\+::\+Status}


\begin{DoxyCode}{0}
\DoxyCodeLine{00048               \{}
\DoxyCodeLine{00049     Stopped = 1,}
\DoxyCodeLine{00050     StartPending,}
\DoxyCodeLine{00051     StopPending,}
\DoxyCodeLine{00052     Running,}
\DoxyCodeLine{00053     ContinuePending,}
\DoxyCodeLine{00054     PausePending,}
\DoxyCodeLine{00055     Paused}
\DoxyCodeLine{00056   \};}

\end{DoxyCode}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_service_ad3e210f34d081899163c976dabf4bf77}\label{class_t_service_ad3e210f34d081899163c976dabf4bf77}} 
\index{TService@{TService}!TService@{TService}}
\index{TService@{TService}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{TService()}{TService()}}
{\footnotesize\ttfamily TService\+::\+TService (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{name,  }\item[{const std\+::string \&}]{display\+Name }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00112     : m\_imp(\textcolor{keyword}{new} Imp) \{}
\DoxyCodeLine{00113   m\_imp-\/>m\_name        = name;}
\DoxyCodeLine{00114   m\_imp-\/>m\_displayName = displayName;}
\DoxyCodeLine{00115   m\_instance           = \textcolor{keyword}{this};}
\DoxyCodeLine{00116 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a9cea2ca1073c240c2b65eb177244e571}\label{class_t_service_a9cea2ca1073c240c2b65eb177244e571}} 
\index{TService@{TService}!````~TService@{$\sim$TService}}
\index{````~TService@{$\sim$TService}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{$\sim$TService()}{~TService()}}
{\footnotesize\ttfamily TService\+::$\sim$\+TService (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00120 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_service_a59ecc6852f2e267a13cbbccf0ac97cad}\label{class_t_service_a59ecc6852f2e267a13cbbccf0ac97cad}} 
\index{TService@{TService}!addToMessageLog@{addToMessageLog}}
\index{addToMessageLog@{addToMessageLog}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{addToMessageLog()}{addToMessageLog()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void TService\+::add\+To\+Message\+Log (\begin{DoxyParamCaption}\item[{const QString \&}]{msg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00499                                                  \{}
\DoxyCodeLine{00500   addToMessageLog(msg.toStdString());}
\DoxyCodeLine{00501 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_aeff993fac81e5cf415e0e72f602e7848}\label{class_t_service_aeff993fac81e5cf415e0e72f602e7848}} 
\index{TService@{TService}!addToMessageLog@{addToMessageLog}}
\index{addToMessageLog@{addToMessageLog}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{addToMessageLog()}{addToMessageLog()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void TService\+::add\+To\+Message\+Log (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{msg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00503                                                    \{}
\DoxyCodeLine{00504 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00505   TCHAR szMsg[256];}
\DoxyCodeLine{00506   HANDLE hEventSource;}
\DoxyCodeLine{00507   LPCTSTR lpszStrings[2];}
\DoxyCodeLine{00508 }
\DoxyCodeLine{00509   \textcolor{keywordflow}{if} (!TService::Imp::m\_console) \{}
\DoxyCodeLine{00510     TService::Imp::m\_dwErr = GetLastError();}
\DoxyCodeLine{00511 }
\DoxyCodeLine{00512     \textcolor{comment}{// Use event logging to log the error.}}
\DoxyCodeLine{00513     \textcolor{comment}{//}}
\DoxyCodeLine{00514     hEventSource =}
\DoxyCodeLine{00515         RegisterEventSource(NULL, TService::instance()-\/>getName().c\_str());}
\DoxyCodeLine{00516 }
\DoxyCodeLine{00517     \_stprintf(szMsg, TEXT(\textcolor{stringliteral}{"{}\%s error: \%d"{}}),}
\DoxyCodeLine{00518               TService::instance()-\/>getName().c\_str(), TService::Imp::m\_dwErr);}
\DoxyCodeLine{00519     lpszStrings[0] = szMsg;}
\DoxyCodeLine{00520     lpszStrings[1] = msg.c\_str();}
\DoxyCodeLine{00521 }
\DoxyCodeLine{00522     \textcolor{keywordflow}{if} (hEventSource != NULL) \{}
\DoxyCodeLine{00523       ReportEvent(hEventSource,         \textcolor{comment}{// handle of event source}}
\DoxyCodeLine{00524                   EVENTLOG\_ERROR\_TYPE,  \textcolor{comment}{// event type}}
\DoxyCodeLine{00525                   0,                    \textcolor{comment}{// event category}}
\DoxyCodeLine{00526                   0,                    \textcolor{comment}{// event ID}}
\DoxyCodeLine{00527                   NULL,                 \textcolor{comment}{// current user's SID}}
\DoxyCodeLine{00528                   2,                    \textcolor{comment}{// strings in lpszStrings}}
\DoxyCodeLine{00529                   0,                    \textcolor{comment}{// no bytes of raw data}}
\DoxyCodeLine{00530                   lpszStrings,          \textcolor{comment}{// array of error strings}}
\DoxyCodeLine{00531                   NULL);                \textcolor{comment}{// no raw data}}
\DoxyCodeLine{00532 }
\DoxyCodeLine{00533       (VOID) DeregisterEventSource(hEventSource);}
\DoxyCodeLine{00534     \}}
\DoxyCodeLine{00535   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00536     std::cout << msg.c\_str();}
\DoxyCodeLine{00537   \}}
\DoxyCodeLine{00538 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00539   \textcolor{keywordflow}{if} (!TService::Imp::m\_console) \{}
\DoxyCodeLine{00540     QString str(msg.c\_str());}
\DoxyCodeLine{00541     TSysLog::error(str);}
\DoxyCodeLine{00542   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00543     std::cout << msg.c\_str();}
\DoxyCodeLine{00544   \}}
\DoxyCodeLine{00545 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00546 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a2414141e4c49be4cfe2c0b2cede354ed}\label{class_t_service_a2414141e4c49be4cfe2c0b2cede354ed}} 
\index{TService@{TService}!getDisplayName@{getDisplayName}}
\index{getDisplayName@{getDisplayName}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{getDisplayName()}{getDisplayName()}}
{\footnotesize\ttfamily std\+::string TService\+::get\+Display\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00150 \{ \textcolor{keywordflow}{return} m\_imp-\/>m\_displayName; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a57766a70801b63efcb9f0bbf96c8620a}\label{class_t_service_a57766a70801b63efcb9f0bbf96c8620a}} 
\index{TService@{TService}!getName@{getName}}
\index{getName@{getName}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{getName()}{getName()}}
{\footnotesize\ttfamily std\+::string TService\+::get\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00146 \{ \textcolor{keywordflow}{return} m\_imp-\/>m\_name; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a70597290a54aa941ee0f4f34061f2fa6}\label{class_t_service_a70597290a54aa941ee0f4f34061f2fa6}} 
\index{TService@{TService}!install@{install}}
\index{install@{install}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{install()}{install()}}
{\footnotesize\ttfamily void TService\+::install (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{name,  }\item[{const std\+::string \&}]{display\+Name,  }\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{app\+Path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00404                                                  \{}
\DoxyCodeLine{00405 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00406   SC\_HANDLE schService;}
\DoxyCodeLine{00407   SC\_HANDLE schSCManager;}
\DoxyCodeLine{00408 }
\DoxyCodeLine{00409   schSCManager = OpenSCManager(NULL,  \textcolor{comment}{// machine (NULL == local)}}
\DoxyCodeLine{00410                                NULL,  \textcolor{comment}{// database (NULL == default)}}
\DoxyCodeLine{00411                                SC\_MANAGER\_ALL\_ACCESS);  \textcolor{comment}{// access required}}
\DoxyCodeLine{00412 }
\DoxyCodeLine{00413   \textcolor{keywordflow}{if} (schSCManager) \{}
\DoxyCodeLine{00414     schService = CreateService(}
\DoxyCodeLine{00415         schSCManager,                                  \textcolor{comment}{// SCManager database}}
\DoxyCodeLine{00416         name.c\_str(),                                  \textcolor{comment}{// name of service}}
\DoxyCodeLine{00417         displayName.c\_str(),                           \textcolor{comment}{// name to display}}
\DoxyCodeLine{00418         SERVICE\_ALL\_ACCESS,                            \textcolor{comment}{// desired access}}
\DoxyCodeLine{00419         SERVICE\_WIN32\_OWN\_PROCESS,                     \textcolor{comment}{// service type}}
\DoxyCodeLine{00420         SERVICE\_DEMAND\_START,                          \textcolor{comment}{// start type}}
\DoxyCodeLine{00421         SERVICE\_ERROR\_NORMAL,                          \textcolor{comment}{// error control type}}
\DoxyCodeLine{00422         ::to\_string(appPath.getWideString()).c\_str(),  \textcolor{comment}{// service's binary}}
\DoxyCodeLine{00423         NULL,                                          \textcolor{comment}{// no load ordering group}}
\DoxyCodeLine{00424         NULL,                                          \textcolor{comment}{// no tag identifier}}
\DoxyCodeLine{00425         TEXT(SZDEPENDENCIES),                          \textcolor{comment}{// dependencies}}
\DoxyCodeLine{00426         NULL,                                          \textcolor{comment}{// LocalSystem account}}
\DoxyCodeLine{00427         NULL);                                         \textcolor{comment}{// no password}}
\DoxyCodeLine{00428 }
\DoxyCodeLine{00429     \textcolor{keywordflow}{if} (schService) \{}
\DoxyCodeLine{00430       \_tprintf(TEXT(\textcolor{stringliteral}{"{}\%s installed.\(\backslash\)n"{}}), displayName.c\_str());}
\DoxyCodeLine{00431       CloseServiceHandle(schService);}
\DoxyCodeLine{00432     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00433       \_tprintf(TEXT(\textcolor{stringliteral}{"{}CreateService failed -\/ \%s\(\backslash\)n"{}}), getLastErrorText().c\_str());}
\DoxyCodeLine{00434     \}}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00436     CloseServiceHandle(schSCManager);}
\DoxyCodeLine{00437   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00438     \_tprintf(TEXT(\textcolor{stringliteral}{"{}OpenSCManager failed -\/ \%s\(\backslash\)n"{}}), getLastErrorText().c\_str());}
\DoxyCodeLine{00439 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00440 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a85e8d39c43a3ebfc0c8a8f14b29c671c}\label{class_t_service_a85e8d39c43a3ebfc0c8a8f14b29c671c}} 
\index{TService@{TService}!instance@{instance}}
\index{instance@{instance}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{instance()}{instance()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_service}{TService}} $\ast$ TService\+::instance (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00124 \{ \textcolor{keywordflow}{return} m\_instance; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_ade9924fefa1088b1ebe512ce53db61fa}\label{class_t_service_ade9924fefa1088b1ebe512ce53db61fa}} 
\index{TService@{TService}!isRunningAsConsoleApp@{isRunningAsConsoleApp}}
\index{isRunningAsConsoleApp@{isRunningAsConsoleApp}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{isRunningAsConsoleApp()}{isRunningAsConsoleApp()}}
{\footnotesize\ttfamily bool TService\+::is\+Running\+As\+Console\+App (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00399 \{ \textcolor{keywordflow}{return} m\_imp-\/>m\_console; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_af6ea884223e02e43a4d1ec51d494cf5b}\label{class_t_service_af6ea884223e02e43a4d1ec51d494cf5b}} 
\index{TService@{TService}!remove@{remove}}
\index{remove@{remove}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{remove()}{remove()}}
{\footnotesize\ttfamily void TService\+::remove (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00444                                            \{}
\DoxyCodeLine{00445 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00446   std::string displayName = name;}
\DoxyCodeLine{00447 }
\DoxyCodeLine{00448   SC\_HANDLE schService;}
\DoxyCodeLine{00449   SC\_HANDLE schSCManager;}
\DoxyCodeLine{00450 }
\DoxyCodeLine{00451   schSCManager = OpenSCManager(NULL,  \textcolor{comment}{// machine (NULL == local)}}
\DoxyCodeLine{00452                                NULL,  \textcolor{comment}{// database (NULL == default)}}
\DoxyCodeLine{00453                                SC\_MANAGER\_ALL\_ACCESS);  \textcolor{comment}{// access required}}
\DoxyCodeLine{00454 }
\DoxyCodeLine{00455   \textcolor{keywordflow}{if} (schSCManager) \{}
\DoxyCodeLine{00456     schService = OpenService(schSCManager, name.c\_str(), SERVICE\_ALL\_ACCESS);}
\DoxyCodeLine{00457 }
\DoxyCodeLine{00458     \textcolor{keywordflow}{if} (schService) \{}
\DoxyCodeLine{00459       SERVICE\_STATUS ssStatus;  \textcolor{comment}{// current status of the service}}
\DoxyCodeLine{00460 }
\DoxyCodeLine{00461       \textcolor{comment}{// try to stop the service}}
\DoxyCodeLine{00462       \textcolor{keywordflow}{if} (ControlService(schService, SERVICE\_CONTROL\_STOP, \&ssStatus)) \{}
\DoxyCodeLine{00463         \_tprintf(TEXT(\textcolor{stringliteral}{"{}Stopping \%s."{}}), displayName.c\_str());}
\DoxyCodeLine{00464         Sleep(1000);}
\DoxyCodeLine{00465 }
\DoxyCodeLine{00466         \textcolor{keywordflow}{while} (QueryServiceStatus(schService, \&ssStatus)) \{}
\DoxyCodeLine{00467           \textcolor{keywordflow}{if} (ssStatus.dwCurrentState == SERVICE\_STOP\_PENDING) \{}
\DoxyCodeLine{00468             \_tprintf(TEXT(\textcolor{stringliteral}{"{}."{}}));}
\DoxyCodeLine{00469             Sleep(1000);}
\DoxyCodeLine{00470           \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00471             \textcolor{keywordflow}{break};}
\DoxyCodeLine{00472         \}}
\DoxyCodeLine{00473 }
\DoxyCodeLine{00474         \textcolor{keywordflow}{if} (ssStatus.dwCurrentState == SERVICE\_STOPPED)}
\DoxyCodeLine{00475           \_tprintf(TEXT(\textcolor{stringliteral}{"{}\(\backslash\)n\%s stopped.\(\backslash\)n"{}}), displayName.c\_str());}
\DoxyCodeLine{00476         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00477           \_tprintf(TEXT(\textcolor{stringliteral}{"{}\(\backslash\)n\%s failed to stop.\(\backslash\)n"{}}), displayName.c\_str());}
\DoxyCodeLine{00478       \}}
\DoxyCodeLine{00479 }
\DoxyCodeLine{00480       \textcolor{comment}{// now remove the service}}
\DoxyCodeLine{00481       \textcolor{keywordflow}{if} (DeleteService(schService))}
\DoxyCodeLine{00482         \_tprintf(TEXT(\textcolor{stringliteral}{"{}\%s removed.\(\backslash\)n"{}}), displayName.c\_str());}
\DoxyCodeLine{00483       \textcolor{keywordflow}{else}}
\DoxyCodeLine{00484         \_tprintf(TEXT(\textcolor{stringliteral}{"{}DeleteService failed -\/ \%s\(\backslash\)n"{}}),}
\DoxyCodeLine{00485                  getLastErrorText().c\_str());}
\DoxyCodeLine{00486 }
\DoxyCodeLine{00487       CloseServiceHandle(schService);}
\DoxyCodeLine{00488     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00489       \_tprintf(TEXT(\textcolor{stringliteral}{"{}OpenService failed -\/ \%s\(\backslash\)n"{}}), getLastErrorText().c\_str());}
\DoxyCodeLine{00490 }
\DoxyCodeLine{00491     CloseServiceHandle(schSCManager);}
\DoxyCodeLine{00492   \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00493     \_tprintf(TEXT(\textcolor{stringliteral}{"{}OpenSCManager failed -\/ \%s\(\backslash\)n"{}}), getLastErrorText().c\_str());}
\DoxyCodeLine{00494 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00495 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a44dba7dac5d20ba85ec7c8eeae89e440}\label{class_t_service_a44dba7dac5d20ba85ec7c8eeae89e440}} 
\index{TService@{TService}!run@{run}}
\index{run@{run}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{run()}{run()}}
{\footnotesize\ttfamily void TService\+::run (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]},  }\item[{bool}]{console = {\ttfamily false} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00353                                                        \{}
\DoxyCodeLine{00354   m\_imp-\/>m\_console = console;}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00356 \textcolor{comment}{/*}}
\DoxyCodeLine{00357 \textcolor{comment}{\#ifdef \_DEBUG}}
\DoxyCodeLine{00358 \textcolor{comment}{  DebugBreak();}}
\DoxyCodeLine{00359 \textcolor{comment}{\#endif}}
\DoxyCodeLine{00360 \textcolor{comment}{*/}}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00363   \textcolor{keywordflow}{if} (console) \{}
\DoxyCodeLine{00364     \_tprintf(TEXT(\textcolor{stringliteral}{"{}Starting \%s.\(\backslash\)n"{}}),}
\DoxyCodeLine{00365              TService::instance()-\/>getDisplayName().c\_str());}
\DoxyCodeLine{00366 }
\DoxyCodeLine{00367     SetConsoleCtrlHandler(TService::Imp::controlHandler, TRUE);}
\DoxyCodeLine{00368     TService::instance()-\/>onStart(argc, argv);}
\DoxyCodeLine{00369   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00370     SERVICE\_TABLE\_ENTRY dispatchTable[2];}
\DoxyCodeLine{00371 }
\DoxyCodeLine{00372     std::string name = TService::instance()-\/>getName().c\_str();}
\DoxyCodeLine{00373 }
\DoxyCodeLine{00374     dispatchTable[0].lpServiceName = (\textcolor{keywordtype}{char} *)name.c\_str();}
\DoxyCodeLine{00375     dispatchTable[0].lpServiceProc =}
\DoxyCodeLine{00376         (LPSERVICE\_MAIN\_FUNCTION)TService::Imp::serviceMain;}
\DoxyCodeLine{00377 }
\DoxyCodeLine{00378     dispatchTable[1].lpServiceName = NULL;}
\DoxyCodeLine{00379     dispatchTable[1].lpServiceProc = NULL;}
\DoxyCodeLine{00380 }
\DoxyCodeLine{00381     \textcolor{keywordflow}{if} (!StartServiceCtrlDispatcher(dispatchTable))}
\DoxyCodeLine{00382       TService::addToMessageLog(QString(TEXT(\textcolor{stringliteral}{"{}Service start failed."{}})));}
\DoxyCodeLine{00383   \}}
\DoxyCodeLine{00384 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00385   TService::instance()-\/>onStart(argc, argv);}
\DoxyCodeLine{00386 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00387 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a8f067848ccd109b3296e8defb5ff8ad9}\label{class_t_service_a8f067848ccd109b3296e8defb5ff8ad9}} 
\index{TService@{TService}!setStatus@{setStatus}}
\index{setStatus@{setStatus}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{setStatus()}{setStatus()}}
{\footnotesize\ttfamily void TService\+::set\+Status (\begin{DoxyParamCaption}\item[{Status}]{status,  }\item[{long}]{exit\+Code,  }\item[{long}]{wait\+Hint }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00132                                                                     \{}
\DoxyCodeLine{00133 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{00134   \textcolor{keywordflow}{if} (!isRunningAsConsoleApp())}
\DoxyCodeLine{00135     TService::Imp::reportStatusToSCMgr(status, exitCode, waitHint);}
\DoxyCodeLine{00136   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00137     \textcolor{keywordflow}{if} (status == Stopped) exit(1);}
\DoxyCodeLine{00138   \}}
\DoxyCodeLine{00139 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00140   \textcolor{keywordflow}{if} (status == Stopped) exit(1);}
\DoxyCodeLine{00141 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00142 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a1ee95128f52d583342ea71fa025dca72}\label{class_t_service_a1ee95128f52d583342ea71fa025dca72}} 
\index{TService@{TService}!start@{start}}
\index{start@{start}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{start()}{start()}}
{\footnotesize\ttfamily void TService\+::start (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00391 \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_service_a454d7140d21fdaea825bda4c50f6368c}\label{class_t_service_a454d7140d21fdaea825bda4c50f6368c}} 
\index{TService@{TService}!stop@{stop}}
\index{stop@{stop}!TService@{TService}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily void TService\+::stop (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00395 \{\}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/toonzfarm/include/service.\+h\item 
E\+:/opentoonz/toonz/sources/toonzfarm/tfarm/service.\+cpp\end{DoxyCompactItemize}
