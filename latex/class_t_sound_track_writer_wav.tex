\hypertarget{class_t_sound_track_writer_wav}{}\doxysection{TSound\+Track\+Writer\+Wav Class Reference}
\label{class_t_sound_track_writer_wav}\index{TSoundTrackWriterWav@{TSoundTrackWriterWav}}


{\ttfamily \#include $<$tsio\+\_\+wav.\+h$>$}

Inheritance diagram for TSound\+Track\+Writer\+Wav\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_sound_track_writer_wav}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_sound_track_writer_wav_a2755eb90f4f4bc1cb0a928fbc264847a}{TSound\+Track\+Writer\+Wav}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\item 
bool \mbox{\hyperlink{class_t_sound_track_writer_wav_a1cf94b9ccc05db3620b4124c471a1ab7}{save}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \&) override
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_sound_track_writer}{TSound\+Track\+Writer}} $\ast$ \mbox{\hyperlink{class_t_sound_track_writer_wav_a3efd5d3f10be8ad0591d98e22169436f}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
The class \mbox{\hyperlink{class_t_sound_track_writer_wav}{TSound\+Track\+Writer\+Wav}} writes audio file having .wav extension 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_sound_track_writer_wav_a2755eb90f4f4bc1cb0a928fbc264847a}\label{class_t_sound_track_writer_wav_a2755eb90f4f4bc1cb0a928fbc264847a}} 
\index{TSoundTrackWriterWav@{TSoundTrackWriterWav}!TSoundTrackWriterWav@{TSoundTrackWriterWav}}
\index{TSoundTrackWriterWav@{TSoundTrackWriterWav}!TSoundTrackWriterWav@{TSoundTrackWriterWav}}
\doxysubsubsection{\texorpdfstring{TSoundTrackWriterWav()}{TSoundTrackWriterWav()}}
{\footnotesize\ttfamily TSound\+Track\+Writer\+Wav\+::\+TSound\+Track\+Writer\+Wav (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00328     : \mbox{\hyperlink{class_t_sound_track_writer}{TSoundTrackWriter}}(fp) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_track_writer_wav_acdc959c9f0fad837b611da605c62650a}\label{class_t_sound_track_writer_wav_acdc959c9f0fad837b611da605c62650a}} 
\index{TSoundTrackWriterWav@{TSoundTrackWriterWav}!````~TSoundTrackWriterWav@{$\sim$TSoundTrackWriterWav}}
\index{````~TSoundTrackWriterWav@{$\sim$TSoundTrackWriterWav}!TSoundTrackWriterWav@{TSoundTrackWriterWav}}
\doxysubsubsection{\texorpdfstring{$\sim$TSoundTrackWriterWav()}{~TSoundTrackWriterWav()}}
{\footnotesize\ttfamily TSound\+Track\+Writer\+Wav\+::$\sim$\+TSound\+Track\+Writer\+Wav (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00041 \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_sound_track_writer_wav_a3efd5d3f10be8ad0591d98e22169436f}\label{class_t_sound_track_writer_wav_a3efd5d3f10be8ad0591d98e22169436f}} 
\index{TSoundTrackWriterWav@{TSoundTrackWriterWav}!create@{create}}
\index{create@{create}!TSoundTrackWriterWav@{TSoundTrackWriterWav}}
\doxysubsubsection{\texorpdfstring{create()}{create()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_sound_track_writer}{TSound\+Track\+Writer}} $\ast$ TSound\+Track\+Writer\+Wav\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}

Returns a soundtrack writer able to write .wav audio files 
\begin{DoxyCode}{0}
\DoxyCodeLine{00052                                                         \{}
\DoxyCodeLine{00053     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_sound_track_writer_wav}{TSoundTrackWriterWav}}(fp);}
\DoxyCodeLine{00054   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_sound_track_writer_wav_a1cf94b9ccc05db3620b4124c471a1ab7}\label{class_t_sound_track_writer_wav_a1cf94b9ccc05db3620b4124c471a1ab7}} 
\index{TSoundTrackWriterWav@{TSoundTrackWriterWav}!save@{save}}
\index{save@{save}!TSoundTrackWriterWav@{TSoundTrackWriterWav}}
\doxysubsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily bool TSound\+Track\+Writer\+Wav\+::save (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TSound\+TrackP}} \&}]{sndtrack }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Saves the information of the soundtrack in .wav audio file whose path has been specified in the constructor. 

Implements \mbox{\hyperlink{class_t_sound_track_writer}{TSound\+Track\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00332                                                             \{}
\DoxyCodeLine{00333   \textcolor{keywordflow}{if} (!sndtrack)}
\DoxyCodeLine{00334     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(L\textcolor{stringliteral}{"{}Unable to save the soundtrack: "{}} +}
\DoxyCodeLine{00335                      m\_path.getWideString());}
\DoxyCodeLine{00336 }
\DoxyCodeLine{00337   \textcolor{keywordflow}{if} (sndtrack-\/>getBitPerSample() == 8 \&\& sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_a4c990666e5bd98da0da09eeb5b4f13dd}{isSampleSigned}}())}
\DoxyCodeLine{00338     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(\textcolor{stringliteral}{"{}The format (8 bit signed) is incompatible with WAV file"{}});}
\DoxyCodeLine{00339 }
\DoxyCodeLine{00340   TINT32 soundDataLength =}
\DoxyCodeLine{00341       (TINT32)(sndtrack-\/>getSampleCount() * (sndtrack-\/>getBitPerSample() / 8) *}
\DoxyCodeLine{00342                sndtrack-\/>getChannelCount() \textcolor{comment}{/*sndtrack-\/>getSampleSize()*/});}
\DoxyCodeLine{00343 }
\DoxyCodeLine{00344   TINT32 RIFFChunkLength =}
\DoxyCodeLine{00345       TFMTChunk::LENGTH + TWAVChunk::HDR\_LENGTH + soundDataLength;}
\DoxyCodeLine{00346 }
\DoxyCodeLine{00347   \mbox{\hyperlink{class_t_file_status}{TFileStatus}} fs(m\_path);}
\DoxyCodeLine{00348   \textcolor{keywordflow}{if} (fs.doesExist() \&\& !fs.isWritable())}
\DoxyCodeLine{00349     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_exception}{TException}}(L\textcolor{stringliteral}{"{}Unable to save the soundtrack: "{}} +}
\DoxyCodeLine{00350                      m\_path.getWideString() + L\textcolor{stringliteral}{"{} is read-\/only"{}});}
\DoxyCodeLine{00351 }
\DoxyCodeLine{00352   \mbox{\hyperlink{class_tofstream}{Tofstream}} os(m\_path);}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354   \mbox{\hyperlink{class_t_f_m_t_chunk}{TFMTChunk}} fmtChunk(16);}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00356   fmtChunk.m\_encodingType      = 1;  \textcolor{comment}{// PCM}}
\DoxyCodeLine{00357   fmtChunk.m\_chans             = sndtrack-\/>getChannelCount();}
\DoxyCodeLine{00358   fmtChunk.m\_sampleRate        = sndtrack-\/>getSampleRate();}
\DoxyCodeLine{00359   fmtChunk.m\_avgBytesPerSecond = (sndtrack-\/>getBitPerSample() / 8) *}
\DoxyCodeLine{00360                                  fmtChunk.m\_chans * sndtrack-\/>getSampleRate();}
\DoxyCodeLine{00361   \textcolor{comment}{// sndtrack-\/>getSampleSize()*sndtrack-\/>getSampleRate();}}
\DoxyCodeLine{00362   fmtChunk.m\_bytesPerSample = (sndtrack-\/>getBitPerSample() / 8) *}
\DoxyCodeLine{00363                               fmtChunk.m\_chans;  \textcolor{comment}{// sndtrack-\/>getSampleSize();}}
\DoxyCodeLine{00364   fmtChunk.m\_bitPerSample = sndtrack-\/>getBitPerSample();}
\DoxyCodeLine{00365 }
\DoxyCodeLine{00366   \mbox{\hyperlink{class_t_d_a_t_a_chunk}{TDATAChunk}} dataChunk(soundDataLength);}
\DoxyCodeLine{00367 }
\DoxyCodeLine{00368   std::unique\_ptr<UCHAR[]> waveData(\textcolor{keyword}{new} UCHAR[soundDataLength]);}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370   \textcolor{keywordflow}{if} (!TNZ\_LITTLE\_ENDIAN) RIFFChunkLength = swapTINT32(RIFFChunkLength);}
\DoxyCodeLine{00371 }
\DoxyCodeLine{00372 \textcolor{comment}{// era if defined(MACOSX)}}
\DoxyCodeLine{00373 \textcolor{preprocessor}{\#if (!TNZ\_LITTLE\_ENDIAN)}}
\DoxyCodeLine{00374   \{}
\DoxyCodeLine{00375     \textcolor{keywordflow}{if} (fmtChunk.m\_bitPerSample == 8)}
\DoxyCodeLine{00376       memcpy((\textcolor{keywordtype}{void} *)waveData.get(), (\textcolor{keywordtype}{void} *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(), soundDataLength);}
\DoxyCodeLine{00377     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (fmtChunk.m\_bitPerSample == 16) \{}
\DoxyCodeLine{00378       swapAndCopySamples((\textcolor{keywordtype}{short} *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(), (\textcolor{keywordtype}{short} *)waveData.get(),}
\DoxyCodeLine{00379                          sndtrack-\/>getSampleCount() * fmtChunk.m\_chans);}
\DoxyCodeLine{00380     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (fmtChunk.m\_bitPerSample == 24) \{  \textcolor{comment}{// swap e togliere quarto byte}}
\DoxyCodeLine{00381       UCHAR *begin = (UCHAR *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00382       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)sndtrack-\/>getSampleCount() * fmtChunk.m\_chans;}
\DoxyCodeLine{00383            ++i) \{}
\DoxyCodeLine{00384         *(waveData.get() + 3 * i)     = *(begin + 4 * i + 3);}
\DoxyCodeLine{00385         *(waveData.get() + 3 * i + 1) = *(begin + 4 * i + 2);}
\DoxyCodeLine{00386         *(waveData.get() + 3 * i + 2) = *(begin + 4 * i + 1);}
\DoxyCodeLine{00387       \}}
\DoxyCodeLine{00388     \}}
\DoxyCodeLine{00389   \}}
\DoxyCodeLine{00390 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00391   \{}
\DoxyCodeLine{00392     \textcolor{keywordflow}{if} (fmtChunk.m\_bitPerSample != 24)}
\DoxyCodeLine{00393       memcpy((\textcolor{keywordtype}{void} *)waveData.get(), (\textcolor{keywordtype}{void} *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}(),}
\DoxyCodeLine{00394              soundDataLength);}
\DoxyCodeLine{00395     \textcolor{keywordflow}{else} \{  \textcolor{comment}{// togliere quarto byte}}
\DoxyCodeLine{00396       UCHAR *begin = (UCHAR *)sndtrack-\/>\mbox{\hyperlink{class_t_sound_track_ae47a8e255a18ddbc83d31b6c0c834e68}{getRawData}}();}
\DoxyCodeLine{00397       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < (int)sndtrack-\/>getSampleCount() * fmtChunk.m\_chans;}
\DoxyCodeLine{00398            ++i) \{}
\DoxyCodeLine{00399         *(waveData.get() + 3 * i)     = *(begin + 4 * i);}
\DoxyCodeLine{00400         *(waveData.get() + 3 * i + 1) = *(begin + 4 * i + 1);}
\DoxyCodeLine{00401         *(waveData.get() + 3 * i + 2) = *(begin + 4 * i + 2);}
\DoxyCodeLine{00402       \}}
\DoxyCodeLine{00403     \}}
\DoxyCodeLine{00404   \}}
\DoxyCodeLine{00405 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00406   dataChunk.m\_samples = std::move(waveData);}
\DoxyCodeLine{00407 }
\DoxyCodeLine{00408   os.write(\textcolor{stringliteral}{"{}RIFF"{}}, 4);}
\DoxyCodeLine{00409   os.write((\textcolor{keywordtype}{char} *)\&RIFFChunkLength, \textcolor{keyword}{sizeof}(TINT32));}
\DoxyCodeLine{00410   os.write(\textcolor{stringliteral}{"{}WAVE"{}}, 4);}
\DoxyCodeLine{00411   fmtChunk.write(os);}
\DoxyCodeLine{00412   dataChunk.write(os);}
\DoxyCodeLine{00413 }
\DoxyCodeLine{00414   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00415 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00150}{TSound\+Track\+::get\+Raw\+Data()}}, and \mbox{\hyperlink{class_t_sound_track_a4c990666e5bd98da0da09eeb5b4f13dd}{TSound\+Track\+::is\+Sample\+Signed()}}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/sound/wav/tsio\+\_\+wav.\+h\item 
E\+:/opentoonz/toonz/sources/sound/wav/tsio\+\_\+wav.\+cpp\end{DoxyCompactItemize}
