\hypertarget{class_t_cache_resource}{}\doxysection{TCache\+Resource Class Reference}
\label{class_t_cache_resource}\index{TCacheResource@{TCacheResource}}


{\ttfamily \#include $<$tcacheresource.\+h$>$}

\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Type} \{ {\bfseries NONE}
, {\bfseries RGBM32}
, {\bfseries RGBM64}
, {\bfseries CM32}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
const std\+::string \& \mbox{\hyperlink{class_t_cache_resource_a6e14ecc6dbe795f67b4ef782c4b9687c}{get\+Name}} () const
\item 
QMutex $\ast$ \mbox{\hyperlink{class_t_cache_resource_ae6b944485ad7712b736abfd31aecf04e}{get\+Mutex}} ()
\item 
int \mbox{\hyperlink{class_t_cache_resource_a546ee206417d986f3c1fcc668d131c3c}{get\+Raster\+Type}} () const
\item 
\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} \mbox{\hyperlink{class_t_cache_resource_a202e9c303fad494f0e244941c56c8883}{build\+Compatible\+Raster}} (const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&\mbox{\hyperlink{class_t_cache_resource_a5b07817551a426772a465e1e1518cc82}{size}})
\item 
QRegion \mbox{\hyperlink{class_t_cache_resource_a90381856ea59bff5c96f7de5cc80ae45}{get\+Available\+Region}} () const
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a7fca73a70165610ef7d0ed9d67d32150}{upload}} (const \mbox{\hyperlink{class_t_point_t}{TPoint}} \&pos, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras)
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a67a336e4ba0a07963f1b70eb1f9c24ab}{upload}} (const \mbox{\hyperlink{class_t_tile}{TTile}} \&tile)
\item 
QRegion \mbox{\hyperlink{class_t_cache_resource_a2cc45812b90f1616703355f871e9f66c}{download}} (const \mbox{\hyperlink{class_t_point_t}{TPoint}} \&pos, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras)
\item 
QRegion \mbox{\hyperlink{class_t_cache_resource_ab48664e5e08cb13174b648d3473aed79}{download}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile)
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a0b031ed696884c6e264e43a88e261992}{download\+All}} (const \mbox{\hyperlink{class_t_point_t}{TPoint}} \&pos, \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras)
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a51b528636943060b9deae2d7335b1b3e}{download\+All}} (\mbox{\hyperlink{class_t_tile}{TTile}} \&tile)
\item 
bool \mbox{\hyperlink{class_t_cache_resource_aa12f473ea3211fff52dbf0e2bdbad1cd}{upload\+Palette}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} palette)
\item 
void \mbox{\hyperlink{class_t_cache_resource_ab7df351d55eeb49dbccb3d6b68c4322d}{download\+Palette}} (\mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} \&palette)
\item 
void \mbox{\hyperlink{class_t_cache_resource_af246ee11a995b81c7678521a4f29d288}{clear}} (QRegion region)
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a9ce70d2ba7217d7108fad7bb664c5235}{can\+Upload}} (const \mbox{\hyperlink{class_t_tile}{TTile}} \&tile) const
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a9af323ed1459c98546a31d1d03e5cde3}{can\+Download\+Some}} (const \mbox{\hyperlink{class_t_tile}{TTile}} \&tile) const
\item 
bool \mbox{\hyperlink{class_t_cache_resource_aae821b3058d74bb59cb7dc48f7bd4db9}{can\+Download\+All}} (const \mbox{\hyperlink{class_t_tile}{TTile}} \&tile) const
\item 
bool \mbox{\hyperlink{class_t_cache_resource_afeb6b5e5ae11508a059ea374e365270d}{can\+Upload}} (int ras\+Type) const
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a6296f3b08b3d6ff38ad96ce3d9c82550}{can\+Download\+Some}} (const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&rect) const
\item 
bool \mbox{\hyperlink{class_t_cache_resource_a9941e7b80447789207ab5deaa7f10a06}{can\+Download\+All}} (const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&rect) const
\item 
void \mbox{\hyperlink{class_t_cache_resource_a7c36ef28e9afda71ccf1e197e9bb78f5}{add\+Ref2}} (const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&rect)
\item 
void \mbox{\hyperlink{class_t_cache_resource_afde44819cacc4d85e8a705eb5758bd09}{release2}} (const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&rect)
\item 
void \mbox{\hyperlink{class_t_cache_resource_a1cc00a70419e29d5280e6ba674f44f73}{add\+Lock}} ()
\item 
void \mbox{\hyperlink{class_t_cache_resource_ad213948a094a3aa54683b1bc1c7b068d}{release\+Lock}} ()
\item 
int \mbox{\hyperlink{class_t_cache_resource_a5b07817551a426772a465e1e1518cc82}{size}} () const
\begin{DoxyCompactList}\small\item\em Returns the current size, in MB, of the cache resource. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_t_cache_resource_a8d50e8f6fea2f7460ea34725f16a0548}{enable\+Backup}} ()
\item 
void \mbox{\hyperlink{class_t_cache_resource_aa985cadb862103dacc57de8cecb5a137}{invalidate}} ()
\item 
void \mbox{\hyperlink{class_t_cache_resource_aa881605a8e00f86020e007f8292aaf1f}{save}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&fp)
\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_cache_resource_a722a517681415eb4997c6571c3c5b6b4}{TCache\+Resource\+Pool}}
\item 
class \mbox{\hyperlink{class_t_cache_resource_a05cf1f35aa862c864aed074a625b9121}{THDCache\+Resource\+Pool}}
\item 
class \mbox{\hyperlink{class_t_cache_resource_a3d9e971014d432f33435740f298820ca}{TCache\+ResourceP}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The \mbox{\hyperlink{class_t_cache_resource}{TCache\+Resource}} class models generic tile objects suitable for caching in render processes.

Whereas common \mbox{\hyperlink{class_t_tile}{TTile}} instances can be used to represent images bounded on a specific rect of the plane, the caching procedures in a render process require certain generalizations of the tile model that are fulfilled by the \mbox{\hyperlink{class_t_cache_resource}{TCache\+Resource}} class\+:

A cache resource has a textual description of its content that we\textquotesingle{}ll call \textquotesingle{}name\textquotesingle{}. It is the associative key used to retrieve a resource among all the others stored in the cache. \texorpdfstring{$<$}{<}\begin{DoxyItemize}
\item \texorpdfstring{$>$}{>}  The spatial domain of a cache resource is the entire plane, meaning that access methods are not bound to work on a specific rect. This is necessary since the image data accessed on non-\/consecutive renders could cover sparse regions of the plane. \texorpdfstring{$<$}{<}\item \texorpdfstring{$>$}{>}  For simplicity, the pixel geometry of a cache is coherent to the plane origin -\/ that is, pixel corners always have integer coordinates. \texorpdfstring{$<$}{<}\item \texorpdfstring{$>$}{>}  Filled resources have a {\bfseries{ raster type \texorpdfstring{$<$}{<}{\bfseries{}} \texorpdfstring{$>$}{>}, specifying the type of rasters that are currently storing. It is forbidden to upload rasters to resources when their raster type differs. Empty resources are compatible to all possible raster types. \texorpdfstring{$<$}{<}}}\item {\bfseries{\texorpdfstring{$>$}{>}  Cache resources provide reference counters to either the entire resource and each piece of its internal memory model, in order to perform automatic release of unnecessary data. \texorpdfstring{$<$}{<}}}\item {\bfseries{\texorpdfstring{$>$}{>}  The resource provides an accessible resume of its currently filled areas, in the form of a QRegion. \texorpdfstring{$<$}{<}}}\item {\bfseries{\texorpdfstring{$>$}{>}}}\end{DoxyItemize}
In order to use or retrieve a cache resource, users must instantiate a smart pointer reference to the resource, providing its name. Please refer to the \mbox{\hyperlink{class_t_cache_resource_p}{TCache\+ResourceP}} documentation for this topic.

{\bfseries{\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{class_t_raster}{TRaster}}, \mbox{\hyperlink{class_t_tile}{TTile}} classes. 
\end{DoxySeeAlso}
}}

\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{class_t_cache_resource_a78a568d4557327238b64c044c78e398a}\label{class_t_cache_resource_a78a568d4557327238b64c044c78e398a}} 
\index{TCacheResource@{TCacheResource}!Type@{Type}}
\index{Type@{Type}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{Type}{Type}}
{\footnotesize\ttfamily enum TCache\+Resource\+::\+Type}


\begin{DoxyCode}{0}
\DoxyCodeLine{00141 \{ NONE, RGBM32, RGBM64, CM32 \};}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_cache_resource_a1cc00a70419e29d5280e6ba674f44f73}\label{class_t_cache_resource_a1cc00a70419e29d5280e6ba674f44f73}} 
\index{TCacheResource@{TCacheResource}!addLock@{addLock}}
\index{addLock@{addLock}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{addLock()}{addLock()}}
{\footnotesize\ttfamily void TCache\+Resource\+::add\+Lock (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00738                              \{}
\DoxyCodeLine{00739   \textcolor{comment}{// DIAGNOSTICS\_NUMBEREDSTR(prefix + QString::number((UINT) this) + "{} | Stack |}}
\DoxyCodeLine{00740   \textcolor{comment}{// "{},}}
\DoxyCodeLine{00741   \textcolor{comment}{//"{}crStack"{}, "{}addLock"{});}}
\DoxyCodeLine{00742 }
\DoxyCodeLine{00743   ++m\_locksCount;}
\DoxyCodeLine{00744 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a7c36ef28e9afda71ccf1e197e9bb78f5}\label{class_t_cache_resource_a7c36ef28e9afda71ccf1e197e9bb78f5}} 
\index{TCacheResource@{TCacheResource}!addRef2@{addRef2}}
\index{addRef2@{addRef2}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{addRef2()}{addRef2()}}
{\footnotesize\ttfamily void TCache\+Resource\+::add\+Ref2 (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{rect }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00685                                               \{}
\DoxyCodeLine{00686   \textcolor{comment}{// DIAGNOSTICS\_NUMBEREDSTRSET(prefix + QString::number((UINT) this) + "{} |}}
\DoxyCodeLine{00687   \textcolor{comment}{// Stack | "{},}}
\DoxyCodeLine{00688   \textcolor{comment}{//"{}crStack"{}, "{}addRef"{}, ::traduce(rect));}}
\DoxyCodeLine{00689 }
\DoxyCodeLine{00690   \textcolor{comment}{// Add a reference to all cells intersecting the passed one}}
\DoxyCodeLine{00691   \mbox{\hyperlink{class_t_point_t}{TPoint}} initialPos(getCellPos(rect.getP00()));}
\DoxyCodeLine{00692   \mbox{\hyperlink{class_t_point_t}{TPoint}} pos;}
\DoxyCodeLine{00693   \textcolor{keywordflow}{for} (pos.x = initialPos.x; pos.x <= rect.x1; pos.x += latticeStep)}
\DoxyCodeLine{00694     \textcolor{keywordflow}{for} (pos.y = initialPos.y; pos.y <= rect.y1; pos.y += latticeStep) \{}
\DoxyCodeLine{00695       PointLess cellIndex(getCellIndex(pos));}
\DoxyCodeLine{00696       CellData \&cellData    = m\_cellDatas[cellIndex];}
\DoxyCodeLine{00697       cellData.m\_referenced = \textcolor{keyword}{true};}
\DoxyCodeLine{00698       cellData.m\_refsCount++;}
\DoxyCodeLine{00699     \}}
\DoxyCodeLine{00700 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a202e9c303fad494f0e244941c56c8883}\label{class_t_cache_resource_a202e9c303fad494f0e244941c56c8883}} 
\index{TCacheResource@{TCacheResource}!buildCompatibleRaster@{buildCompatibleRaster}}
\index{buildCompatibleRaster@{buildCompatibleRaster}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{buildCompatibleRaster()}{buildCompatibleRaster()}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} TCache\+Resource\+::build\+Compatible\+Raster (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_dimension_t}{TDimension}} \&}]{size }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00333                                                                      \{}
\DoxyCodeLine{00334   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} result;}
\DoxyCodeLine{00335   \textcolor{keywordflow}{if} (m\_tileType == RGBM32)}
\DoxyCodeLine{00336     result = \mbox{\hyperlink{class_t_raster_p_t}{TRaster32P}}(\mbox{\hyperlink{class_t_cache_resource_a5b07817551a426772a465e1e1518cc82}{size}});}
\DoxyCodeLine{00337   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_tileType == RGBM64)}
\DoxyCodeLine{00338     result = \mbox{\hyperlink{class_t_raster_p_t}{TRaster64P}}(\mbox{\hyperlink{class_t_cache_resource_a5b07817551a426772a465e1e1518cc82}{size}});}
\DoxyCodeLine{00339   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_tileType == CM32)}
\DoxyCodeLine{00340     result = \mbox{\hyperlink{class_t_raster_p_t}{TRasterCM32P}}(\mbox{\hyperlink{class_t_cache_resource_a5b07817551a426772a465e1e1518cc82}{size}});}
\DoxyCodeLine{00341 }
\DoxyCodeLine{00342   \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{00343 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a9941e7b80447789207ab5deaa7f10a06}\label{class_t_cache_resource_a9941e7b80447789207ab5deaa7f10a06}} 
\index{TCacheResource@{TCacheResource}!canDownloadAll@{canDownloadAll}}
\index{canDownloadAll@{canDownloadAll}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{canDownloadAll()}{canDownloadAll()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::can\+Download\+All (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{rect }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00417                                                            \{}
\DoxyCodeLine{00418   \textcolor{keywordflow}{return} contains(m\_region, rect);}
\DoxyCodeLine{00419 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_aae821b3058d74bb59cb7dc48f7bd4db9}\label{class_t_cache_resource_aae821b3058d74bb59cb7dc48f7bd4db9}} 
\index{TCacheResource@{TCacheResource}!canDownloadAll@{canDownloadAll}}
\index{canDownloadAll@{canDownloadAll}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{canDownloadAll()}{canDownloadAll()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::can\+Download\+All (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile }\end{DoxyParamCaption}) const}

Returns true if the passed tile is compatible, and it can be downloaded entirely. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00440                                                            \{}
\DoxyCodeLine{00441   \textcolor{keywordflow}{return} checkTile(tile) \&\& contains(m\_region, getTileRect(tile));}
\DoxyCodeLine{00442 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a6296f3b08b3d6ff38ad96ce3d9c82550}\label{class_t_cache_resource_a6296f3b08b3d6ff38ad96ce3d9c82550}} 
\index{TCacheResource@{TCacheResource}!canDownloadSome@{canDownloadSome}}
\index{canDownloadSome@{canDownloadSome}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{canDownloadSome()}{canDownloadSome()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::can\+Download\+Some (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{rect }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00411                                                             \{}
\DoxyCodeLine{00412   \textcolor{keywordflow}{return} m\_region.intersects(toQRect(rect));}
\DoxyCodeLine{00413 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a9af323ed1459c98546a31d1d03e5cde3}\label{class_t_cache_resource_a9af323ed1459c98546a31d1d03e5cde3}} 
\index{TCacheResource@{TCacheResource}!canDownloadSome@{canDownloadSome}}
\index{canDownloadSome@{canDownloadSome}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{canDownloadSome()}{canDownloadSome()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::can\+Download\+Some (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile }\end{DoxyParamCaption}) const}

Returns true if the passed tile is compatible with the complex, and some part of it is downloadable. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00432                                                             \{}
\DoxyCodeLine{00433   \textcolor{keywordflow}{return} checkTile(tile) \&\& m\_region.intersects(toQRect(getTileRect(tile)));}
\DoxyCodeLine{00434 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a9ce70d2ba7217d7108fad7bb664c5235}\label{class_t_cache_resource_a9ce70d2ba7217d7108fad7bb664c5235}} 
\index{TCacheResource@{TCacheResource}!canUpload@{canUpload}}
\index{canUpload@{canUpload}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{canUpload()}{canUpload()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::can\+Upload (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile }\end{DoxyParamCaption}) const}


\begin{DoxyCode}{0}
\DoxyCodeLine{00423                                                       \{}
\DoxyCodeLine{00424   \textcolor{keywordtype}{int} tileType;}
\DoxyCodeLine{00425   \textcolor{keywordflow}{return} checkTile(tile) \&\& checkRasterType(tile.getRaster(), tileType);}
\DoxyCodeLine{00426 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_afeb6b5e5ae11508a059ea374e365270d}\label{class_t_cache_resource_afeb6b5e5ae11508a059ea374e365270d}} 
\index{TCacheResource@{TCacheResource}!canUpload@{canUpload}}
\index{canUpload@{canUpload}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{canUpload()}{canUpload()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::can\+Upload (\begin{DoxyParamCaption}\item[{int}]{ras\+Type }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00163                                     \{}
\DoxyCodeLine{00164     \textcolor{keywordflow}{return} m\_tileType == NONE || m\_tileType == rasType;}
\DoxyCodeLine{00165   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_af246ee11a995b81c7678521a4f29d288}\label{class_t_cache_resource_af246ee11a995b81c7678521a4f29d288}} 
\index{TCacheResource@{TCacheResource}!clear@{clear}}
\index{clear@{clear}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{clear()}{clear()}}
{\footnotesize\ttfamily void TCache\+Resource\+::clear (\begin{DoxyParamCaption}\item[{QRegion}]{region }\end{DoxyParamCaption})}

Clears the complex on the specified region. Please observe that the actually cleared region consists of all lattice cells intersecting the passed region, therefore resulting in a cleared region typically larger than passed one, up to the lattice granularity. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00624                                          \{}
\DoxyCodeLine{00625   \textcolor{keywordflow}{if} (!m\_region.intersects(region)) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00626 }
\DoxyCodeLine{00627   \textcolor{comment}{// Get the region bbox}}
\DoxyCodeLine{00628   \mbox{\hyperlink{class_t_rect_t}{TRect}} bbox(toTRect(region.boundingRect()));}
\DoxyCodeLine{00629 }
\DoxyCodeLine{00630   \textcolor{comment}{// For all cells intersecting the bbox}}
\DoxyCodeLine{00631   \mbox{\hyperlink{class_t_point_t}{TPoint}} initialPos(getCellPos(bbox.getP00()));}
\DoxyCodeLine{00632   \mbox{\hyperlink{class_t_point_t}{TPoint}} pos;}
\DoxyCodeLine{00633   \textcolor{keywordflow}{for} (pos.x = initialPos.x; pos.x <= bbox.x1; pos.x += latticeStep)}
\DoxyCodeLine{00634     \textcolor{keywordflow}{for} (pos.y = initialPos.y; pos.y <= bbox.y1; pos.y += latticeStep) \{}
\DoxyCodeLine{00635       QRect cellQRect(}
\DoxyCodeLine{00636           toQRect(\mbox{\hyperlink{class_t_rect_t}{TRect}}(pos, \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(latticeStep, latticeStep))));}
\DoxyCodeLine{00637 }
\DoxyCodeLine{00638       \textcolor{keywordflow}{if} (region.intersects(cellQRect) \&\& m\_region.intersects(cellQRect)) \{}
\DoxyCodeLine{00639         \textcolor{comment}{// Release the associated cell from cache and clear the cell from the}}
\DoxyCodeLine{00640         \textcolor{comment}{// content region.}}
\DoxyCodeLine{00641         TImageCache::instance()-\/>\mbox{\hyperlink{class_t_image_cache_a57d63227dfe2532b0aed22c47113be66}{remove}}(getCellCacheId(pos));}
\DoxyCodeLine{00642         m\_region -\/= cellQRect;}
\DoxyCodeLine{00643 }
\DoxyCodeLine{00644         -\/-\/m\_cellsCount;}
\DoxyCodeLine{00645 }
\DoxyCodeLine{00646         \textcolor{comment}{// DIAGNOSTICS\_GLOADD("{}crCellsCnt"{}, -\/1);}}
\DoxyCodeLine{00647 }
\DoxyCodeLine{00648         \textcolor{comment}{// Release the cell from m\_cellDatas}}
\DoxyCodeLine{00649         m\_cellDatas[getCellIndex(pos)].m\_modified = \textcolor{keyword}{true};}
\DoxyCodeLine{00650       \}}
\DoxyCodeLine{00651     \}}
\DoxyCodeLine{00652 }
\DoxyCodeLine{00653   \textcolor{keywordflow}{if} (m\_region.isEmpty()) \{}
\DoxyCodeLine{00654     m\_tileType   = NONE;}
\DoxyCodeLine{00655     m\_locksCount = 0;}
\DoxyCodeLine{00656   \}}
\DoxyCodeLine{00657 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00624}{clear()}}, and \mbox{\hyperlink{l01260}{TImage\+Cache\+::remove()}}.



Referenced by \mbox{\hyperlink{l00624}{clear()}}.

\mbox{\Hypertarget{class_t_cache_resource_a2cc45812b90f1616703355f871e9f66c}\label{class_t_cache_resource_a2cc45812b90f1616703355f871e9f66c}} 
\index{TCacheResource@{TCacheResource}!download@{download}}
\index{download@{download}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{download()}{download()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily QRegion TCache\+Resource\+::download (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPoint}} \&}]{pos,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}}]{ras }\end{DoxyParamCaption})}

Fills the passed tile with the data contained in the complex, returning the copied region. The same restriction of the \mbox{\hyperlink{class_t_cache_resource_a7fca73a70165610ef7d0ed9d67d32150}{upload()}} method applies here. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00511                                                                 \{}
\DoxyCodeLine{00512   \textcolor{keywordtype}{int} tileType;}
\DoxyCodeLine{00513   \textcolor{keywordflow}{if} (!checkRasterType(ras, tileType)) \textcolor{keywordflow}{return} QRegion();}
\DoxyCodeLine{00514 }
\DoxyCodeLine{00515   \textcolor{comment}{// Build the tile's rect}}
\DoxyCodeLine{00516   \mbox{\hyperlink{class_t_rect_t}{TRect}} tileRect(ras-\/>getBounds() + pos);}
\DoxyCodeLine{00517 }
\DoxyCodeLine{00518   \textcolor{keywordflow}{if} (!m\_region.intersects(toQRect(tileRect))) \textcolor{keywordflow}{return} QRegion();}
\DoxyCodeLine{00519 }
\DoxyCodeLine{00520   \textcolor{comment}{// For all cells intersecting the tile's rect, copy all those intersecting the}}
\DoxyCodeLine{00521   \textcolor{comment}{// complex's content region.}}
\DoxyCodeLine{00522   \mbox{\hyperlink{class_t_point_t}{TPoint}} initialPos(getCellPos(tileRect.getP00()));}
\DoxyCodeLine{00523 }
\DoxyCodeLine{00524   \mbox{\hyperlink{class_t_point_t}{TPoint}} currPos;}
\DoxyCodeLine{00525   \textcolor{keywordflow}{for} (currPos.x = initialPos.x; currPos.x <= tileRect.x1;}
\DoxyCodeLine{00526        currPos.x += latticeStep)}
\DoxyCodeLine{00527     \textcolor{keywordflow}{for} (currPos.y = initialPos.y; currPos.y <= tileRect.y1;}
\DoxyCodeLine{00528          currPos.y += latticeStep) \{}
\DoxyCodeLine{00529       \mbox{\hyperlink{class_t_rect_t}{TRect}} cellRect(currPos, \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(latticeStep, latticeStep));}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531       \mbox{\hyperlink{class_t_rect_t}{TRect}} overlapRect(tileRect * cellRect);}
\DoxyCodeLine{00532       assert(!overlapRect.isEmpty());}
\DoxyCodeLine{00533       QRect overlapQRect(toQRect(overlapRect));}
\DoxyCodeLine{00534 }
\DoxyCodeLine{00535       \textcolor{keywordflow}{if} (m\_region.intersects(overlapQRect)) \{}
\DoxyCodeLine{00536         \textcolor{comment}{// Extract the associated rasters and perform the copy to the input}}
\DoxyCodeLine{00537         \textcolor{comment}{// tile.}}
\DoxyCodeLine{00538         std::pair<TRasterP, CellData *> cellInfos(touch(getCellIndex(currPos)));}
\DoxyCodeLine{00539         \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} cellRas(cellInfos.first);}
\DoxyCodeLine{00540 }
\DoxyCodeLine{00541         \mbox{\hyperlink{class_t_rect_t}{TRect}} temp(overlapRect -\/ currPos);}
\DoxyCodeLine{00542         \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} overlappingCellRas(cellRas-\/>extract(temp));}
\DoxyCodeLine{00543         temp = \mbox{\hyperlink{class_t_rect_t}{TRect}}(overlapRect -\/ tileRect.getP00());}
\DoxyCodeLine{00544         \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} overlappingTileRas(ras-\/>extract(temp));}
\DoxyCodeLine{00545 }
\DoxyCodeLine{00546         \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{TRop::copy}}(overlappingTileRas, overlappingCellRas);}
\DoxyCodeLine{00547       \}}
\DoxyCodeLine{00548     \}}
\DoxyCodeLine{00549 }
\DoxyCodeLine{00550   \textcolor{keywordflow}{return} m\_region.intersected(QRegion(toQRect(tileRect)));}
\DoxyCodeLine{00551 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00093}{TRop\+::copy()}}, and \mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{TRect\+T$<$ T $>$\+::is\+Empty()}}.

\mbox{\Hypertarget{class_t_cache_resource_ab48664e5e08cb13174b648d3473aed79}\label{class_t_cache_resource_ab48664e5e08cb13174b648d3473aed79}} 
\index{TCacheResource@{TCacheResource}!download@{download}}
\index{download@{download}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{download()}{download()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily QRegion TCache\+Resource\+::download (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00555                                             \{}
\DoxyCodeLine{00556   \textcolor{keywordflow}{if} (!checkTile(tile)) \textcolor{keywordflow}{return} QRegion();}
\DoxyCodeLine{00557 }
\DoxyCodeLine{00558   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_cache_resource_a2cc45812b90f1616703355f871e9f66c}{download}}(\mbox{\hyperlink{class_t_point_t}{TPoint}}(tile.m\_pos.x, tile.m\_pos.y), tile.getRaster());}
\DoxyCodeLine{00559 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a0b031ed696884c6e264e43a88e261992}\label{class_t_cache_resource_a0b031ed696884c6e264e43a88e261992}} 
\index{TCacheResource@{TCacheResource}!downloadAll@{downloadAll}}
\index{downloadAll@{downloadAll}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{downloadAll()}{downloadAll()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::download\+All (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPoint}} \&}]{pos,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}}]{ras }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00563                                                                 \{}
\DoxyCodeLine{00564   \textcolor{keywordtype}{int} tileType;}
\DoxyCodeLine{00565   \textcolor{keywordflow}{if} (!checkRasterType(ras, tileType)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00566 }
\DoxyCodeLine{00567   \textcolor{comment}{// Build the tile's rect}}
\DoxyCodeLine{00568   \mbox{\hyperlink{class_t_rect_t}{TRect}} tileRect(ras-\/>getBounds() + pos);}
\DoxyCodeLine{00569 }
\DoxyCodeLine{00570   \textcolor{keywordflow}{if} (!contains(m\_region, tileRect)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00571 }
\DoxyCodeLine{00572   \textcolor{comment}{// DIAGNOSTICS\_NUMBEREDSTRSET(prefix + QString::number((UINT) this) + "{} |}}
\DoxyCodeLine{00573   \textcolor{comment}{// Stack | "{},}}
\DoxyCodeLine{00574   \textcolor{comment}{//"{}crStack"{}, "{}downloadAll"{}, ::traduce(TRect(pos, ras-\/>getSize())));}}
\DoxyCodeLine{00575 }
\DoxyCodeLine{00576   \textcolor{comment}{// For all cells intersecting the tile's rect, copy all those intersecting the}}
\DoxyCodeLine{00577   \textcolor{comment}{// complex's content region.}}
\DoxyCodeLine{00578   \mbox{\hyperlink{class_t_point_t}{TPoint}} initialPos(getCellPos(tileRect.getP00()));}
\DoxyCodeLine{00579 }
\DoxyCodeLine{00580   \mbox{\hyperlink{class_t_point_t}{TPoint}} currPos;}
\DoxyCodeLine{00581   \textcolor{keywordflow}{for} (currPos.x = initialPos.x; currPos.x <= tileRect.x1;}
\DoxyCodeLine{00582        currPos.x += latticeStep)}
\DoxyCodeLine{00583     \textcolor{keywordflow}{for} (currPos.y = initialPos.y; currPos.y <= tileRect.y1;}
\DoxyCodeLine{00584          currPos.y += latticeStep) \{}
\DoxyCodeLine{00585       \mbox{\hyperlink{class_t_rect_t}{TRect}} cellRect(currPos, \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(latticeStep, latticeStep));}
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587       \mbox{\hyperlink{class_t_rect_t}{TRect}} overlapRect(tileRect * cellRect);}
\DoxyCodeLine{00588       assert(!overlapRect.isEmpty());}
\DoxyCodeLine{00589       QRect overlapQRect(toQRect(overlapRect));}
\DoxyCodeLine{00590 }
\DoxyCodeLine{00591       \textcolor{keywordflow}{if} (m\_region.intersects(overlapQRect)) \{}
\DoxyCodeLine{00592         \textcolor{comment}{// Extract the associated rasters and perform the copy to the input}}
\DoxyCodeLine{00593         \textcolor{comment}{// tile.}}
\DoxyCodeLine{00594         std::pair<TRasterP, CellData *> cellInfos(touch(getCellIndex(currPos)));}
\DoxyCodeLine{00595         \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} cellRas(cellInfos.first);}
\DoxyCodeLine{00596 }
\DoxyCodeLine{00597         \mbox{\hyperlink{class_t_rect_t}{TRect}} temp(overlapRect -\/ currPos);}
\DoxyCodeLine{00598         \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} overlappingCellRas(cellRas-\/>extract(temp));}
\DoxyCodeLine{00599         temp = \mbox{\hyperlink{class_t_rect_t}{TRect}}(overlapRect -\/ tileRect.getP00());}
\DoxyCodeLine{00600         \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} overlappingTileRas(ras-\/>extract(temp));}
\DoxyCodeLine{00601 }
\DoxyCodeLine{00602         \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{TRop::copy}}(overlappingTileRas, overlappingCellRas);}
\DoxyCodeLine{00603       \}}
\DoxyCodeLine{00604     \}}
\DoxyCodeLine{00605 }
\DoxyCodeLine{00606   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00607 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a51b528636943060b9deae2d7335b1b3e}\label{class_t_cache_resource_a51b528636943060b9deae2d7335b1b3e}} 
\index{TCacheResource@{TCacheResource}!downloadAll@{downloadAll}}
\index{downloadAll@{downloadAll}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{downloadAll()}{downloadAll()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::download\+All (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00611                                             \{}
\DoxyCodeLine{00612   \textcolor{keywordflow}{if} (!checkTile(tile)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00613 }
\DoxyCodeLine{00614   \textcolor{keywordflow}{return} downloadAll(\mbox{\hyperlink{class_t_point_t}{TPoint}}(tile.m\_pos.x, tile.m\_pos.y), tile.getRaster());}
\DoxyCodeLine{00615 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_ab7df351d55eeb49dbccb3d6b68c4322d}\label{class_t_cache_resource_ab7df351d55eeb49dbccb3d6b68c4322d}} 
\index{TCacheResource@{TCacheResource}!downloadPalette@{downloadPalette}}
\index{downloadPalette@{downloadPalette}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{downloadPalette()}{downloadPalette()}}
{\footnotesize\ttfamily void TCache\+Resource\+::download\+Palette (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}} \&}]{palette }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00677                                                        \{}
\DoxyCodeLine{00678   palette = m\_palette;}
\DoxyCodeLine{00679 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a8d50e8f6fea2f7460ea34725f16a0548}\label{class_t_cache_resource_a8d50e8f6fea2f7460ea34725f16a0548}} 
\index{TCacheResource@{TCacheResource}!enableBackup@{enableBackup}}
\index{enableBackup@{enableBackup}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{enableBackup()}{enableBackup()}}
{\footnotesize\ttfamily void TCache\+Resource\+::enable\+Backup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00803                                   \{}
\DoxyCodeLine{00804   \textcolor{keywordflow}{if} (m\_backEnabled) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00805   TCacheResourcePool::instance()-\/>startBacking(\textcolor{keyword}{this});}
\DoxyCodeLine{00806 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a90381856ea59bff5c96f7de5cc80ae45}\label{class_t_cache_resource_a90381856ea59bff5c96f7de5cc80ae45}} 
\index{TCacheResource@{TCacheResource}!getAvailableRegion@{getAvailableRegion}}
\index{getAvailableRegion@{getAvailableRegion}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{getAvailableRegion()}{getAvailableRegion()}}
{\footnotesize\ttfamily QRegion TCache\+Resource\+::get\+Available\+Region (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}

Returns the current region currently available in the complex, with respect to the complex\textquotesingle{}s origin. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00145 \{ \textcolor{keywordflow}{return} m\_region; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_ae6b944485ad7712b736abfd31aecf04e}\label{class_t_cache_resource_ae6b944485ad7712b736abfd31aecf04e}} 
\index{TCacheResource@{TCacheResource}!getMutex@{getMutex}}
\index{getMutex@{getMutex}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{getMutex()}{getMutex()}}
{\footnotesize\ttfamily QMutex $\ast$ TCache\+Resource\+::get\+Mutex (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00139 \{ \textcolor{keywordflow}{return} \&m\_mutex; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a6e14ecc6dbe795f67b4ef782c4b9687c}\label{class_t_cache_resource_a6e14ecc6dbe795f67b4ef782c4b9687c}} 
\index{TCacheResource@{TCacheResource}!getName@{getName}}
\index{getName@{getName}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{getName()}{getName()}}
{\footnotesize\ttfamily const std\+::string \& TCache\+Resource\+::get\+Name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00137 \{ \textcolor{keywordflow}{return} m\_pos-\/>first; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a546ee206417d986f3c1fcc668d131c3c}\label{class_t_cache_resource_a546ee206417d986f3c1fcc668d131c3c}} 
\index{TCacheResource@{TCacheResource}!getRasterType@{getRasterType}}
\index{getRasterType@{getRasterType}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{getRasterType()}{getRasterType()}}
{\footnotesize\ttfamily int TCache\+Resource\+::get\+Raster\+Type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}

Returns the type of raster currently present in the tile complex. Only images providing a raster representation coherent with the complex\textquotesingle{}s one may be exchanged with it. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00142 \{ \textcolor{keywordflow}{return} m\_tileType; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_aa985cadb862103dacc57de8cecb5a137}\label{class_t_cache_resource_aa985cadb862103dacc57de8cecb5a137}} 
\index{TCacheResource@{TCacheResource}!invalidate@{invalidate}}
\index{invalidate@{invalidate}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{invalidate()}{invalidate()}}
{\footnotesize\ttfamily void TCache\+Resource\+::invalidate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00810 \{ m\_invalidated = \textcolor{keyword}{true}; \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_afde44819cacc4d85e8a705eb5758bd09}\label{class_t_cache_resource_afde44819cacc4d85e8a705eb5758bd09}} 
\index{TCacheResource@{TCacheResource}!release2@{release2}}
\index{release2@{release2}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{release2()}{release2()}}
{\footnotesize\ttfamily void TCache\+Resource\+::release2 (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_rect_t}{TRect}} \&}]{rect }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00704                                                \{}
\DoxyCodeLine{00705   \textcolor{comment}{// DIAGNOSTICS\_NUMBEREDSTRSET(prefix + QString::number((UINT) this) + "{} |}}
\DoxyCodeLine{00706   \textcolor{comment}{// Stack | "{},}}
\DoxyCodeLine{00707   \textcolor{comment}{//"{}crStack"{}, "{}release"{}, ::traduce(rect));}}
\DoxyCodeLine{00708 }
\DoxyCodeLine{00709   \textcolor{keywordflow}{if} (m\_locksCount > 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00710 }
\DoxyCodeLine{00711   std::map<PointLess, CellData>::iterator it;}
\DoxyCodeLine{00712   \textcolor{keywordflow}{for} (it = m\_cellDatas.begin(); it != m\_cellDatas.end();) \{}
\DoxyCodeLine{00713     \textcolor{keywordflow}{if} (!it-\/>second.m\_referenced) \{}
\DoxyCodeLine{00714       ++it;}
\DoxyCodeLine{00715       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00716     \}}
\DoxyCodeLine{00717 }
\DoxyCodeLine{00718     \mbox{\hyperlink{class_t_point_t}{TPoint}} cellPos(getCellPos(it-\/>first));}
\DoxyCodeLine{00719     \mbox{\hyperlink{class_t_rect_t}{TRect}} cellRect(cellPos, \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(latticeStep, latticeStep));}
\DoxyCodeLine{00720 }
\DoxyCodeLine{00721     \textcolor{keywordflow}{if} (isEmpty(cellRect * rect)) \{}
\DoxyCodeLine{00722       ++it;}
\DoxyCodeLine{00723       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00724     \}}
\DoxyCodeLine{00725 }
\DoxyCodeLine{00726     QRect cellQRect(toQRect(cellRect));}
\DoxyCodeLine{00727     \textcolor{keywordflow}{if} (-\/-\/it-\/>second.m\_refsCount <= 0) \{}
\DoxyCodeLine{00728       releaseCell(cellQRect, it-\/>first, it-\/>second.m\_modified);}
\DoxyCodeLine{00729       std::map<PointLess, CellData>::iterator jt = it++;}
\DoxyCodeLine{00730       m\_cellDatas.erase(jt);}
\DoxyCodeLine{00731     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00732       ++it;}
\DoxyCodeLine{00733   \}}
\DoxyCodeLine{00734 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_ad213948a094a3aa54683b1bc1c7b068d}\label{class_t_cache_resource_ad213948a094a3aa54683b1bc1c7b068d}} 
\index{TCacheResource@{TCacheResource}!releaseLock@{releaseLock}}
\index{releaseLock@{releaseLock}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{releaseLock()}{releaseLock()}}
{\footnotesize\ttfamily void TCache\+Resource\+::release\+Lock (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00748                                  \{}
\DoxyCodeLine{00749   \textcolor{comment}{// DIAGNOSTICS\_NUMBEREDSTR(prefix + QString::number((UINT) this) + "{} | Stack |}}
\DoxyCodeLine{00750   \textcolor{comment}{// "{},}}
\DoxyCodeLine{00751   \textcolor{comment}{//"{}crStack"{}, "{}releaseLock"{});}}
\DoxyCodeLine{00752 }
\DoxyCodeLine{00753   m\_locksCount = std::max(m\_locksCount -\/ 1, 0);}
\DoxyCodeLine{00754 }
\DoxyCodeLine{00755   \textcolor{keywordflow}{if} (m\_locksCount > 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{00756 }
\DoxyCodeLine{00757   \textcolor{comment}{// Check for released cells}}
\DoxyCodeLine{00758   std::map<PointLess, CellData>::iterator it;}
\DoxyCodeLine{00759   \textcolor{keywordflow}{for} (it = m\_cellDatas.begin(); it != m\_cellDatas.end();)}
\DoxyCodeLine{00760     \textcolor{keywordflow}{if} (it-\/>second.m\_referenced) \{}
\DoxyCodeLine{00761       \mbox{\hyperlink{class_t_point_t}{TPoint}} cellPos(getCellPos(it-\/>first));}
\DoxyCodeLine{00762       QRect cellQRect(cellPos.x, cellPos.y, latticeStep, latticeStep);}
\DoxyCodeLine{00763 }
\DoxyCodeLine{00764       releaseCell(cellQRect, it-\/>first, it-\/>second.m\_modified);}
\DoxyCodeLine{00765       std::map<PointLess, CellData>::iterator jt = it++;}
\DoxyCodeLine{00766       m\_cellDatas.erase(jt);}
\DoxyCodeLine{00767     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00768       ++it;}
\DoxyCodeLine{00769 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_aa881605a8e00f86020e007f8292aaf1f}\label{class_t_cache_resource_aa881605a8e00f86020e007f8292aaf1f}} 
\index{TCacheResource@{TCacheResource}!save@{save}}
\index{save@{save}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily void TCache\+Resource\+::save (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{fp }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00916                                              \{}
\DoxyCodeLine{00917   assert(!fp.isEmpty());}
\DoxyCodeLine{00918 }
\DoxyCodeLine{00919   std::map<PointLess, CellData>::iterator it;}
\DoxyCodeLine{00920   \textcolor{keywordflow}{for} (it = m\_cellDatas.begin(); it != m\_cellDatas.end(); ++it) \{}
\DoxyCodeLine{00921     \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} cellRas = getRaster(TImageCache::instance()-\/>get(}
\DoxyCodeLine{00922         getCellCacheId(it-\/>first.x, it-\/>first.y), \textcolor{keyword}{false}));}
\DoxyCodeLine{00923 }
\DoxyCodeLine{00924     assert(m\_tileType != NONE);}
\DoxyCodeLine{00925 }
\DoxyCodeLine{00926     \mbox{\hyperlink{class_t_file_path}{TFilePath}} cellFp(fp + \mbox{\hyperlink{class_t_file_path}{TFilePath}}(getCellName(it-\/>first.x, it-\/>first.y)));}
\DoxyCodeLine{00927 }
\DoxyCodeLine{00928     \textcolor{keywordflow}{if} (m\_tileType == CM32)}
\DoxyCodeLine{00929       ::saveCompressed(cellFp, cellRas);}
\DoxyCodeLine{00930     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00931       TImageWriter::save(cellFp.withType(\textcolor{stringliteral}{"{}.tif"{}}), cellRas);}
\DoxyCodeLine{00932   \}}
\DoxyCodeLine{00933 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a5b07817551a426772a465e1e1518cc82}\label{class_t_cache_resource_a5b07817551a426772a465e1e1518cc82}} 
\index{TCacheResource@{TCacheResource}!size@{size}}
\index{size@{size}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{size()}{size()}}
{\footnotesize\ttfamily int TCache\+Resource\+::size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Returns the current size, in MB, of the cache resource. 


\begin{DoxyCode}{0}
\DoxyCodeLine{00790                                \{}
\DoxyCodeLine{00791   \textcolor{comment}{// NOTE: It's better to store the size incrementally. This complies}}
\DoxyCodeLine{00792   \textcolor{comment}{// with the possibility of specifying a bbox to fit the stored cells to...}}
\DoxyCodeLine{00793 }
\DoxyCodeLine{00794   \textcolor{keywordflow}{return} m\_tileType == NONE ? 0}
\DoxyCodeLine{00795                             : m\_tileType == RGBM64 ? (m\_cellsCount << 11)}
\DoxyCodeLine{00796                                                    : (m\_cellsCount << 10);}
\DoxyCodeLine{00797 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_a7fca73a70165610ef7d0ed9d67d32150}\label{class_t_cache_resource_a7fca73a70165610ef7d0ed9d67d32150}} 
\index{TCacheResource@{TCacheResource}!upload@{upload}}
\index{upload@{upload}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{upload()}{upload()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::upload (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_point_t}{TPoint}} \&}]{pos,  }\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}}}]{ras }\end{DoxyParamCaption})}

Copies the passed tile in the tile complex. The passed tile {\bfseries{must}} possess integer geometry (ie tile.\+m\+\_\+pos must have integer coordinates), otherwise this function is a no-\/op. 
\begin{DoxyCode}{0}
\DoxyCodeLine{00449                                                            \{}
\DoxyCodeLine{00450   \textcolor{keywordtype}{int} tileType;}
\DoxyCodeLine{00451   \textcolor{keywordflow}{if} (!checkRasterType(ras, tileType)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00452 }
\DoxyCodeLine{00453   \textcolor{keywordflow}{if} (m\_tileType == NONE) m\_tileType = tileType;}
\DoxyCodeLine{00454 }
\DoxyCodeLine{00455   \textcolor{comment}{// For all cells of the lattice which intersect the tile, upload the content}}
\DoxyCodeLine{00456   \textcolor{comment}{// in the}}
\DoxyCodeLine{00457   \textcolor{comment}{// complex}}
\DoxyCodeLine{00458   \mbox{\hyperlink{class_t_rect_t}{TRect}} tileRect(ras-\/>getBounds() + pos);}
\DoxyCodeLine{00459   \mbox{\hyperlink{class_t_point_t}{TPoint}} initialPos(getCellPos(tileRect.getP00()));}
\DoxyCodeLine{00460 }
\DoxyCodeLine{00461   \textcolor{comment}{// DIAGNOSTICS\_NUMBEREDSTRSET(prefix + QString::number((UINT) this) + "{} |}}
\DoxyCodeLine{00462   \textcolor{comment}{// Stack | "{},}}
\DoxyCodeLine{00463   \textcolor{comment}{//"{}crStack"{}, "{}upload"{}, ::traduce(TRect(pos, ras-\/>getSize())));}}
\DoxyCodeLine{00464 }
\DoxyCodeLine{00465   \mbox{\hyperlink{class_t_point_t}{TPoint}} currPos;}
\DoxyCodeLine{00466   \textcolor{keywordflow}{for} (currPos.x = initialPos.x; currPos.x <= tileRect.x1;}
\DoxyCodeLine{00467        currPos.x += latticeStep)}
\DoxyCodeLine{00468     \textcolor{keywordflow}{for} (currPos.y = initialPos.y; currPos.y <= tileRect.y1;}
\DoxyCodeLine{00469          currPos.y += latticeStep) \{}
\DoxyCodeLine{00470       \textcolor{comment}{// Copy tile's content into the cell's raster.}}
\DoxyCodeLine{00471       \mbox{\hyperlink{class_t_rect_t}{TRect}} cellRect(currPos, \mbox{\hyperlink{class_t_dimension_t}{TDimension}}(latticeStep, latticeStep));}
\DoxyCodeLine{00472 }
\DoxyCodeLine{00473       \mbox{\hyperlink{class_t_rect_t}{TRect}} overlapRect(tileRect * cellRect);}
\DoxyCodeLine{00474       assert(!overlapRect.isEmpty());}
\DoxyCodeLine{00475 }
\DoxyCodeLine{00476       PointLess cellIndex(getCellIndex(currPos));}
\DoxyCodeLine{00477       std::pair<TRasterP, CellData *> cellInfos(touch(cellIndex));}
\DoxyCodeLine{00478       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} cellRas(cellInfos.first);}
\DoxyCodeLine{00479 }
\DoxyCodeLine{00480       \mbox{\hyperlink{class_t_rect_t}{TRect}} temp(overlapRect -\/ currPos);}
\DoxyCodeLine{00481       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} overlappingCellRas(cellRas-\/>extract(temp));}
\DoxyCodeLine{00482       temp = \mbox{\hyperlink{class_t_rect_t}{TRect}}(overlapRect -\/ tileRect.getP00());}
\DoxyCodeLine{00483       \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} overlappingTileRas(ras-\/>extract(temp));}
\DoxyCodeLine{00484 }
\DoxyCodeLine{00485       assert(overlappingCellRas-\/>getBounds() ==}
\DoxyCodeLine{00486              overlappingTileRas-\/>getBounds());}
\DoxyCodeLine{00487       \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{TRop::copy}}(overlappingCellRas, overlappingTileRas);}
\DoxyCodeLine{00488 }
\DoxyCodeLine{00489       cellInfos.second-\/>m\_modified = \textcolor{keyword}{true};}
\DoxyCodeLine{00490     \}}
\DoxyCodeLine{00491 }
\DoxyCodeLine{00492   \textcolor{comment}{// Update the complex's content region}}
\DoxyCodeLine{00493   m\_region += toQRect(tileRect);}
\DoxyCodeLine{00494 }
\DoxyCodeLine{00495   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00496 \}}

\end{DoxyCode}


References \mbox{\hyperlink{l00093}{TRop\+::copy()}}, and \mbox{\hyperlink{class_t_rect_t_a53ce09c6112f8a019b43ad82d721a93b}{TRect\+T$<$ T $>$\+::is\+Empty()}}.

\mbox{\Hypertarget{class_t_cache_resource_a67a336e4ba0a07963f1b70eb1f9c24ab}\label{class_t_cache_resource_a67a336e4ba0a07963f1b70eb1f9c24ab}} 
\index{TCacheResource@{TCacheResource}!upload@{upload}}
\index{upload@{upload}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{upload()}{upload()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily bool TCache\+Resource\+::upload (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_tile}{TTile}} \&}]{tile }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00500                                              \{}
\DoxyCodeLine{00501   \textcolor{keywordflow}{if} (!checkTile(tile)) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00502 }
\DoxyCodeLine{00503   \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_cache_resource_a7fca73a70165610ef7d0ed9d67d32150}{upload}}(\mbox{\hyperlink{class_t_point_t}{TPoint}}(tile.m\_pos.x, tile.m\_pos.y), tile.getRaster());}
\DoxyCodeLine{00504 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_cache_resource_aa12f473ea3211fff52dbf0e2bdbad1cd}\label{class_t_cache_resource_aa12f473ea3211fff52dbf0e2bdbad1cd}} 
\index{TCacheResource@{TCacheResource}!uploadPalette@{uploadPalette}}
\index{uploadPalette@{uploadPalette}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{uploadPalette()}{uploadPalette()}}
{\footnotesize\ttfamily bool TCache\+Resource\+::upload\+Palette (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_smart_pointer_t}{TPaletteP}}}]{palette }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00663                                                     \{}
\DoxyCodeLine{00664   \textcolor{keywordflow}{if} (m\_tileType == NONE) m\_tileType = CM32;}
\DoxyCodeLine{00665 }
\DoxyCodeLine{00666   \textcolor{keywordflow}{if} (m\_tileType != CM32) \{}
\DoxyCodeLine{00667     assert(!\textcolor{stringliteral}{"{}The resource already holds a non-\/colormap content!"{}});}
\DoxyCodeLine{00668     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00669   \}}
\DoxyCodeLine{00670 }
\DoxyCodeLine{00671   m\_palette = palette;}
\DoxyCodeLine{00672   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00673 \}}

\end{DoxyCode}


\doxysubsection{Friends And Related Function Documentation}
\mbox{\Hypertarget{class_t_cache_resource_a3d9e971014d432f33435740f298820ca}\label{class_t_cache_resource_a3d9e971014d432f33435740f298820ca}} 
\index{TCacheResource@{TCacheResource}!TCacheResourceP@{TCacheResourceP}}
\index{TCacheResourceP@{TCacheResourceP}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{TCacheResourceP}{TCacheResourceP}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{class_t_cache_resource_p}{TCache\+ResourceP}}\hspace{0.3cm}{\ttfamily [friend]}}

\mbox{\Hypertarget{class_t_cache_resource_a722a517681415eb4997c6571c3c5b6b4}\label{class_t_cache_resource_a722a517681415eb4997c6571c3c5b6b4}} 
\index{TCacheResource@{TCacheResource}!TCacheResourcePool@{TCacheResourcePool}}
\index{TCacheResourcePool@{TCacheResourcePool}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{TCacheResourcePool}{TCacheResourcePool}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{class_t_cache_resource_pool}{TCache\+Resource\+Pool}}\hspace{0.3cm}{\ttfamily [friend]}}

\mbox{\Hypertarget{class_t_cache_resource_a05cf1f35aa862c864aed074a625b9121}\label{class_t_cache_resource_a05cf1f35aa862c864aed074a625b9121}} 
\index{TCacheResource@{TCacheResource}!THDCacheResourcePool@{THDCacheResourcePool}}
\index{THDCacheResourcePool@{THDCacheResourcePool}!TCacheResource@{TCacheResource}}
\doxysubsubsection{\texorpdfstring{THDCacheResourcePool}{THDCacheResourcePool}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{class_t_h_d_cache_resource_pool}{THDCache\+Resource\+Pool}}\hspace{0.3cm}{\ttfamily [friend]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/include/tcacheresource.\+h\item 
E\+:/opentoonz/toonz/sources/common/tfx/tcacheresource.\+cpp\end{DoxyCompactItemize}
