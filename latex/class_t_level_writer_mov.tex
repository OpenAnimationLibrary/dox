\hypertarget{class_t_level_writer_mov}{}\doxysection{TLevel\+Writer\+Mov Class Reference}
\label{class_t_level_writer_mov}\index{TLevelWriterMov@{TLevelWriterMov}}
Inheritance diagram for TLevel\+Writer\+Mov\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_t_level_writer_mov}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_t_level_writer_mov_a5ffba5331d6f9b2a4cff582dd9de3393}{TLevel\+Writer\+Mov}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\item 
\mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} \mbox{\hyperlink{class_t_level_writer_mov_a966baa81598a1a0b07bd5763dd4030a8}{get\+Frame\+Writer}} (\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} fid) override
\item 
void \mbox{\hyperlink{class_t_level_writer_mov_a972c5dd9a5f7786a704b59395f260128}{save}} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&img, int frame\+Index)
\item 
void \mbox{\hyperlink{class_t_level_writer_mov_a2621179a8bf6204c23eb1c2805a213d7}{save\+Sound\+Track}} (\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$st) override
\item 
\mbox{\hyperlink{class_t_level_writer_mov_a49381cd12cd85eb226f147bf90840890}{TLevel\+Writer\+Mov}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, TWriter\+Info $\ast$winfo)
\item 
\mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} \mbox{\hyperlink{class_t_level_writer_mov_a4d74e9e5e14f4e3213c88e01dd59f3db}{get\+Frame\+Writer}} (\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} fid)
\item 
void \mbox{\hyperlink{class_t_level_writer_mov_a3ec46132a9923ae5e78a618557d7291b}{save\+Sound\+Track}} (\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$st)
\item 
\mbox{\Hypertarget{class_t_level_writer_mov_a5ffba5331d6f9b2a4cff582dd9de3393}\label{class_t_level_writer_mov_a5ffba5331d6f9b2a4cff582dd9de3393}} 
{\bfseries TLevel\+Writer\+Mov} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&path, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\item 
\mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} \mbox{\hyperlink{class_t_level_writer_mov_a4d74e9e5e14f4e3213c88e01dd59f3db}{get\+Frame\+Writer}} (\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}} fid)
\item 
\mbox{\Hypertarget{class_t_level_writer_mov_a972c5dd9a5f7786a704b59395f260128}\label{class_t_level_writer_mov_a972c5dd9a5f7786a704b59395f260128}} 
void {\bfseries save} (const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&img, int frame\+Index)
\item 
void \mbox{\hyperlink{class_t_level_writer_mov_a3ec46132a9923ae5e78a618557d7291b}{save\+Sound\+Track}} (\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$st)
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ \mbox{\hyperlink{class_t_level_writer_mov_aa6d168a9d83ed979a369124189c69398}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&f, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\item 
static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ \mbox{\hyperlink{class_t_level_writer_mov_a917222cecf26ae91590fe5e8b4ca5b62}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&f, TWriter\+Info $\ast$winfo)
\item 
static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ \mbox{\hyperlink{class_t_level_writer_mov_aa6d168a9d83ed979a369124189c69398}{create}} (const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&f, \mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$winfo)
\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_t_level_writer_mov_aec3e6449bb3a55ea2e98672eec6fa1b4}{TImage\+Writer\+Mov}}
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_t_level_writer_mov_a5ffba5331d6f9b2a4cff582dd9de3393}\label{class_t_level_writer_mov_a5ffba5331d6f9b2a4cff582dd9de3393}} 
\index{TLevelWriterMov@{TLevelWriterMov}!TLevelWriterMov@{TLevelWriterMov}}
\index{TLevelWriterMov@{TLevelWriterMov}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{TLevelWriterMov()}{TLevelWriterMov()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily TLevel\+Writer\+Mov\+::\+TLevel\+Writer\+Mov (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{path,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00722     : \mbox{\hyperlink{class_t_level_writer}{TLevelWriter}}(path, winfo)}
\DoxyCodeLine{00723     , m\_IOError(QTNoError)}
\DoxyCodeLine{00724     , m\_pixmap(0)}
\DoxyCodeLine{00725     \textcolor{comment}{//,m\_compressedData(0)}}
\DoxyCodeLine{00726     , m\_gworld(0)}
\DoxyCodeLine{00727     , m\_videoMedia(0)}
\DoxyCodeLine{00728     , m\_videoTrack(0)}
\DoxyCodeLine{00729     , m\_soundMedia(0)}
\DoxyCodeLine{00730     , m\_soundTrack(0)}
\DoxyCodeLine{00731     , m\_movie(0)}
\DoxyCodeLine{00732     , m\_firstFrame((std::numeric\_limits<int>::max)()) \{}
\DoxyCodeLine{00733   m\_frameRate = 12.;}
\DoxyCodeLine{00734   QDErr err;}
\DoxyCodeLine{00735   FSSpec fspec;}
\DoxyCodeLine{00736   \textcolor{keywordflow}{if} (QuickTimeStuff::instance()-\/>getStatus() != noErr) \{}
\DoxyCodeLine{00737     m\_IOError = QTNotInstalled;}
\DoxyCodeLine{00738     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, buildQTErrorString(m\_IOError));}
\DoxyCodeLine{00739   \}}
\DoxyCodeLine{00740 }
\DoxyCodeLine{00741   QString qStr     = QString::fromStdWString(m\_path.getWideString());}
\DoxyCodeLine{00742   \textcolor{keyword}{const} \textcolor{keywordtype}{char} *pStr = qStr.toUtf8().data();}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00744   \textcolor{keywordflow}{if} (!getFSSpecFromPosixPath(pStr, \&fspec, \textcolor{keyword}{true})) \{}
\DoxyCodeLine{00745     m\_IOError = QTUnableToOpenFile;}
\DoxyCodeLine{00746     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, buildQTErrorString(m\_IOError));}
\DoxyCodeLine{00747   \}}
\DoxyCodeLine{00748 }
\DoxyCodeLine{00749   \textcolor{comment}{// Fix: in alcuni rari casi non veniva il mov preesistente}}
\DoxyCodeLine{00750   \textcolor{keywordflow}{if} (TSystem::doesExistFileOrLevel(m\_path)) TSystem::deleteFile(m\_path);}
\DoxyCodeLine{00751 }
\DoxyCodeLine{00752   \textcolor{keywordflow}{if} ((err = CreateMovieFile(\&fspec, \textcolor{stringliteral}{'TVOD'}, smCurrentScript,}
\DoxyCodeLine{00753                              createMovieFileDeleteCurFile |}
\DoxyCodeLine{00754                                  createMovieFileDontCreateResFile,}
\DoxyCodeLine{00755                              \&(m\_refNum), \&(m\_movie)) != noErr)) \{}
\DoxyCodeLine{00756     m\_IOError = QTCantCreateFile;}
\DoxyCodeLine{00757     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, buildQTErrorString(m\_IOError));}
\DoxyCodeLine{00758   \}}
\DoxyCodeLine{00759 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_mov_a0d970e714984866b7e0b954ca52c5175}\label{class_t_level_writer_mov_a0d970e714984866b7e0b954ca52c5175}} 
\index{TLevelWriterMov@{TLevelWriterMov}!````~TLevelWriterMov@{$\sim$TLevelWriterMov}}
\index{````~TLevelWriterMov@{$\sim$TLevelWriterMov}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{$\sim$TLevelWriterMov()}{~TLevelWriterMov()}}
{\footnotesize\ttfamily TLevel\+Writer\+Mov\+::$\sim$\+TLevel\+Writer\+Mov (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00156 \{ assert(0); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_mov_a49381cd12cd85eb226f147bf90840890}\label{class_t_level_writer_mov_a49381cd12cd85eb226f147bf90840890}} 
\index{TLevelWriterMov@{TLevelWriterMov}!TLevelWriterMov@{TLevelWriterMov}}
\index{TLevelWriterMov@{TLevelWriterMov}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{TLevelWriterMov()}{TLevelWriterMov()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily TLevel\+Writer\+Mov\+::\+TLevel\+Writer\+Mov (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{path,  }\item[{TWriter\+Info $\ast$}]{winfo }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00128     : \mbox{\hyperlink{class_t_level_writer}{TLevelWriter}}(path, info)}
\DoxyCodeLine{00129 \textcolor{comment}{//,m\_initDone(false)}}
\DoxyCodeLine{00130 \textcolor{comment}{//,m\_rate(25)}}
\DoxyCodeLine{00131 \textcolor{comment}{//,m\_IOError(QTNoError)}}
\DoxyCodeLine{00132 \textcolor{comment}{//,quality(DM\_IMAGE\_QUALITY\_NORMAL)}}
\DoxyCodeLine{00133 \textcolor{comment}{//,compression(DM\_IMAGE\_QT\_ANIM)}}
\DoxyCodeLine{00134 \textcolor{comment}{//,m\_writerInfo(new TWriterInfoMov())}}
\DoxyCodeLine{00135 \{}
\DoxyCodeLine{00136   assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00137 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{class_t_level_writer_mov_aa6d168a9d83ed979a369124189c69398}\label{class_t_level_writer_mov_aa6d168a9d83ed979a369124189c69398}} 
\index{TLevelWriterMov@{TLevelWriterMov}!create@{create}}
\index{create@{create}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{create()}{create()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ TLevel\+Writer\+Mov\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{f,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00106                                                                          \{}
\DoxyCodeLine{00107     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_level_writer_mov}{TLevelWriterMov}}(f, winfo);}
\DoxyCodeLine{00108   \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_mov_aa6d168a9d83ed979a369124189c69398}\label{class_t_level_writer_mov_aa6d168a9d83ed979a369124189c69398}} 
\index{TLevelWriterMov@{TLevelWriterMov}!create@{create}}
\index{create@{create}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{create()}{create()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ TLevel\+Writer\+Mov\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{f,  }\item[{\mbox{\hyperlink{class_t_property_group}{TProperty\+Group}} $\ast$}]{winfo }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00056                                                                          \{}
\DoxyCodeLine{00057     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_level_writer_mov}{TLevelWriterMov}}(f, winfo);}
\DoxyCodeLine{00058   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_mov_a917222cecf26ae91590fe5e8b4ca5b62}\label{class_t_level_writer_mov_a917222cecf26ae91590fe5e8b4ca5b62}} 
\index{TLevelWriterMov@{TLevelWriterMov}!create@{create}}
\index{create@{create}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{create()}{create()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily static \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}} $\ast$ TLevel\+Writer\+Mov\+::create (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_file_path}{TFile\+Path}} \&}]{f,  }\item[{TWriter\+Info $\ast$}]{winfo }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00023                                                                       \{}
\DoxyCodeLine{00024     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{class_t_level_writer_mov}{TLevelWriterMov}}(f, winfo);}
\DoxyCodeLine{00025   \};}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_mov_a4d74e9e5e14f4e3213c88e01dd59f3db}\label{class_t_level_writer_mov_a4d74e9e5e14f4e3213c88e01dd59f3db}} 
\index{TLevelWriterMov@{TLevelWriterMov}!getFrameWriter@{getFrameWriter}}
\index{getFrameWriter@{getFrameWriter}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{getFrameWriter()}{getFrameWriter()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} TLevel\+Writer\+Mov\+::get\+Frame\+Writer (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}}}]{fid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.

\mbox{\Hypertarget{class_t_level_writer_mov_a4d74e9e5e14f4e3213c88e01dd59f3db}\label{class_t_level_writer_mov_a4d74e9e5e14f4e3213c88e01dd59f3db}} 
\index{TLevelWriterMov@{TLevelWriterMov}!getFrameWriter@{getFrameWriter}}
\index{getFrameWriter@{getFrameWriter}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{getFrameWriter()}{getFrameWriter()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} TLevel\+Writer\+Mov\+::get\+Frame\+Writer (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}}}]{fid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.

\mbox{\Hypertarget{class_t_level_writer_mov_a966baa81598a1a0b07bd5763dd4030a8}\label{class_t_level_writer_mov_a966baa81598a1a0b07bd5763dd4030a8}} 
\index{TLevelWriterMov@{TLevelWriterMov}!getFrameWriter@{getFrameWriter}}
\index{getFrameWriter@{getFrameWriter}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{getFrameWriter()}{getFrameWriter()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{class_t_image_writer_p}{TImage\+WriterP}} TLevel\+Writer\+Mov\+::get\+Frame\+Writer (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_frame_id}{TFrame\+Id}}}]{fid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00160 \{ assert(\textcolor{keyword}{false}); \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_mov_a972c5dd9a5f7786a704b59395f260128}\label{class_t_level_writer_mov_a972c5dd9a5f7786a704b59395f260128}} 
\index{TLevelWriterMov@{TLevelWriterMov}!save@{save}}
\index{save@{save}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily void TLevel\+Writer\+Mov\+::save (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{class_t_smart_pointer_t}{TImageP}} \&}]{img,  }\item[{int}]{frame\+Index }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00524                                                              \{}
\DoxyCodeLine{00525   m\_firstFrame = tmin(frameIndex, m\_firstFrame);}
\DoxyCodeLine{00526 }
\DoxyCodeLine{00527   \mbox{\hyperlink{class_t_raster_image_p}{TRasterImageP}} image(img);}
\DoxyCodeLine{00528   \textcolor{keywordflow}{if} (!image) \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}Unsupported image type"{}});}
\DoxyCodeLine{00529 }
\DoxyCodeLine{00530   \textcolor{keywordtype}{int} lx = image-\/>getRaster()-\/>getLx();}
\DoxyCodeLine{00531   \textcolor{keywordtype}{int} ly = image-\/>getRaster()-\/>getLy();}
\DoxyCodeLine{00532   \textcolor{comment}{// void *buffer = image-\/>getRaster()-\/>getRawData();}}
\DoxyCodeLine{00533 }
\DoxyCodeLine{00534   \textcolor{keywordtype}{int} pixSize = image-\/>getRaster()-\/>getPixelSize();}
\DoxyCodeLine{00535   \textcolor{keywordflow}{if} (pixSize != 4)}
\DoxyCodeLine{00536     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}Unsupported pixel type"{}});}
\DoxyCodeLine{00537 }
\DoxyCodeLine{00538   QMutexLocker sl(\&m\_mutex);}
\DoxyCodeLine{00539   \textcolor{keywordflow}{if} (!m\_properties) m\_properties = \textcolor{keyword}{new} \mbox{\hyperlink{class_tiio_1_1_mov_writer_properties}{Tiio::MovWriterProperties}}();}
\DoxyCodeLine{00540 }
\DoxyCodeLine{00541   \mbox{\hyperlink{class_tiio_1_1_mov_writer_properties}{Tiio::MovWriterProperties}} *prop = (\mbox{\hyperlink{class_tiio_1_1_mov_writer_properties}{Tiio::MovWriterProperties}} *)(m\_properties);}
\DoxyCodeLine{00542 }
\DoxyCodeLine{00543   \textcolor{comment}{// CodecType codecType;}}
\DoxyCodeLine{00544   \textcolor{comment}{// try \{}}
\DoxyCodeLine{00545   \textcolor{comment}{// codecType = prop-\/>getCurrentCodec();}}
\DoxyCodeLine{00546   \textcolor{comment}{//  \} catch (...)//boost::bad\_any\_cast\&)}}
\DoxyCodeLine{00547   \textcolor{comment}{//    \{}}
\DoxyCodeLine{00548   \textcolor{comment}{//    throw TImageException(m\_path, "{}bad codec name"{});}}
\DoxyCodeLine{00549   \textcolor{comment}{//    \}}}
\DoxyCodeLine{00550   \textcolor{comment}{//}}
\DoxyCodeLine{00551   \textcolor{comment}{// CodecQ quality = prop-\/>getCurrentQuality();}}
\DoxyCodeLine{00552   QDErr err;}
\DoxyCodeLine{00553 }
\DoxyCodeLine{00554   \textcolor{keywordflow}{if} (m\_videoTrack == 0) \{}
\DoxyCodeLine{00555     QTAtomContainer atoms;}
\DoxyCodeLine{00556     QTNewAtomContainer(\&atoms);}
\DoxyCodeLine{00557     fromPropertiesToAtoms(*prop, atoms);}
\DoxyCodeLine{00558     m\_ci = OpenDefaultComponent(StandardCompressionType,}
\DoxyCodeLine{00559                                 StandardCompressionSubType);}
\DoxyCodeLine{00560     \textcolor{keywordflow}{if} (SCSetSettingsFromAtomContainer(m\_ci, atoms) != noErr) \{}
\DoxyCodeLine{00561       CloseComponent(m\_ci);}
\DoxyCodeLine{00562       assert(!\textcolor{stringliteral}{"{}cannot use that quickTime codec, use default"{}});}
\DoxyCodeLine{00563       m\_ci = OpenDefaultComponent(StandardCompressionType,}
\DoxyCodeLine{00564                                   StandardCompressionSubType);}
\DoxyCodeLine{00565     \}}
\DoxyCodeLine{00566 }
\DoxyCodeLine{00567     QTDisposeAtomContainer(atoms);}
\DoxyCodeLine{00568 }
\DoxyCodeLine{00569     \textcolor{comment}{// FSSpec fspec;}}
\DoxyCodeLine{00570     Rect frame;}
\DoxyCodeLine{00571     \textcolor{keywordtype}{long} max\_compressed\_size;}
\DoxyCodeLine{00572 }
\DoxyCodeLine{00573     \textcolor{keywordflow}{if} (QuickTimeStuff::instance()-\/>getStatus() != noErr) \{}
\DoxyCodeLine{00574       m\_IOError = QTNotInstalled;}
\DoxyCodeLine{00575       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path, buildQTErrorString(m\_IOError));}
\DoxyCodeLine{00576     \}}
\DoxyCodeLine{00577 }
\DoxyCodeLine{00578     \textcolor{comment}{// First, set the movie's time scale to match a suitable multiple of}}
\DoxyCodeLine{00579     \textcolor{comment}{// m\_frameRate.}}
\DoxyCodeLine{00580     \textcolor{comment}{// The timeScale will be used for both the movie and media.}}
\DoxyCodeLine{00581     TimeScale timeScale = ::frameRateToTimeScale(m\_frameRate);}
\DoxyCodeLine{00582     SetMovieTimeScale(m\_movie, timeScale);}
\DoxyCodeLine{00583 }
\DoxyCodeLine{00584     m\_videoTrack = NewMovieTrack(m\_movie, FixRatio((\textcolor{keywordtype}{short})lx, 1),}
\DoxyCodeLine{00585                                  FixRatio((\textcolor{keywordtype}{short})ly, 1), kNoVolume);}
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587     \textcolor{keywordflow}{if} ((err = GetMoviesError() != noErr))}
\DoxyCodeLine{00588       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create video track"{}});}
\DoxyCodeLine{00589 }
\DoxyCodeLine{00590     m\_videoMedia = NewTrackMedia(m\_videoTrack, VideoMediaType, timeScale, 0, 0);}
\DoxyCodeLine{00591 }
\DoxyCodeLine{00592     \textcolor{keywordflow}{if} ((err = GetMoviesError() != noErr))}
\DoxyCodeLine{00593       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create video media"{}});}
\DoxyCodeLine{00594 }
\DoxyCodeLine{00595     frame.left   = 0;}
\DoxyCodeLine{00596     frame.top    = 0;}
\DoxyCodeLine{00597     frame.right  = lx;}
\DoxyCodeLine{00598     frame.bottom = ly;}
\DoxyCodeLine{00599 }
\DoxyCodeLine{00600 \textcolor{preprocessor}{\#if QT\_VERSION >= 0x050000}}
\DoxyCodeLine{00601     \textcolor{keywordflow}{if} ((err = QTNewGWorld(\&(m\_gworld), pixSize * 8, \&frame, 0, 0, 0)) != noErr)}
\DoxyCodeLine{00602 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00603     \textcolor{keywordflow}{if} ((err = NewGWorld(\&(m\_gworld), pixSize * 8, \&frame, 0, 0, 0)) != noErr)}
\DoxyCodeLine{00604 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00605       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't create movie buffer"{}});}
\DoxyCodeLine{00606 }
\DoxyCodeLine{00607     \textcolor{comment}{//\#ifdef WIN32}}
\DoxyCodeLine{00608     \textcolor{comment}{//  LockPixels(m\_gworld-\/>portPixMap);}}
\DoxyCodeLine{00609     \textcolor{comment}{//  if ((err = GetMaxCompressionSize(m\_gworld-\/>portPixMap, \&frame, 0,}}
\DoxyCodeLine{00610     \textcolor{comment}{//                                quality,  compression,anyCodec,}}
\DoxyCodeLine{00611     \textcolor{comment}{//                           \&max\_compressed\_size))!=noErr)}}
\DoxyCodeLine{00612     \textcolor{comment}{//    throw TImageException(getFilePath(), "{}can't get max compression}}
\DoxyCodeLine{00613     \textcolor{comment}{//    size"{});}}
\DoxyCodeLine{00614     \textcolor{comment}{//}}
\DoxyCodeLine{00615     \textcolor{comment}{//\#else}}
\DoxyCodeLine{00616     \textcolor{comment}{//  PixMapHandle pixmapH = GetPortPixMap (m\_gworld);}}
\DoxyCodeLine{00617     \textcolor{comment}{//}}
\DoxyCodeLine{00618     \textcolor{comment}{//  LockPixels(pixmapH);}}
\DoxyCodeLine{00619     \textcolor{comment}{//  if ((err = GetMaxCompressionSize(pixmapH, \&frame, 0,}}
\DoxyCodeLine{00620     \textcolor{comment}{//                                quality,  codecType,anyCodec,}}
\DoxyCodeLine{00621     \textcolor{comment}{//               \&max\_compressed\_size))!=noErr)}}
\DoxyCodeLine{00622     \textcolor{comment}{//    throw TImageException(getFilePath(), "{}can't get max compression}}
\DoxyCodeLine{00623     \textcolor{comment}{//    size"{});}}
\DoxyCodeLine{00624     \textcolor{comment}{//}}
\DoxyCodeLine{00625     \textcolor{comment}{//\#endif}}
\DoxyCodeLine{00626 }
\DoxyCodeLine{00627     \textcolor{comment}{// m\_compressedData = NewHandle(max\_compressed\_size);}}
\DoxyCodeLine{00628 }
\DoxyCodeLine{00629     \textcolor{keywordflow}{if} ((err = MemError()) != noErr)}
\DoxyCodeLine{00630       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(),}
\DoxyCodeLine{00631                             \textcolor{stringliteral}{"{}can't allocate compressed data for movie"{}});}
\DoxyCodeLine{00632 }
\DoxyCodeLine{00633     \textcolor{comment}{// MoveHHi(m\_compressedData);}}
\DoxyCodeLine{00634     \textcolor{comment}{// HLock(m\_compressedData);}}
\DoxyCodeLine{00635 }
\DoxyCodeLine{00636     \textcolor{keywordflow}{if} ((err = MemError()) != noErr)}
\DoxyCodeLine{00637       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't allocate img handle"{}});}
\DoxyCodeLine{00638 }
\DoxyCodeLine{00639 \textcolor{comment}{/* FIXME: QuickDraw とともに無くなったようだ */}}
\DoxyCodeLine{00640 \textcolor{preprocessor}{\#if defined(HAS\_QUICKDRAW)}}
\DoxyCodeLine{00641     m\_pixmap = GetGWorldPixMap(m\_gworld);}
\DoxyCodeLine{00642 }
\DoxyCodeLine{00643     \textcolor{keywordflow}{if} (!LockPixels(m\_pixmap))}
\DoxyCodeLine{00644       \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't lock pixels"{}});}
\DoxyCodeLine{00645 }
\DoxyCodeLine{00646     buf = (\mbox{\hyperlink{struct_pixel_x_r_g_b}{PixelXRGB}} *)GetPixBaseAddr(m\_pixmap);}
\DoxyCodeLine{00647 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00648     buf\_lx = lx;}
\DoxyCodeLine{00649     buf\_ly = ly;}
\DoxyCodeLine{00650   \}}
\DoxyCodeLine{00651 }
\DoxyCodeLine{00652   \textcolor{keywordflow}{if} ((err = BeginMediaEdits(m\_videoMedia)) != noErr)}
\DoxyCodeLine{00653     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't begin edit video media"{}});}
\DoxyCodeLine{00654 }
\DoxyCodeLine{00655   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} rowBytes =}
\DoxyCodeLine{00656       (\textcolor{keywordtype}{unsigned} short)(((\textcolor{keywordtype}{short})(*(m\_pixmap))-\/>rowBytes \& \string~(3 << 14)));}
\DoxyCodeLine{00657 }
\DoxyCodeLine{00658   Rect frame;}
\DoxyCodeLine{00659   ImageDescriptionHandle img\_descr = 0;}
\DoxyCodeLine{00660   Handle compressedData            = 0;}
\DoxyCodeLine{00661 }
\DoxyCodeLine{00662   frame.left   = 0;}
\DoxyCodeLine{00663   frame.top    = 0;}
\DoxyCodeLine{00664   frame.right  = lx;}
\DoxyCodeLine{00665   frame.bottom = ly;}
\DoxyCodeLine{00666 }
\DoxyCodeLine{00667   \mbox{\hyperlink{class_t_smart_pointer_t}{TRasterP}} ras = image-\/>getRaster();}
\DoxyCodeLine{00668 }
\DoxyCodeLine{00669 \textcolor{preprocessor}{\#ifdef WIN32}}
\DoxyCodeLine{00670   compressed\_data\_ptr = StripAddress(*(m\_compressedData));}
\DoxyCodeLine{00671   \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}(ras, buf, buf\_lx, buf\_ly);}
\DoxyCodeLine{00672 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00673   \textcolor{comment}{// compressed\_data\_ptr  = *m\_compressedData;}}
\DoxyCodeLine{00674   \mbox{\hyperlink{namespace_t_rop_a229eb7fd85c23c325ea4ba55478d5712}{copy}}(ras, buf, buf\_lx, buf\_ly, rowBytes);}
\DoxyCodeLine{00675 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00676 }
\DoxyCodeLine{00677 \textcolor{comment}{// img\_descr = (ImageDescriptionHandle)NewHandle(4);}}
\DoxyCodeLine{00678 }
\DoxyCodeLine{00679 \textcolor{preprocessor}{\#ifdef WIN32}}
\DoxyCodeLine{00680   \textcolor{keywordflow}{if} ((err = CompressImage(m\_gworld-\/>portPixMap, \&frame, quality, compression,}
\DoxyCodeLine{00681                            img\_descr, compressed\_data\_ptr)) != noErr)}
\DoxyCodeLine{00682     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't compress image"{}});}
\DoxyCodeLine{00683 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00684 }
\DoxyCodeLine{00685 \textcolor{preprocessor}{\#if defined(HAS\_QUICKDRAW)}}
\DoxyCodeLine{00686   PixMapHandle pixmapH = GetPortPixMap(m\_gworld);}
\DoxyCodeLine{00687 }
\DoxyCodeLine{00688   \textcolor{keywordflow}{if} ((err = SCCompressImage(m\_ci, pixmapH, \&frame, \&img\_descr,}
\DoxyCodeLine{00689                              \&compressedData)) != noErr)}
\DoxyCodeLine{00690     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't compress image"{}});}
\DoxyCodeLine{00691 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00692 }
\DoxyCodeLine{00693 \textcolor{comment}{// if ((err = CompressImage(pixmapH,}}
\DoxyCodeLine{00694 \textcolor{comment}{//                   \&frame,}}
\DoxyCodeLine{00695 \textcolor{comment}{//               quality, codecType,}}
\DoxyCodeLine{00696 \textcolor{comment}{//           img\_descr, compressed\_data\_ptr))!=noErr)}}
\DoxyCodeLine{00697 \textcolor{comment}{//  throw TImageException(getFilePath(), "{}can't compress image"{});}}
\DoxyCodeLine{00698 }
\DoxyCodeLine{00699 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00700 }
\DoxyCodeLine{00701   TimeValue sampleTime;}
\DoxyCodeLine{00702   \textcolor{keywordflow}{if} ((err = AddMediaSample(}
\DoxyCodeLine{00703            m\_videoMedia, compressedData, 0, (*img\_descr)-\/>dataSize, 100,}
\DoxyCodeLine{00704            (SampleDescriptionHandle)img\_descr, 1, 0, \&sampleTime)) != noErr)}
\DoxyCodeLine{00705     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't add image to movie media"{}});}
\DoxyCodeLine{00706 }
\DoxyCodeLine{00707   \textcolor{keywordflow}{if} ((err = EndMediaEdits(m\_videoMedia)) != noErr)}
\DoxyCodeLine{00708     \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(getFilePath(), \textcolor{stringliteral}{"{}can't end edit media"{}});}
\DoxyCodeLine{00709 }
\DoxyCodeLine{00710   DisposeHandle(compressedData);}
\DoxyCodeLine{00711 }
\DoxyCodeLine{00712   DisposeHandle((Handle)img\_descr);}
\DoxyCodeLine{00713 }
\DoxyCodeLine{00714   m\_savedFrames.push\_back(std::pair<int, TimeValue>(frameIndex, sampleTime));}
\DoxyCodeLine{00715 \}}

\end{DoxyCode}
\mbox{\Hypertarget{class_t_level_writer_mov_a3ec46132a9923ae5e78a618557d7291b}\label{class_t_level_writer_mov_a3ec46132a9923ae5e78a618557d7291b}} 
\index{TLevelWriterMov@{TLevelWriterMov}!saveSoundTrack@{saveSoundTrack}}
\index{saveSoundTrack@{saveSoundTrack}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{saveSoundTrack()}{saveSoundTrack()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily void TLevel\+Writer\+Mov\+::save\+Sound\+Track (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$}]{st }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.

\mbox{\Hypertarget{class_t_level_writer_mov_a3ec46132a9923ae5e78a618557d7291b}\label{class_t_level_writer_mov_a3ec46132a9923ae5e78a618557d7291b}} 
\index{TLevelWriterMov@{TLevelWriterMov}!saveSoundTrack@{saveSoundTrack}}
\index{saveSoundTrack@{saveSoundTrack}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{saveSoundTrack()}{saveSoundTrack()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily void TLevel\+Writer\+Mov\+::save\+Sound\+Track (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$}]{st }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.

\mbox{\Hypertarget{class_t_level_writer_mov_a2621179a8bf6204c23eb1c2805a213d7}\label{class_t_level_writer_mov_a2621179a8bf6204c23eb1c2805a213d7}} 
\index{TLevelWriterMov@{TLevelWriterMov}!saveSoundTrack@{saveSoundTrack}}
\index{saveSoundTrack@{saveSoundTrack}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{saveSoundTrack()}{saveSoundTrack()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily void TLevel\+Writer\+Mov\+::save\+Sound\+Track (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{class_t_sound_track}{TSound\+Track}} $\ast$}]{st }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \mbox{\hyperlink{class_t_level_writer}{TLevel\+Writer}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00141                                                   \{}
\DoxyCodeLine{00142   \textcolor{keywordflow}{throw} \mbox{\hyperlink{class_t_image_exception}{TImageException}}(m\_path,}
\DoxyCodeLine{00143                         \textcolor{stringliteral}{"{}TLevelWriterMov::saveSoundTrack not Implemented"{}});}
\DoxyCodeLine{00144 \}}

\end{DoxyCode}


\doxysubsection{Friends And Related Function Documentation}
\mbox{\Hypertarget{class_t_level_writer_mov_aec3e6449bb3a55ea2e98672eec6fa1b4}\label{class_t_level_writer_mov_aec3e6449bb3a55ea2e98672eec6fa1b4}} 
\index{TLevelWriterMov@{TLevelWriterMov}!TImageWriterMov@{TImageWriterMov}}
\index{TImageWriterMov@{TImageWriterMov}!TLevelWriterMov@{TLevelWriterMov}}
\doxysubsubsection{\texorpdfstring{TImageWriterMov}{TImageWriterMov}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{class_t_image_writer_mov}{TImage\+Writer\+Mov}}\hspace{0.3cm}{\ttfamily [friend]}}



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
E\+:/opentoonz/toonz/sources/image/mov/tiio\+\_\+mov.\+h\item 
E\+:/opentoonz/toonz/sources/image/mov/tiio\+\_\+mov\+L.\+h\item 
E\+:/opentoonz/toonz/sources/image/mov/tiio\+\_\+mov\+M.\+h\item 
E\+:/opentoonz/toonz/sources/image/mov/tiio\+\_\+mov\+L.\+cpp\item 
E\+:/opentoonz/toonz/sources/image/mov/tiio\+\_\+mov\+M.\+cpp\item 
E\+:/opentoonz/toonz/sources/image/mov/tiio\+\_\+mov\+W.\+cpp\item 
E\+:/opentoonz/toonz/sources/image/mov/tiio\+\_\+mov\+X.\+cpp\end{DoxyCompactItemize}
